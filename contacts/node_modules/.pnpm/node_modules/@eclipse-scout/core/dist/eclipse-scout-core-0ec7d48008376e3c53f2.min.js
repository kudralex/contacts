(()=>{"use strict";var Vi={};Vi.n=i=>{var e=i&&i.__esModule?()=>i.default:()=>i;return Vi.d(e,{a:e}),e},Vi.d=(i,e)=>{for(var t in e)Vi.o(e,t)&&!Vi.o(i,t)&&Object.defineProperty(i,t,{enumerable:!0,get:e[t]})},Vi.o=(i,e)=>Object.prototype.hasOwnProperty.call(i,e),Vi.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})};var Gf={};Vi.r(Gf),Vi.d(Gf,{AbortKeyStroke:()=>ra,AbstractCompactTreeControlKeyStroke:()=>co,AbstractGrid:()=>Un,AbstractLayout:()=>ee,AbstractTableNavigationKeyStroke:()=>Ws,AbstractTreeNavigationKeyStroke:()=>sr,Accordion:()=>gd,AccordionAdapter:()=>_d,AccordionField:()=>Bg,AccordionFieldAdapter:()=>kg,AccordionLayout:()=>na,Action:()=>re,ActionAdapter:()=>br,ActionExecKeyStroke:()=>aa,ActionKeyStroke:()=>sn,AggregateTableControl:()=>Vs,AggregateTableControlAdapter:()=>ku,AjaxCall:()=>pr,AjaxError:()=>Wo,AlphanumericSortingStringColumn:()=>cg,App:()=>te,AppLinkKeyStroke:()=>po,AutoLeafPageWithNodes:()=>Df,BackgroundJobPollingStatus:()=>Ki,BackgroundJobPollingSupport:()=>Jh,BasicField:()=>fl,BasicFieldAdapter:()=>Ja,BeanColumn:()=>pg,BeanField:()=>Hg,BeanFieldAdapter:()=>Ng,BeanTile:()=>V_,BeanTileAdapter:()=>W_,BenchColumn:()=>ys,BenchColumnLayoutData:()=>Rn,BenchRowLayoutData:()=>lf,BooleanColumn:()=>cn,Box:()=>ha,BoxButtons:()=>Xo,BreadcrumbBar:()=>yy,BreadcrumbBarAdapter:()=>by,BreadcrumbBarField:()=>vy,BreadcrumbBarFieldAdapter:()=>wy,BreadcrumbBarLayout:()=>Kf,BreadcrumbItem:()=>zf,BreadcrumbItemAdapter:()=>gy,BrowserField:()=>bn,BrowserFieldAdapter:()=>Vg,BrowserFieldLayout:()=>Cc,BusyIndicator:()=>Qh,Button:()=>Re,ButtonAdapter:()=>Sc,ButtonAdapterMenu:()=>so,ButtonKeyStroke:()=>mo,ButtonLayout:()=>Za,ButtonTile:()=>Qp,CachedElement:()=>Nl,Calculator:()=>Hc,Calendar:()=>He,CalendarAdapter:()=>Nm,CalendarComponent:()=>ro,CalendarComponentAdapter:()=>Vm,CalendarField:()=>Wg,CalendarFieldAdapter:()=>zg,CalendarLayout:()=>tu,CalendarListComponent:()=>eu,CalendarModeMenu:()=>no,CalendarModesMenu:()=>iu,Call:()=>Bn,CancelMenu:()=>mu,Carousel:()=>Em,CarouselField:()=>Kg,CarouselLayout:()=>yd,Cell:()=>Pt,CellEditorCancelEditKeyStroke:()=>zu,CellEditorCompleteEditKeyStroke:()=>Ku,CellEditorPopup:()=>Nu,CellEditorPopupLayout:()=>Wu,CellEditorTabKeyStroke:()=>Gu,CheckBoxField:()=>Dr,CheckBoxFieldAdapter:()=>Gg,CheckBoxToggleKeyStroke:()=>eh,ClickActiveElementKeyStroke:()=>jo,ClipboardField:()=>Tn,ClipboardFieldAdapter:()=>Ug,CloseKeyStroke:()=>Xn,CloseMenu:()=>Qm,Code:()=>fm,CodeLookupCall:()=>Ul,CodeType:()=>Wn,CollapseHandle:()=>qi,ColorField:()=>qg,ColorFieldAdapter:()=>Yg,Column:()=>De,ColumnLayout:()=>ud,ColumnOptimalWidthMeasurer:()=>$u,ColumnUserFilter:()=>Ji,ComboMenu:()=>Vd,ComboMenuAdapter:()=>Om,CompactBean:()=>Mu,CompactColumn:()=>Ru,CompactLine:()=>Iu,CompactLineBlock:()=>cl,CompactTree:()=>Eg,CompactTreeDownKeyStroke:()=>fc,CompactTreeLeftKeyStroke:()=>mc,CompactTreeNode:()=>cc,CompactTreeRightKeyStroke:()=>gc,CompactTreeUpKeyStroke:()=>pc,Composite:()=>Qf,CompositeField:()=>Fr,CompositeFieldAdapter:()=>fo,CompositeTile:()=>Hp,ContextMenuKeyStroke:()=>ia,ContextMenuPopup:()=>ft,ContextMenuPopupLayout:()=>Wd,CopyKeyStroke:()=>Tc,DateColumn:()=>Lu,DateColumnUserFilter:()=>bg,DateField:()=>kt,DateFieldAdapter:()=>Cn,DateFormat:()=>xt,DateFormatPatternDefinition:()=>je,DateFormatPatternType:()=>Ye,DatePicker:()=>pa,DatePickerPopup:()=>fa,DatePickerPopupLayout:()=>Ad,DatePickerTouchPopup:()=>$d,DatePickerTouchPopupLayout:()=>Rd,DatePredictionFailedStatus:()=>th,DateRange:()=>Ve,DateTimeCompositeLayout:()=>Pc,DecimalFormat:()=>Ls,DefaultStatus:()=>Wr,DeferredGlassPaneTarget:()=>Qr,Desktop:()=>Ie,DesktopAdapter:()=>X_,DesktopBench:()=>Ci,DesktopFormController:()=>kf,DesktopHeader:()=>hf,DesktopHeaderLayout:()=>uf,DesktopLayout:()=>ef,DesktopLogo:()=>Zp,DesktopNavigation:()=>Wt,DesktopNavigationHandle:()=>Ph,DesktopNavigationLayout:()=>cf,DesktopNotification:()=>ti,DesktopNotificationAdapter:()=>ey,DesktopResponsiveHandler:()=>ig,DesktopTab:()=>tf,DesktopTabArea:()=>wh,DesktopTabAreaLayout:()=>sf,DesktopTabBoxController:()=>Th,DesktopTabSelectKeyStroke:()=>rf,DesktopToolBox:()=>Eh,DetailTableTreeFilter:()=>Af,Device:()=>x,DialogLayout:()=>ds,Dimension:()=>F,DisableBrowserF5ReloadKeyStroke:()=>nf,DisableBrowserTabSwitchingKeyStroke:()=>af,DoubleClickSupport:()=>Vr,DragAndDropHandler:()=>Kh,EllipsisMenu:()=>tl,EllipsisTabMenu:()=>yp,EnlargeNavigationKeyStroke:()=>ff,ErrorHandler:()=>Nr,Event:()=>Kt,EventDelegator:()=>is,EventEmitter:()=>ts,EventSupport:()=>Bo,Extension:()=>Jf,FieldStatus:()=>ja,FileChooser:()=>Km,FileChooserAdapter:()=>Gm,FileChooserButton:()=>jg,FileChooserButtonAdapter:()=>Xg,FileChooserController:()=>ll,FileChooserField:()=>Jg,FileChooserFieldAdapter:()=>_l,FileChooserFieldBrowseKeyStroke:()=>Ec,FileChooserFieldDeleteKeyStroke:()=>Fc,FileInput:()=>_i,FilterFieldsGroupBox:()=>Hf,FilterSupport:()=>On,FlexboxLayout:()=>Xs,FlexboxLayoutData:()=>yr,FocusAdjacentElementKeyStroke:()=>sa,FocusContext:()=>oa,FocusFilterFieldKeyStroke:()=>Ol,FocusManager:()=>bd,FocusRule:()=>Mt,Form:()=>U,FormAdapter:()=>Sa,FormController:()=>ml,FormField:()=>A,FormFieldAdapter:()=>at,FormFieldLayout:()=>oi,FormFieldMenu:()=>Bm,FormFieldMenuAdapter:()=>km,FormFieldTile:()=>Hi,FormFieldTileAdapter:()=>q_,FormGrid:()=>cu,FormLayout:()=>hl,FormLifecycle:()=>fu,FormLifecycleMenu:()=>an,FormMenu:()=>Hs,FormMenuActionKeyStroke:()=>pu,FormMenuAdapter:()=>Jm,FormTableControl:()=>_g,FormTableControlAdapter:()=>yg,FormTableControlLayout:()=>Hu,GlassPane:()=>Fm,GlassPaneRenderer:()=>Zr,GridData:()=>ze,Group:()=>mi,GroupAdapter:()=>Lm,GroupBox:()=>xe,GroupBoxAdapter:()=>Ac,GroupBoxGridConfig:()=>Dc,GroupBoxLayout:()=>ih,GroupBoxMenuItemsOrder:()=>nr,GroupBoxResponsiveHandler:()=>lo,GroupLayout:()=>Md,GroupToggleCollapseKeyStroke:()=>Id,HAlign:()=>ht,HeaderTabBoxController:()=>df,HierarchicalLookupResultBuilder:()=>Xh,HorizontalGrid:()=>Gr,HorizontalGridMatrix:()=>hd,HtmlComponent:()=>T,HtmlEncoder:()=>Uh,HtmlEnvironment:()=>de,HtmlField:()=>Mc,HtmlFieldAdapter:()=>Qg,HtmlTile:()=>Np,HtmlTileAdapter:()=>N_,HybridManager:()=>Sh,HybridManagerAdapter:()=>Z_,IFrame:()=>vd,Icon:()=>Zs,IconColumn:()=>Ra,IconDesc:()=>ni,Image:()=>ga,ImageField:()=>Ar,ImageFieldAdapter:()=>Zg,ImageFieldLayout:()=>Ic,ImageLayout:()=>Od,InputFieldKeyStrokeContext:()=>As,Insets:()=>Ge,IntegerField:()=>xn,JsFormAdapter:()=>rg,Key:()=>qo,KeyStroke:()=>O,KeyStrokeContext:()=>Oe,KeyStrokeManager:()=>fd,KeyTableFilter:()=>Cg,Label:()=>da,LabelAdapter:()=>$m,LabelField:()=>sh,LabelFieldAdapter:()=>e_,LayoutConstants:()=>Ui,LayoutValidator:()=>nd,LazyNodeFilter:()=>ac,Lifecycle:()=>su,ListBox:()=>rh,ListBoxAdapter:()=>t_,ListBoxLayout:()=>Oc,LoadingSupport:()=>ss,Locale:()=>qt,LogLevel:()=>qe,LogicalGrid:()=>Ql,LogicalGridConfig:()=>gr,LogicalGridData:()=>xs,LogicalGridLayout:()=>Gn,LogicalGridLayoutConfig:()=>si,LogicalGridLayoutInfo:()=>ld,LogicalGridMatrix:()=>Zl,LogicalGridMatrixCell:()=>qn,LogicalGridMatrixCursor:()=>$i,LoginApp:()=>fy,LoginBox:()=>Dl,LogoutApp:()=>my,LogoutBox:()=>Wf,LookupBox:()=>yn,LookupBoxLayout:()=>Qa,LookupCall:()=>Ut,LookupFieldAdapter:()=>nh,LookupRow:()=>Ys,MaxLengthHandler:()=>Ho,Menu:()=>ne,MenuAdapter:()=>il,MenuBar:()=>ce,MenuBarBox:()=>va,MenuBarBoxLayout:()=>Zd,MenuBarLayout:()=>er,MenuBarLeftKeyStroke:()=>Xd,MenuBarPopup:()=>Qd,MenuBarRightKeyStroke:()=>Jd,MenuBox:()=>qd,MenuBoxLayout:()=>Yd,MenuDestinations:()=>It,MenuExecByNumberKeyStroke:()=>zd,MenuExecKeyStroke:()=>Nd,MenuItemsOrder:()=>io,MenuKeyStroke:()=>Hd,MenuNavigationDownKeyStroke:()=>Kd,MenuNavigationExecKeyStroke:()=>nl,MenuNavigationKeyStroke:()=>rl,MenuNavigationUpKeyStroke:()=>Gd,MessageBox:()=>vi,MessageBoxAdapter:()=>Ig,MessageBoxController:()=>gl,MessageBoxLayout:()=>wc,MessageBoxes:()=>rr,MobilePopup:()=>Fd,MobilePopupAdapter:()=>Mm,MobilePopupLayout:()=>Dd,Mode:()=>jm,ModeAdapter:()=>Xm,ModeSelector:()=>du,ModeSelectorField:()=>i_,ModeSelectorFieldAdapter:()=>s_,ModeSelectorLayout:()=>uu,ModelAdapter:()=>ke,NavigateButton:()=>$o,NavigateDownButton:()=>Rh,NavigateUpButton:()=>Mh,Notification:()=>Bd,NotificationAdapter:()=>kd,NotificationBadgeStatus:()=>Ss,NullLayout:()=>Yn,NullLogger:()=>Hl,NullWidget:()=>Bl,NullWidgetAdapter:()=>Zf,NumberColumn:()=>Bi,NumberColumnUserFilter:()=>vg,NumberField:()=>Pn,NumberFieldAdapter:()=>kc,ObjectFactory:()=>At,OfflineDesktopNotification:()=>gf,OkMenu:()=>gu,OpenUriHandler:()=>of,Outline:()=>bs,OutlineAdapter:()=>dr,OutlineKeyStrokeContext:()=>If,OutlineLayout:()=>Ah,OutlineMediator:()=>$f,OutlineNavigateToTopKeyStroke:()=>Lf,OutlineOverview:()=>Ih,OutlineTileField:()=>ly,OutlineTileFieldAdapter:()=>ay,OutlineViewButton:()=>$h,OutlineViewButtonAdapter:()=>ny,Page:()=>ai,PageLayout:()=>Rf,PageTileButton:()=>Ef,PageTileGrid:()=>Dh,PageTileGridSelectKeyStroke:()=>Ff,PageWithNodes:()=>iy,PageWithTable:()=>sy,ParsingFailedStatus:()=>pi,PlaceholderField:()=>lh,PlaceholderFieldAdapter:()=>n_,PlaceholderTile:()=>Ti,PlainTextEncoder:()=>Gh,Planner:()=>ae,PlannerAdapter:()=>Tr,PlannerField:()=>o_,PlannerFieldAdapter:()=>l_,PlannerHeader:()=>ru,PlannerLayout:()=>nu,PlannerMenuItemsOrder:()=>ou,Point:()=>X,Popup:()=>ue,PopupAdapter:()=>Sd,PopupBlockerDesktopNotification:()=>yf,PopupBlockerHandler:()=>Do,PopupLayout:()=>Ii,PopupManager:()=>ua,PopupManagerAdapter:()=>Rm,PopupWindow:()=>Lr,PrepopulatedLookupCall:()=>cm,PromiseCreator:()=>rm,PropertyChangeEventFilter:()=>ed,PropertyEventEmitter:()=>Ml,ProposalChooser:()=>dh,ProposalChooserLayout:()=>tp,ProposalField:()=>Qc,ProposalFieldAdapter:()=>g_,ProposalTreeNode:()=>ep,QueryBy:()=>fe,RadioButton:()=>bl,RadioButtonAdapter:()=>a_,RadioButtonGroup:()=>or,RadioButtonGroupAdapter:()=>h_,RadioButtonGroupGridConfig:()=>Vc,RadioButtonGroupLayout:()=>Wc,RadioButtonGroupLeftOrUpKeyStroke:()=>zc,RadioButtonGroupRightOrDownKeyStroke:()=>Kc,RadioButtonKeyStroke:()=>vl,RadioButtonLayout:()=>Nc,Range:()=>B,RangeKeyStroke:()=>Yo,Reconnector:()=>td,Rectangle:()=>ie,RemoteApp:()=>jf,RemoteEvent:()=>ql,RemoteLookupCall:()=>Gl,RemoteLookupRequest:()=>js,RemoteTileFilter:()=>_h,ResetMenu:()=>Zm,Resizable:()=>Ee,ResponseQueue:()=>Kr,ResponsiveHandler:()=>xa,ResponsiveManager:()=>oe,RestLookupCall:()=>am,RoundingMode:()=>ns,Route:()=>qm,RouteChangeEvent:()=>lu,RowLayout:()=>Ri,SaveMenu:()=>eg,Scrollbar:()=>Jo,SearchOutline:()=>dy,SearchOutlineAdapter:()=>uy,SearchOutlineLayout:()=>Mf,SequenceBox:()=>wl,SequenceBoxAdapter:()=>d_,SequenceBoxGridConfig:()=>Gc,SequenceBoxLayout:()=>Uc,Session:()=>ii,ShrinkNavigationKeyStroke:()=>pf,SimpleLoadingSupport:()=>Wh,SimpleTab:()=>bh,SimpleTabArea:()=>Ni,SimpleTabAreaLayout:()=>vh,SimpleTabBox:()=>ea,SimpleTabBoxController:()=>Yr,SimpleTabBoxLayout:()=>cd,SimpleTabViewContentLayout:()=>pd,SingleLayout:()=>Es,Slider:()=>au,SliderAdapter:()=>Ym,SliderField:()=>u_,SliderLayout:()=>hu,SmartColumn:()=>mg,SmartField:()=>le,SmartFieldAdapter:()=>En,SmartFieldCancelKeyStroke:()=>qc,SmartFieldLayout:()=>ah,SmartFieldMultiline:()=>p_,SmartFieldMultilineAdapter:()=>f_,SmartFieldMultilineLayout:()=>Jc,SmartFieldPopup:()=>Tl,SmartFieldPopupLayout:()=>jc,SmartFieldTouchPopup:()=>c_,SplitBox:()=>ge,SplitBoxAdapter:()=>v_,SplitBoxCollapseKeyStroke:()=>np,SplitBoxFirstCollapseKeyStroke:()=>op,SplitBoxLayout:()=>ap,SplitBoxSecondCollapseKeyStroke:()=>lp,Splitter:()=>Js,StaticLookupCall:()=>Vn,Status:()=>E,StatusMenuMapping:()=>Dg,StatusMenuMappingAdapter:()=>Ag,StringField:()=>ki,StringFieldAdapter:()=>w_,StringFieldCtrlEnterKeyStroke:()=>up,StringFieldEnterKeyStroke:()=>dp,StringFieldLayout:()=>hp,SubCloseKeyStroke:()=>Ud,Switch:()=>k_,Tab:()=>ch,TabArea:()=>_s,TabAreaLayout:()=>_p,TabAreaLeftKeyStroke:()=>cp,TabAreaRightKeyStroke:()=>pp,TabBox:()=>yo,TabBoxAdapter:()=>T_,TabBoxHeader:()=>gp,TabBoxHeaderLayout:()=>mp,TabBoxLayout:()=>vp,TabItem:()=>wp,TabItemAdapter:()=>S_,TabItemKeyStroke:()=>md,TabItemLayout:()=>Tp,Table:()=>V,TableAdapter:()=>hn,TableCompactHandler:()=>yu,TableControl:()=>ps,TableControlActionKeyStroke:()=>Ou,TableControlAdapter:()=>Ma,TableControlAdapterMenu:()=>pn,TableControlCloseKeyStroke:()=>Uu,TableCopyKeyStroke:()=>qu,TableField:()=>Fn,TableFieldAdapter:()=>P_,TableFooter:()=>bu,TableFooterLayout:()=>vu,TableHeader:()=>wu,TableHeaderMenu:()=>yi,TableHeaderMenuButton:()=>dt,TableHeaderMenuGroup:()=>Ns,TableHeaderMenuLayout:()=>dn,TableInfoFilterTooltip:()=>ng,TableInfoLoadTooltip:()=>og,TableInfoSelectionTooltip:()=>lg,TableLayout:()=>Tu,TableLayoutResetter:()=>uh,TableMatrix:()=>Et,TableNavigationCollapseKeyStroke:()=>Yu,TableNavigationDownKeyStroke:()=>tc,TableNavigationEndKeyStroke:()=>sc,TableNavigationExpandKeyStroke:()=>ju,TableNavigationHomeKeyStroke:()=>ic,TableNavigationPageDownKeyStroke:()=>nc,TableNavigationPageUpKeyStroke:()=>rc,TableNavigationUpKeyStroke:()=>ec,TableProposalChooser:()=>y_,TableRefreshKeyStroke:()=>Qu,TableRow:()=>Xt,TableRowDetail:()=>Aa,TableRowTileMapping:()=>dg,TableRowTileMappingAdapter:()=>ug,TableSelectAllKeyStroke:()=>Xu,TableSelectionHandler:()=>Cu,TableStartCellEditKeyStroke:()=>Ju,TableTextUserFilter:()=>fs,TableTileGridMediator:()=>un,TableTileGridMediatorAdapter:()=>Su,TableToggleRowKeyStroke:()=>Zu,TableTooltip:()=>xu,TableUpdateBuffer:()=>Fu,TableUserFilter:()=>Qt,TagBar:()=>li,TagBarLayout:()=>Mp,TagBarOverflowPopup:()=>Sl,TagBarOverflowPopupLayout:()=>Ip,TagChooserPopup:()=>Cp,TagChooserPopupLayout:()=>Sp,TagField:()=>ph,TagFieldAdapter:()=>E_,TagFieldContainerLayout:()=>vo,TagFieldDeleteKeyStroke:()=>fh,TagFieldEnterKeyStroke:()=>Pp,TagFieldLayout:()=>Ep,TagFieldNavigationKeyStroke:()=>mh,TagFieldOpenPopupKeyStroke:()=>xp,TextColumnUserFilter:()=>Tg,TextMap:()=>Os,TextTableFilter:()=>Sg,Tile:()=>Vt,TileAccordion:()=>Vp,TileAccordionAdapter:()=>z_,TileAccordionLayout:()=>Wp,TileAccordionSelectionHandler:()=>zp,TileAdapter:()=>So,TileButton:()=>Pl,TileField:()=>A_,TileFieldAdapter:()=>$_,TileGrid:()=>$n,TileGridAdapter:()=>Op,TileGridGridConfig:()=>Bp,TileGridLayout:()=>lr,TileGridLayoutConfig:()=>Qi,TileGridSelectAllKeyStroke:()=>Kp,TileGridSelectDownKeyStroke:()=>qp,TileGridSelectFirstKeyStroke:()=>jp,TileGridSelectKeyStroke:()=>ar,TileGridSelectLastKeyStroke:()=>Xp,TileGridSelectLeftKeyStroke:()=>Gp,TileGridSelectRightKeyStroke:()=>Up,TileGridSelectUpKeyStroke:()=>Yp,TileGridSelectionHandler:()=>gh,TileHtmlField:()=>Y_,TileOutlineOverview:()=>Fl,TileOverviewForm:()=>Fa,TileOverviewFormAdapter:()=>sg,TileTableField:()=>j_,TileTableHeaderBox:()=>Vf,TileTableHeaderGroupByLookupCall:()=>Du,TileTableHeaderSortByLookupCall:()=>Au,TileTableHierarchyFilter:()=>oc,TileTextFilter:()=>xo,TimePicker:()=>Va,TimePickerPopup:()=>Wa,TimePickerPopupLayout:()=>lc,TimePickerTouchPopup:()=>za,Tooltip:()=>ls,TooltipSupport:()=>la,TouchPopup:()=>el,TouchPopupLayout:()=>ca,Tree:()=>pe,TreeAdapter:()=>uo,TreeBox:()=>M_,TreeBoxAdapter:()=>I_,TreeBoxLayout:()=>Fp,TreeBreadcrumbFilter:()=>hc,TreeCollapseAllKeyStroke:()=>uc,TreeCollapseOrDrillUpKeyStroke:()=>qa,TreeExpandOrDrillDownKeyStroke:()=>Ya,TreeField:()=>Dp,TreeFieldAdapter:()=>Ap,TreeLayout:()=>pl,TreeLayoutResetter:()=>rp,TreeNavigationDownKeyStroke:()=>Ga,TreeNavigationEndKeyStroke:()=>Ua,TreeNavigationUpKeyStroke:()=>Ka,TreeNode:()=>ir,TreeProposalChooser:()=>sp,TreeSet:()=>Vl,TreeSpaceKeyStroke:()=>dc,TreeVisitResult:()=>_e,TypeDescriptor:()=>Ts,URL:()=>vt,UnsavedFormChangesForm:()=>Mo,UnsavedFormsLookupCall:()=>Nf,UserAgent:()=>sd,UuidPool:()=>vs,UuidPoolAdapter:()=>Ty,ValidationFailedStatus:()=>Vo,ValueField:()=>me,ValueFieldAdapter:()=>Ot,VerticalGridMatrix:()=>Go,VerticalSmartGrid:()=>ad,ViewButton:()=>wf,ViewButtonActionKeyStroke:()=>bf,ViewButtonAdapter:()=>Tf,ViewButtonBox:()=>Fh,ViewMenuOpenKeyStroke:()=>Cf,ViewMenuPopup:()=>Sf,ViewMenuPopupEnterKeyStroke:()=>Pf,ViewMenuTab:()=>xf,ViewportScroller:()=>Ps,VirtualKeyStrokeEvent:()=>ta,VirtualScrolling:()=>wd,Widget:()=>I,WidgetEventTypeFilter:()=>rd,WidgetField:()=>Rg,WidgetFieldAdapter:()=>Mg,WidgetFieldLayout:()=>yc,WidgetPopup:()=>eo,WidgetPopupAdapter:()=>Pd,WidgetPopupLayout:()=>xd,WidgetSupport:()=>Ll,WidgetTile:()=>Jp,WidgetTileAdapter:()=>U_,WidgetTooltip:()=>Am,WizardProgressField:()=>L_,WizardProgressFieldAdapter:()=>O_,WizardProgressFieldLayout:()=>$p,WrappedFormField:()=>wo,WrappedFormFieldAdapter:()=>B_,YearPanel:()=>Ta,aggregation:()=>wt,ajax:()=>Fi,arrays:()=>p,clipboard:()=>rs,codes:()=>Tt,colorSchemes:()=>Rt,comparators:()=>mt,cookies:()=>zl,dates:()=>w,default:()=>Sy,defaultValues:()=>Ne,dragAndDrop:()=>Fe,events:()=>ot,fields:()=>Z,files:()=>qs,filters:()=>cr,focusUtils:()=>Yi,fonts:()=>bt,graphics:()=>v,icons:()=>ye,inspector:()=>Hn,isPropertyChangeEvent:()=>Yf,keyStrokeModifier:()=>Te,keys:()=>g,locales:()=>_t,logging:()=>ci,lookupField:()=>_o,menuNavigationKeyStrokes:()=>wr,menus:()=>We,mimeTypes:()=>lt,models:()=>ur,numbers:()=>Ke,objects:()=>b,promises:()=>nm,router:()=>jt,scout:()=>u,scrollbars:()=>P,strings:()=>y,styles:()=>M,texts:()=>Ce,tooltips:()=>K,webstorage:()=>Se,widgets:()=>Le});var $l={};Vi.r($l),Vi.d($l,{AbortKeyStroke:()=>ra,AbstractCompactTreeControlKeyStroke:()=>co,AbstractGrid:()=>Un,AbstractLayout:()=>ee,AbstractTableNavigationKeyStroke:()=>Ws,AbstractTreeNavigationKeyStroke:()=>sr,Accordion:()=>gd,AccordionAdapter:()=>_d,AccordionField:()=>Bg,AccordionFieldAdapter:()=>kg,AccordionLayout:()=>na,Action:()=>re,ActionAdapter:()=>br,ActionExecKeyStroke:()=>aa,ActionKeyStroke:()=>sn,AggregateTableControl:()=>Vs,AggregateTableControlAdapter:()=>ku,AjaxCall:()=>pr,AjaxError:()=>Wo,AlphanumericSortingStringColumn:()=>cg,App:()=>te,AppLinkKeyStroke:()=>po,AutoLeafPageWithNodes:()=>Df,BackgroundJobPollingStatus:()=>Ki,BackgroundJobPollingSupport:()=>Jh,BasicField:()=>fl,BasicFieldAdapter:()=>Ja,BeanColumn:()=>pg,BeanField:()=>Hg,BeanFieldAdapter:()=>Ng,BeanTile:()=>V_,BeanTileAdapter:()=>W_,BenchColumn:()=>ys,BenchColumnLayoutData:()=>Rn,BenchRowLayoutData:()=>lf,BooleanColumn:()=>cn,Box:()=>ha,BoxButtons:()=>Xo,BreadcrumbBar:()=>yy,BreadcrumbBarAdapter:()=>by,BreadcrumbBarField:()=>vy,BreadcrumbBarFieldAdapter:()=>wy,BreadcrumbBarLayout:()=>Kf,BreadcrumbItem:()=>zf,BreadcrumbItemAdapter:()=>gy,BrowserField:()=>bn,BrowserFieldAdapter:()=>Vg,BrowserFieldLayout:()=>Cc,BusyIndicator:()=>Qh,Button:()=>Re,ButtonAdapter:()=>Sc,ButtonAdapterMenu:()=>so,ButtonKeyStroke:()=>mo,ButtonLayout:()=>Za,ButtonTile:()=>Qp,CachedElement:()=>Nl,Calculator:()=>Hc,Calendar:()=>He,CalendarAdapter:()=>Nm,CalendarComponent:()=>ro,CalendarComponentAdapter:()=>Vm,CalendarField:()=>Wg,CalendarFieldAdapter:()=>zg,CalendarLayout:()=>tu,CalendarListComponent:()=>eu,CalendarModeMenu:()=>no,CalendarModesMenu:()=>iu,Call:()=>Bn,CancelMenu:()=>mu,Carousel:()=>Em,CarouselField:()=>Kg,CarouselLayout:()=>yd,Cell:()=>Pt,CellEditorCancelEditKeyStroke:()=>zu,CellEditorCompleteEditKeyStroke:()=>Ku,CellEditorPopup:()=>Nu,CellEditorPopupLayout:()=>Wu,CellEditorTabKeyStroke:()=>Gu,CheckBoxField:()=>Dr,CheckBoxFieldAdapter:()=>Gg,CheckBoxToggleKeyStroke:()=>eh,ClickActiveElementKeyStroke:()=>jo,ClipboardField:()=>Tn,ClipboardFieldAdapter:()=>Ug,CloseKeyStroke:()=>Xn,CloseMenu:()=>Qm,Code:()=>fm,CodeLookupCall:()=>Ul,CodeType:()=>Wn,CollapseHandle:()=>qi,ColorField:()=>qg,ColorFieldAdapter:()=>Yg,Column:()=>De,ColumnLayout:()=>ud,ColumnOptimalWidthMeasurer:()=>$u,ColumnUserFilter:()=>Ji,ComboMenu:()=>Vd,ComboMenuAdapter:()=>Om,CompactBean:()=>Mu,CompactColumn:()=>Ru,CompactLine:()=>Iu,CompactLineBlock:()=>cl,CompactTree:()=>Eg,CompactTreeDownKeyStroke:()=>fc,CompactTreeLeftKeyStroke:()=>mc,CompactTreeNode:()=>cc,CompactTreeRightKeyStroke:()=>gc,CompactTreeUpKeyStroke:()=>pc,Composite:()=>Qf,CompositeField:()=>Fr,CompositeFieldAdapter:()=>fo,CompositeTile:()=>Hp,ContextMenuKeyStroke:()=>ia,ContextMenuPopup:()=>ft,ContextMenuPopupLayout:()=>Wd,CopyKeyStroke:()=>Tc,DateColumn:()=>Lu,DateColumnUserFilter:()=>bg,DateField:()=>kt,DateFieldAdapter:()=>Cn,DateFormat:()=>xt,DateFormatPatternDefinition:()=>je,DateFormatPatternType:()=>Ye,DatePicker:()=>pa,DatePickerPopup:()=>fa,DatePickerPopupLayout:()=>Ad,DatePickerTouchPopup:()=>$d,DatePickerTouchPopupLayout:()=>Rd,DatePredictionFailedStatus:()=>th,DateRange:()=>Ve,DateTimeCompositeLayout:()=>Pc,DecimalFormat:()=>Ls,DefaultStatus:()=>Wr,DeferredGlassPaneTarget:()=>Qr,Desktop:()=>Ie,DesktopAdapter:()=>X_,DesktopBench:()=>Ci,DesktopFormController:()=>kf,DesktopHeader:()=>hf,DesktopHeaderLayout:()=>uf,DesktopLayout:()=>ef,DesktopLogo:()=>Zp,DesktopNavigation:()=>Wt,DesktopNavigationHandle:()=>Ph,DesktopNavigationLayout:()=>cf,DesktopNotification:()=>ti,DesktopNotificationAdapter:()=>ey,DesktopResponsiveHandler:()=>ig,DesktopTab:()=>tf,DesktopTabArea:()=>wh,DesktopTabAreaLayout:()=>sf,DesktopTabBoxController:()=>Th,DesktopTabSelectKeyStroke:()=>rf,DesktopToolBox:()=>Eh,DetailTableTreeFilter:()=>Af,Device:()=>x,DialogLayout:()=>ds,Dimension:()=>F,DisableBrowserF5ReloadKeyStroke:()=>nf,DisableBrowserTabSwitchingKeyStroke:()=>af,DoubleClickSupport:()=>Vr,DragAndDropHandler:()=>Kh,EllipsisMenu:()=>tl,EllipsisTabMenu:()=>yp,EnlargeNavigationKeyStroke:()=>ff,ErrorHandler:()=>Nr,Event:()=>Kt,EventDelegator:()=>is,EventEmitter:()=>ts,EventSupport:()=>Bo,Extension:()=>Jf,FieldStatus:()=>ja,FileChooser:()=>Km,FileChooserAdapter:()=>Gm,FileChooserButton:()=>jg,FileChooserButtonAdapter:()=>Xg,FileChooserController:()=>ll,FileChooserField:()=>Jg,FileChooserFieldAdapter:()=>_l,FileChooserFieldBrowseKeyStroke:()=>Ec,FileChooserFieldDeleteKeyStroke:()=>Fc,FileInput:()=>_i,FilterFieldsGroupBox:()=>Hf,FilterSupport:()=>On,FlexboxLayout:()=>Xs,FlexboxLayoutData:()=>yr,FocusAdjacentElementKeyStroke:()=>sa,FocusContext:()=>oa,FocusFilterFieldKeyStroke:()=>Ol,FocusManager:()=>bd,FocusRule:()=>Mt,Form:()=>U,FormAdapter:()=>Sa,FormController:()=>ml,FormField:()=>A,FormFieldAdapter:()=>at,FormFieldLayout:()=>oi,FormFieldMenu:()=>Bm,FormFieldMenuAdapter:()=>km,FormFieldTile:()=>Hi,FormFieldTileAdapter:()=>q_,FormGrid:()=>cu,FormLayout:()=>hl,FormLifecycle:()=>fu,FormLifecycleMenu:()=>an,FormMenu:()=>Hs,FormMenuActionKeyStroke:()=>pu,FormMenuAdapter:()=>Jm,FormTableControl:()=>_g,FormTableControlAdapter:()=>yg,FormTableControlLayout:()=>Hu,GlassPane:()=>Fm,GlassPaneRenderer:()=>Zr,GridData:()=>ze,Group:()=>mi,GroupAdapter:()=>Lm,GroupBox:()=>xe,GroupBoxAdapter:()=>Ac,GroupBoxGridConfig:()=>Dc,GroupBoxLayout:()=>ih,GroupBoxMenuItemsOrder:()=>nr,GroupBoxResponsiveHandler:()=>lo,GroupLayout:()=>Md,GroupToggleCollapseKeyStroke:()=>Id,HAlign:()=>ht,HeaderTabBoxController:()=>df,HierarchicalLookupResultBuilder:()=>Xh,HorizontalGrid:()=>Gr,HorizontalGridMatrix:()=>hd,HtmlComponent:()=>T,HtmlEncoder:()=>Uh,HtmlEnvironment:()=>de,HtmlField:()=>Mc,HtmlFieldAdapter:()=>Qg,HtmlTile:()=>Np,HtmlTileAdapter:()=>N_,HybridManager:()=>Sh,HybridManagerAdapter:()=>Z_,IFrame:()=>vd,Icon:()=>Zs,IconColumn:()=>Ra,IconDesc:()=>ni,Image:()=>ga,ImageField:()=>Ar,ImageFieldAdapter:()=>Zg,ImageFieldLayout:()=>Ic,ImageLayout:()=>Od,InputFieldKeyStrokeContext:()=>As,Insets:()=>Ge,IntegerField:()=>xn,JsFormAdapter:()=>rg,Key:()=>qo,KeyStroke:()=>O,KeyStrokeContext:()=>Oe,KeyStrokeManager:()=>fd,KeyTableFilter:()=>Cg,Label:()=>da,LabelAdapter:()=>$m,LabelField:()=>sh,LabelFieldAdapter:()=>e_,LayoutConstants:()=>Ui,LayoutValidator:()=>nd,LazyNodeFilter:()=>ac,Lifecycle:()=>su,ListBox:()=>rh,ListBoxAdapter:()=>t_,ListBoxLayout:()=>Oc,LoadingSupport:()=>ss,Locale:()=>qt,LogLevel:()=>qe,LogicalGrid:()=>Ql,LogicalGridConfig:()=>gr,LogicalGridData:()=>xs,LogicalGridLayout:()=>Gn,LogicalGridLayoutConfig:()=>si,LogicalGridLayoutInfo:()=>ld,LogicalGridMatrix:()=>Zl,LogicalGridMatrixCell:()=>qn,LogicalGridMatrixCursor:()=>$i,LoginApp:()=>fy,LoginBox:()=>Dl,LogoutApp:()=>my,LogoutBox:()=>Wf,LookupBox:()=>yn,LookupBoxLayout:()=>Qa,LookupCall:()=>Ut,LookupFieldAdapter:()=>nh,LookupRow:()=>Ys,MaxLengthHandler:()=>Ho,Menu:()=>ne,MenuAdapter:()=>il,MenuBar:()=>ce,MenuBarBox:()=>va,MenuBarBoxLayout:()=>Zd,MenuBarLayout:()=>er,MenuBarLeftKeyStroke:()=>Xd,MenuBarPopup:()=>Qd,MenuBarRightKeyStroke:()=>Jd,MenuBox:()=>qd,MenuBoxLayout:()=>Yd,MenuDestinations:()=>It,MenuExecByNumberKeyStroke:()=>zd,MenuExecKeyStroke:()=>Nd,MenuItemsOrder:()=>io,MenuKeyStroke:()=>Hd,MenuNavigationDownKeyStroke:()=>Kd,MenuNavigationExecKeyStroke:()=>nl,MenuNavigationKeyStroke:()=>rl,MenuNavigationUpKeyStroke:()=>Gd,MessageBox:()=>vi,MessageBoxAdapter:()=>Ig,MessageBoxController:()=>gl,MessageBoxLayout:()=>wc,MessageBoxes:()=>rr,MobilePopup:()=>Fd,MobilePopupAdapter:()=>Mm,MobilePopupLayout:()=>Dd,Mode:()=>jm,ModeAdapter:()=>Xm,ModeSelector:()=>du,ModeSelectorField:()=>i_,ModeSelectorFieldAdapter:()=>s_,ModeSelectorLayout:()=>uu,ModelAdapter:()=>ke,NavigateButton:()=>$o,NavigateDownButton:()=>Rh,NavigateUpButton:()=>Mh,Notification:()=>Bd,NotificationAdapter:()=>kd,NotificationBadgeStatus:()=>Ss,NullLayout:()=>Yn,NullLogger:()=>Hl,NullWidget:()=>Bl,NullWidgetAdapter:()=>Zf,NumberColumn:()=>Bi,NumberColumnUserFilter:()=>vg,NumberField:()=>Pn,NumberFieldAdapter:()=>kc,ObjectFactory:()=>At,OfflineDesktopNotification:()=>gf,OkMenu:()=>gu,OpenUriHandler:()=>of,Outline:()=>bs,OutlineAdapter:()=>dr,OutlineKeyStrokeContext:()=>If,OutlineLayout:()=>Ah,OutlineMediator:()=>$f,OutlineNavigateToTopKeyStroke:()=>Lf,OutlineOverview:()=>Ih,OutlineTileField:()=>ly,OutlineTileFieldAdapter:()=>ay,OutlineViewButton:()=>$h,OutlineViewButtonAdapter:()=>ny,Page:()=>ai,PageLayout:()=>Rf,PageTileButton:()=>Ef,PageTileGrid:()=>Dh,PageTileGridSelectKeyStroke:()=>Ff,PageWithNodes:()=>iy,PageWithTable:()=>sy,ParsingFailedStatus:()=>pi,PlaceholderField:()=>lh,PlaceholderFieldAdapter:()=>n_,PlaceholderTile:()=>Ti,PlainTextEncoder:()=>Gh,Planner:()=>ae,PlannerAdapter:()=>Tr,PlannerField:()=>o_,PlannerFieldAdapter:()=>l_,PlannerHeader:()=>ru,PlannerLayout:()=>nu,PlannerMenuItemsOrder:()=>ou,Point:()=>X,Popup:()=>ue,PopupAdapter:()=>Sd,PopupBlockerDesktopNotification:()=>yf,PopupBlockerHandler:()=>Do,PopupLayout:()=>Ii,PopupManager:()=>ua,PopupManagerAdapter:()=>Rm,PopupWindow:()=>Lr,PrepopulatedLookupCall:()=>cm,PromiseCreator:()=>rm,PropertyChangeEventFilter:()=>ed,PropertyEventEmitter:()=>Ml,ProposalChooser:()=>dh,ProposalChooserLayout:()=>tp,ProposalField:()=>Qc,ProposalFieldAdapter:()=>g_,ProposalTreeNode:()=>ep,QueryBy:()=>fe,RadioButton:()=>bl,RadioButtonAdapter:()=>a_,RadioButtonGroup:()=>or,RadioButtonGroupAdapter:()=>h_,RadioButtonGroupGridConfig:()=>Vc,RadioButtonGroupLayout:()=>Wc,RadioButtonGroupLeftOrUpKeyStroke:()=>zc,RadioButtonGroupRightOrDownKeyStroke:()=>Kc,RadioButtonKeyStroke:()=>vl,RadioButtonLayout:()=>Nc,Range:()=>B,RangeKeyStroke:()=>Yo,Reconnector:()=>td,Rectangle:()=>ie,RemoteApp:()=>jf,RemoteEvent:()=>ql,RemoteLookupCall:()=>Gl,RemoteLookupRequest:()=>js,RemoteTileFilter:()=>_h,ResetMenu:()=>Zm,Resizable:()=>Ee,ResponseQueue:()=>Kr,ResponsiveHandler:()=>xa,ResponsiveManager:()=>oe,RestLookupCall:()=>am,RoundingMode:()=>ns,Route:()=>qm,RouteChangeEvent:()=>lu,RowLayout:()=>Ri,SaveMenu:()=>eg,Scrollbar:()=>Jo,SearchOutline:()=>dy,SearchOutlineAdapter:()=>uy,SearchOutlineLayout:()=>Mf,SequenceBox:()=>wl,SequenceBoxAdapter:()=>d_,SequenceBoxGridConfig:()=>Gc,SequenceBoxLayout:()=>Uc,Session:()=>ii,ShrinkNavigationKeyStroke:()=>pf,SimpleLoadingSupport:()=>Wh,SimpleTab:()=>bh,SimpleTabArea:()=>Ni,SimpleTabAreaLayout:()=>vh,SimpleTabBox:()=>ea,SimpleTabBoxController:()=>Yr,SimpleTabBoxLayout:()=>cd,SimpleTabViewContentLayout:()=>pd,SingleLayout:()=>Es,Slider:()=>au,SliderAdapter:()=>Ym,SliderField:()=>u_,SliderLayout:()=>hu,SmartColumn:()=>mg,SmartField:()=>le,SmartFieldAdapter:()=>En,SmartFieldCancelKeyStroke:()=>qc,SmartFieldLayout:()=>ah,SmartFieldMultiline:()=>p_,SmartFieldMultilineAdapter:()=>f_,SmartFieldMultilineLayout:()=>Jc,SmartFieldPopup:()=>Tl,SmartFieldPopupLayout:()=>jc,SmartFieldTouchPopup:()=>c_,SplitBox:()=>ge,SplitBoxAdapter:()=>v_,SplitBoxCollapseKeyStroke:()=>np,SplitBoxFirstCollapseKeyStroke:()=>op,SplitBoxLayout:()=>ap,SplitBoxSecondCollapseKeyStroke:()=>lp,Splitter:()=>Js,StaticLookupCall:()=>Vn,Status:()=>E,StatusMenuMapping:()=>Dg,StatusMenuMappingAdapter:()=>Ag,StringField:()=>ki,StringFieldAdapter:()=>w_,StringFieldCtrlEnterKeyStroke:()=>up,StringFieldEnterKeyStroke:()=>dp,StringFieldLayout:()=>hp,SubCloseKeyStroke:()=>Ud,Switch:()=>k_,Tab:()=>ch,TabArea:()=>_s,TabAreaLayout:()=>_p,TabAreaLeftKeyStroke:()=>cp,TabAreaRightKeyStroke:()=>pp,TabBox:()=>yo,TabBoxAdapter:()=>T_,TabBoxHeader:()=>gp,TabBoxHeaderLayout:()=>mp,TabBoxLayout:()=>vp,TabItem:()=>wp,TabItemAdapter:()=>S_,TabItemKeyStroke:()=>md,TabItemLayout:()=>Tp,Table:()=>V,TableAdapter:()=>hn,TableCompactHandler:()=>yu,TableControl:()=>ps,TableControlActionKeyStroke:()=>Ou,TableControlAdapter:()=>Ma,TableControlAdapterMenu:()=>pn,TableControlCloseKeyStroke:()=>Uu,TableCopyKeyStroke:()=>qu,TableField:()=>Fn,TableFieldAdapter:()=>P_,TableFooter:()=>bu,TableFooterLayout:()=>vu,TableHeader:()=>wu,TableHeaderMenu:()=>yi,TableHeaderMenuButton:()=>dt,TableHeaderMenuGroup:()=>Ns,TableHeaderMenuLayout:()=>dn,TableInfoFilterTooltip:()=>ng,TableInfoLoadTooltip:()=>og,TableInfoSelectionTooltip:()=>lg,TableLayout:()=>Tu,TableLayoutResetter:()=>uh,TableMatrix:()=>Et,TableNavigationCollapseKeyStroke:()=>Yu,TableNavigationDownKeyStroke:()=>tc,TableNavigationEndKeyStroke:()=>sc,TableNavigationExpandKeyStroke:()=>ju,TableNavigationHomeKeyStroke:()=>ic,TableNavigationPageDownKeyStroke:()=>nc,TableNavigationPageUpKeyStroke:()=>rc,TableNavigationUpKeyStroke:()=>ec,TableProposalChooser:()=>y_,TableRefreshKeyStroke:()=>Qu,TableRow:()=>Xt,TableRowDetail:()=>Aa,TableRowTileMapping:()=>dg,TableRowTileMappingAdapter:()=>ug,TableSelectAllKeyStroke:()=>Xu,TableSelectionHandler:()=>Cu,TableStartCellEditKeyStroke:()=>Ju,TableTextUserFilter:()=>fs,TableTileGridMediator:()=>un,TableTileGridMediatorAdapter:()=>Su,TableToggleRowKeyStroke:()=>Zu,TableTooltip:()=>xu,TableUpdateBuffer:()=>Fu,TableUserFilter:()=>Qt,TagBar:()=>li,TagBarLayout:()=>Mp,TagBarOverflowPopup:()=>Sl,TagBarOverflowPopupLayout:()=>Ip,TagChooserPopup:()=>Cp,TagChooserPopupLayout:()=>Sp,TagField:()=>ph,TagFieldAdapter:()=>E_,TagFieldContainerLayout:()=>vo,TagFieldDeleteKeyStroke:()=>fh,TagFieldEnterKeyStroke:()=>Pp,TagFieldLayout:()=>Ep,TagFieldNavigationKeyStroke:()=>mh,TagFieldOpenPopupKeyStroke:()=>xp,TextColumnUserFilter:()=>Tg,TextMap:()=>Os,TextTableFilter:()=>Sg,Tile:()=>Vt,TileAccordion:()=>Vp,TileAccordionAdapter:()=>z_,TileAccordionLayout:()=>Wp,TileAccordionSelectionHandler:()=>zp,TileAdapter:()=>So,TileButton:()=>Pl,TileField:()=>A_,TileFieldAdapter:()=>$_,TileGrid:()=>$n,TileGridAdapter:()=>Op,TileGridGridConfig:()=>Bp,TileGridLayout:()=>lr,TileGridLayoutConfig:()=>Qi,TileGridSelectAllKeyStroke:()=>Kp,TileGridSelectDownKeyStroke:()=>qp,TileGridSelectFirstKeyStroke:()=>jp,TileGridSelectKeyStroke:()=>ar,TileGridSelectLastKeyStroke:()=>Xp,TileGridSelectLeftKeyStroke:()=>Gp,TileGridSelectRightKeyStroke:()=>Up,TileGridSelectUpKeyStroke:()=>Yp,TileGridSelectionHandler:()=>gh,TileHtmlField:()=>Y_,TileOutlineOverview:()=>Fl,TileOverviewForm:()=>Fa,TileOverviewFormAdapter:()=>sg,TileTableField:()=>j_,TileTableHeaderBox:()=>Vf,TileTableHeaderGroupByLookupCall:()=>Du,TileTableHeaderSortByLookupCall:()=>Au,TileTableHierarchyFilter:()=>oc,TileTextFilter:()=>xo,TimePicker:()=>Va,TimePickerPopup:()=>Wa,TimePickerPopupLayout:()=>lc,TimePickerTouchPopup:()=>za,Tooltip:()=>ls,TooltipSupport:()=>la,TouchPopup:()=>el,TouchPopupLayout:()=>ca,Tree:()=>pe,TreeAdapter:()=>uo,TreeBox:()=>M_,TreeBoxAdapter:()=>I_,TreeBoxLayout:()=>Fp,TreeBreadcrumbFilter:()=>hc,TreeCollapseAllKeyStroke:()=>uc,TreeCollapseOrDrillUpKeyStroke:()=>qa,TreeExpandOrDrillDownKeyStroke:()=>Ya,TreeField:()=>Dp,TreeFieldAdapter:()=>Ap,TreeLayout:()=>pl,TreeLayoutResetter:()=>rp,TreeNavigationDownKeyStroke:()=>Ga,TreeNavigationEndKeyStroke:()=>Ua,TreeNavigationUpKeyStroke:()=>Ka,TreeNode:()=>ir,TreeProposalChooser:()=>sp,TreeSet:()=>Vl,TreeSpaceKeyStroke:()=>dc,TreeVisitResult:()=>_e,TypeDescriptor:()=>Ts,URL:()=>vt,UnsavedFormChangesForm:()=>Mo,UnsavedFormsLookupCall:()=>Nf,UserAgent:()=>sd,UuidPool:()=>vs,UuidPoolAdapter:()=>Ty,ValidationFailedStatus:()=>Vo,ValueField:()=>me,ValueFieldAdapter:()=>Ot,VerticalGridMatrix:()=>Go,VerticalSmartGrid:()=>ad,ViewButton:()=>wf,ViewButtonActionKeyStroke:()=>bf,ViewButtonAdapter:()=>Tf,ViewButtonBox:()=>Fh,ViewMenuOpenKeyStroke:()=>Cf,ViewMenuPopup:()=>Sf,ViewMenuPopupEnterKeyStroke:()=>Pf,ViewMenuTab:()=>xf,ViewportScroller:()=>Ps,VirtualKeyStrokeEvent:()=>ta,VirtualScrolling:()=>wd,Widget:()=>I,WidgetEventTypeFilter:()=>rd,WidgetField:()=>Rg,WidgetFieldAdapter:()=>Mg,WidgetFieldLayout:()=>yc,WidgetPopup:()=>eo,WidgetPopupAdapter:()=>Pd,WidgetPopupLayout:()=>xd,WidgetSupport:()=>Ll,WidgetTile:()=>Jp,WidgetTileAdapter:()=>U_,WidgetTooltip:()=>Am,WizardProgressField:()=>L_,WizardProgressFieldAdapter:()=>O_,WizardProgressFieldLayout:()=>$p,WrappedFormField:()=>wo,WrappedFormFieldAdapter:()=>B_,YearPanel:()=>Ta,aggregation:()=>wt,ajax:()=>Fi,arrays:()=>p,clipboard:()=>rs,codes:()=>Tt,colorSchemes:()=>Rt,comparators:()=>mt,cookies:()=>zl,dates:()=>w,default:()=>Sy,defaultValues:()=>Ne,dragAndDrop:()=>Fe,events:()=>ot,fields:()=>Z,files:()=>qs,filters:()=>cr,focusUtils:()=>Yi,fonts:()=>bt,graphics:()=>v,icons:()=>ye,inspector:()=>Hn,isPropertyChangeEvent:()=>Yf,keyStrokeModifier:()=>Te,keys:()=>g,locales:()=>_t,logging:()=>ci,lookupField:()=>_o,menuNavigationKeyStrokes:()=>wr,menus:()=>We,mimeTypes:()=>lt,models:()=>ur,numbers:()=>Ke,objects:()=>b,promises:()=>nm,router:()=>jt,scout:()=>u,scrollbars:()=>P,strings:()=>y,styles:()=>M,texts:()=>Ce,tooltips:()=>K,webstorage:()=>Se,widgets:()=>Le});const Dt=jQuery;var a=Vi.n(Dt);function Oo(i,e,t){return e=Py(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Py(i){var e=xy(i,"string");return typeof e=="symbol"?e:String(e)}function xy(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class At{constructor(){Oo(this,"uniqueIdSeqNo",void 0),Oo(this,"_registry",void 0),Oo(this,"_objectTypeMap",void 0),this.uniqueIdSeqNo=0,this._registry=new Map,this._objectTypeMap=new Map}_createObjectByType(e,t){if(typeof e!="string"&&typeof e!="function")throw new Error("missing or invalid object type");t=t||{};let s=null,r=null;if(typeof e=="string")r=Ts.parse(e),s=r.resolve(t);else if(typeof e=="function")s=e;else throw new Error("Invalid objectType "+e);let n=this.get(s||e);if(n){let o=n(t.model);if(!o)throw new Error('Failed to create object for objectType "'+e+'": Factory function did not return a valid object');return o}if(!s&&r)throw r.notFoundError();return new s(t.model)}create(e,t,s){let r,n;if(typeof e=="string"||typeof e=="function")s=s||{},n=t,r=e;else if(b.isPlainObject(e)){if(s=t||{},n=e,!n.objectType)throw new Error('Missing mandatory property "objectType" on model');r=n.objectType}else throw new Error("Invalid arguments");s.model=n;let o=this._createObjectByType(r,s);return b.isFunction(o.init)&&(n&&(n.id===void 0&&u.nvl(s.ensureUniqueId,!0)&&(n.id=this.createUniqueId()),n.objectType=this.getObjectType(r)),o.init(n)),o.id===void 0&&u.nvl(s.ensureUniqueId,!0)&&(o.id=this.createUniqueId()),o.objectType===void 0&&(o.objectType=this.getObjectType(r)),o}createUniqueId(){return"ui"+(++this.uniqueIdSeqNo).toString()}resolveTypedObjectType(e){if(typeof e!="string")return e;let t=Ts.resolveType(e);return t||e}register(e,t){e=this.resolveTypedObjectType(e),this._registry.set(e,t),a().log.isDebugEnabled()&&a().log.debug("(ObjectFactory) registered create-function for objectType "+e)}unregister(e){e=this.resolveTypedObjectType(e),this._registry.delete(e),a().log.isDebugEnabled()&&a().log.debug("(ObjectFactory) unregistered objectType "+e)}get(e){return e=this.resolveTypedObjectType(e),this._registry.get(e)}getObjectType(e){return typeof e=="string"?e:this._objectTypeMap.get(e)}init(){for(let[e,t]of u.objectFactories)this.register(e,t)}registerNamespace(e,t,s){s=a().extend({allowedReplacements:[]},s),window[e]=window[e]||{};let r=e==="scout"?"":e+".";for(let[n,o]of Object.entries(t))if(n!=="default"){if(window[e][n]&&!s.allowedReplacements.includes(n))throw new Error("".concat(n," is already registered on namespace ").concat(e||"scout",". Use objectFactories if you want to replace the existing obj."));window[e][n]=o,!(!o.prototype||n[0].toUpperCase()!==n[0])&&this._objectTypeMap.set(o,r+n)}}static get(){return Uf}static _set(e){Uf=e}}Oo(At,"NAMESPACE_SEPARATOR","."),Oo(At,"MODEL_VARIANT_SEPARATOR",":");let Uf=new At,Rl=null;function Ey(i,e,t){return At.get().create(i,e,t)}function Fy(i,e){if(b.isNullOrUndefined(i))return null;let t=i;if(typeof i=="string"||typeof i=="number"){let s=typeof e=="string"?e:null,r=u.getSession(s);if(r){let n=y.asString(i);return r.root.widget(n)}}return Le.get(t)}const u={objectFactories:new Map,nvl(){let i;for(let e=0;e<arguments.length&&(i=e<0||arguments.length<=e?void 0:arguments[e],i==null);e++);return i},assertParameter(i,e,t){if(b.isNullOrUndefined(e))throw new Error("Missing required parameter '"+i+"'");if(t&&!(e instanceof t))throw new Error("Parameter '"+i+"' has wrong type");return e},assertProperty(i,e,t){let s=i[e];if(b.isNullOrUndefined(s))throw new Error("Missing required property '"+e+"'");if(t&&!(s instanceof t))throw new Error("Property '"+e+"' has wrong type");return s},assertValue(i,e){if(b.isNullOrUndefined(i))throw new Error(e||"Missing value");return i},assertInstance(i,e,t){if(!(i instanceof e))throw new Error(t||"Value has wrong type");return i},isOneOf(i){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];if(t.length===0)return!1;let r=t;return t.length===1&&Array.isArray(t[0])&&(r=t[0]),r.indexOf(i)!==-1},create:Ey,prepareDOM(i){if(i=i||document,a()("noscript",i).remove(),a()("scout-text",i).remove(),a()("scout-version",i).remove(),a()("body",i).addDeviceClass(),x.get().browser===x.Browser.CHROME){let e='<meta name="google" content="notranslate" />',t=a()("head > title",i);t.length===0?a()("head",i).append(e):t.after(e)}},installGlobalMouseDownInterceptor(i){i.addEventListener("mousedown",e=>{me.invokeValueFieldAboutToBlurByMouseDown(e.target)},!0)},installSyntheticActiveStateHandler(i){x.get().requiresSyntheticActiveState()&&(Rl=[],a()(i).on("mousedown",e=>{let t=a()(e.target);for(;t.length;)Rl.push(t.addClass("active")),t=t.parent()}).on("mouseup",()=>{Rl.forEach(e=>{e.removeClass("active")}),Rl=[]}))},widget:Fy,adapter(i,e){if(b.isNullOrUndefined(i))return null;let t=u.getSession(e);return t&&t.modelAdapterRegistry?t.modelAdapterRegistry[i]:null},getSession(i){let e=te.get().sessions;if(!e)return null;if(b.isNullOrUndefined(i))return e[0];for(let t=0;t<e.length;t++){let s=e[t];if(s.partId==i)return s}return null},exportAdapter(i,e){let t=u.getSession(e);if(t&&t.modelAdapterRegistry){let n=t.getModelAdapter(i);if(!n)return null;let o=s(i);return r(n,o),o.type="model",o}function s(n){let o=t.getAdapterData(n);return o=a().extend(!0,{},o),o}function r(n,o){let l,h;n.widget._widgetProperties.forEach(d=>{let c=o[d];if(!!c)if(Array.isArray(c)){let f=[];c.forEach(m=>{l=t.getModelAdapter(m),h=s(m),r(l,h),f.push(h)}),o[d]=f}else l=t.getModelAdapter(c),h=s(c),r(l,h),o[d]=h}),o=n.exportAdapterData(o)}return null},reloadPage(i){i=i||{},i.schedule?setTimeout(e):e();function e(){u.nvl(i.clearBody,!0)&&a()("body").html(""),i.redirectUrl?window.location.href=i.redirectUrl:window.location.reload()}},addObjectFactories(i){for(let[e,t]of Object.entries(i))u.addObjectFactory(e,t)},addObjectFactory(i,e){u.objectFactories.set(i,e)},cloneShallow(i,e,t){u.assertParameter("template",i);let s=Object.create(Object.getPrototypeOf(i));if(Object.getOwnPropertyNames(i).forEach(r=>{s[r]=i[r]}),e)for(let r in e)s[r]=e[r];return u.nvl(t,!0)&&(s.id=At.get().createUniqueId()),s.cloneOf===void 0&&(s.cloneOf=i),s}};function kh(i,e,t){return e=Dy(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Dy(i){var e=Ay(i,"string");return typeof e=="symbol"?e:String(e)}function Ay(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Kt{constructor(e){kh(this,"source",void 0),kh(this,"defaultPrevented",void 0),kh(this,"type",void 0),this.defaultPrevented=!1,a().extend(this,e)}preventDefault(){this.defaultPrevented=!0}}function $y(i,e,t){return e=Ry(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Ry(i){var e=My(i,"string");return typeof e=="symbol"?e:String(e)}function My(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ts{constructor(){$y(this,"events",void 0),this.events=this._createEventSupport()}_createEventSupport(){return new Bo}trigger(e,t){let s;return t instanceof Kt?s=t:s=new Kt(t),s.source=this,this.events.trigger(e,s),s}one(e,t){this.events.one(e,t)}on(e,t){return this.events.on(e,t)}off(e,t){this.events.off(e,t)}when(e){return this.events.when(e)}addListener(e){this.events.addListener(e)}removeListener(e){this.events.removeListener(e)}}class Ml extends ts{constructor(){super(),this.events.registerSubTypePredicate("propertyChange",(e,t)=>e.propertyName===t)}setProperty(e,t){return b.equals(this[e],t)?!1:(this._callSetProperty(e,t),!0)}_callSetProperty(e,t){let s="_set"+y.toUpperCaseFirstLetter(e);this[s]?this[s](t):this._setProperty(e,t)}_setProperty(e,t){u.assertParameter("propertyName",e);let s=this[e];return b.equals(s,t)?!1:(this[e]=t,this.triggerPropertyChange(e,s,t).defaultPrevented?(this[e]=s,!1):!0)}triggerPropertyChange(e,t,s){return u.assertParameter("propertyName",e),this.trigger("propertyChange",{propertyName:e,oldValue:t,newValue:s})}callSetter(e,t){let s="set"+y.toUpperCaseFirstLetter(e);this[s]?this[s](t):this.setProperty(e,t)}}function qf(i,e,t){return e=Iy(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Iy(i){var e=Ly(i,"string");return typeof e=="symbol"?e:String(e)}function Ly(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Bo{constructor(){qf(this,"_eventListeners",void 0),qf(this,"_subTypePredicates",void 0),this._eventListeners=[],this._subTypePredicates=b.createMap()}_assertFunc(e){if(!e)throw new Error("Missing callback function")}on(e,t,s){this._assertFunc(t);let r={type:e,func:t,origFunc:s};return this.addListener(r),r}one(e,t){this._assertFunc(t);let s=r=>{this.off(e,s),t(r)};return this.on(e,s,t)}off(e,t){if(!(!e&&!t))for(let s=this._eventListeners.length-1;s>=0;s--){let r=this._eventListeners[s],n=t===r.func||t===r.origFunc,o=e===r.type,l=!1;t&&e?l=n&&o:t?l=n:l=o,l&&this._eventListeners.splice(s,1)}}when(e){let t=a().Deferred();return this.one(e,t.resolve.bind(t)),t.promise()}addListener(e){this._eventListeners.push(e)}removeListener(e){p.remove(this._eventListeners,e)}count(e,t){let s=0;return this._eventListeners.forEach(r=>{e&&e!==r.type||t&&t!==r.func||s++}),s}trigger(e,t){t=t||{},t.type=e;let s=this._eventListeners.slice();for(let r=0;r<s.length;r++){let n=s[r];(!n.type||this._typeMatches(t,n.type))&&n.func(t)}}_typeMatches(e,t){let s=e.type,r=t.split(" ");for(let n=0;n<r.length;n++)if(s===r[n]||this._subTypeMatches(e,r[n]))return!0;return!1}_subTypeMatches(e,t){if(t.indexOf(":")<0)return!1;let s=t.split(":"),r=s[0],n=s[1],o=this._subTypePredicates[r];if(!!o)return o(e,n)}registerSubTypePredicate(e,t){u.assertParameter("type",e),u.assertParameter("predicate",t),this._subTypePredicates[e]=t}}function ws(i,e,t){return e=Oy(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Oy(i){var e=By(i,"string");return typeof e=="symbol"?e:String(e)}function By(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class is{constructor(e,t,s){ws(this,"source",void 0),ws(this,"target",void 0),ws(this,"callSetter",void 0),ws(this,"delegateProperties",void 0),ws(this,"excludeProperties",void 0),ws(this,"delegateEvents",void 0),ws(this,"delegateAllProperties",void 0),ws(this,"delegateAllEvents",void 0),ws(this,"_mirrorListener",void 0),ws(this,"_destroyHandler",void 0),s=s||{},this.source=e,this.target=t,this.callSetter=u.nvl(s.callSetter,!0),this.delegateProperties=s.delegateProperties||[],this.excludeProperties=s.excludeProperties||[],this.delegateEvents=s.delegateEvents||[],this.delegateAllProperties=!!s.delegateAllProperties,this.delegateAllEvents=!!s.delegateAllEvents,this._mirrorListener=null,this._destroyHandler=null,this._installSourceListener()}destroy(){this._uninstallSourceListener()}_installSourceListener(){if(this._mirrorListener)throw new Error("source listeners already installed.");this._mirrorListener={func:this._onSourceEvent.bind(this)},this.source.events.addListener(this._mirrorListener),this._destroyHandler=this._uninstallSourceListener.bind(this),this.source.on("destroy",this._destroyHandler),this.target.on("destroy",this._destroyHandler)}_uninstallSourceListener(){this._mirrorListener&&(this.source.events.removeListener(this._mirrorListener),this._mirrorListener=null),this._destroyHandler&&(this.source.off("destroy",this._destroyHandler),this.target.off("destroy",this._destroyHandler),this._destroyHandler=null)}_onSourceEvent(e){e.type==="propertyChange"?this._onSourcePropertyChange(e):(this.delegateAllEvents||this.delegateEvents.indexOf(e.type)>-1)&&this.target.trigger(e.type,e)}_onSourcePropertyChange(e){if(!(this.excludeProperties.indexOf(e.propertyName)>-1)&&(this.delegateAllProperties||this.delegateProperties.indexOf(e.propertyName)>-1)){if(is.equalsProperty(e.propertyName,this.target,e.newValue))return;this.callSetter?this.target.callSetter(e.propertyName,e.newValue):this.target.trigger(e.type,e)}}static equalsProperty(e,t,s){let r=t[e];return Array.isArray(s)&&Array.isArray(r)?p.equals(s,r):b.equals(r,s)}static create(e,t,s){return s.delegateProperties&&s.delegateProperties.length>0||s.delegateEvents&&s.delegateEvents.length>0||s.delegateAllProperties||s.delegateAllEvents?new is(e,t,s):null}}function Yf(i){return i instanceof Kt&&!!i.propertyName}function Ln(i,e,t){return e=ky(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ky(i){var e=Hy(i,"string");return typeof e=="symbol"?e:String(e)}function Hy(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}let Il=null,Hh=[];class te extends ts{static addListener(e,t){let s={type:e,func:t};return Il?Il.events.addListener(s):Hh.push(s),s}static get(){return Il}constructor(){super(),Ln(this,"remote",void 0),Ln(this,"initialized",void 0),Ln(this,"sessions",void 0),Ln(this,"errorHandler",void 0),Ln(this,"version",void 0),Ln(this,"_loadingTimeoutId",void 0),this.remote=!1,this.initialized=!1,this.sessions=[],this._loadingTimeoutId=null,Hh.forEach(e=>{this.addListener(e)}),Hh=[],Il=this,this.errorHandler=this._createErrorHandler()}init(e){return e=e||{},this._prepare(e).then(this._bootstrap.bind(this,e.bootstrap)).then(this._init.bind(this,e)).then(this._initDone.bind(this,e)).catch(this._fail.bind(this,e))}_prepare(e){return this._prepareLogging(e).done(()=>{this._prepareEssentials(e),this._prepareDone(e)})}_prepareEssentials(e){At.get().init()}_prepareDone(e){this.trigger("prepare",{options:e}),a().log.isDebugEnabled()&&a().log.debug("App prepared")}_prepareLogging(e){return ci.bootstrap()}_bootstrap(e){e=e||{};let t=[];return this._doBootstrap(e).forEach(s=>{Array.isArray(s)?t.concat(s):s&&t.push(s)}),a().promiseAll(t).done(this._bootstrapDone.bind(this,e)).catch(this._bootstrapFail.bind(this,e))}_doBootstrap(e){return[x.get().bootstrap(),bt.bootstrap(e.fonts),_t.bootstrap(e.localesUrl),Ce.bootstrap(e.textsUrl),Tt.bootstrap(e.codesUrl)]}_bootstrapDone(e){Se.removeItemFromSessionStorage("scout:timeoutPageReload"),this.trigger("bootstrap",{options:e}),a().log.isDebugEnabled()&&a().log.debug("App bootstrapped")}_bootstrapFail(e,t,s,r,n){if(a().log.isInfoEnabled()&&a().log.info("App bootstrap failed"),a().isJqXHR(t)){if(this._isSessionTimeoutStatus(t.status)){let l=n?n.url:"";this._handleBootstrapTimeoutError(t,l);return}}else if(b.isPlainObject(t)&&t.error&&t.error.code===ii.JsonResponseError.SESSION_TIMEOUT){this._handleBootstrapTimeoutError(t.error,t.url);return}let o=b.argumentsToArray(arguments).slice(1);return a().rejectedPromise(...o)}_isSessionTimeoutStatus(e){return e===401}_handleBootstrapTimeoutError(e,t){if(a().log.isInfoEnabled()&&a().log.info("Timeout error for resource "+t+". Reloading page..."),Se.getItemFromSessionStorage("scout:timeoutPageReload"))throw a().log.isWarnEnabled()&&a().log.warn("Prevented automatic reload, startup will likely fail",e,t),Se.removeItemFromSessionStorage("scout:timeoutPageReload"),new Error("Resource "+t+" could not be loaded due to a session timeout, even after a page reload");Se.setItemToSessionStorage("scout:timeoutPageReload",!0+""),u.reloadPage()}_init(e){e=e||{},this.setLoading(!0);let t=this._checkBrowserCompatibility(e);return t?(this.setLoading(!1),t.then(s=>this._init(s))):(this._initVersion(e),this._prepareDOM(),this._installErrorHandler(),this._installGlobalMouseDownInterceptor(),this._installSyntheticActiveStateHandler(),this._ajaxSetup(),this._installExtensions(),this._load(e).then(this._loadSessions.bind(this,e.session)))}_load(e){return a().resolvedPromise()}_checkBrowserCompatibility(e){let t=x.get();if(a().log.isInfoEnabled()&&a().log.info("Detected browser "+t.browser+" version "+t.browserVersion),!u.nvl(e.checkBrowserCompatibility,!0)||t.isSupportedBrowser())return;let s=a().Deferred(),r=b.valueCopy(e);return r.checkBrowserCompatibility=!1,a()(".scout").each(function(){let o=a()(this).appendDiv();o.load("unsupported-browser.html",()=>{o.find("button").on("click",()=>{o.remove(),s.resolve(r)})})}),s.promise()}setLoading(e){e?this._loadingTimeoutId=setTimeout(()=>{this.sessions.some(t=>t.desktop&&t.desktop.rendered)||this._renderLoading()},200):(clearTimeout(this._loadingTimeoutId),this._loadingTimeoutId=null,this._removeLoading())}_renderLoading(){let e=a()("body"),t=e.children(".application-loading-root");t.length||(t=e.appendDiv("application-loading-root").addClass("application-loading-root").fadeIn()),this._renderLoadingElement(t,"application-loading01"),this._renderLoadingElement(t,"application-loading02"),this._renderLoadingElement(t,"application-loading03")}_renderLoadingElement(e,t){e.children("."+t).length||e.appendDiv(t).hide().fadeIn()}_removeLoading(){let e=a()("body").children(".application-loading-root");e.css("opacity",e.css("opacity")),e.oneAnimationEnd(()=>e.remove()),e.css("opacity")==="1"?e.addClass("fadeout and-more"):e.addClass("fadeout"),x.get().supportsCssAnimation()||e.remove()}_initVersion(e){this.version=u.nvl(this.version,e.version,a()("scout-version").data("value"))}_prepareDOM(){u.prepareDOM(document)}_installGlobalMouseDownInterceptor(){u.installGlobalMouseDownInterceptor(document)}_installSyntheticActiveStateHandler(){u.installSyntheticActiveStateHandler(document)}_installErrorHandler(){window.onerror=this.errorHandler.windowErrorHandler}_createErrorHandler(e){return e=a().extend({},e),u.create(Nr,e)}_ajaxSetup(){let e=this._ajaxDefaults();e&&a().ajaxSetup(e)}_ajaxDefaults(){return{beforeSend:this._beforeAjaxCall.bind(this)}}_beforeAjaxCall(e,t){e.setRequestHeader("X-Scout-Correlation-Id",Ke.correlationId()),e.setRequestHeader("X-Requested-With","XMLHttpRequest")}_loadSessions(e){e=e||{};let t=[];return a()(".scout").each((s,r)=>{let n=a()(r);e.portletPartId=e.portletPartId||n.data("partid")||"0";let o=this._loadSession(n,e);t.push(o)}),a().promiseAll(t)}_loadSession(e,t){let s={$entryPoint:e},r=a().extend({},t,s);r.locale=r.locale||this._loadLocale();let n=this._createSession(r);this.sessions.push(n);let o=this._createDesktop(n.root);return this._triggerDesktopReady(o),n.render(()=>{n._renderDesktop(),n.layoutValidator.validate(),n.focusManager.validateFocus(),n.ready=!0,this._triggerSessionReady(n),a().log.isInfoEnabled()&&a().log.info("Session initialized. Detected "+x.get())}),a().resolvedPromise()}_triggerDesktopReady(e){this.trigger("desktopReady",{desktop:e})}_triggerSessionReady(e){this.trigger("sessionReady",{session:e})}_createSession(e){return u.create(ii,e,{ensureUniqueId:!1})}_createDesktop(e){return u.create(Ie,{parent:e})}_loadLocale(){return _t.getNavigatorLocale()}_initDone(e){this.initialized=!0,this.setLoading(!1),this.trigger("init",{options:e}),a().log.isInfoEnabled()&&a().log.info("App initialized")}_fail(e,t){for(var s=arguments.length,r=new Array(s>2?s-2:0),n=2;n<s;n++)r[n-2]=arguments[n];a().log.error("App initialization failed."),this.setLoading(!1);let o=[];return this.sessions.length===0?o.push(this.errorHandler.handle(t,...r).then(l=>{this._appendStartupError(a()("body"),l.message)})):this.sessions.filter(l=>!l.ready&&!l.isFatalMessageShown()).forEach(l=>{l.$entryPoint.empty(),o.push(this._createErrorHandler({session:l}).handle(t))}),a().promiseAll(o).then(l=>a().rejectedPromise(t,...r))}_appendStartupError(e,t){let s=e.appendDiv("startup-error");s.appendDiv("startup-error-title").text("The application could not be started"),t&&s.appendDiv("startup-error-message").text(t)}_installExtensions(){}}const Ny=sourceMappedStackTrace;function Hr(i,e,t){return e=Vy(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Vy(i){var e=Wy(i,"string");return typeof e=="symbol"?e:String(e)}function Wy(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Nr{constructor(){Hr(this,"objectType",void 0),Hr(this,"logError",void 0),Hr(this,"displayError",void 0),Hr(this,"sendError",void 0),Hr(this,"session",void 0),Hr(this,"windowErrorHandler",void 0),this.logError=!0,this.displayError=!0,this.sendError=!1,this.windowErrorHandler=this._onWindowError.bind(this),this.session=null}init(e){a().extend(this,e)}_onWindowError(e,t,s,r,n){try{if(this._isIgnorableScriptError(e,t,s,r,n)){this.handleErrorInfo({log:"Ignoring error. Message: ".concat(e),level:qe.INFO});return}if(n instanceof Error){this.handle(n).catch(h=>{console.error("Error in global JavaScript error handler",h)});return}let o="J00",l=e+" at "+t+":"+s+`
(Code `+o+")";this.handleErrorInfo({code:o,message:e,log:l})}catch(o){throw new Error("Error in global JavaScript error handler: "+o.message+" (original error: "+e+" at "+t+":"+s+")")}}_isIgnorableScriptError(e,t,s,r,n){return e&&e.toLowerCase().indexOf("script error")>-1&&!t&&!s&&!r&&!n}handle(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];let n=e;return e&&s.length===0&&(String(e)==="[object Arguments]"?(n=e[0],s=[...e].slice(1)):Array.isArray(e)&&(n=e[0],s=e.slice(1))),this.analyzeError(n,...s).then(this.handleErrorInfo.bind(this))}analyzeError(e){let t={code:null,message:null,stack:null,mappedStack:null,debugInfo:null,log:null,error:e};for(var s=arguments.length,r=new Array(s>1?s-1:0),n=1;n<s;n++)r[n-1]=arguments[n];return this._analyzeError(t,...r)}_analyzeError(e){let t=e.error;if(t instanceof Error)return this.mapStack(t.stack).catch(o=>(e.mappingError=o.message+`
`+o.error.message+`
`+o.error.stack,null)).then(o=>(e.mappedStack=o,this._analyzeRegularError(e),e));if(a().isJqXHR(t)||Array.isArray(t)&&a().isJqXHR(t[0])||t instanceof Wo){for(var s=arguments.length,r=new Array(s>1?s-1:0),n=1;n<s;n++)r[n-1]=arguments[n];return this._analyzeAjaxError(e,...r),a().resolvedPromise(e)}return t?(this._analyzeOtherError(e),a().resolvedPromise(e)):(this._analyzeNoError(e),a().resolvedPromise(e))}_analyzeRegularError(e){let t=e.error;e.code=this.getJsErrorCode(t),e.message=String(t.message||t),t.stack&&(e.stack=String(t.stack)),t.debugInfo&&(e.debugInfo=t.debugInfo);let s=e.mappedStack||e.stack,r=[];(!s||s.indexOf(e.message)===-1)&&r.push(e.message),s&&r.push(s),e.mappingError&&r.push(e.mappingError),e.debugInfo&&r.push(`----- Additional debug information: -----
`+e.debugInfo),e.log=p.format(r,`
`)}_analyzeAjaxError(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];let n=e.error,o,l,h;n instanceof Wo?(o=n.jqXHR,l=n.errorThrown,h=n.requestOptions):(s=p.ensure(n).concat(s),o=s[0],l=s[2],h=s[3]);let d=h?y.join(" ",h.type,h.url):"",c=o.status?y.join(" ",o.status,l):"Connection error";e.code="X"+(o.status||"0"),e.message="AJAX call"+y.box(' "',d,'"')+" failed"+y.box(" [",c,"]"),e.log=e.message,o.responseText&&(e.debugInfo=`Response text:
`+o.responseText,e.log+=`
`+e.debugInfo)}_analyzeOtherError(e){let t=e.error,s=typeof t=="string"||typeof t=="number"?String(t):null;if(e.code="P4",e.message=s||"Unexpected error",!s)try{s=JSON.stringify(t)}catch{s=String(t)}e.log="Unexpected error: "+s}_analyzeNoError(e){e.code="P3",e.message="Unknown error",e.log="Unexpected error (no reason provided)"}mapStack(e){let t=a().Deferred();try{Ny.mapStackTrace(e,s=>{t.resolve(p.format(s,`
`))})}catch(s){return a().rejectedPromise({message:"Exception mapping failed",error:s})}return t.promise()}handleErrorInfo(e){e.level=u.nvl(e.level,qe.ERROR),this.logError&&e.log&&this._logErrorInfo(e);let t=this.session||te.get().sessions[0];return t&&(this.displayError&&e.level===qe.ERROR&&this._showMessageBox(t,e.message,e.code,e.log),this.sendError&&this._sendErrorMessage(t,e.log,e.level)),e}_logErrorInfo(e){switch(e.level){case qe.TRACE:a().log.trace(e.log);break;case qe.DEBUG:a().log.debug(e.log);break;case qe.INFO:a().log.info(e.log);break;case qe.WARN:a().log.warn(e.log);break;default:a().log.error(e.log)}let t=Nr.CONSOLE_OUTPUT;a().log instanceof Hl&&(t=!1),t&&window&&window.console&&(e.level===qe.ERROR&&window.console.error?window.console.error(e.log):e.level===qe.WARN&&window.console.warn?window.console.warn(e.log):window.console.log&&window.console.log(e.log))}getJsErrorCode(e){if(e){if(e.name==="EvalError")return"E1";if(e.name==="InternalError")return"I2";if(e.name==="RangeError")return"A3";if(e.name==="ReferenceError")return"R4";if(e.name==="SyntaxError")return"S5";if(e.name==="TypeError")return"T6";if(e.name==="URIError")return"U7"}return"J0"}_showMessageBox(e,t,s,r){let n={header:e.optText("ui.UnexpectedProblem","Internal UI Error"),body:y.join(`

`,e.optText("ui.InternalUiErrorMsg",t," ("+e.optText("ui.ErrorCodeX","Code "+s,s)+")"),e.optText("ui.UiInconsistentMsg","")),yesButtonText:e.optText("ui.Reload","Reload"),yesButtonAction:u.reloadPage,noButtonText:void 0,hiddenText:r,iconId:ye.SLIPPERY};e.inDevelopmentMode&&(n.noButtonText=e.optText("ui.Ignore","Ignore")),e.showFatalMessage(n,s)}_sendErrorMessage(e,t,s){e.sendLogRequest(t,s)}}Hr(Nr,"CONSOLE_OUTPUT",!0);class jf extends te{constructor(){super(),this.remote=!0}_doBootstrap(e){return super._doBootstrap(e).concat([this._doBootstrapDefaultValues()])}_doBootstrapDefaultValues(){return Ne.bootstrap()}_createErrorHandler(e){return e=a().extend({sendError:!0},e),super._createErrorHandler(e)}_loadSession(e,t){let s=t||{};s.$entryPoint=e;let r=this._createSession(s);return te.get().sessions.push(r),r.start()}}function Xf(i,e,t){return e=zy(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function zy(i){var e=Ky(i,"string");return typeof e=="symbol"?e:String(e)}function Ky(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Jf{constructor(){Xf(this,"extended",void 0),Xf(this,"next",void 0)}extend(e,t){let s=e[t],r=this;e[t]=function(){return r.extended=this,r.next=s.bind(this),r[t](...arguments)}}static install(e){e.forEach(t=>{u.create(t)})}}function ko(i,e,t){return e=Gy(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Gy(i){var e=Uy(i,"string");return typeof e=="symbol"?e:String(e)}function Uy(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ts{constructor(e,t,s){ko(this,"typeDescriptor",void 0),ko(this,"objectType",void 0),ko(this,"modelVariant",void 0),ko(this,"className",void 0),ko(this,"namespaces",void 0),this.typeDescriptor=e,this.objectType=t,this.modelVariant=s,this.modelVariant?(this.className=this.modelVariant.name+this.objectType.name,this.namespaces=this.modelVariant.namespaces):(this.className=this.objectType.name,this.namespaces=this.objectType.namespaces)}resolve(e){let t=window.scout;if(e=e||{},this.namespaces.length){t=window;for(let s=0;s<this.namespaces.length;s++)if(t=t[this.namespaces[s]],!t)throw this.error('Could not resolve namespace "'+this.namespaces[s]+'"')}return t[this.className]?t[this.className]:e.variantLenient&&this.modelVariant?new Ts(this.typeDescriptor,this.objectType,null).resolve(e):null}error(e){return new Error('Failed to create object for objectType "'+this.typeDescriptor+'": '+e)}notFoundError(){return this.error('Could not find "'+this.className+'" in namespace "'+this.namespaces.join(".")+'"')}static resolveType(e,t){return Ts.parse(e).resolve(t)}static parse(e){let t=null,s=null;if(y.contains(e,At.MODEL_VARIANT_SEPARATOR)){let o=e.split(At.MODEL_VARIANT_SEPARATOR);t=n(o[0]),s=n(o[1]),p.empty(s.namespaces)&&!p.empty(t.namespaces)&&(s.namespaces=t.namespaces)}else t=n(e);return new Ts(e,t,s);function r(o,l){return{name:o,namespaces:u.nvl(l,[]),toString:()=>{let h=l.slice();return h.push(o),y.join(At.NAMESPACE_SEPARATOR,...h)}}}function n(o){let l=[];if(y.contains(o,At.NAMESPACE_SEPARATOR)){let h=o.split(At.NAMESPACE_SEPARATOR);l=h.slice(0,h.length-1),o=p.last(h)}return r(o,l)}}}u.addObjectFactories({KeyStroke:()=>new re,KeyStrokeAdapter:()=>new br,ComposerField:()=>new Dp,ComposerFieldAdapter:()=>new Ap});function Nh(i,e,t){return e=qy(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function qy(i){var e=Yy(i,"string");return typeof e=="symbol"?e:String(e)}function Yy(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ll{constructor(e){Nh(this,"options$Container",void 0),Nh(this,"widget",void 0),Nh(this,"$container",void 0),u.assertParameter("widget",e.widget),this.widget=e.widget,this.options$Container=e.$container}_ensure$Container(){typeof this.options$Container=="function"?this.$container=this.options$Container():this.options$Container?this.$container=this.options$Container:this.$container=this.widget.$container}}function Vh(i,e,t){return e=jy(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function jy(i){var e=Xy(i,"string");return typeof e=="symbol"?e:String(e)}function Xy(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ss extends Ll{constructor(e){super(e),Vh(this,"loadingIndicatorDelay",void 0),Vh(this,"_$loadingIndicator",void 0),Vh(this,"_loadingIndicatorTimeoutId",void 0),this.loadingIndicatorDelay=u.nvl(e.loadingIndicatorDelay,250),this._$loadingIndicator=null,this._loadingIndicatorTimeoutId=null}setLoadingIndicatorDelay(e){this.loadingIndicatorDelay=e}_ensure$Container(){typeof this.options$Container=="function"?this.$container=this.options$Container():this.options$Container?this.$container=this.options$Container:this.$container=this.widget.$container}renderLoading(){clearTimeout(this._loadingIndicatorTimeoutId),this._ensure$Container(),this.widget.isLoading()?this.loadingIndicatorDelay&&!this.widget.rendering?this._loadingIndicatorTimeoutId=setTimeout(this._renderLoadingIndicator.bind(this),this.loadingIndicatorDelay):this._renderLoadingIndicator():this._removeLoadingIndicator()}_renderLoadingIndicator(){this._$loadingIndicator||!this.widget.rendered&&!this.widget.rendering||(this.$container.addClass("loading"),this._$loadingIndicator=this.$container.appendDiv("loading-indicator"))}_removeLoadingIndicator(){!this._$loadingIndicator||(this._$loadingIndicator.css("opacity",this._$loadingIndicator.css("opacity")),this._$loadingIndicator.addClass("animate-remove"),this._$loadingIndicator.oneAnimationEnd(()=>{this.remove(),this.widget.rendered&&(this.$container.removeClass("loading"),this.widget.invalidateLayoutTree())}))}remove(){this._$loadingIndicator&&(this._$loadingIndicator.remove(),this._$loadingIndicator=null)}}class Wh extends ss{_renderLoadingIndicator(){(this.widget.rendered||this.widget.rendering)&&this.$container.addClass("loading")}_removeLoadingIndicator(){(this.widget.rendered||this.widget.rendering)&&this.$container.removeClass("loading")}}var _e;(function(i){i.CONTINUE="continue",i.TERMINATE="terminate",i.SKIP_SUBTREE="skip_subtree"})(_e||(_e={}));function yt(i,e,t){return e=Jy(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Jy(i){var e=Qy(i,"string");return typeof e=="symbol"?e:String(e)}function Qy(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class O{constructor(){yt(this,"field",void 0),yt(this,"which",void 0),yt(this,"ctrl",void 0),yt(this,"inheritAccessibility",void 0),yt(this,"alt",void 0),yt(this,"shift",void 0),yt(this,"preventDefault",void 0),yt(this,"stopPropagation",void 0),yt(this,"stopImmediatePropagation",void 0),yt(this,"keyStrokeMode",void 0),yt(this,"repeatable",void 0),yt(this,"keyStrokeFirePolicy",void 0),yt(this,"enabledByFilter",void 0),yt(this,"renderingHints",void 0),yt(this,"invokeAcceptInputOnActiveValueField",void 0),yt(this,"preventInvokeAcceptInputOnActiveValueField",void 0),yt(this,"_handleExecuted",void 0),this.field=null,this.which=[],this.ctrl=!1,this.inheritAccessibility=!0,this.alt=!1,this.shift=!1,this.preventDefault=!0,this.stopPropagation=!1,this.stopImmediatePropagation=!1,this.keyStrokeMode=O.Mode.DOWN,this.repeatable=!1,this._handleExecuted=!1,this.keyStrokeFirePolicy=re.KeyStrokeFirePolicy.ACCESSIBLE_ONLY,this.enabledByFilter=!0,this.renderingHints={render:()=>this.field&&this.field.rendered!==void 0?this.field.rendered:!0,gap:4,offset:4,hAlign:ht.LEFT,text:null,$drawingArea:(e,t)=>e},this.invokeAcceptInputOnActiveValueField=!1,this.preventInvokeAcceptInputOnActiveValueField=!1}parseAndSetKeyStroke(e){this.alt=!1,this.ctrl=!1,this.shift=!1,this.which=[],e&&a().extend(this,O.parseKeyStroke(e))}accept(e){return!this._isEnabled()||!this._accept(e)?!1:(this._applyPropagationFlags(e),e.type===this.keyStrokeMode)}handle(e){throw new Error("keystroke event not handled: "+e)}invokeHandle(e){if(this.repeatable){this.handle(e);return}if(!this._handleExecuted&&(this.handle(e),e.type===O.Mode.DOWN)){this._handleExecuted=!0;let s=a()(e.target).window(),r=this,n={handleEvent:function(o){r._handleExecuted=!1,s[0].removeEventListener("keyup",this,!0)}};s[0].addEventListener("keyup",n,!0)}}_isEnabled(){return this.field?this.field.isRemovalPending()||!this.field.visible?!1:this.inheritAccessibility?this.field.enabledComputed:!0:!0}_accept(e){return O.acceptEvent(this,e)}_applyPropagationFlags(e){this.stopPropagation&&e.stopPropagation(),this.stopImmediatePropagation&&e.stopImmediatePropagation(),this.preventDefault&&e.preventDefault()}keys(){return this.which.map(e=>new qo(this,e))}renderKeyBox(e,t){if(e=this.renderingHints.$drawingArea(e,t),!e||!e.length)return null;let s=this._renderKeyBox(e,t.which);return this._postRenderKeyBox(e,s),e}_renderKeyBox(e,t){let s=a()(".key-box",e),r=this.renderingHints.text||g.codesToKeys[g.fromBrowser(t)],n=this.renderingHints.hAlign===ht.RIGHT?"right":"left",o=this.renderingHints.offset;if(s=s.filter(function(){return n==="right"?a()(this).hasClass("right"):!a()(this).hasClass("right")}),s.length>0){let c=s.first();this.renderingHints.hAlign===ht.RIGHT?o=e.outerWidth()-c.position().left+this.renderingHints.gap:o=c.position().left+this.renderingHints.gap+c.outerWidth()}this.shift&&(r="Shift "+r),this.alt&&(r="Alt "+r),this.ctrl&&(r="Ctrl "+r);let l=e.css("position");if(l==="absolute"||l==="relative"||l==="static"&&s.length>0)return d.call(this,o);let h=e.position();if(h)return d.call(this,h.left+o);a().log.warn("(keys#drawSingleKeyBoxItem) pos is undefined. $parent="+e);function d(c){return e.prependDiv("key-box",r).css(n,c+"px").toggleClass("disabled",!this.enabledByFilter).addClass(n)}}_postRenderKeyBox(e,t){}removeKeyBox(e){e&&(a()(".key-box",e).remove(),a()(".key-box-additional",e).remove())}static parseKeyStroke(e){if(!e)return null;let t={alt:!1,ctrl:!1,shift:!1,which:[]};return e.split("-").forEach(s=>{if(s==="alternate"||s==="alt")t.alt=!0;else if(s==="control"||s==="ctrl")t.ctrl=!0;else if(s==="shift")t.shift=!0;else{let r=g[s.toUpperCase()];t.which=r&&[r]}}),t}static acceptEvent(e,t){return e?O.acceptModifiers(e,t)&&u.isOneOf(t.which,e.which):!1}static acceptModifiers(e,t){return O._acceptModifier(e.ctrl,t.ctrlKey||t.metaKey)&&O._acceptModifier(e.alt,t.altKey)&&O._acceptModifier(e.shift,t.shiftKey)}static _acceptModifier(e,t){return e===void 0||t===void 0||e===t}}yt(O,"Mode",{UP:"keyup",DOWN:"keydown"});function Zy(i,e,t){return e=eb(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function eb(i){var e=tb(i,"string");return typeof e=="symbol"?e:String(e)}function tb(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ol extends O{constructor(e){super(),Zy(this,"virtualKeyStrokeWhich",void 0),this.field=e,this.renderingHints.$drawingArea=(t,s)=>s._$filterInput,this.virtualKeyStrokeWhich="a-Z;a-z;0-9",this.preventDefault=!1,this.keyStrokeMode=O.Mode.DOWN,this.stopPropagation=!0,this.inheritAccessibility=!1}_accept(e){if(!this._isKeyStrokeInRange(e))return!1;let t=this.field.$container.data("filter-field");return!t||!t.length||!t.is(":focusable")?!1:this.field.$container.activeElement()[0]!==t[0]?(e._$filterInput=t,this._isKeyStrokeInRange(e),!0):!1}handle(e){let t=e._$filterInput;if(this.field.session.focusManager.requestFocus(t)){t.focus();let s=u.nvl(t.val(),"").length;t[0].setSelectionRange(s,s)}}keys(){return[new qo(this,this.virtualKeyStrokeWhich)]}renderKeyBox(e,t){let s=t._$filterInput,n=s.position().left+s.cssMarginLeft()+4;return s.beforeDiv("key-box char","a - z").toggleClass("disabled",!this.enabledByFilter).cssLeft(n),s.parent()}_isKeyStrokeInRange(e){return e.which===this.virtualKeyStrokeWhich?!0:e.altKey||e.ctrlKey?!1:e.which>=g.A&&e.which<=g.Z||e.which>=g[0]&&e.which<=g[9]||e.which>=g.NUMPAD_0&&e.which<=g.NUMPAD_9}}function Pi(i,e,t){return e=ib(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ib(i){var e=sb(i,"string");return typeof e=="symbol"?e:String(e)}function sb(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class On extends Ll{constructor(e){super(e),Pi(this,"_cancelFilterFieldKeyStroke",void 0),Pi(this,"_createTextFilter",void 0),Pi(this,"_exitFilterFieldKeyStroke",void 0),Pi(this,"_filterElements",void 0),Pi(this,"_filterField",void 0),Pi(this,"_filterFieldDisplayTextChangedHandler",void 0),Pi(this,"_focusFilterFieldKeyStroke",void 0),Pi(this,"_focusInHandler",void 0),Pi(this,"_focusOutHandler",void 0),Pi(this,"_getElementText",void 0),Pi(this,"_getElementsForFiltering",void 0),Pi(this,"_textFilter",void 0),Pi(this,"_updateTextFilterText",void 0),e.filterElements?this._filterElements=e.filterElements:(this._filterElements=this._filter.bind(this),u.assertParameter("getElementsForFiltering",e.getElementsForFiltering),this._getElementsForFiltering=e.getElementsForFiltering),this._getElementText=e.getElementText||(t=>$(t).text()),e.createTextFilter?(u.assertParameter("updateTextFilterText",e.updateTextFilterText),this._createTextFilter=e.createTextFilter,this._updateTextFilterText=e.updateTextFilterText):(this._createTextFilter=this._createDefaultTextFilter.bind(this),this._updateTextFilterText=this._updateDefaultTextFilterText.bind(this)),this._filterField=null,this._filterFieldDisplayTextChangedHandler=this._onFilterFieldDisplayTextChanged.bind(this),this._focusInHandler=this._onFocusIn.bind(this),this._focusOutHandler=this._onFocusOut.bind(this),this._focusFilterFieldKeyStroke=null,this._cancelFilterFieldKeyStroke=null,this._exitFilterFieldKeyStroke=null,this._textFilter=null}_createDefaultTextFilter(){return{acceptedText:null,accept:e=>{if(y.empty(this._textFilter.acceptedText)||!this.widget.isTextFilterFieldVisible())return!0;let t=this._getElementText(e);return y.empty(t)?!1:y.contains(t.toLowerCase(),this._textFilter.acceptedText.toLowerCase())}}}_updateDefaultTextFilterText(e,t){return b.equals(e.acceptedText,t)?!1:(e.acceptedText=t,!0)}renderFilterField(){this.widget.isTextFilterFieldVisible()?this._renderFilterField():this._removeFilterField()}_renderFilterField(){this._ensure$Container(),this._filterField=u.create(ki,{parent:this.widget,label:this.widget.session.text("ui.Filter"),labelVisible:!1,inheritAccessibility:!1,cssClass:"filter-field empty",fieldStyle:A.FieldStyle.CLASSIC,statusVisible:!1,clearable:me.Clearable.ALWAYS,updateDisplayTextOnModify:!0,preventInitialFocus:!0}),this._filterField.render(this.$container),this._filterField.$field.attr("tabIndex",-1),this.widget.rendered?this._updateFilterFieldBackgroundColor():this.widget.session.layoutValidator.schedulePostValidateFunction(this._updateFilterFieldBackgroundColor.bind(this)),this._textFilter=this._createTextFilter(),this._textFilter.synthetic=!0,this.addFilter(this._textFilter),this._filterField.on("propertyChange:displayText",this._filterFieldDisplayTextChangedHandler),this.widget.$container.on("focusin",this._focusInHandler),this.widget.$container.on("focusout",this._focusOutHandler),this.widget.$container.data("filter-field",this._filterField.$field),this._focusFilterFieldKeyStroke=new Ol(this.widget),this.widget.keyStrokeContext.registerKeyStroke(this._focusFilterFieldKeyStroke),this._cancelFilterFieldKeyStroke=new O,this._cancelFilterFieldKeyStroke.field=this._filterField,this._cancelFilterFieldKeyStroke.which=[g.ESC],this._cancelFilterFieldKeyStroke.stopPropagation=!0,this._cancelFilterFieldKeyStroke.renderingHints.hAlign=ht.RIGHT,this._cancelFilterFieldKeyStroke.handle=this._cancelFilterField.bind(this),this._filterField.keyStrokeContext.registerKeyStroke(this._cancelFilterFieldKeyStroke),this._exitFilterFieldKeyStroke=new O,this._exitFilterFieldKeyStroke.field=this._filterField,this._exitFilterFieldKeyStroke.which=[g.ENTER],this._exitFilterFieldKeyStroke.stopPropagation=!0,this._exitFilterFieldKeyStroke.renderingHints.hAlign=ht.RIGHT,this._exitFilterFieldKeyStroke.handle=this._exitFilterField.bind(this),this._filterField.keyStrokeContext.registerKeyStroke(this._exitFilterFieldKeyStroke)}_updateFilterFieldBackgroundColor(){if(!this._filterField||!this._filterField.rendered)return;let e=M.getFirstOpaqueBackgroundColor(this._filterField.$container),t=$.extend(!0,{red:0,green:0,blue:0,alpha:1},M.rgb(e)),s="rgba("+t.red+", "+t.green+", "+t.blue+", "+.5+")",r="rgba("+t.red+", "+t.green+", "+t.blue+", "+.8+")";this._filterField.$container.css("--filter-field-background-color",e),this._filterField.$container.css("--filter-field-transparent-50-background-color",s),this._filterField.$container.css("--filter-field-transparent-80-background-color",r)}_onFilterFieldDisplayTextChanged(e){this._filterField&&this._filterField.rendered&&this._filterField.$container.toggleClass("empty",!e.newValue),this._updateTextFilterText(this._textFilter,e.newValue)&&this.filter()}_onFocusIn(e){this._updateFocusInsideWidget(e.target)}_onFocusOut(e){this._updateFocusInsideWidget(e.relatedTarget)}_updateFocusInsideWidget(e){let t=this.widget.$container.isOrHas(e);return this._filterField&&this._filterField.rendered&&this._filterField.$container.toggleClass("focus-inside-widget",t),t}_exitFilterField(){this.widget.focus()}_cancelFilterField(){this._resetFilterField(),this._exitFilterField()}_resetFilterField(){this._filterField&&this._filterField.setValue(null)}_removeFilterField(){!this._filterField||(this.widget.$container.off("focusin",this._focusInHandler),this.widget.$container.off("focusout",this._focusOutHandler),this.widget.keyStrokeContext.unregisterKeyStroke(this._focusFilterFieldKeyStroke),this._focusFilterFieldKeyStroke=null,this._resetFilterField(),this._filterField.destroy(),this._filterField=null,this.removeFilter(this._textFilter),this._textFilter=null)}remove(){this._removeFilterField()}addFilter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,s=p.ensure(e),r=this._getFilters().slice(),n=r.slice();if(s.forEach(l=>{this._hasFilter(r,l)||r.push(l)}),r.length===this._getFilters().length)return[];this._setFilters(r,t);let o=this._getFilters().slice();return p.removeAll(o,n),o}removeFilter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,s=p.ensure(e),r=this._getFilters().slice(),n=r.slice(),o=!1;if(s.forEach(h=>{h=this._findFilter(r,h),o=p.remove(r,h)||o}),!o)return[];this._setFilters(r,t);let l=this._getFilters().slice();return p.removeAll(n,l),n}setFilters(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(e=p.ensure(e),this._addSyntheticFilters(e),this._getFilters().length===e.length&&e.every(o=>this._hasFilter(this._getFilters(),o)))return{filtersAdded:[],filtersRemoved:[]};let s=this._getFilters().slice();this._setFilters(e,t);let r=this._getFilters().filter(o=>!this._findFilter(s,o)),n=s.filter(o=>!this._findFilter(this._getFilters(),o));return{filtersAdded:r,filtersRemoved:n}}_setFilters(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;this.widget.setProperty("filters",e.map(s=>b.isFunction(s)?this._createFilterByFunction(s):s)),t&&this.filter()}_addSyntheticFilters(e){this._getFilters().filter(t=>t.synthetic).forEach(t=>this._addSyntheticFilter(e,t)),this._addSyntheticFilter(e,this._textFilter)}_addSyntheticFilter(e,t){!t||this._hasFilter(e,t)||e.push(t)}_getFilters(){return this.widget.filters}_findFilter(e,t){return b.isFunction(t)?this._getFilterCreatedByFunction(e,t):p.find(e,s=>b.equals(s,t))}_getFilterCreatedByFunction(e,t){return p.find(e,s=>typeof s!="function"&&s.createdByFunction&&s.accept===t)}_hasFilter(e,t){return!!this._findFilter(e,t)}_createFilterByFunction(e){return{createdByFunction:!0,accept:e}}filter(){let e=this._filterElements();if(e&&(p.ensure(e.newlyHidden).length||p.ensure(e.newlyShown).length)){this.widget.filteredElementsDirty=!0;let s={};this._filterField&&(s.textFilterText=this._filterField.displayText),this.widget.updateFilteredElements(e,s)}return e}_filter(){return this.applyFilters(this._getElementsForFiltering(),!0)}applyFilters(e,t){if(this._getFilters().length===0&&!u.nvl(t,!1))return;let s=[],r=[];return e.forEach(n=>{this.applyFiltersForElement(n)&&(n.filterAccepted?s.push(n):r.push(n))}),{newlyHidden:r,newlyShown:s}}applyFiltersForElement(e){if(this.elementAcceptedByFilters(e)){if(!e.filterAccepted)return e.setFilterAccepted(!0),!0}else if(e.filterAccepted)return e.setFilterAccepted(!1),!0;return!1}elementAcceptedByFilters(e){return this._getFilters().every(t=>t.accept(e))}}function Wi(i,e,t){return e=rb(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function rb(i){var e=nb(i,"string");return typeof e=="symbol"?e:String(e)}function nb(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ke extends ts{constructor(){super(),Wi(this,"id",void 0),Wi(this,"objectType",void 0),Wi(this,"initialized",void 0),Wi(this,"attached",void 0),Wi(this,"destroyed",void 0),Wi(this,"widget",void 0),Wi(this,"session",void 0),Wi(this,"_enabledBeforeOffline",void 0),Wi(this,"_remoteProperties",void 0),Wi(this,"_widgetListener",void 0),Wi(this,"_propertyChangeEventFilter",void 0),Wi(this,"_widgetEventTypeFilter",void 0),this.id=null,this.objectType=null,this.initialized=!1,this.attached=!1,this.destroyed=!1,this.widget=null,this._enabledBeforeOffline=!0,this._remoteProperties=[],this._widgetListener=null,this._propertyChangeEventFilter=new ed,this._widgetEventTypeFilter=new rd,this.session=null}init(e){this._init(e),this.initialized=!0}_init(e){u.assertParameter("id",e.id),u.assertParameter("session",e.session),a().extend(this,e),this.session.registerModelAdapter(this)}destroy(){this._detachWidget(),this.widget.destroy(),this.widget=null,this.session.unregisterModelAdapter(this),this.destroyed=!0}createWidget(e,t){let s=this._initModel(e,t);return this.widget=this._createWidget(s),this._attachWidget(),this._postCreateWidget(),this.widget}_postCreateWidget(){}_initModel(e,t){let s=this.session.adapterExportEnabled,r=a().extend(s,{},e);return Ne.applyTo(r),r.parent=t,r.owner=t,r.modelAdapter=this,r.global&&(r.owner=this.session.getModelAdapter("1").widget),this._initProperties(r),r}_initProperties(e){}_createWidget(e){let t=u.create(e);return t._addCloneProperties(["modelClass","classId"]),t}_attachWidget(){this._widgetListener||(this._widgetListener={func:this._onWidgetEventInternal.bind(this)},this.widget.addListener(this._widgetListener),this.attached=!0,this.trigger("attach"))}_detachWidget(){!this._widgetListener||(this.widget.removeListener(this._widgetListener),this._widgetListener=null,this.attached=!1,this.trigger("detach"))}goOffline(){this.widget.visitChildren(e=>{e.modelAdapter&&e.modelAdapter._goOffline()})}_goOffline(){}goOnline(){this.widget.visitChildren(e=>{e.modelAdapter&&e.modelAdapter._goOnline()})}_goOnline(){}isRemoteProperty(e){return this._remoteProperties.indexOf(e)>-1}_addRemoteProperties(e){this._addProperties("_remoteProperties",e)}_removeRemoteProperties(e){this._removeProperties("_remoteProperties",e)}_addProperties(e,t){Array.isArray(t)?this[e]=this[e].concat(t):this[e].push(t)}_removeProperties(e,t){t=p.ensure(t),p.removeAll(this[e],t)}_send(e,t,s){let r={};arguments.length>2&&(s!==null&&typeof s=="object"?r=s:(r.delay=arguments[2],r.coalesce=arguments[3],r.showBusyIndicator=arguments[4])),s=r;let n=new ql(this.id,e,t);s.coalesce!==void 0&&(n.coalesce=s.coalesce),s.showBusyIndicator!==void 0&&(n.showBusyIndicator=s.showBusyIndicator),s.newRequest!==void 0&&(n.newRequest=s.newRequest),this.session.sendEvent(n,s.delay)}_sendProperty(e,t){let s={};s[e]=t,this._send("property",s)}addFilterForWidgetEvent(e){this._widgetEventTypeFilter.addFilter(e)}addFilterForWidgetEventType(e){this._widgetEventTypeFilter.addFilterForEventType(e)}addFilterForProperties(e){this._propertyChangeEventFilter.addFilterForProperties(e)}addFilterForPropertyName(e){this._propertyChangeEventFilter.addFilterForPropertyName(e)}_isPropertyChangeEventFiltered(e,t){return t instanceof I&&(t=t.id),this._propertyChangeEventFilter.filter(e,t)}_isWidgetEventFiltered(e){return this._widgetEventTypeFilter.filter(e)}resetEventFilters(){this._propertyChangeEventFilter.reset(),this._widgetEventTypeFilter.reset()}_onWidgetPropertyChange(e){let t=e.propertyName,s=e.newValue;this._isPropertyChangeEventFiltered(t,s)||this.isRemoteProperty(t)&&(s=this._prepareRemoteProperty(t,s),this._callSendProperty(t,s))}_prepareRemoteProperty(e,t){return!t||!this.widget.isWidgetProperty(e)?t:Array.isArray(t)?t.map(s=>s.modelAdapter.id):t.modelAdapter.id}_callSendProperty(e,t){let s="_send"+y.toUpperCaseFirstLetter(e);this[s]?this[s](t):this._sendProperty(e,t)}_onWidgetDestroy(e){this.destroy()}_onWidgetEventInternal(e){this._isWidgetEventFiltered(e)||this._onWidgetEvent(e)}_onWidgetEvent(e){e.type==="destroy"?this._onWidgetDestroy(e):e.type==="propertyChange"&&this._onWidgetPropertyChange(e)}_syncPropertiesOnPropertyChange(e){this._orderPropertyNamesOnSync(e).forEach(s=>{let r=e[s],n="_sync"+y.toUpperCaseFirstLetter(s);this[n]?this[n](r):this.widget.callSetter(s,r)})}_orderPropertyNamesOnSync(e){return Object.keys(e)}_createPropertySortFunc(e){return(t,s)=>{let r=e.indexOf(t),n=e.indexOf(s);return r>-1&&n>-1?r-n:r>-1?-1:n>-1?1:mt.TEXT.compare(t,s)}}onModelEvent(e){!e||(e.type==="property"?this.onModelPropertyChange(e):this.onModelAction(e))}onModelPropertyChange(e){this.addFilterForProperties(e.properties),this._syncPropertiesOnPropertyChange(e.properties)}onModelAction(e){e.type==="scrollToTop"?this.widget.scrollToTop({animate:e.animate}):e.type==="reveal"?this.widget.reveal({animate:e.animate}):a().log.warn('Model action "'+e.type+'" is not supported by model-adapter '+this.objectType)}toString(){return"ModelAdapter[objectType="+this.objectType+" id="+this.id+"]"}exportAdapterData(e){let t=e.modelClass;if(t){let s=Math.max(0,t.lastIndexOf("$")+1,t.lastIndexOf(".")+1);e.id=t.substring(s)}return delete e.owner,delete e.classId,delete e.modelClass,e}static modifyWidgetPrototype(e){!te.get().remote||b.replacePrototypeFunction(I,"_createChild",function(t){return t instanceof I?t:this.modelAdapter&&typeof t=="string"?this.session.getOrCreateWidget(t,this):this._createChildOrig(t)},!0)}}te.addListener("bootstrap",ke.modifyWidgetPrototype);function j(i,e,t){return e=ob(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ob(i){var e=lb(i,"string");return typeof e=="symbol"?e:String(e)}function lb(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class I extends Ml{constructor(){super(),j(this,"animateRemoval",void 0),j(this,"animateRemovalClass",void 0),j(this,"attached",void 0),j(this,"children",void 0),j(this,"cloneOf",void 0),j(this,"cssClass",void 0),j(this,"destroyed",void 0),j(this,"destroying",void 0),j(this,"disabledStyle",void 0),j(this,"enabled",void 0),j(this,"enabledComputed",void 0),j(this,"eventDelegators",void 0),j(this,"focused",void 0),j(this,"htmlComp",void 0),j(this,"id",void 0),j(this,"inheritAccessibility",void 0),j(this,"initialized",void 0),j(this,"keyStrokeContext",void 0),j(this,"loading",void 0),j(this,"loadingSupport",void 0),j(this,"logicalGrid",void 0),j(this,"modelClass",void 0),j(this,"classId",void 0),j(this,"objectType",void 0),j(this,"owner",void 0),j(this,"parent",void 0),j(this,"removalPending",void 0),j(this,"removing",void 0),j(this,"rendering",void 0),j(this,"scrollLeft",void 0),j(this,"scrollTop",void 0),j(this,"session",void 0),j(this,"trackFocus",void 0),j(this,"visible",void 0),j(this,"modelAdapter",void 0),j(this,"$container",void 0),j(this,"$parent",void 0),j(this,"_widgetProperties",void 0),j(this,"_cloneProperties",void 0),j(this,"_rendered",void 0),j(this,"_$lastFocusedElement",void 0),j(this,"_focusInListener",void 0),j(this,"_glassPaneContributions",void 0),j(this,"_parentDestroyHandler",void 0),j(this,"_parentRemovingWhileAnimatingHandler",void 0),j(this,"_postRenderActions",void 0),j(this,"_preserveOnPropertyChangeProperties",void 0),j(this,"_scrollHandler",void 0),j(this,"_storedFocusedWidget",void 0),this.id=null,this.objectType=null,this.session=null,this.modelClass=null,this.classId=null,this.owner=null,this.parent=null,this.children=[],this.initialized=!1,this.cloneOf=null,this.rendering=!1,this.removing=!1,this.removalPending=!1,this._rendered=!1,this.attached=!1,this.destroyed=!1,this.destroying=!1,this.enabled=!0,this.enabledComputed=!0,this.inheritAccessibility=!0,this.disabledStyle=I.DisabledStyle.DEFAULT,this.visible=!0,this.focused=!1,this.loading=!1,this.cssClass=null,this.scrollTop=null,this.scrollLeft=null,this.$parent=null,this.$container=null,this.htmlComp=null,this.animateRemoval=!1,this.animateRemovalClass="animate-remove",this._widgetProperties=[],this._cloneProperties=["visible","enabled","inheritAccessibility","cssClass"],this.eventDelegators=[],this._preserveOnPropertyChangeProperties=[],this._postRenderActions=[],this._focusInListener=this._onFocusIn.bind(this),this._parentDestroyHandler=this._onParentDestroy.bind(this),this._parentRemovingWhileAnimatingHandler=this._onParentRemovingWhileAnimating.bind(this),this._scrollHandler=this._onScroll.bind(this),this.loadingSupport=this._createLoadingSupport(),this.keyStrokeContext=this._createKeyStrokeContext(),this.logicalGrid=null,this.trackFocus=!1,this._$lastFocusedElement=null,this._storedFocusedWidget=null,this._glassPaneContributions=[]}init(e){let t=this._jsonModel();t&&(e=Dt.extend({},t,e)),e=e||{},e=this._prepareModel(e),this._init(e),this._initKeyStrokeContext(),this.recomputeEnabled(),this.initialized=!0,this.trigger("init")}_prepareModel(e){return e}_init(e){if(!e.parent)throw new Error("Parent expected: "+this);if(this.setOwner(e.owner||e.parent),this.setParent(e.parent),this.session=e.session||this.parent.session,!this.session)throw new Error("Session expected: "+this);this._eachProperty(e,(t,s,r)=>{s!==void 0&&(r&&(s=this._prepareWidgetProperty(t,s)),this._initProperty(t,s))}),this._setCssClass(this.cssClass),this._setLogicalGrid(this.logicalGrid),this._setEnabled(this.enabled)}_initProperty(e,t){this[e]=t}_jsonModel(){return null}_createChildren(e){if(!e)return null;if(!Array.isArray(e))return this._createChild(e);let t=[];return e.forEach((s,r)=>{t[r]=this._createChild(s)}),t}_createChild(e){if(e instanceof I)return e;if(typeof e=="string"){let s=this.widget(e);if(!s)throw new Error("Referenced widget not found: "+e);return s}let t=e;return t.parent=this,u.create(t)}_initKeyStrokeContext(){!this.keyStrokeContext||(this.keyStrokeContext.$scopeTarget=()=>this.$container,this.keyStrokeContext.$bindTarget=()=>this.$container)}destroy(){if(!this.destroyed){if(this.destroying=!0,this._rendered&&(this.animateRemoval||this._isRemovalPrevented())){this.one("remove",()=>{this.destroy()}),this.remove();return}this._destroyChildren(this.children.slice().reverse()),this.remove(),this._destroy(),this.owner._removeChild(this),this.owner=null,this.parent._removeChild(this),this.parent.off("destroy",this._parentDestroyHandler),this.parent=null,this.destroying=!1,this.destroyed=!0,this.trigger("destroy")}}_destroy(){}_destroyChildren(e){!e||(e=p.ensure(e),e.forEach(t=>this._destroyChild(t)))}_destroyChild(e){e.owner===this&&e.destroy()}render(e){if(Dt.log.isTraceEnabled()&&Dt.log.trace("Rendering widget: "+this),!this.initialized)throw new Error("Not initialized: "+this);if(this._rendered)throw new Error("Already rendered: "+this);if(this.destroyed)throw new Error("Widget is destroyed: "+this);this.rendering=!0,this.$parent=e||this.parent.$container,this._render(),this._renderProperties(),this._renderInspectorInfo(),this._linkWithDOM(),this.session.keyStrokeManager.installKeyStrokeContext(this.keyStrokeContext),this.rendering=!1,this.rendered=!0,this.attached=!0,this.trigger("render"),this.restoreFocus(),this._postRender()}_render(){}get rendered(){return this._rendered&&!this.isRemovalPending()}set rendered(e){this._rendered=e}_renderProperties(){this._renderCssClass(),this._renderEnabled(),this._renderVisible(),this._renderTrackFocus(),this._renderFocused(),this._renderLoading(),this._renderScrollTop(),this._renderScrollLeft()}_postRender(){let e=this._postRenderActions;this._postRenderActions=[],e.forEach(t=>{t()})}remove(){!this._rendered||this._isRemovalPrevented()||(this.animateRemoval?this._removeAnimated():this._removeInternal())}removeImmediately(){this._removeInternal()}_isRemovalPrevented(){return this.isRemovalPending()}_isRemovalPending(){return this.isRemovalPending()}isRemovalPending(){if(this.removalPending)return!0;let e=this.parent;if(!e||e.removing||e.rendering)return!1;for(;e;){if(e.removalPending)return!0;e=e.parent}return!1}_removeInternal(){!this._rendered||(Dt.log.isTraceEnabled()&&Dt.log.trace("Removing widget: "+this),this.removing=!0,this.removalPending=!1,this.trigger("removing"),this.$container&&this.$container.off("focusin",this._focusInListener),this._$lastFocusedElement&&(this._storedFocusedWidget=u.widget(this._$lastFocusedElement),this._$lastFocusedElement=null),this.children.slice().reverse().forEach(function(e){e.parent===this&&e.remove()},this),this._rendered&&(this._cleanup(),this._remove(),this.$parent=null,this.rendered=!1,this.attached=!1,this.removing=!1,this.trigger("remove")))}_removeAnimated(){let e=this._animateRemovalWhileRemovingParent();if(this.parent.removing&&!e||!x.get().supportsCssAnimation()||!this.$container||this.$container.isDisplayNone()){this._removeInternal();return}this.session.desktop.removePopupsFor(this),this.removalPending=!0,setTimeout(()=>{if(!!this._rendered){if(!this.$container.isVisible()||!this.$container.isEveryParentVisible()||!this.$container.isAttached()){this._removeInternal();return}this._removeAnimatedImpl()}}),e||this.parent.one("removing",this._parentRemovingWhileAnimatingHandler)}_removeAnimatedImpl(){if(!this.animateRemovalClass)throw new Error("Missing animate removal class. Cannot remove animated.");this.$container.addClass(this.animateRemovalClass),this.$container.oneAnimationEnd(()=>{this._removeInternal()})}_animateRemovalWhileRemovingParent(){return!1}_onParentRemovingWhileAnimating(){this._removeInternal()}_renderInspectorInfo(){!this.session.inspector||Hn.applyInfo(this)}_linkWithDOM(){this.$container&&this.$container.data("widget",this)}_cleanup(){this.parent.off("removing",this._parentRemovingWhileAnimatingHandler),this.session.keyStrokeManager.uninstallKeyStrokeContext(this.keyStrokeContext),this.loadingSupport&&this.loadingSupport.remove(),this._uninstallScrollbars(),this.$container&&this.session.layoutValidator.cleanupInvalidComponents(this.$container)}_remove(){this.$container&&(this.$container.remove(),this.$container=null)}setOwner(e){u.assertParameter("owner",e),e!==this.owner&&(this.owner&&this.owner._removeChild(this),this.owner=e,this.owner._addChild(this))}setParent(e){if(u.assertParameter("parent",e),e===this.parent)return;if(this.rendered&&!e.rendered&&(Dt.log.isInfoEnabled()&&Dt.log.info("rendered child "+this+" is added to not rendered parent "+e+". Removing child.",new Error("origin")),this.remove()),this.parent){if(this.parent.isRemovalPending()){this.parent.one("remove",()=>{this.setParent(e)});return}this.parent.off("destroy",this._parentDestroyHandler),this.parent.off("removing",this._parentRemovingWhileAnimatingHandler),this.parent!==this.owner&&this.parent._removeChild(this)}let t=this.parent;this.parent=e,this.parent._addChild(this),this.trigger("hierarchyChange",{oldParent:t,parent:e}),this.initialized&&this.recomputeEnabled(this.parent.enabledComputed),this.parent.one("destroy",this._parentDestroyHandler)}_addChild(e){Dt.log.isTraceEnabled()&&Dt.log.trace("addChild("+e+") to "+this),p.pushSet(this.children,e)}_removeChild(e){Dt.log.isTraceEnabled()&&Dt.log.trace("removeChild("+e+") from "+this),p.remove(this.children,e)}ancestors(){let e=[],t=this.parent;for(;t;)e.push(t),t=t.parent;return e}isOrHas(e){return e===this?!0:this.has(e)}has(e){for(;e;){if(e.parent===this)return!0;e=e.parent}return!1}getForm(){return U.findForm(this)}findNonWrappedForm(){return U.findNonWrappedForm(this)}findDesktop(){return this.session.desktop?this.session.desktop:this.findParent(e=>e instanceof Ie)}setEnabled(e,t,s){this.setProperty("enabled",e),e&&t&&this.parent&&this.parent.setEnabled(!0,!0,!1),s&&this.visitChildren(r=>{r.setEnabled(e)})}_setEnabled(e){this._setProperty("enabled",e),this.initialized&&this.recomputeEnabled()}recomputeEnabled(e){e===void 0&&(e=!0,this.parent&&this.parent.initialized&&this.parent.enabledComputed!==void 0&&(e=this.parent.enabledComputed));let t=this._computeEnabled(this.inheritAccessibility,e);this._updateEnabledComputed(t)}_updateEnabledComputed(e,t){if(this.enabledComputed===e&&t===void 0)return;this.setProperty("enabledComputed",e),this.rendered&&this._renderEnabled();let s=u.nvl(t,e);this._childrenForEnabledComputed().forEach(r=>{r.inheritAccessibility&&r.recomputeEnabled(s)})}_childrenForEnabledComputed(){return this.children}_computeEnabled(e,t){return this.enabled&&(e?t:!0)}_renderEnabled(){!this.$container||(this.$container.setEnabled(this.enabledComputed),this._renderDisabledStyle())}setInheritAccessibility(e){this.setProperty("inheritAccessibility",e)}_setInheritAccessibility(e){this._setProperty("inheritAccessibility",e),this.initialized&&this.recomputeEnabled()}setDisabledStyle(e){this.setProperty("disabledStyle",e),this.children.forEach(t=>{t.setDisabledStyle(e)})}_renderDisabledStyle(){this._renderDisabledStyleInternal(this.$container)}_renderDisabledStyleInternal(e){!e||(this.enabledComputed?e.removeClass("read-only"):e.toggleClass("read-only",this.disabledStyle===I.DisabledStyle.READ_ONLY))}setVisible(e){this.setProperty("visible",e)}isVisible(){return this.visible}_renderVisible(){!this.$container||(this.$container.setVisible(this.isVisible()),this.invalidateParentLogicalGrid())}isEveryParentVisible(){let e=this.parent;for(;e;){if(!e.isVisible())return!1;e=e.parent}return!0}setFocused(e){this.setProperty("focused",e)}_renderFocused(){this.$container&&this.$container.toggleClass("focused",this.focused)}_setCssClass(e){this.rendered&&this._removeCssClass(),this._setProperty("cssClass",e)}_removeCssClass(){!this.$container||this.$container.removeClass(this.cssClass)}_renderCssClass(){!this.$container||(this.$container.addClass(this.cssClass),this.htmlComp&&this.invalidateLayoutTree())}setCssClass(e){this.setProperty("cssClass",e)}addCssClass(e){let t=this.cssClassAsArray();I.cssClassAsArray(e).forEach(r=>{t.indexOf(r)>=0||t.push(r)},this),this.setProperty("cssClass",p.format(t," "))}removeCssClass(e){let t=this.cssClassAsArray(),s=I.cssClassAsArray(e);p.removeAll(t,s)&&this.setProperty("cssClass",p.format(t," "))}toggleCssClass(e,t){t?this.addCssClass(e):this.removeCssClass(e)}cssClassAsArray(){return I.cssClassAsArray(this.cssClass)}_createLoadingSupport(){return null}setLoading(e){this.setProperty("loading",e)}isLoading(){return this.loading}_renderLoading(){!this.loadingSupport||this.loadingSupport.renderLoading()}pack(){if(!(!this.rendered||this.removing)){if(!this.htmlComp)throw new Error("Function expects a htmlComp property");this.htmlComp.pack()}}invalidateLayout(){if(!(!this.rendered||this.removing)){if(!this.htmlComp)throw new Error("Function expects a htmlComp property");this.htmlComp.invalidateLayout()}}validateLayout(){if(!(!this.rendered||this.removing)){if(!this.htmlComp)throw new Error("Function expects a htmlComp property");this.htmlComp.validateLayout()}}revalidateLayout(){if(!(!this.rendered||this.removing)){if(!this.htmlComp)throw new Error("Function expects a htmlComp property");this.htmlComp.revalidateLayout()}}invalidateLayoutTree(e){if(!(!this.rendered||this.removing)){if(!this.htmlComp)throw new Error("Function expects a htmlComp property");this.htmlComp.invalidateLayoutTree(e)}}validateLayoutTree(){if(!(!this.rendered||this.removing)){if(!this.htmlComp)throw new Error("Function expects a htmlComp property");this.htmlComp.validateLayoutTree()}}revalidateLayoutTree(e){if(!(!this.rendered||this.removing)){if(!this.htmlComp)throw new Error("Function expects a htmlComp property");this.htmlComp.revalidateLayoutTree(e)}}setLayoutData(e){if(!!this.rendered){if(!this.htmlComp)throw new Error("Function expects a htmlComp property");this.htmlComp.layoutData=e}}validateLogicalGrid(){this.logicalGrid&&this.logicalGrid.validate(this)}invalidateLogicalGrid(e){!this.initialized||!this.logicalGrid||(this.logicalGrid.setDirty(!0),u.nvl(e,!0)&&this.invalidateLayoutTree())}invalidateParentLogicalGrid(e){if(this.parent.invalidateLogicalGrid(!1),!(!this.rendered||!this.htmlComp)&&u.nvl(e,!0)){let t=this.htmlComp.getParent();t&&t.invalidateLayoutTree()}}revalidateLogicalGrid(e){this.invalidateLogicalGrid(e),this.validateLogicalGrid()}setLogicalGrid(e){this.setProperty("logicalGrid",e)}_setLogicalGrid(e){(typeof e=="string"||typeof e=="function")&&(e=u.create(e)),this._setProperty("logicalGrid",e),this.invalidateLogicalGrid()}entryPoint(){let e=u.nvl(this.$container,this.parent.$container);if(!e||!e.length)throw new Error("Cannot resolve entryPoint, $element.length is 0 or undefined");return e.entryPoint()}window(e){let t=this.$container||this.$parent;return t?t.window(e):e?null:Dt()}document(e){let t=this.$container||this.$parent;return t?t.document(e):e?null:Dt()}attach(){this.attached||!this.rendered||(this._attach(),this._installFocusContext(),this.restoreFocus(),this.attached=!0,this._postAttach(),this._onAttach(),this._triggerChildrenOnAttach(this))}_attach(){}_postAttach(){}_triggerChildrenOnAttach(e){this.children.forEach(t=>{t._onAttach(),t._triggerChildrenOnAttach(e)})}_onAttach(){this.rendered&&this._renderOnAttach()}_renderOnAttach(){this._renderScrollTop(),this._renderScrollLeft()}detach(){this.rendering&&this._postRenderActions.push(this.detach.bind(this)),!(!this.attached||!this.rendered)&&(this._beforeDetach(),this._onDetach(),this._triggerChildrenOnDetach(),this._detach(),this.attached=!1)}_beforeDetach(){if(!this.$container)return;let e=this.$container.document(!0).activeElement,t=this.$container.isOrHas(e),s=this.session.focusManager;s.isFocusContextInstalled(this.$container)?this._uninstallFocusContext():t&&s.validateFocus(cr.outsideFilter(this.$container))}_triggerChildrenOnDetach(){this.children.forEach(e=>{e._onDetach(),e._triggerChildrenOnDetach()})}_onDetach(){this.rendered&&this._renderOnDetach()}_renderOnDetach(){}_detach(){}_uninstallFocusContext(){}_installFocusContext(){}_createKeyStrokeContext(){return null}updateKeyStrokes(e,t){this.unregisterKeyStrokes(t),this.registerKeyStrokes(e)}registerKeyStrokes(e){this.keyStrokeContext.registerKeyStrokes(e)}unregisterKeyStrokes(e){this.keyStrokeContext.unregisterKeyStrokes(e)}setProperty(e,t){return b.equals(this[e],t)?!1:(t=this._prepareProperty(e,t),this.rendered&&this._callRemoveProperty(e),this._callSetProperty(e,t),this.rendered&&this._callRenderProperty(e),!0)}_prepareProperty(e,t){return this.isWidgetProperty(e)?this._prepareWidgetProperty(e,t):t}_prepareWidgetProperty(e,t){let s=this._createChildren(t),r=this[e];return r&&Array.isArray(s)&&(r=p.diff(r,s)),this.isPreserveOnPropertyChangeProperty(e)||(this._destroyChildren(r),this.link(s)),s}_callRemoveProperty(e){if(!this.isWidgetProperty(e)||this.isPreserveOnPropertyChangeProperty(e))return;let t=this[e];if(!t)return;let s="_remove"+y.toUpperCaseFirstLetter(e);this[s]?this[s]():this._internalRemoveWidgets(t)}_internalRemoveWidgets(e){e=p.ensure(e),e.forEach(t=>{t.remove()})}_callRenderProperty(e){let t="_render"+y.toUpperCaseFirstLetter(e);!this[t]||this[t]()}link(e){!e||(e=p.ensure(e),e.forEach(t=>t.setParent(this)))}glassPaneTargets(e){let t=s=>p.flatMap(this._glassPaneContributions,n=>{let o=n(s);return o?p.ensure(o):[]}).concat(this._glassPaneTargets(s));return this.rendered?t(e):Qr.createFor(this,t.bind(this,e))}_glassPaneTargets(e){return[this.$container].concat(this.session.desktop.getPopupsFor(this).filter(t=>!e.has(t)).reduce((t,s)=>t.concat(s.glassPaneTargets()),[]))}addGlassPaneContribution(e){this._glassPaneContributions.push(e),this.trigger("glassPaneContributionAdded",{contribution:e})}removeGlassPaneContribution(e){p.remove(this._glassPaneContributions,e),this.trigger("glassPaneContributionRemoved",{contribution:e})}toString(){let e="";return e+="id="+this.id,e+=" objectType="+this.objectType,e+=" rendered="+this.rendered,this.$container&&(e+=" $container="+v.debugOutput(this.$container)),"Widget["+e.trim()+"]"}ancestorsToString(e){let t="",s=this.ancestors();return e=u.nvl(e,-1),s.some((r,n)=>e>-1&&n>=e?!0:(n>0&&n<s.length-1&&(t+=`
`),t+=r.toString(),!1)),t}resolveTextKeys(e){e.forEach(t=>{Ce.resolveTextProperty(this,t)})}resolveIconIds(e){e.forEach(t=>{ye.resolveIconProperty(this,t)})}resolveConsts(e){e.forEach(t=>b.resolveConstProperty(this,t))}_addWidgetProperties(e){this._addProperties("_widgetProperties",e)}isWidgetProperty(e){return this._widgetProperties.indexOf(e)>-1}_addCloneProperties(e){this._addProperties("_cloneProperties",e)}isCloneProperty(e){return this._cloneProperties.indexOf(e)>-1}_addPreserveOnPropertyChangeProperties(e){this._addProperties("_preserveOnPropertyChangeProperties",e)}isPreserveOnPropertyChangeProperty(e){return this._preserveOnPropertyChangeProperties.indexOf(e)>-1}_addProperties(e,t){t=p.ensure(t),t.forEach(s=>{if(this[e].indexOf(s)>-1)throw new Error(e+" already contains the property "+s);this[e].push(s)})}_eachProperty(e,t){let s,r,n;for(s in e)this._widgetProperties.indexOf(s)>-1||(r=e[s],t(s,r));for(n=0;n<this._widgetProperties.length;n++)s=this._widgetProperties[n],r=e[s],r!==void 0&&t(s,r,!0)}_removeWidgetProperties(e){Array.isArray(e)?p.removeAll(this._widgetProperties,e):p.remove(this._widgetProperties,e)}cloneAndMirror(e){return this.clone(e,{delegateAllPropertiesToClone:!0})}original(){let e=this;for(;e.cloneOf;)e=e.cloneOf;return e}clone(e,t){let s,r;return e=e||{},t=t||{},r=b.extractProperties(this,e,this._cloneProperties),s=u.create(this.objectType,r),s.cloneOf=this,this._mirror(s,t),this.logicalGrid?s.setLogicalGrid(this.logicalGrid.objectType):s.setLogicalGrid(null),s}_deepCloneProperties(e,t,s){if(!t)return e;t=p.ensure(t),t.forEach(r=>{let n=this[r],o=null;if(n===void 0)throw new Error("Property '"+r+"' is undefined. Deep copy not possible.");this._widgetProperties.indexOf(r)>-1?Array.isArray(n)?o=n.map(l=>l.clone({parent:e},s)):o=n.clone({parent:e},s):Array.isArray(n)?o=n.map(l=>l):o=n,e[r]=o})}mirror(e,t){if(t=t||this.cloneOf,!t)throw new Error("No target for mirroring.");this._mirror(t,e)}_mirror(e,t){let s=p.find(this.eventDelegators,r=>r.clone===e);if(s)throw new Error("_mirror can only be called on not mirrored widgets. call unmirror first.");t=t||{},s={clone:e,originalToClone:is.create(this,e,{delegateProperties:t.delegatePropertiesToClone,delegateAllProperties:t.delegateAllPropertiesToClone}),cloneToOriginal:is.create(e,this,{delegateProperties:t.delegatePropertiesToOriginal,delegateAllProperties:t.delegateAllPropertiesToOriginal,excludeProperties:t.excludePropertiesToOriginal,delegateEvents:t.delegateEventsToOriginal})},this.eventDelegators.push(s),e.one("destroy",()=>{this._unmirror(e)})}unmirror(e){if(e=e||this.cloneOf,!e)throw new Error("No target for unmirroring.");this._unmirror(e)}_unmirror(e){let t=p.findIndex(this.eventDelegators,r=>r.clone===e),s=t>-1?this.eventDelegators.splice(t,1)[0]:null;!s||(s.originalToClone&&s.originalToClone.destroy(),s.cloneToOriginal&&s.cloneToOriginal.destroy())}_onParentDestroy(){this.destroyed||this.setParent(this.owner)}widget(e,t){if(s(this))return this;return this.findChild(s);function s(r){return r.id===e}}nearestWidget(e,t){if(this.id===e)return this;let s=this.children.slice();for(;s.length;){let r=s.shift();if(r.id===e)return r;if(t)for(let n=0;n<r.children.length;n++){let o=r.children[n];o.parent===r&&s.push(o)}}return null}findParent(e){let t=this.parent;for(;t;){if(e(t))return t;t=t.parent}return t}findChild(e){let t=null;return this.visitChildren(s=>{if(e(s))return t=s,!0}),t}setTrackFocus(e){this.setProperty("trackFocus",e)}_renderTrackFocus(){!this.$container||(this.trackFocus?this.$container.on("focusin",this._focusInListener):this.$container.off("focusin",this._focusInListener))}restoreFocus(){this._$lastFocusedElement?this.session.focusManager.requestFocus(this._$lastFocusedElement):this._storedFocusedWidget&&(this._storedFocusedWidget.focus(),this._storedFocusedWidget=null)}_onFocusIn(e){this.rendering||this.$container.has(e.target)&&(this._$lastFocusedElement=Dt(e.target))}focus(e){return this.rendered?this.session.focusManager.requestFocus(this.getFocusableElement(),null,e):(this.session.layoutValidator.schedulePostValidateFunction(this.focus.bind(this,e)),!1)}focusAndPreventDefault(e){return this.focus()?(e.preventDefault(),!0):!1}isFocused(){return this.rendered&&Yi.isActiveElement(this.getFocusableElement())}isFocusable(e){if(!this.rendered||!this.visible)return!1;let t=this.getFocusableElement();if(!t)return!1;let s=Dt.ensure(t);return s.is(":focusable")?u.nvl(e,!0)?s.is(":tabbable"):!0:!1}getFocusableElement(){return this.rendered&&this.$container?this.$container[0]:null}_installScrollbars(e){let t=this.get$Scrollable();if(!t)throw new Error("Scrollable is not defined, cannot install scrollbars");if(t.data("scrollable"))return;e=e||{parent:this};let s={parent:this},r=Dt.extend({},s,e);P.install(t,r),t.on("scroll",this._scrollHandler)}_uninstallScrollbars(){let e=this.get$Scrollable();!e||!e.data("scrollable")||(P.uninstall(e,this.session),e.off("scroll",this._scrollHandler),this.removing||(e[0].scrollTop===0&&(this.scrollTop=null),e[0].scrollLeft===0&&(this.scrollLeft=null)))}_onScroll(e){let t=this.get$Scrollable();this._setProperty("scrollTop",t[0].scrollTop),this._setProperty("scrollLeft",t[0].scrollLeft)}setScrollTop(e){if(this.getDelegateScrollable()){this.getDelegateScrollable().setScrollTop(e);return}this.setProperty("scrollTop",e)}_renderScrollTop(){let e=this.get$Scrollable();if(!(!e||this.scrollTop===null)){if(this.rendering||this.htmlComp&&!this.htmlComp.layouted&&!this.htmlComp.layouting){this.session.layoutValidator.schedulePostValidateFunction(this._renderScrollTop.bind(this));return}P.scrollTop(e,this.scrollTop)}}setScrollLeft(e){if(this.getDelegateScrollable()){this.getDelegateScrollable().setScrollLeft(e);return}this.setProperty("scrollLeft",e)}_renderScrollLeft(){let e=this.get$Scrollable();if(!(!e||this.scrollLeft===null)){if(this.rendering||this.htmlComp&&!this.htmlComp.layouted&&!this.htmlComp.layouting){this.session.layoutValidator.schedulePostValidateFunction(this._renderScrollLeft.bind(this));return}P.scrollLeft(e,this.scrollLeft)}}get$Scrollable(){return this.$container}hasScrollShadow(e){return P.hasScrollShadow(this.get$Scrollable(),e)}getDelegateScrollable(){return null}scrollToTop(e){if(this.getDelegateScrollable()){this.getDelegateScrollable().scrollToTop();return}let t=this.get$Scrollable();if(!!t){if(!this.rendered){this.session.layoutValidator.schedulePostValidateFunction(this.scrollToTop.bind(this));return}P.scrollTop(t,0,e)}}scrollToBottom(e){if(this.getDelegateScrollable()){this.getDelegateScrollable().scrollToBottom();return}let t=this.get$Scrollable();if(!!t){if(!this.rendered){this.session.layoutValidator.schedulePostValidateFunction(this.scrollToBottom.bind(this));return}P.scrollToBottom(t,e)}}reveal(e){if(!this.rendered)return;let t=this.$container.scrollParent();t.length!==0&&P.scrollTo(t,this.$container,e)}visitChildren(e){for(let t=0;t<this.children.length;t++){let s=this.children[t];if(s.parent===this){let r=e(s);if(r===!0||r===_e.TERMINATE)return _e.TERMINATE;if(r!==_e.SKIP_SUBTREE&&(r=s.visitChildren(e),r===!0||r===_e.TERMINATE))return _e.TERMINATE}}}isAttachedAndRendered(){return(this.rendered||this.rendering)&&this.$container.isAttached()}static cssClassAsArray(e){let t=[],s=e||"";return s=s.trim(),s.length>0&&(t=s.split(" ")),t}}j(I,"DisabledStyle",{DEFAULT:0,READ_ONLY:1});let ab=0;const Le={get(i){for(i=a().ensure(i);i&&i.length>0;){let e=i.data("widget");if(e)return e;i=i.parent()}return null},createUniqueId(i){return i=i||"sc",i+ab++},updateFirstLastMarker(i){i.filter((e,t,s)=>e.rendered&&e.isVisible()).forEach((e,t,s)=>{e.$container.toggleClass("first",t===0),e.$container.toggleClass("last",t===s.length-1)})},findFirstFocusableWidget(i,e,t){return e&&(!e.rendered||!e.visible)?null:p.find(i,s=>s.isFocusable(t))},preserveAndSetProperty(i,e,t,s){t[s]===null&&(t[s]=e()),i()},resetProperty(i,e,t){e[t]!=null&&(i(e[t]),e[t]=null)}};function hb(i,e,t){return e=db(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function db(i){var e=ub(i,"string");return typeof e=="symbol"?e:String(e)}function ub(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Qf extends I{constructor(){super(),hb(this,"widgets",void 0),this.widgets=[],this._addWidgetProperties(["widgets"])}_render(){this.$container=this.$parent.appendDiv(),this.htmlComp=T.install(this.$container,this.session)}_renderProperties(){super._renderProperties(),this._renderWidgets()}setWidgets(e){this.setProperty("widgets",e)}_renderWidgets(){this.widgets.forEach(e=>e.render()),this.invalidateLayoutTree()}}function cb(i,e,t){return e=pb(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function pb(i){var e=fb(i,"string");return typeof e=="symbol"?e:String(e)}function fb(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Bl extends I{constructor(){super(),cb(this,"childWidget",void 0),this.childWidget=null,this._addWidgetProperties(["childWidget"])}setChildWidget(e){this.setProperty("childWidget",e)}}class Zf extends ke{}const p={ensure(i){return i==null?[]:Array.isArray(i)?i:[i]},init(i,e){let t=[];for(let s=0;s<i;s++)t[s]=e;return t},remove(i,e){if(i){let t=i.indexOf(e);if(t!==-1)return i.splice(t,1),!0}return!1},removeAll(i,e){let t=!1;if(!e||e.length===0)return!1;for(let s=i.length-1;s>=0;s--)e.indexOf(i[s])>-1&&(i.splice(s,1),t=!0);return t},replace(i,e,t){let s=i.indexOf(e);return s!==-1&&(i[s]=t),s},insert(i,e,t){p.insertAll(i,[e],t)},insertAll(i,e,t){let s=p.ensure(e);i.splice(t,0,...s)},insertSorted(i,e,t){let s=0,r=i.length-1;for(;s<=r;){let n=s+Math.floor((r-s)/2),o=t(i[n],e);if(o<0)s=n+1;else if(o>0)r=n-1;else{for(s=n+1;s<i.length&&t(i[s],e)===0;)s++;break}}i.splice(s,0,e)},insertBefore(i,e,t,s){let r=p.findIndex(i,t,s);r===-1?i.unshift(e):p.insert(i,e,r)},insertAfter(i,e,t){let s=p.findIndex(i,t);s===-1?i.push(e):p.insert(i,e,s+1)},move(i,e,t){let s=i.splice(e,1)[0];p.insert(i,s,t)},contains(i,e){return i=p.ensure(i),i.indexOf(e)!==-1},containsAny(i,e){let t=p.ensure(i);return p.ensure(e).some(r=>t.indexOf(r)>=0)},containsAll(i,e){let t=p.ensure(i);return p.ensure(e).every(r=>t.indexOf(r)>=0)},first(i){return Array.isArray(i)?i[0]:i},last(i){return Array.isArray(i)?i[i.length-1]:i},hasElements(i){return!p.empty(i)},empty(i){return Array.isArray(i)?i.length===0:!0},length(i){return Array.isArray(i)?i.length:0},pushAll(i,e){let t=p.ensure(e);i.push(...t)},union(i,e){let t=[],s={};return i=p.ensure(i),e=p.ensure(e),i.forEach(r=>{let n=r;typeof r=="object"&&(n=r.id),s[n]=r,t.push(r)}),e.forEach(r=>{let n=r;typeof r=="object"&&(n=r.id),n in s||t.push(r)}),t},equalsIgnoreOrder(i,e){return i===e||(!i||i.length===0)&&(!e||e.length===0)?!0:!i||!e||i.length!==e.length?!1:p.containsAll(i,e)},equals(i,e){if(i===e||(!i||i.length===0)&&(!e||e.length===0))return!0;if(!i||!e||i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!==e[t])return!1;return!0},greater(i,e){let t=0,s=0;return i&&(t=i.length),e&&(s=e.length),t>s},eachSibling(i,e,t){if(!(!i||!t))for(let s=0;s<i.length;s++){let r=i[s];r!==e&&t(r,s)}},findIndex(i,e,t){if(!i||!e)return-1;for(let s=0;s<i.length;s++)if(e.call(t,i[s],s,i))return s;return-1},find(i,e,t){let s=p.findIndex(i,e,t);return s===-1?null:i[s]},findFrom(i,e,t,s){return s?p.findFromReverse(i,e,t):p.findFromForward(i,e,t)},findIndexFrom(i,e,t,s){return s?p.findIndexFromReverse(i,e,t):p.findIndexFromForward(i,e,t)},findFromForward(i,e,t){let s=p.findIndexFromForward(i,e,t);return s===-1?null:i[s]},findIndexFromForward(i,e,t){if(!i||!t||e>=i.length)return-1;e<0&&(e=0);for(let s=e;s<i.length;s++){let r=i[s];if(t(r,s))return s}return-1},findFromReverse(i,e,t){let s=p.findIndexFromReverse(i,e,t);return s===-1?null:i[s]},findIndexFromReverse(i,e,t){if(!i||!t||e<0)return-1;e>=i.length&&(e=i.length-1);for(let s=e;s>=0;s--){let r=i[s];if(t(r,s))return s}return-1},pushIfDefined(i){if(i){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];p.pushAll(i,t.filter(r=>r!=null))}},pushSet(i,e){e&&i.indexOf(e)===-1&&i.push(e)},format(i,e,t){if(!i||i.length===0)return"";let s="";for(let r=0;r<i.length;r++){let n=i[r];e&&r>0&&r<i.length&&(s+=e),t&&(n=y.encode(n)),s+=n}return s},formatEncoded(i,e){return p.format(i,e,!0)},max(i){if(i==null)return Math.max(i);let e=i.filter(b.isNumber);return Math.max(...e)},min(i){if(i==null)return Math.min(i);let e=i.filter(b.isNumber);return Math.min(...e)},diff(i,e){let t=i.slice();return p.removeAll(t,e),t},flatMap(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:s=>s,t=[];return p.ensure(i).forEach(s=>p.pushAll(t,e(s))),t},flattenRec(i,e){return p.ensure(i).reduce((t,s)=>(t.push(s),s&&e&&(t=t.concat(p.flattenRec(e(s),e))),t),[])},$indexOf(i,e){for(let t=0;t<i.length;t++)if(i[t][0]===e[0])return t},$remove(i,e){let t=p.$indexOf(i,e);t>=0&&i.splice(t,1)},randomElement(i){if(!!i){if(!Array.isArray(i))return i;if(!!i.length)return i[Math.floor(Math.random()*i.length)]}},toMap(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:s=>s+"",t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:s=>s;return b.createMap(p.ensure(i).reduce((s,r)=>(s[e(r)]=t(r),s),{}))},nullIfEmpty(i){return p.empty(i)?null:i},clear(i){return Array.isArray(i)?i.splice(0,i.length):[]}};function $t(i,e,t){return e=mb(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function mb(i){var e=gb(i,"string");return typeof e=="symbol"?e:String(e)}function gb(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Bn{constructor(){$t(this,"objectType",void 0),$t(this,"retryIntervals",void 0),$t(this,"minCallDuration",void 0),$t(this,"callCounter",void 0),$t(this,"maxRetries",void 0),$t(this,"deferred",void 0),$t(this,"aborted",void 0),$t(this,"initialized",void 0),$t(this,"pendingCall",void 0),$t(this,"callTimeoutId",void 0),$t(this,"callStartTimestamp",void 0),$t(this,"type",void 0),$t(this,"name",void 0),$t(this,"uniqueName",void 0),$t(this,"logPrefix",void 0),$t(this,"result",void 0),this.initialized=!1,this.retryIntervals=[],this.maxRetries=0,this.minCallDuration=500,this.callCounter=0,this.deferred=a().Deferred(),this.aborted=!1,this.pendingCall=null,this.callTimeoutId=null,this.callStartTimestamp=null,this.type=null,this.name=null,this.uniqueName=null,this.logPrefix="",this.result=null}init(e){a().extend(this,e),b.isNullOrUndefined(this.maxRetries)?(this.retryIntervals=this.retryIntervals?this.retryIntervals.slice():[],this.maxRetries=this.retryIntervals.length):this.retryIntervals=p.init(this.maxRetries,0),this.uniqueName=u.nvl(this.type,"call")+"-"+Bn.GLOBAL_SEQ+++y.box(" ",this.name,""),this.initialized=!0}_checkInitialized(){if(!this.initialized)throw new Error("Not initialized")}_updateLogPrefix(){this.logPrefix=this.callCounter+"/"+(this.maxRetries+1)+" ["+this.uniqueName+"] "}_resolve(){a().log.isTraceEnabled()&&a().log.trace(this.logPrefix+"[RESOLVE]"),this.deferred.resolve(...p.ensure(this.result))}_reject(){a().log.isTraceEnabled()&&a().log.trace(this.logPrefix+"[REJECT]"),this.deferred.reject(...p.ensure(this.result))}_setResult(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this.result=t}call(){return this._checkInitialized(),this._call(),this.deferred.promise()}abort(){this._checkInitialized(),this._abort()}_call(){if(this.aborted)throw new Error("Call is aborted");this.callTimeoutId=null,this.callStartTimestamp=Date.now(),this.callCounter++,this._updateLogPrefix(),this.pendingCall=this._callImpl().always(()=>{this.pendingCall=null}).done(this._setResultDone.bind(this)).done(this._onCallDone.bind(this)).fail(this._setResultFail.bind(this)).fail(this._onCallFail.bind(this))}_setResultDone(){this._setResult(...arguments)}_setResultFail(){this._setResult(...arguments)}_onCallDone(){this._resolve()}_onCallFail(){if(this.aborted){a().log.isTraceEnabled()&&a().log.trace(this.logPrefix+"Call aborted"),this._reject();return}let e=this._nextRetryImpl(...arguments);if(typeof e!="number"){a().log.isTraceEnabled()&&a().log.trace(this.logPrefix+"No retries remaining"),this._reject();return}let t=Date.now()-this.callStartTimestamp,s=Math.max(this.minCallDuration-t,0),r=e+s;a().log.isTraceEnabled()&&a().log.trace(this.logPrefix+"Try again in "+r+" ms..."),this.callTimeoutId=setTimeout(this._call.bind(this),r)}_nextRetryImpl(){return this.retryIntervals.length?this.retryIntervals.shift():!1}_abort(){if(this.aborted=!0,this.callTimeoutId){a().log.isTraceEnabled()&&a().log.trace(this.logPrefix+"Cancelled scheduled retry"),clearTimeout(this.callTimeoutId),this.callTimeoutId=null,this._reject();return}this._abortImpl()}_abortImpl(){}}$t(Bn,"GLOBAL_SEQ",0);const rs={copyText(i){u.assertParameter("options",i),i.parent&&!i.session&&(i.session=i.parent.session),u.assertProperty(i,"session");let e=rs._copyText(i);return i.parent&&u.nvl(i.showNotification,!0)?(rs._showNotification(i,e),null):e},_copyText(i){let e=a().Deferred();if(navigator.clipboard)return navigator.clipboard.writeText(i.text).then(function(){return e.resolve(...arguments)}).catch(function(){return e.reject(...arguments)}),e.promise();let t=i.parent&&i.parent.rendered?i.parent.document(!0):document,s=t.createElement("textarea");s.style.position="fixed",s.style.opacity="0.0",s.value=i.text,t.body.appendChild(s);let r=a()(s);i.session.focusManager.installFocusContext(r,Mt.AUTO),s.select();try{t.execCommand("copy")?e.resolve():e.reject()}catch(n){e.reject(n)}finally{i.session.focusManager.uninstallFocusContext(r),t.body.removeChild(s)}return e.promise()},_showNotification(i,e){let t=rs._successStatus(i.parent.session);e.catch(()=>{t=rs._failedStatus(i.parent.session)}).then(()=>{rs.showNotification(i.parent,t)})},_successStatus(i){return new E({message:i.text("ui.CopyToClipboardSuccessStatus"),severity:E.Severity.INFO})},_failedStatus(i){return new E({message:i.text("ui.CopyToClipboardFailedStatus"),severity:E.Severity.WARNING})},showNotification(i,e){u.assertParameter("parent",i),u.create(ti,{parent:i,closable:!1,duration:1234,status:e||rs._successStatus(i.session)}).show()}},Rt={ColorSchemeId:{DEFAULT:"default",ALTERNATIVE:"alternative",RAINBOW:"rainbow"},ensureColorScheme(i,e){let t={};return i&&typeof i=="object"?t=i:typeof i=="string"&&(y.startsWith(i,Rt.ColorSchemeId.DEFAULT)?t.scheme=Rt.ColorSchemeId.DEFAULT:y.startsWith(i,Rt.ColorSchemeId.ALTERNATIVE)?t.scheme=Rt.ColorSchemeId.ALTERNATIVE:y.startsWith(i,Rt.ColorSchemeId.RAINBOW)?t.scheme=Rt.ColorSchemeId.RAINBOW:t.scheme=y.removeSuffix(i,"-inverted"),t.inverted=y.endsWith(i,"-inverted")),b.isNullOrUndefined(e)||(t.tile=e),t},toggleColorSchemeClasses(i,e){if(!i||!e)return;let t=Rt.ensureColorScheme(e);i.toggleClass("color-alternative",t.scheme===Rt.ColorSchemeId.ALTERNATIVE),i.toggleClass("color-rainbow",t.scheme===Rt.ColorSchemeId.RAINBOW),i.toggleClass("inverted",!!t.inverted),i.toggleClass("tile",!!t.tile)},getCssClasses(i){let e=[];if(!i)return e;let t=Rt.ensureColorScheme(i);return t.scheme===Rt.ColorSchemeId.ALTERNATIVE?e.push("color-alternative"):t.scheme===Rt.ColorSchemeId.RAINBOW?e.push("color-rainbow"):t.scheme&&e.push(t.scheme),t.inverted&&e.push("inverted"),t.tile&&e.push("tile"),e}},w={shift(i,e,t,s){let r=new Date(i.getTime());return e&&(r.setFullYear(i.getFullYear()+e),w.compareMonths(r,i)!==e*12&&r.setDate(0)),t&&(r.setMonth(i.getMonth()+t),w.compareMonths(r,i)!==t+e*12&&r.setDate(0)),s&&r.setDate(i.getDate()+s),r},shiftTime(i,e,t,s,r){let n=new Date(i.getTime());return e&&n.setHours(i.getHours()+e),t&&n.setMinutes(i.getMinutes()+t),s&&n.setSeconds(i.getSeconds()+s),r&&n.setMilliseconds(i.getMilliseconds()+r),n},shiftToNextDayOfType(i,e){let t=e-i.getDay();return t<=0&&(t+=7),w.shift(i,0,0,t)},shiftToNextDayAndDate(i,e,t){let s=new Date(i.getTime());for(t<s.getDate()&&s.setMonth(s.getMonth()+1),s.setDate(t);s.getDay()!==e||s.getDate()!==t;)s=w.shift(s,0,1,0),s.setDate(t);return s},shiftToPreviousDayOfType(i,e){let t=e-i.getDay();return t>=0&&(t-=7),w.shift(i,0,0,t)},shiftToNextOrPrevDayOfType(i,e,t){return t>0?w.shiftToNextDayOfType(i,e):w.shiftToPreviousDayOfType(i,e)},shiftToNextOrPrevMonday(i,e){return w.shiftToNextOrPrevDayOfType(i,1,e)},ensure(i){return b.isNullOrUndefined(i)||i instanceof Date?i:w.parseJsonDate(i)},ensureMonday(i,e){return i.getDay()===1?i:w.shiftToNextOrPrevMonday(i,e)},isSameTime(i,e){return!i||!e?!1:i.getHours()===e.getHours()&&i.getMinutes()===e.getMinutes()&&i.getSeconds()===e.getSeconds()},isSameDay(i,e){return!i||!e?!1:i.getFullYear()===e.getFullYear()&&i.getMonth()===e.getMonth()&&i.getDate()===e.getDate()},isSameMonth(i,e){return!i||!e?!1:w.compareMonths(i,e)===0},compareMonths(i,e){let t=i.getMonth(),s=e.getMonth(),r=i.getFullYear(),n=e.getFullYear(),o=t-s;return r===n?o:(r-n)*12+o},compareDays(i,e){return(w.trunc(i).getTime()-w.trunc(e).getTime()-(i.getTimezoneOffset()-e.getTimezoneOffset())*6e4)/(36e5*24)},orderWeekdays(i,e){let t=[];for(let s=0;s<7;s++)t[s]=i[(s+e)%7];return t},weekInYear(i,e){if(!i)return;let t=1;e instanceof xt?t=e.symbols.firstDayOfWeek:e instanceof qt?t=e.dateFormatSymbols.firstDayOfWeek:typeof e=="number"&&(t=e);let s=w._thursdayOfWeek(i,t),r=new Date(s.getFullYear(),0,4),n=w.firstDayOfWeek(r,t);i.getTime()<n.getTime()&&(r=new Date(s.getFullYear()-1,0,4));let o=w._thursdayOfWeek(r,t),l=(s.getTime()-o.getTime())/864e5;return 1+Math.round(l/7)},_thursdayOfWeek(i,e){if(!i||typeof e!="number")return;let t=new Date(i.valueOf());return t.getDay()!==4&&(t.getDay()<e&&t.setDate(t.getDate()-7),t.setDate(t.getDate()-t.getDay()+4)),t},firstDayOfWeek(i,e){if(!i||typeof e!="number")return;let t=new Date(i.valueOf());return t.getDay()!==e&&t.setDate(t.getDate()-(t.getDay()+7-e)%7),t},parseJsonDate(i){if(!i)return null;let e=1970,t=1,s=1,r=0,n=0,o=0,l=0,h=!1,d=/^\+?(\d{4,5})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})\.(\d{3})(Z?)$/.exec(i);if(d!==null)e=parseInt(d[1],10),t=parseInt(d[2],10),s=parseInt(d[3],10),r=parseInt(d[4],10),n=parseInt(d[5],10),o=parseInt(d[6],10),l=parseInt(d[7],10),h=d[8]==="Z";else if(d=/^\+?(\d{4,5})-(\d{2})-(\d{2})(Z?)$/.exec(i),d!==null)e=parseInt(d[1],10),t=parseInt(d[2],10),s=parseInt(d[3],10),h=d[4]==="Z";else if(d=/^(\d{2}):(\d{2}):(\d{2})\.(\d{3})(Z?)$/.exec(i),d!==null)r=parseInt(d[1],10),n=parseInt(d[2],10),o=parseInt(d[3],10),l=parseInt(d[4],10),h=d[5]==="Z";else throw new Error("Unparseable date: "+i);let c;return h?(c=new Date(Date.UTC(e,t-1,s,r,n,o,l)),e<100&&c.setUTCFullYear(e)):(c=new Date(e,t-1,s,r,n,o,l),e<100&&c.setFullYear(e)),c},toJsonDate(i,e,t,s){if(!i)return null;t===void 0&&(t=!0),s===void 0&&(s=!0);let r,n,o;e?(r=h(i)+"-"+y.padZeroLeft(i.getUTCMonth()+1,2)+"-"+y.padZeroLeft(i.getUTCDate(),2),n=y.padZeroLeft(i.getUTCHours(),2)+":"+y.padZeroLeft(i.getUTCMinutes(),2)+":"+y.padZeroLeft(i.getUTCSeconds(),2)+"."+y.padZeroLeft(i.getUTCMilliseconds(),3),o="Z"):(r=h(i)+"-"+y.padZeroLeft(i.getMonth()+1,2)+"-"+y.padZeroLeft(i.getDate(),2),n=y.padZeroLeft(i.getHours(),2)+":"+y.padZeroLeft(i.getMinutes(),2)+":"+y.padZeroLeft(i.getSeconds(),2)+"."+y.padZeroLeft(i.getMilliseconds(),3),o="");let l="";return t&&(l+=r,s&&(l+=" ")),s&&(l+=n),l+=o,l;function h(d){let c=d.getFullYear();return c>9999?"+"+c:y.padZeroLeft(c,4)}},toJsonDateRange(i){return{from:w.toJsonDate(i.from),to:w.toJsonDate(i.to)}},create(i){if(i){let e=/^(\d{4,5})(?:-(\d{2})(?:-(\d{2})(?: (\d{2})(?::(\d{2})(?::(\d{2})(?:\.(\d{3}))?(Z?))?)?)?)?)?/.exec(i);if(e===null)throw new Error("Unparsable date: "+i);let t;return e[8]==="Z"?t=new Date(Date.UTC(parseInt(e[1],10),(parseInt(e[2],10)||1)-1,parseInt(e[3],10)||1,parseInt(e[4],10)||0,parseInt(e[5],10)||0,parseInt(e[6],10)||0,parseInt(e[7],10)||0)):t=new Date(parseInt(e[1],10),(parseInt(e[2],10)||1)-1,parseInt(e[3],10)||1,parseInt(e[4],10)||0,parseInt(e[5],10)||0,parseInt(e[6],10)||0,parseInt(e[7],10)||0),t}},newDate(){return new Date},format(i,e,t){return new xt(e,t).format(i)},formatDateTime(i,e){return new xt(e,e.dateFormatPatternDefault+" "+e.timeFormatPatternDefault).format(i)},compare(i,e){if(!i&&!e)return 0;if(!i)return-1;if(!e)return 1;let t=i.getTime()-e.getTime();return t<-1?-1:t>1?1:t},equals(i,e){return w.compare(i,e)===0},combineDateTime(i,e){let t=new Date;return t.setHours(0,0,0,0),t.setFullYear(1970,0,1),i&&t.setFullYear(i.getFullYear(),i.getMonth(),i.getDate()),e&&(t.setHours(u.nvl(e.getHours(),0)),t.setMinutes(u.nvl(e.getMinutes(),0)),t.setSeconds(u.nvl(e.getSeconds(),0)),t.setMilliseconds(u.nvl(e.getMilliseconds(),0))),t},isLeapYear(i){return i==null?!1:new Date(i,1,29).getDate()===29},trunc(i,e){return i&&(u.nvl(e,!0)&&(i=new Date(i.getTime())),i.setHours(0,0,0,0)),i},ceil(i,e,t){let s,r,n=u.nvl(e,30);return i&&(u.nvl(t,!0)&&(i=new Date(i.getTime())),i.setSeconds(0,0),r=(i.getMinutes()+n)/n*n,s=i.getHours(),r>=60&&(s++,r=0),s>23&&(s=0,i.setDate(i.getDate()+1)),i.setHours(s,r)),i}},Ne={_defaults:{},_objectTypeHierarchyFlat:{},bootstrap(i){i=i||{};let e={url:"defaultValues"};return i=a().extend({},e,i),a().ajaxJson(i.url).done(Ne.init.bind(this))},init(i){Ne._objectTypeHierarchyFlat={},Ne._defaults=i.defaults||{};let e=i.objectTypeHierarchy||{};Ne._generateObjectTypeHierarchyRec(e,void 0,Ne._objectTypeHierarchyFlat),Object.keys(Ne._defaults).forEach(t=>{Ne._objectTypeHierarchyFlat[t]||(Ne._objectTypeHierarchyFlat[t]=[t])})},_generateObjectTypeHierarchyRec(i,e,t){if(!!i){if(!t)throw new Error("Argument 'targetMap' must not be null");Object.keys(i).forEach(s=>{let r=[s];if(e&&(r=r.concat(e)),typeof i[s]=="object"&&Ne._generateObjectTypeHierarchyRec(i[s],r,t),t[s])throw new Error("Object type '"+s+"' has ambiguous parent object types.");t[s]=r},this)}},applyTo(i,e){if(Array.isArray(i))for(let t=0;t<i.length;t++)Ne.applyTo(i[t],e);else if(typeof i=="object"&&(e=e||i.objectType,e)){if(typeof e!="string"){let t=(e+"").substring(0,80);throw new Error("objectType has to be a string but is a "+typeof e+" ObjectType: "+t)}Ne._applyToInternal(i,e)}},_applyToInternal(i,e){let t=Ne._objectTypeHierarchyFlat[e];if(t||(e=Ts.parse(e).objectType.toString(),t=Ne._objectTypeHierarchyFlat[e]),!!t)for(let s=0;s<t.length;s++){let r=t[s],n=Ne._defaults[r];Ne._extendWithDefaults(i,n)}},_extendWithDefaults(i,e){i===void 0||e===void 0||Object.keys(e).forEach(t=>{let s=t;if(y.startsWith(t,"~")&&(s=t.substring(1)),i[s]===void 0)i[s]=b.valueCopy(e[s]);else if(b.isPlainObject(i[s])&&b.isPlainObject(e[t]))Ne._extendWithDefaults(i[s],e[t]);else if(Array.isArray(i[s])&&b.isPlainObject(e[t])){let r=i[s];for(let n=0;n<r.length;n++)b.isPlainObject(r[n])&&Ne._extendWithDefaults(r[n],e[t])}})}};function em(i){return i&&y.startsWith(i.type,"touch")}const ot={pageX(i){return b.isNullOrUndefined(i.pageX)?i.originalEvent.touches[0].pageX:i.pageX},pageY(i){return b.isNullOrUndefined(i.pageY)?i.originalEvent.touches[0].pageY:i.pageY},touchdown(i,e){return ot.touchOrMouse(i,"touchstart","mousedown",e)},touchmove(i,e){return ot.touchOrMouse(i,"touchmove","mousemove",e)},touchendcancel(i,e){return ot.touchOrMouse(i,"touchend touchcancel","mouseup",e)},touchOrMouse(i,e,t,s){return s=s||"",s&&(s="."+s),i?e+s:t+s},isTouchEvent:em,fixTouchEvent(i){if(em(i)){let e=i.touches||(i.originalEvent?i.originalEvent.touches:null),t=e?e[0]:null;t&&(i.pageX=Math.round(t.pageX),i.pageY=Math.round(t.pageY))}},passiveOptions(){let i=!1;return x.get().supportsPassiveEventListener()&&(i={passive:!0}),i},onScrollStartEndDuringTouch(i,e,t){let s,r=!1,n=!1,o=c=>{r||(e(),r=!0),clearTimeout(s),h()},l=c=>{n=!0,h()};function h(){clearTimeout(s),s=setTimeout(()=>{n&&(d(),t())},50)}function d(){i.off("scroll",o),i.document(!1).off("touchend touchcancel",l)}i.on("scroll",o),i.document(!1).one("touchend touchcancel",l)},propagateEvent(i,e){if(typeof Event!="function")return;let t=new e.constructor(e.type,e);i.dispatchEvent(t)||e.preventDefault()},addPropagationListener(i,e,t,s){t=p.ensure(t),t.forEach(r=>{i.addEventListener(r,n=>{s&&!s(n)||ot.propagateEvent(e,n)})})},onSwipe(i,e,t,s,r){let n=i.window(!1),o=x.get().supportsOnlyTouch();i.on("touchmove",l=>l.preventDefault()),i.on("remove",l=>n.off("."+e)),i.on(ot.touchdown(o),l=>{let h=i.position().left;if(!(!t||!!t({originalEvent:l,originalLeft:h,deltaX:0,newLeft:h,direction:0})))return;let c=!0,f=ot.pageX(l),m=h,_=0;n.on(ot.touchmove(o,e),C=>{let R=ot.pageX(C)-f,L=h+R;if(L!==m&&(_=Math.sign(L-m)),s){let H=s({originalEvent:C,originalLeft:h,deltaX:R,newLeft:L,direction:_});m=typeof H=="number"?H:L}else m=L}),n.on(ot.touchendcancel(o,e),C=>{!c||(c=!1,n.off("."+e),r&&r({originalEvent:C,originalLeft:h,deltaX:m-h,newLeft:m,direction:_}))})})}},qs={validateMaximumUploadSize(i,e){return i=p.ensure(i),i.length===0||e==null?!0:i.reduce((s,r)=>s+r.size,0)<=e},fileListToArray(i){let e=[];for(let t=0;t<i.length;t++)e.push(i[t]);return e}};function xi(i,e,t){return e=_b(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function _b(i){var e=yb(i,"string");return typeof e=="symbol"?e:String(e)}function yb(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}let zh;class x{constructor(e){xi(this,"objectType",void 0),xi(this,"userAgent",void 0),xi(this,"features",void 0),xi(this,"system",void 0),xi(this,"type",void 0),xi(this,"browser",void 0),xi(this,"browserVersion",void 0),xi(this,"systemVersion",void 0),xi(this,"scrollbarWidth",void 0),this.userAgent=e.userAgent,this.features={},this.system=x.System.UNKNOWN,this.type=x.Type.DESKTOP,this.browser=x.Browser.UNKNOWN,this.browserVersion=0,this.scrollbarWidth=0,this.userAgent&&(this._parseSystem(),this._parseSystemVersion(),this._parseBrowser(),this._parseBrowserVersion())}bootstrap(){let e=[];return this.scrollbarWidth=this._detectScrollbarWidth(),this.type=this._detectType(this.userAgent),this.isIos()&&this._installActiveHandler(),this._needsIPhoneRotationHack()&&this._fixIPhoneRotationBug(),e}_loadScriptDeferred(e,t){return a().injectScript(e).done(t)}_installActiveHandler(){document.addEventListener("touchstart",()=>{},!1)}_needsIPhoneRotationHack(){return a().log.isDebugEnabled()&&a().log.debug("Activating iPhone rotation workaround."),this.isIphone()&&!this.isStandalone()&&a()(document.body).css("overflow")==="hidden"}_fixIPhoneRotationBug(){a().log.isDebugEnabled()&&a().log.debug("Enabling iPhone rotation workaround.");let e=this.orientation(),t=0,s=document.documentElement;window.addEventListener("resize",n=>{let o=x.get().orientation();e!==o&&(e=o,t=0,r())});function r(){setTimeout(()=>{s.scrollTop=0,++t<8&&r()},50)}}orientation(){return window.innerHeight>window.innerWidth?"portrait":"landscape"}hasOnScreenKeyboard(){return this.supportsFeature("_onScreenKeyboard",()=>this.isIos()||this.isAndroid()||this.isWindowsTabletMode())}isScrollWidthIncludingPadding(){return this.isInternetExplorer()||this.isFirefox()||this.isEdge()}isCustomEllipsisTooltipPossible(){return this.browser!==x.Browser.SAFARI}isIos(){return x.System.IOS===this.system}isEdge(){return x.Browser.EDGE===this.browser}cssClassForEdge(){return this.isEdge()?"ms-edge":""}cssClassForIphone(){return this.isIphone()?"iphone":""}isIphone(){return this.userAgent.indexOf("iPhone")>-1}isInternetExplorer(){return x.Browser.INTERNET_EXPLORER===this.browser}isFirefox(){return x.Browser.FIREFOX===this.browser}isChrome(){return x.Browser.CHROME===this.browser}isIosPlatform(){return/iPad|iPhone|iPod/.test(navigator.platform)}isAndroid(){return x.System.ANDROID===this.system}isWindowsTabletMode(){return x.System.WINDOWS===this.system&&this.systemVersion>=10&&this.scrollbarWidth===0}isStandalone(){return!!window.navigator.standalone}isSupportedBrowser(e,t){e=u.nvl(e,this.browser),t=u.nvl(t,this.browserVersion);let s=x.Browser;return e===s.CHROME&&t>=71||e===s.FIREFOX&&t>=69||e===s.SAFARI&&t>=12.1}_detectType(e){return x.System.ANDROID===this.system?e.indexOf("Mobile")>-1?x.Type.MOBILE:x.Type.TABLET:x.System.IOS===this.system?e.indexOf("iPad")>-1?x.Type.TABLET:x.Type.MOBILE:this.isWindowsTabletMode()?x.Type.TABLET:x.Type.DESKTOP}_parseSystem(){let e=this.userAgent;e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1?this.system=x.System.IOS:e.indexOf("Android")>-1?this.system=x.System.ANDROID:e.indexOf("Windows")>-1&&(this.system=x.System.WINDOWS)}_parseSystemVersion(){let e,t=x.System,s=this.userAgent;this.system===t.IOS?(e=/ OS ([0-9]+\.?[0-9]*)/,s=s.replace(/_/g,".")):this.system===t.WINDOWS&&(e=/Windows NT ([0-9]+\.?[0-9]*)/),e&&(this.systemVersion=this._parseVersion(s,e))}_parseBrowser(){let e=this.userAgent;e.indexOf("Firefox")>-1?this.browser=x.Browser.FIREFOX:e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1?this.browser=x.Browser.INTERNET_EXPLORER:e.indexOf("Edge")>-1?this.browser=x.Browser.EDGE:e.indexOf("Chrome")>-1?this.browser=x.Browser.CHROME:e.indexOf("Safari")>-1&&(this.browser=x.Browser.SAFARI)}_parseBrowserVersion(){let e,t=x.Browser,s=this.userAgent;if(this.browser===t.INTERNET_EXPLORER)s.indexOf("MSIE")>-1?e=/MSIE ([0-9]+\.?[0-9]*)/:e=/rv:([0-9]+\.?[0-9]*)/;else if(this.browser===t.EDGE)e=/Edge\/([0-9]+\.?[0-9]*)/;else if(this.browser===t.SAFARI){if(this.isIos()&&s.indexOf("Version/")<0){this.browserVersion=this.systemVersion;return}e=/Version\/([0-9]+\.?[0-9]*)/}else this.browser===t.FIREFOX?e=/Firefox\/([0-9]+\.?[0-9]*)/:this.browser===t.CHROME&&(e=/Chrome\/([0-9]+\.?[0-9]*)/);e&&(this.browserVersion=this._parseVersion(s,e))}_parseVersion(e,t){let s=t.exec(e);if(Array.isArray(s)&&s.length===2)return parseFloat(s[1])}supportsFeature(e,t){return this.features[e]===void 0&&(this.features[e]=t(e)),this.features[e]}supportsOnlyTouch(){return this.supportsFeature("_onlyTouch",this.hasOnScreenKeyboard.bind(this))}supportsTouch(){return this.supportsFeature("_touch",e=>"ontouchstart"in window||window.TouchEvent||window.DocumentTouch&&document instanceof window.DocumentTouch)}supportsFile(){return!!window.File}supportsFileConstructor(){return typeof File=="function"}supportsCssAnimation(){return this.supportsCssProperty("animation")}supportsHistoryApi(){return!!(window.history&&window.history.pushState)}supportsCssGradient(){let e="linear-gradient(to left, #000 0%, #000 50%, transparent 50%, transparent 100% )";return this.supportsFeature("gradient",this.checkCssValue.bind(this,"backgroundImage",e,t=>(t+"").indexOf("gradient")>0))}supportsInternationalization(){return window.Intl&&typeof window.Intl=="object"}supportsDownloadInSameWindow(){return x.Browser.FIREFOX!==this.browser}supportsWebcam(){return this.supportsFeature("_webcam",e=>{let t=b.optProperty(navigator,"mediaDevices","getUserMedia");return b.isFunction(t)})}supportsMicrotask(){return typeof queueMicrotask=="function"}supportsIntersectionObserver(){return typeof IntersectionObserver=="function"}hasPrettyScrollbars(){return this.supportsFeature("_prettyScrollbars",e=>this.scrollbarWidth===0)}canHideScrollbars(){return this.supportsFeature("_canHideScrollbars",e=>this._detectScrollbarWidth("hybrid-scrollable")===0)}supportsCopyFromDisabledInputFields(){return x.Browser.FIREFOX!==this.browser}loosesFocusIfPseudoElementIsRemoved(){return x.Browser.FIREFOX===this.browser}supportsCssProperty(e){return this.supportsFeature(e,t=>{if(document.body.style[t]!==void 0)return!0;t=t.charAt(0).toUpperCase()+t.slice(1);for(let s=0;s<x.VENDOR_PREFIXES.length;s++)if(document.body.style[x.VENDOR_PREFIXES[s]+t]!==void 0)return!0;return!1})}supportsGeolocation(){return!!navigator.geolocation}requiresSyntheticActiveState(){return this.isFirefox()}supportsPassiveEventListener(){return this.supportsFeature("_passiveEventListener",e=>{let t=!1;try{let s=Object.defineProperty({},"passive",{get:()=>(t=!0,!1)});window.addEventListener("test",s,s),window.removeEventListener("test",s,s)}catch{t=!1}return t})}checkCssValue(e,t,s){if(document.body.style[e]===void 0)return!1;let r=document.createElement("div");if(r.style[e]=t,s(r.style[e]))return!0;e=e.charAt(0).toUpperCase()+e.slice(1);for(let n=0;n<x.VENDOR_PREFIXES.length;n++){let o=x.VENDOR_PREFIXES[n]+e;if(document.body.style[o]!==void 0&&(r.style[o]=t,s(r.style[o])))return!0}return!1}hasTableCellZoomBug(){return this.browser===x.Browser.CHROME}_detectScrollbarWidth(e){let t=a()("body").appendDiv(e).attr("id","MeasureScrollbar").css("width",50).css("height",50).css("overflow-y","scroll"),s=t[0],r=s.offsetWidth-s.clientWidth;return t.remove(),r}toString(){return"scout.Device[system="+this.system+" browser="+this.browser+" browserVersion="+this.browserVersion+" type="+this.type+" scrollbarWidth="+this.scrollbarWidth+" features="+JSON.stringify(this.features)+"]"}static get(){return zh}}xi(x,"VENDOR_PREFIXES",["Webkit","Moz","O","ms","Khtml"]),xi(x,"Browser",{UNKNOWN:"Unknown",FIREFOX:"Firefox",CHROME:"Chrome",INTERNET_EXPLORER:"InternetExplorer",EDGE:"Edge",SAFARI:"Safari"}),xi(x,"System",{UNKNOWN:"Unknown",IOS:"IOS",ANDROID:"ANDROID",WINDOWS:"WINDOWS"}),xi(x,"Type",{DESKTOP:"DESKTOP",TABLET:"TABLET",MOBILE:"MOBILE"}),te.addListener("prepare",()=>{zh||(zh=u.create(x,{userAgent:navigator.userAgent}))});function kn(i,e,t){return e=bb(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function bb(i){var e=vb(i,"string");return typeof e=="symbol"?e:String(e)}function vb(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Vr{constructor(e){kn(this,"_lastPosX",void 0),kn(this,"_lastPosY",void 0),kn(this,"_lastTimestamp",void 0),kn(this,"_maxDoubleClickInterval",void 0),kn(this,"_maxDoubleClickDistance",void 0),kn(this,"_doubleClicked",void 0),e=e||{},this._lastPosX=null,this._lastPosY=null,this._lastTimestamp=null,this._maxDoubleClickInterval=e.maxDoubleClickInterval||500,this._maxDoubleClickDistance=e.maxDoubleClickDistance||10,this._doubleClicked=!1}mousedown(e){if(e&&e.type==="mousedown"){let t=u.nvl(e.pageX,0),s=u.nvl(e.pageY,0),r=Date.now(),n=!1;this._lastTimestamp!==void 0&&r-this._lastTimestamp<=this._maxDoubleClickInterval&&Math.max(Math.abs(t-this._lastPosX),Math.abs(s-this._lastPosY))<=this._maxDoubleClickDistance&&(n=!0),this._lastPosX=t,this._lastPosY=s,this._lastTimestamp=r,this._doubleClicked=n}}doubleClicked(){return this._doubleClicked}}function Ei(i,e,t){return e=wb(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function wb(i){var e=Tb(i,"string");return typeof e=="symbol"?e:String(e)}function Tb(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Kh{constructor(e){Ei(this,"additionalDropProperties",void 0),Ei(this,"allowedTypes",void 0),Ei(this,"dropType",void 0),Ei(this,"dropMaximumSize",void 0),Ei(this,"target",void 0),Ei(this,"onDrop",void 0),Ei(this,"validateFiles",void 0),Ei(this,"supportedScoutTypes",void 0),Ei(this,"$element",void 0),Ei(this,"selector",void 0),Ei(this,"_onDragEnterHandler",void 0),Ei(this,"_onDragOverHandler",void 0),Ei(this,"_onDropHandler",void 0),e=e||{},this.additionalDropProperties=null,this.allowedTypes=null,this.dropType=null,this.dropMaximumSize=null,this.target=null,this.onDrop=null,this.validateFiles=null,this.selector=null,this.$element=null,a().extend(this,e),this.supportedScoutTypes=p.ensure(e.supportedScoutTypes),this._onDragEnterHandler=this._onDragEnter.bind(this),this._onDragOverHandler=this._onDragOver.bind(this),this._onDropHandler=this._onDrop.bind(this)}install(e,t){if(this.$element)throw new Error("Already installed.");this.selector=t,this.$element=e,this.$element.on("dragenter",this.selector,this._onDragEnterHandler).on("dragover",this.selector,this._onDragOverHandler).on("drop",this.selector,this._onDropHandler)}uninstall(){this.$element.off("dragenter",this.selector,this._onDragEnterHandler).off("dragover",this.selector,this._onDragOverHandler).off("drop",this.selector,this._onDropHandler),this.$element=null,this.selector=null}_onDragEnter(e){this._onDragEnterOrOver(e)}_onDragOver(e){this._onDragEnterOrOver(e)}_onDragEnterOrOver(e){e.originalEvent.dataTransfer.dropEffect="copy",Fe.verifyDataTransferTypesScoutTypes(e,this.supportedScoutTypes,this.dropType())}_onDrop(e){if(this.supportedScoutTypes.indexOf(Fe.SCOUT_TYPES.FILE_TRANSFER)>=0&&(this.dropType()&Fe.SCOUT_TYPES.FILE_TRANSFER)===Fe.SCOUT_TYPES.FILE_TRANSFER&&Fe.dataTransferTypesContainsScoutTypes(e.originalEvent.dataTransfer,Fe.SCOUT_TYPES.FILE_TRANSFER)){if(!this.onDrop||!(e.originalEvent.dataTransfer.files instanceof FileList))return;let t=qs.fileListToArray(e.originalEvent.dataTransfer.files);if(p.empty(t))return;try{this.validateFiles(t,this._validateFiles.bind(this))}catch(s){this._validationFailed(s);return}e.stopPropagation(),e.preventDefault(),this.onDrop({originalEvent:e,files:t})}}_validateFiles(e){if(!this.dropMaximumSize)return;let t=this.dropMaximumSize();if(!qs.validateMaximumUploadSize(e,t))throw{title:this.target.session.text("ui.FileSizeLimitTitle"),message:this.target.session.text("ui.FileSizeLimit",t/1024/1024+"")}}_validationFailed(e){a().log.isDebugEnabled()&&a().log.debug("File validation failed",e);let t="",s="Invalid files";return e&&(t=e.title||t,s=e.message||s),rr.createOk(this.target).withSeverity(E.Severity.ERROR).withHeader(t).withBody(s).buildAndOpen()}uploadFiles(e){e&&e.originalEvent&&e.files.length>=1&&this.target.session.uploadFiles(this.target,e.files,this.additionalDropProperties?this.additionalDropProperties(e.originalEvent):void 0,this.dropMaximumSize?this.dropMaximumSize():void 0,this.allowedTypes?this.allowedTypes():void 0)}}const Fe={SCOUT_TYPES:{FILE_TRANSFER:1<<0,JAVA_ELEMENT_TRANSFER:1<<1,TEXT_TRANSFER:1<<2,IMAGE_TRANSFER:1<<3},DEFAULT_DROP_MAXIMUM_SIZE:50*1024*1024,scoutTypeToDragTypeMapping(i){i=p.ensure(i);let e=[];return i.indexOf(Fe.SCOUT_TYPES.FILE_TRANSFER)>=0&&e.push("Files"),e},verifyDataTransferTypesScoutTypes(i,e,t){e=p.ensure(e);let s=[];t!==void 0?e.forEach(r=>{(t&r)===r&&p.pushAll(s,Fe.scoutTypeToDragTypeMapping(e))}):s=Fe.scoutTypeToDragTypeMapping(e),Array.isArray(s)&&s.length>0&&Fe.verifyDataTransferTypes(i,s)},verifyDataTransferTypes(i,e){let t=i.originalEvent.dataTransfer;return Fe.dataTransferTypesContains(t,e)?(i.stopPropagation(),i.preventDefault(),!0):!1},dataTransferTypesContainsScoutTypes(i,e){e=p.ensure(e);let t=Fe.scoutTypeToDragTypeMapping(e);return Fe.dataTransferTypesContains(i,t)},dataTransferTypesContains(i,e){if(e=p.ensure(e),i&&i.types){if(Array.isArray(i.types)&&p.containsAny(i.types,e))return!0;if(i.types.contains)return e.some(t=>i.types.contains(t))}return!1},handler(i){return!i||!i.target?null:new Kh(i)},installOrUninstallDragAndDropHandler(i){!i.target||(i=$.extend({},Fe._createDragAndDropHandlerOptions(i.target),i),i.doInstall()?Fe._installDragAndDropHandler(i):Fe.uninstallDragAndDropHandler(i.target))},_installDragAndDropHandler(i){if(i.target.dragAndDropHandler||(i.target.dragAndDropHandler=Fe.handler(i),!i.target.dragAndDropHandler))return;let e=i.container();!e||i.target.dragAndDropHandler.install(e,i.selector)},_createDragAndDropHandlerOptions(i){return{target:i,supportedScoutTypes:Fe.SCOUT_TYPES.FILE_TRANSFER,validateFiles:(e,t)=>t(e),onDrop:e=>{},dropType:()=>Fe.SCOUT_TYPES.FILE_TRANSFER,dropMaximumSize:()=>i.dropMaximumSize,doInstall:()=>i.enabledComputed,container:()=>i.$container,additionalDropProperties:e=>{}}},uninstallDragAndDropHandler(i){!i||!i.dragAndDropHandler||(i.dragAndDropHandler.uninstall(),i.dragAndDropHandler=null)}},bt={_deferred:a().Deferred(),loadingComplete:!0,bootstrap(i){return i=i||bt.autoDetectFonts(),i.length===0?(bt.loadingComplete=!0,a().resolvedPromise()):(bt.loadingComplete=!1,bt.preload({fonts:i,onComplete:(e,t)=>{!e&&t&&t.length&&a().log.warn(`Timeout occurred while pre-loading the following fonts:

- `+t.join(`
- `)+`

Rendering will now continue, but font measurements may be inaccurate. To prevent unnecessary startup delays and layout problems, check the @font-face definitions and the referenced "src" URLs or programmatically add additional font-specific characters to TEST_STRING before calling app.init().`),bt.loadingComplete=!0,bt._deferred.resolve()}}),a().resolvedPromise())},preloader(){return bt._deferred.promise()},TEST_FONTS:"monospace",TEST_STRING:"ABC abc 123 .,_ LlIi1 oO0 !#@  ",TEST_TIMEOUT:12*1e3,preload(i){i=i||{fonts:null};let e=p.ensure(i.fonts);if(!i.onComplete)return;let t=[];if(e.forEach(d=>{if(typeof d=="string"){let _=y.splitMax(d,"|",3).map(C=>C.trim());d={family:_[0],style:_[1],testString:_[2]}}d.family=d.family||"",d.style=d.style||"",d.testString=d.testString||i.testString||bt.TEST_STRING;let c=d.testFonts||i.testFonts||bt.TEST_FONTS,f=a()("body").appendDiv("font-preloader").text(d.testString).css("display","block").css("visibility","hidden").css("position","absolute").css("top",0).css("left",0).css("width","auto").css("height","auto").css("margin",0).css("padding",0).css("white-space","nowrap").css("line-height","normal").css("font-variant","normal").css("font-size","20em").css("font-family",c),m=bt.measureSize(f);if(f.data("original-size",m),f.data("font-family",d.family),f.css("font-family","'"+d.family+"',"+c),d.style){let _=(f.attr("style")||"").trim(),C=(_.substr(-1)===";"?"":";")+(_?" ":"");f.attr("style",_+C+d.style)}bt.measureSize(f)!==m?f.remove():t.push(f)}),t.length===0){h(!0);return}let s=h,r=u.nvl(i.timeout,bt.TEST_TIMEOUT),n,o;r&&r>=0&&(o=setTimeout(()=>{clearTimeout(n),h(!1)},r),s=()=>{clearTimeout(o),h(!0)}),l(50,s);function l(d,c){let f=t.length;for(;f--;){let m=t[f];bt.measureSize(m)!==m.data("original-size")&&(t.splice(f,1),m.remove())}if(t.length===0){c(!0);return}n=setTimeout(()=>{d<1e3&&(d=d*1.2),l(d,c)},d)}function h(d){i.onComplete(d,t.map(c=>c.data("font-family")))}},measureSize(i){let e=v.size(i,{exact:!0});return e.width+"x"+e.height},autoDetectFonts(){let i=[],e=document.styleSheets;for(let t=0;t<e.length;t++){let s=e[t],r;try{r=s.cssRules}catch{a().log.info("Skipped automatic font detection for style sheet "+s.href+' (access blocked by browser). Use the bootstrap argument "fonts" to manually list fonts to pre-load.');continue}for(let n=0;n<s.cssRules.length;n++){let o=s.cssRules[n];if(o.type===window.CSSRule.FONT_FACE_RULE){let l=o.style,h=l.getPropertyValue("font-family"),d=l.getPropertyValue("font-weight"),c=l.getPropertyValue("font-style"),f=l.getPropertyValue("font-variant"),m=l.getPropertyValue("font-stretch");if(h){h=h.replace(/^["']|["']$/g,"");let _=[];d&&d!=="normal"&&_.push("font-weight:"+d),c&&c!=="normal"&&_.push("font-style:"+c),f&&f!=="normal"&&_.push("font-variant:"+f),m&&m!=="normal"&&_.push("font-stretch:"+m);let C={family:h};_.length&&(C.style=_.join(";")),i.push(C)}}}}return i}},ye={TABLE_SORT_ASC:"font:",TABLE_SORT_DESC:"font:",EXCLAMATION_MARK_BOLD:"font:",EXCLAMATION_MARK_CIRCLE:"font:",INFO:"font:",CALENDAR:"font:",FILE:"font:",CLOCK:"font:",CHECKED_BOLD:"font:",GROUP:"font:",GROUP_PLUS:"font:",ANGLE_DOUBLE_LEFT:"font:",ANGLE_DOUBLE_RIGHT:"font:",ANGLE_LEFT:"font:",ANGLE_RIGHT:"font:",ANGLE_DOWN:"font:",ANGLE_UP:"font:",LONG_ARROW_DOWN:"font:",LONG_ARROW_UP:"font:",LONG_ARROW_DOWN_PLUS:"font:",LONG_ARROW_UP_PLUS:"font:",MINUS:"font:",PLUS:"font:",LIST:"font:",TARGET:"font:",WORLD:"font:",CHART:"font:",GEAR:"font:",STAR:"font:",STAR_MARKED:"font:",STAR_BOLD:"font:",STAR_SOLID:"font:",PERSON_SOLID:"font:",SEARCH:"font:",FOLDER:"font:",SUM:"font:",AVG:"font:",MAX:"font:",MAX_BOLD:"font:",MIN:"font:",MIN_BOLD:"font:",EXPAND_ALL:"font:",COLLAPSE_ALL:"font:",COLLAPSE:"font:",ELLIPSIS_V:"font:",SLIPPERY:"font:",REMOVE:"font:",REMOVE_BOLD:"font:",PENCIL:"font:",PENCIL_UNDERLINE_SOLID:"font:",ROTATE_LEFT:"font:",ROTATE_RIGHT:"font:",HOURGLASS:"font:",DIAGRAM_AREA:"font:",DIAGRAM_BAR:"font:",DIAGRAM_BARS_HORIZONTAL:"font:",DIAGRAM_BARS_VERTICAL:"font:",DIAGRAM_DOUGHNUT:"font:",DIAGRAM_LINE:"font:",DIAGRAM_LINE_ANGULAR:"font:",DIAGRAM_LINE_SMOOTH:"font:",DIAGRAM_PIE:"font:",DIAGRAM_RADAR:"font:",DIAGRAM_SCATTER:"font:",CHEVRON_LEFT_BOLD:"font:",CHEVRON_RIGHT_BOLD:"font:",CHEVRON_UP_BOLD:"font:",CHEVRON_DOWN_BOLD:"font:",ARROW_RIGHT_BOLD:"font:",PLUS_BOLD:"font:",MINUS_BOLD:"font:",SQUARE_BOLD:"font:",CARET_DOWN:"font:",CARET_UP:"font:",CARET_LEFT:"font:",CARET_RIGHT:"font:",ANGLE_LEFT_BOLD:"font:",ANGLE_RIGHT_BOLD:"font:",ANGLE_UP_BOLD:"font:",ANGLE_DOWN_BOLD:"font:",CIRCLE_BOLD:"font:",LONG_ARROW_DOWN_BOLD:"font:",LONG_ARROW_UP_BOLD:"font:",LONG_ARROW_LEFT_BOLD:"font:",LONG_ARROW_RIGHT_BOLD:"font:",ICON_ID_REGEX:/\${iconId:([a-zA-Z0-9_.]*)}/,parseIconId(i){let e=new ni;if(y.startsWith(i,"font:"))if(e.iconType=ni.IconType.FONT_ICON,i=i.substr(5),y.countCodePoints(i)===1)e.font=ni.DEFAULT_FONT,e.iconCharacter=i;else{let t=i.split(" ");e.font=t[0],e.iconCharacter=t[1]}else e.iconType=ni.IconType.BITMAP,e.iconUrl=i;return e},resolveIconId(i){let e,t,s=ye.ICON_ID_REGEX.exec(i);return s&&s.length===2&&(e=s[1],t=e.split("."),t.length===1?i=ye[t]:t.length===2?i=window[t[0]].icons[t[1]]:a().log.warn("Invalid iconId: "+i)),i},resolveIconProperty(i,e){e=e||"iconId";let t=i[e],s=ye.resolveIconId(t);s!==t&&(i[e]=s)}},Hn={applyInfo(i,e){!i||(e=e||i.$container,e&&(e.toggleAttr("data-id",!!i.id,i.id),e.toggleAttr("data-modelclass",!!i.modelClass,i.modelClass),e.toggleAttr("data-classid",!!i.classId,i.classId)))}},_t={localesMap:{},bootstrap(i){return(i?a().ajaxJson(i):a().resolvedPromise([])).then(_t._preInit.bind(this,i))},_preInit(i,e){if(e&&e.error)throw{error:e.error,url:i};_t.init(e)},init(i){i.forEach(e=>{_t.localesMap[e.languageTag]=new qt(e)})},_get(i){return _t.localesMap[i]},has(i,e){return e=u.nvl(e,!1),e?!!_t._get(i):!!_t.get(i)},get(i){let e;return Ce.createOrderedLanguageTags(i).some(s=>(e=_t._get(s),!!e),this),e||null},getNavigatorLanguage(){return navigator.language||navigator.userLanguage},getNavigatorLocale(){let i=_t.getNavigatorLanguage();if(!i)return a().log.warn("Browser returned no language. Using default locale."),new qt;let e=_t.get(i);if(e)return e;a().log.isInfoEnabled()&&a().log.info("Locale for languageTag "+i+" not found. Trying to load best match.");let t=_t.splitLanguageTag(i)[0];return e=_t.findFirstForLanguage(t),e||(a().log.isInfoEnabled()&&a().log.info("Still no matching locale for languageTag "+i+" found. Using default locale."),new qt)},getAll(){return b.values(_t.localesMap)},getAllLanguageTags(){return Object.keys(_t.localesMap)},findFirstForLanguage(i){return u.assertParameter("language",i),p.find(_t.getAll(),e=>e.language===i,this)},splitLanguageTag(i){return i?i.split("-"):[]}};function kl(i,e,t){return e=Cb(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Cb(i){var e=Sb(i,"string");return typeof e=="symbol"?e:String(e)}function Sb(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ho{constructor(e){kl(this,"objectType",void 0),kl(this,"onInputFieldPaste",void 0),kl(this,"target",void 0),kl(this,"$textInputField",void 0),e=e||{},u.assertValue(e.target,"target is mandatory"),this.$textInputField=null,this.onInputFieldPaste=this._onInputFieldPaste.bind(this),this.target=null,a().extend(this,e)}install(e){this.uninstall(),!(!e||!e.is("input:text")&&!e.is("textarea"))&&e&&(this.$textInputField=e,this.$textInputField.on("paste",this.onInputFieldPaste))}uninstall(){this.$textInputField&&this.$textInputField.off("paste",this.onInputFieldPaste)}render(){if(!this.$textInputField||b.isNullOrUndefined(this.target.maxLength))return;this.$textInputField.attr("maxlength",this.target.maxLength);let e=this.$textInputField.val();e.length>this.target.maxLength&&this.$textInputField.val(e.slice(0,this.target.maxLength)),this.target.rendering||this.target.parseAndSetValue(this.target._readDisplayText())}_onInputFieldPaste(e){if(!this.$textInputField||b.isNullOrUndefined(this.target.maxLength))return;let s=this.$textInputField.val().length-this._getSelectionSize();this._getClipboardData(e,r=>{!r||s+r.length>this.target.maxLength&&this._showNotification("ui.PastedTextTooLong")})}_getSelectionSize(){let e=u.nvl(this.$textInputField[0].selectionStart,null),t=u.nvl(this.$textInputField[0].selectionEnd,null);return e===null||t===null?0:t-e}_getClipboardData(e,t){let s=e.originalEvent.clipboardData||this.target.$container.window(!0).clipboardData;if(s){if(s.items&&s.items.length){let r=p.find(s.items,n=>n.type==="text/plain");r&&r.getAsString(t);return}s.getData&&t(s.getData("Text"))}}_showNotification(e){u.create(ti,{parent:this.target,severity:E.Severity.WARNING,message:this.target.session.text(e)}).show()}}var qe;(function(i){i.TRACE="trace",i.DEBUG="debug",i.INFO="info",i.WARN="warn",i.ERROR="error",i.FATAL="fatal"})(qe||(qe={}));const ci={_appendersToAdd:[],DEFAULT_LEVEL:qe.TRACE,initialized:!1,showStackTraces:!0,bootstrap(i){let e=new vt,t=e.getParameter("logging"),s=e.getParameter("logLevel");i=u.nvl(i,{});let r=!!(i.enabled||t),n=!!(i.showPopup||t),o=y.nvl(i.resourceUrl);return a().log=new Hl,r?log4javascript?(ci.initLog4Javascript(s,n),a().resolvedPromise()):a().injectScript(o+"log4javascript-1.4.9/log4javascript.js").done(ci.initLog4Javascript.bind(this,s,n)):a().resolvedPromise()},initLog4Javascript(i,e){i=u.nvl(i,ci.DEFAULT_LEVEL),log4javascript.setShowStackTraces(ci.showStackTraces);let t=log4javascript.getDefaultLogger();t.setLevel(ci.parseLevel(i)),a().log=t,ci.initialized=!0,e?t.getEffectiveAppenders().forEach(s=>{s.setUseDocumentWrite(!1)}):t.removeAllAppenders(),ci._appendersToAdd.forEach(s=>{ci.addAppender(s.factoryName,s.options)}),ci._appendersToAdd=[]},parseLevel(i){if(!!i)switch(i=i.toLowerCase(),i){case qe.TRACE:return log4javascript.Level.TRACE;case qe.DEBUG:return log4javascript.Level.DEBUG;case qe.INFO:return log4javascript.Level.INFO;case qe.WARN:return log4javascript.Level.WARN;case qe.ERROR:return log4javascript.Level.ERROR;case qe.FATAL:return log4javascript.Level.FATAL}},addAppender(i,e){if(!ci.initialized){ci._appendersToAdd.push({factoryName:i,options:e});return}let t=u.create(i,e);a().log.addAppender(t.create())}};class Hl{trace(){}debug(){}info(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this._log(qe.INFO,t)}warn(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this._log(qe.WARN,t)}error(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this._log(qe.ERROR,t)}fatal(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this._log(qe.FATAL,t)}isEnabledFor(){return!1}isTraceEnabled(){return!1}isDebugEnabled(){return!1}isInfoEnabled(){return!1}isWarnEnabled(){return!1}isErrorEnabled(){return!1}isFatalEnabled(){return!1}_log(e,t){let s=b.optProperty(window,"console");if(!s)return;let r;qe.FATAL===e?r="error":r=e;let n=s[r];if(!!n){t.length>0&&(t[0]=this._formatTime()+" ["+e.toUpperCase()+"] "+t[0]);try{n.apply(s,t)}catch{}}}_formatTime(){let e=new Date;return y.padZeroLeft(e.getHours(),2)+":"+y.padZeroLeft(e.getMinutes(),2)+":"+y.padZeroLeft(e.getSeconds(),2)+"."+y.padZeroLeft(e.getMilliseconds(),3)}}const tm="application/json",im="application/javascript",sm="application/zip",lt={TEXT_PLAIN:"text/plain",TEXT_HTML:"text/html",TEXT_CSS:"text/css",TEXT_JAVASCRIPT:"text/javascript",IMAGE_PNG:"image/png",IMAGE_JPG:"image/jpg",IMAGE_JPEG:"image/jpeg",IMAGE_GIF:"image/gif",APPLICATION_JSON:tm,APPLICATION_JAVASCRIPT:im,APPLICATION_ZIP:sm,JSON:tm,JAVASCRIPT:im,ZIP:sm,isTextMimeType(i){return u.isOneOf(i,lt.TEXT_PLAIN,lt.TEXT_HTML,lt.TEXT_CSS,lt.TEXT_JAVASCRIPT,lt.APPLICATION_JAVASCRIPT,lt.APPLICATION_JSON)},isJavaScript(i){return u.isOneOf(i,lt.TEXT_JAVASCRIPT,lt.APPLICATION_JAVASCRIPT)}};function Pb(i,e){let t=i();return e&&(t.parent=e),t}const ur={modelMap:{},init(i){ur.modelMap=i},get:Pb,getExtension(i){return ur._get(i,"extension")},_get(i,e){let t=ur.modelMap[i];if(!t)throw new Error("No model map entry found for id '"+i+"'");if(u.nvl(t.type,"model")!==e)throw new Error("Model '"+i+"' is not of type '"+e+"'");return a().extend(!0,{},t)},extend(i,e){let t;return typeof i=="string"?t=ur.getExtension(i):typeof i=="function"?t=i():t=i,u.assertParameter("extensions",t.extensions),t.extensions.forEach(s=>{let r=u.assertParameter("operation",s.operation),n=u.assertParameter("target",s.target),o;if(n.root?o=e:o=b.findChildObjectByKey(e,"id",n.id),!o)throw new Error("Extension target not found: [extension: "+t.id+", target: "+n.id+"]");if(r==="appendTo")a().extend(o,s.extension);else if(r==="insert"){let l=n;o[l.property]=o[l.property]||[];let h=o[l.property],d=p.ensure(s.extension);ur._bindExtensionsToBeforeOrAfter(l,d);let c=ur._findExtensionIndex(l,h);p.insertAll(h,d,c)}}),e},_findExtensionIndex(i,e){let t=e.length;return i.before?(t=p.findIndex(e,s=>s.id===i.before||s.groupedWith===i.before),t===-1&&(t=e.length)):i.after&&(t=p.findIndex(e,s=>s.id===i.after||s.groupedWith===i.after),t===-1?t=e.length:t++),Ke.isNumber(i.index)&&(t=i.index),t},_bindExtensionsToBeforeOrAfter(i,e){let t=i.before||i.after;t&&i.groupWithTarget&&e.forEach(s=>{s.groupedWith=t})}},Ke={toBase62(i){if(i===void 0)return;let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".split(""),t=62,s="",r;for(;i>=1;)r=Math.floor(i/t),s=e[i-t*r]+s,i=r;return s},randomId(i){i=i||8;let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t="";for(let s=0;s<i;s++)t+=e[Math.floor(Math.random()*e.length)];return t},_correlationCounter:1,correlationId(i){i=i||11;let e="abcdefghjkmnpqrstuvwxyzABCDEFGHJKMNPQRSTUVWXYZ",t="23456789",s="";for(let r=0;r<i;r++)(r+1)%3===0?s+=t[Math.floor(Math.random()*t.length)]:s+=e[Math.floor(Math.random()*e.length)];return s+"/"+Ke._correlationCounter++},round(i,e,t){if(i==null)return i;switch(t=t||0,i=Ke.shiftDecimalPoint(i,t),e){case ns.UP:i<0?i=-Math.ceil(Math.abs(i)):i=Math.ceil(i);break;case ns.DOWN:i<0?i=-Math.floor(Math.abs(i)):i=Math.floor(i);break;case ns.CEILING:i=Math.ceil(i);break;case ns.FLOOR:i=Math.floor(i);break;case ns.HALF_DOWN:i<0?i=Math.round(i):i=-Math.round(-i);break;default:i<0?i=-Math.round(Math.abs(i)):i=Math.round(i)}return Ke.shiftDecimalPoint(i,-t)},shiftDecimalPoint(i,e){if(i==null||!e)return i;let t=i?i<0?-1:1:0,s=Math.abs(e);i=Math.abs(i);let r=y.asString(i);r.indexOf("e")!==-1&&(r=i.toFixed(20));let n;return e<0?(r=y.repeat("0",s)+r,n=r.split(".",2),n.length===1?r=r.substr(0,r.length-s)+"."+r.substr(r.length-s):r=n[0].substr(0,n[0].length-s)+"."+n[0].substr(n[0].length-s)+n[1]):e>0&&(r+=y.repeat("0",s),n=r.split(".",2),n.length===2&&(r=n[0]+n[1].substr(0,s)+"."+n[1].substr(s))),r=r.replace(/^0*(\d)/g,"$1"),Number(r)*t},ensure(i){return b.isNullOrUndefined(i)?i:Number(i)},isNumber(i){return typeof i=="number"&&!isNaN(i)},isInteger(i){return Ke.isNumber(i)&&isFinite(i)&&Math.floor(i)===i},_setCorrelationCounter(i){Ke._correlationCounter=i}};var ns;(function(i){i.UP="UP",i.DOWN="DOWN",i.CEILING="CEILING",i.FLOOR="FLOOR",i.HALF_UP="HALF_UP",i.HALF_DOWN="HALF_DOWN",i.HALF_EVEN="HALF_EVEN",i.UNNECESSARY="UNNECESSARY"})(ns||(ns={}));const xb=/\${const:([^}]*)}/,b={createMap(i){let e=Object.create(null);return i&&a().extend(e,i),e},copyProperties(i,e,t){let s;t=p.ensure(t);for(s in i)(t.length===0||t.indexOf(s)!==-1)&&(e[s]=i[s]);return e},copyOwnProperties(i,e,t){let s;t=p.ensure(t);for(s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t.length===0||t.indexOf(s)!==-1)&&(e[s]=i[s]);return e},countOwnProperties(i){if(!Object.getPrototypeOf(i))return Object.keys(i).length;let e=0;for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&e++;return e},extractProperties(i,e,t){return t.forEach(s=>{e[s]===void 0&&(e[s]=i[s])}),e},someOwnProperties(i,e){return p.ensure(e).some(s=>Object.prototype.hasOwnProperty.call(i,s))},someProperties(i,e){return p.ensure(e).some(s=>s in i)},valueCopy(i){if(i==null||typeof i!="object")return i;let e;if(Array.isArray(i)){e=[];for(let t=0;t<i.length;t++)e[t]=b.valueCopy(i[t]);return e}e={};for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=b.valueCopy(i[t]));return e},findChildObjectByKey(i,e,t){if(i==null||typeof i!="object")return null;if(i[e]===t)return i;let s;if(Array.isArray(i)){for(let r=0;r<i.length;r++)if(s=b.findChildObjectByKey(i[r],e,t),s)return s}for(let r in i)if(Object.prototype.hasOwnProperty.call(i,r)&&(s=b.findChildObjectByKey(i[r],e,t),s))return s;return null},getByPath(i,e){u.assertParameter("object",i,Object),u.assertParameter("path",e);const t="(\\w+)(?:\\[((?:\\w|\\.|-)+)\\])?";if(!new RegExp("^"+t+"(?:\\."+t+")*$").test(e))throw new Error('Malformed path expression "'+e+'"');const r=new RegExp(t);let n="",o=i;return e.split(/\.(?![^[]*])/).forEach(l=>{if(b.isNullOrUndefined(o))throw new Error('Value selected by matched path "'+n+'" is null or undefined. Further traversal not possible.');let h=r.exec(l),d=h[1],c=h[2],f=n.length===0?"root level of the provided object.":'matched path "'+n+'".';if(!o.hasOwnProperty(d))throw new Error('Property "'+d+'" does not exist at the '+f);let m=o[d];if(c){if(!Array.isArray(m))throw new Error('Path element "'+l+'" contains array filter but property "'+d+'" does not contain an array at the '+f);let _=m.filter(C=>C.id===c);if(_.length===0)throw new Error('No object found with id property "'+c+'" in array property "'+d+'" at the '+f);if(_.length>1)throw new Error('More than one object found with id property "'+c+'" in array property "'+d+'" at the '+f);o=_[0]}else o=m;n&&(n+="."),n+=l}),o},isPlainObject(i){return typeof i=="object"&&!b.isNullOrUndefined(i)&&!Array.isArray(i)},optProperty(i){if(!i)return null;for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];let r=t.length;if(r===0)return i;if(r===1)return i[t[0]];for(let n=0;n<r-1;n++)if(i=i[t[n]],!i)return null;return i[t[r-1]]},isNumber(i){return i!==null&&!isNaN(i)&&isFinite(i)&&!isNaN(parseFloat(i))},isString(i){return typeof i=="string"||i instanceof String},isNullOrUndefined(i){return i==null},isFunction(i){return a().isFunction(i)},isNullOrUndefinedOrEmpty(i){return b.isNullOrUndefined(i)?!0:b.isArray(i)?p.empty(i):b.isEmpty(i)},isArray(i){return Array.isArray(i)},isPromise(i){return!!i&&typeof i=="object"&&typeof i.then=="function"},values(i,e){let t=[];if(i){typeof i.hasOwnProperty!="function"&&(e=!0);for(let s in i)(e||i.hasOwnProperty(s))&&t.push(i[s])}return t},keyByValue(i,e){return Object.keys(i)[b.values(i).indexOf(e)]},equals(i,e){return i===e?!0:i&&e&&i.equals&&e.equals?i.equals(e):!1},equalsRecursive(i,e){let t;if(b.isPlainObject(i)&&b.isPlainObject(e)){if(b.isFunction(i.equals)&&b.isFunction(e.equals))return i.equals(e);let s=Object.keys(i),r=Object.keys(e);if(!p.equalsIgnoreOrder(s,r))return!1;for(t=0;t<s.length;t++)if(!b.equalsRecursive(i[s[t]],e[s[t]]))return!1;return!0}else if(b.isArray(i)&&b.isArray(e)){if(i.length!==e.length)return!1;for(t=0;t<i.length;t++)if(!b.equalsRecursive(i[t],e[t]))return!1;return!0}return i===e},propertiesEquals(i,e,t){let s,r;for(s=0;s<t.length;s++)if(r=t[s],!b.equals(i[r],e[r]))return!1;return!0},mandatoryFunction(i,e){let t=i[e];if(!t||typeof t!="function")throw new Error("Function '"+e+"' does not exist on object. Check if it has been renamed or moved. Object: "+i);return t},replacePrototypeFunction(i,e,t,s){let r=i.prototype;b.mandatoryFunction(r,e),s&&(r[e+"Orig"]=r[e]),r[e]=t},argumentsToArray(i){return i?Array.prototype.slice.call(i):[]},forEachArgument(i,e){return b.argumentsToArray(i).forEach(e)},checkFunctionOverrides(){let i=["ModelAdapter.init","ModelAdapter._init","Calendar.init"],e=["Legend:","[!] Function includes super call, and parent function uses arguments"," ~  Function includes super call, but parent function does not use arguments","    Function does not include super call","","Wrong number of arguments:"],t=["Different argument names:"];for(let n in u){if(!u.hasOwnProperty(n))continue;let o=u[n];if(typeof o=="function"&&o.parent)for(let l in o.prototype){if(!o.prototype.hasOwnProperty(l))continue;let h=o.prototype[l];if(l==="constructor"||!o.prototype.hasOwnProperty(l)||typeof h!="function")continue;let d=s(h),c=o.parent;for(;c;){let f=c.prototype[l];if(c.prototype.hasOwnProperty(l)&&typeof f=="function"){let m=s(f),_=!1;for(let S=0;S<m.length;S++)if(d.length<S||d[S]!==m[S]){_=!0;break}let C=n+"."+l;if(_&&i.indexOf(C)===-1){let S=C+"("+d.join(", ")+") does not correctly override "+r(f)+"."+l+"("+m.join(", ")+")",R=h.toString().match(new RegExp("scout."+y.quote(n)+".parent.prototype."+y.quote(l)+".call\\("))!==null,L=!1;if(R)for(let H=0;H<m.length;H++){let we=f.toString().match(new RegExp("[^.\\w]"+y.quote(m[H])+"[^\\w]","g"));if(we!==null&&we.length>1){L=!0;break}}S=(R?L?"[!]":" ~ ":"   ")+" "+S,d.length!==m.length?e.push(S):t.push(S)}}c=c.parent}}}return e.push(""),e.concat(t);function s(n){let o=/\/\*.*?\*\/|\/\/.*$/mg,l=/^function[^(]*\((.*?)\)/m;if(typeof n!="function")throw new Error("Argument is not a function: "+n);let h=n.toString().replace(o,"").match(l),d=[];return h!==null&&h[1].split(",").forEach((c,f)=>{c=c.trim(),c.length>0&&d.push(c)}),d}function r(n){for(let o in u){if(!u.hasOwnProperty(o))continue;let l=u[o];if(typeof l=="function")for(let h in l.prototype){if(!l.prototype.hasOwnProperty(h))continue;let d=l.prototype[h];if(!(h==="constructor"||!l.prototype.hasOwnProperty(h)||typeof d!="function")&&d===n)return o}}return""}},resolveConst(i,e){if(!b.isString(i))return i;let t=xb.exec(i);if(t&&t.length===2){let s=t[1].split("."),r=e||window;for(let n=0;n<s.length;n++)if(r=r[s[n]],r===void 0)return window.console.log("Failed to resolve constant '"+t[1]+"', object is undefined"),i;return r}return i},resolveConstProperty(i,e){u.assertProperty(e,"property"),u.assertProperty(e,"constType");let t=i[e.property],s=b.resolveConst(t,e.constType);t!==s&&(i[e.property]=s)},removeEmptyProperties(i){if(b.isNullOrUndefined(i))return i;if(!b.isPlainObject(i))throw new Error("Not an object: "+i);return Object.keys(i).forEach(e=>{b.isNullOrUndefinedOrEmpty(i[e])&&delete i[e]}),i},isEmpty(i){if(b.isNullOrUndefined(i))return!0;if(!!b.isPlainObject(i))return Object.keys(i).length===0},ensureValidKey(i){return i===void 0?"undefined":b.isString(i)?i:JSON.stringify(i)}};function No(i,e,t){return e=Eb(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Eb(i){var e=Fb(i,"string");return typeof e=="symbol"?e:String(e)}function Fb(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class rm{constructor(e){No(this,"results",void 0),No(this,"error",void 0),No(this,"items",void 0),No(this,"currentItem",void 0),No(this,"aborted",void 0),this.results=[],this.error=null,this.items=e,this.currentItem=0,this.aborted=!1}hasNext(){return this.error||this.aborted?!1:this.currentItem<this.items.length}next(){var e=this;let t=this.currentItem;return this.createPromise().done(function(){for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];e._addResults.apply(e,[t,r])}).fail(function(){this.error=arguments.length>0?arguments:new Error("Promise execution failed")}.bind(this))}createPromise(){if(this.currentItem>=this.items.length)throw new Error("items out of bounds");let e=this._createPromise();return this.currentItem++,e}_createPromise(){return this.items[this.currentItem]()}_addResults(e,t){t.length===0?t=void 0:t.length===1&&(t=t[0]),this.results[e]=t}abort(){this.aborted=!0}}const nm={oneByOne(i){let e=a().Deferred();return r(i),e.promise();function t(){setTimeout(r.bind(this,i))}function s(){e.reject.apply(e,i.error)}function r(n){n.hasNext()?n.next().done(t).fail(s):e.resolve.apply(e,n.results)}},groupwise(i,e){let t=a().Deferred();return n(e),t.promise();function s(){setTimeout(n.bind(this,e))}function r(){t.reject.apply(t,e.error)}function n(o){if(o.hasNext()){let l=[];for(;l.length<i&&o.hasNext();)l.push(o.next());a().promiseAll(l,!0).done(s).fail(r)}else t.resolve.apply(t,o.results)}},parallel(i,e,t){t=t||0;let s=a().Deferred(),r=0;return l(e),s.promise();function n(){r--,setTimeout(l.bind(this,e),t)}function o(){s.reject.apply(s,e.error)}function l(h){if(s.state()==="pending"){for(;h.hasNext()&&r<i;)r++,h.next().done(n).fail(o);r===0&&s.resolve.apply(s,[h.results])}}}};function om(i,e,t){return e=Db(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Db(i){var e=Ab(i,"string");return typeof e=="symbol"?e:String(e)}function Ab(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class B{constructor(e,t){om(this,"from",void 0),om(this,"to",void 0),this.from=e,this.to=t}equals(e){return this.from===e.from&&this.to===e.to}subtract(e){if(e.size()===0)return[new B(this.from,this.to)];if(this.from>=e.from&&this.to<=e.to)return[new B(0,0)];if(e.from>=this.from&&e.to<=this.to){let t=new B(this.from,e.from),s=new B(e.to,this.to);return t.size()===0?[s]:s.size()===0?[t]:[t,s]}return e.from>this.from&&e.from<this.to?[new B(this.from,e.from)]:this.from>e.from&&this.from<e.to?[new B(e.to,this.to)]:[new B(this.from,this.to)]}subtractAll(e){let t=e.shift(),s=[this],r=[];for(;t;)s.forEach(n.bind(t)),s=r,r=[],t=e.shift();s=s.filter(o=>o.size()>0),s.length===0&&s.push(new B(0,0));function n(o){p.pushAll(r,o.subtract(t))}return s}shrink(e){return e.size()===0?new B(this.from,this.to):this.from>=e.from&&this.to<=e.to?new B(0,0):e.from>=this.from&&e.to<=this.to?new B(this.from,e.to):e.from>=this.from&&e.from<this.to?new B(this.from,e.from):this.from>e.from&&this.from<e.to?new B(e.to,this.to):e.to<this.from?new B(this.from-e.size()-1,this.to-e.size()-1):new B(this.from,this.to)}union(e){if(this.to<e.from||e.to<this.from){let t=new B(this.from,this.to),s=new B(e.from,e.to);return t.size()===0?[s]:s.size()===0?[t]:[t,s]}return[new B(Math.min(this.from,e.from),Math.max(this.to,e.to))]}add(e){if(this.to<e.from||e.to<this.from){let t=new B(this.from,this.to),s=new B(e.from,e.to);if(t.size()===0)return s;if(s.size()===0)return t;throw new Error("Range to add has to border on the existing range. "+this+", "+e)}return new B(Math.min(this.from,e.from),Math.max(this.to,e.to))}intersect(e){return this.to<=e.from||e.to<=this.from?new B(0,0):new B(Math.max(this.from,e.from),Math.min(this.to,e.to))}size(){return this.to-this.from}contains(e){return this.from<=e&&e<this.to}toString(){return"scout.Range[from="+(this.from===null?"null":this.from)+" to="+(this.to===null?"null":this.to)+"]"}}function Cs(i,e,t){return e=$b(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function $b(i){var e=Rb(i,"string");return typeof e=="symbol"?e:String(e)}function Rb(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class E{constructor(e){if(Cs(this,"objectType",void 0),Cs(this,"message",void 0),Cs(this,"severity",void 0),Cs(this,"iconId",void 0),Cs(this,"code",void 0),Cs(this,"children",void 0),Cs(this,"deletable",void 0),Cs(this,"uiState",void 0),this.message=null,this.severity=E.Severity.ERROR,this.iconId=null,this.code=0,this.children=null,this.deletable=!0,a().extend(this,e),typeof this.severity=="string"){let t=this.severity;this.severity=E.Severity[t.toUpperCase()]}e&&e.children&&Array.isArray(e.children)&&(this.children=e.children.map(t=>E.ensure(t)))}cssClass(){return E.cssClassForSeverity(this.severity)}isValid(){return this.severity===E.Severity.OK||this.severity===E.Severity.INFO}isError(){return this.severity===E.Severity.ERROR}isWarning(){return this.severity===E.Severity.WARNING}isInfo(){return this.severity===E.Severity.INFO}isOk(){return this.severity===E.Severity.OK}asFlatList(){return E.asFlatList(this)}clone(){let e=a().extend({},this);return new E(e)}equals(e){return!(e instanceof E)||!b.equalsRecursive(this.children,e.children)?!1:b.propertiesEquals(this,e,["severity","message","invalidDate","invalidTime"])}containsStatus(e){return this.containsStatusByPredicate(t=>t instanceof e)}containsStatusByPredicate(e){return this.asFlatList().some(e)}addStatus(e){this.hasChildren()?this.children.push(e):this.children=[e],this._updateProperties()}removeAllStatus(e){this.removeAllStatusByPredicate(t=>t instanceof e)}removeAllStatusByPredicate(e){this.hasChildren()&&(this.children.forEach(t=>{t.removeAllStatusByPredicate(e)}),this.children=this.children.filter(t=>t.deletable?!e(t):!0),this._updateProperties())}_updateProperties(){if(!this.hasChildren()){this.message=null,this.severity=E.Severity.OK,this.code=0;return}let e=this.asFlatList().sort((t,s)=>{return r(s)-r(t);function r(n){let o=1;return n instanceof pi?o=4:n instanceof Vo&&(o=2),o*n.severity}})[0];this.message=e.message,this.severity=e.severity,this.code=e.code}hasChildren(){return!!(this.children&&this.children.length>0)}ensureChildren(){if(b.isArray(this.children))return this.clone();let e=this,t=this.clone();return t.children=[e],t._updateProperties(),t}static clone(e){return e?e.clone():null}static cssClassForSeverity(e){let t,s=E.Severity;switch(e){case s.OK:t="ok";break;case s.INFO:t="info";break;case s.WARNING:t="warning";break;case s.ERROR:t="error";break}return t}static animateStatusMessage(e,t){if(y.endsWith(t,"...")){let s=e.makeSpan("ellipsis");for(let r=0;r<3;r++)s.append(e.makeSpan("animate-dot delay-"+r,"."));t=t.substring(0,t.length-3),e.empty().text(t).append(s)}else e.text(t)}static ok(e){return new E(E.ensureModel(e,E.Severity.OK))}static info(e){return new E(E.ensureModel(e,E.Severity.INFO))}static warning(e){return new E(E.ensureModel(e,E.Severity.WARNING))}static error(e){return new E(E.ensureModel(e,E.Severity.ERROR))}static ensureModel(e,t){return typeof e=="string"?e={message:e}:e=e||{},a().extend({},e,{severity:t})}static asFlatList(e){if(!e)return[];let t=[];return e.hasChildren()?(e.children.forEach(s=>{p.pushAll(t,E.asFlatList(s))}),t.sort((s,r)=>s instanceof Ss?r instanceof Ss?0:-1:r instanceof Ss?1:0)):t.push(e),t}static classForName(e){return{Status:E,DefaultStatus:Wr,NotificationBadgeStatus:Ss,ParsingFailedStatus:pi,ValidationFailedStatus:Vo}[e]}static ensure(e){return!e||e instanceof E?e:(e.objectType||(e.objectType=E),u.create(e))}}Cs(E,"Severity",{OK:1,INFO:256,WARNING:65536,ERROR:16777216}),Cs(E,"SEVERITY_CSS_CLASSES","error warning info ok");class Wr extends E{constructor(e){super(e)}static error(e){return new Wr(E.ensureModel(e,E.Severity.ERROR))}static warning(e){return new Wr(E.ensureModel(e,E.Severity.WARNING))}static info(e){return new Wr(E.ensureModel(e,E.Severity.INFO))}}class Ss extends E{constructor(e){super(a().extend(!0,{severity:E.Severity.INFO},e))}cssClass(){return y.join(" ",E.cssClassForSeverity(this.severity),"notification-badge")}clone(){let e=a().extend({},this);return new Ss(e)}equals(e){return e instanceof Ss?super.equals(e):!1}}class pi extends E{constructor(e){super(e)}static error(e){return new pi(E.ensureModel(e,E.Severity.ERROR))}}class Vo extends E{constructor(e){super(e)}}function lm(i,e,t){return e=Mb(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Mb(i){var e=Ib(i,"string");return typeof e=="symbol"?e:String(e)}function Ib(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Nl{constructor(e){lm(this,"tagName",void 0),lm(this,"cachedElement",void 0),this.tagName=e,this.cachedElement=null}get(){return this.cachedElement||(this.cachedElement=document.createElement(this.tagName)),this.cachedElement}}function Lb(i,e,t){return e=Ob(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Ob(i){var e=Bb(i,"string");return typeof e=="symbol"?e:String(e)}function Bb(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Gh{constructor(){Lb(this,"cache",void 0),this.cache=new Nl("textarea")}encode(e,t){if(t=t||{},!e)return e;e=y.asString(e),e=e.replace(/<br>|<br\/>|<\/p>|<p\/>|<\/div>|<\/li>|<\/tr>/gi,`
`),e=e.replace(/<\/td>/gi," "),t.removeFontIcons&&(e=e.replace(/<span\s+class="[^"]*font-icon[^"]*">[^<]*<\/span>/gmi,"")),e=e.replace(/<[^>]+>/gi,""),e=e.replace(/^[ ]+/gm,""),e=e.replace(/[ ]+$/gm,""),t.compact&&(e=e.replace(/\n{3,}/gm,`

`)),t.trim&&(e=e.trim());let s=this.cache.get();return s.innerHTML=e,s.value}}function kb(i,e,t){return e=Hb(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Hb(i){var e=Nb(i,"string");return typeof e=="symbol"?e:String(e)}function Nb(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Uh{constructor(){kb(this,"cache",void 0),this.cache=new Nl("div")}encode(e){if(!e)return e;let t=this.cache.get();return t.textContent=e,t.innerHTML}}let qh=null,Yh=null,Vb=/\n/g,Wb=/\r/g,zb=/^\s*$/;const y={nl2br(i,e){return i&&(i=y.asString(i),e=u.nvl(e,!0),e&&(i=y.encode(i)),i.replace(Vb,"<br>").replace(Wb,""))},insertAt(i,e,t){return i&&(i=y.asString(i),e=y.asString(e),e&&(typeof t=="number"||t instanceof Number)&&t>=0?i.substr(0,t)+e+i.substr(t):i)},hasText(i){return i==null||(i=y.asString(i),typeof i!="string"||i.length===0)?!1:!zb.test(i)},empty(i){return!y.hasText(i)},repeat(i,e){if(i==null)return i;if(typeof e!="number"||e<1)return"";let t="";for(let s=0;s<e;s++)t+=i;return t},padZeroLeft(i,e){let t=y.asString(i);return t==null||typeof e!="number"||e<1||t.length>=e?t:(y.repeat("0",e)+t).slice(-e)},contains(i,e){return i?i.indexOf(e)>-1:!1},startsWith(i,e){return i==null||e===void 0||e===null?!1:(i=y.asString(i),e=y.asString(e),e.length===0?!0:i.length===0?!1:i.substr(0,e.length)===e)},endsWith(i,e){return i==null||e===void 0||e===null?!1:(i=y.asString(i),e=y.asString(e),e.length===0?!0:i.length===0?!1:i.substr(-e.length)===e)},count(i,e){return!i||e===void 0||e===null?0:(i=y.asString(i),e=y.asString(e),i.split(e).length-1)},encode(i){return qh||(qh=new Uh),qh.encode(i)},plainText(i,e){return Yh||(Yh=new Gh),Yh.encode(i,e)},join(i){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];let r=t;t[0]&&b.isArray(t[0])&&(r=t[0]),i=y.asString(i);let n="";for(let o=0;o<r.length;o++){let l=y.asString(r[o]);l&&(n&&i&&(n+=i),n+=l)}return n},box(i,e,t){i=y.asString(i),e=y.asString(e),t=y.asString(t);let s="";return y.hasText(e)&&(i&&(s+=i),s+=e,t&&(s+=t)),s},quote(i){return i==null?i:(i=y.asString(i),i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"))},asString(i){return i==null||typeof i=="string"||i instanceof String?i:String(i)},nvl(i){if(arguments.length>1)throw new Error("strings.nvl only accepts one argument. Use scout.nvl if you need to handle multiple arguments");return u.nvl(i,"")},length(i){return i=y.asString(i),i?i.length:0},trim(i){return i=y.asString(i),i&&i.trim()},toUpperCase(i){return i=y.asString(i),i&&i.toUpperCase()},toLowerCase(i){return i=y.asString(i),i&&i.toLowerCase()},toUpperCaseFirstLetter(i){return i=y.asString(i),i&&i.substring(0,1).toUpperCase()+i.substring(1)},toLowerCaseFirstLetter(i){return i=y.asString(i),i&&i.substring(0,1).toLowerCase()+i.substring(1)},countCodePoints(i){return i.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"_").length},splitMax(i,e,t){if(i==null)return[];i=y.asString(i),e=y.asString(e),t=Number(t);let s=i.split(e);if(isNaN(t)||t<=0||t>=s.length)return s;let r=s.slice(0,t-1),n=s.slice(t-1).join(e);return r.push(n),r},nullIfEmpty(i){return y.empty(i)?null:i},equals(i,e,t){return i=y.nullIfEmpty(i),e=y.nullIfEmpty(e),!i&&!e?!0:!i||!e?!1:t?i.toLowerCase()===e.toLowerCase():i===e},equalsIgnoreCase(i,e){return y.equals(i,e,!0)},removePrefix(i,e){let t=i;return y.startsWith(i,e)&&(t=i.substring(e.length)),t},removeSuffix(i,e){let t=i;return y.endsWith(i,e)&&(t=i.substring(0,i.length-e.length)),t},truncateText(i,e,t){if(i&&e&&t&&e>0&&t(i).width>e){if(i=i.trim(),t(i).width<=e)return i;let s=i.length,r=0;for(;r+1<s;){let n=Math.round((s+r)/2);t(i.slice(0,n)+"...").width>e?s=n:r=n}return i.slice(0,r).trim()+"..."}return i}},M={styleMap:{},element:null,get(i,e,t){let s=M.element;s||(s=window.document.createElement("div"),s.style.display="none",window.document.body.appendChild(s),M.element=s);let r=s.style.cssText;t=a().extend(!0,{},t,{display:""}),Object.keys(t).sort().forEach(_=>{s.style[_]=t[_]});let n=s.style.cssText;s.style.display="none";let o=s.style.cssText;s.style.cssText=r;let l=p.ensure(i),h=n?[...l,n]:l,d=M.styleMap[h.toString()];e=p.ensure(e);let c=e.map(_=>({name:_,nameCamelCase:_.replace(/-(.)/g,(C,S)=>S.toUpperCase())}));d||(d={},M.put(h.toString(),d));let f=c.filter(_=>!(_.nameCamelCase in d));if(f.length===0)return d;s.className=l[0];for(let _=1;_<l.length;_++){let C=s.children[0];C||(C=window.document.createElement("div"),C.style.display="none",s.appendChild(C)),s=C,s.className=l[_]}s.style.cssText=o;let m=window.getComputedStyle(s);f.forEach(_=>{d[_.nameCamelCase]=m[_.name]}),s.style.cssText=r,s=M.element;do s.className="",s=s.children[0];while(s);return d},getFirstOpaqueBackgroundColor(i){if(!i)return;let e=i.document(!0);for(;i&&i.length&&e!==i[0];){let t=i.css("background-color"),s=M.rgb(t);if(s&&s.alpha===1)return t;i=i.parent()}},getSize(i,e,t,s){let r=M.get(i,e)[t];return r==="auto"?s:a().pxToNumber(r)},put(i,e){M.styleMap[i]=e},clearCache(){M.styleMap={}},RGB_BLACK:{red:0,green:0,blue:0},RGB_WHITE:{red:255,green:255,blue:255},rgb(i){if(!i)return;let e=i.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+),?(\d+(\.\d+)?)?/i);if(e!==null)return{red:parseInt(e[1],10),green:parseInt(e[2],10),blue:parseInt(e[3],10),alpha:parseFloat(u.nvl(e[4],1))}},hexToRgb(i){if(!i)return;let e=0,t=0,s=0,r=255;return(i.length===4||i.length===5)&&(e=parseInt("0x"+i[1]+i[1]),t=parseInt("0x"+i[2]+i[2]),s=parseInt("0x"+i[3]+i[3]),i.length===5&&(r=parseInt("0x"+i[4]+i[4]))),(i.length===7||i.length===9)&&(e=parseInt("0x"+i[1]+i[2]),t=parseInt("0x"+i[3]+i[4]),s=parseInt("0x"+i[5]+i[6]),i.length===9&&(r=parseInt("0x"+i[7]+i[8]))),r=+(r/255).toFixed(3),"rgba("+ +e+","+ +t+","+ +s+","+r+")"},rgbToHex(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!i)return null;const t=i.replace(/^rgba?\(|\s+|\)$/g,"").split(","),s=[];for(let r=0;r<t.length;r++){if(e&&r===3)continue;let n=parseFloat(t[r]);r===3&&(n=Math.round(n*255));let o=n.toString(16);o.length===1&&(o="0"+o),s[r]=o}return"#"+s.join("")},darkerColor(i,e){let t=M.rgb(i);if(!!t)return e=u.nvl(e,.2),M.mergeRgbColors(M.RGB_BLACK,e,t,1-e)},lighterColor(i,e){let t=M.rgb(i);if(!!t)return e=u.nvl(e,.2),M.mergeRgbColors(M.RGB_WHITE,e,t,1-e)},mergeRgbColors(i,e,t,s){let r,n;if(typeof i=="string"?r=M.rgb(i):r=i,typeof t=="string"?n=M.rgb(t):n=t,!(!r&&!n))return e=u.nvl(e,0),s=u.nvl(s,0),r||(r=M.RGB_BLACK,e=0),n||(n=M.RGB_BLACK,s=0),e===0&&s===0?"rgb(0,0,0)":"rgb("+Ke.round((e*r.red+s*n.red)/(e+s))+","+Ke.round((e*r.green+s*n.green)/(e+s))+","+Ke.round((e*r.blue+s*n.blue)/(e+s))+")"},parseFontSpec(i){let e={};if(y.hasText(i)){let t=i.split(/[-_,/.;]/);for(let s=0;s<t.length;s++){let r=t[s].toUpperCase();r==="NULL"||r==="0"||r==="PLAIN"||(r==="BOLD"?e.bold=!0:r==="ITALIC"?e.italic=!0:/^\d+$/.test(r)?e.size=parseInt(r):r!=="NULL"&&(e.name=t[s]))}}return e},modelToCssColor(i){if(!i)return"";let e="";return/^[A-Fa-f0-9]{3}([A-Fa-f0-9]{3})?$/.test(i)?e="#"+i:/^[A-Za-z0-9().,%-]+$/.test(i)&&(e=i),e},legacyStyle(i,e,t){let s="";return s+=M.legacyForegroundColor(i,e,t),s+=M.legacyBackgroundColor(i,e,t),s+=M.legacyFont(i,e,t),s},legacyForegroundColor(i,e,t){t=t||"";let s="";if(i){let n=y.toLowerCaseFirstLetter(t+"ForegroundColor");s=M.modelToCssColor(i[n])}e&&e.css("color",s);let r="";return s&&(r+="color: "+s+"; "),r},legacyBackgroundColor(i,e,t){t=t||"";let s="";if(i){let n=y.toLowerCaseFirstLetter(t+"BackgroundColor");s=M.modelToCssColor(i[n])}e&&e.css("background-color",s);let r="";return s&&(r+="background-color: "+s+"; "),r},legacyFont(i,e,t){t=t||"";let s="",r="",n="",o="";if(i){let h=y.toLowerCaseFirstLetter(t+"Font"),d=M.parseFontSpec(i[h]);d.bold&&(s="bold"),d.italic&&(r="italic"),d.size&&(n=d.size+"pt"),d.name&&(o=d.name)}e&&e.css("font-weight",s).css("font-style",r).css("font-size",n).css("font-family",o);let l="";return s&&(l+="font-weight: "+s+"; "),r&&(l+="font-style: "+r+"; "),n&&(l+="font-size: "+n+"; "),o&&(l+="font-family: "+o+"; "),l},_getElement(){return M.element}};function jh(i,e,t){return e=Kb(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Kb(i){var e=Gb(i,"string");return typeof e=="symbol"?e:String(e)}function Gb(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Vl{constructor(){jh(this,"array",void 0),jh(this,"properties",void 0),jh(this,"comparator",void 0),this.array=[],this.properties=b.createMap(),this.comparator=mt.ALPHANUMERIC}add(e){this.contains(e)||(this.array.push(e),this.array.sort((t,s)=>this.comparator.compare(t,s)),this.properties[e]=!0)}size(){return this.array.length}contains(e){return e in this.properties}last(){return this.array[this.array.length-1]}}function Wl(i,e,t){return e=Ub(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Ub(i){var e=qb(i,"string");return typeof e=="symbol"?e:String(e)}function qb(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class vt{constructor(e){Wl(this,"baseUrlRaw",void 0),Wl(this,"queryPartRaw",void 0),Wl(this,"hashPartRaw",void 0),Wl(this,"parameterMap",void 0),e===void 0&&(e=window.location.href);let t=/^([^?#]*)(?:\?([^#]*))?(?:#(.*))?$/.exec(e||"");this.baseUrlRaw=t[1],this.queryPartRaw=t[2],this.hashPartRaw=t[3],this.parameterMap=vt._parse(this.queryPartRaw)}hasParameter(e){return this.parameterMap.hasOwnProperty(e)}getParameter(e){if(typeof e!="string")throw new Error("Illegal argument type: "+e);let t=this.parameterMap[e];return Array.isArray(t)?t.sort(vt._sorter):t}removeParameter(e){if(typeof e!="string")throw new Error("Illegal argument type: "+e);return delete this.parameterMap[e],this}setParameter(e,t){if(typeof e!="string")throw new Error("Illegal argument type: "+e);if(e!=="")return this.parameterMap[e]=t,this}addParameter(e,t){if(typeof e!="string")throw new Error("Illegal argument type: "+e);if(e!=="")return vt._addToMap(this.parameterMap,e,t),this}toString(e){let t=this.baseUrlRaw;if(Object.keys(this.parameterMap).length){e=e||{};let s=e.sorter||vt._sorter;if(e.alwaysFirst||e.alwaysLast){e.alwaysFirst=p.ensure(e.alwaysFirst),e.alwaysLast=p.ensure(e.alwaysLast);let n=s;s=(o,l)=>{let h=e.alwaysFirst.indexOf(o),d=e.alwaysFirst.indexOf(l),c=e.alwaysLast.indexOf(o),f=e.alwaysLast.indexOf(l);return h!==-1?d===-1?-1:h-d:d!==-1?1:c!==-1?f===-1?1:c-f:f!==-1?-1:n(o,l)}}let r=Object.keys(this.parameterMap).sort(s).map(n=>{let o=this.getParameter(n);return Array.isArray(o)?o.map((l,h)=>vt._formatQueryParam(n,o[h])).join("&"):vt._formatQueryParam(n,o)}).join("&");t+="?"+r}return this.hashPartRaw&&(t+="#"+this.hashPartRaw),t}clone(){return new vt(this.toString())}static _sorter(e,t){return e===null?-1:t===null?1:e.toString().localeCompare(t)}static _formatQueryParam(e,t){let s=encodeURIComponent(e);return t!=null&&(s+="="+encodeURIComponent(t)),s}static _addToMap(e,t,s){if(e===void 0)throw new Error("Argument 'map' must not be null");if(t===void 0)throw new Error("Argument 'key' must not be null");if(t in e){let r=e[t];Array.isArray(r)?r.push(s):e[t]=[r,s]}else e[t]=s}static _parse(e){let t=(e||"").replace(/\+/g," "),s=/([^&=]+)(=?)([^&]*)/g,r={},n,o,l;for(;n=s.exec(t);)o=decodeURIComponent(n[1]),l=decodeURIComponent(n[3]),l===""&&n[2]!=="="&&(l=null),vt._addToMap(r,o,l);return r}}const cr={returnTrue(){return!0},returnFalse(){return!1},outsideFilter(i){let e=i instanceof a()?i[0]:i;return function(){return this!==e&&!a().contains(e,this)}},notSameFilter(i){let e=i instanceof a()?i[0]:i;return function(){return this!==e}}};var ht;(function(i){i.LEFT="left",i.RIGHT="right",i.CENTER="center"})(ht||(ht={}));const wt={sumSymbol:ye.SUM,minSymbol:ye.MIN_BOLD,avgSymbol:ye.AVG,maxSymbol:ye.MAX_BOLD,sumStart(){return null},sumStep(i,e){return e?(i||0)+e:i},sumFinish(i){return i},avgStart(){return{sum:0,count:0}},avgStep(i,e){return b.isNullOrUndefined(e)||(i.sum+=e,i.count+=1),i},avgFinish(i){return i.count?i.sum/i.count:null},minStart(){return null},minStep(i,e){return b.isNullOrUndefined(e)||(b.isNullOrUndefined(i)||e<i)&&(i=e),i},minFinish(i){return i},maxStart(){return null},maxStep(i,e){return b.isNullOrUndefined(e)||(b.isNullOrUndefined(i)||e>i)&&(i=e),i},maxFinish(i){return i}},Se={getItem(i,e){if(!!i)try{return i.getItem(e)}catch(t){a().log.error('Error while reading "'+e+'" from web storage: '+t)}},getItemFromSessionStorage(i){try{return Se.getItem(sessionStorage,i)}catch(e){a().log.error('Error while reading "'+i+'" from session storage: '+e)}},getItemFromLocalStorage(i){try{return Se.getItem(localStorage,i)}catch(e){a().log.error('Error while reading "'+i+'" from local storage: '+e)}},setItem(i,e,t){if(!!i)try{return i.setItem(e,t)}catch(s){a().log.error('Error while storing "'+e+'" in web storage: '+s)}},setItemToSessionStorage(i,e){try{return Se.setItem(sessionStorage,i,e)}catch(t){a().log.error('Error while storing "'+i+'" in session storage: '+t)}},setItemToLocalStorage(i,e){try{return Se.setItem(localStorage,i,e)}catch(t){a().log.error('Error while storing "'+i+'" in local storage: '+t)}},removeItem(i,e){if(!!i)try{return i.removeItem(e)}catch(t){a().log.error('Error while removing "'+e+'" from web storage: '+t)}},removeItemFromSessionStorage(i){try{return Se.removeItem(sessionStorage,i)}catch(e){a().log.error('Error while removing "'+i+'" from session storage: '+e)}},removeItemFromLocalStorage(i){try{return Se.removeItem(localStorage,i)}catch(e){a().log.error('Error while removing "'+i+'" from local storage: '+e)}},clear(i){if(!!i)try{return i.clear()}catch(e){a().log.error("Error while clearing web storage: "+e)}},clearSessionStorage(){try{return Se.clear(sessionStorage)}catch(i){a().log.error("Error while clearing session storage: "+i)}},clearLocalStorage(){try{return Se.clear(localStorage)}catch(i){a().log.error("Error while clearing local storage: "+i)}}},zl={get(i,e){e=e||document;let t=i+"=",s=e.cookie.split(";");for(let r=0;r<s.length;r++){let n=s[r].trim();if(n.indexOf(t)===0)return n.substring(t.length)}return null},set(i,e,t,s){e=u.nvl(e,""),t=u.nvl(t,-1);let r=i+"="+e;if(t>-1){let n=new Date;n.setTime(n.getTime()+t*1e3),r+=";max-age="+t+";expires="+n}s&&(r+=";path="+s),document.cookie=r}};function Gt(i,e,t){return e=Yb(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Yb(i){var e=jb(i,"string");return typeof e=="symbol"?e:String(e)}function jb(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ps{constructor(e){Gt(this,"objectType",void 0),Gt(this,"viewportWidth",void 0),Gt(this,"viewportHeight",void 0),Gt(this,"e",void 0),Gt(this,"f",void 0),Gt(this,"initialDelay",void 0),Gt(this,"active",void 0),Gt(this,"scroll",void 0),Gt(this,"dx",void 0),Gt(this,"dy",void 0),Gt(this,"started",void 0),Gt(this,"moved",void 0),Gt(this,"_timeoutId",void 0),this.viewportWidth=0,this.viewportHeight=0,this.e=30,this.f=-30,this.initialDelay=500,this.active=()=>!0,this.scroll=(t,s)=>{},$.extend(this,e),this.dx=0,this.dy=0,this.started=!1,this.moved=!1,this._timeoutId=null}_tick(){if(!this.active())return;this.started&&(this.dx||this.dy)&&(this.scroll(this.dx,this.dy),this.moved=!0);let e=this.moved?16:this.initialDelay;this._timeoutId=setTimeout(()=>this._tick(),e)}start(){clearTimeout(this._timeoutId),this._tick(),this.started=!0}stop(){clearTimeout(this._timeoutId),this._timeoutId=null,this.started=!1,this.moved=!1,this.dx=0,this.dy=0}update(e){let t=this.e,s=this.f,r=Math.floor((t+s)/2),n=t,o=this.viewportWidth-t,l=t,h=this.viewportHeight-t;const d=Ps.SPEED_FACTOR_SLOW,c=Ps.SPEED_FACTOR_MEDIUM,f=Ps.SPEED_FACTOR_FAST;let m=0,_=0,C=0,S=0;e.x<n?(C=-(n-e.x),m=e.x>r?d:e.x>s?c:f):e.x>o&&(C=e.x-o,m=e.x>this.viewportWidth-s?f:e.x>this.viewportWidth-r?c:d),e.y<l?(S=-(l-e.y),_=e.y>r?d:e.y>s?c:f):e.y>h&&(S=e.y-h,_=e.y>this.viewportHeight-s?f:e.y>this.viewportHeight-r?c:d);let R=Math.abs(C),L=Math.abs(S),H=Math.max(R,L);if(H===0){this.stop();return}let we=1+Math.floor(R*m),rt=1+Math.floor(L*_);this.dx=Math.sign(C)*we,this.dy=Math.sign(S)*rt,this.started||this.start(),!this.moved&&H>t&&this.start()}}Gt(Ps,"SPEED_FACTOR_SLOW",1/20),Gt(Ps,"SPEED_FACTOR_MEDIUM",1/10),Gt(Ps,"SPEED_FACTOR_FAST",1/5);const Fi={get(i,e){let t=a().extend({},{url:i,type:"GET"},e);return Fi.call(t)},post(i,e,t){let s=a().extend({},{url:i,type:"POST",data:e},t);return Fi.call(s)},put(i,e,t){let s=a().extend({},{url:i,type:"PUT",data:e},t);return Fi.call(s)},remove(i,e){let t=a().extend({},{url:i,type:"DELETE"},e);return Fi.call(t)},getJson(i,e){let t=a().extend({},{url:i,type:"GET"},e);return Fi.callJson(t)},postJson(i,e,t){e&&typeof e!="string"&&(e=JSON.stringify(e));let s=a().extend({},{url:i,type:"POST",data:e},t);return Fi.callJson(s)},putJson(i,e,t){e&&typeof e!="string"&&(e=JSON.stringify(e));let s=a().extend({},{url:i,type:"PUT",data:e},t);return Fi.callJson(s)},removeJson(i,e){let t=a().extend({},{url:i,type:"DELETE"},e);return Fi.callJson(t)},callJson(i){return Fi.createCallJson(i).call()},call(i){return Fi.createCall(i).call()},createCallJson(i){let e=a().extend({},{type:"POST",dataType:"json",contentType:"application/json; charset=UTF-8"},i);return Fi.createCall(e)},createCall(i){let e=a().extend({},{cache:!1},i);return u.create(pr,{ajaxOptions:e},{ensureUniqueId:!1})}};function Xb(i,e,t){return e=Jb(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Jb(i){var e=Qb(i,"string");return typeof e=="symbol"?e:String(e)}function Qb(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class pr extends Bn{constructor(){super(),Xb(this,"ajaxOptions",void 0),this.type="ajax",this.ajaxOptions=null}init(e){if(!e)throw new Error('Missing argument "model"');if(!e.ajaxOptions)throw new Error('Missing model property "ajaxOptions"');e.name||(e.name=e.ajaxOptions.url),super.init(e)}_callImpl(){return this.callCounter!==1&&(this.ajaxOptions.url=new vt(this.ajaxOptions.url).setParameter("retry",this.callCounter-1+"").toString({alwaysLast:["retry"]})),a().log.isTraceEnabled()&&a().log.trace(this.logPrefix+(this.callCounter===1?"--- ":"")+this.ajaxOptions.type+' "'+this.ajaxOptions.url+'"'+(this.callCounter===1?" ---":"")),a().ajax(this.ajaxOptions)}_setResultFail(e,t,s){this._setResult(new Wo({jqXHR:e,textStatus:t,errorThrown:s,requestOptions:this.ajaxOptions}))}_onCallDone(e,t,s){a().log.isTraceEnabled()&&a().log.trace(this.logPrefix+"AJAX success"),super._onCallDone(e,t,s)}_onCallFail(e,t,s){a().log.isTraceEnabled()&&a().log.trace(this.logPrefix+"AJAX fail: type="+t+", httpStatus="+e.status+(s?' "'+s+'"':"")),super._onCallFail(e,t,s)}_nextRetryImpl(e,t,s){return pr.isOfflineError(e,t,s)?super._nextRetryImpl():(a().log.isTraceEnabled()&&a().log.trace(this.logPrefix+"Unexpected HTTP error"),!1)}static isOfflineError(e,t,s){return!e.status||e.status>=12e3||e.status===502||e.status===503||e.status===504}_abortImpl(){this.pendingCall&&typeof this.pendingCall.abort=="function"&&this.pendingCall.abort()}}function Kl(i,e,t){return e=Zb(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Zb(i){var e=ev(i,"string");return typeof e=="symbol"?e:String(e)}function ev(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Wo{constructor(e){Kl(this,"jqXHR",void 0),Kl(this,"textStatus",void 0),Kl(this,"errorThrown",void 0),Kl(this,"requestOptions",void 0),this.jqXHR=null,this.textStatus=null,this.errorThrown=null,this.requestOptions=null,a().extend(this,e)}}function Di(i,e,t){return e=tv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function tv(i){var e=iv(i,"string");return typeof e=="symbol"?e:String(e)}function iv(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ut{constructor(){Di(this,"id",void 0),Di(this,"objectType",void 0),Di(this,"session",void 0),Di(this,"hierarchical",void 0),Di(this,"loadIncremental",void 0),Di(this,"batch",void 0),Di(this,"queryBy",void 0),Di(this,"searchText",void 0),Di(this,"key",void 0),Di(this,"keys",void 0),Di(this,"parentKey",void 0),Di(this,"active",void 0),Di(this,"maxRowCount",void 0),this.session=null,this.hierarchical=!1,this.loadIncremental=!1,this.batch=!1,this.queryBy=null,this.searchText=null,this.key=null,this.keys=null,this.parentKey=null,this.active=null,this.maxRowCount=100}init(e){u.assertParameter("session",e.session),this._init(e)}_init(e){a().extend(this,e)}setLoadIncremental(e){this.loadIncremental=e}setHierarchical(e){this.hierarchical=e}setBatch(e){this.batch=e}setMaxRowCount(e){this.maxRowCount=e}textByKey(e){return b.isNullOrUndefined(e)?a().resolvedPromise(""):this._textByKey(e)}_textByKey(e){return this.cloneForKey(e).execute().then(t=>{let s=Ut.firstLookupRow(t);return s?s.text:""})}textsByKeys(e){return p.empty(e)?a().resolvedPromise({}):this._textsByKeys(e)}_textsByKeys(e){return this.cloneForKeys(e).execute().then(t=>{if(!t||!b.isArray(t.lookupRows))return{};const s={};return t.lookupRows.forEach(r=>{s[b.ensureValidKey(r.key)]=r.text}),s})}getAll(){return this.queryBy=fe.ALL,this._getAll()}_getAll(){throw new Error("_getAll() not implemented")}getByText(e){return this.queryBy=fe.TEXT,this.searchText=e,this._getByText(e)}_getByText(e){throw new Error("_getByText() not implemented")}getByKey(e){return this.queryBy=fe.KEY,this.key=e,this._getByKey(e)}_getByKey(e){throw new Error("getByKey() not implemented")}getByKeys(e){return this.queryBy=fe.KEYS,this.keys=e,this._getByKeys(e)}_getByKeys(e){throw new Error("_getByKeys() not implemented")}getByRec(e){return this.queryBy=fe.REC,this.parentKey=e,b.isNullOrUndefined(e)?this._emptyRecResult(e):this._getByRec(e)}_emptyRecResult(e){return a().resolvedPromise({queryBy:fe.REC,rec:e,lookupRows:[]})}_getByRec(e){throw new Error("_getByRec() not implemented")}execute(){if(fe.KEY===this.queryBy)return this._getByKey(this.key);if(fe.ALL===this.queryBy)return this._getAll();if(fe.KEYS===this.queryBy)return this._getByKeys(this.keys);if(fe.TEXT===this.queryBy)return this._getByText(this.searchText);if(fe.REC===this.queryBy)return b.isNullOrUndefined(this.parentKey)?this._emptyRecResult(this.parentKey):this._getByRec(this.parentKey);throw new Error("cannot execute a non-clone LookupCall. Use one of the cloneFor*-methods before executing.")}clone(e){return u.cloneShallow(this,e,!0)}cloneForAll(){return this.clone({queryBy:fe.ALL})}cloneForText(e){return this.clone({queryBy:fe.TEXT,searchText:e})}cloneForKey(e){return this.clone({queryBy:fe.KEY,key:e})}cloneForKeys(e){return this.clone({queryBy:fe.KEYS,keys:e})}cloneForRec(e){return this.clone({queryBy:fe.REC,parentKey:e})}abort(){}static ensure(e,t){return!e||e instanceof Ut?e:typeof e=="string"||typeof e=="function"?u.create(e,{session:t}):(e.session=t,u.create(e))}static firstLookupRow(e){return!e||!b.isArray(e.lookupRows)||e.lookupRows.length===0?null:e.lookupRows[0]}}function zi(i,e,t){return e=sv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function sv(i){var e=rv(i,"string");return typeof e=="symbol"?e:String(e)}function rv(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ys{constructor(){zi(this,"key",void 0),zi(this,"text",void 0),zi(this,"parentKey",void 0),zi(this,"enabled",void 0),zi(this,"active",void 0),zi(this,"additionalTableRowData",void 0),zi(this,"cssClass",void 0),zi(this,"iconId",void 0),zi(this,"tooltipText",void 0),zi(this,"backgroundColor",void 0),zi(this,"foregroundColor",void 0),zi(this,"font",void 0),this.key=null,this.text=null,this.parentKey=null,this.enabled=!0,this.active=!0,this.additionalTableRowData=null,this.cssClass=null,this.iconId=null,this.tooltipText=null,this.backgroundColor=null,this.foregroundColor=null,this.font=null}init(e){a().extend(this,e)}setKey(e){this.key=e}setText(e){this.text=e}setParentKey(e){this.parentKey=e}setCssClass(e){this.cssClass=e}setAdditionalTableRowData(e){this.additionalTableRowData=e}setIconId(e){this.iconId=e}setTooltipText(e){this.tooltipText=e}setBackgroundColor(e){this.backgroundColor=e}setForegroundColor(e){this.foregroundColor=e}setFont(e){this.font=e}equals(e){return b.propertiesEquals(this,e,Object.keys(this))}toString(){return"scout.LookupRow[key="+this.key+" text="+this.text+"]"}}function Nn(i,e,t){return e=nv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function nv(i){var e=ov(i,"string");return typeof e=="symbol"?e:String(e)}function ov(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class am extends Ut{constructor(){super(),Nn(this,"resourceUrl",void 0),Nn(this,"maxTextLength",void 0),Nn(this,"restriction",void 0),Nn(this,"_restriction",void 0),Nn(this,"_ajaxCall",void 0),Nn(this,"_deferred",void 0),this.resourceUrl=null,this.maxTextLength=null,this.restriction=null,this._restriction=null,this._ajaxCall=null,this._deferred=null,this.batch=!0}addRestriction(e,t){this._restriction||(this._restriction={}),this._restriction[e]=t}_addRestrictionIfAbsent(e,t){(!this.restriction||b.isNullOrUndefined(this.restriction[e]))&&this.addRestriction(e,t)}_getAll(){return this._call()}_getByText(e){return this.addRestriction("text",e),this._call()}_getByKey(e){return this.addRestriction("ids",p.ensure(e)),this._call()}_getByKeys(e){return this.addRestriction("ids",p.ensure(e)),this._call()}cloneForAll(){let e=super.cloneForAll();return e._addRestrictionIfAbsent("active",!0),e._addRestrictionIfAbsent("maxRowCount",this.maxRowCount),e}cloneForText(e){let t=super.cloneForText(e);return t._addRestrictionIfAbsent("active",!0),t._addRestrictionIfAbsent("maxRowCount",this.maxRowCount),t}cloneForRec(e){let t=super.cloneForRec(e);return t._addRestrictionIfAbsent("active",!0),t._addRestrictionIfAbsent("maxRowCount",this.maxRowCount),t}_acceptLookupRow(e){return!0}_createLookupRowFromDo(e){let t=a().extend({},e);if(t.key=t.id,delete t.id,t.parentKey=t.parentId,delete t.parentId,delete t._type,this.maxTextLength){let s=t.text;s.length>this.maxTextLength&&(t.text=s.substr(0,this.maxTextLength)+"...",t.tooltipText=s)}return u.create(Ys,t,{ensureUniqueId:!1})}_call(){return this._deferred=a().Deferred(),this._ajaxCall=this._createAjaxCall(),this._ajaxCall.call().then((e,t,s)=>{let r=p.ensure(e?e.rows:null).filter(this._acceptLookupRow.bind(this)).map(this._createLookupRowFromDo.bind(this));this._deferred.resolve({queryBy:this.queryBy,text:this.searchText,key:this.key,lookupRows:r})}).catch(e=>{this._deferred.resolve({queryBy:this.queryBy,text:this.searchText,key:this.key,lookupRows:[],exception:this.session.text("ErrorWhileLoadingData")})}),this._deferred.promise()}abort(){this._deferred.reject({canceled:!0}),this._ajaxCall.abort(),super.abort()}_getCallUrl(){return this.resourceUrl}_getRestrictionForAjaxCall(){if(!this.restriction&&!this._restriction)return null;let e=r=>typeof r=="function"?r(this):r,t={},s=a().extend({},this.restriction,this._restriction);return Object.keys(s).forEach(r=>{let n=s[r],o;Array.isArray(n)?(o=p.flatMap(n,e).filter(Boolean),o=o.length?o:null):o=e(n),b.isNullOrUndefined(o)||(t[r]=o)}),t}_createAjaxCall(){let e=this._getCallUrl(),t=this._getRestrictionForAjaxCall(),r={type:"POST",data:t?JSON.stringify(t):null,dataType:"json",contentType:"application/json; charset=UTF-8",cache:!1,url:e,timeout:0};return u.create(pr,{ajaxOptions:r,name:"RestLookupCall",retryIntervals:[100,500,500,500]},{ensureUniqueId:!1})}}function hm(i,e,t){return e=lv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function lv(i){var e=av(i,"string");return typeof e=="symbol"?e:String(e)}function av(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Gl extends Ut{constructor(e){super(),hm(this,"adapter",void 0),hm(this,"deferred",void 0),this.adapter=e,this.deferred=null}_getAll(){return this._newDeferred(new js(fe.ALL)),this.adapter.sendLookup(fe.ALL),this.deferred.promise()}_getByText(e){return this._newDeferred(new js(fe.TEXT,e)),this.adapter.sendLookup(fe.TEXT,e),this.deferred.promise()}_getByKey(e){return this._newDeferred(new js(fe.KEY,e)),this.adapter.sendLookup(fe.KEY,e),this.deferred.promise()}_getByRec(e){return this._newDeferred(new js(fe.REC,e)),this.adapter.sendLookup(fe.REC,e),this.deferred.promise()}resolveLookup(e){if(!this._belongsToLatestRequest(e)){a().log.isTraceEnabled()&&a().log.trace("(RemoteLookupCall#resolveLookup) ignore lookupResult. Does not belong to latest request",b.optProperty(this.deferred,"requestParameter"));return}e.lookupRows=p.ensure(e.lookupRows).map(t=>u.create(Ys,t)),this.deferred.resolve(e)}_belongsToLatestRequest(e){if(!this.deferred)return!1;let t=e.queryBy.toLowerCase(),s=e[t],r=new js(e.queryBy,s);return this.deferred.requestParameter.equals(r)}_newDeferred(e){this.deferred&&this.deferred.reject({canceled:!0}),this.deferred=a().Deferred(),this.deferred.requestParameter=e}}function dm(i,e,t){return e=hv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function hv(i){var e=dv(i,"string");return typeof e=="symbol"?e:String(e)}function dv(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class js{constructor(e,t){if(dm(this,"requestType",void 0),dm(this,"requestData",void 0),!fe.hasOwnProperty(e))throw new Error("Invalid enum value");this.requestType=e,this.requestData=t}equals(e){return!e||!(e instanceof js)?!1:b.propertiesEquals(this,e,["requestType","requestData"])}}var fe;(function(i){i.ALL="ALL",i.TEXT="TEXT",i.KEY="KEY",i.KEYS="KEYS",i.REC="REC"})(fe||(fe={}));function um(i,e,t){return e=uv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function uv(i){var e=cv(i,"string");return typeof e=="symbol"?e:String(e)}function cv(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Vn extends Ut{constructor(){super(),um(this,"delay",void 0),um(this,"data",void 0),this.delay=0,this.data=null,this.active=!0}_init(e){super._init(e),this.data||(this.data=this._data())}refreshData(e){e===void 0?this.data=this._data():this.data=e}_getAll(){let e=a().Deferred();return setTimeout(this._queryByAll.bind(this,e),this.delay),e.promise()}_queryByAll(e){e.resolve({queryBy:fe.ALL,lookupRows:this._lookupRowsByAll()})}_lookupRowsByAll(){return this.data.slice(0,this.maxRowCount).map(this._dataToLookupRow,this).filter(this._filterActiveLookupRow,this)}_filterActiveLookupRow(e){return b.isNullOrUndefined(this.active)?!0:this.active===u.nvl(e.active,!0)}_getByText(e){let t=a().Deferred();return setTimeout(this._queryByText.bind(this,t,e),this.delay),t.promise()}_queryByText(e,t){let s=this._lookupRowsByText(t);this.hierarchical||e.resolve({queryBy:fe.TEXT,text:t,lookupRows:s});let r,n=new Xh(this);this.loadIncremental?r=a().resolvedPromise(s):r=n.addChildLookupRows(s),r.then(o=>n.addParentLookupRows(o)).done(o=>{e.resolve({queryBy:fe.TEXT,text:t,lookupRows:o})}).fail(o=>{throw o})}_lookupRowsByText(e){let t=this._createSearchPattern(e);return this.data.filter(r=>t.test(r[1].toLowerCase())).map(this._dataToLookupRow,this).filter(this._filterActiveLookupRow,this)}_createSearchPattern(e){const t="*",s="@wildcard@";e=y.nvl(e),e=e.toLowerCase(),e=e.replace(new RegExp(y.quote(t),"g"),s),e=y.quote(e);let r=s+s;for(;y.contains(e,r);)e=e.replace(r,s);return y.endsWith(e,s)||(e+=s),e=e.replace(new RegExp(y.quote(s),"g"),".*"),new RegExp("^"+e+"$","s")}_getByKey(e){let t=a().Deferred();return setTimeout(this._queryByKey.bind(this,t,e),this.delay),t.promise()}_queryByKey(e,t){let s=this._lookupRowByKey(t);s?e.resolve({queryBy:fe.KEY,lookupRows:[s]}):e.reject()}_lookupRowByKey(e){let t=p.find(this.data,s=>s[0]===e);return t?this._dataToLookupRow(t):null}_getByRec(e){let t=a().Deferred();return setTimeout(this._queryByRec.bind(this,t,e),this.delay),t.promise()}_queryByRec(e,t){e.resolve({queryBy:fe.REC,rec:t,lookupRows:this._lookupRowsByRec(t)})}_lookupRowsByRec(e){return this.data.reduce((t,s)=>(s[2]===e&&t.push(this._dataToLookupRow(s)),t),[]).filter(this._filterActiveLookupRow,this)}setDelay(e){this.delay=e}_dataToLookupRow(e,t){return u.create(Ys,{key:e[0],text:e[1],parentKey:e[2]})}_data(){return[]}}function pv(i,e,t){return e=fv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function fv(i){var e=mv(i,"string");return typeof e=="symbol"?e:String(e)}function mv(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class cm extends Ut{constructor(){super(),pv(this,"lookupRows",void 0),this.lookupRows=[]}setLookupRows(e){this.lookupRows=p.ensure(e)}_filterActiveLookupRow(e){return!!u.nvl(e.active,!0)}_getAll(){let e=a().Deferred();return setTimeout(this._queryByAll.bind(this,e)),e.promise()}_queryByAll(e){e.resolve({queryBy:fe.ALL,lookupRows:this._lookupRowsByAll()})}_lookupRowsByAll(){return this.lookupRows.filter(this._filterActiveLookupRow,this).slice(0,this.maxRowCount)}_getByText(e){let t=a().Deferred();return setTimeout(this._queryByText.bind(this,t,e)),t.promise()}_queryByText(e,t){e.resolve({queryBy:fe.TEXT,text:t,lookupRows:this._lookupRowsByText(t)})}_lookupRowsByText(e){let t=String(u.nvl(e,"")).trim().toLowerCase();return this.lookupRows.filter(s=>y.startsWith(u.nvl(s.text,"").toLowerCase(),t)).filter(this._filterActiveLookupRow,this).slice(0,this.maxRowCount)}_getByKey(e){let t=a().Deferred();return setTimeout(this._queryByKey.bind(this,t,e)),t.promise()}_queryByKey(e,t){let s=this._lookupRowByKey(t);s?e.resolve({queryBy:fe.KEY,lookupRows:[s]}):e.reject()}_lookupRowByKey(e){return p.find(this.lookupRows,t=>t.key===e)}_getByRec(e){let t=a().Deferred();return setTimeout(this._queryByRec.bind(this,t,e)),t.promise()}_queryByRec(e,t){e.resolve({queryBy:fe.REC,rec:t,lookupRows:this._lookupRowsByRec(t)})}_lookupRowsByRec(e){return this.lookupRows.reduce((t,s)=>(s.parentKey===e&&t.push(s),t),[]).filter(this._filterActiveLookupRow,this).slice(0,this.maxRowCount)}}function pm(i,e,t){return e=gv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function gv(i){var e=_v(i,"string");return typeof e=="symbol"?e:String(e)}function _v(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Xh{constructor(e){pm(this,"lookupCall",void 0),pm(this,"_lookupRowMap",void 0),u.assertParameter("lookupCall",e),this.lookupCall=e,this._lookupRowMap={}}addParentLookupRows(e){this._fillMap(e);let t=e.map(this._addParent.bind(this));return a().promiseAll(t).then(()=>b.values(this._lookupRowMap))}_addParent(e){let t=e.parentKey;return t?this._lookupRowMap.hasOwnProperty(t+"")?(e=this._lookupRowMap[t+""],this._addParent(e)):this.lookupCall.cloneForKey(t).execute().then(s=>{let r=Ut.firstLookupRow(s);return this._lookupRowMap[r.key+""]=r,this._addParent(r)}):a().resolvedPromise()}_fillMap(e){e.forEach(t=>{this._lookupRowMap[t.key+""]=t})}addChildLookupRows(e){this._fillMap(e);let t=e.map(this._addChildren.bind(this));return a().promiseAll(t).then(()=>b.values(this._lookupRowMap))}_addChildren(e){return this.lookupCall.cloneForRec(e.key).execute().then(t=>{if(t.lookupRows.length)return this.addChildLookupRows(t.lookupRows)})}}function fr(i,e,t){return e=yv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function yv(i){var e=bv(i,"string");return typeof e=="symbol"?e:String(e)}function bv(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class fm{constructor(){fr(this,"objectType",void 0),fr(this,"active",void 0),fr(this,"id",void 0),fr(this,"parent",void 0),fr(this,"children",void 0),fr(this,"sortCode",void 0),fr(this,"modelClass",void 0),fr(this,"_text",void 0),this.children=[]}init(e){if(u.assertParameter("id",e.id),this.active=e.active,this.id=e.id,this.sortCode=e.sortCode,this._text=e.text,this.modelClass=e.modelClass,e.texts){if(this._text)throw new Error("Either set texts or text property, not both.");let t=Tt.registerTexts(this,e.texts);this._text=Ce.buildKey(t)}}text(e){return typeof e=="object"?Ce.resolveText(this._text,e.languageTag):Ce.resolveText(this._text,e)}visitChildren(e){for(let t=0;t<this.children.length;t++){let s=this.children[t],r=e(s);if(r===!0||r===_e.TERMINATE||r!==_e.SKIP_SUBTREE&&(r=s.visitChildren(e),r===!0||r===_e.TERMINATE))return _e.TERMINATE}}}function zo(i,e,t){return e=vv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function vv(i){var e=wv(i,"string");return typeof e=="symbol"?e:String(e)}function wv(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Wn{constructor(){zo(this,"objectType",void 0),zo(this,"id",void 0),zo(this,"modelClass",void 0),zo(this,"codes",void 0),zo(this,"codeMap",void 0),this.codes=[],this.codeMap={}}init(e){if(u.assertParameter("id",e.id),this.id=e.id,this.modelClass=e.modelClass,e.codes)for(let t=0;t<e.codes.length;t++)this._initCode(e.codes[t])}_initCode(e,t){let s=u.create(e);if(this.add(s,t),e.children)for(let r=0;r<e.children.length;r++)this._initCode(e.children[r],s)}add(e,t){this.codes.push(e),this.codeMap[e.id+""]=e,t&&(t.children.push(e),e.parent=t)}get(e){let t=this.optGet(e);if(!t)throw new Error("No code found for id="+e);return t}optGet(e){return this.codeMap[e+""]}getCodes(e){if(e){let t=[];for(let s=0;s<this.codes.length;s++)this.codes[s].parent||t.push(this.codes[s]);return t}return this.codes}visitChildren(e){let t=this.getCodes(!0);for(let s=0;s<t.length;s++){let r=t[s],n=e(r);if(n===!0||n===_e.TERMINATE||n!==_e.SKIP_SUBTREE&&(n=r.visitChildren(e),n===!0||n===_e.TERMINATE))return _e.TERMINATE}}static ensure(e){return!e||e instanceof Wn?e:u.create(Wn,e)}}const Tt={defaultLanguage:"en",registry:{},bootstrap(i){return(i?a().ajaxJson(i):a().resolvedPromise({})).then(Tt._preInit.bind(this,i))},_preInit(i,e){if(e&&e.error)throw{error:e.error,url:i};Tt.init(e)},init(i){i=i||{},Object.keys(i).forEach(e=>Tt.add(i[e]))},add(i){p.ensure(i).forEach(t=>{let s=Wn.ensure(t);Tt.registry[s.id]=s})},remove(i){p.ensure(i).forEach(t=>{let s;typeof t=="string"?s=t:s=t.id,delete Tt.registry[s]})},get(i,e){return Tt._get("get",b.argumentsToArray(arguments))},optGet(i,e){return Tt._get("optGet",b.argumentsToArray(arguments))},_get(i,e){let t,s;if(e.length===2)t=e[0],s=e[1];else{let r=e[0].split(" ");if(r.length!==2)throw new Error('Invalid string. Must have format "[CodeType.id] [Code.id]"');t=r[0],s=r[1]}return u.assertParameter("codeTypeId",t),u.assertParameter("codeId",s),Tt.codeType(t)[i](s)},codeType(i,e){let t=Tt.registry[i];if(!e&&!t)throw new Error("No CodeType found for id="+i);return t},generateTextKey(i){return"__code."+i.id},registerTexts(i,e){let t=Tt.generateTextKey(i);Ce.get("default").remove(t);for(let s in e){let r=e[s];s&&s===Tt.defaultLanguage&&(s="default"),Ce.get(s).add(t,r)}return t}};function Tv(i,e,t){return e=Cv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Cv(i){var e=Sv(i,"string");return typeof e=="symbol"?e:String(e)}function Sv(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ul extends Vn{constructor(){super(),Tv(this,"codeType",void 0),this.codeType=null}_lookupRowByKey(e){let t=Tt.codeType(this.codeType,!0);return t?this._createLookupRow(t.optGet(e)):null}_lookupRowsByAll(){return this._collectLookupRows()}_lookupRowsByText(e){return this._collectLookupRows(t=>{let s=t.text||"";return y.startsWith(s.toLowerCase(),e.toLowerCase())})}_lookupRowsByRec(e){return this._collectLookupRows(t=>t.parentKey===e)}_collectLookupRows(e){let t=Tt.codeType(this.codeType,!0);if(!t)return[];let s=[];return t.visitChildren(r=>{let n=this._createLookupRow(r);(!e||e(n))&&s.push(n)}),s}_createLookupRow(e){return e?u.create(Ys,{key:e.id,text:e.text(this.session.locale),parentKey:e.parent&&e.parent.id}):null}}var Ki;(function(i){i.STOPPED="stopped",i.RUNNING="running",i.FAILURE="failure"})(Ki||(Ki={}));function mm(i,e,t){return e=Pv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Pv(i){var e=xv(i,"string");return typeof e=="symbol"?e:String(e)}function xv(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Jh{constructor(e){mm(this,"enabled",void 0),mm(this,"status",void 0),this.enabled=!!e,this.status=Ki.STOPPED}setFailed(){this.status=Ki.FAILURE}setRunning(){this.status=Ki.RUNNING}setStopped(){this.status=Ki.STOPPED}isFailed(){return this.status===Ki.FAILURE}isRunning(){return this.status===Ki.RUNNING}isStopped(){return this.status===Ki.STOPPED}}function Gi(i,e,t){return e=Ev(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Ev(i){var e=Fv(i,"string");return typeof e=="symbol"?e:String(e)}function Fv(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Qh extends I{constructor(){super(),Gi(this,"cancellable",void 0),Gi(this,"showTimeout",void 0),Gi(this,"label",void 0),Gi(this,"details",void 0),Gi(this,"cancelButton",void 0),Gi(this,"boxButtons",void 0),Gi(this,"_glassPaneRenderer",void 0),Gi(this,"$content",void 0),Gi(this,"$buttons",void 0),Gi(this,"$label",void 0),Gi(this,"$details",void 0),Gi(this,"_busyIndicatorTimeoutId",void 0),this.cancellable=!0,this.showTimeout=2500,this.label=null,this.details=null,this.cancelButton=null,this.boxButtons=null,this._glassPaneRenderer=null,this.inheritAccessibility=!1,this.$content=null,this.$buttons=null,this.$label=null,this.$details=null,this._busyIndicatorTimeoutId=0,this._addWidgetProperties(["boxButtons","cancelButton"])}_createKeyStrokeContext(){return new Oe}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.registerKeyStrokes([new jo(this,[g.SPACE,g.ENTER]),new Xn(this,()=>this.cancelButton?this.cancelButton.$container:null)])}_init(e){super._init(e),this.label=u.nvl(this.label,this.session.text("ui.PleaseWait_")),this.cancellable&&(this.boxButtons=u.create(Xo,{parent:this}),this.cancelButton=this.boxButtons.addButton({text:this.session.text("Cancel")}),this.cancelButton.one("action",t=>this._onCancelClick(t)))}render(e){e=e||this.entryPoint(),super.render(e)}_render(){this.$container=this.$parent.appendDiv("busyindicator invisible");let e=this.$container.appendDiv("drag-handle");this.$container.draggable(e),this.$content=this.$container.appendDiv("busyindicator-content"),this.$label=this.$content.appendDiv("busyindicator-label"),this.$details=this.$content.appendDiv("busyindicator-details"),this.cancellable?(this.boxButtons.render(),this.$buttons=this.boxButtons.$container,this.$buttons.addClass("busyindicator-buttons")):this.$content.addClass("no-buttons"),this._renderLabel(),this._renderDetails(),this.$container.addClass("calc-helper"),this.$container.css("min-width",this.$container.width()),this.$container.removeClass("calc-helper"),this._position(),this._busyIndicatorTimeoutId=setTimeout(()=>{this.$container.removeClass("invisible").addClassForAnimation("animate-open"),this.session.focusManager.validateFocus()},this.showTimeout),this._glassPaneRenderer=new Zr(this),this._glassPaneRenderer.renderGlassPanes(),this._glassPaneRenderer.eachGlassPane(t=>t.addClass("busy"))}_postRender(){super._postRender(),this.session.focusManager.installFocusContext(this.$container,Mt.AUTO)}_remove(){clearTimeout(this._busyIndicatorTimeoutId),this._glassPaneRenderer.eachGlassPane(e=>e.removeClass("busy")),this._glassPaneRenderer.removeGlassPanes(),this.session.focusManager.uninstallFocusContext(this.$container),super._remove()}setLabel(e){this.setProperty("label",e)}_renderLabel(){this.$label.text(this.label||"")}setDetails(e){this.setProperty("details",e)}_renderDetails(){this.$details.html(y.nl2br(this.details)).setVisible(!!this.details)}_position(){this.$container.cssMarginLeft(-this.$container.outerWidth()/2)}close(){this.cancelButton&&this.cancelButton.$container&&this.session.focusManager.requestFocus(this.cancelButton.$container)&&(this.cancelButton.$container.focus(),this.cancelButton.doAction())}_onCancelClick(e){this.trigger("cancel",e)}cancelled(){this.rendered&&(this.$label.addClass("cancelled"),this.$buttons&&this.$buttons.remove(),this.$content.addClass("no-buttons"))}}function zn(i,e,t){return e=Dv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Dv(i){var e=Av(i,"string");return typeof e=="symbol"?e:String(e)}function Av(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ql{constructor(e,t,s){zn(this,"target",void 0),zn(this,"type",void 0),zn(this,"showBusyIndicator",void 0),zn(this,"coalesce",void 0),zn(this,"newRequest",void 0),zn(this,"properties",void 0),u.assertParameter("target",e),u.assertParameter("type",t),a().extend(this,s),this.target=e,this.type=t}}function Ai(i,e,t){return e=$v(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function $v(i){var e=Rv(i,"string");return typeof e=="symbol"?e:String(e)}function Rv(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class qt{constructor(e){Ai(this,"languageTag",void 0),Ai(this,"language",void 0),Ai(this,"country",void 0),Ai(this,"displayLanguage",void 0),Ai(this,"displayCountry",void 0),Ai(this,"decimalFormatPatternDefault",void 0),Ai(this,"decimalFormatSymbols",void 0),Ai(this,"decimalFormat",void 0),Ai(this,"dateFormatPatternDefault",void 0),Ai(this,"dateFormatSymbols",void 0),Ai(this,"timeFormatPatternDefault",void 0),Ai(this,"dateFormat",void 0),e=u.nvl(e,qt.DEFAULT),this.languageTag=e.languageTag;let t=_t.splitLanguageTag(this.languageTag);this.language=t[0],this.country=t[1],this.displayLanguage=e.displayLanguage,this.displayCountry=e.displayCountry,this.decimalFormatPatternDefault=e.decimalFormatPatternDefault,this.decimalFormatSymbols=e.decimalFormatSymbols,this.decimalFormatPatternDefault&&this.decimalFormatSymbols&&(this.decimalFormat=new Ls(this,this.decimalFormatPatternDefault)),this.dateFormatPatternDefault=e.dateFormatPatternDefault,this.dateFormatSymbols=e.dateFormatSymbols,this.timeFormatPatternDefault=e.timeFormatPatternDefault,this.dateFormatPatternDefault&&this.dateFormatSymbols&&(this.dateFormat=new xt(this,this.dateFormatPatternDefault))}static ensure(e){return!e||e instanceof qt?e:new qt(e)}}Ai(qt,"DEFAULT",{languageTag:"en-US",decimalFormatPatternDefault:"#,##0.###",dateFormatPatternDefault:"MM/dd/yyyy",timeFormatPatternDefault:"h:mm a",decimalFormatSymbols:{decimalSeparator:".",groupingSeparator:",",minusSign:"-"},dateFormatSymbols:{months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],am:"AM",pm:"PM"}});function Zh(i,e,t){return e=Mv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Mv(i){var e=Iv(i,"string");return typeof e=="symbol"?e:String(e)}function Iv(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ed{constructor(){Zh(this,"filters",void 0),Zh(this,"_filterProperties",void 0),Zh(this,"_defaultFilter",void 0),this._filterProperties={},this._defaultFilter=this._propertiesFilter.bind(this),this.filters=[this._defaultFilter]}addFilterForProperties(e){b.copyProperties(e,this._filterProperties)}addFilter(e){this.filters.push(e)}filter(e,t){return this.filters.some(s=>s(e,t))}addFilterForPropertyName(e){this.filters.push((t,s)=>t===e)}_propertiesFilter(e,t){if(!this._filterProperties.hasOwnProperty(e))return!1;let s=this._filterProperties[e];return b.equals(s,t)}reset(){this._filterProperties={},this.filters=[this._defaultFilter]}}function Kn(i,e,t){return e=Lv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Lv(i){var e=Ov(i,"string");return typeof e=="symbol"?e:String(e)}function Ov(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class td{constructor(e){Kn(this,"session",void 0),Kn(this,"started",void 0),Kn(this,"initialDelay",void 0),Kn(this,"interval",void 0),Kn(this,"minPingDuration",void 0),Kn(this,"pingStartTimestamp",void 0),this.session=e,this.started=!1,this.initialDelay=1e3,this.interval=3e3,this.minPingDuration=1e3}start(){this.started||(a().log.isTraceEnabled()&&a().log.trace("[ajax reconnector] start"),this.started=!0,this._schedulePing(this.initialDelay))}stop(){this.started=!1}_schedulePing(e){a().log.isTraceEnabled()&&a().log.trace("[ajax reconnector] schedule ping() in "+e+" ms"),setTimeout(this._ping.bind(this),e)}_ping(){this.session.onReconnecting();let e=this.session.defaultAjaxOptions(this.session._newRequest({ping:!0}));a().log.isTraceEnabled()&&a().log.trace("[ajax reconnector] "+e.type+' "'+e.url+'"'),this.pingStartTimestamp=Date.now(),a().ajax(e).done(this._onPingDone.bind(this)).fail(this._onPingFail.bind(this))}_onPingDone(e,t,s){a().log.isTraceEnabled()&&a().log.trace("[ajax reconnector] ping success -> connection re-established!"),this.session.onReconnectingSucceeded(),this.stop()}_onPingFail(e,t,s){let r=function(){a().log.isTraceEnabled()&&a().log.trace("[ajax reconnector] ping failed"),this.session.onReconnectingFailed(),this._schedulePing(this.interval)}.bind(this),n=Date.now()-this.pingStartTimestamp;n<this.minPingDuration?setTimeout(r,this.minPingDuration-n):r()}}function zr(i,e,t){return e=Bv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Bv(i){var e=kv(i,"string");return typeof e=="symbol"?e:String(e)}function kv(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Kr{constructor(e){zr(this,"session",void 0),zr(this,"queue",void 0),zr(this,"lastProcessedSequenceNo",void 0),zr(this,"nextExpectedSequenceNo",void 0),zr(this,"force",void 0),zr(this,"forceTimeoutId",void 0),this.session=e,this.queue=[],this.lastProcessedSequenceNo=0,this.nextExpectedSequenceNo=1,this.force=!1,this.forceTimeoutId=null}add(e){let t=e&&e["#"];if(!(t&&t<=this.lastProcessedSequenceNo))if(t&&e.combined&&(this.lastProcessedSequenceNo=Math.max(t-1,this.lastProcessedSequenceNo),this.nextExpectedSequenceNo=Math.max(t,this.nextExpectedSequenceNo)),!t||this.queue.length===0)this.queue.push(e);else{let s=[],r=e;for(let n=0;n<this.queue.length;n++){let o=this.queue[n];o["#"]&&(r&&o["#"]>t&&(s.push(e),r=null),o["#"]<=this.lastProcessedSequenceNo)||s.push(o)}r&&s.push(r),this.queue=s}}process(e){e&&this.add(e);let t=!0,s=!1,r=[];for(let n=0;n<this.queue.length;n++){let o=this.queue[n],l=o["#"];if(l&&(this.nextExpectedSequenceNo&&!this.force&&!s&&(s=this.nextExpectedSequenceNo!==l),s)){r.push(o);continue}let h=this.session.processJsonResponseInternal(o);e&&o===e&&(t=h),l&&(this.lastProcessedSequenceNo=l,this.nextExpectedSequenceNo=l+1)}return this.queue=r,this._checkTimeout(),t}size(){return this.queue.length}_checkTimeout(){this.queue.length===0?(clearTimeout(this.forceTimeoutId),this.forceTimeoutId=null):this.forceTimeoutId||(this.forceTimeoutId=setTimeout(()=>{try{let e="[";for(let t=0;t<this.queue.length;t++)t>0&&(e+=", "),e+=y.box("#",this.queue[t]["#"]+"")||"<none>";e+="]",this.session.sendLogRequest("Expected response #"+this.nextExpectedSequenceNo+" still missing after "+Kr.FORCE_TIMEOUT+" ms. Forcing response queue to process "+this.size()+" elements: "+e)}catch{}this.force=!0;try{this.process()}finally{this.force=!1,this.forceTimeoutId=null}},Kr.FORCE_TIMEOUT))}prepareRequest(e){e["#ACK"]=this.lastProcessedSequenceNo}prepareHttpRequest(e){e.headers=e.headers||{},e.headers["X-Scout-#ACK"]=this.lastProcessedSequenceNo+""}}zr(Kr,"FORCE_TIMEOUT",10*1e3);function G(i,e,t){return e=Hv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Hv(i){var e=Nv(i,"string");return typeof e=="symbol"?e:String(e)}function Nv(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ii extends ts{constructor(){super(),G(this,"objectType",void 0),G(this,"partId",void 0),G(this,"url",void 0),G(this,"userAgent",void 0),G(this,"locale",void 0),G(this,"textMap",void 0),G(this,"ready",void 0),G(this,"unloading",void 0),G(this,"unloaded",void 0),G(this,"loggedOut",void 0),G(this,"inspector",void 0),G(this,"persistent",void 0),G(this,"offline",void 0),G(this,"inDevelopmentMode",void 0),G(this,"desktop",void 0),G(this,"layoutValidator",void 0),G(this,"focusManager",void 0),G(this,"keyStrokeManager",void 0),G(this,"uiSessionId",void 0),G(this,"clientSessionId",void 0),G(this,"forceNewClientSession",void 0),G(this,"remoteUrl",void 0),G(this,"unloadUrl",void 0),G(this,"modelAdapterRegistry",void 0),G(this,"ajaxCalls",void 0),G(this,"asyncEvents",void 0),G(this,"currentEvent",void 0),G(this,"responseQueue",void 0),G(this,"requestsPendingCounter",void 0),G(this,"suppressErrors",void 0),G(this,"requestTimeoutCancel",void 0),G(this,"requestTimeoutPoll",void 0),G(this,"requestTimeoutPing",void 0),G(this,"backgroundJobPollingSupport",void 0),G(this,"reconnector",void 0),G(this,"processingEvents",void 0),G(this,"adapterExportEnabled",void 0),G(this,"requestSequenceNo",void 0),G(this,"ajaxCallOptions",void 0),G(this,"rootAdapter",void 0),G(this,"root",void 0),G(this,"widget",void 0),G(this,"$entryPoint",void 0),G(this,"_adapterDataCache",void 0),G(this,"_busy",void 0),G(this,"_busyIndicator",void 0),G(this,"_busyIndicatorTimeoutId",void 0),G(this,"_deferredEventTypes",void 0),G(this,"_deferred",void 0),G(this,"_fatalMessagesOnScreen",void 0),G(this,"_retryRequest",void 0),G(this,"_queuedRequest",void 0),G(this,"_asyncDelay",void 0),G(this,"_sendTimeoutId",void 0),this.$entryPoint=null,this.partId="0",this.url=new vt,this.userAgent=new sd({deviceType:x.get().type,touch:x.get().supportsOnlyTouch(),standalone:x.get().isStandalone()}),this.locale=new qt,this.textMap=new Os,this.ready=!1,this.unloading=!1,this.unloaded=!1,this.loggedOut=!1,this.inspector=!1,this.persistent=!1,this.offline=!1,this.inDevelopmentMode=!1,this.desktop=null,this.layoutValidator=new nd,this.focusManager=null,this.keyStrokeManager=null,this.uiSessionId=null,this.clientSessionId=this._getClientSessionIdFromStorage(),this.forceNewClientSession=!1,this.remoteUrl="json",this.unloadUrl="unload",this.modelAdapterRegistry={},this.ajaxCalls=[],this.asyncEvents=[],this.currentEvent=null,this.responseQueue=new Kr(this),this.requestsPendingCounter=0,this.suppressErrors=!1,this.requestTimeoutCancel=5e3,this.requestTimeoutPoll=75e3,this.requestTimeoutPing=5e3,this.backgroundJobPollingSupport=new Jh(!0),this.reconnector=new td(this),this.processingEvents=!1,this.adapterExportEnabled=!1,this._adapterDataCache={},this._busy=!1,this._busyIndicator=null,this._busyIndicatorTimeoutId=null,this._deferred=null,this._fatalMessagesOnScreen={},this._retryRequest=null,this._queuedRequest=null,this.requestSequenceNo=0,this.rootAdapter=new ke,this.ajaxCallOptions=null,this.rootAdapter.init({session:this,id:"1",objectType:"RootAdapter"});let e=new Bl;e.session=this,e.initialized=!0,this.root=this.rootAdapter.createWidget({session:this,id:"1",objectType:"NullWidget"},e),this.widget=this.root}init(e){let t=e||{};if(!t.$entryPoint)throw new Error("$entryPoint is not defined");this.$entryPoint=t.$entryPoint,this.partId=u.nvl(t.portletPartId,this.partId),this.forceNewClientSession=u.nvl(this.url.getParameter("forceNewClientSession"),t.forceNewClientSession),this.forceNewClientSession?this.clientSessionId=null:this.clientSessionId=u.nvl(t.clientSessionId,this.clientSessionId),this.userAgent=u.nvl(t.userAgent,this.userAgent),this.suppressErrors=u.nvl(t.suppressErrors,this.suppressErrors),t.locale&&(this.locale=qt.ensure(t.locale),this.textMap=Ce.get(this.locale.languageTag)),t.backgroundJobPollingEnabled===!1&&(this.backgroundJobPollingSupport.enabled=!1),a().extend(this.reconnector,t.reconnectorOptions),this.ajaxCallOptions=t.ajaxCallOptions,(this.url.getParameter("debug")==="true"||this.url.getParameter("inspector")==="true")&&(this.inspector=!0),this.url.getParameter("adapterExportEnabled")==="true"&&(this.adapterExportEnabled=!0),this.focusManager=new bd({session:this,active:t.focusManagerActive}),this.keyStrokeManager=u.create(fd,{session:this})}_throwError(e){if(!this.suppressErrors)throw new Error(e)}unregisterModelAdapter(e){delete this.modelAdapterRegistry[e.id]}registerModelAdapter(e){if(e.id===void 0)throw new Error("modelAdapter.id must be defined");this.modelAdapterRegistry[e.id]=e}getModelAdapter(e){return this.modelAdapterRegistry[e]}getWidget(e){if(!e)return null;if(typeof e!="string")throw new Error("typeof adapterId must be string");let t=this.getModelAdapter(e);return t?t.widget:null}getOrCreateWidget(e,t,s){if(!e)return null;if(typeof e!="string")throw new Error("typeof adapterId must be string");let r=this.getWidget(e);if(r)return r;let n=this._getAdapterData(e);if(!n){if(u.nvl(s,!0))throw new Error("no adapterData found for adapterId="+e);return null}return this.createModelAdapter(n).createWidget(n,t)}createModelAdapter(e){let t=e.objectType,s={},r=Ts.parse(t);r.modelVariant?(t=r.objectType.toString()+"Adapter"+At.MODEL_VARIANT_SEPARATOR+r.modelVariant.toString(),s.variantLenient=!0):t=r.objectType.toString()+"Adapter";let n={id:e.id,session:this},o=u.create(t,n,s);return a().log.isTraceEnabled()&&a().log.trace("created new adapter "+o),o}sendEvent(e,t){t=t||0,this.asyncEvents=this._coalesceEvents(this.asyncEvents,e),this.asyncEvents.push(e),this._asyncDelay=Math.min(t,u.nvl(this._asyncDelay,t)),clearTimeout(this._sendTimeoutId),this._sendTimeoutId=setTimeout(()=>{this._sendTimeoutId=null,this._asyncDelay=null,!this.areRequestsPending()&&this._sendNow()},this._asyncDelay)}_sendStartupRequest(){let e=this._newRequest({startup:!0});this.partId&&(e.partId=this.partId),this.clientSessionId&&(e.clientSessionId=this.clientSessionId),te.get().version&&(e.version=te.get().version),e.userAgent=this.userAgent,e.sessionStartupParams=this._createSessionStartupParams();let t=this.defaultAjaxOptions(e);return a().ajax(t).catch(r.bind(this)).then(s.bind(this));function s(n){if(this._processStartupResponse(n),n.error)return a().rejectedPromise(n)}function r(n,o,l){this._processErrorResponse(n,o,l,e);for(var h=arguments.length,d=new Array(h>3?h-3:0),c=3;c<h;c++)d[c-3]=arguments[c];return a().rejectedPromise(n,o,l,...d)}}_createSessionStartupParams(){let e={url:this.url.baseUrlRaw,geolocationServiceAvailable:x.get().supportsGeolocation()},t=this.url.parameterMap;for(let s in t)e[s]=t[s];return e}_processStartupResponse(e){if(e.error&&this._processErrorJsonResponse(e.error))return;if(Se.removeItemFromSessionStorage("scout:versionMismatch"),!e.startupData)throw new Error("Missing startupData");if(this.persistent=e.startupData.persistent,this.inDevelopmentMode=!!e.startupData.inDevelopmentMode,this.clientSessionId=e.startupData.clientSessionId,this._storeClientSessionIdInStorage(this.clientSessionId),this.uiSessionId=e.startupData.uiSessionId,a()(window).on("beforeunload."+this.uiSessionId,this._onWindowBeforeUnload.bind(this)).on("unload."+this.uiSessionId,this._onWindowUnload.bind(this)),e.startupData.reloadPage){u.reloadPage();return}e.startupData.inspector&&(this.inspector=!0),this.requestTimeoutPoll=(e.startupData.pollingInterval+15)*1e3,this.modelAdapterRegistry[this.uiSessionId]=this,e.adapterData&&this._copyAdapterData(e.adapterData),this.locale=new qt(e.startupData.locale),this.textMap=Ce.get(this.locale.languageTag),this.textMap.addAll(e.startupData.textMap);let t=this._getAdapterData(e.startupData.clientSession);this.desktop=this.getOrCreateWidget(t.desktop,this.rootAdapter.widget),te.get()._triggerDesktopReady(this.desktop);let s=function(){if(this._renderDesktop(),e.events){this.processingEvents=!0;try{this._processEvents(e.events)}finally{this.processingEvents=!1}}this.layoutValidator.validate(),this.focusManager.validateFocus(),this._resumeBackgroundJobPolling(),this.ready=!0,te.get()._triggerSessionReady(this),a().log.isInfoEnabled()&&a().log.info("Session initialized. Detected "+x.get()),a().log.isDebugEnabled()&&(a().log.isDebugEnabled()&&a().log.debug("size of _adapterDataCache after session has been initialized: "+b.countOwnProperties(this._adapterDataCache)),a().log.isDebugEnabled()&&a().log.debug("size of modelAdapterRegistry after session has been initialized: "+b.countOwnProperties(this.modelAdapterRegistry)))}.bind(this);this.render(s)}_storeClientSessionIdInStorage(e){let t="scout:clientSessionId";Se.removeItemFromSessionStorage(t),Se.removeItemFromLocalStorage(t),this.persistent?Se.setItemToLocalStorage(t,e):Se.setItemToSessionStorage(t,e)}_getClientSessionIdFromStorage(){let e="scout:clientSessionId",t=Se.getItemFromSessionStorage(e);return t||(t=Se.getItemFromLocalStorage(e)),t}render(e){bt.loadingComplete?e():bt.preloader().then(e)}_sendUnloadRequest(){let e=this._newRequest({unload:!0,showBusyIndicator:!1});this._sendRequest(e)}_sendNow(){if(this.asyncEvents.length===0)return;let e=[];this.asyncEvents.some((s,r)=>s.newRequest&&e.length>0?!0:(e.push(s),!1));let t=this._newRequest({events:e});t.showBusyIndicator=t.events.some(s=>u.nvl(s.showBusyIndicator,!0)),this.responseQueue.prepareRequest(t),this._sendRequest(t),this.asyncEvents=this.asyncEvents.slice(e.length)}_coalesceEvents(e,t){if(!t.coalesce)return e;let s=a().negate(t.coalesce).bind(t);return e.filter(s)}_sendRequest(e){if(!e||this.loggedOut)return;if(this.offline&&!e.unload){this._handleSendWhenOffline(e);return}if(e.unload&&navigator.sendBeacon){navigator.sendBeacon(this.unloadUrl+"/"+this.uiSessionId,"");return}let t=this.defaultAjaxOptions(e),s=u.nvl(e.showBusyIndicator,!0);e.unload&&(t.async=!1),this._performUserAjaxRequest(t,s,e)}_handleSendWhenOffline(e){!e.events||(this._queuedRequest?this._queuedRequest.events?(e.events.forEach(t=>{this._queuedRequest.events=this._coalesceEvents(this._queuedRequest.events,t)}),this._queuedRequest.events=this._queuedRequest.events.concat(e.events)):this._queuedRequest.events=e.events:this._queuedRequest=e,this.layoutValidator.validate())}defaultAjaxOptions(e){e=e||this._newRequest();let s={type:"POST",dataType:"json",contentType:"application/json; charset=UTF-8",cache:!1,url:this._decorateUrl(this.remoteUrl,e),data:this._requestToJson(e)};return s.timeout=0,e.cancel&&(s.timeout=this.requestTimeoutCancel),e.ping&&(s.timeout=this.requestTimeoutPing),e.pollForBackgroundJobs&&(s.timeout=this.requestTimeoutPoll),s}_decorateUrl(e,t){let s=null;return t.unload?s="unload":t.pollForBackgroundJobs?s="poll":t.ping?s="ping":t.cancel?s="cancel":t.log?s="log":t.syncResponseQueue&&(s="sync"),s&&(e=new vt(e).addParameter(s).toString()),e}_getRequestName(e,t){if(e){if(e.unload)return"unload";if(e.pollForBackgroundJobs)return"pollForBackgroundJobs";if(e.ping)return"ping";if(e.cancel)return"cancel";if(e.log)return"log";if(e.syncResponseQueue)return"syncResponseQueue"}return t}_requestToJson(e){return JSON.stringify(e,function(t,s){return this===e&&t==="showBusyIndicator"||this instanceof ql&&u.isOneOf(t,"showBusyIndicator","coalesce","newRequest")?void 0:s})}_callAjax(e){let t={retryIntervals:[100,500,500,500]},s=u.create(pr,a().extend(t,e,this.ajaxCallOptions),{ensureUniqueId:!1});return this.registerAjaxCall(s),s.call().always(this.unregisterAjaxCall.bind(this,s))}_performUserAjaxRequest(e,t,s){t&&this.setBusy(!0),this.setRequestPending(!0);let r=null,n=!1;this._callAjax({ajaxOptions:e,name:this._getRequestName(s,"user request")}).done(o.bind(this)).fail(l.bind(this)).always(h.bind(this));function o(d){try{t&&!this.areBusyIndicatedEventsQueued()&&this.setBusy(!1),n=this.responseQueue.process(d)}catch(c){r=r||c}}function l(d){try{t&&this.setBusy(!1),this._processErrorResponse(d.jqXHR,d.textStatus,d.errorThrown,s)}catch(c){r=r||c}}function h(d,c,f){if(this.setRequestPending(!1),n){if(this._resumeBackgroundJobPolling(),this._fireRequestFinished(d),this._retryRequest){let m=this._retryRequest;this._retryRequest=null,this.responseQueue.prepareRequest(m),this._sendRequest(m)}else if(this._queuedRequest){let m=this._queuedRequest;this._queuedRequest=null,this.responseQueue.prepareRequest(m),this._sendRequest(m)}this._sendTimeoutId||this._sendNow()}else this.setBusy(!1);if(this.layoutValidator.validate(),r)throw r}}registerAjaxCall(e){this.ajaxCalls.push(e)}unregisterAjaxCall(e){p.remove(this.ajaxCalls,e)}interruptAllAjaxCalls(){this.ajaxCalls.slice().forEach(e=>e.pendingCall&&e.pendingCall.abort())}abortAllAjaxCalls(){this.ajaxCalls.slice().forEach(e=>e.abort())}_resumeBackgroundJobPolling(){this.backgroundJobPollingSupport.enabled&&this.backgroundJobPollingSupport.status!==Ki.RUNNING&&(a().log.isInfoEnabled()&&a().log.info("Resume background jobs polling request, status was="+this.backgroundJobPollingSupport.status),this._pollForBackgroundJobs())}_pollForBackgroundJobs(){this.backgroundJobPollingSupport.setRunning();let e=this._newRequest({pollForBackgroundJobs:!0});this.responseQueue.prepareRequest(e);let t=this.defaultAjaxOptions(e);this._callAjax({ajaxOptions:t,name:this._getRequestName(e,"request")}).done(s.bind(this)).fail(r.bind(this));function s(n){if(n.error)a().log.warn("Polling request failed. Interrupt polling until the next user-initiated request succeeds"),this.backgroundJobPollingSupport.setFailed(),this.areRequestsPending()?this.responseQueue.add(n):this.responseQueue.process(n);else if(n.sessionTerminated)a().log.info("Session terminated, stopped polling for background jobs"),this.backgroundJobPollingSupport.setStopped(),!this.loggedOut&&n.redirectUrl&&this.logout(n.redirectUrl);else try{this.areRequestsPending()?this.responseQueue.add(n):(this.responseQueue.process(n),this.layoutValidator.validate()),setTimeout(this._pollForBackgroundJobs.bind(this))}catch(o){throw this.backgroundJobPollingSupport.setFailed(),o}}function r(n){this.backgroundJobPollingSupport.setFailed(),this._processErrorResponse(n.jqXHR,n.textStatus,n.errorThrown,e)}}processJsonResponseInternal(e){let t=!0;return e.error&&(t=!this._processErrorJsonResponse(e.error)),t&&this._processSuccessResponse(e),t}_processSuccessResponse(e){if(e.adapterData&&this._copyAdapterData(e.adapterData),e.events){this.processingEvents=!0;try{this._processEvents(e.events)}finally{this.processingEvents=!1}}if(a().log.isDebugEnabled()){let t=b.countOwnProperties(this._adapterDataCache);a().log.trace("size of _adapterDataCache after response has been processed: "+t),t=b.countOwnProperties(this.modelAdapterRegistry),a().log.trace("size of modelAdapterRegistry after response has been processed: "+t)}}_copyAdapterData(e){let t=0,s;for(s in e)this._adapterDataCache[s]=e[s],t++;t>0&&a().log.isTraceEnabled()&&a().log.trace("Stored "+t+" properties in adapterDataCache")}_processErrorResponse(e,t,s,r){if(a().log.error("errorResponse: status="+e.status+", textStatus="+t+", errorThrown="+s),pr.isOfflineError(e,t,s)){if(this.ready){this.goOffline(),r&&!r.pollForBackgroundJobs&&!this._retryRequest&&(this._retryRequest=r);return}s=s||this.optText("ui.ConnectionInterrupted","Connection interrupted")}let o={header:this.optText("ui.NetworkError","Network error"),body:y.join(" ",e.status+""||"",s),yesButtonText:this.optText("ui.Reload","Reload"),yesButtonAction:()=>u.reloadPage(),iconId:ye.SLIPPERY};this.showFatalMessage(o,e.status+".net")}_processErrorJsonResponse(e){let t=!0;if(e.code===ii.JsonResponseError.VERSION_MISMATCH){if(!Se.getItemFromSessionStorage("scout:versionMismatch"))return Se.setItemToSessionStorage("scout:versionMismatch","yes"),u.reloadPage(),t;Se.removeItemFromSessionStorage("scout:versionMismatch")}if(this.loggedOut)return t;let s={header:this.optText("ui.ServerError","Server error")+" ("+this.optText("ui.ErrorCodeX","Code "+e.code,e.code+"")+")",body:e.message,yesButtonText:this.optText("ui.Reload","Reload"),yesButtonAction:()=>{u.reloadPage()}};return e.code===ii.JsonResponseError.STARTUP_FAILED?(s.header=e.message,s.body=null,s.yesButtonText="Retry",s.iconId=ye.SLIPPERY):e.code===ii.JsonResponseError.SESSION_TIMEOUT?(s.header=this.optText("ui.SessionTimeout",s.header),s.body=this.optText("ui.SessionExpiredMsg",s.body),s.iconId=ye.HOURGLASS):e.code===ii.JsonResponseError.UI_PROCESSING?(s.header=this.optText("ui.UnexpectedProblem",s.header),s.body=y.join(`

`,this.optText("ui.InternalProcessingErrorMsg",s.body," ("+this.optText("ui.ErrorCodeX","Code 20","20")+")"),this.optText("ui.UiInconsistentMsg","")),s.iconId=ye.SLIPPERY,this.inDevelopmentMode&&(s.noButtonText=this.optText("ui.Ignore","Ignore"))):e.code===ii.JsonResponseError.UNSAFE_UPLOAD?(s.header=this.optText("ui.UnsafeUpload",s.header),s.body=this.optText("ui.UnsafeUploadMsg",s.body),s.yesButtonText=this.optText("ui.Ok","Ok"),t=!1):e.code===ii.JsonResponseError.REJECTED_UPLOAD&&(s.header=this.optText("ui.RejectedUpload",s.header),s.body=this.optText("ui.RejectedUploadMsg",s.body),s.yesButtonText=this.optText("ui.Ok","Ok"),t=!1),this.showFatalMessage(s,e.code+""),t}_fireRequestFinished(e){if(!!this._deferred){if(e.events)for(let t=0;t<e.events.length;t++)this._deferredEventTypes.push(e.events[t].type);this.requestsPendingCounter===0&&(this._deferred.resolve(this._deferredEventTypes),this._deferred=null,this._deferredEventTypes=null)}}showFatalMessage(e,t){if(t||(t=te.get().errorHandler.getJsErrorCode()),this._fatalMessagesOnScreen[t])return;this._fatalMessagesOnScreen[t]=!0,e=e||{};let s={session:this,parent:this.desktop||new Bl,iconId:e.iconId,severity:u.nvl(e.severity,E.Severity.ERROR),header:e.header,body:e.body,hiddenText:e.hiddenText,yesButtonText:e.yesButtonText,noButtonText:e.noButtonText,cancelButtonText:e.cancelButtonText},r=u.create(vi,s),n=e.entryPoint||this.$entryPoint;r.on("action",o=>{delete this._fatalMessagesOnScreen[t],r.destroy();let l=o.option;l===vi.Buttons.YES&&e.yesButtonAction?e.yesButtonAction.apply(this):l===vi.Buttons.NO&&e.noButtonAction?e.noButtonAction.apply(this):l===vi.Buttons.CANCEL&&e.cancelButtonAction&&e.cancelButtonAction.apply(this)}),r.render(n)}isFatalMessageShown(){return Object.keys(this._fatalMessagesOnScreen).length>0}uploadFiles(e,t,s,r,n){let o=new FormData,l=[];if(s&&a().each(s,(c,f)=>{o.append(c,f)}),a().each(t,(c,f)=>{if(!n||n.length===0||u.isOneOf(f.type,n)){let m=u.nvl(f.scoutName,f.name,ii.EMPTY_UPLOAD_FILENAME);o.append("files",f,m),l.push(f)}}),r=u.nvl(r,_i.DEFAULT_MAXIMUM_UPLOAD_SIZE),!qs.validateMaximumUploadSize(l,r)){let c={header:this.text("ui.FileSizeLimitTitle"),body:this.text("ui.FileSizeLimit",r/1024/1024+""),yesButtonText:this.optText("Ok","Ok")};return this.showFatalMessage(c),!1}let h={type:"POST",url:"upload/"+this.uiSessionId+"/"+e.id,cache:!1,processData:!1,contentType:!1,data:o};this.responseQueue.prepareHttpRequest(h);let d=!this.areRequestsPending();return this._performUserAjaxRequest(h,d),!0}goOffline(){this.offline||(this.offline=!0,this.abortAllAjaxCalls(),setTimeout(()=>{this.unloading||this.unloaded||(this.rootAdapter.goOffline(),this.reconnector.start())},100))}goOnline(){this.offline=!1,this.rootAdapter.goOnline();let e=this._newRequest({syncResponseQueue:!0});this.responseQueue.prepareRequest(e),this._sendRequest(e)}onReconnecting(){this.desktop&&this.desktop.onReconnecting()}onReconnectingSucceeded(){this.desktop&&this.desktop.onReconnectingSucceeded(),this.goOnline()}onReconnectingFailed(){this.desktop&&this.desktop.onReconnectingFailed()}listen(){return this._deferred||(this._deferred=a().Deferred(),this._deferredEventTypes=[]),this._deferred}onRequestsDone(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];this.areRequestsPending()||this.areEventsQueued()?this.listen().done(n):e.apply(this,s);function n(){e.apply(this,s)}}onEventsProcessed(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];this.processingEvents?this.one("eventsProcessed",n):n();function n(){e.apply(this,s)}}areEventsQueued(){return this.asyncEvents.length>0}areBusyIndicatedEventsQueued(){return this.asyncEvents.some(e=>u.nvl(e.showBusyIndicator,!0))}areResponsesQueued(){return this.responseQueue.size()>0}areRequestsPending(){return this.requestsPendingCounter>0}setRequestPending(e){e?this.requestsPendingCounter++:this.requestsPendingCounter--,this.inspector&&this.$entryPoint.toggleAttr("data-request-pending",e,"true")}setBusy(e){e?(this._busy||this._renderBusy(),this._busy=!0):(this._busy&&this._removeBusy(),this._busy=!1)}_renderBusy(){this._busyIndicatorTimeoutId!==null&&this._busyIndicatorTimeoutId!==void 0||(this._busyIndicatorTimeoutId=setTimeout(()=>{this._busyIndicator||!this.desktop||!this.desktop.rendered||(this._busyIndicator=u.create(Qh,{parent:this.desktop}),this._busyIndicator.on("cancel",this._onCancelProcessing.bind(this)),this._busyIndicator.render(this.$entryPoint))},500))}_removeBusy(){clearTimeout(this._busyIndicatorTimeoutId),this._busyIndicatorTimeoutId=null,this._busyIndicator&&(this._busyIndicator.destroy(),this._busyIndicator=null)}_onCancelProcessing(e){let t=this._busyIndicator;!t||(t.off("cancel"),setTimeout(()=>{t.cancelled()},100),this._sendCancelRequest())}_sendCancelRequest(){let e=this._newRequest({cancel:!0,showBusyIndicator:!1});this._sendRequest(e)}sendLogRequest(e,t){let s=this._newRequest({log:!0,message:e,level:u.nvl(t,qe.ERROR)});this.currentEvent&&(s.event={target:this.currentEvent.target,type:this.currentEvent.type}),a().ajax(this.defaultAjaxOptions(s))}_newRequest(e){let t=a().extend({uiSessionId:this.uiSessionId},e);return!t.log&&!t.syncResponseQueue&&(t["#"]=this.requestSequenceNo++),t}_processEvents(e){let t=0;for(;t<e.length;){let s=e[t];this.currentEvent=s;let r=this.getModelAdapter(s.target);if(!r){a().log.isDebugEnabled()&&a().log.debug("Postponing '"+s.type+"' for adapter with ID "+s.target),t++;continue}e.splice(t,1),t=0,a().log.isDebugEnabled()&&a().log.debug("Processing event '"+s.type+"' for adapter with ID "+s.target),r.onModelEvent(s),r.resetEventFilters()}if(this.currentEvent=null,e.length)throw new Error("Could not resolve event targets: ["+e.map(s=>{let r="target: "+s.target+", type: "+s.type;return s.properties&&(r+=", properties: "+Object.keys(s.properties)),'"'+r+'"'},this).join(", ")+"]");this.trigger("eventsProcessed")}start(){return a().log.isInfoEnabled()&&a().log.info("Session starting..."),this._sendStartupRequest()}onModelEvent(e){e.type==="localeChanged"?this._onLocaleChanged(e):e.type==="logout"?this._onLogout(e):e.type==="disposeAdapter"?this._onDisposeAdapter(e):e.type==="reloadPage"?this._onReloadPage(e):a().log.warn('Model action "'+e.type+'" is not supported by UI session')}resetEventFilters(){}destroy(){}exportAdapterData(e){return e}_onLocaleChanged(e){let t=new qt(e.locale),s=new Os(e.textMap);this.switchLocale(t,s)}switchLocale(e,t){u.assertParameter("locale",e,qt),this.locale=e,this.textMap=Ce.get(e.languageTag),t&&b.copyOwnProperties(t,this.textMap),this.trigger("localeSwitch",{locale:this.locale})}_renderDesktop(){this.desktop.render(this.$entryPoint),this.desktop.invalidateLayoutTree(!1)}_onLogout(e){this.logout(e.redirectUrl)}logout(e){if(this.loggedOut=!0,this.forceNewClientSession)this.desktop.$container.window(!0).close();else{let t=new vt;t.removeParameter("dl"),t.removeParameter("i"),Se.setItemToSessionStorage("scout:loginUrl",t.toString()),setTimeout(()=>{u.reloadPage({redirectUrl:e})})}}_onDisposeAdapter(e){let t=this.getModelAdapter(e.adapter);t&&t.destroy()}_onReloadPage(e){u.reloadPage({clearBody:!1})}_onWindowBeforeUnload(e){a().log.isInfoEnabled()&&a().log.info("Session before unloading..."),this.unloading=!0,setTimeout(()=>{this.unloading=!1},200)}_onWindowUnload(){a().log.isInfoEnabled()&&a().log.info("Session unloading..."),this.unloaded=!0,this.desktop&&this.desktop.formController&&this.desktop.formController.closePopupWindows(),this.loggedOut||this._sendUnloadRequest(),this.loggedOut&&this.persistent&&Se.removeItemFromLocalStorage("scout:clientSessionId")}_getAdapterData(e){let t=this._adapterDataCache[e];return!this.adapterExportEnabled&&delete this._adapterDataCache[e],t}getAdapterData(e){return this._adapterDataCache[e]}text(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];return this.textMap.get(e,...s)}optText(e,t){for(var s=arguments.length,r=new Array(s>2?s-2:0),n=2;n<s;n++)r[n-2]=arguments[n];return this.textMap.optGet(e,t,...r)}textExists(e){return this.textMap.exists(e)}}G(ii,"JsonResponseError",{STARTUP_FAILED:5,SESSION_TIMEOUT:10,UI_PROCESSING:20,UNSAFE_UPLOAD:30,REJECTED_UPLOAD:31,VERSION_MISMATCH:40}),G(ii,"EMPTY_UPLOAD_FILENAME","*empty*");function id(i,e,t){return e=Vv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Vv(i){var e=Wv(i,"string");return typeof e=="symbol"?e:String(e)}function Wv(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class sd{constructor(e){if(id(this,"deviceType",void 0),id(this,"touch",void 0),id(this,"standalone",void 0),e=e||{},!e.deviceType)throw new Error("deviceType needs to be defined");this.deviceType=e.deviceType,this.touch=u.nvl(e.touch,!1),this.standalone=u.nvl(e.standalone,!1)}}function zv(i,e,t){return e=Kv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Kv(i){var e=Gv(i,"string");return typeof e=="symbol"?e:String(e)}function Gv(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class rd{constructor(){zv(this,"filters",void 0),this.filters=[]}addFilter(e){this.filters.push(e)}addFilterForEventType(e){this.filters.push(t=>t.type===e)}filter(e){return this.filters.some(t=>t(e))}reset(){this.filters=[]}}function gm(i,e,t){return e=Uv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Uv(i){var e=qv(i,"string");return typeof e=="symbol"?e:String(e)}function qv(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class F{constructor(e,t){gm(this,"width",void 0),gm(this,"height",void 0),e instanceof F?(this.width=e.width,this.height=e.height):(this.width=e||0,this.height=t||0)}toString(){return"Dimension[width="+this.width+" height="+this.height+"]"}equals(e){return e?this.width===e.width&&this.height===e.height:!1}clone(){return new F(this.width,this.height)}subtract(e){return new F(this.width-e.horizontal(),this.height-e.vertical())}add(e){return new F(this.width+e.horizontal(),this.height+e.vertical())}floor(){return new F(Math.floor(this.width),Math.floor(this.height))}ceil(){return new F(Math.ceil(this.width),Math.ceil(this.height))}}function Yl(i,e,t){return e=Yv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Yv(i){var e=jv(i,"string");return typeof e=="symbol"?e:String(e)}function jv(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ge{constructor(e,t,s,r){Yl(this,"top",void 0),Yl(this,"right",void 0),Yl(this,"bottom",void 0),Yl(this,"left",void 0),e instanceof Ge?(this.top=e.top,this.right=e.right,this.bottom=e.bottom,this.left=e.left):(this.top=e||0,this.right=t||0,this.bottom=s||0,this.left=r||0)}toString(){return"Insets[top="+this.top+" right="+this.right+" bottom="+this.bottom+" left="+this.left+"]"}equals(e){return this.top===e.top&&this.right===e.right&&this.bottom===e.bottom&&this.left===e.left}clone(){return new Ge(this.top,this.right,this.bottom,this.left)}horizontal(){return this.right+this.left}vertical(){return this.top+this.bottom}floor(){return new Ge(Math.floor(this.top),Math.floor(this.right),Math.floor(this.bottom),Math.floor(this.left))}ceil(){return new Ge(Math.ceil(this.top),Math.ceil(this.right),Math.ceil(this.bottom),Math.ceil(this.left))}}function _m(i,e,t){return e=Xv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Xv(i){var e=Jv(i,"string");return typeof e=="symbol"?e:String(e)}function Jv(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class X{constructor(e,t){_m(this,"x",void 0),_m(this,"y",void 0),e instanceof X?(this.x=e.x,this.y=e.y):(this.x=e||0,this.y=t||0)}toString(){return"Point[x="+this.x+" y="+this.y+"]"}equals(e){return e?this.x===e.x&&this.y===e.y:!1}clone(){return new X(this.x,this.y)}add(e){return new X(this.x+e.x,this.y+e.y)}subtract(e){return new X(this.x-e.x,this.y-e.y)}floor(){return new X(Math.floor(this.x),Math.floor(this.y))}ceil(){return new X(Math.ceil(this.x),Math.ceil(this.y))}}function jl(i,e,t){return e=Qv(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Qv(i){var e=Zv(i,"string");return typeof e=="symbol"?e:String(e)}function Zv(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ie{constructor(e,t,s,r){jl(this,"x",void 0),jl(this,"y",void 0),jl(this,"width",void 0),jl(this,"height",void 0),e instanceof ie?(this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height):(this.x=e||0,this.y=t||0,this.width=s||0,this.height=r||0)}toString(){return"Rectangle[x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"}equals(e){return e?this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height:!1}clone(){return new ie(this.x,this.y,this.width,this.height)}center(){return new X(this.x+this.width/2,this.y+this.height/2)}right(){return this.x+this.width}bottom(){return this.y+this.height}contains(e,t){return t>=this.y&&t<this.y+this.height&&e>=this.x&&e<this.x+this.width}intersects(e){return e?e.width>0&&e.height>0&&this.width>0&&this.height>0&&e.x<this.right()&&e.right()>this.x&&e.y<this.bottom()&&e.bottom()>this.y:!1}subtract(e){return new ie(this.x+e.left,this.y+e.top,this.width-e.horizontal(),this.height-e.vertical())}subtractFromDimension(e){return new ie(this.x,this.y,this.width-e.horizontal(),this.height-e.vertical())}translate(e,t){return new ie(this.x+e,this.y+t,this.width,this.height)}point(){return new X(this.x,this.y)}dimension(){return new F(this.width,this.height)}union(e){let t=this.width,s=this.height;if(t<0||s<0)return new ie(e.x,e.y,e.width,e.height);let r=e.width,n=e.height;if(r<0||n<0)return new ie(this.x,this.y,this.width,this.height);let o=this.x,l=this.y;t+=o,s+=l;let h=e.x,d=e.y;return r+=h,n+=d,o>h&&(o=h),l>d&&(l=d),t<r&&(t=r),s<n&&(s=n),t-=o,s-=l,t>Number.MAX_VALUE&&(t=Number.MAX_VALUE),s>Number.MAX_VALUE&&(s=Number.MAX_VALUE),new ie(o,l,t,s)}floor(){return new ie(Math.floor(this.x),Math.floor(this.y),Math.floor(this.width),Math.floor(this.height))}ceil(){return new ie(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.width),Math.ceil(this.height))}}function ew(i,e,t,s,r){let n=e instanceof ie?e:new ie(e,t,s,r);i.cssLeft(n.x).cssTop(n.y).cssWidth(n.width).cssHeight(n.height)}function tw(i,e,t){let s=e instanceof F?e:new F(e,t);i.cssWidth(s.width).cssHeight(s.height)}function iw(i,e,t){let s=e instanceof X?e:new X(e,t);i.cssLeft(s.x).cssTop(s.y)}const v={prefSize(i,e){if(!i[0]||i.isDisplayNone())return new F(0,0);typeof e=="boolean"?e={includeMargin:e}:e=e||{};let t={includeMargin:!1,useCssSize:!1,widthHint:void 0,heightHint:void 0,restoreScrollPositions:!0};if(e=a().extend({},t,e),e.animateClasses&&e.animateClasses.length>0)return v.prefSizeWithoutAnimation(i,e);let s=i.attr("style"),r=i.scrollLeft(),n=i.scrollTop();e.restoreScrollPositions&&P.storeScrollPositions(i);let o=e.useCssSize?"":u.nvl(e.widthHint,"auto"),l=e.useCssSize?"":u.nvl(e.heightHint,"auto"),h={width:o,height:l};u.nvl(e.enforceSizeHints,!1)&&(b.isNumber(o)&&(h["max-width"]=o,h["min-width"]=o),b.isNumber(l)&&(h["max-height"]=l,h["min-height"]=l)),i.css(h);let d=i[0].getBoundingClientRect(),c=new F(d.width,d.height);return e.includeMargin&&(c.width+=i.cssMarginX(),c.height+=i.cssMarginY()),i.attrOrRemove("style",s),i.scrollLeft(r),i.scrollTop(n),e.restoreScrollPositions&&P.restoreScrollPositions(i),v.exactPrefSize(c,e)},exactPrefSize(i,e){return u.nvl(e.exact,!1)||(i.width=Math.ceil(i.width),i.height=Math.ceil(i.height)),i},prefSizeWithoutAnimation(i,e){let t=p.ensure(e.animateClasses);if(t=t.filter(o=>i.hasClass(o)),e=a().extend({},e),e.animateClasses=null,t.length===0)return v.prefSize(i,e);let s=p.format(t," "),r=i.clone().removeClass(s).appendTo(i.parent()),n=v.prefSize(r,e);return r.remove(),n},size(i,e){if(!i[0]||i.isDisplayNone())return new F(0,0);typeof e=="boolean"?e={includeMargin:e}:e=e||{};let t=i[0].getBoundingClientRect(),s=new F(t.width,t.height);return u.nvl(e.includeMargin,!1)&&(s.width+=i.cssMarginX(),s.height+=i.cssMarginY()),u.nvl(e.exact,!1)||(s.width=Math.ceil(s.width),s.height=Math.ceil(s.height)),s},cssSize(i){return new F(i.cssWidth(),i.cssHeight())},cssMaxSize(i){return new F(i.cssMaxWidth(),i.cssMaxHeight())},cssMinSize(i){return new F(i.cssMinWidth(),i.cssMinHeight())},setSize:tw,insets(i,e){let t;typeof e=="boolean"?t={includeMargin:e}:t=e||{};let s,r=["top","right","bottom","left"],n=[0,0,0,0],o=u.nvl(t.includeMargin,!1),l=u.nvl(t.includePadding,!0),h=u.nvl(t.includeBorder,!0);for(s=0;s<r.length;s++)o&&(n[s]+=i.cssPxValue("margin-"+r[s])),l&&(n[s]+=i.cssPxValue("padding-"+r[s])),h&&(n[s]+=i.cssPxValue("border-"+r[s]+"-width"));return new Ge(n[0],n[1],n[2],n[3])},margins(i){return v.insets(i,{includeMargin:!0,includePadding:!1,includeBorder:!1})},setMargins(i,e){i.css({marginLeft:e.left,marginRight:e.right,marginTop:e.top,marginBottom:e.bottom})},paddings(i){return v.insets(i,{includeMargin:!1,includePadding:!0,includeBorder:!1})},borders(i){return v.insets(i,{includeMargin:!1,includePadding:!1,includeBorder:!0})},setLocation:iw,location(i){return new X(i.cssLeft(),i.cssTop())},bounds(i,e){return v._bounds(i,i.position(),e)},position(i){let e=i.position();return new X(e.left,e.top)},offsetBounds(i,e){return v._bounds(i,i.offset(),e)},offset(i){let e=i.offset();return new X(e.left,e.top)},_bounds(i,e,t){let s=v.size(i,t);return new ie(e.left,e.top,s.width,s.height)},setBounds:ew,cssBounds(i){return new ie(i.cssLeft(),i.cssTop(),i.cssWidth(),i.cssHeight())},debugOutput(i){if(!i)return"$comp is undefined";if(i=a().ensure(i),i.length===0)return"$comp doesn	 match any elements";let e="";if(i.attr("id")&&(e+="id="+i.attr("id")),i.attr("class")&&(e+=" class="+i.attr("class")),i.attr("data-modelclass")&&(e+=" data-modelclass="+i.attr("data-modelclass")),e.length===0){let t=u.nvl(i.html(),"");t.length>30&&(t=t.substring(0,30)+"..."),e=t}return i.isAttached()||(e+=" attached=false"),"Element["+e.trim()+"]"}};function mr(i,e,t){return e=sw(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function sw(i){var e=rw(i,"string");return typeof e=="symbol"?e:String(e)}function rw(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}let Xl;class de extends ts{constructor(){super(),mr(this,"formRowHeight",void 0),mr(this,"formRowGap",void 0),mr(this,"formColumnWidth",void 0),mr(this,"formColumnGap",void 0),mr(this,"smallColumnGap",void 0),mr(this,"fieldLabelWidth",void 0),mr(this,"fieldMandatoryIndicatorWidth",void 0),mr(this,"fieldStatusWidth",void 0),this.formRowHeight=30,this.formRowGap=10,this.formColumnWidth=420,this.formColumnGap=32,this.smallColumnGap=4,this.fieldLabelWidth=140,this.fieldMandatoryIndicatorWidth=8,this.fieldStatusWidth=20}init(e){e=e?" "+e:"",this.formRowHeight=M.getSize("html-env-logical-grid-row"+e,"height","height",this.formRowHeight),this.formRowGap=M.getSize("html-env-logical-grid-row"+e,"margin-bottom","marginBottom",this.formRowGap),this.formColumnWidth=M.getSize("html-env-logical-grid-column"+e,"width","width",this.formColumnWidth),this.formColumnGap=M.getSize("html-env-logical-grid-column"+e,"margin-right","marginRight",this.formColumnGap),this.smallColumnGap=M.getSize("html-env-logical-grid-column"+e,"margin-left","marginLeft",this.smallColumnGap),this.fieldLabelWidth=M.getSize("html-env-field-label"+e,"width","width",this.fieldLabelWidth),this.fieldMandatoryIndicatorWidth=M.getSize("html-env-field-mandatory-indicator"+e,"width","width",this.fieldMandatoryIndicatorWidth),this.fieldStatusWidth=M.getSize("html-env-field-status"+e,"width","width",this.fieldStatusWidth),this.trigger("propertyChange")}static get(){return Xl}}te.addListener("prepare",()=>{Xl||(Xl=u.create(de),Xl.init())});function ym(i,e,t){return e=nw(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function nw(i){var e=ow(i,"string");return typeof e=="symbol"?e:String(e)}function ow(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ee{constructor(){ym(this,"animateClasses",void 0),ym(this,"cssClass",void 0),this.animateClasses=[]}invalidate(e){}layout(e){}_revertSizeHintsAdjustments(e,t){let s=T.get(e);t.widthHint&&(t.widthHint+=s.insets().horizontal()),t.heightHint&&(t.heightHint+=s.insets().vertical())}preferredLayoutSize(e,t){return t=a().extend({},t),this.animateClasses.length>0&&(t.animateClasses=this.animateClasses),this._revertSizeHintsAdjustments(e,t),v.prefSize(e,t)}}function fi(i,e,t){return e=lw(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function lw(i){var e=aw(i,"string");return typeof e=="symbol"?e:String(e)}function aw(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class T{constructor(e,t){if(fi(this,"$comp",void 0),fi(this,"layout",void 0),fi(this,"layoutData",void 0),fi(this,"layouted",void 0),fi(this,"layouting",void 0),fi(this,"pixelBasedSizing",void 0),fi(this,"prefSizeCached",void 0),fi(this,"scrollable",void 0),fi(this,"session",void 0),fi(this,"sizeCached",void 0),fi(this,"suppressInvalidate",void 0),fi(this,"suppressValidate",void 0),fi(this,"valid",void 0),fi(this,"validateRoot",void 0),!t)throw new Error("session must be defined for "+this.debug());this.$comp=e,this.layout=new Yn,this.layoutData=null,this.valid=!1,this.validateRoot=!1,this.layouted=!1,this.layouting=!1,this.suppressInvalidate=!1,this.suppressValidate=!1,this.pixelBasedSizing=!0,this.sizeCached=null,this.prefSizeCached={},this.session=t,this.scrollable=!1}getParent(){let e=this.$comp.parent();return e.length===0?null:T.optGet(e)}isDescendantOf(e){let t=this.$comp.parent();for(;t.length>0;){if(T.optGet(t)===e)return!0;t=t.parent()}return!1}availableSize(e){e=e||{};let t=this.size({exact:e.exact});if(this.scrollable){let s=this.prefSize({widthHint:t.width,removeMarginFromHints:!1});s.height>t.height&&(t.height=s.height)}return t}invalidateLayout(e){this.valid=!1,this.prefSizeCached={},this.layout&&this.layout.invalidate(e)}validateLayout(){if(!this.layout)throw new Error("Called layout() but component has no layout");return this.valid?!0:this.suppressValidate||this.layouting||!this._checkValidationPossible()?!1:(this.layouting=!0,this.layout.layout(this.$comp),this.layouting=!1,this.layouted=!0,this.sizeCached=this.size({exact:!0}),this.valid=!0,!0)}_checkValidationPossible(){if(!this.isAttachedAndVisible())return!1;if(this.$comp.hasAnimationClass())return this._validateLayoutAfterAnimation(this.$comp),!1;let e=this.getParent();if(!e||!e.layouting){let t=!0,s=null;if(this.$comp.parents().each(function(){let r=a()(this);if(!r.isVisible())return t=!1,!1;if(r.hasAnimationClass())return s=r,!1}),!t)return!1;if(s)return this._validateLayoutAfterAnimation(s),!1}return!0}_validateLayoutAfterAnimation(e){e.oneAnimationEnd(this.validateLayout.bind(this))}revalidateLayout(){this.invalidateLayout(),this.validateLayout()}invalidateLayoutTree(e){this.suppressInvalidate||(u.nvl(e,!0)?this.session.layoutValidator.invalidateTree(this):(this.invalidateLayout(),this.session.layoutValidator.invalidate(this)))}validateLayoutTree(){this.suppressValidate||this.session.layoutValidator.validate()}revalidateLayoutTree(e){this.suppressInvalidate||(this.invalidateLayoutTree(e),this.validateLayoutTree())}isValidateRoot(){return this.validateRoot?!0:!this.layoutData||!this.layoutData.isValidateRoot?!1:this.layoutData.isValidateRoot()}setLayout(e){this.layout=e,e.cssClass&&this.$comp.addClass(e.cssClass)}prefSize(e){if(!this.isVisible())return new F(0,0);typeof e=="boolean"?e={includeMargin:e}:e=a().extend({},e);let t=u.nvl(e.includeMargin,!1);if(e.includeMargin=null,!this.layout)throw new Error("Called prefSize() but component has no layout");let s=this.computePrefSizeKey(e),r=this.prefSizeCached[s];if(!a().isEmptyObject(r))return a().log.isTraceEnabled()&&a().log.trace("(HtmlComponent#prefSize) "+this.debug()+" widthHint="+e.widthHint+" heightHint="+e.heightHint+" prefSizeCached="+r),t&&(r=r.add(this.margins())),r.clone();let n=this.cssMinSize(),o=this.cssMaxSize();(e.widthHint||e.heightHint)&&this._adjustSizeHintsForPrefSize(e,n,o);let l=this.layout.preferredLayoutSize(this.$comp,e);return this._adjustPrefSizeWithMinMaxSize(l,n,o),this.prefSizeCached[s]=l,a().log.isTraceEnabled()&&a().log.trace("(HtmlComponent#prefSize) "+this.debug()+" widthHint="+e.widthHint+" heightHint="+e.heightHint+" prefSize="+l),t&&(l=l.add(this.margins())),l.clone()}computePrefSizeKey(e){return"wHint"+u.nvl(e.widthHint,"-1")+"hHint"+u.nvl(e.heightHint,"-1")+"wOnly"+u.nvl(e.widthOnly,"-1")}_adjustSizeHintsForPrefSize(e,t,s){let r=u.nvl(e.removeMarginFromHints,!0),n=u.nvl(e.removeInsetsFromHints,!0);if(e.removeMarginFromHints=null,e.removeInsetsFromHints=null,!e.widthHint&&!e.heightHint)return;let o=r?this.margins():new Ge,l=n?this.insets():new Ge;e.widthHint&&(e.widthHint-=o.horizontal(),e.widthHint=Math.max(e.widthHint,t.width),e.widthHint=Math.min(e.widthHint,s.width),e.widthHint-=l.horizontal()),e.heightHint&&(e.heightHint-=o.vertical(),e.heightHint=Math.max(e.heightHint,t.height),e.heightHint=Math.min(e.heightHint,s.height),e.heightHint-=l.vertical())}_adjustPrefSizeWithMinMaxSize(e,t,s){t=t||this.cssMinSize(),s=s||this.cssMaxSize(),e.height=Math.max(e.height,t.height),e.height=Math.min(e.height,s.height),e.width=Math.max(e.width,t.width),e.width=Math.min(e.width,s.width)}insets(e){return v.insets(this.$comp,e)}margins(){return v.margins(this.$comp)}borders(){return v.borders(this.$comp)}cssMinSize(){return v.cssMinSize(this.$comp)}cssMaxSize(){return v.cssMaxSize(this.$comp)}size(e){return v.size(this.$comp,e)}setSize(e){if(!this.isAttachedAndVisible())return;let t=this.sizeCached;e.equals(t)||this.invalidateLayout(),this.pixelBasedSizing&&v.setSize(this.$comp,e),this.validateLayout()}bounds(e){return v.bounds(this.$comp,e)}position(){return v.position(this.$comp)}offsetBounds(e){return v.offsetBounds(this.$comp,e)}offset(){return v.offset(this.$comp)}setLocation(e){v.setLocation(this.$comp,e)}location(){return v.location(this.$comp)}setBounds(e){if(!this.isAttachedAndVisible())return;let t=this.sizeCached;e.dimension().equals(t)||this.invalidateLayout(),this.pixelBasedSizing&&v.setBounds(this.$comp,e),this.validateLayout()}pack(){let e=this.prefSize();this.setSize(e)}isAttached(){return this.$comp.isAttached()&&!!this.$comp.window(!0)}isVisible(){return this.$comp.isVisible()}isAttachedAndVisible(){return this.isAttached()&&this.isVisible()}debug(){return v.debugOutput(this.$comp)}static install(e,t){if(!e)throw new Error('Missing argument "$comp"');if(!t)throw new Error('Missing argument "session"');let s=new T(e,t);return e.data("htmlComponent",s),s}static get(e){let t=this.optGet(e);if(!t){let s="";throw e&&(s=`
Class: `+e.attr("class"),s+=`
Id: `+e.attr("id"),s+=`
Attached: `+e.isAttached()),new Error('data "htmlComponent" is undefined.'+s)}return t}static optGet(e){return e&&e.data("htmlComponent")}}const Ui={MIN:0,PREF:1,MAX:2,EPS:1e-6};function Jl(i,e,t){return e=hw(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function hw(i){var e=dw(i,"string");return typeof e=="symbol"?e:String(e)}function dw(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class nd{constructor(){Jl(this,"_invalidComponents",void 0),Jl(this,"_validateTimeoutId",void 0),Jl(this,"_postValidateFunctions",void 0),Jl(this,"_suppressValidate",void 0),this._invalidComponents=[],this._validateTimeoutId=null,this._postValidateFunctions=[],this._suppressValidate=!1}invalidateTree(e){let t,s=e,r=e;for(;s;){if(e=s,e.invalidateLayout(r),e.isValidateRoot()){t=e;break}s=e.getParent()}s||(t=e),this.invalidate(t)}invalidate(e){let t=0;if(this._invalidComponents.indexOf(e)>=0){this._scheduleValidation();return}this._invalidComponents.forEach((s,r)=>{s.isDescendantOf(e)||t++},this),p.insert(this._invalidComponents,e,t),this._scheduleValidation()}_scheduleValidation(){this._validateTimeoutId===null&&(x.get().supportsMicrotask()?(this._validateTimeoutId=!0,queueMicrotask(()=>{if(this._validateTimeoutId)try{this.validate()}catch(e){te.get().errorHandler.handle(e)}})):this._validateTimeoutId=setTimeout(()=>this.validate()))}validate(){x.get().supportsMicrotask()||clearTimeout(this._validateTimeoutId),this._validateTimeoutId=null,!this._suppressValidate&&(this._invalidComponents.slice().forEach(e=>{e.validateLayout()&&p.remove(this._invalidComponents,e)}),this._postValidateFunctions.slice().forEach(e=>{e(),p.remove(this._postValidateFunctions,e)}))}suppressValidate(){this._suppressValidate=!0}unsuppressValidate(){this._suppressValidate=!1,this._scheduleValidation()}cleanupInvalidComponents(e){this._invalidComponents.slice().forEach(t=>{t.$comp.closest(e).length>0&&p.remove(this._invalidComponents,t)})}schedulePostValidateFunction(e){e&&this._postValidateFunctions.push(e)}}function od(i,e,t){return e=uw(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function uw(i){var e=cw(i,"string");return typeof e=="symbol"?e:String(e)}function cw(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ql{constructor(e){od(this,"dirty",void 0),od(this,"gridConfig",void 0),od(this,"objectType",void 0),e=u.nvl(e,{}),this.dirty=!0,this._setGridConfig(e.gridConfig||null)}setDirty(e){this.dirty=e}setGridConfig(e){this._setGridConfig(e)}_setGridConfig(e){e&&!(e instanceof gr)&&(e=u.create(gr,e)),this.gridConfig=e}validate(e){!this.dirty||(this._validate(e),this.setDirty(!1))}}function pw(i,e,t){return e=fw(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function fw(i){var e=mw(i,"string");return typeof e=="symbol"?e:String(e)}function mw(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class gr{constructor(){pw(this,"widget",void 0),this.widget=null}setWidget(e){this.widget=e}getGridColumnCount(){return this.widget.gridColumnCount}getGridWidgets(){return this.widget.widgets}}function Yt(i,e,t){return e=gw(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function gw(i){var e=_w(i,"string");return typeof e=="symbol"?e:String(e)}function _w(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function yw(i){return i instanceof I}class xs{constructor(e){Yt(this,"fillHorizontal",void 0),Yt(this,"fillVertical",void 0),Yt(this,"gridh",void 0),Yt(this,"gridw",void 0),Yt(this,"gridx",void 0),Yt(this,"gridy",void 0),Yt(this,"heightHint",void 0),Yt(this,"horizontalAlignment",void 0),Yt(this,"logicalRowHeightAddition",void 0),Yt(this,"useUiHeight",void 0),Yt(this,"useUiWidth",void 0),Yt(this,"verticalAlignment",void 0),Yt(this,"weightx",void 0),Yt(this,"weighty",void 0),Yt(this,"widget",void 0),Yt(this,"widthHint",void 0),this.gridx=0,this.gridy=0,this.gridw=1,this.gridh=1,this.weightx=0,this.weighty=0,this.useUiWidth=!1,this.useUiHeight=!1,this.widthHint=0,this.heightHint=0,this.horizontalAlignment=-1,this.verticalAlignment=-1,this.fillHorizontal=!0,this.fillVertical=!0,e instanceof xs?b.copyProperties(e,this):yw(e)&&(this.widget=e)}validate(){if(!this.widget)return;let e=this.widget.gridData;this.gridx=e.x,this.gridy=e.y,this.gridw=e.w,this.gridh=e.h,this.weightx=e.weightX,this.weighty=e.weightY,this.weightx<0&&(this.weightx=Math.max(1,this.gridw)),this.weighty<0&&(this.weighty=this._inheritWeightY()),this.useUiWidth=e.useUiWidth,this.useUiHeight=e.useUiHeight,this.horizontalAlignment=e.horizontalAlignment,this.verticalAlignment=e.verticalAlignment,this.fillHorizontal=e.fillHorizontal,this.fillVertical=e.fillVertical,this.widthHint=e.widthInPixel,this.heightHint=e.heightInPixel,this.widget.labelVisible&&this.widget.$label&&this.widget.labelPosition===A.LabelPosition.TOP?this.logicalRowHeightAddition=v.prefSize(this.widget.$label,!0).height:this.logicalRowHeightAddition=0}_inheritWeightY(){let e=this._inheritWeightYRec(this.widget);if(e===null){let t=this.widget.gridData;t.weightY>=0?e=t.weightY:e=t.h>=2?t.h:0}return e}_inheritWeightYRec(e){let t=!1,s=0;if(e.validateLogicalGrid(),e instanceof Fr){let r,n,o,l=e.getFields();for(r=0;r<l.length;r++)if(o=l[r],o.isVisible()){let h=o.gridData;h.weightY<0?(n=this._inheritWeightYRec(o),n!==null&&(t=!0,s+=n)):(t=!0,s+=h.weightY)}}else s=e.gridData.h>=2?e.gridData.h:0,t=!0;return t?s:null}isValidateRoot(){return!this.useUiHeight&&!this.useUiWidth&&this.fillVertical&&this.fillHorizontal}}function os(i,e,t){return e=bw(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function bw(i){var e=vw(i,"string");return typeof e=="symbol"?e:String(e)}function vw(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Gn extends ee{constructor(e,t){super(),os(this,"validityBasedOnContainerSize",void 0),os(this,"valid",void 0),os(this,"widget",void 0),os(this,"info",void 0),os(this,"layoutConfig",void 0),os(this,"htmlPropertyChangeHandler",void 0),os(this,"hgap",void 0),os(this,"vgap",void 0),os(this,"columnWidth",void 0),os(this,"rowHeight",void 0),os(this,"minWidth",void 0),this.cssClass="logical-grid-layout",this.validityBasedOnContainerSize=new F,this.valid=!1,this.widget=e,this.info=null,this._initDefaults(),this.layoutConfig=si.ensure(t||{}),this.layoutConfig.applyToLayout(this),this.htmlPropertyChangeHandler=this._onHtmlEnvironmentPropertyChange.bind(this),de.get().on("propertyChange",this.htmlPropertyChangeHandler),this.widget.one("remove",()=>{de.get().off("propertyChange",this.htmlPropertyChangeHandler)})}_initDefaults(){let e=de.get();this.hgap=e.formColumnGap,this.vgap=e.formRowGap,this.columnWidth=e.formColumnWidth,this.rowHeight=e.formRowHeight,this.minWidth=0}_onHtmlEnvironmentPropertyChange(){this._initDefaults(),this.layoutConfig.applyToLayout(this),this.widget.invalidateLayoutTree(),this.widget.invalidateLogicalGrid()}validateLayout(e,t){let s=[],r=[];this.widget.logicalGrid?(this.widget.validateLogicalGrid(),this.widget.logicalGrid.gridConfig.getGridWidgets().forEach(function(o){if(!!o.rendered){if(!o.htmlComp){a().log.isWarnEnabled()&&a().log.warn("(LogicalGridLayout#validateLayout) no htmlComp found, widget cannot be layouted. Widget: "+o);return}n.call(this,o.htmlComp)}},this)):e.children().each((o,l)=>{let h=a()(l),d=T.optGet(h);!d||n.call(this,d)});function n(o){this._validateGridData(o)&&(s.push(o.$comp),r.push(o.layoutData))}this.info=new ld({$components:s,cons:r,hgap:this.hgap,vgap:this.vgap,rowHeight:this.rowHeight,columnWidth:this.columnWidth,widthHint:t.widthHint,widthOnly:t.widthOnly}),a().log.isTraceEnabled()&&a().log.trace("(LogicalGridLayout#validateLayout) $container="+T.get(e).debug())}_validateGridData(e){let t=e.$comp,s=t.data("widget");if(s?s.isVisible():t.isVisible())return e.layoutData.validate(),!0}layout(e){this._layout(e)}_layout(e){let t=T.get(e),s=t.availableSize(),r=t.insets();this.validateLayout(e,{widthHint:s.width-r.horizontal(),heightHint:s.height-r.vertical()}),this.minWidth>0&&s.width<this.minWidth&&(s.width=this.minWidth),a().log.isTraceEnabled()&&a().log.trace("(LogicalGridLayout#layout) container "+t.debug()+" size="+s+" insets="+r);let n=this._layoutCellBounds(s,r),o,l,h,d,c,f,m,_,C,S;for(f=0;f<this.info.$components.length;f++)c=this.info.$components[f],m=T.get(c),_=this.info.gridDatas[f],o=n[_.gridy][_.gridx],l=n[_.gridy+_.gridh-1][_.gridx+_.gridw-1],h=o.union(l),S=m.margins(),h.width-=S.horizontal(),h.height-=S.vertical(),_.fillHorizontal&&_.fillVertical||(d=this.info.compSize[f],!_.fillHorizontal&&d.width<h.width&&(C=h.width-d.width,h.width=d.width,_.horizontalAlignment===0?h.x+=Math.ceil(C/2):_.horizontalAlignment>0&&(h.x+=C)),!_.fillVertical&&d.height<h.height&&(C=h.height-d.height,_.heightHint===0?h.height=d.height:h.height=_.heightHint,_.verticalAlignment===0?h.y+=Math.ceil(C/2):_.verticalAlignment>0&&(h.y+=C))),a().log.isTraceEnabled()&&a().log.trace("(LogicalGridLayout#layout) comp="+m.debug()+" bounds="+h),m.setBounds(h)}_layoutCellBounds(e,t){return this.info.layoutCellBounds(e,t)}preferredLayoutSize(e,t){this.validateLayout(e,t);let s=Ui.PREF,r=new F,n,o,l,h=0;for(n=0;n<this.info.cols;n++)o=this.info.width[n][s],h>0&&(r.width+=this.hgap),r.width+=o,h++;for(h=0,n=0;n<this.info.rows;n++)l=this.info.height[n][s],h>0&&(r.height+=this.vgap),r.height+=l,h++;let d=T.get(e).insets();return r.width+=d.horizontal(),r.height+=d.vertical(),r}}function Ko(i,e,t){return e=ww(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ww(i){var e=Tw(i,"string");return typeof e=="symbol"?e:String(e)}function Tw(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class si{constructor(e){Ko(this,"hgap",void 0),Ko(this,"vgap",void 0),Ko(this,"columnWidth",void 0),Ko(this,"rowHeight",void 0),Ko(this,"minWidth",void 0),e=e||{},e.hgap>-1&&(this.hgap=e.hgap),e.vgap>-1&&(this.vgap=e.vgap),e.columnWidth>-1&&(this.columnWidth=e.columnWidth),e.rowHeight>-1&&(this.rowHeight=e.rowHeight),e.minWidth>-1&&(this.minWidth=e.minWidth)}clone(){return new si(this)}applyToLayout(e){e.layoutConfig=this,this.hgap!==null&&this.hgap!==void 0&&(e.hgap=this.hgap),this.vgap!==null&&this.vgap!==void 0&&(e.vgap=this.vgap),this.columnWidth!==null&&this.columnWidth!==void 0&&(e.columnWidth=this.columnWidth),this.rowHeight!==null&&this.rowHeight!==void 0&&(e.rowHeight=this.rowHeight),this.minWidth!==null&&this.minWidth!==void 0&&(e.minWidth=this.minWidth)}static ensure(e){return e?e instanceof si?e:new si(e):null}}function Ct(i,e,t){return e=Cw(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Cw(i){var e=Sw(i,"string");return typeof e=="symbol"?e:String(e)}function Sw(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ld{constructor(e){Ct(this,"gridDatas",void 0),Ct(this,"cons",void 0),Ct(this,"cols",void 0),Ct(this,"compSize",void 0),Ct(this,"rows",void 0),Ct(this,"width",void 0),Ct(this,"widthHints",void 0),Ct(this,"height",void 0),Ct(this,"weightX",void 0),Ct(this,"weightY",void 0),Ct(this,"hgap",void 0),Ct(this,"vgap",void 0),Ct(this,"rowHeight",void 0),Ct(this,"columnWidth",void 0),Ct(this,"cellBounds",void 0),Ct(this,"widthHint",void 0),Ct(this,"widthOnly",void 0),Ct(this,"$components",void 0),this.gridDatas=[],this.$components=null,this.cols=0,this.compSize=[],this.rows=0,this.width=[],this.widthHints=[],this.height=[],this.weightX=[],this.weightY=[],this.hgap=0,this.vgap=0,this.rowHeight=0,this.columnWidth=0,this.cellBounds=[],this.widthHint=null,this.widthOnly=!1,a().extend(this,e);let t,s,r,n;for(t=0;t<this.cons.length;t++)this.gridDatas[t]=new xs(this.cons[t]);if(this.$components.length===0)return;let o=new Vl,l=new Vl;for(t=0;t<this.gridDatas.length;t++){for(s=this.gridDatas[t],s.gridx<0&&(s.gridx=0),s.gridy<0&&(s.gridy=0),s.gridw<1&&(s.gridw=1),s.gridh<1&&(s.gridh=1),r=s.gridx;r<s.gridx+s.gridw;r++)o.add(r);for(n=s.gridy;n<s.gridy+s.gridh;n++)l.add(n)}let h=o.last();for(r=h;r>=0;r--)if(!o.contains(r))for(t=0;t<this.gridDatas.length;t++)s=this.gridDatas[t],s.gridx>r&&s.gridx--;let d=l.last();for(n=d;n>=0;n--)if(!l.contains(n))for(t=0;t<this.gridDatas.length;t++)s=this.gridDatas[t],s.gridy>n&&s.gridy--;this.cols=o.size(),this.rows=l.size(),a().log.isTraceEnabled()&&a().log.trace("(LogicalGridLayoutInfo#CTOR) $components.length="+this.$components.length+" usedCols="+this.cols+" usedRows="+this.rows),this._initializeInfo()}_initializeInfo(){let e=this.$components.length,t=[];for(let s=0;s<e;s++){let r=this.$components[s],n=this.gridDatas[s];n.gridx<0&&(n.gridx=0),n.gridy<0&&(n.gridy=0),n.gridw<1&&(n.gridw=1),n.gridh<1&&(n.gridh=1),n.gridx>=this.cols&&(n.gridx=this.cols-1),n.gridy>=this.rows&&(n.gridy=this.rows-1),n.gridx+n.gridw-1>=this.cols&&(n.gridw=this.cols-n.gridx),n.gridy+n.gridh>=this.rows&&(n.gridh=this.rows-n.gridy);let o=new F(0,0);n.widthHint>0?o.width=n.widthHint:(n.useUiWidth||!n.fillHorizontal)&&(o=this.uiSizeInPixel(r)),n.heightHint>0?o.height=n.heightHint:(n.useUiHeight||!n.fillVertical)&&t.push({cons:n,$comp:r,index:s}),this.compSize[s]=o}if(this._initializeColumns(),this.widthOnly){this.height=p.init(this.rows,[0,0,0]);return}if(this.widthHint&&t.length>0){let s=Math.max(0,(this.cols-1)*this.hgap);this.widthHints=this.layoutSizes(this.widthHint-s,this.width,this.weightX)}t.forEach(function(s){let r=s.$comp,n=s.cons,o=this.widthHintForGridData(n);n.fillHorizontal||(o=Math.min(o,this.compSize[s.index].width)),this.compSize[s.index]=this.uiSizeInPixel(r,{widthHint:o})},this),this._initializeRows()}_initializeColumns(){let e=this.compSize,t=e.length,s=p.init(this.cols,0),r=p.init(this.cols,!1),n,o,l,h,d;for(n=0;n<t;n++)if(d=this.gridDatas[n],d.gridw===1)for(d.widthHint>0?h=d.widthHint:d.useUiWidth?h=e[n].width:h=this.logicalWidthInPixel(d),h=Math.floor(h),o=d.gridx;o<d.gridx+d.gridw&&o<this.cols;o++)s[o]=Math.max(s[o],h),d.weightx===0&&(r[o]=!0);for(n=0;n<t;n++)if(d=this.gridDatas[n],d.gridw>1){let m=d.gridw,_=0,C;for(o=d.gridx;o<d.gridx+d.gridw&&o<this.cols;o++)r[o]||(_+=s[o]);if(d.widthHint>0?C=d.widthHint-_-(m-1)*this.hgap:d.useUiWidth?C=e[n].width-_-(m-1)*this.hgap:C=this.logicalWidthInPixel(d)-_-(m-1)*this.hgap,C>0){let S=Math.floor((C+_)/m),R=(C+_)%m,L=-1;for(o=d.gridx;o<d.gridx+d.gridw&&o<this.cols;o++)L=o,r[o]||(s[o]=Math.max(S,s[o])),d.weightx===0&&(r[o]=!0);L>-1&&(s[L]+=R)}}let c=Ui;for(n=0;n<this.cols;n++)this.width[n]=[],r[n]?(this.width[n][c.MIN]=s[n],this.width[n][c.PREF]=s[n],this.width[n][c.MAX]=s[n]):(this.width[n][c.MIN]=0,this.width[n][c.PREF]=s[n],this.width[n][c.MAX]=10240);for(n=0;n<this.cols;n++)if(r[n])this.weightX[n]=0;else{let m=0,_=0;for(l=0;l<t;l++)d=this.gridDatas[l],d.weightx>0&&d.gridx<=n&&n<=d.gridx+d.gridw-1&&(m+=d.weightx/d.gridw,_++);this.weightX[n]=_>0?m/_:0}let f=0;for(n=0;n<this.cols;n++)f+=this.weightX[n];if(f>=1e-6){let m=1/f;for(n=0;n<this.cols;n++)this.weightX[n]=this.weightX[n]*m}}_initializeRows(){let e=this.compSize,t=e.length,s=p.init(this.rows,0),r=p.init(this.rows,!1),n,o,l,h,d;for(n=0;n<t;n++)if(d=this.gridDatas[n],d.gridh===1)for(d.heightHint>0?h=d.heightHint:d.useUiHeight?h=e[n].height:h=this.logicalHeightInPixel(d),h=Math.floor(h),o=d.gridy;o<d.gridy+d.gridh&&o<this.rows;o++)s[o]=Math.max(s[o],h),d.weighty===0&&(r[o]=!0);for(n=0;n<t;n++)if(d=this.gridDatas[n],d.gridh>1){let m=d.gridh,_=0,C;for(o=d.gridy;o<d.gridy+d.gridh&&o<this.rows;o++)r[o]||(_+=s[o]);if(d.heightHint>0?C=d.heightHint-_-(m-1)*this.vgap:d.useUiHeight?C=e[n].height-_-(m-1)*this.vgap:C=this.logicalHeightInPixel(d)-_-(m-1)*this.vgap,C>0){let S=Math.floor((C+_)/m),R=(C+_)%m,L=-1;for(o=d.gridy;o<d.gridy+d.gridh&&o<this.rows;o++)L=o,r[o]||(s[o]=Math.max(S,s[o])),d.weighty===0&&(r[o]=!0);L>-1&&(s[L]+=R)}}let c=Ui;for(n=0;n<this.rows;n++)this.height[n]=[],r[n]?(this.height[n][c.MIN]=s[n],this.height[n][c.PREF]=s[n],this.height[n][c.MAX]=s[n]):(this.height[n][c.MIN]=0,this.height[n][c.PREF]=s[n],this.height[n][c.MAX]=10240);for(n=0;n<this.rows;n++)if(r[n])this.weightY[n]=0;else{let m=0,_=0;for(l=0;l<t;l++)d=this.gridDatas[l],d.weighty>0&&d.gridy<=n&&n<=d.gridy+d.gridh-1&&(m+=d.weighty/d.gridh,_++);this.weightY[n]=_>0?m/_:0}let f=0;for(n=0;n<this.rows;n++)f+=this.weightY[n];if(f>=1e-6){let m=1/f;for(n=0;n<this.rows;n++)this.weightY[n]=this.weightY[n]*m}}layoutCellBounds(e,t){let s=this.layoutSizes(e.width-t.horizontal()-Math.max(0,(this.cols-1)*this.hgap),this.width,this.weightX),r=this.layoutSizes(e.height-t.vertical()-Math.max(0,(this.rows-1)*this.vgap),this.height,this.weightY);this.cellBounds=p.init(this.rows,null);let n=t.top,o,l,h;for(o=0;o<this.rows;o++){for(l=t.left,this.cellBounds[o]=p.init(this.cols,null),h=0;h<this.cols;h++)this.cellBounds[o][h]=new ie(l,n,s[h],r[o]),l+=s[h],l+=this.hgap;n+=r[o],n+=this.vgap}return this.cellBounds}layoutSizes(e,t,s){let r=p.init(t.length,0);if(e<=0){for(let d=0;d<t.length;d++)r[d]=t[d][Ui.MIN];return r}let n=0,o=p.init(s.length,0),l=0;for(let d=0;d<t.length;d++)r[d]=t[d][Ui.PREF],n+=r[d],o[d]=s[d],o[d]<Ui.EPS&&(t[d][Ui.MAX]>t[d][Ui.MIN]?o[d]=1:o[d]=0),l+=o[d];if(l>0)for(let d=0;d<o.length;d++)o[d]=o[d]/l;let h=e-n;if(Math.abs(h)>0){let d=p.init(o.length,0),c;if(h>0)for(c=!0;h>0&&c;){c=!1;for(let f=0;f<r.length&&h>0;f++)o[f]>0&&r[f]<t[f][Ui.MAX]&&(c=!0,d[f]+=o[f],d[f]>0&&(d[f]-=1,r[f]+=1,h-=1))}else for(c=!0;h<0&&c;){c=!1;for(let f=0;f<r.length&&h<0;f++)o[f]>0&&r[f]>t[f][Ui.MIN]&&(c=!0,d[f]+=o[f],d[f]>0&&(d[f]-=1,r[f]-=1,h+=1))}}return r}logicalWidthInPixel(e){let t=e.gridw;return this.columnWidth*t+this.hgap*Math.max(0,t-1)}logicalHeightInPixel(e){let t=e.gridh,s=e.logicalRowHeightAddition||0;return this.rowHeight*t+this.vgap*Math.max(0,t-1)+s}uiSizeInPixel(e,t){let s=T.get(e);return s.prefSize(t).add(s.margins())}widthHintForGridData(e){if(this.widthHints.length===0)return null;let t=(e.gridw-1)*this.hgap;for(let s=e.gridx;s<e.gridx+e.gridw;s++)t+=this.widthHints[s];return t}}function bm(i,e,t){return e=Pw(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Pw(i){var e=xw(i,"string");return typeof e=="symbol"?e:String(e)}function xw(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Un extends Ql{constructor(e){super(e),bm(this,"gridRows",void 0),bm(this,"gridColumns",void 0),this.gridRows=0,this.gridColumns=0}_validate(e){this.gridRows=0,this.gridConfig.setWidget(e),this.gridColumns=this.gridConfig.getGridColumnCount();let t=0,s=0,r=[];this.gridConfig.getGridWidgets().forEach(n=>{if(n.isVisible()){r.push(n);let o=n.gridDataHints;o&&o.x>=0&&o.y>=0?t++:s++}else n.gridData=ze.createFromHints(n,1)}),t>0&&s===0?this.layoutAllStatic(r):this.layoutAllDynamic(r)}layoutAllStatic(e){let t=[];e.forEach(n=>{t.push(ze.createFromHints(n,1))});let s=t.reduce((n,o)=>{let l=o.x+o.w;return l>n?l:n},1),r=t.reduce((n,o)=>{let l=o.y+o.h;return l>n?l:n},0);e.forEach(n=>{n.gridData=ze.createFromHints(n,s)}),this.gridRows=r,this.gridColumns=s}layoutAllDynamic(e){}getGridColumnCount(){return this.gridColumns}getGridRowCount(){return this.gridRows}static getGridDataFromHints(e,t){let s=ze.createFromHints(e,t);return s.w=Math.min(t,s.w),s}}class Gr extends Un{layoutAllDynamic(e){let t=new hd(this.getGridColumnCount());t.computeGridData(e),this.gridRows=t.getRowCount()}}class ad extends Un{layoutAllDynamic(e){let t=0;e.forEach(n=>{let o=Un.getGridDataFromHints(n,this.getGridColumnCount());t+=o.w*o.h});let s=Math.floor((t+this.getGridColumnCount()-1)/this.getGridColumnCount()),r=new Go(this.getGridColumnCount(),s);for(;!r.computeGridData(e);)r.resetAll(this.getGridColumnCount(),++s);e.forEach(n=>{n.gridData=r.getGridData(n)}),this.gridRows=r.getRowCount()}}function vm(i,e,t){return e=Ew(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Ew(i){var e=Fw(i,"string");return typeof e=="symbol"?e:String(e)}function Fw(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Zl{constructor(e){vm(this,"_cursor",void 0),vm(this,"_assignedCells",void 0),this._cursor=e,this._assignedCells=[]}getColumnCount(){return this._cursor.columnCount}getRowCount(){return this._cursor.rowCount}_setAssignedCell(e,t){this._assignedCells[e.x]||(this._assignedCells[e.x]=[]),this._assignedCells[e.x][e.y]=t}_getAssignedCell(e){return this._assignedCells[e.x]?this._assignedCells[e.x][e.y]:null}_nextFree(e,t){if(!this._cursor.increment())return!1;let s=this._cursor.currentIndex();return this._isAllCellFree(s.x,s.y,e,t)?!0:(this._getAssignedCell(s)||this._setAssignedCell(s,new qn),this._nextFree(e,t))}_isAllCellFree(e,t,s,r){return e+s>this._cursor.startX+this._cursor.columnCount||t+r>this._cursor.startY+this._cursor.rowCount?!1:this._assignedCells.slice(e,e+s).every(n=>(n||[]).slice(t,t+r).every(o=>!o))}toString(){let e="----Group Box Grid Matrix [orientation="+this._cursor.orientation+", columnCount="+this.getColumnCount()+", rowCount="+this.getRowCount()+`]--------------
`,t=new $i(0,0,this.getColumnCount(),this.getRowCount(),this._cursor.orientation);for(;t.increment();){let s=this._getAssignedCell(t.currentIndex());e+="cell["+t.currentIndex().x+", "+t.currentIndex().y+"] ",s?s.widget?e+=s.widget+(s.widget?", ["+s.widget.label+"]":""):e+="Placeholder":e+="NULL",e+=`
`}return e}}function wm(i,e,t){return e=Dw(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Dw(i){var e=Aw(i,"string");return typeof e=="symbol"?e:String(e)}function Aw(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class qn{constructor(e,t){wm(this,"widget",void 0),wm(this,"data",void 0),this.widget=e,this.data=t}isEmpty(){return!this.widget}}function Ur(i,e,t){return e=$w(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function $w(i){var e=Rw(i,"string");return typeof e=="symbol"?e:String(e)}function Rw(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class $i{constructor(e,t,s,r,n){Ur(this,"startX",void 0),Ur(this,"startY",void 0),Ur(this,"columnCount",void 0),Ur(this,"rowCount",void 0),Ur(this,"orientation",void 0),Ur(this,"_currentIndex",void 0),this.startX=e,this.startY=t,this.columnCount=s,this.rowCount=r,this.orientation=n,this.reset()}reset(){this._currentIndex=new X(-1,-1)}currentIndex(){return new X(this._currentIndex.x,this._currentIndex.y)}increment(){return this._currentIndex.x<0||this._currentIndex.y<0?(this._currentIndex.x=this.startX,this._currentIndex.y=this.startY):this.orientation===$i.Orientation.HORIZONTAL?(this._currentIndex.x++,this._currentIndex.x>=this.startX+this.columnCount&&(this._currentIndex.x=this.startX,this._currentIndex.y++)):(this._currentIndex.y++,this._currentIndex.y>=this.startY+this.rowCount&&(this._currentIndex.y=this.startY,this._currentIndex.x++)),!(this._currentIndex.x>=this.startX+this.columnCount||this._currentIndex.y>=this.startY+this.rowCount)}decrement(){return!(this._currentIndex.x<0||this._currentIndex.y<0||(this._currentIndex.x>=this.startX+this.columnCount||this._currentIndex.y>=this.startY+this.rowCount?(this._currentIndex.x=this.startX+this.columnCount-1,this._currentIndex.y=this.startY+this.rowCount-1):this.orientation===$i.Orientation.HORIZONTAL?(this._currentIndex.x--,this._currentIndex.x<this.startX&&(this._currentIndex.x=this.startX+this.columnCount-1,this._currentIndex.y--)):(this._currentIndex.y--,this._currentIndex.y<this.startY&&(this._currentIndex.y=this.startY+this.rowCount-1,this._currentIndex.x--)),this._currentIndex.x<this.startX||this._currentIndex.y<this.startY))}toString(){let e=[];return e.push("MatrixCursor ["),e.push("orientation="+this.orientation),e.push(", startX="+this.startX),e.push(", startY="+this.startY),e.push(", columnCount="+this.columnCount),e.push(", currentIndex="+this._currentIndex.x+", "+this._currentIndex.y),e.push("]"),e.join("")}}Ur($i,"Orientation",{HORIZONTAL:0,VERTICAL:1});function Mw(i,e,t){return e=Iw(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Iw(i){var e=Lw(i,"string");return typeof e=="symbol"?e:String(e)}function Lw(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class hd extends Zl{constructor(e){super(new $i(0,0,e,Number.MAX_SAFE_INTEGER,$i.Orientation.HORIZONTAL)),Mw(this,"rowCount",void 0),this.rowCount=0}computeGridData(e){return e.forEach(t=>{let s=ze.createFromHints(t,this.getColumnCount()),r=new ze(s);r.w=Math.min(s.w,this.getColumnCount()),this._add(t,s,r),t.gridData=r}),this._cursor.rowCount=this.rowCount,!0}_add(e,t,s){this._nextFree(s.w,s.h);let r=this._cursor.currentIndex();if(s.w<=this.getColumnCount()-r.x){s.x=r.x,s.y=r.y;for(let n=r.x;n<r.x+s.w;n++)for(let o=r.y;o<r.y+s.h;o++)this._setAssignedCell(new X(n,o),new qn(e,s));this.rowCount=r.y+s.h}else this._setAssignedCell(this._cursor.currentIndex(),new qn),this._add(e,t,s)}}function dd(i,e,t){return e=Ow(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Ow(i){var e=Bw(i,"string");return typeof e=="symbol"?e:String(e)}function Bw(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Go extends Zl{constructor(e,t,s,r){super(new $i(s||0,r||0,e,t,$i.Orientation.VERTICAL)),dd(this,"_widgets",void 0),dd(this,"_widgetGridDatas",void 0),dd(this,"_widgetIndexes",void 0),this._widgets=[],this._widgetGridDatas=[],this._widgetIndexes=[]}resetAll(e,t){this._widgetGridDatas=[],this._assignedCells=[],this._widgetIndexes=[],this._cursor=new $i(this._cursor.startX,this._cursor.startY,e,t,$i.Orientation.VERTICAL)}computeGridData(e){return this._widgets=e,e.every((t,s)=>(this._widgetGridDatas[s]=Un.getGridDataFromHints(t,this._cursor.columnCount),this._add(t,this._widgetGridDatas[s])))}getGridData(e){return this._widgetGridDatas[this._widgets.indexOf(e)]}_addAssignedCells(e){e.forEach((t,s)=>{t&&t.forEach((r,n)=>{r&&this._setAssignedCell(new X(s,n),r)})})}_getAssignedCells(){return this._assignedCells}_add(e,t){let s=this._cursor.currentIndex();if(t.w>1){let r=s.x,n=s.y;for(;r+t.w>this._cursor.startX+this._cursor.columnCount;)r--,n=this._cursor.rowCount-1;this._reorganizeGridAbove(r,n,t.w)}if(!this._nextFree(t.w,t.h))return!1;s=this._cursor.currentIndex(),t.x=s.x,t.y=s.y;for(let r=s.x;r<s.x+t.w;r++)for(let n=s.y;n<s.y+t.h;n++)this._setAssignedCell(new X(r,n),new qn(e,t));return!0}_reorganizeGridAbove(e,t,s){let r=[],n=_=>{r.indexOf(_)===-1&&r.push(_)},o=[],l=(_,C,S)=>{o[_]||(o[_]=[]),o[_][C]=S},h={x:e,y:0,w:s,h:t+1},d=t,c=0,f=!0;for(let _=t;_>=0&&f;_--)for(let C=e;C<e+s&&f;C++){let S=new X(C,_),R=this._getAssignedCell(S);if(R&&!R.isEmpty()){let L=R.data;this._horizontalMatchesOrOverlaps(h,L)?f=!1:this._horizontalOverlapsOnSide(h,L)?(l(S.x,S.y,R),c++,d=Math.min(S.y,d)):(this._setAssignedCell(S,null),n(R.widget),c++,d=Math.min(S.y,d))}}if(r.length===0)return;r.sort((_,C)=>this._widgets.indexOf(_)<this._widgets.indexOf(C)?-1:1),h.y=d;let m=new Go(h.w,Math.floor((c+h.w-1)/h.w),h.x,h.y);for(m._addAssignedCells(o);!m.computeGridData(r);)m.resetAll(m.getColumnCount(),m.getRowCount()+1);this._cursor.reset(),this._addAssignedCells(m._getAssignedCells()),m._widgetGridDatas.forEach((_,C)=>{this._widgetGridDatas[this._widgets.indexOf(m._widgets[C])]=_})}_horizontalMatchesOrOverlaps(e,t){return e.x>=t.x&&e.x+e.w<=t.x+t.w}_horizontalOverlapsOnSide(e,t){return e.x>t.x||e.x+e.w<t.x+t.w}}function Tm(i,e,t){return e=kw(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function kw(i){var e=Hw(i,"string");return typeof e=="symbol"?e:String(e)}function Hw(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ud extends ee{constructor(e){super(),Tm(this,"stretch",void 0),Tm(this,"useCssWidth",void 0),e=e||{},this.stretch=u.nvl(e.stretch,!0),this.useCssWidth=u.nvl(e.useCssWidth,!1)}_getChildren(e){return e.children()}layout(e){let t=T.get(e),s=t.availableSize().subtract(t.insets());this._getChildren(e).each((r,n)=>{let o=a()(n),l=T.optGet(o);if(!l||!o.isVisible())return;let h=l.prefSize({useCssSize:!0});this.stretch&&(h.height=s.height-l.margins().vertical()),l.layoutData&&l.layoutData.widthHint&&(h.width=l.layoutData.widthHint),this.useCssWidth?(l.$comp.cssHeight(h.height),l.revalidateLayout()):l.setSize(h)})}preferredLayoutSize(e,t){let s=new F,r=T.get(e),n={useCssSize:!0};return this._getChildren(e).each((o,l)=>{let h=a()(l),d=T.optGet(h);if(!d||!h.isVisible())return;let c=d.prefSize(n);d.layoutData&&d.layoutData.widthHint&&(c.width=d.layoutData.widthHint),c=c.add(d.margins()),s.width=s.width+c.width,s.height=Math.max(s.height,c.height)}),s=s.add(r.insets()),s}}class Yn extends ee{layout(e){e.children().each(function(){let t=T.optGet(a()(this));t&&t.revalidateLayout()})}}function Cm(i,e,t){return e=Nw(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Nw(i){var e=Vw(i,"string");return typeof e=="symbol"?e:String(e)}function Vw(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ri extends ee{constructor(e){super(),Cm(this,"stretch",void 0),Cm(this,"pixelBasedSizing",void 0),e=e||{},this.pixelBasedSizing=u.nvl(e.pixelBasedSizing,!0),this.stretch=u.nvl(e.stretch,!0)}_getChildren(e){return e.children()}layout(e){let t=T.get(e),s=t.availableSize().subtract(t.insets());this._getChildren(e).each((r,n)=>{let o=a()(n),l=T.optGet(o);if(!l||!o.isVisible())return;if(!this.pixelBasedSizing){l.validateLayout();return}let h=l.prefSize({widthHint:s.width});this.stretch&&(h.width=s.width-l.margins().horizontal()),l.setSize(h)})}preferredLayoutSize(e,t){let s=new F,r=T.get(e),n=0;return this._getChildren(e).each((o,l)=>{let h=a()(l),d=T.optGet(h);if(!d||!h.isVisible())return;let c=d.prefSize(t).add(d.margins());n=Math.max(c.width,n),s.height+=c.height,s.width=n}),s=s.add(r.insets()),s}}function Sm(i,e,t){return e=Ww(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Ww(i){var e=zw(i,"string");return typeof e=="symbol"?e:String(e)}function zw(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Es extends ee{constructor(e,t){super(),Sm(this,"exact",void 0),Sm(this,"_htmlChild",void 0),this._htmlChild=e,t=t||{},this.exact=u.nvl(t.exact,!1)}layout(e){let t=T.get(e),s=t.availableSize({exact:this.exact}).subtract(t.insets()),r=this._htmlChild;r||(r=this._getHtmlSingleChild(e)),r&&r.setSize(s)}preferredLayoutSize(e,t){let s=this._htmlChild;return s||(s=this._getHtmlSingleChild(e)),s?s.prefSize(t).add(v.insets(e)):new F(1,1)}_getHtmlSingleChild(e){let t=null;return e.children().each((s,r)=>{let n=T.optGet(a()(r));if(n)return t=n,!1}),t}}function Uo(i,e,t){return e=Kw(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Kw(i){var e=Gw(i,"string");return typeof e=="symbol"?e:String(e)}function Gw(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Xs extends ee{constructor(e,t){super(),Uo(this,"childrenLayoutDatas",void 0),Uo(this,"cacheKey",void 0),Uo(this,"_getDimensionValue",void 0),Uo(this,"_layoutFromLayoutData",void 0),this.childrenLayoutDatas=[],this.cacheKey=null,this.setCacheKey(t),e===Xs.Direction.ROW?(this.preferredLayoutSize=this.preferredLayoutSizeRow,this._getDimensionValue=this._getWidth,this._layoutFromLayoutData=this._layoutFromLayoutDataRow):(this.preferredLayoutSize=this.preferredLayoutSizeColumn,this._getDimensionValue=this._getHeight,this._layoutFromLayoutData=this._layoutFromLayoutDataColumn)}setCacheKey(e){this.cacheKey=e,this.cacheKey&&this.cacheKey.length>0&&this.cacheKey.unshift("scout.flexboxLayout")}_readCache(e){if(!this.cacheKey||this.cacheKey.length===0||e<2)return;let t=this.cacheKey.slice(),s=Se.getItemFromLocalStorage(t[0]),r=1,n;for(t.push(""+e),s&&(n=JSON.parse(s));n&&r<t.length;)n=n[t[r]],r++;return n}_writeCache(e,t){if(!this.cacheKey||this.cacheKey.length===0||e<2)return;let s=this.cacheKey.slice(),r=Se.getItemFromLocalStorage(s[0]),n=1,o,l;for(s.push(""+e),r?o=JSON.parse(r):o={},l=o;n<s.length-1;)l[s[n]]||(l[s[n]]={}),l=l[s[n]],n++;l[s[n]]=t,Se.setItemToLocalStorage(s[0],JSON.stringify(o))}_computeCacheKey(e){if(!(!this.cacheKey||e<2))return this.cacheKey+"-"+e}layout(e){let t=this._getChildren(e),s=T.get(e),r=s.availableSize({exact:!0}),n;r=r.subtract(s.insets()),n=t.filter(o=>o.layoutData.diff)[0],n?this._layoutDelta(t,n,r):this._layoutComponents(t,r)}_getChildren(e){let t=[];return e.children().each(function(){let s=T.optGet(a()(this));s&&t.push(s)}),t=t.sort((s,r)=>(s.layoutData.order||0)-(r.layoutData.order||0)),t}reset(){this.childrenLayoutDatas.forEach(e=>{e.sizePx=0,e.initialPx=0,e.diff=null}),this.childrenLayoutDatas=[]}_layoutDelta(e,t,s){this.ensureInitialValues(e,s);let r=t.layoutData.diff,n=e.slice(0,e.indexOf(t)).reverse(),o=e.slice(e.indexOf(t)+1),l,h;l=d(n,r,!1),h=-d(o,-r,!1),r=Math.sign(r)*Math.min(Math.abs(r-l),Math.abs(r-h)),r!==0&&(d(n,r,!0),d(o,-r,!0)),this._layoutFromLayoutDataWithCache(e,s);function d(c,f,m){return c.reduce((_,C)=>(_!==0&&(_=C.layoutData.acceptDelta(_,m)),_),f)}}_layoutComponents(e,t){let s=this.ensureInitialValues(e,t);s<0?this._adjust(e,s,r=>r.shrink):s>0&&this._adjust(e,s,r=>r.grow),this._layoutFromLayoutDataWithCache(e,t)}_adjust(e,t,s){let r,n,o=e.map(l=>l.layoutData).filter(l=>l.acceptDelta(Math.sign(t))===0);o.length<1||(r=o.reduce((l,h)=>l+s(h),0),n=t/r,t=o.reduce((l,h)=>h.acceptDelta(n*s(h),!0),t),Math.abs(t)>.2&&this._adjust(e,t,s))}_getPreferredSize(e){return e.prefSize({useCssSize:!0}).add(e.margins())}ensureInitialValues(e,t){let s=this._getDimensionValue(t),r=0,n=0,o=e.map(d=>d.layoutData),l=this._readCache(e.length)||[];e.forEach((d,c)=>{let f=d.layoutData;f.sizePx?r+=f.sizePx:f.initial<0?(f.initialPx=this._getDimensionValue(this._getPreferredSize(d)),r+=f.initialPx):f.relative?n+=f.initial:(f.initialPx=f.initial,r+=f.initialPx)});let h=(s-r)/n;return o.filter(d=>d.relative&&d.initial>-1&&!d.sizePx).reduce((d,c)=>(c.initialPx=Math.max(30,h*c.initial),d-c.initialPx),s-r),o.reduce((d,c,f)=>(c.sizePx||(l[f]?c.sizePx=c.validate(Math.round(s*l[f])):c.sizePx=c.initialPx),this.childrenLayoutDatas.push(c),d-c.sizePx),s)}_layoutFromLayoutDataWithCache(e,t){this._cacheSizes(e,t),this._layoutFromLayoutData(e,t)}_cacheSizes(e,t){let s=this._getDimensionValue(t),r=e.map(n=>n.layoutData.sizePx/s);this._writeCache(e.length,r)}preferredLayoutSizeColumn(e,t){return this._getChildren(e).reduce((s,r)=>{let n=this._getPreferredSize(r);return s.width=Math.max(n.width,s.width),s.height+=n.height,s},new F(0,0))}preferredLayoutSizeRow(e,t){return this._getChildren(e).reduce((s,r)=>{let n=this._getPreferredSize(r);return s.height=Math.max(n.height,s.height),s.width+=n.width,s},new F(0,0))}_getWidth(e){return e.width}_getHeight(e){return e.height}_layoutFromLayoutDataRow(e,t){e.reduce((s,r)=>{let n=r.margins(),o=r.insets(),l=r.layoutData.sizePx,h=new ie(s-o.left-n.left,0,l+o.left+o.right,t.height);return r.setBounds(h),s+l},0)}_layoutFromLayoutDataColumn(e,t){e.reduce((s,r)=>{let n=r.margins(),o=r.insets(),l=r.layoutData.sizePx,h=new ie(0,s-o.top-n.top,t.width,l+o.top+o.bottom);return r.setBounds(h),s+l},0)}}Uo(Xs,"Direction",{COLUMN:0,ROW:1});function _r(i,e,t){return e=Uw(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Uw(i){var e=qw(i,"string");return typeof e=="symbol"?e:String(e)}function qw(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class yr{constructor(e){_r(this,"grow",void 0),_r(this,"initial",void 0),_r(this,"order",void 0),_r(this,"relative",void 0),_r(this,"shrink",void 0),_r(this,"sizePx",void 0),_r(this,"initialPx",void 0),_r(this,"diff",void 0),this.relative=!0,this.grow=1,this.shrink=1,this.initial=1,this.order=0,a().extend(this,e),this.sizePx=null,this.initialPx=null,this.diff=null}withOrder(e){return this.order=e,this}acceptDelta(e,t){return e>0?this._grow(e,t):this._shrink(e,t)}validate(e){return this.grow===0&&(e=Math.min(this.initialPx,e)),this.shrink===0&&(e=Math.max(this.initialPx,e)),e}_grow(e,t){let s=0,r=0;return this.grow>0?s=e:this.initialPx>this.sizePx&&(s=this.initialPx-this.sizePx),r=Math.min(e,s),t&&(this.sizePx=this.sizePx+r),e-r}_shrink(e,t){let s=0,r=0;return this.shrink>0?s=-this.sizePx+20:this.initialPx<this.sizePx&&(s=this.initialPx-this.sizePx),r=Math.max(e,s),t&&(this.sizePx=this.sizePx+r),e-r}static fixed(e){let t=new yr;return t.relative=!1,t.initial=e||-1,t.grow=0,t.shrink=0,t}}function qr(i,e,t){return e=Yw(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Yw(i){var e=jw(i,"string");return typeof e=="symbol"?e:String(e)}function jw(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Yr{constructor(){qr(this,"tabBox",void 0),qr(this,"tabArea",void 0),qr(this,"_viewAddHandler",void 0),qr(this,"_viewRemoveHandler",void 0),qr(this,"_viewActivateHandler",void 0),qr(this,"_viewDeactivateHandler",void 0),qr(this,"_viewTabSelectHandler",void 0),this.tabBox=null,this._viewAddHandler=this._onViewAdd.bind(this),this._viewRemoveHandler=this._onViewRemove.bind(this),this._viewActivateHandler=this._onViewActivate.bind(this),this._viewDeactivateHandler=this._onViewDeactivate.bind(this),this.tabArea=null,this._viewTabSelectHandler=this._onViewTabSelect.bind(this)}init(e){a().extend(this,e)}install(e,t){this.uninstall(),this.tabBox=u.assertParameter("tabBox",e),this.tabArea=u.nvl(t,this.tabBox.tabArea),this.tabArea||(this.tabArea=this.createTabArea()),this._installListeners()}uninstall(){this._uninstallListeners()}_installListeners(){this.tabBox.on("viewAdd",this._viewAddHandler),this.tabBox.on("viewRemove",this._viewRemoveHandler),this.tabBox.on("viewActivate",this._viewActivateHandler),this.tabBox.on("viewDeactivate",this._viewDeactivateHandler),this.tabArea.on("tabSelect",this._viewTabSelectHandler)}_uninstallListeners(){this.tabBox&&(this.tabBox.off("viewAdd",this._viewAddHandler),this.tabBox.off("viewRemove",this._viewRemoveHandler),this.tabBox.off("viewActivate",this._viewActivateHandler),this.tabBox.off("viewDeactivate",this._viewDeactivateHandler)),this.tabArea&&this.tabArea.off("tabSelect",this._viewTabSelectHandler)}createTabArea(){return u.create(Ni,{parent:this.tabBox})}_onViewAdd(e){let t=e.view;if(!Yr.hasViewTab(t))return;let s=this.getTab(t);if(!s&&this._shouldCreateTabForView(t)){let r=e.siblingView,n=this.getTab(r);s=this._createTab(t),this.tabArea.addTab(s,n)}}_shouldCreateTabForView(e){return!0}_onViewRemove(e){let t=e.view;if(!t)return;let s=this.getTab(t);s&&this.tabArea.destroyTab(s)}_onViewActivate(e){let t=this.getTab(e.view);this.tabArea.selectTab(t)}_onViewDeactivate(e){let t=this.getTab(e.view);this.tabArea.deselectTab(t)}_onViewTabSelect(e){if(!e.viewTab)return;let t=e.viewTab.view;this.tabBox.activateView(t)}_createTab(e){return u.create(bh,{parent:this.tabArea,view:e})}getTab(e){if(!e)return;let t=null;return this.tabArea.getTabs().some(s=>s.view===e?(t=s,!0):!1),t}getTabs(){return this.tabArea.getTabs()}static hasViewTab(e){return e&&(!b.isNullOrUndefined(e.title)||!b.isNullOrUndefined(e.subTitle)||!b.isNullOrUndefined(e.iconId))}}function Fs(i,e,t){return e=Xw(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Xw(i){var e=Jw(i,"string");return typeof e=="symbol"?e:String(e)}function Jw(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ea extends I{constructor(){super(),Fs(this,"tabArea",void 0),Fs(this,"viewStack",void 0),Fs(this,"currentView",void 0),Fs(this,"controller",void 0),Fs(this,"layoutData",void 0),Fs(this,"viewContent",void 0),Fs(this,"$viewContent",void 0),Fs(this,"$tabArea",void 0),Fs(this,"_removeViewInProgress",void 0),Fs(this,"_viewDestroyedHandler",void 0),this._addWidgetProperties(["tabArea"]),this.tabArea=null,this.viewStack=[],this.currentView=null,this.controller=null,this._removeViewInProgress=0}_init(e){super._init(e),this.cssClass=e.cssClass,this.controller||(this.controller=u.create(Yr)),this.controller.install(this,this.tabArea),this.tabArea=this.controller.tabArea,this._viewDestroyedHandler=this._onViewDestroyed.bind(this)}_render(){this.$container=this.$parent.appendDiv("simple-tab-box"),this.cssClass&&this.$container.addClass(this.cssClass),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new cd(this)),this.htmlComp.layoutData=this.layoutData,this.$viewContent=this.$container.appendDiv("tab-content"),this.viewContent=T.install(this.$viewContent,this.session),this.viewContent.setLayout(new pd(this))}_renderProperties(){super._renderProperties(),this._renderTabArea(),this._renderView(this.currentView)}_renderTabArea(){this.tabArea.render(),this.$tabArea=this.tabArea.$container,this.$tabArea.insertBefore(this.$viewContent)}_renderView(e){!e||e.rendered||(e.render(this.$viewContent),e.$container.addClass("view"))}postRender(){this.viewStack.length>0&&!this.currentView&&this.activateView(this.viewStack[this.viewStack.length-1])}activateView(e){e!==this.currentView&&(this.currentView&&(this.currentView.detach(),this.trigger("viewDeactivate",{view:this.currentView}),this.currentView=null),this.rendered&&this._renderView(e),e&&!e.attached&&e.attach(),this.currentView=e,this.trigger("viewActivate",{view:e}),this.rendered&&this.viewContent.invalidateLayoutTree())}setLayoutData(e){super.setLayoutData(e),this.layoutData=e}getLayoutData(){return this.layoutData}addView(e,t){let s=u.nvl(t,!0),r=this._addToViewStack(e,s);e.setTrackFocus(!0),e.setParent(this),this.trigger("viewAdd",{view:e,siblingView:r}),s&&this.activateView(e)}_addToViewStack(e,t){let s,r=this.viewStack.indexOf(e);if(r>-1)return this.viewStack[r-1];if(!Yr.hasViewTab(e))return this.viewStack.unshift(e),this._addDestroyListener(e),s;if(!this.currentView||!t)return s=this.viewStack[this.viewStack.length-1],this.viewStack.push(e),this._addDestroyListener(e),s;let n=this.viewStack.indexOf(this.currentView);return s=this.viewStack[n],this.viewStack.splice(n+1,0,e),s}_addDestroyListener(e){e.one("destroy",this._viewDestroyedHandler)}_removeDestroyListener(e){e.off("destroy",this._viewDestroyedHandler)}_onViewDestroyed(e){let t=e.source;p.remove(this.viewStack,t),this.currentView===t&&(this.rendered&&t.remove(),this.currentView=null)}removeView(e,t){if(!e)return;e.setTrackFocus(!1),t=u.nvl(t,!0);let s=this.viewStack.indexOf(e),r;this.currentView===e?this.currentView=null:t=!1,s>-1&&(t&&(s-1>=0?r=this.viewStack[s-1]:s+1<this.viewStack.length&&(r=this.viewStack[s+1])),this.viewStack.splice(s,1),e.rendered&&(this._removeViewInProgress++,e.remove(),this._removeViewInProgress--),this.trigger("viewRemove",{view:e}),this._removeViewInProgress===0&&(r&&this.activateView(r),this.rendered&&this.viewContent.invalidateLayoutTree()))}getController(){return this.controller}viewCount(){return this.viewStack.length}hasViews(){return this.viewStack.length>0}hasView(e){return this.viewStack.filter(t=>t===e).length>0}getViews(e){return this.viewStack.filter(t=>e?e===t.displayViewId:!0)}}function Qw(i,e,t){return e=Zw(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Zw(i){var e=eT(i,"string");return typeof e=="symbol"?e:String(e)}function eT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class cd extends ee{constructor(e){super(),Qw(this,"tabBox",void 0),this.tabBox=e}layout(e){let t=T.get(e),s=T.get(this.tabBox.$viewContent),r=t.availableSize({exact:!0}).subtract(t.insets()),n=this._layoutTabArea(r),o=r.subtract(s.margins());o.height-=n.height,s.setSize(o)}_layoutTabArea(e){if(!this.tabBox.rendered)return new F(0,0);let t=T.get(this.tabBox.$tabArea),s=t.prefSize(),r=t.margins(),n=new F(e.width,s.height+r.top+r.bottom);return t.setSize(n),n}preferredLayoutSize(e,t){t=t||{};let s=T.get(e),r=T.get(this.tabBox.$viewContent),n=T.get(this.tabBox.$tabArea),o=new F,l=new F;return t.heightHint=null,n.isVisible()&&(o=n.prefSize().add(n.margins())),l=r.prefSize(t).add(s.insets()).add(r.margins()),new F(Math.max(o.width,l.width),l.height+o.height)}}function tT(i,e,t){return e=iT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function iT(i){var e=sT(i,"string");return typeof e=="symbol"?e:String(e)}function sT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class pd extends ee{constructor(e){super(),tT(this,"tabBox",void 0),this.tabBox=e}layout(e){let t=this.tabBox.currentView;if(!t||!t.rendered||!t.htmlComp)return;let s=T.get(e),r=s.availableSize({exact:!0}).subtract(s.insets()).subtract(t.htmlComp.margins());t.htmlComp.setSize(r)}preferredLayoutSize(e,t){let s=this.tabBox.currentView;if(!s||!s.rendered||!s.htmlComp)return new F;let r=T.get(e);return s.htmlComp.prefSize().add(r.insets()).add(s.htmlComp.margins())}}const g={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,ESCAPE:27,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,PRINT_SCREEN:44,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,WIN_LEFT:91,WIN_RIGHT:92,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,DASH:189,COMMA:188,POINT:190,FORWARD_SLASH:191,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222,ANGULAR_BRACKET:226,codesToKeys:{8:"Backspace",9:"Tab",13:"Enter",16:"SHIFT",17:"CTRL",18:"ALT",19:"PAUSE",20:"Caps lock",27:"Esc",33:"Page up",34:"Page down",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",32:"Space",44:"Print screen",45:"Insert",46:"Delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",91:"WIN_LEFT",92:"WIN_RIGHT",93:"SELECT",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",96:"NUMPAD_0",97:"NUMPAD_1",98:"NUMPAD_2",99:"NUMPAD_3",100:"NUMPAD_4",101:"NUMPAD_5",102:"NUMPAD_6",103:"NUMPAD_7",104:"NUMPAD_8",105:"NUMPAD_9",106:"MULTIPLY",107:"+",109:"SUBTRACT",110:"DECIMAL_POINT",111:"/",144:"Num lock",145:"Scroll lock",186:"",189:"-",188:",",190:".",191:"",219:"'",220:"",221:"^",222:"",226:"<"},browserMap:{[x.Browser.FIREFOX]:{226:60},[x.Browser.SAFARI]:{226:188,ctrl:{226:192}}},browserMapReverse:{},forBrowser:(i,e)=>g.mapKey(g.browserMap,i,e),fromBrowser:i=>g.mapKey(g.browserMapReverse,i),mapKey:(i,e,t)=>{let s=i[x.get().browser];return s&&t&&(s=s[t]),s&&s.hasOwnProperty(e)?s[e]:e}};for(let i in g.browserMap){let e={},t=g.browserMap[i];for(let s in t){let r=t[s];e[r]=parseInt(s,10)}g.browserMapReverse[i]=e}function jr(i,e,t){return e=rT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function rT(i){var e=nT(i,"string");return typeof e=="symbol"?e:String(e)}function nT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class qo{constructor(e,t){jr(this,"keyStroke",void 0),jr(this,"which",void 0),jr(this,"ctrl",void 0),jr(this,"alt",void 0),jr(this,"shift",void 0),jr(this,"keyStrokeMode",void 0),jr(this,"$drawingArea",void 0),this.keyStroke=e,this.which=t,this.ctrl=e.ctrl,this.alt=e.alt,this.shift=e.shift,this.keyStrokeMode=e.keyStrokeMode}render(e,t){return this.$drawingArea=this.keyStroke.renderKeyBox(e,t),!!this.$drawingArea}remove(){this.keyStroke.removeKeyBox(this.$drawingArea),this.$drawingArea=null}toKeyStrokeString(){let e="";this.ctrl&&(e+="Ctrl-"),this.alt&&(e+="Alt-"),this.shift&&(e+="Shift-");let t=g.codesToKeys[this.which];return t===void 0&&(t=this.which),e+=t,e}}const Te={NONE:0,CTRL:1<<0,CTRL_UNDEFINED:1<<1,SHIFT:1<<2,SHIFT_UNDEFINED:1<<3,ALT:1<<4,ALT_UNDEFINED:1<<5,isCtrl(i){return Te._eval(i,Te.CTRL,Te.CTRL_UNDEFINED)},isShift(i){return Te._eval(i,Te.SHIFT,Te.SHIFT_UNDEFINED)},isAlt(i){return Te._eval(i,Te.ALT,Te.ALT_UNDEFINED)},_eval(i,e,t){if(!((t&i)>0))return(e&i)>0},toModifierBitMask(i){let e=0;return e|=i.ctrlKey?Te.CTRL:0,e|=i.altKey?Te.ALT:0,e|=i.shiftKey?Te.SHIFT:0,e}};function Ds(i,e,t){return e=oT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function oT(i){var e=lT(i,"string");return typeof e=="symbol"?e:String(e)}function lT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ta{constructor(e,t,s,r,n,o){Ds(this,"which",void 0),Ds(this,"ctrlKey",void 0),Ds(this,"metaKey",void 0),Ds(this,"altKey",void 0),Ds(this,"shiftKey",void 0),Ds(this,"target",void 0),Ds(this,"type",void 0),Ds(this,"_propagationStopped",void 0),Ds(this,"_immediatePropagationStopped",void 0),Ds(this,"_defaultPrevented",void 0),this.which=e,this.ctrlKey=t,this.metaKey=!1,this.altKey=s,this.shiftKey=r,this.target=o,this.type=n,this._propagationStopped=!1,this._immediatePropagationStopped=!1,this._defaultPrevented=!1}stopPropagation(){this._propagationStopped=!0}stopImmediatePropagation(){this._immediatePropagationStopped=!0}preventDefault(){this._defaultPrevented=!0}isPropagationStopped(){return this._propagationStopped}isImmediatePropagationStopped(){return this._immediatePropagationStopped}isDefaultPrevented(){return this._defaultPrevented}isAnyPropagationStopped(){return this._propagationStopped||this._immediatePropagationStopped}}function jn(i,e,t){return e=aT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function aT(i){var e=hT(i,"string");return typeof e=="symbol"?e:String(e)}function hT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class fd extends ts{constructor(){super(),jn(this,"session",void 0),jn(this,"helpKeyStroke",void 0),jn(this,"swallowF1",void 0),jn(this,"filters",void 0),jn(this,"_helpRendered",void 0),jn(this,"_renderedKeys",void 0),this.session=null,this.helpKeyStroke=O.parseKeyStroke("F1"),this.swallowF1=!0,this._helpRendered=!1,this._renderedKeys=[],this.filters=[]}init(e){this.session=e.session,this.installTopLevelKeyStrokeHandlers(this.session.$entryPoint)}installTopLevelKeyStrokeHandlers(e){let t=e.window(!0),s=n=>n.which!==g.F1,r=n=>n.which!==g.BACKSPACE;this.swallowF1&&e.keydown(s).keyup(s),e.keydown(r).keyup(r),"onhelp"in t&&(t.onhelp=cr.returnFalse)}installKeyStrokeContext(e){if(!e)return;let t=e._handler;if(!t){if(!e.$getBindTarget())throw new Error("missing bind-target for KeyStrokeContext: "+e);t=this._onKeyEvent.bind(this,e),t.$target=e.$getBindTarget(),t.$target.on("keydown",t),t.$target.on("keyup",t),e._handler=t}}uninstallKeyStrokeContext(e){if(!e)return;let t=e._handler;!t||(t.$target.off("keydown",t),t.$target.off("keyup",t),t.$target=null,e._handler=null)}_renderKeys(e,t){let s=t.originalEvent.keyStrokeContexts||[],r=[];e.keyStrokes.filter(n=>{let o=n.renderingHints.render;return typeof o=="function"?o.call(n):o}).forEach(n=>{n.enabledByFilter=this._filter(n);let o=(n.field?n.field.$container:null)||e.$getScopeTarget();n.keys().forEach(h=>{let d=new ta(h.which,h.ctrl,h.alt,h.shift,h.keyStrokeMode,t.target);r.indexOf(h.toKeyStrokeString())<0&&e.accept(d)&&n.accept(d)&&!this._isPreventedByDescendantContext(h,t.target,s)&&(h.render(o,d)&&this._renderedKeys.push(h),d.isImmediatePropagationStopped()&&r.push(h.toKeyStrokeString()))})}),s.push(e),t.originalEvent.keyStrokeContexts=s}_isPreventedByDescendantContext(e,t,s){let r=new ta(e.which,e.ctrl,e.alt,e.shift,e.keyStrokeMode,t);return s.some(n=>(n.accept(r),r.isAnyPropagationStopped()?!0:n.keyStrokes.some(o=>(o.accept(r),r.isAnyPropagationStopped()))))}_handleKeyStrokeEvent(e,t){if(!e.accept(t)||e.keyStrokes.length<1)return;t.which>=96&&t.which<=105&&(t.which=t.which-48),e.keyStrokes.slice().some(r=>r.accept(t)?(this.invokeAcceptInputOnActiveValueField(r,e)&&me.invokeValueFieldAcceptInput(t.target),this._filter(r)?(this.trigger("keyStroke",{keyStroke:r,keyStrokeContext:e}),r.invokeHandle(t),t.isImmediatePropagationStopped()):!0):!1)}_filter(e){for(let t=0;t<this.filters.length;t++)if(!this.filters[t].filter(e))return!1;return!0}invokeAcceptInputOnActiveValueField(e,t){return!e.preventInvokeAcceptInputOnActiveValueField&&(e.invokeAcceptInputOnActiveValueField||t.invokeAcceptInputOnActiveValueField)}_isHelpKeyStroke(e){return O.acceptEvent(this.helpKeyStroke,e)}_installHelpDisposeListener(e){let t,s=a()(e.currentTarget),r=s.window(),n=s.entryPoint();return t=function(){n.off("keyup",t),r.off("blur",t),this._helpRendered=!1,this._renderedKeys.forEach(o=>o.remove()),this._renderedKeys=[]}.bind(this),n.on("keyup",t),r.on("blur",t),!1}_onKeyEvent(e,t){if(this.session.focusManager.isElementCovertByGlassPane(e.$getScopeTarget())){let s=a().grep(e.keyStrokes,r=>r.keyStrokeFirePolicy===re.KeyStrokeFirePolicy.ALWAYS);if(s.length===0)return;e=e.clone(),e.keyStrokes=s}this._isHelpKeyStroke(t)?(t.originalEvent.renderingHelp||!this._helpRendered)&&(t.originalEvent.renderingHelp=!0,this._helpRendered=!0,this._installHelpDisposeListener(t),this._renderKeys(e,t)):this._handleKeyStrokeEvent(e,t)}addFilter(e){p.pushSet(this.filters,e)}removeFilter(e){p.remove(this.filters,e)}}function Xr(i,e,t){return e=dT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function dT(i){var e=uT(i,"string");return typeof e=="symbol"?e:String(e)}function uT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Oe{constructor(e){Xr(this,"invokeAcceptInputOnActiveValueField",void 0),Xr(this,"keyStrokes",void 0),Xr(this,"stopPropagationInterceptors",void 0),Xr(this,"$bindTarget",void 0),Xr(this,"$scopeTarget",void 0),Xr(this,"_handler",void 0),Xr(this,"_stopPropagationKeys",void 0),this.$bindTarget=null,this.$scopeTarget=null,this.keyStrokes=[],this.stopPropagationInterceptors=[],this._stopPropagationKeys={},this.invokeAcceptInputOnActiveValueField=!1,e=e||{},a().extend(this,e)}registerStopPropagationKeys(e,t){this._stopPropagationKeys[e]=this._stopPropagationKeys[e]||[],p.pushAll(this._stopPropagationKeys[e],t)}unregisterStopPropagationKeys(e,t){!this._stopPropagationKeys[e]||p.removeAll(this._stopPropagationKeys[e],t)}registerStopPropagationInterceptor(e){this.stopPropagationInterceptors.push(e)}accept(e){return this._accept(e)?(this._applyPropagationFlags(e),!0):!1}_applyPropagationFlags(e){let t=Te.toModifierBitMask(e),s=this._stopPropagationKeys[t];s&&u.isOneOf(e.which,s)&&e.stopPropagation(),this.stopPropagationInterceptors.forEach(r=>r(e))}_accept(e){return!0}registerKeyStroke(e){this.registerKeyStrokes(e)}registerKeyStrokes(e){p.ensure(e).map(this._resolveKeyStroke,this).filter(t=>this.keyStrokes.indexOf(t)===-1).forEach(t=>{this.keyStrokes.push(t);let s;s=t,s.field&&!s.destroyListener&&(s.destroyListener=r=>{this.unregisterKeyStroke(s),s.destroyListener=null},s.field.one("destroy",s.destroyListener))})}unregisterKeyStroke(e){this.unregisterKeyStrokes(e)}unregisterKeyStrokes(e){p.ensure(e).map(this._resolveKeyStroke,this).forEach(t=>{let s;s=t,p.remove(this.keyStrokes,s)&&s.field&&s.destroyListener&&(s.field.off("destroy",s.destroyListener),s.destroyListener=null)})}_resolveKeyStroke(e){if(e instanceof O)return e;if(e instanceof re)return e.actionKeyStroke;throw new Error("unsupported keystroke: "+e)}$getBindTarget(){return typeof this.$bindTarget=="function"?this.$bindTarget():this.$bindTarget}$getScopeTarget(){return typeof this.$scopeTarget=="function"?this.$scopeTarget():this.$scopeTarget}clone(){return new Oe(a().extend({},this))}}class As extends Oe{constructor(e){super(),this.invokeAcceptInputOnActiveValueField=!0;let t=[g.RIGHT,g.LEFT,g.HOME,g.END];this.registerStopPropagationKeys(Te.CTRL,[g.A,g.C,g.Y,g.V,g.Z,g.BACKSPACE].concat(t)),this.registerStopPropagationKeys(Te.CTRL|Te.SHIFT,t),this.registerStopPropagationKeys(Te.SHIFT,t),this.registerStopPropagationKeys(Te.NONE,[g.SEMICOLON,g.DASH,g.COMMA,g.POINT,g.FORWARD_SLASH,g.OPEN_BRACKET,g.BACK_SLASH,g.CLOSE_BRACKET,g.SINGLE_QUOTE,g.MULTIPLY,g.ADD,g.SUBTRACT,g.DECIMAL_POINT,g.DIVIDE,g.NUMPAD_0,g.NUMPAD_1,g.NUMPAD_2,g.NUMPAD_3,g.NUMPAD_4,g.NUMPAD_5,g.NUMPAD_6,g.NUMPAD_7,g.NUMPAD_8,g.NUMPAD_9,g.MULTIPLY,g.BACKSPACE,g.DELETE,g.SPACE].concat(t)),this.setMultiline(e)}setMultiline(e){let t=[g.UP,g.DOWN];e?(this.registerStopPropagationKeys(Te.CTRL,t),this.registerStopPropagationKeys(Te.CTRL|Te.SHIFT,t),this.registerStopPropagationKeys(Te.SHIFT,t),this.registerStopPropagationKeys(Te.NONE,t)):(this.unregisterStopPropagationKeys(Te.CTRL,t),this.unregisterStopPropagationKeys(Te.CTRL|Te.SHIFT,t),this.unregisterStopPropagationKeys(Te.SHIFT,t),this.unregisterStopPropagationKeys(Te.NONE,t))}_applyPropagationFlags(e){super._applyPropagationFlags(e),!e.isPropagationStopped()&&this._isInputField(e.target)&&(this._isLetterKeyStroke(e)||this._isNumberKeyStroke(e))&&e.stopPropagation()}_isInputField(e){if(e&&e.isContentEditable)return!0;let t=a()(e);return t.is("input:text")||t.is("input:file")||t.is("textarea")}_isNumberKeyStroke(e){return!e.ctrlKey&&e.which>=g[0]&&e.which<=g[9]}_isLetterKeyStroke(e){return!e.ctrlKey&&e.which>=g.A&&e.which<=g.Z}}function cT(i,e,t){return e=pT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function pT(i){var e=fT(i,"string");return typeof e=="symbol"?e:String(e)}function fT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Yo extends O{constructor(){super(),cT(this,"ranges",void 0),this.ranges=[]}registerRange(e,t){this.ranges.push({from:e,to:t})}_accept(e){return(e.ctrlKey||e.metaKey)!==this.ctrl||e.altKey!==this.alt||e.shiftKey!==this.shift?!1:this.ranges.some(t=>e.which>=this._getRangeFrom(t)&&e.which<=this._getRangeTo(t))}keys(){let e=[];return this.ranges.forEach(t=>{let s=this._getRangeFrom(t),r=this._getRangeTo(t);for(let n=s;n<=r;n++)e.push(new qo(this,n))}),e}_getRangeFrom(e){return typeof e.from=="function"?e.from():e.from}_getRangeTo(e){return typeof e.to=="function"?e.to():e.to}}function Pm(i,e,t){return e=mT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function mT(i){var e=gT(i,"string");return typeof e=="symbol"?e:String(e)}function gT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ia extends O{constructor(e,t,s){super(),Pm(this,"_contextFunction",void 0),Pm(this,"_bindObject",void 0),this._contextFunction=t,this._bindObject=s||this,this.field=e,this.renderingHints.render=!1,this.which=[g.SELECT],this.ctrl=!1,this.shift=!1,this.stopPropagation=!0,this.inheritAccessibility=!1}handle(e){this._contextFunction.call(this._bindObject,e)}}class jo extends O{constructor(e,t){super(),this.field=e,this.which=t,this.stopPropagation=!0,this.renderingHints.render=!0,this.renderingHints.$drawingArea=(s,r)=>r._$activeElement}_accept(e){return super._accept(e)?(e._$activeElement=this.field.$container.activeElement(),!0):!1}handle(e){e._$activeElement.trigger($.Event("click",{which:1}))}}function _T(i,e,t){return e=yT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function yT(i){var e=bT(i,"string");return typeof e=="symbol"?e:String(e)}function bT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class sa extends O{constructor(e,t){super(),_T(this,"session",void 0),this.session=e,this.field=t,this.which=[g.LEFT,g.RIGHT],this.renderingHints.render=!1,this.stopPropagation=!0,this.keyStrokeMode=O.Mode.DOWN}handle(e){let t=this.field.$container.activeElement(!0),s=this.field.$container.find(":focusable");switch(e.which){case g.RIGHT:this._handleNext(t,s);break;case g.LEFT:this._handlePrevious(t,s);break}}_handleNext(e,t){let s;e===t.last()[0]?s=t.first():s=$(t[t.index(e)+1]),this.session.focusManager.requestFocus(s),s.addClass("keyboard-navigation")}_handlePrevious(e,t){let s;e===t.first()[0]?s=t.last():s=$(t[t.index(e)-1]),this.session.focusManager.requestFocus(s),s.addClass("keyboard-navigation")}}class Xn extends O{constructor(e,t){super(),this.field=e,this.which=[g.ESC],this.stopPropagation=!0,this.renderingHints={render:!!t,$drawingArea:t},this.inheritAccessibility=!1}handle(e){this.field.close()}}class ra extends Xn{constructor(e,t){super(e,t)}handle(e){this.field.abort()}}class md extends O{constructor(e,t){super(),this.field=t,this.parseAndSetKeyStroke(e),this.renderingHints.offset=16,this.renderingHints.hAlign=ht.RIGHT,this.renderingHints.render=()=>{let s=this.field.getTab();return s&&s.rendered},this.renderingHints.$drawingArea=(s,r)=>this.field.getTab().$container,this.inheritAccessibility=!1}handle(e){this.field.select()}}function Jn(i,e,t){return e=vT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function vT(i){var e=wT(i,"string");return typeof e=="symbol"?e:String(e)}function wT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class gd extends I{constructor(){super(),Jn(this,"comparator",void 0),Jn(this,"collapseStyle",void 0),Jn(this,"exclusiveExpand",void 0),Jn(this,"groups",void 0),Jn(this,"scrollable",void 0),Jn(this,"_groupPropertyChangeHandler",void 0),this.comparator=null,this.collapseStyle=null,this.exclusiveExpand=!0,this.groups=[],this.scrollable=!0,this.$container=null,this.htmlComp=null,this._addWidgetProperties(["groups"]),this._groupPropertyChangeHandler=this._onGroupPropertyChange.bind(this)}_init(e){super._init(e),this._initGroups(this.groups),this._setExclusiveExpand(this.exclusiveExpand)}_createLoadingSupport(){return new ss({widget:this})}_render(){this.$container=this.$parent.appendDiv("accordion"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(this._createLayout())}_createLayout(){return new na}_renderProperties(){super._renderProperties(),this._renderScrollable(),this._renderGroups()}insertGroup(e){this.insertGroups([e])}insertGroups(e){let t=p.ensure(e),s=this.groups;this.setGroups(s.concat(t))}deleteGroup(e){this.deleteGroups([e])}deleteGroups(e){e=p.ensure(e);let t=this.groups.slice();p.removeAll(t,e),this.setGroups(t)}deleteAllGroups(){this.setGroups([])}_initGroups(e){this.groups.forEach(t=>{this._initGroup(t)})}setGroups(e){let t=p.ensure(e);if(b.equals(this.groups,e))return;let s=this._createChildren(t),r=p.diff(this.groups,s),n=p.diff(s,this.groups);this._deleteGroups(r),this._insertGroups(n),this._sort(s),this._updateGroupOrder(s),this._setProperty("groups",s),n.length>0&&this._updateExclusiveExpand(),this.rendered&&(this._updateFirstLastMarker(),this.invalidateLayoutTree())}_insertGroups(e){e.forEach(t=>{this._insertGroup(t)})}_insertGroup(e){this._initGroup(e),this.rendered&&this._renderGroup(e)}_initGroup(e){e.setParent(this),e.on("propertyChange",this._groupPropertyChangeHandler),this.collapseStyle!==null&&e.setCollapseStyle(this.collapseStyle),this.setProperty("collapseStyle",e.collapseStyle)}_renderGroup(e){e.render()}_deleteGroups(e){e.forEach(t=>{this._deleteGroup(t)})}_deleteGroup(e){e.off("propertyChange",this._groupPropertyChangeHandler),e.owner===this?e.destroy():this.rendered&&e.remove()}_renderGroups(){this.groups.forEach(e=>{this._renderGroup(e)}),this._updateFirstLastMarker(),this.invalidateLayoutTree()}setComparator(e){this.comparator!==e&&(this.comparator=e)}sort(){let e=this.groups.slice();this._sort(e),this._updateGroupOrder(e),this._setProperty("groups",e)}_sort(e){this.comparator!==null&&e.sort(this.comparator)}_updateGroupOrder(e){if(!this.rendered)return;let t=!1;e.forEach((s,r)=>{(this.groups[r]!==s||t)&&(t=!0,s.$container.appendTo(this.$container))})}_updateFirstLastMarker(){Le.updateFirstLastMarker(this.groups)}setScrollable(e){this.setProperty("scrollable",e)}_renderScrollable(){this.scrollable?this._installScrollbars({axis:"y"}):this._uninstallScrollbars(),this.$container.toggleClass("scrollable",this.scrollable),this.invalidateLayoutTree()}getFocusableElement(){let e=Le.findFirstFocusableWidget(this.groups,this);return e?e.getFocusableElement():null}setExclusiveExpand(e){this.setProperty("exclusiveExpand",e)}_setExclusiveExpand(e){this._setProperty("exclusiveExpand",e),this._updateExclusiveExpand()}_updateExclusiveExpand(){if(!this.exclusiveExpand)return;let e=p.find(this.groups,t=>t.visible&&!t.collapsed);this._collapseOthers(e)}setCollapseStyle(e){this.groups.forEach(t=>{t.setCollapseStyle(e)}),this.setProperty("collapseStyle",e)}_collapseOthers(e){!e||!e.collapsible||this.groups.forEach(t=>{t!==e&&t.collapsible&&t.setCollapsed(!0)})}_onGroupPropertyChange(e){e.propertyName==="collapsed"?this._onGroupCollapsedChange(e):e.propertyName==="visible"&&this._updateFirstLastMarker()}_onGroupCollapsedChange(e){!e.newValue&&this.exclusiveExpand&&this._collapseOthers(e.source)}}class _d extends ke{}class na extends Ri{_getChildren(e){return e.children(".group")}layout(e){super.layout(e),P.update(e,!0)}}function xm(i,e,t){return e=TT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function TT(i){var e=CT(i,"string");return typeof e=="symbol"?e:String(e)}function CT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Xo extends I{constructor(){super(),xm(this,"buttons",void 0),xm(this,"defaultButtonIndex",void 0),this._addWidgetProperties(["buttons"]),this._addPreserveOnPropertyChangeProperties(["defaultButtonIndex"]),this.$container=null,this.buttons=[],this.defaultButtonIndex=0}_render(){this.$container=this.$parent.appendDiv("box-buttons")}_renderProperties(){super._renderProperties(),this._renderButtons(),this._renderDefaultButtonIndex()}_renderButtons(){this.buttons.filter(e=>!e.rendered).forEach(e=>{e.render(),e.$container.unfocusable().addClass("button box-button")})}_renderDefaultButtonIndex(){for(let e=0;e<this.buttons.length;e++){let t=this.buttons[e];t.$container.toggleClass("default",t.isVisible()&&t.enabledComputed&&this.isDefaultButtonIndex(e))}}isDefaultButtonIndex(e){return e===this.defaultButtonIndex}addButton(e,t){e=e||{},e.parent=this,e.tabbable=!0,e.actionStyle=re.ActionStyle.BUTTON,e.preventDoubleClick=!0;let s=u.create(re,e,t);return this.buttons.push(s),s}setDefaultButtonIndex(e){this.setProperty("defaultButtonIndex",e)}buttonCount(){return this.buttons.length}}function Mi(i,e,t){return e=ST(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ST(i){var e=PT(i,"string");return typeof e=="symbol"?e:String(e)}function PT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Em extends I{constructor(){super(),Mi(this,"statusEnabled",void 0),Mi(this,"statusItemHtml",void 0),Mi(this,"gridData",void 0),Mi(this,"moveThreshold",void 0),Mi(this,"widgets",void 0),Mi(this,"currentItem",void 0),Mi(this,"positionX",void 0),Mi(this,"$carouselItems",void 0),Mi(this,"$carouselStatusItems",void 0),Mi(this,"$carouselFilmstrip",void 0),Mi(this,"$carouselStatus",void 0),Mi(this,"htmlCompFilmstrip",void 0),Mi(this,"htmlCompStatus",void 0),this.statusEnabled=!0,this.statusItemHtml="&bull;",this.currentItem=0,this.moveThreshold=.25,this.widgets=[],this.$carouselItems=[],this.$carouselStatusItems=[],this.positionX=0,this._addWidgetProperties(["widgets"])}_init(e){super._init(e),this._setGridData(this.gridData),this.widgets=p.ensure(this.widgets)}_setGridData(e){this._setProperty("gridData",new ze(e))}_render(){this.$container=this.$parent.appendDiv("carousel"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new yd(this)),this.$carouselFilmstrip=this.$container.appendDiv("carousel-filmstrip"),this._registerCarouselFilmstripEventListeners(),this.htmlCompFilmstrip=T.install(this.$carouselFilmstrip,this.session)}_remove(){this._removeStatus(),super._remove()}_renderProperties(){super._renderProperties(),this._renderWidgets(),this._renderCurrentItem(),this._renderStatusEnabled()}setStatusEnabled(e){this.setProperty("statusEnabled",e)}_renderStatusEnabled(){this.statusEnabled?(this._renderStatus(),this._renderStatusItems(),this._renderCurrentStatusItem()):this._removeStatus(),this.invalidateLayoutTree()}_renderStatus(){this.$carouselStatus||(this.$carouselStatus=this.$container.appendDiv("carousel-status"),this.htmlCompStatus=T.install(this.$carouselStatus,this.session))}_removeStatus(){this.$carouselStatus&&(this.$carouselStatus.remove(),this.$carouselStatus=null)}_renderStatusItems(){!this.$carouselStatus||(this.$carouselStatusItems=[],this.$carouselStatus.empty(),this.$carouselItems.forEach(()=>{let e=this.$carouselStatus.appendDiv("status-item");e.html(this.statusItemHtml),this.$carouselStatusItems.push(e)}))}_renderCurrentStatusItem(){!this.$carouselStatus||this.$carouselStatusItems.forEach((e,t)=>{e.toggleClass("current-item",t===this.currentItem)})}recalcTransformation(){this.positionX=this.currentItem*this.$container.width()*-1,this.$carouselFilmstrip.css({transform:"translateX("+this.positionX+"px)"})}setCurrentItem(e){this.setProperty("currentItem",e)}_renderCurrentItem(){this._renderItemsInternal(void 0,!1),this._renderCurrentStatusItem(),this.invalidateLayoutTree()}_renderItemsInternal(e,t){e=e||this.currentItem,t||this.widgets.forEach((s,r)=>{s.rendered&&(r<e-1||r>e+1)&&s.remove()});for(let s=Math.max(e-1,0);s<Math.min(e+2,this.widgets.length);s++){let r=this.widgets[s];r.rendered||(r.render(this.$carouselItems[s]),r.htmlComp.revalidateLayout())}}setWidgets(e){this.setProperty("widgets",e)}_renderWidgets(){this.$carouselFilmstrip.empty(),this.$carouselItems=this.widgets.map(e=>{let t=this.$carouselFilmstrip.appendDiv("carousel-item");return T.install(t,this.session).setLayout(new Es),e.cssClassAsArray().forEach(n=>t.addClass(n+"-carousel-item")),t}),this._renderStatusItems(),this.setCurrentItem(0)}_registerCarouselFilmstripEventListeners(){let e=this.$carouselFilmstrip.window();this.$carouselFilmstrip.on("mousedown touchstart",t=>{let s=ot.pageX(t),r=this.positionX,n=this.$container.width()-this.$carouselFilmstrip.width(),o=this.$container.width();e.on("mousemove.carouselDrag touchmove.carouselDrag",l=>{let d=ot.pageX(l)-s,c=r+d;if(c!==this.positionX&&c<=0&&c>=n){this.$carouselFilmstrip.css({transform:"translateX("+c+"px)"}),this.positionX=c;let f=c/o*-1;this._renderItemsInternal(c<r?Math.floor(f):Math.ceil(f),!0)}}),e.on("mouseup.carouselDrag touchend.carouselDrag touchcancel.carouselDrag",l=>{e.off(".carouselDrag");let h=this.positionX%o,d=this.currentItem;this.positionX<r&&h/o<0-this.moveThreshold?d=Math.ceil(this.positionX/o*-1):this.positionX>r&&h/o>=this.moveThreshold-1&&(d=Math.floor(this.positionX/o*-1)),this.setCurrentItem(d),h!==0&&(this.positionX=d*o*-1,this.recalcTransformation())})})}}function xT(i,e,t){return e=ET(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ET(i){var e=FT(i,"string");return typeof e=="symbol"?e:String(e)}function FT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class yd extends ee{constructor(e){super(),xT(this,"carousel",void 0),this.carousel=e}layout(e){this.carousel.recalcTransformation();let t=this.carousel.htmlComp.availableSize().subtract(this.carousel.htmlComp.insets()).subtract(this.carousel.htmlCompFilmstrip.margins()),s=this.carousel.htmlComp.availableSize().subtract(this.carousel.htmlComp.insets()).subtract(this.carousel.htmlCompFilmstrip.margins());if(this.carousel.statusEnabled&&this.carousel.htmlCompStatus){let n=this.carousel.htmlCompStatus.size().add(this.carousel.htmlCompStatus.margins());t.height-=n.height,s.height-=n.height}let r=this.carousel.$carouselItems;t.width=r.length*t.width,this.carousel.htmlCompFilmstrip.setSize(t),r.forEach(n=>{T.get(n).setSize(s)})}preferredLayoutSize(e,t){let s=this.carousel.currentItem,r=new F(1,1);return s<this.carousel.$carouselItems.length&&s>=0&&(r=T.get(this.carousel.$carouselItems[s]).prefSize()),r.height+=this.carousel.htmlCompStatus.size().height,r}}function St(i,e,t){return e=DT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function DT(i){var e=AT(i,"string");return typeof e=="symbol"?e:String(e)}function AT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Pt{constructor(){St(this,"cssClass",void 0),St(this,"editable",void 0),St(this,"errorStatus",void 0),St(this,"horizontalAlignment",void 0),St(this,"htmlEnabled",void 0),St(this,"iconId",void 0),St(this,"mandatory",void 0),St(this,"text",void 0),St(this,"flowsLeft",void 0),St(this,"empty",void 0),St(this,"value",void 0),St(this,"tooltipText",void 0),St(this,"foregroundColor",void 0),St(this,"backgroundColor",void 0),St(this,"font",void 0),St(this,"sortCode",void 0),St(this,"field",void 0),St(this,"_cachedEncodedText",void 0),this.cssClass=null,this.editable=null,this.errorStatus=null,this.horizontalAlignment=null,this.htmlEnabled=null,this.iconId=null,this.mandatory=null,this._cachedEncodedText=null,this.text=null,this.value=null,this.tooltipText=null,this.sortCode=null}init(e){this._init(e)}_init(e){a().extend(this,e)}update(e){this.setText(e.text),a().extend(this,e)}setEditable(e){this.editable=e}setMandatory(e){this.mandatory=e}setHorizontalAlignment(e){this.horizontalAlignment=e}setValue(e){this.value=e}setErrorStatus(e){this.errorStatus=e}setText(e){let t=this.text;this.text=e,t!==this.text&&(this._cachedEncodedText=null)}setIconId(e){this.iconId=e}encodedText(){return this._cachedEncodedText||(this._cachedEncodedText=y.encode(this.text)),this._cachedEncodedText}setCssClass(e){this.cssClass=e}setSortCode(e){this.sortCode=e}}function Qn(i,e,t){return e=$T(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function $T(i){var e=RT(i,"string");return typeof e=="symbol"?e:String(e)}function RT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class qi extends I{constructor(){super(),Qn(this,"leftVisible",void 0),Qn(this,"rightVisible",void 0),Qn(this,"horizontalAlignment",void 0),Qn(this,"$left",void 0),Qn(this,"$right",void 0),this.leftVisible=!0,this.rightVisible=!0,this.horizontalAlignment=qi.HorizontalAlignment.LEFT,this.$left=null,this.$right=null}_render(){this.$container=this.$parent.appendDiv("collapse-handle"),this.$container.on("mousedown",this._onMouseDown.bind(this)),this.$left=this.$container.appendDiv("collapse-handle-body left"),this.$right=this.$container.appendDiv("collapse-handle-body right")}_renderProperties(){super._renderProperties(),this._renderLeftVisible(),this._renderRightVisible(),this._renderHorizontalAlignment()}setHorizontalAlignment(e){this.setProperty("horizontalAlignment",e)}_renderHorizontalAlignment(){this.$container.removeClass("left-aligned right-aligned"),this.horizontalAlignment===qi.HorizontalAlignment.LEFT?this.$container.addClass("left-aligned"):this.horizontalAlignment===qi.HorizontalAlignment.RIGHT&&this.$container.addClass("right-aligned")}setLeftVisible(e){this.setProperty("leftVisible",e)}_renderLeftVisible(){this.$left.setVisible(this.leftVisible),this._updateVisibilityClasses()}setRightVisible(e){this.setProperty("rightVisible",e)}_renderRightVisible(){this.$right.setVisible(this.rightVisible),this._updateVisibilityClasses()}_updateVisibilityClasses(){let e=this.leftVisible&&this.rightVisible;this.$container.toggleClass("both-visible",e),this.$left.toggleClass("both-visible",e),this.$right.toggleClass("both-visible",e),this.$container.toggleClass("one-visible",(this.leftVisible||this.rightVisible)&&!e)}_onMouseDown(e){let t=e.target;if(this.$left.isOrHas(t)){this.trigger("action",{left:!0});return}if(this.$right.isOrHas(t)){this.trigger("action",{right:!0});return}this.$container.hasClass("one-visible")&&this.trigger("action",{left:this.leftVisible,right:this.rightVisible})}}Qn(qi,"HorizontalAlignment",{LEFT:"left",RIGHT:"right"});function Jr(i,e,t){return e=MT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function MT(i){var e=IT(i,"string");return typeof e=="symbol"?e:String(e)}function IT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class bd{constructor(e){Jr(this,"session",void 0),Jr(this,"active",void 0),Jr(this,"restrictedFocusGain",void 0),Jr(this,"_glassPaneDisplayParents",void 0),Jr(this,"_glassPaneTargets",void 0),Jr(this,"_focusContexts",void 0),Jr(this,"_glassPaneRenderers",void 0);let t={active:!x.get().supportsOnlyTouch(),restrictedFocusGain:!x.get().supportsOnlyTouch(),session:null};if(a().extend(this,t,e),!this.session)throw new Error("Session expected");this._focusContexts=[],this._glassPaneTargets=[],this._glassPaneDisplayParents=[],this._glassPaneRenderers=[];let s=this.session.$entryPoint,r=s.data("partid")||"0";s.attr("tabindex",r),this.restrictedFocusGain&&this.installTopLevelMouseHandlers(s),this.installFocusContext(s,Mt.AUTO)}installTopLevelMouseHandlers(e){e.on("mousedown",t=>(this._acceptFocusChangeOnMouseDown(a()(t.target))||t.preventDefault(),!0))}activate(e){this.active!==e&&(this.active=e,a().log.isDebugEnabled()&&a().log.isDebugEnabled()&&a().log.debug("Focus manager active: "+this.active),this.active&&this.validateFocus())}installFocusContext(e,t){let s=this.evaluateFocusRule(e,t),r=new oa(e,this);return Mt.PREPARE!==t&&r.ready(),this._pushIfAbsentElseMoveTop(r),s&&r.validateAndSetFocus(s),r}evaluateFocusRule(e,t){let s;return!t||t===Mt.AUTO||t===Mt.PREPARE?s=this.findFirstFocusableElement(e):t===Mt.NONE?s=null:s=t,s}uninstallFocusContext(e,t){t=a().extend({},{preventScroll:!0},t);let s=this.getFocusContext(e);if(!s)return;let r=cr.outsideFilter(s.$container);p.remove(this._focusContexts,s),s.dispose();let n=this._findActiveContext();n&&n.validateAndSetFocus(n.lastValidFocusedElement,r,t)}isFocusContextInstalled(e){return!!this.getFocusContext(e)}activateFocusContext(e){let t;e instanceof oa?t=e:t=this.getFocusContext(e),!(!t||this.isElementCovertByGlassPane(t.$container))&&(this._pushIfAbsentElseMoveTop(t),this.validateFocus())}isElementCovertByGlassPane(e,t){let s=this._glassPaneTargets;return t&&(s=this._glassPaneTargets.filter(t)),s.length?this._glassPaneDisplayParents.indexOf(u.widget(e))>=0?!0:s.some(r=>a()(e).closest(r).length!==0):!1}registerGlassPaneTarget(e){this._glassPaneTargets.push(e),this.validateFocus()}registerGlassPaneDisplayParent(e){this._glassPaneDisplayParents.push(e)}registerGlassPaneRenderer(e){this._glassPaneRenderers.push(e)}unregisterGlassPaneTarget(e){p.$remove(this._glassPaneTargets,e),this.validateFocus()}unregisterGlassPaneDisplayParent(e){p.remove(this._glassPaneDisplayParents,e)}unregisterGlassPaneRenderer(e){p.remove(this._glassPaneRenderers,e)}rerenderGlassPanes(){this._glassPaneRenderers.slice().forEach(t=>{t.removeGlassPanes(),t.renderGlassPanes()})}validateFocus(e){let t=this._findActiveContext();t&&t.validateFocus(e)}requestFocusIfReady(e,t){return this.requestFocus(e,t,{onlyIfReady:!0})}requestFocus(e,t,s){typeof s=="boolean"?s={onlyIfReady:s}:s=s||{};let r=e instanceof a()?e[0]:e;if(!r)return!1;let n=this._findFocusContextFor(r);if(n){if(u.nvl(s.onlyIfReady,!1)&&!n.prepared)return!1;n.validateAndSetFocus(r,t,s)}return Yi.isActiveElement(r)}findFirstFocusableElement(e,t){let s,r,n,o,l,h,d,c,f,m=e.entryPoint(),_=e.find(":focusable").addBack(":focusable").not(m).filter(t||cr.returnTrue);for(o=0;o<_.length;o++)if(l=_[o],h=a()(l),!this.isElementCovertByGlassPane(l)&&!(h.is(".prevent-initial-focus")||h.closest(".prevent-initial-focus").length>0)){if(!s&&!(h.hasClass("button")||h.hasClass("menu-item"))&&(s=l),!r&&h.is(".default")&&(r=l),d=h.parents(".menubar"),c=h.parents(".tab-box-header"),f=h.parents(".box-buttons"),(d.length>0||c.length>0||f.length>0)&&!n&&(h.hasClass("button")||h.hasClass("menu-item")))n=l;else if(!d.length&&!c.length&&!f.length&&typeof l.focus=="function")return l}if(r)return r;if(n){if(n!==s&&s){let C=a()(n).parents(".tab-box-header"),S=a()(s);if(a()(s).parents(".tab-box-header").length>0&&C.length>0&&S.is(".tab-item"))return s}return n}return s}_findActiveContext(){return p.last(this._focusContexts)}getFocusContext(e){return p.find(this._focusContexts,t=>t.$container===e)}_findFocusContextFor(e){let t=a().ensure(e),s=null,r=Number.MAX_VALUE;return this._focusContexts.forEach(n=>{if(!n.$container.isOrHas(t))return;t.parentsUntil(n.$container).length<r&&(s=n)}),s}_acceptFocusChangeOnMouseDown(e){return e.hasClass("glasspane")||this.isElementCovertByGlassPane(e)||!Yi.isFocusableByMouse(e)?!1:!!(e.is(":focusable")||Yi.isSelectableText(e)||Yi.containsParentFocusableByMouse(e,e.entryPoint()))}_pushIfAbsentElseMoveTop(e){p.remove(this._focusContexts,e),this._focusContexts.push(e)}}function $s(i,e,t){return e=LT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function LT(i){var e=OT(i,"string");return typeof e=="symbol"?e:String(e)}function OT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class oa{constructor(e,t){$s(this,"focusManager",void 0),$s(this,"lastValidFocusedElement",void 0),$s(this,"focusedElement",void 0),$s(this,"prepared",void 0),$s(this,"$container",void 0),$s(this,"_keyDownListener",void 0),$s(this,"_focusInListener",void 0),$s(this,"_focusOutListener",void 0),$s(this,"_unfocusableListener",void 0),$s(this,"_removeListener",void 0),this.$container=e,this.focusManager=t,this.lastValidFocusedElement=null,this.focusedElement=null,this.prepared=!1,this._keyDownListener=this._onKeyDown.bind(this),this._focusInListener=this._onFocusIn.bind(this),this._focusOutListener=this._onFocusOut.bind(this),this._unfocusableListener=this._onUnfocusable.bind(this),this._removeListener=this._onRemove.bind(this)}ready(){this.prepared||(this.$container.on("keydown",this._keyDownListener).on("focusin",this._focusInListener).on("focusout",this._focusOutListener).on("hide disable",this._unfocusableListener),this.prepared=!0,this.lastValidFocusedElement&&this.restoreFocus())}dispose(){!this.prepared||(this.$container.off("keydown",this._keyDownListener).off("focusin",this._focusInListener).off("focusout",this._focusOutListener).off("hide disable",this._unfocusableListener),a()(this.focusedElement).off("remove",this._removeListener))}_onKeyDown(e){if(e.which===g.TAB){let t=this.$container.activeElement(!0),s=this.$container.find(":tabbable:visible"),r=s.first()[0],n=s.last()[0],o=s.index(t),l;if(e.shiftKey?n&&(t===r||t===this.$container[0])?(a().suppressEvent(e),this.validateAndSetFocus(n),l=n):o>0&&(l=s.get(o-1)):r&&(t===n||t===this.$container[0])?(a().suppressEvent(e),this.validateAndSetFocus(r),l=r):o<s.length-1&&(l=s.get(o+1)),!l)return;let h=a()(l);h.addClass("keyboard-navigation");let d=v.offsetBounds(h),c=h.scrollParent();P.isLocationInView(new X(d.x,d.y),c)||P.scrollTo(c,h)}}_onFocusIn(e){a()(e.target).on("remove",this._removeListener),this.focusedElement=e.target,e.target!==this.$container.entryPoint(!0)&&(this.focusManager._pushIfAbsentElseMoveTop(this),this.validateAndSetFocus(e.target),e.stopPropagation())}_onFocusOut(e){a()(e.target).off("remove",this._removeListener),a()(this.focusedElement).removeClass("keyboard-navigation"),this.focusedElement=null,e.stopPropagation()}_onRemove(e){this.validateAndSetFocus(null,cr.notSameFilter(e.target)),e.stopPropagation()}_onUnfocusable(e){a()(e.target).isOrHas(this.lastValidFocusedElement)&&(this.validateAndSetFocus(null,cr.notSameFilter(e.target)),e.stopPropagation())}validateAndSetFocus(e,t,s){e&&!a().contains(this.$container[0],e)&&(e=null);let r=null;e?!t||t.call(e)?r=e:r=this.focusManager.findFirstFocusableElement(this.$container,t):r=this.focusManager.findFirstFocusableElement(this.$container,t),this.lastValidFocusedElement=r,this._focus(r,s)}validateFocus(e){this.validateAndSetFocus(this.lastValidFocusedElement,e)}restoreFocus(){this.lastValidFocusedElement&&this._focus(this.lastValidFocusedElement)}_focus(e,t){if(t=t||{},!!this.focusManager.active&&!!this.prepared){if(this.focusManager.isElementCovertByGlassPane(e)){let s=this.$container.activeElement(!0);if(e&&(!s||!this.focusManager.isElementCovertByGlassPane(s)))return;e=null}e=e||this.$container.entryPoint(!0),e.focus||(e=this.$container.entryPoint(!0)),!Yi.isActiveElement(e)&&(e.focus({preventScroll:u.nvl(t.preventScroll,!1)}),a().log.isDebugEnabled()&&a().log.debug("Focus set to "+v.debugOutput(e)))}}}const Yi={isFocusableByMouse(i){let e=a()(i);return!e.hasClass("unfocusable")&&!e.closest(".unfocusable").length},containsParentFocusableByMouse(i,e){return a()(i).parentsUntil(".focus-boundary",":focusable").not(e).filter(()=>Yi.isFocusableByMouse(this)).length>0},isSelectableText(i){let e=a()(i),t=e;for(;t.css("user-select")==="auto";)if(t=t.parent(),t.is("body"))return!1;return t.css("user-select")==="none"?!1:e.is("input[disabled][type=text], textarea[disabled]")?!0:e.text().trim().length>0},isActiveElement(i){if(!i)return!1;let e;if(i instanceof a())e=i.activeElement(!0),i=i[0];else{let t=i;e=(t instanceof Document?t:t.ownerDocument).activeElement}return e===i}};var Mt;(function(i){i.AUTO="auto",i.NONE="none",i.PREPARE="prepare"})(Mt||(Mt={}));class Fm extends I{_render(){this.$container=this.$parent.appendDiv("glasspane").on("mousedown",this._onMouseDown.bind(this)),this.$parent.addClass("glasspane-parent"),this.$parent.css("position")==="static"&&this.$parent.css("position","relative"),this.session.focusManager.registerGlassPaneTarget(this.$parent)}_remove(){this.$parent.removeClass("glasspane-parent"),this.session.focusManager.unregisterGlassPaneTarget(this.$parent),super._remove()}_onMouseDown(e){a().suppressEvent(e)}}function Dm(i,e,t){return e=BT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function BT(i){var e=kT(i,"string");return typeof e=="symbol"?e:String(e)}function kT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Qr{constructor(){Dm(this,"glassPaneRenderer",void 0),Dm(this,"$glassPaneTargets",void 0),this.$glassPaneTargets=null,this.glassPaneRenderer=null}ready(e){this.$glassPaneTargets=e,this.renderWhenReady()}rendererReady(e){this.glassPaneRenderer=e,this.renderWhenReady()}removeGlassPaneRenderer(e){this.glassPaneRenderer===e&&(this.glassPaneRenderer=null)}renderWhenReady(){this.glassPaneRenderer&&this.$glassPaneTargets&&this.$glassPaneTargets.length>0&&this.$glassPaneTargets.forEach(e=>this.glassPaneRenderer.renderGlassPane(e))}static createFor(e,t){if(e.rendered)throw new Error("Don't call this function if widget is already rendered.");let s=new Qr,r=n=>{let o=t();s.ready(o)};return e.one("render",r),e.one("destroy",()=>{e.off("render",r)}),[s]}}function Rs(i,e,t){return e=HT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function HT(i){var e=NT(i,"string");return typeof e=="symbol"?e:String(e)}function NT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Zr{constructor(e,t){Rs(this,"session",void 0),Rs(this,"_widget",void 0),Rs(this,"_enabled",void 0),Rs(this,"_$glassPanes",void 0),Rs(this,"_deferredGlassPanes",void 0),Rs(this,"_resolvedDisplayParent",void 0),Rs(this,"_registeredDisplayParent",void 0),Rs(this,"_displayParentRenderHandler",void 0),Rs(this,"_glassPaneRemoveHandler",void 0),Rs(this,"_glassPaneRendererRegistered",void 0),this._widget=e,this.session=e.session,this._enabled=u.nvl(t,!0),this._$glassPanes=[],this._deferredGlassPanes=[],this._resolvedDisplayParent=null,this._registeredDisplayParent=null,this._displayParentRenderHandler=this._onDisplayParentRender.bind(this),this._glassPaneRemoveHandler=this._onGlassPaneRemove.bind(this),this._glassPaneRendererRegistered=!1}renderGlassPanes(){this.findGlassPaneTargets().forEach(e=>this.renderGlassPane(e)),this._glassPaneRendererRegistered||(this.session.focusManager.registerGlassPaneRenderer(this),this._glassPaneRendererRegistered=!0)}renderGlassPane(e){if(e instanceof Qr){e.rendererReady(this),this._deferredGlassPanes.push(e);return}let t=a().ensure(e);if(this._widget.$container&&this._widget.$container[0]===t[0]||this._$glassPanes.some(o=>o.parent()[0]===t[0]))return;let r=t.appendDiv("glasspane").on("mousedown",this._onMouseDown.bind(this));this._adjustGlassPaneSize(r,t);let n=r.window(!0);n&&n[Lr.PROP_POPUP_WINDOW]&&r.addClass("dark"),this._$glassPanes.push(r),this.session.focusManager.registerGlassPaneTarget(t),r.one("remove",this._glassPaneRemoveHandler),this._registerDisplayParent()}_adjustGlassPaneSize(e,t){let s=-t.cssBorderTopWidth(),r=-t.cssBorderBottomWidth(),n=-t.cssBorderLeftWidth(),o=-t.cssBorderRightWidth();t.children().each((l,h)=>{let d=a()(h);s=Math.min(s,(d.cssTop()||0)+(d.cssMarginTop()||0)),r=Math.min(r,(d.cssBottom()||0)+(d.cssMarginBottom()||0)),n=Math.min(n,(d.cssLeft()||0)+(d.cssMarginLeft()||0)),o=Math.min(o,(d.cssRight()||0)+(d.cssMarginRight()||0))}),e.cssTop(s).cssBottom(r).cssLeft(n).cssRight(o)}removeGlassPanes(){this._$glassPanes.slice().forEach(e=>this._removeGlassPane(e)),this._deferredGlassPanes.forEach(e=>e.removeGlassPaneRenderer(this)),this._deferredGlassPanes=[],this._unregisterDisplayParent(),this.session.focusManager.unregisterGlassPaneRenderer(this),this._glassPaneRendererRegistered=!1}_removeGlassPane(e){let t=e.parent();e.off("remove",this._glassPaneRemoveHandler),e.remove(),p.$remove(this._$glassPanes,e),t.removeClass("glasspane-parent"),this.session.focusManager.unregisterGlassPaneTarget(t)}eachGlassPane(e){this._$glassPanes.forEach(t=>e(t))}findGlassPaneTargets(){if(!this._enabled)return[];let e=this._resolveDisplayParent();return!e||!e.glassPaneTargets?[]:e.glassPaneTargets(this._widget)}_resolveDisplayParent(){return this._resolvedDisplayParent||(this._resolvedDisplayParent=this._widget.displayParent||this.session.desktop),this._resolvedDisplayParent}_registerDisplayParent(){this._resolvedDisplayParent||this._resolveDisplayParent(),this._resolvedDisplayParent&&(this._registeredDisplayParent||(this.session.focusManager.registerGlassPaneDisplayParent(this._resolvedDisplayParent),this._registeredDisplayParent=this._resolvedDisplayParent,this._registeredDisplayParent.on("render",this._displayParentRenderHandler)))}_unregisterDisplayParent(){this._registeredDisplayParent&&(this.session.focusManager.unregisterGlassPaneDisplayParent(this._registeredDisplayParent),this._registeredDisplayParent.off("render",this._displayParentRenderHandler),this._registeredDisplayParent=null)}_onMouseDown(e){let t=null,s=this._resolveDisplayParent();if(s.onGlassPaneMouseDown&&s.onGlassPaneMouseDown(this._widget,a()(e.target)),this._widget instanceof U&&this._widget.isView()){let r=this.session.desktop.bench.getViewTab(this._widget);r&&(t=r.$container,t.isVisible()||(t=t.siblings(".overflow-tab-item")))}else this._widget.$container&&(t=this._widget.$container);if(t){let r=this._widget.$container.children(".glasspane");r.length?r.trigger("mousedown"):t.addClassForAnimation("animate-modality-highlight",{classesToRemove:"animate-modality-highlight animate-open"})}a().suppressEvent(e)}_onDisplayParentRender(e){this.renderGlassPanes()}_onGlassPaneRemove(e){let t=a()(e.target);this._removeGlassPane(t)}}function en(i,e,t){return e=VT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function VT(i){var e=WT(i,"string");return typeof e=="symbol"?e:String(e)}function WT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class vd extends I{constructor(){super(),en(this,"location",void 0),en(this,"sandboxEnabled",void 0),en(this,"sandboxPermissions",void 0),en(this,"scrollBarEnabled",void 0),en(this,"trackLocation",void 0),en(this,"wrapIframe",void 0),en(this,"$iframe",void 0),this.location=null,this.sandboxEnabled=!0,this.sandboxPermissions=null,this.scrollBarEnabled=!0,this.trackLocation=!1,this.wrapIframe=x.get().isIosPlatform(),this.$iframe=null}_render(){let e="iframe "+x.get().cssClassForIphone();this.session.layoutValidator.suppressValidate(),this.wrapIframe?(this.$container=this.$parent.appendDiv("iframe-wrapper"),this.$iframe=this.$container.appendElement("<iframe>",e)):(this.$iframe=this.$parent.appendElement("<iframe>",e),this.$container=this.$iframe),this.session.layoutValidator.unsuppressValidate(),this.htmlComp=T.install(this.$container,this.session),this.$iframe.on("load",this._onLoad.bind(this))}_renderProperties(){super._renderProperties(),this._renderScrollBarEnabled(),this._renderSandboxEnabled(),this._renderLocation()}setLocation(e){this.setProperty("location",e)}_renderLocation(){let e=this.location||"about:blank";this.$iframe.attr("src",e)}setTrackLocation(e){this.setProperty("trackLocation",e)}_contentDocument(){return this.$iframe&&this.$iframe[0]?this.$iframe[0].contentDocument:null}_onLoad(e){!this.rendered||(this.trackLocation&&this._updateLocation(),this._propagateKeyEvents())}_updateLocation(){let e=this._contentDocument();if(!e)return;let t=e.location.href;t==="about:blank"&&(t=null),this._setProperty("location",t)}_propagateKeyEvents(){let e=this._contentDocument();if(!e)return;let t=this.wrapIframe?this.$container[0]:this.$parent[0];!t||ot.addPropagationListener(e,t,["keydown","keyup","keypress"],s=>s.which!==g.TAB)}setScrollBarEnabled(e){this.setProperty("scrollBarEnabled",e)}_renderScrollBarEnabled(){this.$container.toggleClass("no-scrolling",!this.scrollBarEnabled),this.$iframe.attr("scrolling",this.scrollBarEnabled?"yes":"no"),this.rendered&&this._renderLocation()}setSandboxEnabled(e){this.setProperty("sandboxEnabled",e)}_renderSandboxEnabled(){this.sandboxEnabled?this._renderSandboxPermissions():(this.$iframe.removeAttr("sandbox"),this.$iframe.removeAttr("security")),this.rendered&&this._renderLocation()}setSandboxPermissions(e){this.setProperty("sandboxPermissions",e)}_renderSandboxPermissions(){!this.sandboxEnabled||(this.$iframe.attr("sandbox",u.nvl(this.sandboxPermissions,"")),this.rendered&&this._renderLocation())}postMessage(e,t,s){!this.rendered||this.$iframe[0].contentWindow.postMessage(e,t,s)}}function et(i,e,t){return e=zT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function zT(i){var e=KT(i,"string");return typeof e=="symbol"?e:String(e)}function KT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Jo extends I{constructor(){super(),et(this,"axis",void 0),et(this,"borderless",void 0),et(this,"mouseWheelNeedsShift",void 0),et(this,"$thumb",void 0),et(this,"$thumbHandle",void 0),et(this,"_scrollSize",void 0),et(this,"_offsetSize",void 0),et(this,"_dim",void 0),et(this,"_dir",void 0),et(this,"_dirReverse",void 0),et(this,"_scrollDir",void 0),et(this,"_thumbClipping",void 0),et(this,"_onScrollHandler",void 0),et(this,"_onScrollWheelHandler",void 0),et(this,"_onScrollbarMouseDownHandler",void 0),et(this,"_onTouchStartHandler",void 0),et(this,"_onThumbMouseDownHandler",void 0),et(this,"_onDocumentMousemoveHandler",void 0),et(this,"_onDocumentMouseUpHandler",void 0),et(this,"_onAncestorScrollOrResizeHandler",void 0),et(this,"_fixScrollbarHandler",void 0),et(this,"_unfixScrollbarHandler",void 0),et(this,"_$thumb",void 0),et(this,"_$thumbHandle",void 0),et(this,"_$ancestors",void 0),this.$container=null,this.$thumb=null,this.$thumbHandle=null,this.axis="y",this.borderless=!1,this.mouseWheelNeedsShift=!1,this._scrollSize=null,this._offsetSize=null,this._dim="Height",this._dir="top",this._dirReverse="bottom",this._scrollDir="scrollTop",this._thumbClipping=new Ge(0,0,0,0),this._onScrollHandler=this._onScroll.bind(this),this._onScrollWheelHandler=this._onScrollWheel.bind(this),this._onScrollbarMouseDownHandler=this._onScrollbarMouseDown.bind(this),this._onTouchStartHandler=this._onTouchStart.bind(this),this._onThumbMouseDownHandler=this._onThumbMouseDown.bind(this),this._onDocumentMousemoveHandler=this._onDocumentMousemove.bind(this),this._onDocumentMouseUpHandler=this._onDocumentMouseUp.bind(this),this._onAncestorScrollOrResizeHandler=this.update.bind(this),this._fixScrollbarHandler=this._fixScrollbar.bind(this),this._unfixScrollbarHandler=this._unfixScrollbar.bind(this)}_render(){this._ensureParentPosition(),this.$container=this.$parent.appendDiv("scrollbar").addClass(this.axis+"-axis"),this._$thumb=this.$container.appendDiv("scrollbar-thumb").addClass(this.axis+"-axis"),this._$thumbHandle=this._$thumb.appendDiv("scrollbar-thumb-handle").addClass(this.axis+"-axis"),this.borderless&&this.$container.addClass("borderless"),this._dim=this.axis==="x"?"Width":"Height",this._dir=this.axis==="x"?"left":"top",this._dirReverse=this.axis==="x"?"right":"bottom",this._scrollDir=this.axis==="x"?"scrollLeft":"scrollTop";let e=this.$parent.data("scrollbars");if(!e)throw new Error('Data "scrollbars" missing in '+v.debugOutput(this.$parent)+`
Ancestors: `+this.ancestorsToString(1));this.$parent.on("DOMMouseScroll mousewheel",this._onScrollWheelHandler).on("scroll",this._onScrollHandler).onPassive("touchstart",this._onTouchStartHandler),e.forEach(t=>{t.on("scrollStart",this._fixScrollbarHandler),t.on("scrollEnd",this._unfixScrollbarHandler)}),this.$container.on("mousedown",this._onScrollbarMouseDownHandler),this._$thumb.on("mousedown",this._onThumbMouseDownHandler),this._$ancestors=this.$container.parents("div").on("scroll resize",this._onAncestorScrollOrResizeHandler)}_remove(){this.$parent.off("DOMMouseScroll mousewheel",this._onScrollWheelHandler).off("scroll",this._onScrollHandler).offPassive("touchstart",this._onTouchStartHandler);let e=this.$parent.data("scrollbars");e&&e.forEach(t=>{t.off("scrollStart",this._fixScrollbarHandler),t.off("scrollEnd",this._unfixScrollbarHandler)}),this.$container.off("mousedown",this._onScrollbarMouseDownHandler),this._$thumb.off("mousedown","",this._onThumbMouseDownHandler),this._$ancestors.off("scroll resize",this._onAncestorScrollOrResizeHandler),this._$ancestors=null,super._remove()}_renderOnAttach(){super._renderOnAttach(),this._ensureParentPosition()}_ensureParentPosition(){if(this.$parent&&this.$parent.isAttached()){let e=this.$parent.css("position");u.isOneOf(e,"relative","absolute")||this.$parent.css("position","relative")}}scroll(e){let t=Math.max(0,this.$parent[this._scrollDir]());this._scrollToAbsolutePoint(t+e)}_scrollToAbsolutePoint(e){let t=Math.min(this._scrollSize-this._offsetSize+1,Math.max(0,Math.round(e)));this.$parent[this._scrollDir](t)}update(){if(!this.rendered)return;let e=this.$container["cssMargin"+this.axis.toUpperCase()](),t=this.$parent[this._scrollDir](),s=this.$parent.scrollLeft(),r=this.$parent.scrollTop();this.reset(),this._offsetSize=this.$parent[0]["offset"+this._dim],this._scrollSize=this.$parent[0]["scroll"+this._dim];let n=Math.max(this._offsetSize*this._offsetSize/this._scrollSize-e,25),o=this._offsetSize-n-e;this._$thumb.css(this._dim.toLowerCase(),n);let l=t/(this._scrollSize-this._offsetSize)*o;this._$thumb.css(this._dir,l);let h=1;this._offsetSize+h>=this._scrollSize?this.$container.css("display","none"):(this.$container.css("display",""),this._isContainerTooSmallForThumb()?this._$thumb.addClass("container-too-small-for-thumb"):this._$thumb.removeClass("container-too-small-for-thumb")),this._clipWhenOverlappingAncestor(),this.$container.cssRight(-1*s),this.$container.cssBottom(-1*r)}_resetClipping(){this.axis==="y"?this._$thumb.css("width","").css("left",""):this._$thumb.css("height","").css("top",""),this._$thumb.removeClass("clipped-left clipped-right clipped-top clipped-bottom"),this._thumbClipping=new Ge(0,0,0,0)}_clipWhenOverlappingAncestor(){if(this._resetClipping(),this.$container.css("position")==="fixed"){let e=v.offsetBounds(this._$thumb),t=e.width,s=e.height,r=e.x+e.width,n=e.y+e.height,o=0,l=0,h=r,d=n;this.$container.parents("div").each(function(){let C=a()(this),S=v.offsetBounds(C);if(C.css("overflow-x")!=="visible"){S.x>o&&(o=S.x);let R=S.x+S.width;R<h&&(h=R)}if(C.css("overflow-y")!=="visible"){S.y>l&&(l=S.y);let R=S.y+S.height;R<d&&(d=R)}});let c=0,f=0,m=0,_=0;o>e.x&&(c=o-e.x,t-=c,this._$thumb.css("width",t).css("left",v.bounds(this._$thumb).x+c).addClass("clipped-left")),l>e.y&&(m=l-e.y,s-=m,this._$thumb.css("height",s).css("top",v.bounds(this._$thumb).y+m).addClass("clipped-top")),r>h&&(f=r-h,this._$thumb.css("width",t-f).addClass("clipped-right")),n>d&&(_=n-d,this._$thumb.css("height",s-_).addClass("clipped-bottom")),this._thumbClipping=new Ge(m,f,_,c)}}reset(){this._$thumb.css(this._dim.toLowerCase(),0),this.$container.cssRight(0),this.$container.cssBottom(0)}_onScroll(e){this.update()}_onTouchStart(e){ot.onScrollStartEndDuringTouch(this.$parent,()=>{!this.rendered||this.$container.css("opacity",0)},()=>{!this.rendered||this.$container.css("opacity","")})}_onScrollWheel(e){if(!this.$container.isVisible()||e.ctrlKey||this.mouseWheelNeedsShift!==e.shiftKey)return!0;let t=e.originalEvent||this.$container.window(!0).event.originalEvent,s=t.wheelDelta?-t.wheelDelta/2:t.detail*20;return this.notifyBeforeScroll(),this.scroll(s),this.notifyAfterScroll(),!1}_onScrollbarMouseDown(e){this.notifyBeforeScroll();let t=this.$container[this._dim.toLowerCase()](),s=this.$container.offset()[this._dir],r=(this.axis==="x"?e.pageX:e.pageY)-s,n;if(this._isContainerTooSmallForThumb())n=Math.min(1,Math.max(0,r/t)),this._scrollToAbsolutePoint(n*this._scrollSize-Math.round(this._offsetSize/2));else{let o=this._$thumb["outer"+this._dim](!0),l=Math.round(o/2),h=t-Math.round(o/2),d=(r-l)*(1/(h-l));n=Math.min(1,Math.max(0,d)),this._scrollToAbsolutePoint(n*(this._scrollSize-this._offsetSize))}this.notifyAfterScroll()}_onThumbMouseDown(e){if(this._isContainerTooSmallForThumb())return!0;this.notifyBeforeScroll();let s=(this.axis==="x"?this._thumbClipping.horizontal():this._thumbClipping.vertical())+this._$thumb["outer"+this._dim](!0),r=this.axis==="x"?this._thumbClipping.left:this._thumbClipping.top,n=this._$thumb.offset()[this._dir]+Math.floor(s/2)-r,o=Math.round((this.axis==="x"?e.pageX:e.pageY)-n);return this._$thumb.addClass("scrollbar-thumb-move"),this._$thumb.document().on("mousemove",{thumbCenterOffset:o},this._onDocumentMousemoveHandler).one("mouseup",this._onDocumentMouseUpHandler),!1}_onDocumentMousemove(e){if(!this.rendered)return;let t=e.data.thumbCenterOffset,r=(this.axis==="x"?this._thumbClipping.horizontal():this._thumbClipping.vertical())+this._$thumb["outer"+this._dim](!0),n=this.$container[this._dim.toLowerCase()]()-r,o=this.$container.offset()[this._dir]+r/2,l=Math.min(n,Math.max(0,(this.axis==="x"?e.pageX:e.pageY)-o-t)),d=Math.min(1,Math.max(0,l/n))*(this._scrollSize-this._offsetSize);this._scrollToAbsolutePoint(d)}_onDocumentMouseUp(e){return a()(e.currentTarget).off("mousemove",this._onDocumentMousemoveHandler),this.rendered&&this._$thumb.removeClass("scrollbar-thumb-move"),this.notifyAfterScroll(),!1}notifyBeforeScroll(){this.trigger("scrollStart")}notifyAfterScroll(){this.trigger("scrollEnd")}_fixScrollbar(){P.fix(this.$container),this.update()}_unfixScrollbar(){P.unfix(this.$container,null,!0),this.update()}_isContainerTooSmallForThumb(){let e=this._$thumb["outer"+this._dim](!0),t=this.$container[this._dim.toLowerCase()]();return e>=t}}const P={_$scrollables:{},intersectionObserver:null,getScrollables(i){if(i)return P._$scrollables[i+""]||[];let e=[];return b.values(P._$scrollables).forEach(t=>{p.pushAll(e,t)}),e},pushScrollable(i,e){let t=i+"";if(P._$scrollables[t]){if(P._$scrollables[t].indexOf(e)>-1)return;P._$scrollables[t].push(e)}else P._$scrollables[t]=[e];a().log.isTraceEnabled()&&a().log.trace("Scrollable added: "+e.attr("class")+". New length: "+P._$scrollables[t].length)},removeScrollable(i,e){let t=0,s=i+"";if(P._$scrollables[s]){if(t=P._$scrollables[s].length,p.$remove(P._$scrollables[s],e),a().log.isTraceEnabled()&&a().log.trace("Scrollable removed: "+e.attr("class")+". New length: "+P._$scrollables[s].length),t===P._$scrollables[s].length)throw new Error("scrollable could not be removed. Potential memory leak. "+e.attr("class"))}else throw new Error("scrollable could not be removed. Potential memory leak. "+e.attr("class"))},install(i,e){e=e||{},e.axis=e.axis||"both",e.scrollShadow=e.scrollShadow||"auto";let t=u.nvl(e.nativeScrollbars,x.get().hasPrettyScrollbars()),s=u.nvl(e.hybridScrollbars,x.get().canHideScrollbars());t?P._installNative(i,e):s?(i.addClass("hybrid-scrollable"),P._installNative(i,e),P._installJs(i,e)):(i.css("overflow","hidden"),P._installJs(i,e));let r=T.optGet(i);r&&(r.scrollable=!0),i.data("scrollable",!0);let n=e.session||e.parent.session;return P.pushScrollable(n,i),e.scrollShadow&&P.installScrollShadow(i,e),i},_installNative(i,e){x.get().isIos()?setTimeout(P._installNativeInternal.bind(this,i,e)):P._installNativeInternal(i,e)},_installNativeInternal(i,e){a().log.isTraceEnabled()&&a().log.trace("use native scrollbars for container "+v.debugOutput(i)),e.axis==="x"?i.css("overflow-x","auto").css("overflow-y","hidden"):e.axis==="y"?i.css("overflow-x","hidden").css("overflow-y","auto"):i.css("overflow","auto"),i.css("-webkit-overflow-scrolling","touch")},installScrollShadow(i,e){if(!x.get().supportsIntersectionObserver())return;let t=P._computeScrollShadowStyle(e);if(t.length===0)return;let s=i.afterDiv("scroll-shadow");s.toggleClass("large",t.indexOf("large")>-1),s.toggleClass("gradient",t.indexOf("gradient")>-1),s.data("scroll-shadow-parent",i),i.data("scroll-shadow",s),i.data("scroll-shadow-style",t),i.data("scroll-shadow-customizer",e.scrollShadowCustomizer);let r=()=>P.updateScrollShadowWhileScrolling(i);i.data("scroll-shadow-handler",r),i.on("scroll",r),P.updateScrollShadow(i),P._installMutationObserver(i.entryPoint()),P._installIntersectionObserver(),P.intersectionObserver.observe(i[0]);let n=i[0],o=l=>{l.target===n&&P._onScrollableVisibleChange(n,l.type==="show")};i.data("scroll-shadow-visible-listener",o),i.on("hide show",o)},uninstallScrollShadow(i,e){let t=i.data("scroll-shadow");t&&(t.remove(),i.removeData("scroll-shadow")),i.removeData("scroll-shadow-style"),i.removeData("scroll-shadow-customizer");let s=i.data("scroll-shadow-handler");s&&(i.off("scroll",s),i.removeData("scroll-shadow-handler")),P.intersectionObserver&&P.intersectionObserver.unobserve(i[0]);let r=i.data("scroll-shadow-visible-listener");r&&i.off("hide show",r),P._hasScrollShadow(e,i.entryPoint(!0))||P._uninstallMutationObserver(i.entryPoint()),P._hasScrollShadow(e)||P._uninstallIntersectionObserver()},_hasScrollShadow(i,e){const t=P._$scrollables[i+""];return t&&t.some(s=>s.data("scroll-shadow")&&(!e||s.entryPoint(!0)===e))},_computeScrollShadowStyle(i){let e=i.scrollShadow;return e?(typeof e=="string"&&(e=e.split(" ")),e=e.slice(),e.indexOf("none")>-1?[]:(p.containsAny(e,["y","x","top","right","bottom","left"])||((i.axis==="both"||i.axis==="y")&&e.push("y"),(i.axis==="both"||i.axis==="x")&&e.push("x")),e.indexOf("y")>-1&&(e.push("top"),e.push("bottom")),e.indexOf("x")>-1&&(e.push("left"),e.push("right")),p.removeAll(e,["all","y","x","auto","none"]),e)):[]},updateScrollShadowWhileScrolling(i){let e=i.findUp(t=>t.hasAnimationClass());if(e.length>0){e.oneAnimationEnd(()=>P.updateScrollShadow(i));return}P.updateScrollShadow(i)},updateScrollShadow(i){let e=i.data("scroll-shadow");if(!e)return;let t=i[0].scrollTop,s=i[0].scrollLeft,r=c(t),n=f(t,i[0].scrollHeight,i[0].offsetHeight),o=c(s),l=f(s,i[0].scrollWidth,i[0].offsetWidth),h=i.data("scroll-shadow-style");e.toggleClass("top",!r&&h.indexOf("top")>-1),e.toggleClass("bottom",!n&&h.indexOf("bottom")>-1),e.toggleClass("left",!o&&h.indexOf("left")>-1),e.toggleClass("right",!l&&h.indexOf("right")>-1),v.setBounds(e,v.bounds(i,{exact:!0}).subtract(m(e))),v.setMargins(e,v.margins(i)),e.css("border-radius",i.css("border-radius"));let d=i.data("scroll-shadow-customizer");d&&d(i,e);function c(_){return _===0}function f(_,C,S){return _+1>=C-S}function m(_){return new Ge(_.cssPxValue("--scroll-shadow-inset-top"),_.cssPxValue("--scroll-shadow-inset-right"),_.cssPxValue("--scroll-shadow-inset-bottom"),_.cssPxValue("--scroll-shadow-inset-left"))}},_installMutationObserver(i){if(!i||!i[0]||i.data("mutation-observer"))return;const e=new MutationObserver(P._onDomMutation);i.data("mutation-observer",e),e.observe(i[0],{subtree:!0,childList:!0})},_onDomMutation(i,e){i.forEach(P._processDomMutation)},_processDomMutation(i){for(let e=0;e<i.addedNodes.length;e++){let t=i.addedNodes[e],s=a()(t);if(s.data("scrollable")){let r=s.data("scroll-shadow");r&&r.insertAfter(s)}}},_uninstallMutationObserver(i){!i||!i.data("mutation-observer")||(i.data("mutation-observer").disconnect(),i.removeData("mutation-observer"))},_installIntersectionObserver(){P.intersectionObserver||(P.intersectionObserver=new IntersectionObserver((i,e)=>{i.forEach(t=>P._onScrollableVisibleChange(t.target,t.intersectionRatio>0))}))},_uninstallIntersectionObserver(){!P.intersectionObserver||(P.intersectionObserver.disconnect(),P.intersectionObserver=null)},_onScrollableVisibleChange(i,e){let t=a()(i),s=t.data("scroll-shadow");!s||s.setVisible(t.isVisible())},hasScrollShadow(i,e){if(!i)return!1;let t=i.data("scroll-shadow");return t?e?t.hasClass(e):!0:!1},isHybridScrolling(i){return i.hasClass("hybrid-scrollable")},isNativeScrolling(i){return u.isOneOf("auto",i.css("overflow"),i.css("overflow-x"),i.css("overflow-y"))},isJsScrolling(i){return!!i.data("scrollbars")},_installJs(i,e){a().log.isTraceEnabled()&&a().log.trace("installing JS-scrollbars for container "+v.debugOutput(i));let t=p.ensure(i.data("scrollbars"));t.forEach(r=>{r.destroy()}),t=[];let s;if(e.axis==="both"){let r=a().extend({},e,{axis:"y"});s=u.create(Jo,r),t.push(s),r=a().extend({},r,{axis:"x",mouseWheelNeedsShift:!0}),s=u.create(Jo,r),t.push(s)}else{let r=a().extend({},e,{axis:e.axis});s=u.create(Jo,r),t.push(s)}i.data("scrollbars",t),t.forEach(r=>{r.render(i),r.update()})},uninstall(i,e){if(!i.data("scrollable"))return;let t=i.data("scrollbars");t&&t.forEach(r=>{r.destroy()}),P.removeScrollable(e,i),i.removeData("scrollable"),i.css("overflow",""),i.removeClass("hybrid-scrollable"),i.removeData("scrollbars");let s=T.optGet(i);s&&(s.scrollable=!1),P.uninstallScrollShadow(i,e)},update(i,e){if(!i||!i.data("scrollable"))return;P.updateScrollShadow(i);let t=i.data("scrollbars");if(!t){x.get().isIos()&&P._handleIosPaintBug(i);return}if(e){P._update(t);return}i.data("scrollbarUpdatePending")||(setTimeout(()=>{P._update(t),i.removeData("scrollbarUpdatePending")},0),i.data("scrollbarUpdatePending",!0))},_update(i){i.forEach(e=>{e.rendered&&e.reset()}),i.forEach(e=>{e.rendered&&e.update()})},_handleIosPaintBug(i){if(i.data("scrollbarUpdatePending"))return;setTimeout(()=>{e(),i.removeData("scrollbarUpdatePending")}),i.data("scrollbarUpdatePending",!0);function e(){let t=v.size(i).subtract(v.insets(i,{includePadding:!1,includeBorder:!0}));i[0].scrollHeight===t.height&&i[0].scrollWidth===t.width?i.css("-webkit-overflow-scrolling",""):i.css("-webkit-overflow-scrolling","touch")}},reset(i){let e=i.data("scrollbars");!e||e.forEach(t=>t.reset())},scrollTo(i,e,t){let s;typeof t=="string"?s={align:t}:s=P._createDefaultScrollToOptions(t);let r=s.align?s.align.toLowerCase():void 0,n,o=u.nvl(s.scrollOffsetUp,r==="center"?0:4),l=u.nvl(s.scrollOffsetDown,r==="center"?0:8),h=i.height(),d=v.offsetBounds(e),c=v.offsetBounds(i),f=d.y-c.y,m=d.height,_=f-o,C=f+m+l;if(r||(r=_<0?"top":C>h?"bottom":void 0),r==="center")n=i.scrollTop()+_-Math.max(0,(h-m)/2);else if(r==="top")n=i.scrollTop()+_;else if(r==="bottom"){n=Math.ceil(i.scrollTop()+C-h);let S=_-(n-i.scrollTop());S<0&&(n=n+S)}n!==void 0&&P.scrollTop(i,n,s)},_createDefaultScrollToOptions(i){let e={animate:!1,stop:!0};return a().extend({},e,i)},scrollHorizontalTo(i,e,t){let s,r=i.width(),n=v.bounds(e,!0),o=n.x,l=n.width;o<0?P.scrollLeft(i,i.scrollLeft()+o,t):o+l>r&&(s=Math.ceil(i.scrollLeft()+o+l-r),P.scrollLeft(i,s,t))},scrollTop(i,e,t){t=P._createDefaultScrollToOptions(t);let s=P.scrollbar(i,"y");if(s&&s.notifyBeforeScroll(),t.stop&&i.stop("scroll"),!t.animate){i.scrollTop(e),s&&s.notifyAfterScroll();return}P.animateScrollTop(i,e),i.promise("scroll").always(()=>{s&&s.notifyAfterScroll()})},scrollLeft(i,e,t){t=P._createDefaultScrollToOptions(t);let s=P.scrollbar(i,"x");if(s&&s.notifyBeforeScroll(),t.stop&&i.stop("scroll"),!t.animate){i.scrollLeft(e),s&&s.notifyAfterScroll();return}P.animateScrollLeft(i,e),i.promise("scroll").always(()=>{s&&s.notifyAfterScroll()})},animateScrollTop(i,e){i.animate({scrollTop:e},{queue:"scroll"}).dequeue("scroll")},animateScrollLeft(i,e){i.animate({scrollLeft:e},{queue:"scroll"}).dequeue("scroll")},scrollbar(i,e){let t=i.data("scrollbars")||[];return p.find(t,s=>s.axis===e)},scrollToBottom(i,e){P.scrollTop(i,i[0].scrollHeight-i[0].offsetHeight,e)},isLocationInView(i,e){return!e||e.length===0?!0:e.toArray().every(t=>v.offsetBounds(a()(t)).contains(i.x,i.y))},onScroll(i,e){e.$scrollParents=[],i.scrollParents().each(function(){let t=a()(this);t.on("scroll",e),e.$scrollParents.push(t)})},offScroll(i){let e=i.$scrollParents;if(!e)throw new Error("$scrollParents are not defined");for(let t=0;t<e.length;t++)e[t].off("scroll",i)},fix(i){if(!i.isVisible()||i.css("position")==="fixed")return;let e=i[0].getBoundingClientRect();i.css("position","fixed").cssLeft(e.left-i.cssMarginLeft()).cssTop(e.top-i.cssMarginTop()).cssWidth(e.width).cssHeight(e.height)},unfix(i,e,t){if(clearTimeout(e),t){P._unfix(i);return}return setTimeout(()=>{P._unfix(i)},50)},_unfix(i){i.css({position:"absolute",left:"",top:"",width:"",height:""})},storeScrollPositions(i,e){let t=P.getScrollables(e);if(!t)return;let s,r;t.forEach(n=>{i.isOrHas(n[0])&&(s=n.scrollTop(),n.data("scrollTop",s),r=n.scrollLeft(),n.data("scrollLeft",n.scrollLeft()),a().log.isTraceEnabled()&&a().log.trace("Stored scroll position for "+n.attr("class")+". Top: "+s+". Left: "+r))})},restoreScrollPositions(i,e){let t=P.getScrollables(e);if(!t)return;let s,r;t.forEach(n=>{i.isOrHas(n[0])&&(s=n.data("scrollTop"),s&&(n.scrollTop(s),n.removeData("scrollTop")),r=n.data("scrollLeft"),r&&(n.scrollLeft(r),n.removeData("scrollLeft")),P.update(n),a().log.isTraceEnabled()&&a().log.trace("Restored scroll position for "+n.attr("class")+". Top: "+s+". Left: "+r))})},setVisible(i,e){if(!i||!i.data("scrollable"))return;let t=i.data("scrollbars");!t||t.forEach(s=>{s.rendered&&s.$container.setVisible(e)})},opacity(i,e){if(!i||!i.data("scrollable"))return;let t=i.data("scrollbars");!t||t.forEach(s=>{s.rendered&&s.$container.css("opacity",e)})},_getCompleteChildRowsHeightRecursive(i,e,t,s){let r=0;return i.forEach(n=>{n.height?r+=n.height:r+=s,t(n)&&e(n).length>0&&(r+=P._getCompleteChildRowsHeightRecursive(e(n),e,t,s))}),r},ensureExpansionVisible(i){let e=i.isExpanded(i.element),t=i.getChildren(i.element),s=i.$element.position().top,r=i.element.height,n=i.$scrollable.scrollTop();if(e){if(e&&t.length>0){let o=i.$scrollable.height(),h=P._getCompleteChildRowsHeightRecursive(t,i.getChildren,i.isExpanded,i.defaultChildHeight)+1.5*r,d=s+h,c=n+Math.min(d-o,s-r);c>n&&P.scrollTop(i.$scrollable,c,{animate:!0,stop:!1})}}else if(s<r){let o=Math.max(n-(r-s),0);P.scrollTop(i.$scrollable,o,{animate:!0})}if(t.length>0){let o=Math.max(i.element.level-3,0)*i.nodePaddingLevel;P.scrollLeft(i.$scrollable,o,{animate:!0,stop:!1})}}};function Qo(i,e,t){return e=GT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function GT(i){var e=UT(i,"string");return typeof e=="symbol"?e:String(e)}function UT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class wd{constructor(e){Qo(this,"enabled",void 0),Qo(this,"minRowHeight",void 0),Qo(this,"viewRangeSize",void 0),Qo(this,"widget",void 0),Qo(this,"$scrollable",void 0),this.enabled=!0,this.minRowHeight=0,this.viewRangeSize=0,this.widget=null,this.$scrollable=null,a().extend(this,e)}setEnabled(e){this.enabled=e}set$Scrollable(e){this.$scrollable!==e&&(this.$scrollable=e)}setMinRowHeight(e){if(this.minRowHeight!==e){if(!Ke.isNumber(e))throw new Error("minRowHeight is not a number: "+e);this.minRowHeight=e,this.widget.rendered&&this.setViewRangeSize(this.calculateViewRangeSize())}}setViewRangeSize(e,t){this.viewRangeSize!==e&&(this.viewRangeSize=e,this.widget.rendered&&u.nvl(t,!0)&&this.renderViewPort())}calculateViewRangeSize(){if(!this.enabled||this.$scrollable.length===0)return this.rowCount();if(this.minRowHeight===0)throw new Error("Cannot calculate view range with rowHeight = 0");return Math.ceil(this.$scrollable.height()/this.minRowHeight)*2}calculateCurrentViewRange(){if(!this.enabled)return this.maxViewRange();if(this.viewRangeSize===0)return new B(0,0);let e;if(this.$scrollable.length===0)return this.maxViewRange();let t=this.$scrollable[0].scrollTop,s=this.$scrollable[0].scrollHeight-this.$scrollable[0].clientHeight,r=this.widget.$container[0].getBoundingClientRect(),n=this.$scrollable[0].getBoundingClientRect();return r.height>0&&(r.bottom<n.top||r.top>n.bottom)?new B(0,0):(s===0?e=0:e=this._rowIndexAtScrollTop(t),this.calculateViewRangeForRowIndex(e))}maxViewRange(){return new B(0,this.rowCount())}calculateViewRangeForRowIndex(e){if(!this.enabled)return this.maxViewRange();let t=new B,s=Math.floor(this.viewRangeSize/4),r;return t.from=Math.max(e-s,0),t.to=Math.min(t.from+this.viewRangeSize,this.rowCount()),r=this.viewRangeSize-t.size(),r>0&&(t.from=Math.max(t.to-this.viewRangeSize,0)),t}_rowIndexAtScrollTop(e){let t=0,s=this.rowCount(),r=s-1;this.widget.$container[0]!==this.$scrollable[0]&&(t=e+(this.widget.$container.offset().top-this.$scrollable.offset().top));for(let n=0;n<s;n++)if(t+=this.rowHeight(n),e<t){r=n;break}return r}rowHeight(e){throw new Error("Function has to be provided by widget")}rowCount(){throw new Error("Function has to be provided by widget")}renderViewPort(){let e=this.calculateCurrentViewRange();this._renderViewRange(e)}renderViewRangeForRowIndex(e){let t=this.calculateViewRangeForRowIndex(e);this._renderViewRange(t)}_renderViewRange(e){throw new Error("Function has to be provided by widget")}}function Ms(i,e,t){return e=qT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function qT(i){var e=YT(i,"string");return typeof e=="symbol"?e:String(e)}function YT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Js extends I{constructor(){super(),Ms(this,"splitHorizontal",void 0),Ms(this,"position",void 0),Ms(this,"orientation",void 0),Ms(this,"layoutData",void 0),Ms(this,"$anchor",void 0),Ms(this,"$root",void 0),Ms(this,"_cursorOffset",void 0),Ms(this,"_mouseDownHandler",void 0),Ms(this,"_$window",void 0),Ms(this,"_$body",void 0),this.splitHorizontal=!0,this.$anchor=null,this.$root=null,this.position=null,this.orientation="top",this.layoutData=null,this._cursorOffset=null,this._mouseDownHandler=this._onMouseDown.bind(this),this._$window=null,this._$body=null}_init(e){super._init(e),this.setPosition(this.position)}_render(){this.$container=this.$parent.appendDiv("splitter").addClass(this.splitHorizontal?"x-axis":"y-axis"),this.htmlComp=T.install(this.$container,this.session),this._$window=this.$parent.window(),this._$body=this.$parent.body()}_renderProperties(){super._renderProperties(),this._renderPosition()}_renderEnabled(){super._renderEnabled(),this.enabledComputed?this.$container.on("mousedown",this._mouseDownHandler):this.$container.off("mousedown",this._mouseDownHandler)}_renderVisible(){super._renderVisible(),this.initialized&&this._renderPosition()}setLayoutData(e){super.setLayoutData(e),this.layoutData=e}getLayoutData(){return this.layoutData}setPosition(e){return Ke.isNumber(e)||(e=this._derivePositionFromAnchor()),e!==this.position&&this._setPosition(e),e}_derivePositionFromAnchor(){if(!this.$anchor)return null;let e=v.offsetBounds(this.$anchor,{exact:!0});return this.splitHorizontal?e.x+e.width:e.y+e.height}_setPosition(e){!Ke.isNumber(e)||e!==this.position&&(this.position=e,this.trigger("positionChange",{position:e}),this.rendered&&this._renderPosition())}_renderPosition(){if(this.position===null||!this.visible)return;let e=v.size(this.$container,!0);if(this.splitHorizontal){let t=this.position-e.width/2;this.orientation==="right"?this.$container.cssRight(t):this.$container.cssLeft(t)}else{let t=this.position-e.height/2;this.orientation==="bottom"?this.$container.cssBottom(t):this.$container.cssTop(t)}}_onMouseDown(e){let t=v.margins(this.$container),s=v.offsetBounds(this.$container);s.x-=t.left,s.y-=t.top,s.width+=t.horizontal(),s.height+=t.vertical();let r=s.center();this._$window.on("mousemove.splitter",this._onMouseMove.bind(this)).one("mouseup",this._onMouseUp.bind(this)),this._$body.addClass(this.splitHorizontal?"col-resize":"row-resize"),a()("iframe").addClass("dragging-in-progress"),this._cursorOffset={left:r.x-e.pageX,top:r.y-e.pageY},this.trigger("moveStart",{position:this._getSplitterPosition(e)}),e.preventDefault()}_getSplitterPosition(e){let t=v.offsetBounds(this.$root||this.$parent);if(this.splitHorizontal){let r=e.pageX+this._cursorOffset.left-t.x;return this.orientation==="right"?t.width-r:r}let s=e.pageY+this._cursorOffset.top-t.y;return this.orientation==="bottom"?t.height-s:s}_onMouseMove(e){let t=this._getSplitterPosition(e),s=this.trigger("move",{position:t});s.defaultPrevented||this._setPosition(s.position)}_onMouseUp(e){this._$window.off("mousemove.splitter"),this._$body.removeClass(this.splitHorizontal?"col-resize":"row-resize"),a()("iframe").removeClass("dragging-in-progress"),this.trigger("moveEnd",{position:this.position})}}const Ye={YEAR:"year",MONTH:"month",WEEK_IN_YEAR:"week_in_year",DAY_IN_MONTH:"day_in_month",WEEKDAY:"weekday",HOUR_24:"hour_24",HOUR_12:"hour_12",AM_PM:"am_pm",MINUTE:"minute",SECOND:"second",MILLISECOND:"millisecond",TIMEZONE:"timezone"};function tn(i,e,t){return e=jT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function jT(i){var e=XT(i,"string");return typeof e=="symbol"?e:String(e)}function XT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class je{constructor(e){tn(this,"type",void 0),tn(this,"terms",void 0),tn(this,"dateFormat",void 0),tn(this,"formatFunction",void 0),tn(this,"parseRegExp",void 0),tn(this,"applyMatchFunction",void 0),tn(this,"parseFunction",void 0),e=e||{},this.type=e.type,this.terms=e.terms,this.dateFormat=e.dateFormat,this.formatFunction=e.formatFunction&&e.formatFunction.bind(this),this.parseRegExp=e.parseRegExp,this.applyMatchFunction=e.applyMatchFunction&&e.applyMatchFunction.bind(this),this.parseFunction=e.parseFunction&&e.parseFunction.bind(this)}createFormatFunction(e){return function(t){if(this.formatFunction){let s=this.formatFunction(t,e);s!==void 0&&(t.formattedString+=s)}}.bind(this)}createParseFunction(e){return function(t){let s,r,n,o=!1;return this.parseRegExp&&(s=this.parseRegExp.exec(t.inputString),s&&(this.applyMatchFunction&&this.applyMatchFunction(t,s[1],e),n=s[1],t.inputString=s[2],o=!0)),!o&&this.parseFunction&&(n=this.parseFunction(t,e),n!==null&&(o=!0)),o&&(r=this.terms[0],this.terms.length>1&&this.terms.some(l=>l.length===n.length?(r=l,!0):!1),t.parsedPattern+=r),o}.bind(this)}accept(e){if(e){for(let t=0;t<this.terms.length;t++)if(e===this.terms[t])return this.terms[t]}return null}}function Is(i,e,t){return e=JT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function JT(i){var e=QT(i,"string");return typeof e=="symbol"?e:String(e)}function QT(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class xt{constructor(e,t,s){Is(this,"locale",void 0),Is(this,"pattern",void 0),Is(this,"symbols",void 0),Is(this,"lenient",void 0),Is(this,"_terms",void 0),Is(this,"_formatFunctions",void 0),Is(this,"_parseFunctions",void 0),Is(this,"_analyzeFunctions",void 0),Is(this,"_patternDefinitions",void 0),Is(this,"_patternLibrary",void 0),s=s||{},this.locale=e,u.assertParameter("locale",this.locale),this.pattern=t||e.dateFormatPatternDefault,u.assertParameter("pattern",this.pattern),this.symbols=e.dateFormatSymbols,this.symbols.firstDayOfWeek=1,this.symbols.weekdaysOrdered=w.orderWeekdays(this.symbols.weekdays,this.symbols.firstDayOfWeek),this.symbols.weekdaysShortOrdered=w.orderWeekdays(this.symbols.weekdaysShort,this.symbols.firstDayOfWeek),this.lenient=u.nvl(s.lenient,!0),this._terms=[],this._formatFunctions=[],this._parseFunctions=[],this._analyzeFunctions=[],this._patternDefinitions=[new je({type:Ye.YEAR,terms:["yyyy"],dateFormat:this,formatFunction:(r,n)=>{let o=r.inputDate.getFullYear(),l=Math.max(4,o.toString().length);return y.padZeroLeft(r.inputDate.getFullYear(),l).slice(-l)},parseRegExp:/^(\d{4})(.*)$/,applyMatchFunction:(r,n,o)=>{r.matchInfo.year=n,r.dateInfo.year=Number(n)}}),new je({type:Ye.YEAR,terms:["yyy","yy","y"],dateFormat:this,formatFunction:(r,n)=>{let o=String(r.inputDate.getFullYear()),l=r.exactLength?n.length:2;return l===1?o.slice(-l):y.padZeroLeft(o,l).slice(-l)},parseRegExp:/^(\d{1,3})(.*)$/,applyMatchFunction:(r,n,o)=>{if(n.length===3){r.dateInfo.year=Number(n),r.matchInfo.year=n;return}let l=(r.startDate||new Date).getFullYear(),h=Number(y.padZeroLeft(l,4).substr(0,2)+y.padZeroLeft(n,2)),d=h-l;d<=-50?h+=100:d>50&&(h-=100),r.dateInfo.year=h,r.matchInfo.year=n}}),new je({type:Ye.MONTH,terms:["MMMM"],dateFormat:this,formatFunction:function(r,n){return this.dateFormat.symbols.months[r.inputDate.getMonth()]},parseFunction:function(r,n){let o,l,h,d;for(o=0;o<this.dateFormat.symbols.months.length;o++)if(l=this.dateFormat.symbols.months[o],!!l&&(h=new RegExp("^("+y.quote(l)+")(.*)$","i"),d=h.exec(r.inputString),d))return r.dateInfo.month=o,r.matchInfo.month=d[1],r.inputString=d[2],d[1];if(r.analyze){for(o=0;o<this.dateFormat.symbols.months.length;o++)if(l=this.dateFormat.symbols.months[o],h=new RegExp("^("+y.quote(r.inputString)+")(.*)$","i"),d=h.exec(l),d)return r.dateInfo.month=o,r.matchInfo.month=l,r.inputString="",d[1]}return null}}),new je({type:Ye.MONTH,terms:["MMM"],dateFormat:this,formatFunction:function(r,n){return this.dateFormat.symbols.monthsShort[r.inputDate.getMonth()]},parseFunction:function(r,n){let o,l,h,d;for(o=0;o<this.dateFormat.symbols.monthsShort.length;o++)if(l=this.dateFormat.symbols.monthsShort[o],!!l&&(h=new RegExp("^("+y.quote(l)+")(.*)$","i"),d=h.exec(r.inputString),d))return r.dateInfo.month=o,r.matchInfo.month=d[1],r.inputString=d[2],d[1];if(r.analyze){for(o=0;o<this.dateFormat.symbols.monthsShort.length;o++)if(l=this.dateFormat.symbols.monthsShort[o],h=new RegExp("^("+y.quote(r.inputString)+")(.*)$","i"),d=h.exec(l),d)return r.dateInfo.month=o,r.matchInfo.month=l,r.inputString="",d[1]}return null}}),new je({type:Ye.MONTH,terms:["MM"],dateFormat:this,formatFunction:(r,n)=>y.padZeroLeft(r.inputDate.getMonth()+1,2),parseRegExp:/^(\d{2})(.*)$/,applyMatchFunction:(r,n,o)=>{let l=Number(n);r.dateInfo.month=l-1,r.matchInfo.month=n},parseFunction:function(r,n){if(r.analyze&&r.inputString==="0"){let o=this.dateFormat._dateInfoToDate(r.dateInfo);if(!o)return null;let l=o.getMonth();return l>=9&&(l=0,r.dateInfo.year===void 0?r.dateInfo.year=Number(o.getFullYear())+1:r.dateInfo.year=r.dateInfo.year+1),r.dateInfo.month=l,r.matchInfo.month=y.padZeroLeft(String(l+1),2),r.inputString="","0"}return null}}),new je({type:Ye.MONTH,terms:["M"],dateFormat:this,formatFunction:(r,n)=>String(r.inputDate.getMonth()+1),parseRegExp:/^(\d{1,2})(.*)$/,applyMatchFunction:(r,n,o)=>{let l=Number(n);r.dateInfo.month=l-1,r.matchInfo.month=n}}),new je({type:Ye.WEEK_IN_YEAR,terms:["ww"],dateFormat:this,formatFunction:(r,n)=>y.padZeroLeft(w.weekInYear(r.inputDate),2),parseRegExp:/^(\d{2})(.*)$/,applyMatchFunction:(r,n,o)=>{r.matchInfo.week=n,r.hints.weekInYear=Number(n)}}),new je({type:Ye.WEEK_IN_YEAR,terms:["w"],dateFormat:this,formatFunction:(r,n)=>String(w.weekInYear(r.inputDate)),parseRegExp:/^(\d{1,2})(.*)$/,applyMatchFunction:(r,n,o)=>{r.matchInfo.week=n,r.hints.weekInYear=Number(n)}}),new je({type:Ye.DAY_IN_MONTH,terms:["dd"],dateFormat:this,formatFunction:(r,n)=>y.padZeroLeft(r.inputDate.getDate(),2),parseRegExp:/^(\d{2})(.*)$/,applyMatchFunction:(r,n,o)=>{r.dateInfo.day=Number(n),r.matchInfo.day=n},parseFunction:(r,n)=>r.analyze&&r.inputString==="0"?(r.dateInfo.day=1,r.matchInfo.day="01",r.inputString="","0"):null}),new je({type:Ye.DAY_IN_MONTH,terms:["d"],dateFormat:this,formatFunction:(r,n)=>String(r.inputDate.getDate()),parseRegExp:/^(\d{1,2})(.*)$/,applyMatchFunction:(r,n,o)=>{r.dateInfo.day=Number(n),r.matchInfo.day=n}}),new je({type:Ye.WEEKDAY,terms:["EEEE"],dateFormat:this,formatFunction:function(r,n){return this.dateFormat.symbols.weekdays[r.inputDate.getDay()]},parseFunction:function(r,n){let o,l,h,d;for(o=0;o<this.dateFormat.symbols.weekdays.length;o++)if(l=this.dateFormat.symbols.weekdays[o],!!l&&(h=new RegExp("^("+y.quote(l)+")(.*)$","i"),d=h.exec(r.inputString),d))return r.matchInfo.weekday=d[1],r.hints.weekday=o,r.inputString=d[2],d[1];if(r.analyze){for(o=0;o<this.dateFormat.symbols.weekdays.length;o++)if(l=this.dateFormat.symbols.weekdays[o],h=new RegExp("^("+y.quote(r.inputString)+")(.*)$","i"),d=h.exec(l),d)return r.matchInfo.weekday=l,r.hints.weekday=o,r.inputString="",d[1]}return null}}),new je({type:Ye.WEEKDAY,terms:["EEE","EE","E"],dateFormat:this,formatFunction:function(r,n){return this.dateFormat.symbols.weekdaysShort[r.inputDate.getDay()]},parseFunction:function(r,n){let o,l,h,d;for(o=0;o<this.dateFormat.symbols.weekdaysShort.length;o++)if(l=this.dateFormat.symbols.weekdaysShort[o],!!l&&(h=new RegExp("^("+y.quote(l)+")(.*)$","i"),d=h.exec(r.inputString),d))return r.matchInfo.weekday=d[1],r.hints.weekday=o,r.inputString=d[2],d[1];if(r.analyze){for(o=0;o<this.dateFormat.symbols.weekdaysShort.length;o++)if(l=this.dateFormat.symbols.weekdaysShort[o],h=new RegExp("^("+y.quote(r.inputString)+")(.*)$","i"),d=h.exec(l),d)return r.matchInfo.weekday=l,r.hints.weekday=o,r.inputString="",d[1]}return null}}),new je({type:Ye.HOUR_24,terms:["HH"],dateFormat:this,formatFunction:(r,n)=>y.padZeroLeft(r.inputDate.getHours(),2),parseRegExp:/^(\d{2})(.*)$/,applyMatchFunction:(r,n,o)=>{r.dateInfo.hours=Number(n),r.matchInfo.hours=n}}),new je({type:Ye.HOUR_24,terms:["H"],dateFormat:this,formatFunction:(r,n)=>String(r.inputDate.getHours()),parseRegExp:/^(\d{1,2})(.*)$/,applyMatchFunction:(r,n,o)=>{r.dateInfo.hours=Number(n),r.matchInfo.hours=n}}),new je({type:Ye.HOUR_12,terms:["hh"],dateFormat:this,formatFunction:(r,n)=>r.inputDate.getHours()%12===0?"12":y.padZeroLeft(r.inputDate.getHours()%12,2),parseRegExp:/^(10|11|12|0[1-9])(.*)$/,applyMatchFunction:(r,n,o)=>{r.dateInfo.hours=Number(n)+(r.hints.pm?12:0),r.matchInfo.hours=n},parseFunction:(r,n)=>r.analyze&&r.inputString==="0"?(r.dateInfo.hours=1,r.matchInfo.hours="01",r.inputString="",r.inputString):null}),new je({type:Ye.HOUR_12,terms:["h"],dateFormat:this,formatFunction:(r,n)=>r.inputDate.getHours()%12===0?"12":String(r.inputDate.getHours()%12),parseRegExp:/^(10|11|12|0?[1-9])(.*)$/,applyMatchFunction:(r,n,o)=>{r.dateInfo.hours=Number(n)+(r.hints.pm?12:0),r.matchInfo.hours=n}}),new je({type:Ye.AM_PM,terms:["a"],dateFormat:this,formatFunction:function(r,n){return r.inputDate.getHours()<12?this.dateFormat.symbols.am:this.dateFormat.symbols.pm},parseFunction:function(r,n){let o=new RegExp("^("+y.quote(this.dateFormat.symbols.am)+")(.*)$","i"),l=o.exec(r.inputString);if(r.matchInfo.ampm=null,l)return r.matchInfo.ampm=l[1],r.inputString=l[2],r.hints.am=!0,r.dateInfo.hours=r.dateInfo.hours%12,l[1];if(o=new RegExp("^("+y.quote(this.dateFormat.symbols.pm)+")(.*)$","i"),l=o.exec(r.inputString),l)return r.matchInfo.ampm=l[1],r.inputString=l[2],r.hints.pm=!0,r.dateInfo.hours=r.dateInfo.hours%12+12,l[1];if(r.analyze){if(o=new RegExp("^("+y.quote(r.inputString)+")(.*)$","i"),l=o.exec(this.dateFormat.symbols.am),l)return r.matchInfo.ampm=this.dateFormat.symbols.am,r.inputString="",r.hints.am=!0,r.dateInfo.hours=r.dateInfo.hours%12,l[1];if(l=o.exec(this.dateFormat.symbols.pm),l)return r.matchInfo.ampm=this.dateFormat.symbols.pm,r.inputString="",r.hints.pm=!0,r.dateInfo.hours=r.dateInfo.hours%12+12,l[1]}return null}}),new je({type:Ye.MINUTE,terms:["mm"],dateFormat:this,formatFunction:(r,n)=>y.padZeroLeft(r.inputDate.getMinutes(),2),parseRegExp:/^(\d{2})(.*)$/,applyMatchFunction:(r,n,o)=>{r.dateInfo.minutes=Number(n),r.matchInfo.minutes=n},parseFunction:(r,n)=>{if(r.analyze&&u.isOneOf(r.inputString,"0","1","2","3","4","5")){let o=r.inputString+"0";return r.dateInfo.minutes=Number(o),r.matchInfo.minutes=o,r.inputString="",r.inputString}return null}}),new je({type:Ye.MINUTE,terms:["m"],dateFormat:this,formatFunction:(r,n)=>String(r.inputDate.getMinutes()),parseRegExp:/^(\d{1,2})(.*)$/,applyMatchFunction:(r,n,o)=>{r.dateInfo.minutes=Number(n),r.matchInfo.minutes=n}}),new je({type:Ye.SECOND,terms:["ss"],dateFormat:this,formatFunction:(r,n)=>y.padZeroLeft(r.inputDate.getSeconds(),2),parseRegExp:/^(\d{2})(.*)$/,applyMatchFunction:(r,n,o)=>{r.dateInfo.seconds=Number(n),r.matchInfo.seconds=n}}),new je({type:Ye.SECOND,terms:["s"],dateFormat:this,formatFunction:(r,n)=>String(r.inputDate.getSeconds()),parseRegExp:/^(\d{1,2})(.*)$/,applyMatchFunction:(r,n,o)=>{r.dateInfo.seconds=Number(n),r.matchInfo.seconds=n}}),new je({type:Ye.MILLISECOND,terms:["SSS"],dateFormat:this,formatFunction:(r,n)=>y.padZeroLeft(r.inputDate.getMilliseconds(),3),parseRegExp:/^(\d{3})(.*)$/,applyMatchFunction:(r,n,o)=>{r.dateInfo.milliseconds=Number(n),r.matchInfo.milliseconds=n}}),new je({type:Ye.MILLISECOND,terms:["S"],dateFormat:this,formatFunction:(r,n)=>String(r.inputDate.getMilliseconds()),parseRegExp:/^(\d{1,3})(.*)$/,applyMatchFunction:(r,n,o)=>{r.dateInfo.milliseconds=Number(n),r.matchInfo.milliseconds=n}}),new je({type:Ye.TIMEZONE,terms:["Z"],dateFormat:this,formatFunction:(r,n)=>{let o=Math.abs(r.inputDate.getTimezoneOffset());return(o!==r.inputDate.getTimezoneOffset()?"-":"+")+y.padZeroLeft(Math.floor(o/60),2)+y.padZeroLeft(o%60,2)},parseRegExp:/^([+|-]\d{4})(.*)$/,applyMatchFunction:(r,n,o)=>{let l=Number(n.substr(1,2))*60+Number(n.substr(3,2));n.charAt(0)==="-"&&(l*=-1),r.dateInfo.timezone=l,r.matchInfo.timezone=n}})],this._patternLibrary={};for(let r=0;r<this._patternDefinitions.length;r++){let n=this._patternDefinitions[r],o=n.type;o&&(this._patternLibrary[o]||(this._patternLibrary[o]=[]),this._patternLibrary[o].push(n))}this._compile()}_compile(){let e,t,s,r,n,o,l,h,d;for(n=/(.)\1*/g;o=n.exec(this.pattern);){for(l=o[0],this._terms.push(l),h=!1,e=0;e<this._patternDefinitions.length;e++){r=this._patternDefinitions[e];let c=r.accept(l);if(c){if(this._formatFunctions.push(r.createFormatFunction(c)),this._parseFunctions.push(r.createParseFunction(c)),d=[r.createParseFunction(c)],this.lenient)for(s=this._patternLibrary[r.type],t=0;t<s.length;t++)s[t]!==r&&d.push(s[t].createParseFunction(c));this._analyzeFunctions.push(d),h=!0;break}}if(!h){this._formatFunctions.push(this._createConstantStringFormatFunction(l));let c=this._createConstantStringParseFunction(l);this._parseFunctions.push(c),this._analyzeFunctions.push([c])}}}_createConstantStringFormatFunction(e){return t=>{t.formattedString+=e}}_createConstantStringParseFunction(e){return t=>y.startsWith(t.inputString,e)?(t.inputString=t.inputString.substr(e.length),t.parsedPattern+=e,!0):t.analyze}format(e,t){if(!e)return"";let s=this._createFormatContext(e);s.exactLength=u.nvl(t,!1);for(let r=0;r<this._formatFunctions.length;r++){let n=this._formatFunctions[r];n(s)}return s.formattedString}analyze(e,t){let s=this._createAnalyzeInfo(e);if(!e)return s;let r=this._createParseContext(e);r.analyze=!0,r.startDate=t;let n="";for(let d=0;d<this._terms.length;d++)if(r.inputString.length>0){let c=this._analyzeFunctions[d],f=!1;for(let m=0;m<c.length;m++){let _=c[m];if(_(r)){f=!0;break}}if(!f)return s.error=!0,s;n=r.parsedPattern}else r.parsedPattern+=this._terms[d];if(r.inputString.length>0)return s.error=!0,s;t=this._prepareStartDate(t);let o=r.hints.weekday,l=r.dateInfo.day;o!==void 0&&(l!==void 0&&l<=31?t=w.shiftToNextDayAndDate(t,o,l):t=w.shiftToNextDayOfType(t,o));let h=this._dateInfoToDate(r.dateInfo,t,r.hints);return s.dateInfo=r.dateInfo,s.matchInfo=r.matchInfo,s.hints=r.hints,s.parsedPattern=r.parsedPattern,s.matchedPattern=n,s.predictedDate=h,s.error=!h,s}parse(e,t){if(!e)return null;let s=this._createParseContext(e);s.startDate=t;for(let n=0;n<this._parseFunctions.length;n++){let o=this._parseFunctions[n];if(!o(s))return null;if(s.inputString.length===0)break}if(s.inputString.length>0)return null;let r=this._dateInfoToDate(s.dateInfo,t);return!r||s.hints.weekday!==void 0&&r.getDay()!==s.hints.weekday?null:r}_dateInfoToDate(e,t,s){if(!e)return null;t=this._prepareStartDate(t);let r=new Date(1970,0,1),n=u.nvl(e.day,t.getDate()),o=u.nvl(e.month,t.getMonth()),l=u.nvl(e.year,t.getFullYear());if(e.day&&!e.month)if(e.day===31){let d=[0,2,4,6,7,9,11];u.isOneOf(o,d)||(o=o+1)}else e.day>=29&&o===1&&(e.day>29||!w.isLeapYear(l))&&(o=o+1);if(!e.day&&e.month){let d=w.shift(new Date(l,e.month+1,1),0,0,-1);n=Math.min(d.getDate(),t.getDate())}if(r.setFullYear(l,o,n),r.setHours(u.nvl(e.hours,t.getHours()),u.nvl(e.minutes,t.getMinutes()),u.nvl(e.seconds,t.getSeconds()),u.nvl(e.milliseconds,t.getMilliseconds())),!h(r.getFullYear(),e.year)||!h(r.getMonth(),e.month)||!h(r.getDate(),e.day)||!h(r.getHours(),e.hours)||!h(r.getMinutes(),e.minutes)||!h(r.getSeconds(),e.seconds)||!h(r.getMilliseconds(),e.milliseconds)||!h(r.getDay(),s==null?void 0:s.weekday))return null;return Ke.isNumber(e.timezone)&&r.setMinutes(r.getMinutes()-r.getTimezoneOffset()+e.timezone),r;function h(d,c){return b.isNullOrUndefined(c)||c===d}}_prepareStartDate(e){return e?new Date(e.getTime()):w.trunc(new Date)}_createFormatContext(e){return{inputDate:e,formattedString:"",exactLength:!1}}_createParseContext(e){return{inputString:e,dateInfo:{},matchInfo:{},hints:{},parsedPattern:"",analyze:!1,startDate:null}}_createAnalyzeInfo(e){return{inputString:e,dateInfo:{},matchInfo:{},hints:{},parsedPattern:"",matchedPattern:"",predictedDate:null,error:!1}}static ensure(e,t){return!t||t instanceof xt?t:new xt(e,t)}}function ri(i,e,t){return e=ZT(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ZT(i){var e=eC(i,"string");return typeof e=="symbol"?e:String(e)}function eC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ls{constructor(e,t){ri(this,"positivePrefix",void 0),ri(this,"positiveSuffix",void 0),ri(this,"negativePrefix",void 0),ri(this,"negativeSuffix",void 0),ri(this,"groupingChar",void 0),ri(this,"lenientGroupingChars",void 0),ri(this,"groupLength",void 0),ri(this,"decimalSeparatorChar",void 0),ri(this,"zeroBefore",void 0),ri(this,"zeroAfter",void 0),ri(this,"allAfter",void 0),ri(this,"pattern",void 0),ri(this,"multiplier",void 0),ri(this,"roundingMode",void 0),this.positivePrefix="",this.positiveSuffix="",this.negativePrefix=e.decimalFormatSymbols.minusSign,this.negativeSuffix="",this.groupingChar=e.decimalFormatSymbols.groupingSeparator,this.lenientGroupingChars="'` ",this.groupLength=0,this.decimalSeparatorChar=e.decimalFormatSymbols.decimalSeparator,this.zeroBefore=1,this.zeroAfter=0,this.allAfter=0,typeof t=="string"?(this.pattern=t,this.multiplier=1,this.roundingMode=ns.HALF_UP):(t=t||{pattern:null},this.pattern=this.pattern||t.pattern||e.decimalFormatPatternDefault,this.multiplier=t.multiplier||1,this.roundingMode=t.roundingMode||ns.HALF_UP);let s=Ls.PATTERN_SYMBOLS,r=this.pattern.split(s.patternSeparator),n=h(r[0]);if(this.positivePrefix=n.prefix,this.positiveSuffix=n.suffix,r.length>1){let d=h(r[1]);this.negativePrefix=d.prefix,this.negativeSuffix=d.suffix,this.pattern=r[0]}else this.positivePrefix.indexOf(s.minusSign)!==-1||this.positiveSuffix.indexOf(s.minusSign)!==-1?(this.negativePrefix=this.positivePrefix.replace(s.minusSign,e.decimalFormatSymbols.minusSign),this.negativeSuffix=this.positiveSuffix.replace(s.minusSign,e.decimalFormatSymbols.minusSign),this.positivePrefix=this.positivePrefix.replace(s.minusSign,""),this.positiveSuffix=this.positiveSuffix.replace(s.minusSign,"")):(this.negativePrefix=this.positivePrefix+this.negativePrefix,this.negativeSuffix=this.negativeSuffix+this.positiveSuffix);let o=this.pattern.indexOf(s.decimalSeparator);o===-1&&(o=this.pattern.length);let l=this.pattern.lastIndexOf(s.groupingSeparator,o);l>0&&(this.groupLength=o-l-1),this.pattern=this.pattern.replace(new RegExp("["+s.groupingSeparator+"]","g"),""),r=this.pattern.split(s.decimalSeparator),this.zeroBefore=y.count(r[0],s.zeroDigit),r.length>1&&(this.zeroAfter=y.count(r[1],s.zeroDigit),this.allAfter=this.zeroAfter+y.count(r[1],s.digit));function h(d){let c={prefix:"",suffix:""},f=s.digit+s.zeroDigit+s.decimalSeparator+s.groupingSeparator,m=new RegExp("^(.*?)["+f+"].*$"),_=m.exec(d);return _!==null&&(c.prefix=_[1].replace(new RegExp("'([^']+)'","g"),"$1")),m=new RegExp("^.*["+f+"](.*?)$"),_=m.exec(d),_!==null&&(c.suffix=_[1].replace(new RegExp("'([^']+)'","g"),"$1")),c}}parse(e,t){if(y.empty(e))return null;let s=this.normalize(e);t=t||Number;let r=t(s);if(isNaN(r))throw new Error(e+" is not a number (NaN)");return this.multiplier!==1&&(r/=this.multiplier),r}format(e,t){if(e==null)return null;let s=this.positivePrefix,r=this.positiveSuffix;t=u.nvl(t,!0),t&&this.multiplier!==1&&(e*=this.multiplier),e=this.round(e);let n="";if(this.allAfter){n=e.toFixed(this.allAfter).split(".")[1];for(let h=n.length-1;h>this.zeroAfter-1&&n[h]==="0";h--)n=n.slice(0,-1);n&&(n=this.decimalSeparatorChar+n)}e<0&&(s=this.negativePrefix,r=this.negativeSuffix,e=-e);let o=Math.floor(e),l=o===0?"":String(o);if(l=y.padZeroLeft(l,this.zeroBefore),this.groupLength)for(let h=l.length-this.groupLength;h>0;h-=this.groupLength)l=l.substr(0,h)+this.groupingChar+l.substr(h);return s+l+n+r}round(e,t){return t=u.nvl(t,!0),e==null?null:(t&&this.multiplier!==1&&(e*=this.multiplier),e=Ke.round(e,this.roundingMode,this.allAfter),t&&this.multiplier!==1&&(e/=this.multiplier),e)}normalize(e){return e&&e.replace(new RegExp("["+this.groupingChar+this.lenientGroupingChars+"]","g"),"").replace(new RegExp("["+this.decimalSeparatorChar+"]","g"),".").replace(/\s/g,"")}static ensure(e,t){return!t||t instanceof Ls?t:new Ls(e,t)}}ri(Ls,"PATTERN_SYMBOLS",{digit:"#",zeroDigit:"0",decimalSeparator:".",groupingSeparator:",",minusSign:"-",patternSeparator:";"});function Td(i,e,t){return e=tC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function tC(i){var e=iC(i,"string");return typeof e=="symbol"?e:String(e)}function iC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Os{constructor(e){Td(this,"map",void 0),Td(this,"parent",void 0),this.map=e||{}}get(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];if(!this._exists(e))return this.parent?this.parent.get(e,...s):"[undefined text: "+e+"]";let n=s.length,o=this.map[e];if(n===0)return o;for(let l=0;l<n;l++)o=o.replace(new RegExp("\\{"+l+"\\}","g"),s[l]);return o}optGet(e,t){for(var s=arguments.length,r=new Array(s>2?s-2:0),n=2;n<s;n++)r[n-2]=arguments[n];return this._exists(e)?this.get(e,...r):this.parent?this.parent.optGet(e,t,...r):t}exists(e){return this._exists(e)?!0:this.parent?this.parent.exists(e):!1}_exists(e){return this.map.hasOwnProperty(e)}add(e,t){this.map[e]=t}addAll(e){!e||(e instanceof Os&&(e=e.map),b.copyOwnProperties(e,this.map))}setParent(e){this.parent=e}remove(e){delete this.map[e]}}Td(Os,"TEXT_KEY_REGEX",/\${textKey:([a-zA-Z0-9.]*)}/);const Ce={TEXT_KEY_REGEX:/\${textKey:([^}]*)}/,textsByLocale:{},bootstrap(i){if(!i)return a().resolvedPromise({});let e=[];return p.ensure(i).forEach(s=>e.push(a().ajaxJson(s).then(Ce._preInit.bind(this,s)))),a().promiseAll(e)},_setTextsByLocale(i){Ce.textsByLocale=i},_preInit(i,e){if(e&&e.error)throw{error:e.error,url:i};Ce.init(e)},init(i){Object.keys(i).forEach(e=>Ce.get(e).addAll(i[e]),this)},link(i){let e=Ce.createOrderedLanguageTags(i),t;e.forEach(s=>{let r=Ce._get(s);r||(r=new Os,Ce.put(s,r)),t&&t.setParent(r),t=r},this)},createOrderedLanguageTags(i){let e=[],t=i.lastIndexOf("-");for(e.push(i);t>=0;)i=i.substring(0,t),e.push(i),t=i.lastIndexOf("-");return i!=="default"&&e.push("default"),e},get(i){let e=Ce._get(i);if(e)return e;if(Ce.link(i),e=Ce._get(i),!e)throw new Error("Texts missing for the language tag "+i);return e},_get(i){return Ce.textsByLocale[i]},put(i,e){Ce.textsByLocale[i]=e},readFromDOM(){let i={};return a()("scout-text").each(function(){let e=a()(this).data("key"),t=a()(this).data("value");i[e]=t}),i},buildKey(i){return"${textKey:"+i+"}"},resolveKey(i){let e=Ce.TEXT_KEY_REGEX.exec(i);return e&&e.length===2?e[1]:i},resolveText(i,e){let t=Ce.resolveKey(i);return t!==i?Ce.get(e).get(t):i},resolveTextProperty(i,e,t){e=e||"text",t=i.session||t;let s=i[e],r=Ce.resolveText(s,t.locale.languageTag);r!==s&&(i[e]=r)}};function st(i,e,t){return e=sC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function sC(i){var e=rC(i,"string");return typeof e=="symbol"?e:String(e)}function rC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ls extends I{constructor(){super(),st(this,"text",void 0),st(this,"severity",void 0),st(this,"arrowPosition",void 0),st(this,"arrowPositionUnit",void 0),st(this,"windowPaddingX",void 0),st(this,"windowPaddingY",void 0),st(this,"origin",void 0),st(this,"originRelativeToParent",void 0),st(this,"autoRemove",void 0),st(this,"tooltipPosition",void 0),st(this,"tooltipDirection",void 0),st(this,"scrollType",void 0),st(this,"htmlEnabled",void 0),st(this,"dialog",void 0),st(this,"menus",void 0),st(this,"$anchor",void 0),st(this,"$arrow",void 0),st(this,"$content",void 0),st(this,"$menus",void 0),st(this,"_openLater",void 0),st(this,"_mouseDownHandler",void 0),st(this,"_keydownHandler",void 0),st(this,"_anchorScrollHandler",void 0),st(this,"_moveHandler",void 0),this.text=null,this.severity=E.Severity.INFO,this.arrowPosition=16,this.arrowPositionUnit="px",this.windowPaddingX=10,this.windowPaddingY=5,this.origin=null,this.originRelativeToParent=!1,this.autoRemove=!0,this.tooltipPosition="top",this.tooltipDirection="right",this.scrollType="position",this.htmlEnabled=!1,this.menus=[],this.$anchor=null,this.$arrow=null,this.$content=null,this._addWidgetProperties(["menus"]),this._openLater=!1}render(e){let t=e||this.entryPoint();if(!t||!t.length||!t.isAttached()){this._openLater=!0,this.$parent=t;return}super.render(t)}_render(){this.$container=this.$parent.appendDiv("tooltip").data("tooltip",this),this.findDesktop().adjustOverlayOrder(this),this.cssClass&&this.$container.addClass(this.cssClass),this.$arrow=this.$container.appendDiv("tooltip-arrow"),this.$content=this.$container.appendDiv("tooltip-content"),this._renderText(),this._renderSeverity(),this._renderMenus(),this.autoRemove&&(this._mouseDownHandler=this._onDocumentMouseDown.bind(this),this.$container.document(!0).addEventListener("mousedown",this._mouseDownHandler,!0),this._keydownHandler=this._onDocumentKeyDown.bind(this),this.$container.document().on("keydown",this._keydownHandler)),this.$anchor&&this.scrollType&&(this._anchorScrollHandler=this._onAnchorScroll.bind(this),P.onScroll(this.$anchor,this._anchorScrollHandler)),this.dialog=this.findParent(e=>e instanceof U&&e.isDialog()),this.dialog&&(this._moveHandler=this.position.bind(this),this.dialog.on("move",this._moveHandler))}_postRender(){super._postRender(),this.position()}_remove(){this._mouseDownHandler&&(this.$container.document(!0).removeEventListener("mousedown",this._mouseDownHandler,!0),this._mouseDownHandler=null),this._keydownHandler&&(this.$container.document().off("keydown",this._keydownHandler),this._keydownHandler=null),this._anchorScrollHandler&&(P.offScroll(this._anchorScrollHandler),this._anchorScrollHandler=null),this._moveHandler&&(this.dialog&&this.dialog.off("move",this._moveHandler),this._moveHandler=null),this.dialog=null,this.$menus=null,super._remove()}_destroy(){super._destroy(),this.menus.forEach(e=>{e.popup&&e.popup.close()})}_onAttach(){super._onAttach(),this._openLater&&!this.rendered&&(this._openLater=!1,this.render())}_renderOnDetach(){this._openLater=!0,this.remove(),super._onDetach()}_isRemovalPrevented(){return this.removalPending}setText(e){this.setProperty("text",e)}setSeverity(e){this.setProperty("severity",e)}_renderText(){let e=this.text||"";this.htmlEnabled?this.$content.html(e):this.$content.html(y.nl2br(e)),this.$content.setVisible(!!e),this.$container.toggleClass("no-text",!e),this.rendering||this.position()}_renderSeverity(){this.$container.removeClass(E.SEVERITY_CSS_CLASSES),this.$container.addClass(E.cssClassForSeverity(this.severity))}setMenus(e){e=p.ensure(e),this.setProperty("menus",e)}_renderMenus(){let e=0,t=this.menus;t.length>0&&!this.$menus?this.$menus=this.$container.appendDiv("tooltip-menus"):t.length===0&&this.$menus&&(this.$menus.remove(),this.$menus=null),t.forEach(s=>{let r=0;s.render(this.$menus),s.iconId&&(r=s.get$Icon().outerWidth(!0),e=Math.max(r,e))}),e>0&&t.forEach(s=>{s.iconId?s.$text.cssPaddingLeft(e-s.get$Icon().outerWidth(!0)):s.$text.cssPaddingLeft(e)}),this.$container.toggleClass("has-menus",t.length>0),this.rendering||(this.$container.cssLeft("").cssTop(""),this.position())}position(){let e,t,s,r,n,o,l,h,d,c,f,m,_;if(this.origin?(d=this.origin,l=d.x):(d=v.offsetBounds(this.$anchor),l=d.x+d.width/2),h=d.y,this.$anchor&&(_=P.isLocationInView(d,this.$anchor.scrollParent()),this.$container.setVisible(_)),!this.originRelativeToParent){let C=this.$parent.offset();l-=C.left,h-=C.top}s=7,r=4,f=this.$container.outerHeight(),c=this.$container.outerWidth(),m=this.arrowPosition,this.arrowPositionUnit==="%"&&(m=c*this.arrowPosition/100),this.tooltipDirection==="left"&&(m=c-m),e=h-f-r,t=l-m,n=t+c+this.windowPaddingX-this.$parent.width(),o=e-this.windowPaddingY,n>0&&(t-=n,m=l-t),t<this.windowPaddingX&&(t=this.windowPaddingX,m=l-this.windowPaddingX),this.$arrow.removeClass("arrow-top arrow-bottom"),this.tooltipPosition==="bottom"||o<0?(this.$arrow.addClass("arrow-top"),e=h+d.height+r):this.$arrow.addClass("arrow-bottom"),m=Math.min(m,this.$container.outerWidth()-s),m=Math.max(m,s),this.$arrow.cssLeft(m-this.$arrow.cssBorderLeftWidth()),this.$container.cssLeft(t).cssTop(e),this.menus.forEach(C=>{C.popup&&C.popup.position()},this)}_onAnchorScroll(e){!this.rendered||(this.scrollType==="position"?this.position():this.scrollType==="remove"&&this.destroy())}_onDocumentMouseDown(e){if(!this.rendered)return!1;this._isMouseDownOutside(e)&&this._onMouseDownOutside(e)}_isMouseDownOutside(e){let t=e.target,s=a()(t),r=u.widget(s);return!this.isOrHas(r)&&this.$anchor&&!this.$anchor.isOrHas(s[0])&&!this.session.focusManager.isElementCovertByGlassPane(this.$container[0])}_onMouseDownOutside(e){this.destroy()}_onDocumentKeyDown(e){u.isOneOf(e.which,g.CTRL,g.SHIFT,g.ALT,g.NUM_LOCK,g.CAPS_LOCK,g.SCROLL_LOCK,g.WIN_LEFT,g.WIN_RIGHT,g.SELECT,g.PAUSE,g.PRINT_SCREEN)||this.destroy()}}function Zo(i,e,t){return e=nC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function nC(i){var e=oC(i,"string");return typeof e=="symbol"?e:String(e)}function oC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class la{constructor(e){Zo(this,"_options",void 0),Zo(this,"_mouseEnterHandler",void 0),Zo(this,"_mouseLeaveHandler",void 0),Zo(this,"_tooltip",void 0),Zo(this,"_tooltipTimeoutId",void 0);let t={selector:null,delay:K.DEFAULT_TOOLTIP_DELAY,text:void 0,nativeTooltip:!1};e=a().extend({},t,e),this._options=e,this._mouseEnterHandler=this._onMouseEnter.bind(this),this._mouseLeaveHandler=this._onMouseLeave.bind(this),this._tooltip=null,this._tooltipTimeoutId=null}install(e){e.data("tooltipSupport")||e.on("mouseenter",this._options.selector,this._mouseEnterHandler).on("mouseleave",this._options.selector,this._mouseLeaveHandler).data("tooltipSupport",this)}uninstall(e){e.removeData("tooltipSupport").off("mouseleave",this._options.selector,this._mouseLeaveHandler).off("mouseenter",this._options.selector,this._mouseEnterHandler),this._destroyTooltip()}update(e,t){a().extend(this._options,t),this._tooltip&&this._showTooltip(e)}cancel(e){clearTimeout(this._tooltipTimeoutId)}close(){this._destroyTooltip()}_onMouseEnter(e){let t=a()(e.currentTarget);if(this._options.nativeTooltip){let s=this._text(t);t.attr("title",s)}else clearTimeout(this._tooltipTimeoutId),this._tooltipTimeoutId=setTimeout(this._showTooltip.bind(this,t),this._options.delay)}_onMouseLeave(e){this._destroyTooltip()}_destroyTooltip(){clearTimeout(this._tooltipTimeoutId),this._tooltip&&(this._tooltip.destroy(),this._tooltip=null)}_text(e){let t=this._options.text||e.data("tooltipText");return a().isFunction(t)&&(t=t(e)),t}_htmlEnabled(e){let t=this._options.htmlEnabled||e.data("htmlEnabled");return a().isFunction(t)&&(t=t(e)),u.nvl(t,!1)}_showTooltip(e){if(!e||!e.isAttached())return;let t=this._text(e);if(!t)return;let s=this._htmlEnabled(e);if(this._tooltip&&this._tooltip.rendered)this._tooltip.setText(t),this._tooltip.setSeverity(this._options.severity),this._tooltip.setMenus(this._options.menus);else{let r=a().extend({},this._options,{$anchor:this._options.$anchor||e,text:t,htmlEnabled:s});this._tooltip=u.create(ls,r),this._tooltip.render()}}}const K={DEFAULT_TOOLTIP_DELAY:600,LONG_TOOLTIP_DELAY:1e3,install(i,e){let t=i.data("tooltipSupport");t?t.update(i,e):(t=new la(e),t.install(i))},uninstall(i){let e=i.data("tooltipSupport");e&&e.uninstall(i)},update(i,e){let t=i.data("tooltipSupport");t&&t.update(i,e)},close(i){let e=i.data("tooltipSupport");e&&e.close()},cancel(i){let e=i.data("tooltipSupport");e&&e.cancel(i)},installForEllipsis(i,e){let t={text:s=>{if(s.isContentTruncated())return s.text()},nativeTooltip:!x.get().isCustomEllipsisTooltipPossible()};e=a().extend({},t,e),K.install(i,e)},find(i){let e,t,s,r=[];for(e=a()(".tooltip",i.document(!0)),t=0;t<e.length;t++)s=e.eq(t).data("tooltip"),i.has(s.$anchor).length>0&&r.push(s);return r}};function Zn(i,e,t){return e=lC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function lC(i){var e=aC(i,"string");return typeof e=="symbol"?e:String(e)}function aC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Am extends ls{constructor(){super(),Zn(this,"keyStrokeStopPropagationInterceptor",void 0),Zn(this,"withFocusContext",void 0),Zn(this,"initialFocus",void 0),Zn(this,"focusableContainer",void 0),Zn(this,"content",void 0),Zn(this,"$widgetContainer",void 0),this.$widgetContainer=null,this.content=null,this._addWidgetProperties(["content"]),this.keyStrokeStopPropagationInterceptor=e=>{u.isOneOf(e.which,g.ESC,g.ENTER)||e.stopPropagation()},this.withFocusContext=!0,this.initialFocus=()=>Mt.AUTO,this.focusableContainer=!1}_createKeyStrokeContext(){return new Oe}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeStopPropagationInterceptor&&this.keyStrokeContext.registerStopPropagationInterceptor(this.keyStrokeStopPropagationInterceptor)}_render(){super._render(),this.$container.addClass("widget-tooltip"),this.$widgetContainer=this.$container.appendDiv("tooltip-widget-container")}_renderProperties(){super._renderProperties(),this._renderContent()}_remove(){this._removeContent(),super._remove()}setContent(e){this.setProperty("content",e)}_renderContent(){this.content&&(this.content.render(this.$widgetContainer),this.content.$container.addClass("widget"),this.content.pack()),this.$widgetContainer.setVisible(!!this.content),this.rendering||this.position(),this.withFocusContext&&this.content&&this.session.focusManager.installFocusContext(this.$widgetContainer,this.initialFocus())}_removeContent(){this.content&&(this.session.focusManager.uninstallFocusContext(this.$widgetContainer),this.content.remove())}}function Xe(i,e,t){return e=hC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function hC(i){var e=dC(i,"string");return typeof e=="symbol"?e:String(e)}function dC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class re extends I{constructor(){super(),Xe(this,"actionStyle",void 0),Xe(this,"compact",void 0),Xe(this,"compactOrig",void 0),Xe(this,"iconId",void 0),Xe(this,"horizontalAlignment",void 0),Xe(this,"keyStroke",void 0),Xe(this,"keyStrokeFirePolicy",void 0),Xe(this,"selected",void 0),Xe(this,"preventDoubleClick",void 0),Xe(this,"tabbable",void 0),Xe(this,"actionKeyStroke",void 0),Xe(this,"text",void 0),Xe(this,"textPosition",void 0),Xe(this,"htmlEnabled",void 0),Xe(this,"textVisible",void 0),Xe(this,"textVisibleOrig",void 0),Xe(this,"toggleAction",void 0),Xe(this,"tooltipText",void 0),Xe(this,"showTooltipWhenSelected",void 0),Xe(this,"tooltipPosition",void 0),Xe(this,"icon",void 0),Xe(this,"$text",void 0),Xe(this,"_doubleClickSupport",void 0),this.actionStyle=re.ActionStyle.DEFAULT,this.compact=!1,this.iconId=null,this.horizontalAlignment=-1,this.keyStroke=null,this.keyStrokeFirePolicy=re.KeyStrokeFirePolicy.ACCESSIBLE_ONLY,this.selected=!1,this.preventDoubleClick=!1,this.tabbable=!1,this.text=null,this.textPosition=re.TextPosition.DEFAULT,this.htmlEnabled=!1,this.textVisible=!0,this.toggleAction=!1,this.tooltipText=null,this.showTooltipWhenSelected=!0,this._doubleClickSupport=new Vr,this._addCloneProperties(["actionStyle","horizontalAlignment","iconId","selected","preventDoubleClick","tabbable","text","textPosition","htmlEnabled","tooltipText","toggleAction"])}_createKeyStrokeContext(){return new Oe}_init(e){super._init(e),this.actionKeyStroke=this._createActionKeyStroke(),this.resolveConsts([{property:"actionStyle",constType:re.ActionStyle},{property:"textPosition",constType:re.TextPosition},{property:"keyStrokeFirePolicy",constType:re.KeyStrokeFirePolicy}]),this.resolveTextKeys(["text","tooltipText"]),this.resolveIconIds(["iconId"]),this._setKeyStroke(this.keyStroke)}_render(){this.$container=this.$parent.appendDiv("action").on("mousedown",e=>this._doubleClickSupport.mousedown(e)).on("click",this._onClick.bind(this)),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(this._createLayout())}_createLayout(){return new Yn}_renderProperties(){super._renderProperties(),this._renderText(),this._renderTextPosition(),this._renderIconId(),this._renderTooltipText(),this._renderKeyStroke(),this._renderSelected(),this._renderTabbable(),this._renderCompact()}_remove(){this._removeText(),this._removeIconId(),super._remove()}setActionStyle(e){this.setProperty("actionStyle",e)}setText(e){this.setProperty("text",e)}_renderText(){let e=this.text||"";e&&this.textVisible?(this.$text||(this.$text=this.$container.appendSpan("content text"),T.install(this.$text,this.session)),this.htmlEnabled?this.$text.html(e):this.$text.text(e)):this._removeText()}_removeText(){this.$text&&(this.$text.remove(),this.$text=null)}setTextPosition(e){this.setProperty("textPosition",e)}_renderTextPosition(){this.$container.toggleClass("bottom-text",this.textPosition===re.TextPosition.BOTTOM),this.invalidateLayoutTree()}setHtmlEnabled(e){this.setProperty("htmlEnabled",e)}_renderHtmlEnabled(){this._renderText()}setIconId(e){this.setProperty("iconId",e)}_renderIconId(){let e=this.iconId||"";if(!e){this._removeIconId();return}if(this.icon){this.icon.setIconDesc(e);return}this.icon=u.create(Zs,{parent:this,iconDesc:e,prepend:!0}),this.icon.one("destroy",()=>{this.icon=null}),this.icon.render()}get$Icon(){return this.icon?this.icon.$container:a()()}_removeIconId(){this.icon&&this.icon.destroy()}_renderEnabled(){super._renderEnabled(),this.rendered&&(this._updateTooltip(),this._renderTabbable())}setTooltipText(e){this.setProperty("tooltipText",e)}_renderTooltipText(){this._updateTooltip()}_updateTooltip(){this._shouldInstallTooltip()?K.install(this.$container,this._configureTooltip()):K.uninstall(this.$container)}_shouldInstallTooltip(){let e=this.tooltipText&&this.enabledComputed;return!this.showTooltipWhenSelected&&this.selected&&(e=!1),e}setTabbable(e){this.setProperty("tabbable",e)}_renderTabbable(){this.$container.setTabbable(this.tabbable&&this.enabledComputed&&!x.get().supportsOnlyTouch())}setCompact(e){this.compact!==e&&(this.compact=e,this.rendered&&this._renderCompact())}_renderCompact(){this.$container.toggleClass("compact",this.compact),this.invalidateLayoutTree()}setTooltipPosition(e){this.setProperty("tooltipPosition",e)}_configureTooltip(){return{parent:this,text:this.tooltipText,$anchor:this.$container,arrowPosition:50,arrowPositionUnit:"%",tooltipPosition:this.tooltipPosition}}doAction(){return this.prepareDoAction()?(this.isToggleAction()&&this.setSelected(!this.selected),this._doAction(),!0):!1}toggle(){this.isToggleAction()&&this.setSelected(!this.selected)}setToggleAction(e){this.setProperty("toggleAction",e)}isToggleAction(){return this.toggleAction}prepareDoAction(){return!(!this.enabledComputed||!this.visible)}_doAction(){this.trigger("action")}setSelected(e){this.setProperty("selected",e)}_renderSelected(){this.$container.toggleClass("selected",this.selected),this.rendered&&this._updateTooltip()}setKeyStroke(e){this.setProperty("keyStroke",e)}_setKeyStroke(e){this.actionKeyStroke.parseAndSetKeyStroke(e),this._setProperty("keyStroke",e)}_renderKeyStroke(){let e=this.keyStroke;e===void 0?this.$container.removeAttr("data-shortcut"):this.$container.attr("data-shortcut",e)}setTextVisible(e){this.textVisible!==e&&(this._setProperty("textVisible",e),this.rendered&&this._renderText())}setHorizontalAlignment(e){this.setProperty("horizontalAlignment",e)}_createActionKeyStroke(){return new sn(this)}setPreventDoubleClick(e){this.setProperty("preventDoubleClick",e)}_allowMouseEvent(e){return!(e.which!==1||e.type==="click"&&this.preventDoubleClick&&this._doubleClickSupport.doubleClicked())}_onClick(e){!this._allowMouseEvent(e)||(K.cancel(this.$container),this.doAction())}}Xe(re,"ActionStyle",{DEFAULT:0,BUTTON:1}),Xe(re,"TextPosition",{DEFAULT:"default",BOTTOM:"bottom"}),Xe(re,"KeyStrokeFirePolicy",{ACCESSIBLE_ONLY:0,ALWAYS:1});class br extends ke{constructor(){super(),this._addRemoteProperties(["selected"])}_goOffline(){this._enabledBeforeOffline=this.widget.enabled,this.widget.setEnabled(!1)}_goOnline(){this.widget.setEnabled(this._enabledBeforeOffline)}_onWidgetAction(e){this.widget.isToggleAction()||this._send("action")}_onWidgetEvent(e){e.type==="action"?this._onWidgetAction(e):super._onWidgetEvent(e)}}class aa extends O{constructor(e){super(),this.field=e,this.which=[g.SPACE,g.ENTER],this.stopPropagation=!0}handle(e){this.field.doAction()}}class sn extends O{constructor(e){super(),this.field=e,this.parseAndSetKeyStroke(e.keyStroke),this.keyStrokeFirePolicy=e.keyStrokeFirePolicy,this.stopPropagation=!0,this.stopImmediatePropagation=!0}_isEnabled(){return this.which.length?super._isEnabled():!1}handle(e){this.field.doAction()}}function Qs(i,e,t){return e=uC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function uC(i){var e=cC(i,"string");return typeof e=="symbol"?e:String(e)}function cC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ha{constructor(){Qs(this,"rendered",void 0),Qs(this,"logoUrl",void 0),Qs(this,"$parent",void 0),Qs(this,"$container",void 0),Qs(this,"$backgroundElements",void 0),Qs(this,"$wrapper",void 0),Qs(this,"$content",void 0),Qs(this,"$header",void 0),Qs(this,"$logo",void 0),this.rendered=!1,this.logoUrl=null,this.$parent=null,this.$container=null,this.$backgroundElements=null,this.$wrapper=null,this.$content=null,this.$header=null,this.$logo=null}render(e){this.$parent=e,this._render(),this.rendered=!0}remove(){this.$container.remove(),this.$container=null,this.rendered=!1}_render(){this.$backgroundElements=a()("<div>").addClass("box-background-elements").appendTo(this.$parent),a()("<div>").addClass("box-background-element-1").appendTo(this.$backgroundElements),a()("<div>").addClass("box-background-element-2").appendTo(this.$backgroundElements),a()("<div>").addClass("box-background-element-3").appendTo(this.$backgroundElements),this.$container=a()("<div>").addClass("box").appendTo(this.$parent),this.$wrapper=a()("<div>").addClass("wrapper").appendTo(this.$container),this.$content=a()("<div>").addClass("box-content").appendTo(this.$wrapper),this.logoUrl&&(this.$header=this.$content.appendDiv("header"),this.$logo=a()("<img>").addClass("logo").attr("src",this.logoUrl).appendTo(this.$header))}}function Cd(i,e,t){return e=pC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function pC(i){var e=fC(i,"string");return typeof e=="symbol"?e:String(e)}function fC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class da extends I{constructor(){super(),Cd(this,"value",void 0),Cd(this,"htmlEnabled",void 0),Cd(this,"scrollable",void 0),this.value=null,this.htmlEnabled=!1,this.scrollable=!1}_createKeyStrokeContext(){return new Oe}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.registerKeyStroke(new po(this,this._onAppLinkAction))}_init(e){super._init(e),this.resolveTextKeys(["value"])}_render(){this.$container=this.$parent.appendDiv(),this.htmlComp=T.install(this.$container,this.session)}_renderProperties(){super._renderProperties(),this._renderValue(),this._renderScrollable()}setValue(e){this.setProperty("value",e)}_renderValue(){let e=this.value||"";this.htmlEnabled?(this.$container.html(e),this.$container.find(".app-link").on("click",this._onAppLinkAction.bind(this)),this.$container.find("img").on("load",this._onImageLoad.bind(this)).on("error",this._onImageError.bind(this))):this.$container.html(y.nl2br(e)),this.rendered&&(this._uninstallScrollbars(),this._renderScrollable()),this.invalidateLayoutTree()}setHtmlEnabled(e){this.setProperty("htmlEnabled",e)}_renderHtmlEnabled(){this._renderValue()}setScrollable(e){this.setProperty("scrollable",e)}_renderScrollable(){this.scrollable?this._installScrollbars():this._uninstallScrollbars()}_onAppLinkAction(e){let s=a()(e.delegateTarget).data("ref");this.triggerAppLinkAction(s)}triggerAppLinkAction(e){this.trigger("appLinkAction",{ref:e})}_onImageLoad(e){this.invalidateLayoutTree()}_onImageError(e){this.invalidateLayoutTree()}}class $m extends ke{_onWidgetAppLinkAction(e){this._send("appLinkAction",{ref:e.ref})}_onWidgetEvent(e){e.type==="appLinkAction"?this._onWidgetAppLinkAction(e):super._onWidgetEvent(e)}}function se(i,e,t){return e=mC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function mC(i){var e=gC(i,"string");return typeof e=="symbol"?e:String(e)}function gC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ue extends I{constructor(){super(),se(this,"anchorBounds",void 0),se(this,"animateOpening",void 0),se(this,"animateResize",void 0),se(this,"anchor",void 0),se(this,"windowPaddingX",void 0),se(this,"windowPaddingY",void 0),se(this,"withGlassPane",void 0),se(this,"withFocusContext",void 0),se(this,"initialFocus",void 0),se(this,"focusableContainer",void 0),se(this,"horizontalAlignment",void 0),se(this,"verticalAlignment",void 0),se(this,"calculatedHorizontalAlignment",void 0),se(this,"calculatedVerticalAlignment",void 0),se(this,"horizontalSwitch",void 0),se(this,"verticalSwitch",void 0),se(this,"trimWidth",void 0),se(this,"trimHeight",void 0),se(this,"scrollType",void 0),se(this,"windowResizeType",void 0),se(this,"boundToAnchor",void 0),se(this,"withArrow",void 0),se(this,"closeOnAnchorMouseDown",void 0),se(this,"closeOnMouseDownOutside",void 0),se(this,"closeOnOtherPopupOpen",void 0),se(this,"modal",void 0),se(this,"$anchor",void 0),se(this,"$arrow",void 0),se(this,"$arrowOverlay",void 0),se(this,"_documentMouseDownHandler",void 0),se(this,"_anchorScrollHandler",void 0),se(this,"_anchorLocationChangeHandler",void 0),se(this,"_popupOpenHandler",void 0),se(this,"_glassPaneRenderer",void 0),se(this,"_openLater",void 0),se(this,"_windowResizeHandler",void 0),se(this,"_anchorRenderHandler",void 0),se(this,"_withGlassPane",void 0),se(this,"_closeOnAnchorMouseDown",void 0),se(this,"_closeOnMouseDownOutside",void 0),se(this,"_closeOnOtherPopupOpen",void 0),this._documentMouseDownHandler=null,this._anchorScrollHandler=null,this._anchorLocationChangeHandler=null,this._popupOpenHandler=null,this._glassPaneRenderer=null,this.anchorBounds=null,this.animateOpening=!1,this.animateResize=!1,this.anchor=null,this.$anchor=null,this.windowPaddingX=10,this.windowPaddingY=5,this.withGlassPane=!1,this._withGlassPane=null,this.withFocusContext=!0,this.initialFocus=()=>Mt.AUTO,this.focusableContainer=!1,this.horizontalAlignment=ue.Alignment.LEFTEDGE,this.verticalAlignment=ue.Alignment.BOTTOM,this.calculatedHorizontalAlignment=this.horizontalAlignment,this.calculatedVerticalAlignment=this.verticalAlignment,this.horizontalSwitch=!1,this.verticalSwitch=!0,this.trimWidth=!1,this.trimHeight=!0,this.scrollType="remove",this.windowResizeType=null,this.boundToAnchor=!0,this.withArrow=!1,this.closeOnAnchorMouseDown=!0,this._closeOnAnchorMouseDown=null,this.closeOnMouseDownOutside=!0,this._closeOnMouseDownOutside=null,this.closeOnOtherPopupOpen=!0,this._closeOnOtherPopupOpen=null,this.modal=!1,this._openLater=!1,this.$arrow=null,this.$arrowOverlay=null,this._windowResizeHandler=this._onWindowResize.bind(this),this._anchorRenderHandler=this._onAnchorRender.bind(this),this._addWidgetProperties(["anchor"]),this._addPreserveOnPropertyChangeProperties(["anchor"])}_init(e){super._init(e),e.location&&(this.anchorBounds=new ie(e.location.x,e.location.y,0,0)),this._setAnchor(this.anchor),this._setModal(this.modal)}_createKeyStrokeContext(){return new Oe}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.registerKeyStroke(this._createCloseKeyStroke())}_createCloseKeyStroke(){return new Xn(this)}_createLayout(){return new Ii(this)}_openWithoutParent(){if(!this.parent.destroyed){if(this.parent.rendered||this.parent.rendering){this.open(this._getDefaultOpen$Parent());return}this.parent.one("render",()=>{this.session.layoutValidator.schedulePostValidateFunction(()=>{this.destroyed||this.rendered||this.open()})})}}_getDefaultOpen$Parent(){return this.parent.entryPoint()}open(e){if(!e){this._openWithoutParent();return}if(this._triggerPopupOpenEvent(),this._open(e),!this._openLater){if(!this.animateOpening){this.validateFocus();return}this.$container.addClass("before-animate-open"),setTimeout(()=>{!this.rendered||this.removing||(this.$container.removeClass("before-animate-open"),this.validateFocus(),this.rendered&&this.$container.addClassForAnimation("animate-open"))})}}validateFocus(){if(!this.withFocusContext)return;let e=this.session.focusManager.getFocusContext(this.$container);e.ready(),e.lastValidFocusedElement||this._requestInitialFocus()}_requestInitialFocus(){let e=this.session.focusManager.evaluateFocusRule(this.$container,this.initialFocus());!e||this.session.focusManager.requestFocus(e)}_open(e){this.render(e),!this._openLater&&(this.revalidateLayout(),this.position())}render(e){let t=e||this.entryPoint();if(!t||!t.length||!t.isAttached()){this._openLater=!0;return}super.render(t)}_render(){this.$container=this.$parent.appendDiv("popup"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.validateRoot=!0,this.htmlComp.setLayout(this._createLayout()),this.$container.window().on("resize",this._windowResizeHandler)}_renderProperties(){super._renderProperties(),this._renderAnchor(),this._renderWithArrow(),this._renderWithFocusContext(),this._renderWithGlassPane(),this._renderModal()}_postRender(){super._postRender(),this._attachCloseHandlers(),this._attachAnchorHandlers(),this._handleGlassPanes()}_onAttach(){if(super._onAttach(),this._openLater&&!this.rendered){this._openLater=!1;let e=this.animateOpening;this.animateOpening=!1,this.open(),this.animateOpening=e}}_renderOnDetach(){this._openLater=!0,super.removeImmediately(),super._renderOnDetach()}remove(){let e=this.animateRemoval;this.boundToAnchor&&this.$anchor&&!this._isAnchorInView()&&(this.animateRemoval=!1),super.remove(),this.animateRemoval=e}_remove(){this.$container.window().off("resize",this._windowResizeHandler),this._glassPaneRenderer&&this._glassPaneRenderer.removeGlassPanes(),this.withFocusContext&&this.session.focusManager.uninstallFocusContext(this.$container),this.$arrow&&(this.$arrow.remove(),this.$arrow=null),this.anchor&&this.anchor.one("render",this._anchorRenderHandler),this._detachAnchorHandlers(),this._detachCloseHandlers(),super._remove()}_destroy(){this.anchor&&this.anchor.off("render",this._anchorRenderHandler),super._destroy()}_renderWithFocusContext(){!this.withFocusContext||(this.focusableContainer&&this.$container.attr("tabindex",-1),this.session.focusManager.installFocusContext(this.$container,Mt.PREPARE))}setModal(e){this.setProperty("modal",e)}_setModal(e){this._setProperty("modal",e),e?(Le.preserveAndSetProperty(()=>this.setProperty("withGlassPane",!0),()=>this.withGlassPane,this,"_withGlassPane"),Le.preserveAndSetProperty(()=>this.setProperty("closeOnAnchorMouseDown",!1),()=>this.closeOnAnchorMouseDown,this,"_closeOnAnchorMouseDown"),Le.preserveAndSetProperty(()=>this.setProperty("closeOnMouseDownOutside",!1),()=>this.closeOnMouseDownOutside,this,"_closeOnMouseDownOutside"),Le.preserveAndSetProperty(()=>this.setProperty("closeOnOtherPopupOpen",!1),()=>this.closeOnOtherPopupOpen,this,"_closeOnOtherPopupOpen")):(Le.resetProperty(t=>this.setWithGlassPane(t),this,"_withGlassPane"),Le.resetProperty(t=>this.setCloseOnAnchorMouseDown(t),this,"_closeOnAnchorMouseDown"),Le.resetProperty(t=>this.setCloseOnMouseDownOutside(t),this,"_closeOnMouseDownOutside"),Le.resetProperty(t=>this.setCloseOnOtherPopupOpen(t),this,"_closeOnOtherPopupOpen"))}_renderModal(){this.$container.toggleClass("modal",this.modal)}setWithGlassPane(e){this.modal?this._withGlassPane=e:this.setProperty("withGlassPane",e)}_renderWithGlassPane(){this.withGlassPane&&!this._glassPaneRenderer?(this._glassPaneRenderer=new Zr(this),this._glassPaneRenderer.renderGlassPanes()):!this.withGlassPane&&this._glassPaneRenderer&&(this._glassPaneRenderer.removeGlassPanes(),this._glassPaneRenderer=null)}setCloseOnMouseDownOutside(e){this.modal?this._closeOnMouseDownOutside=e:this.setProperty("closeOnMouseDownOutside",e)}_renderCloseOnMouseDownOutside(){this.closeOnMouseDownOutside&&!this._documentMouseDownHandler?(this._documentMouseDownHandler=this._onDocumentMouseDown.bind(this),this.$container.document(!0).addEventListener("mousedown",this._documentMouseDownHandler,!0)):!this.closeOnMouseDownOutside&&this._documentMouseDownHandler&&(this.$container.document(!0).removeEventListener("mousedown",this._documentMouseDownHandler,!0),this._documentMouseDownHandler=null)}setCloseOnAnchorMouseDown(e){this.modal?this._closeOnAnchorMouseDown=e:this.setProperty("closeOnAnchorMouseDown",e)}setCloseOnOtherPopupOpen(e){this.modal?this._closeOnOtherPopupOpen=e:this.setProperty("closeOnOtherPopupOpen",e)}_renderCloseOnOtherPopupOpen(){this.closeOnOtherPopupOpen&&!this._popupOpenHandler?(this._popupOpenHandler=this._onPopupOpen.bind(this),this.session.desktop.on("popupOpen",this._popupOpenHandler)):!this.closeOnOtherPopupOpen&&this._popupOpenHandler&&(this.session.desktop.off("popupOpen",this._popupOpenHandler),this._popupOpenHandler=null)}setWithArrow(e){this.setProperty("withArrow",e)}_renderWithArrow(){this.$arrow&&(this.$arrow.remove(),this.$arrow=null),this.$arrowOverlay&&(this.$arrowOverlay.remove(),this.$arrowOverlay=null),this.withArrow&&(this.$arrowOverlay=this.$container.prependDiv("popup-arrow-overlay"),this.$arrow=this.$container.prependDiv("popup-arrow"),this._updateArrowClass()),this.$container.toggleClass("with-arrow",this.withArrow),this.invalidateLayoutTree()}_updateArrowClass(e,t){this.$arrow&&(this.$arrow.removeClass(this._alignClasses()),this.$arrow.addClass(this._computeArrowPositionClass(e,t)))}_computeArrowPositionClass(e,t){let s=ue.Alignment,r="";switch(t=t||this.horizontalAlignment,e=e||this.verticalAlignment,t){case s.LEFT:r=s.RIGHT;break;case s.RIGHT:r=s.LEFT;break;default:r=t;break}switch(e){case s.BOTTOM:r+=" "+s.TOP;break;case s.TOP:r+=" "+s.BOTTOM;break;default:r+=" "+e;break}return r}_animateRemovalWhileRemovingParent(){return this.$anchor?Le.get(this.$anchor)!==this.parent:!0}_isRemovalPrevented(){return this.removalPending}close(){if(this.destroyed||this.destroying)return;this.trigger("close").defaultPrevented||this.destroy()}_attachCloseHandlers(){this._renderCloseOnMouseDownOutside(),this._renderCloseOnOtherPopupOpen()}_attachAnchorHandlers(){if(!this.$anchor||!this.boundToAnchor||!this.scrollType)return;this._anchorScrollHandler=this._onAnchorScroll.bind(this),P.onScroll(this.$anchor,this._anchorScrollHandler);let e=u.widget(this.$anchor);e&&(this._anchorLocationChangeHandler=this._onAnchorLocationChange.bind(this),e.on("locationChange",this._anchorLocationChangeHandler))}_detachAnchorHandlers(){if(this._anchorScrollHandler&&(P.offScroll(this._anchorScrollHandler),this._anchorScrollHandler=null),this._anchorLocationChangeHandler){let e=u.widget(this.$anchor);e&&(e.off("locationChange",this._anchorLocationChangeHandler),this._anchorLocationChangeHandler=null)}}_detachCloseHandlers(){this._popupOpenHandler&&(this.session.desktop.off("popupOpen",this._popupOpenHandler),this._popupOpenHandler=null),this._documentMouseDownHandler&&(this.$container.document(!0).removeEventListener("mousedown",this._documentMouseDownHandler,!0),this._documentMouseDownHandler=null)}_onDocumentMouseDown(e){!this._rendered||this._isMouseDownOutside(e)&&this._onMouseDownOutside(e)}_isMouseDownOutside(e){let t=e.target,s=a()(t),r;return!this.closeOnAnchorMouseDown&&this._isMouseDownOnAnchor(e)?!1:(r=u.widget(s),!this.isOrHas(r)&&!this.session.focusManager.isElementCovertByGlassPane(this.$container[0]))}_isMouseDownOnAnchor(e){let t=e.target;return!!this.$anchor&&this.$anchor.isOrHas(t)}_onMouseDownOutside(e){this.close()}_onAnchorScroll(e){!this.rendered||this._handleAnchorPositionChange(e)}_handleAnchorPositionChange(e){u.isOneOf(this.scrollType,"position","layoutAndPosition")&&this.isOpeningAnimationRunning()||(this.scrollType==="position"?this.position():this.scrollType==="layoutAndPosition"?(this.revalidateLayout(),this.position()):this.scrollType==="remove"&&this.close())}isOpeningAnimationRunning(){return this.rendered&&this.animateOpening&&this.$container.hasClass("animate-open")}_onAnchorLocationChange(e){this._handleAnchorPositionChange(e)}_onPopupOpen(e){let t=!this.isOrHas(e.popup)&&!e.popup.isOrHas(this);this.rendered&&(t=t&&!this.session.focusManager.isElementCovertByGlassPane(this.$container[0])),t&&this.close()}setHorizontalAlignment(e){this.setProperty("horizontalAlignment",e)}_renderHorizontalAlignment(){this._updateArrowClass(),this.invalidateLayoutTree()}setVerticalAlignment(e){this.setProperty("verticalAlignment",e)}_renderVerticalAlignment(){this._updateArrowClass(),this.invalidateLayoutTree()}setHorizontalSwitch(e){this.setProperty("horizontalSwitch",e)}_renderHorizontalSwitch(){this.invalidateLayoutTree()}setVerticalSwitch(e){this.setProperty("verticalSwitch",e)}_renderVerticalSwitch(){this.invalidateLayoutTree()}setTrimWidth(e){this.setProperty("trimWidth",e)}_renderTrimWidth(){this.invalidateLayoutTree()}setTrimHeight(e){this.setProperty("trimHeight",e)}_renderTrimHeight(){this.invalidateLayoutTree()}prefLocation(e,t){return!this.boundToAnchor||!this.anchorBounds&&!this.$anchor?this._prefLocationWithoutAnchor():this._prefLocationWithAnchor(e,t)}_prefLocationWithoutAnchor(){return ds.positionContainerInWindow(this.$container)}_prefLocationWithAnchor(e,t){let s=this.$container;t=t||this.horizontalAlignment,e=e||this.verticalAlignment;let r=this.getAnchorBounds(),n=v.size(s,{exact:!0}),o=v.margins(s),l=ue.Alignment,h=null;this.$arrow&&(this._updateArrowClass(e,t),v.setMargins(this.$arrow,new Ge),h=v.bounds(this.$arrow)),s.removeClass(this._alignClasses()),s.addClass(e+" "+t);let d=n.width+o.horizontal(),c=n.width,f=r.x;t===l.LEFT?f-=d:t===l.LEFTEDGE?this.withArrow?f+=r.width/2-h.center().x-o.left:f=r.x-o.left:t===l.CENTER?f+=r.width/2-c/2-o.left:t===l.RIGHT?f+=r.width:t===l.RIGHTEDGE&&(this.withArrow?f+=r.width/2-h.center().x-o.left:f=r.x+r.width-c-o.left);let m=n.height+o.vertical(),_=n.height,C=r.y;e===l.TOP?C-=m:e===l.TOPEDGE?this.withArrow?C+=r.height/2-h.center().y-o.top:C=r.y-o.top:e===l.CENTER?C+=r.height/2-_/2-o.top:e===l.BOTTOM?C+=r.height:e===l.BOTTOMEDGE&&(this.withArrow?C+=r.height/2-h.center().y-o.top:C=r.y+r.height-_-o.top);let S=this.$parent.offset();return f-=S.left,C-=S.top,new X(f,C)}_alignClasses(){let e=ue.Alignment;return y.join(" ",e.LEFT,e.LEFTEDGE,e.CENTER,e.RIGHT,e.RIGHTEDGE,e.TOP,e.TOPEDGE,e.CENTER,e.BOTTOM,e.BOTTOMEDGE)}getAnchorBounds(){let e=this.anchorBounds;if(!this.$anchor)return e;let t=v.offsetBounds(this.$anchor,{exact:!0});return e?(e.x||(e.x=t.x,e.width=t.width),e.y||(e.y=t.y,e.height=t.height)):e=t,e}getWindowSize(){let e=this.$parent.window();return new F(e.width(),e.height())}overlap(e,t){let s=this.$container;if(!s||!e)return null;t=u.nvl(t,!0);let r=v.size(s,{exact:!0,includeMargin:t}),n=r.width,o=r.height,l=new ie(e.x,e.y,n,o),h=v.offsetBounds(s.entryPoint(),!0),d=l.right()+this.windowPaddingX-h.width;d<0&&(d=Math.min(l.x-this.windowPaddingX-h.x,0));let c=l.bottom()+this.windowPaddingY-h.height;return c<0&&(c=Math.min(l.y-this.windowPaddingY-h.y,0)),new X(d,c)}adjustLocation(e,t){this.calculatedVerticalAlignment=this.verticalAlignment,this.calculatedHorizontalAlignment=this.horizontalAlignment;let s=this.overlap(e);return this.$arrow&&(this._updateArrowClass(this.calculatedVerticalAlignment,this.calculatedHorizontalAlignment),v.setMargins(this.$arrow,new Ge)),e=e.clone(),Math.abs(s.y)>=1&&(u.nvl(t,this.verticalSwitch)?(this.calculatedVerticalAlignment=ue.SwitchRule[this.calculatedVerticalAlignment],e.y=this.prefLocation(this.calculatedVerticalAlignment).y):e.y-=s.y),Math.abs(s.x)>=1&&(u.nvl(t,this.horizontalSwitch)?(this.calculatedHorizontalAlignment=ue.SwitchRule[this.calculatedHorizontalAlignment],e.x=this.prefLocation(this.calculatedVerticalAlignment,this.calculatedHorizontalAlignment).x):e.x-=s.x),this.$arrow&&(s.y!==0&&(this.$arrow.hasClass(ue.Alignment.LEFT)||this.$arrow.hasClass(ue.Alignment.RIGHT))&&(s.y>0?this.$arrow.cssMarginTop(s.y):this.$arrow.cssMarginBottom(-s.y)),s.x!==0&&(this.$arrow.hasClass(ue.Alignment.TOP)||this.$arrow.hasClass(ue.Alignment.BOTTOM))&&(s.x>0?this.$arrow.cssMarginLeft(s.x):this.$arrow.cssMarginRight(-s.x))),e}position(e){!this.rendered||(this._validateVisibility(),this._position(e))}_position(e){let t=this.prefLocation();!t||(t=this.adjustLocation(t,e),this.setLocation(t))}setLocation(e){!this.rendered||(this.$container.css("left",e.x).css("top",e.y),this._triggerLocationChange())}_validateVisibility(){if(!this.boundToAnchor||!this.$anchor)return;let e=this._isAnchorInView(),t=this.$container.hasClass("invisible")===e&&e;if(this.$container.toggleClass("invisible",!e),t){let s=this.animateResize;this.animateResize=!1,this.revalidateLayout(),this.animateResize=s,this.withFocusContext&&this.session.focusManager.validateFocus()}}_isAnchorInView(){if(!this.boundToAnchor||!this.$anchor)return;let e=this.getAnchorBounds();return P.isLocationInView(e.center(),this.$anchor.scrollParents())}_triggerLocationChange(){this.trigger("locationChange")}_triggerPopupOpenEvent(){this.session.desktop.trigger("popupOpen",{popup:this})}belongsTo(e){return this.$anchor[0]===e[0]}set$Anchor(e){this.$anchor&&this._detachAnchorHandlers(),this.setProperty("$anchor",e),this.rendered&&(this._attachAnchorHandlers(),this.revalidateLayout(),this.animateResize||this.position())}isOpen(){return this.rendered}ensureOpen(){this.isOpen()||this.open()}setAnchor(e){this.setProperty("anchor",e)}_setAnchor(e){e&&this.setParent(e),this._setProperty("anchor",e)}_onAnchorRender(e){this.session.layoutValidator.schedulePostValidateFunction(()=>{if(this.rendered||this.destroyed)return;if(this.anchor&&!this.anchor.rendered){this.anchor.one("render",this._anchorRenderHandler);return}let t=this.animateOpening;this.animateOpening=!1,this.open(),this.animateOpening=t})}_renderAnchor(){this.anchor&&this.set$Anchor(this.anchor.$container)}_onWindowResize(e){!this.rendered||(this.windowResizeType==="position"?this.position():this.windowResizeType==="layoutAndPosition"?(this.revalidateLayoutTree(!1),this.position()):this.windowResizeType==="remove"&&this.close())}_handleGlassPanes(){this.session.focusManager.isElementCovertByGlassPane(this.parent.$container)&&this.session.focusManager.rerenderGlassPanes()}}se(ue,"Alignment",{LEFT:"left",LEFTEDGE:"leftedge",TOP:"top",TOPEDGE:"topedge",CENTER:"center",RIGHT:"right",RIGHTEDGE:"rightedge",BOTTOM:"bottom",BOTTOMEDGE:"bottomedge"}),se(ue,"SwitchRule",{}),(()=>{let i=ue.SwitchRule,e=ue.Alignment;i[e.LEFT]=e.RIGHT,i[e.LEFTEDGE]=e.RIGHTEDGE,i[e.TOP]=e.BOTTOM,i[e.TOPEDGE]=e.BOTTOMEDGE,i[e.CENTER]=e.CENTER,i[e.RIGHT]=e.LEFT,i[e.RIGHTEDGE]=e.LEFTEDGE,i[e.BOTTOM]=e.TOP,i[e.BOTTOMEDGE]=e.TOPEDGE})();class Sd extends ke{_onWidgetClose(e){e.preventDefault(),this._send("close")}_onWidgetEvent(e){e.type==="close"?this._onWidgetClose(e):super._onWidgetEvent(e)}}function rn(i,e,t){return e=_C(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function _C(i){var e=yC(i,"string");return typeof e=="symbol"?e:String(e)}function yC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ii extends ee{constructor(e){super(),rn(this,"popup",void 0),rn(this,"doubleCalcPrefSize",void 0),rn(this,"autoPosition",void 0),rn(this,"autoSize",void 0),rn(this,"resizeAnimationRunning",void 0),rn(this,"resizeAnimationDuration",void 0),rn(this,"_autoPositionOrig",void 0),this.popup=e,this.doubleCalcPrefSize=!0,this.autoPosition=!0,this.autoSize=!0,this.resizeAnimationRunning=!1,this.resizeAnimationDuration=null,this._autoPositionOrig=null}layout(e){if(this.popup.isOpeningAnimationRunning()){this.popup.$container.oneAnimationEnd(this.layout.bind(this,e));return}if(this.popup.removalPending||this.popup.removing||!this.popup.rendered)return;if(!this.autoSize){this._setSize(this.popup.htmlComp.size({exact:!0}));return}let t=this.popup.htmlComp,s=v.bounds(t.$comp),r=this.preferredLayoutSize(e,{exact:!0,widthOnly:this.doubleCalcPrefSize});r=this.adjustSize(r),this.doubleCalcPrefSize&&(r=this.preferredLayoutSize(e,{exact:!0,widthHint:r.width-t.insets().horizontal()}),r=this.adjustSize(r)),this._setSize(r),t.layouted&&this.popup.animateResize&&this._resizeAnimated(s,r)}_resizeAnimated(e,t){this._position();let s=this.popup.htmlComp,r=s.$comp.position(),n=new ie(r.left,r.top,Math.ceil(t.width),Math.ceil(t.height));e.equals(n)||(this.resizeAnimationRunning=!0,s.$comp.stop(!0).cssHeight(e.height).cssWidth(e.width).cssLeft(e.x).cssTop(e.y).animate({height:t.height,width:t.width,left:r.left,top:r.top},{duration:this.resizeAnimationDuration,complete:()=>{this.resizeAnimationRunning=!1,this.popup.rendered&&this._position()}}))}_position(e){this.autoPosition&&this.popup.position(e)}_setSize(e){v.setSize(this.popup.htmlComp.$comp,e)}adjustSize(e){return this.popup.htmlComp._adjustPrefSizeWithMinMaxSize(e),this.popup.boundToAnchor&&(this.popup.anchorBounds||this.popup.$anchor)?this._adjustSizeWithAnchor(e):this._adjustSize(e)}_adjustSize(e){let t=new F,s=this._calcMaxSize();return t.width=Math.min(s.width,e.width),t.height=Math.min(s.height,e.height),t}_calcMaxSize(){let e,t,s=this.popup.htmlComp,r=this.popup.windowPaddingX,n=this.popup.windowPaddingY,o=s.margins(),l=this.popup.getWindowSize();return e=l.width-o.horizontal()-r,t=l.height-o.vertical()-n,new F(e,t)}_adjustSizeWithAnchor(e){let t=new F,s=this._calcMaxSizeAroundAnchor(),r=this._calcMaxSize(),n=ue.Alignment,o=this.popup.horizontalAlignment,l=this.popup.verticalAlignment;return t.width=e.width,this.popup.trimWidth&&(this.popup.horizontalSwitch?e.width>s.right&&e.width>s.left&&(t.width=Math.max(s.right,s.left)):o===n.RIGHT?t.width=Math.min(t.width,s.right):o===n.LEFT?t.width=Math.min(t.width,s.left):t.width=Math.min(t.width,r.width)),t.height=e.height,this.popup.trimHeight&&(this.popup.verticalSwitch?e.height>s.bottom&&e.height>s.top&&(t.height=Math.max(s.bottom,s.top)):l===n.BOTTOM?t.height=Math.min(t.height,s.bottom):l===n.TOP?t.height=Math.min(t.height,s.top):t.height=Math.min(t.height,r.height)),(l===n.CENTER||o===n.CENTER)&&(o===n.CENTER&&(t.width=Math.min(r.width,e.width)),l===n.CENTER&&(t.height=Math.min(r.height,e.height))),t}_calcMaxSizeAroundAnchor(){let e,t,s,r,n=this.popup.htmlComp,o=this.popup.windowPaddingX,l=this.popup.windowPaddingY,h=n.margins(),d=this.popup.getAnchorBounds(),c=this.popup.getWindowSize(),f=this.popup.horizontalAlignment,m=this.popup.verticalAlignment,_=ue.Alignment;return u.isOneOf(f,_.LEFTEDGE,_.RIGHTEDGE)?(t=c.width-d.x-h.horizontal()-o,e=d.right()-h.horizontal()-o):(t=c.width-d.right()-h.horizontal()-o,e=d.x-h.horizontal()-o),u.isOneOf(m,_.BOTTOMEDGE,_.TOPEDGE)?(s=c.height-d.y-h.vertical()-l,r=d.bottom()-h.vertical()-l):(s=c.height-d.bottom()-h.vertical()-l,r=d.y-h.vertical()-l),new Ge(r,t,s,e)}disableAutoPosition(){this._autoPositionOrig===null&&(this._autoPositionOrig=this.autoPosition,this.autoPosition=!1)}resetAutoPosition(){this.autoPosition=this._autoPositionOrig,this._autoPositionOrig=null}}function bC(i,e,t){return e=vC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function vC(i){var e=wC(i,"string");return typeof e=="symbol"?e:String(e)}function wC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ua extends I{constructor(){super(),bC(this,"popups",void 0),this.popups=[],this._addWidgetProperties(["popups"]),this._addPreserveOnPropertyChangeProperties(["popups"])}_init(e){super._init(e),this.session.layoutValidator.schedulePostValidateFunction(()=>{this._openPopups(this.popups)})}setPopups(e){this.setProperty("popups",e)}_setPopups(e){this._openPopups(p.diff(e,this.popups)),this._destroyPopups(p.diff(this.popups,e)),this._setProperty("popups",e),this.popups.forEach(t=>{t.parent instanceof ua&&t.setParent(this.session.desktop)})}_openPopups(e){e.forEach(t=>{t.open()})}_destroyPopups(e){e.forEach(t=>t.destroy())}}class Rm extends ke{}function as(i,e,t){return e=TC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function TC(i){var e=CC(i,"string");return typeof e=="symbol"?e:String(e)}function CC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class el extends ue{constructor(){super(),as(this,"doneAction",void 0),as(this,"htmlBody",void 0),as(this,"$body",void 0),as(this,"_field",void 0),as(this,"_touchField",void 0),as(this,"_touchFieldTooltip",void 0),as(this,"_widget",void 0),as(this,"_$widgetContainer",void 0),as(this,"_$header",void 0),as(this,"_widgetContainerHtmlComp",void 0),as(this,"_touchFieldPropertyChangeListener",void 0),this._touchField=null,this._touchFieldTooltip=null,this._field=null,this._widget=null,this._$widgetContainer=null,this._widgetContainerHtmlComp=null,this.windowPaddingX=0,this.windowPaddingY=0,this.withGlassPane=!0,this._touchFieldPropertyChangeListener=this._onTouchFieldPropertyChange.bind(this)}_init(e){super._init(e),this._touchField=e.field;let t=this._touchField.tooltip();t&&t.rendered&&(this._touchFieldTooltip=t,this._touchFieldTooltip.remove()),this._field=this._touchField.clone(this._fieldOverrides()),this._touchField.on("propertyChange",this._touchFieldPropertyChangeListener),this._initWidget(e),this.doneAction=u.create(ne,{parent:this,text:this.session.text("ui.Done")}),this.doneAction.on("action",this._onCloseIconClick.bind(this))}_destroy(){this._touchField.off("propertyChange",this._touchFieldPropertyChangeListener),this._touchFieldTooltip&&!this._touchFieldTooltip.destroyed&&this._touchFieldTooltip.render(this._touchField._$tooltipParent()),super._destroy()}_fieldOverrides(){return{parent:this,labelVisible:!1,fieldStyle:A.FieldStyle.CLASSIC,popup:this,statusVisible:!1,menusVisible:!1,embedded:!0,touchMode:!1,clearable:me.Clearable.ALWAYS}}_initWidget(e){}_createLayout(){return new ca(this)}prefLocation(e,t){let s=this.htmlComp.prefSize(),r=this.$container.window().width(),n=Math.max(this.windowPaddingX,(r-s.width)/2);return new X(n,0)}_render(){this.$container=this.$parent.appendDiv("popup touch-popup"),this.$body=this.$container.appendDiv("body"),this.htmlBody=T.install(this.$body,this.session),this.htmlBody.setLayout(new Ri),this._$header=this.$body.appendDiv("touch-popup-header"),T.install(this._$header,this.session),this._$header.appendDiv("touch-popup-title").textOrNbsp(this._touchField.label,"empty"),this.doneAction.render(this._$header),this._$widgetContainer=this.$body.appendDiv("touch-popup-widget-container"),this._widgetContainerHtmlComp=T.install(this._$widgetContainer,this.session),this._widgetContainerHtmlComp.setLayout(new Es),this._field.render(),this._field.$container.insertBefore(this._$widgetContainer),this._field.$container.addClass("touch-popup-field"),this._widget&&this._widget.render(this._$widgetContainer),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.validateRoot=!0,this.htmlComp.setLayout(this._createLayout())}_handleGlassPanes(){super._handleGlassPanes(),this._glassPaneRenderer&&this._glassPaneRenderer.eachGlassPane(e=>e.addClass("dark"))}_onTouchFieldPropertyChange(e){e.propertyName==="errorStatus"?this._field.setErrorStatus(e.newValue):e.propertyName==="lookupRow"&&this._field instanceof le&&this._field.setLookupRow(e.newValue)}_acceptInput(){let e=this._field.acceptInput();e?e.always(this.close.bind(this)):this.close()}_onCloseIconClick(e){this._acceptInput()}}class ca extends Ii{constructor(e){super(e),this.doubleCalcPrefSize=!1}_setSize(e){super._setSize(e);let t=this.popup.htmlComp,s=this.popup.htmlBody,r=e.subtract(t.insets());s.setSize(r.subtract(s.margins()))}preferredLayoutSize(e,t){let s=this.popup.htmlComp,r=this.popup.htmlBody,n=r.prefSize(t).add(s.insets());return n.width=de.get().formColumnWidth,n.add(r.margins())}}function hs(i,e,t){return e=SC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function SC(i){var e=PC(i,"string");return typeof e=="symbol"?e:String(e)}function PC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class eo extends ue{constructor(){super(),hs(this,"closable",void 0),hs(this,"closeAction",void 0),hs(this,"movable",void 0),hs(this,"resizable",void 0),hs(this,"resizeModes",void 0),hs(this,"$dragHandle",void 0),hs(this,"content",void 0),hs(this,"$actions",void 0),hs(this,"_moveHandler",void 0),hs(this,"_resizeHandler",void 0),hs(this,"_autoPositionOrig",void 0),this.animateOpening=!0,this.animateResize=!0,this.animateRemoval=!0,this.closable=!1,this.closeAction=null,this.movable=!1,this.resizable=!1,this.resizeModes=null,this.content=null,this.windowPaddingX=0,this.windowPaddingY=0,this.windowResizeType="layoutAndPosition",this.$dragHandle=null,this.$actions=null,this._moveHandler=this._onMove.bind(this),this._resizeHandler=this._onResize.bind(this),this._autoPositionOrig=null,this._addWidgetProperties(["content"])}_createLayout(){return new xd(this)}_init(e){super._init(e),this._setClosable(this.closable)}_render(){super._render(),this.$container.addClass("widget-popup")}_renderProperties(){super._renderProperties(),this._renderContent(),this._renderClosable(),this._renderMovable(),this._renderResizable()}_remove(){this.$dragHandle=null,this.$actions=null,super._remove()}setContent(e){this.setProperty("content",e)}_renderContent(){!this.content||(this.content.render(),this.content.$container.addClass("popup-widget"),this.invalidateLayoutTree())}setClosable(e){this.setProperty("closable",e)}_setClosable(e){if(this._setProperty("closable",e),this.closable){if(this.closeAction)return;this.closeAction=this._createCloseAction(),this.closeAction.on("action",this._onCloseAction.bind(this))}else{if(!this.closeAction)return;this.closeAction.destroy(),this.closeAction=null}}_createCloseAction(){return u.create(re,{parent:this,cssClass:"close-action menu-item",iconId:ye.REMOVE})}_renderClosable(){this.closeAction?(this.$actions||(this.$actions=this.$container.appendDiv("actions")),this.closeAction.render(this.$actions)):this.$actions&&this.$actions.children().length===0&&(this.$actions.remove(),this.$actions=null)}_onCloseAction(e){this.close()}setResizable(e){this.setProperty("resizable",e)}_renderResizable(){this.resizable?this.$container.resizable({modes:this._determineResizeModes(),$container:this.$container,boundaries:this._calculateResizeBoundaries()}).on("resize",this._resizeHandler):(this.$container.unresizable().off("resize",this._resizeHandler),this.invalidateLayoutTree())}_calculateResizeBoundaries(){let e=new Ge;if(!this.$arrow)return e;let t=this._getAnchorMiddlePoint();if(!t)return e;let s=v.size(this.$arrow);return this._isVerticallyAligned()?(e.top=t.y-s.height,e.bottom=t.y+s.height):(e.left=t.x-s.width,e.right=t.x+s.width),e}_determineResizeModes(){return!this.$arrow||this.resizeModes?this.resizeModes:this.calculatedVerticalAlignment===ue.Alignment.TOP?[Ee.MODES.WEST,Ee.MODES.EAST,Ee.MODES.NORTH]:this.calculatedVerticalAlignment===ue.Alignment.BOTTOM?[Ee.MODES.WEST,Ee.MODES.EAST,Ee.MODES.SOUTH]:this.calculatedHorizontalAlignment===ue.Alignment.LEFT?[Ee.MODES.NORTH,Ee.MODES.SOUTH,Ee.MODES.WEST]:this.calculatedHorizontalAlignment===ue.Alignment.RIGHT?[Ee.MODES.NORTH,Ee.MODES.SOUTH,Ee.MODES.EAST]:this.resizeModes}_onResize(e){let t=this.htmlComp.layout,s=t.autoSize;return t.autoSize=!1,this.htmlComp.revalidateLayout(),t.autoSize=s,this._updateArrowPosition(),!1}position(e){if(!!this.rendered&&(super.position(e),this.resizable)){let t=this.$container.data("resizable");t.setBoundaries(this._calculateResizeBoundaries()),t.setModes(this._determineResizeModes()),this._updateArrowPosition()}}_updateArrowClass(e,t){super._updateArrowClass(e,t),this.$arrow&&(this.$arrow.cssLeft(null),this.$arrow.cssTop(null))}_updateArrowPosition(){if(!this.$arrow)return;let e=this._getAnchorMiddlePoint();if(!e)return;this.$arrow.removeClass("leftedge rightedge topedge bottomedge");let t=v.size(this.$arrow),s=v.margins(this.$arrow);if(this._isVerticallyAligned()){let r=s.top+s.bottom;this.$arrow.cssTop(e.y-(r+this.$container.position().top+t.height/2))}else{let r=s.left+s.right;this.$arrow.cssLeft(e.x-(r+this.$container.position().left+t.width/2))}}_getAnchorMiddlePoint(){let e=this.getAnchorBounds();return e?e.center():null}_isVerticallyAligned(){return u.isOneOf(this.calculatedHorizontalAlignment,ue.Alignment.LEFT,ue.Alignment.RIGHT)}setMovable(e){this.setProperty("movable",e)}_renderMovable(){if(this.movable){if(this.$dragHandle)return;this.$dragHandle=this.$container.prependDiv("drag-handle"),this.$container.draggable(this.$dragHandle,a().throttle(this._moveHandler,1e3/60))}else{if(!this.$dragHandle)return;this.$container.undraggable(this.$dragHandle),this.$dragHandle.remove(),this.$dragHandle=null;let e=this.htmlComp.layout;e.autoPosition=this._autoPositionOrig,this._autoPositionOrig=null,this.invalidateLayoutTree()}}_onMove(e){if(this._autoPositionOrig===null){let t=this.htmlComp.layout;this._autoPositionOrig=t.autoPosition,t.autoPosition=!1}this.trigger("move",e)}set$Anchor(e){if(this._autoPositionOrig&&e&&this.$anchor!==e){let t=this.htmlComp.layout;t.autoPosition=this._autoPositionOrig,this._autoPositionOrig=null}super.set$Anchor(e)}}class Pd extends Sd{}class xd extends Ii{constructor(e){super(e)}_setSize(e){super._setSize(e);let t=this.popup.htmlComp,s=this.popup.content.htmlComp,r=e.subtract(t.insets());s.setSize(r.subtract(s.margins()))}preferredLayoutSize(e,t){let s=this.popup.htmlComp,r=this.popup.content.htmlComp;return r.prefSize(t).add(s.insets()).add(r.margins())}}function Ed(i,e,t){return e=xC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function xC(i){var e=EC(i,"string");return typeof e=="symbol"?e:String(e)}function EC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Fd extends eo{constructor(){super(),Ed(this,"title",void 0),Ed(this,"$header",void 0),Ed(this,"$title",void 0),this.boundToAnchor=!1,this.closable=!0,this.title=null,this.withGlassPane=!0}_createLayout(){return new Dd(this)}_createCloseAction(){return u.create(re,{parent:this,cssClass:"closer",iconId:ye.REMOVE_BOLD})}prefLocation(e,t){let s=this.htmlComp.prefSize(),r=this.$container.window().height(),n=Math.max(r-s.height,0);return new X(0,n)}_render(){this.$container=this.$parent.appendDiv("popup mobile-popup"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.validateRoot=!0,this.htmlComp.setLayout(this._createLayout()),this.$header=this.$container.appendDiv("mobile-popup-header"),this.$title=this.$header.appendDiv("title")}_renderProperties(){super._renderProperties(),this._renderTitle()}_renderContent(){super._renderContent(),this.content&&this.content.$container.addClass("mobile-popup-widget")}_renderClosable(){this.closeAction&&this.closeAction.render(this.$header),this.$header.setVisible(!!this.title||this.closable)}_renderTitle(){this.$title.textOrNbsp(this.title),this.$header.setVisible(!!this.title||this.closable)}}class Mm extends Pd{}class Dd extends Ii{constructor(e){super(e),this.doubleCalcPrefSize=!1}layout(e){super.layout(e);let t=this.popup.htmlComp,s=t.size(),r=this.popup.content.htmlComp,n,o=this.popup.$header,l;s=s.subtract(t.insets()),l=v.prefSize(o,!0),v.setLocation(o,new X(0,0)),n=s.clone(),n.height-=l.height,r.setLocation(new X(0,l.height)),r.setSize(n.subtract(r.margins()))}preferredLayoutSize(e,t){let s=this.popup.$container.window();return new F(s.width(),s.height())}}function Li(i,e,t){return e=FC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function FC(i){var e=DC(i,"string");return typeof e=="symbol"?e:String(e)}function DC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class pa extends I{constructor(){super(),Li(this,"preselectedDate",void 0),Li(this,"selectedDate",void 0),Li(this,"dateFormat",void 0),Li(this,"viewDate",void 0),Li(this,"allowedDates",void 0),Li(this,"touch",void 0),Li(this,"currentMonth",void 0),Li(this,"months",void 0),Li(this,"$scrollable",void 0),Li(this,"swiped",void 0),Li(this,"_showWeekendSeparator",void 0),Li(this,"_boxWidth",void 0),Li(this,"_$header",void 0),this.preselectedDate=null,this.selectedDate=null,this.dateFormat=null,this.viewDate=null,this.allowedDates=[],this.currentMonth=null,this.$scrollable=null,this.months=[],this._showWeekendSeparator=!0}_init(e){super._init(e),this._setDateFormat(this.dateFormat),this._showWeekendSeparator=this.dateFormat.symbols.firstDayOfWeek===1}_render(){this.$container=this.$parent.appendDiv("date-picker").toggleClass("touch-only",x.get().supportsOnlyTouch()),this.htmlComp=T.install(this.$container,this.session),this._$header=this._append$Header(),this._$header.find(".date-picker-left-y, .date-picker-left-m, .date-picker-right-m, .date-picker-right-y").on("mousedown",this._onNavigationMouseDown.bind(this)),this.$container.appendDiv("date-picker-separator"),this.$scrollable=this.$container.appendDiv("date-picker-scrollable"),this._registerSwipeHandlers()}_setDateFormat(e){e||(e=this.session.locale.dateFormatPatternDefault),e=xt.ensure(this.session.locale,e),this._setProperty("dateFormat",e)}prependMonth(e){let t=this.months.slice();p.insert(t,e,0),this.setMonths(t)}appendMonth(e){let t=this.months.slice();t.push(e),this.setMonths(t)}resetMonths(e){e=e||this.viewDate;let t=w.shift(e,0,-1,0),s=w.shift(e,0,1,0);this.setMonths([t,e,s])}setMonths(e){e=p.ensure(e);let t=e.map(s=>{let r;s instanceof Date?r=s:r=s.viewDate;let n=this._findMonthByViewDate(r);return n||{rendered:!1,viewDate:r,$container:void 0}});this.rendered&&this.months.forEach(s=>{t.indexOf(s)<0&&s.rendered&&s.$container.remove()}),this.setProperty("months",t)}_renderMonths(){this.months.forEach(t=>{t.rendered?this._layoutWeekendSeparator(t):(this._renderMonth(t),this.currentMonth&&w.compare(t.viewDate,this.currentMonth.viewDate)<0&&t.$container.insertBefore(this.currentMonth.$container))});let e=this.months.length*this._boxWidth;this.$scrollable.width(e),this.currentMonth&&this.$scrollable.cssLeft(this._scrollableLeftForMonth(this.currentMonth))}_findMonthByViewDate(e){return p.find(this.months,t=>w.compareMonths(t.viewDate,e)===0)}_scrollableLeftForMonth(e){let t=v.insets(this.$scrollable),s=v.margins(e.$container);return-1*(e.$container.position().left-s.left-t.left)}_renderMonth(e){if(e.rendered)return;let t=this.$parent.makeDiv("date-picker-month-box");this._showWeekendSeparator&&(e.$weekendSeparator=t.appendDiv("date-picker-weekend-separator")),this._build$DateBox(e.viewDate).appendTo(t),t.on("DOMMouseScroll mousewheel",this._onMouseWheel.bind(this)).appendTo(this.$scrollable),this._boxWidth||(this._boxWidth=t.width()),t.width(this._boxWidth),e.$container=t,e.rendered=!0}setViewDate(e,t){b.equals(this.viewDate,e)||(this._setProperty("viewDate",e),this.rendered&&this._renderViewDate(t))}_renderViewDate(e){let t=this._findMonthByViewDate(this.viewDate),s=this._scrollableLeftForMonth(t);this.currentMonth||this.revalidateLayoutTree(),this.currentMonth=t,this._updateHeader(this.viewDate),e=u.nvl(e,!0),e?this.$scrollable.stop(!0).animate({left:s},300,()=>{this.resetMonths()}):(this.$scrollable.cssLeft(s),this.resetMonths())}_layoutWeekendSeparators(){this.months.forEach(e=>this._layoutWeekendSeparator(e))}_layoutWeekendSeparator(e){if(!e.$weekendSeparator)return;let t=this.$container.find(".date-picker-weekdays").first().children();if(t.length<6)return;let s=t.eq(4),r=t.eq(5),n=v.position(s).x+v.size(s,{includeMargin:!0}).width,l=v.position(r).x-n,h=e.$weekendSeparator.cssBorderWidthX(),d=Math.floor(n+l/2-h);e.$weekendSeparator.cssLeft(d)}preselectDate(e,t){this.showDate(e,t),e&&this.setSelectedDate(null),this.setPreselectedDate(e)}setPreselectedDate(e){this.setProperty("preselectedDate",e)}_renderPreselectedDate(){if(!this.currentMonth)return;this.currentMonth.$container.find(".date-picker-day").each((t,s)=>{let r=a()(s);r.removeClass("preselected"),w.isSameDay(this.preselectedDate,r.data("date"))&&r.addClass("preselected")})}selectDate(e,t){this.showDate(e,t),e&&this.setPreselectedDate(null),this.setSelectedDate(e)}setSelectedDate(e){this.setProperty("selectedDate",e)}_renderSelectedDate(){if(!this.currentMonth)return;this.currentMonth.$container.find(".date-picker-day").each((t,s)=>{let r=a()(s);r.removeClass("selected"),w.isSameDay(this.selectedDate,r.data("date"))&&r.addClass("selected")})}showDate(e,t){let s=0;this.viewDate&&(s=w.compareMonths(e,this.viewDate)),this.currentMonth&&s?s<0?this.prependMonth(e):this.appendMonth(e):this.currentMonth?this.resetMonths(e):this.setMonths([e]),this.setViewDate(e,t)}shiftViewDate(e,t,s){let r=this.viewDate;r=w.shift(r,e,t,s),this.showDate(r)}shiftSelectedDate(e,t,s){let r=this.preselectedDate;this.selectedDate&&(this.allowedDates.length>0?r=this._findNextAllowedDate(e,t,s):r=w.shift(this.selectedDate,e,t,s)),r&&this.selectDate(r,!0)}_findNextAllowedDate(e,t,s){let r,n,o=e+t+s,l=o>0?1:-1,h=this.selectedDate||w.trunc(new Date);if(e!==0?h=w.shift(h,e,0,0):t!==0&&(h=w.shift(h,0,t,0)),l===1){for(r=0;r<this.allowedDates.length;r++)if(n=this.allowedDates[r],w.compare(h,n)<0)return n}else if(l===-1){for(r=this.allowedDates.length-1;r>=0;r--)if(n=this.allowedDates[r],w.compare(h,n)>0)return n}return null}_isDateAllowed(e){if(this.allowedDates.length===0)return!0;let t=w.trunc(e).getTime();return this.allowedDates.some(s=>s.getTime()===t)}_build$DateBox(e){let t,s,r,n,o,l,h=new Date,d=new Date(e),c=this.$container.makeDiv("date-picker-month").data("viewDate",e),f=c.appendDiv("date-picker-weekdays");this.dateFormat.symbols.weekdaysShortOrdered.map(_=>_.length>2?_.substr(0,2):_).forEach(_=>f.appendDiv("date-picker-weekday",_.toUpperCase()));let m;for(let _=0;_<42;_++){d.setDate(d.getDate()-1);let C=new Date(d.getFullYear(),e.getMonth(),0).getDate()-d.getDate();if(d.getDay()===0&&d.getMonth()!==e.getMonth()&&C>1)break}for(s=0;s<42;s++)s%7===0&&(m=c.appendDiv("date-picker-week")),d.setDate(d.getDate()+1),o=d.getDate(),d.getDay()===6||d.getDay()===0?(t=d.getMonth()!==e.getMonth()?" date-picker-out-weekend":" date-picker-weekend",this._showWeekendSeparator&&d.getDay()===6&&(t+=" date-picker-day-weekend-separator")):t=d.getMonth()!==e.getMonth()?" date-picker-out":"",w.isSameDay(d,h)&&(t+=" date-picker-now"),w.isSameDay(this.selectedDate,d)&&(t+=" selected"),w.isSameDay(this.preselectedDate,d)&&(t+=" preselected"),o>9&&o<20&&(t+=" ten"),n=this._isDateAllowed(d),n||(t+=" disabled"),r=o<=9?"0"+o:o,l=m.appendDiv("date-picker-day"+t).data("dayInMonth",o).data("date",new Date(d)),l.appendSpan("text",r),n&&l.on("click",this._onDayClick.bind(this));return c}_append$Header(){let e='<div class="date-picker-header">  <div class="date-picker-left-y" data-shift="-12"></div>  <div class="date-picker-left-m" data-shift="-1"></div>  <div class="date-picker-right-y" data-shift="12"></div>  <div class="date-picker-right-m" data-shift="1"></div>  <div class="date-picker-header-month">&nbsp;</div></div>';return this.$container.appendElement(e).toggleClass("touch",this.touch)}_updateHeader(e){this._$header.find(".date-picker-header-month").text(this._createHeaderText(e))}_createHeaderText(e){return this.dateFormat.symbols.months[e.getMonth()]+" "+e.getFullYear()}_registerSwipeHandlers(){let e,t,s=o=>(this.$scrollable.stop(!0),e=w.shift(this.viewDate,0,-1,0),t=w.shift(this.viewDate,0,1,0),this.setMonths([e,this.viewDate,t]),this.swiped=!1,!0),r=o=>{let l=this.$container.width()-this.$scrollable.outerWidth(),h=Math.max(Math.min(o.newLeft,0),l);return h!==o.originalLeft&&this.$scrollable.cssLeft(h),h},n=o=>{let l=5,h=this.viewDate;o.deltaX<-l?h=t:o.deltaX>l&&(h=e),this.viewDate!==h&&(this.swiped=!0,this.setViewDate(h))};ot.onSwipe(this.$scrollable,"datepickerDrag",s,r,n)}_onNavigationMouseDown(e){let s=a()(e.currentTarget).data("shift");this.shiftViewDate(0,s,0)}_onDayClick(e){if(this.swiped)return;let s=a()(e.currentTarget).data("date");this.selectDate(s),this.trigger("dateSelect",{date:s})}_onMouseWheel(e){let t=e.originalEvent||this.$container.window(!0).event.originalEvent,r=(t.wheelDelta?t.wheelDelta/10:-t.detail*3)>=0?-1:1;this.shiftViewDate(0,r,0),t.preventDefault()}}function Im(i,e,t){return e=AC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function AC(i){var e=$C(i,"string");return typeof e=="symbol"?e:String(e)}function $C(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class fa extends ue{constructor(){super(),Im(this,"field",void 0),Im(this,"picker",void 0),this.windowPaddingX=0,this.windowPaddingY=0}_init(e){e.scrollType=e.scrollType||"layoutAndPosition",e.withFocusContext=!1,super._init(e),this.picker=u.create(pa,{parent:this,dateFormat:e.dateFormat,allowedDates:e.allowedDates})}_createLayout(){return new Ad(this)}_render(){this.$container=this.$parent.appendDiv("popup date-picker-popup"),this.$container.toggleClass("alternative",this.field.fieldStyle===A.FieldStyle.ALTERNATIVE),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(this._createLayout()),this.htmlComp.validateRoot=!0,this.findDesktop().adjustOverlayOrder(this),this.picker.render()}getDatePicker(){return this.picker}_isMouseDownOnAnchor(e){let t=e.target;return this.field.$dateField.isOrHas(t)||this.field.$dateFieldIcon.isOrHas(t)||this.field.$dateClearIcon&&this.field.$dateClearIcon.isOrHas(t)}}class Ad extends Ii{constructor(e){super(e),this.doubleCalcPrefSize=!1}layout(e){let t,s=this.popup.htmlComp,r=this.popup.picker.htmlComp;super.layout(e),t=s.size().subtract(s.insets()).subtract(r.margins()),r.setSize(t),this.popup.htmlComp.layouted&&this.popup.position(),this.popup.getDatePicker()._layoutWeekendSeparators()}preferredLayoutSize(e,t){let s,r=this.popup.htmlComp,n=this.popup.picker.htmlComp;return s=n.prefSize().add(r.insets()).add(n.margins()),s}}class $d extends el{_init(e){super._init(e),this._field.on("acceptInput",this._onFieldAcceptInput.bind(this)),this.addCssClass("date-picker-touch-popup")}_initWidget(e){this._widget=u.create(pa,{parent:this,dateFormat:e.dateFormat,allowedDates:e.allowedDates})}_render(){super._render(),this._field.$container.addClass("date")}_onMouseDownOutside(e){this._acceptInput()}getDatePicker(){return this._widget}_createLayout(){return new Rd(this)}_onFieldAcceptInput(e){this._touchField.setDisplayText(e.displayText),this._touchField.setErrorStatus(e.errorStatus),(e.errorStatus?e.errorStatus.containsStatus(pi):!1)||this._touchField.setValue(e.value),this._touchField._triggerAcceptInput(e.whileTyping)}_acceptInput(){this._field.acceptDate(),this.close()}}class Rd extends ca{constructor(e){super(e)}layout(e){super.layout(e),this.popup.getDatePicker()._layoutWeekendSeparators()}}function nt(i,e,t){return e=RC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function RC(i){var e=MC(i,"string");return typeof e=="symbol"?e:String(e)}function MC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class mi extends I{constructor(){super(),nt(this,"bodyAnimating",void 0),nt(this,"collapsed",void 0),nt(this,"collapsible",void 0),nt(this,"title",void 0),nt(this,"titleHtmlEnabled",void 0),nt(this,"titleSuffix",void 0),nt(this,"header",void 0),nt(this,"headerFocusable",void 0),nt(this,"headerVisible",void 0),nt(this,"body",void 0),nt(this,"collapseStyle",void 0),nt(this,"htmlHeader",void 0),nt(this,"htmlFooter",void 0),nt(this,"iconId",void 0),nt(this,"icon",void 0),nt(this,"$header",void 0),nt(this,"$footer",void 0),nt(this,"$collapseIcon",void 0),nt(this,"$collapseBorderLeft",void 0),nt(this,"$collapseBorderRight",void 0),nt(this,"$title",void 0),nt(this,"$titleSuffix",void 0),this.bodyAnimating=!1,this.collapsed=!1,this.collapsible=!0,this.title=null,this.titleHtmlEnabled=!1,this.titleSuffix=null,this.header=null,this.headerFocusable=!1,this.headerVisible=!0,this.body=null,this.$container=null,this.$header=null,this.$footer=null,this.$collapseIcon=null,this.$collapseBorderLeft=null,this.$collapseBorderRight=null,this.collapseStyle=mi.CollapseStyle.LEFT,this.htmlComp=null,this.htmlHeader=null,this.htmlFooter=null,this.iconId=null,this.icon=null,this._addWidgetProperties(["header","body"])}_init(e){super._init(e),this.resolveTextKeys(["title","titleSuffix"]),this.resolveIconIds(["iconId"]),this._setBody(this.body),this._setHeader(this.header)}_createKeyStrokeContext(){return new Oe}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.$bindTarget=()=>this.$header,this.keyStrokeContext.registerKeyStrokes([new Id(this)])}_render(){this.$container=this.$parent.appendDiv("group"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new Md(this)),this._renderHeader(),this.$collapseIcon=this.$header.appendDiv("group-collapse-icon"),this.$footer=this.$container.appendDiv("group-footer"),this.$collapseBorderLeft=this.$footer.appendDiv("group-collapse-border"),this.$collapseBorderRight=this.$footer.appendDiv("group-collapse-border"),this.htmlFooter=T.install(this.$footer,this.session),this.$footer.on("mousedown",this._onFooterMouseDown.bind(this))}_renderProperties(){super._renderProperties(),this._renderIconId(),this._renderTitle(),this._renderTitleSuffix(),this._renderHeaderVisible(),this._renderHeaderFocusable(),this._renderCollapsed(),this._renderCollapseStyle(),this._renderCollapsible()}_remove(){this.$header=null,this.$title=null,this.$titleSuffix=null,this.$footer=null,this.$collapseIcon=null,this.$collapseBorderLeft=null,this.$collapseBorderRight=null,this._removeIconId(),super._remove()}_renderEnabled(){super._renderEnabled(),this.$header.setTabbable(this.enabledComputed)}setIconId(e){this.setProperty("iconId",e)}_renderIconId(){let e=this.iconId||"";if(!e){this._removeIconId(),this._updateIconStyle();return}if(this.icon){this.icon.setIconDesc(e),this._updateIconStyle();return}this.icon=u.create(Zs,{parent:this,iconDesc:e,prepend:!0}),this.icon.one("destroy",()=>{this.icon=null}),this.icon.render(this.$header),this._updateIconStyle()}_updateIconStyle(){let e=!!this.title;this.get$Icon().toggleClass("with-title",e),this.get$Icon().addClass("group-icon"),this._renderCollapseStyle()}get$Icon(){return this.icon?this.icon.$container:a()()}_removeIconId(){this.icon&&this.icon.destroy()}setHeader(e){this.setProperty("header",e)}_setHeader(e){this._setProperty("header",e)}setHeaderFocusable(e){this.setProperty("headerFocusable",e)}_renderHeaderFocusable(){this.$header.toggleClass("unfocusable",!this.headerFocusable)}setTitle(e){this.setProperty("title",e)}_renderTitle(){this.$title&&(this.titleHtmlEnabled?this.$title.htmlOrNbsp(this.title):this.$title.textOrNbsp(this.title),this._updateIconStyle())}setTitleSuffix(e){this.setProperty("titleSuffix",e)}_renderTitleSuffix(){this.$titleSuffix&&this.$titleSuffix.text(this.titleSuffix||"")}setHeaderVisible(e){this.setProperty("headerVisible",e)}_renderHeaderVisible(){this.$header.setVisible(this.headerVisible),this._renderCollapsible(),this.invalidateLayoutTree()}setBody(e){this.setProperty("body",e)}_setBody(e){e||(e=u.create(IC,{parent:this})),this._setProperty("body",e)}_createLoadingSupport(){return new ss({widget:this,$container:()=>this.$header})}_renderHeader(){this.$header&&(this.$header.remove(),this._removeIconId()),this.header?(this.header.render(),this.$header=this.header.$container.addClass("group-header").addClass("custom-header-widget").prependTo(this.$container),this.htmlHeader=this.header.htmlComp):(this.$header=this.$container.prependDiv("group-header").unfocusable().addClass("prevent-initial-focus"),this.$title=this.$header.appendDiv("group-title"),this.$titleSuffix=this.$header.appendDiv("group-title-suffix"),K.installForEllipsis(this.$title,{parent:this}),this.htmlHeader=T.install(this.$header,this.session),this.rendering||(this._renderIconId(),this._renderTitle(),this._renderTitleSuffix())),this.$header.on("mousedown",this._onHeaderMouseDown.bind(this)),this.invalidateLayoutTree()}_renderBody(){this.body.render(),this.body.$container.insertAfter(this.$header),this.body.$container.addClass("group-body"),this.body.invalidateLayoutTree()}getFocusableElement(){return this.rendered?this.$header:null}toggleCollapse(){this.setCollapsed(!this.collapsed&&this.collapsible)}setCollapsed(e){this.setProperty("collapsed",e)}_renderCollapsed(){this.$container.toggleClass("collapsed",this.collapsed),this.$collapseIcon.toggleClass("collapsed",this.collapsed),!this.collapsed&&!this.bodyAnimating&&this._renderBody(),this.rendered?this.resizeBody():this.collapsed&&this.body.remove(),this.invalidateLayoutTree()}setCollapsible(e){this.setProperty("collapsible",e)}_renderCollapsible(){this.$container.toggleClass("collapsible",this.collapsible),this.$header.toggleClass("disabled",!this.collapsible),this.$footer.setVisible(this.collapseStyle===mi.CollapseStyle.BOTTOM&&(this.headerVisible||this.collapsible)),this.$collapseIcon.setVisible(this.collapsible),this.invalidateLayoutTree()}setCollapseStyle(e){this.setProperty("collapseStyle",e)}_renderCollapseStyle(){if(this.$header.toggleClass("collapse-right",this.collapseStyle===mi.CollapseStyle.RIGHT),this.$container.toggleClass("collapse-bottom",this.collapseStyle===mi.CollapseStyle.BOTTOM),this.collapseStyle===mi.CollapseStyle.RIGHT&&!this.header)this.$collapseIcon.appendTo(this.$header);else if(this.collapseStyle===mi.CollapseStyle.LEFT&&!this.header)this.$collapseIcon.prependTo(this.$header);else if(this.collapseStyle===mi.CollapseStyle.BOTTOM){let e=this.body.$container?this.body.$container:this.$header;this.$footer.insertAfter(e),this.$collapseIcon.insertAfter(this.$collapseBorderLeft)}this._renderCollapsible(),this.invalidateLayoutTree()}_onHeaderMouseDown(e){this.collapsible&&(!this.header||this.collapseStyle!==mi.CollapseStyle.BOTTOM)&&this.setCollapsed(!this.collapsed&&this.collapsible)}_onFooterMouseDown(e){this.collapsible&&this.setCollapsed(!this.collapsed&&this.collapsible)}resizeBody(){this.animateToggleCollapse().done(()=>{this.bodyAnimating||(this.collapsed&&this.body.remove(),this.invalidateLayoutTree())})}animateToggleCollapse(){let e=v.cssSize(this.body.$container),t=v.margins(this.body.$container),s=v.paddings(this.body.$container),r,n,o;return this.collapsed?(r=0,n=new Ge,o=new Ge):(r=this.body.htmlComp.prefSize({widthHint:e.width}).height,this.body.htmlComp.setSize(new F(this.body.$container.outerWidth(),r)),this.bodyAnimating?(this.body.$container.cssMarginY("").cssPaddingY(""),n=v.margins(this.body.$container),o=v.paddings(this.body.$container)):(e.height=0,t=new Ge,s=new Ge,n=v.margins(this.body.$container),o=v.paddings(this.body.$container))),this.bodyAnimating=!0,this.collapsed&&this.$container.addClass("collapsing"),this.body.$container.stop(!0).cssHeight(e.height).cssMarginTop(t.top).cssMarginBottom(t.bottom).cssPaddingTop(s.top).cssPaddingBottom(s.bottom).animate({height:r,marginTop:n.top,marginBottom:n.bottom,paddingTop:o.top,paddingBottom:o.bottom},{duration:350,progress:()=>{this.trigger("bodyHeightChange"),this.revalidateLayoutTree()},complete:()=>{this.bodyAnimating=!1,this.body.rendered&&(this.body.$container.cssMarginY(""),this.body.$container.cssPaddingY("")),this.rendered&&this.$container.removeClass("collapsing"),this.trigger("bodyHeightChangeDone")}}).promise()}}nt(mi,"CollapseStyle",{LEFT:"left",RIGHT:"right",BOTTOM:"bottom"});class IC extends I{_render(){this.$container=this.$parent.appendDiv("group"),this.htmlComp=T.install(this.$container,this.session)}}class Lm extends ke{constructor(){super(),this._addRemoteProperties(["collapsed"])}}function LC(i,e,t){return e=OC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function OC(i){var e=BC(i,"string");return typeof e=="symbol"?e:String(e)}function BC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Md extends ee{constructor(e){super(),LC(this,"group",void 0),this.group=e}layout(e){let t=this.group.htmlComp,s=t.availableSize().subtract(t.insets()),r=this.group.htmlHeader,n=r.prefSize({widthHint:s.width});n.width=s.width,n=n.subtract(r.margins()),r.setSize(n);let o=this.group.htmlFooter;if(o.isVisible()){let d=o.prefSize({includeMargin:!1,useCssSize:!0});d.width=s.width,o.setSize(d.subtract(o.margins()))}if(this.group.collapsed||this.group.bodyAnimating||!this.group.body.rendered||!this.group.body.isVisible())return;let l=this.group.body.htmlComp,h=s.subtract(l.margins());h.height-=n.height,o.isVisible()&&(h.height-=o.prefSize(!0).height),l.setSize(h)}invalidate(e){this.group.body.htmlComp&&this.group.bodyAnimating&&e&&e.isDescendantOf(this.group.htmlComp)&&(this.group.body.$container.stop(),this.group.resizeBody())}preferredLayoutSize(e,t){t=t||{};let s,r=this.group.htmlComp,n=this.group.htmlHeader,o=this.group.body.htmlComp,l=this.group.htmlFooter;return t.heightHint=null,this.group.bodyAnimating?s=o.size(!0):this.group.collapsed||!this.group.body.rendered||!this.group.body.isVisible()?s=new F(0,0):s=o.prefSize(t).add(o.margins()),s=s.add(r.insets({includeMargin:!0})),s.height+=n.prefSize(t).add(n.margins()).height,l.isVisible()&&(s.height+=l.prefSize({includeMargin:!0,useCssSize:!0}).height),s}}class Id extends O{constructor(e){super(),this.field=e,this.which=[g.SPACE]}handle(e){this.field.toggleCollapse()}}function ma(i,e,t){return e=kC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function kC(i){var e=HC(i,"string");return typeof e=="symbol"?e:String(e)}function HC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Zs extends I{constructor(){super(),ma(this,"autoFit",void 0),ma(this,"iconDesc",void 0),ma(this,"image",void 0),ma(this,"prepend",void 0),this.autoFit=!1,this.iconDesc=null,this.image=null,this.prepend=!1}_init(e){super._init(e),this._setIconDesc(this.iconDesc)}_render(){this._renderIconDesc()}setIconDesc(e){this.setProperty("iconDesc",e)}_setIconDesc(e){e=ni.ensure(e),this._setProperty("iconDesc",e)}_renderIconDesc(){this._removeFontIcon(),this._removeImageIcon(),!this.iconDesc||this.iconDesc.isFontIcon()?this._renderFontIcon():this._renderImageIcon(),this.rendering||this._renderProperties(),this.invalidateLayoutTree()}_renderFontIcon(){this.$container=this.$parent.appendIcon(this.iconDesc),this.prepend&&this.$container.prependTo(this.$parent),this.htmlComp=T.install(this.$container,this.session)}_removeFontIcon(){this.$container&&(this.$container.remove(),this.$container=null)}_renderImageIcon(){this.image||(this.image=u.create(ga,{parent:this,imageUrl:this.iconDesc.iconUrl,cssClass:"icon image-icon",autoFit:this.autoFit,prepend:this.prepend}),this.image.render(this.$parent),this.image.one("destroy",()=>{this.image=null}),this.image.on("load error",e=>{this.trigger(e.type,e)}),this.$container=this.image.$container,this.htmlComp=this.image.htmlComp)}_removeImageIcon(){this.image&&(this.image.destroy(),this.image=null)}setAutoFit(e){this.setProperty("autoFit",e),this.image&&this.image.setAutoFit(e)}}function to(i,e,t){return e=NC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function NC(i){var e=VC(i,"string");return typeof e=="symbol"?e:String(e)}function VC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ni{constructor(){to(this,"iconType",void 0),to(this,"font",void 0),to(this,"iconCharacter",void 0),to(this,"iconUrl",void 0),this.iconType=null,this.font=null,this.iconCharacter=null,this.iconUrl=null}cssClass(){return this.isFontIcon()&&this.font!==ni.DEFAULT_FONT?"font-"+this.font:""}appendCssClass(e){let t=this.cssClass();return t.length>0?e+" "+t:e}isFontIcon(){return this.iconType===ni.IconType.FONT_ICON}isBitmap(){return this.iconType===ni.IconType.BITMAP}static ensure(e){return!e||e instanceof ni?e:ye.parseIconId(e)}}to(ni,"IconType",{FONT_ICON:0,BITMAP:1}),to(ni,"DEFAULT_FONT","scoutIcons");function Ld(i,e,t){return e=WC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function WC(i){var e=zC(i,"string");return typeof e=="symbol"?e:String(e)}function zC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ga extends I{constructor(){super(),Ld(this,"autoFit",void 0),Ld(this,"imageUrl",void 0),Ld(this,"prepend",void 0),this.autoFit=!1,this.imageUrl=null,this.prepend=!1}_render(){this.$container=this.$parent.makeElement("<img>","image").addDeviceClass().on("load",this._onImageLoad.bind(this)).on("error",this._onImageError.bind(this)),this.prepend?this.$container.prependTo(this.$parent):this.$container.appendTo(this.$parent),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new Od(this)),this.htmlComp.pixelBasedSizing=!1}_renderProperties(){super._renderProperties(),this._renderImageUrl(),this._renderAutoFit()}_remove(){super._remove(),this.htmlComp=null}setImageUrl(e){this.setProperty("imageUrl",e)}_renderImageUrl(){this.$container.attr("src",this.imageUrl),this.imageUrl||this.$container.addClass("empty").removeClass("broken")}setAutoFit(e){this.setProperty("autoFit",e)}_renderAutoFit(){this.$container.toggleClass("autofit",this.autoFit)}_onImageLoad(e){!this.rendered||(this._ensureImageLayout(),this.$container.removeClass("empty broken"),this.invalidateLayoutTree(),this.trigger("load"))}_ensureImageLayout(){!x.get().isChrome()||(this.$container.addClass("chrome-fix"),setTimeout(()=>{this.rendered&&this.$container.removeClass("chrome-fix")}))}_onImageError(e){!this.rendered||(this.$container.addClass("empty broken"),this.invalidateLayoutTree(),this.trigger("error"))}}function KC(i,e,t){return e=GC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function GC(i){var e=UC(i,"string");return typeof e=="symbol"?e:String(e)}function UC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Od extends ee{constructor(e){super(),KC(this,"image",void 0),this.image=e}preferredLayoutSize(e,t){let s=e[0];if(s&&s.complete&&s.naturalWidth>0&&s.naturalHeight>0){let r=s.naturalHeight,n=s.naturalWidth;return t.widthHint>0&&t.widthHint<s.naturalWidth?(r=t.widthHint/s.naturalWidth*s.naturalHeight,n=t.widthHint):t.heightHint>0&&t.heightHint<s.naturalHeight&&(r=t.heightHint,n=t.heightHint/s.naturalHeight*s.naturalWidth),new F(n,r)}return super.preferredLayoutSize(e,t)}}function nn(i,e,t){return e=qC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function qC(i){var e=YC(i,"string");return typeof e=="symbol"?e:String(e)}function YC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Bd extends I{constructor(){super(),nn(this,"status",void 0),nn(this,"closable",void 0),nn(this,"htmlEnabled",void 0),nn(this,"$content",void 0),nn(this,"$messageText",void 0),nn(this,"$closer",void 0),nn(this,"_icon",void 0),this.status=E.info(),this.closable=!1,this.htmlEnabled=!1,this._icon=null}_init(e){super._init(e),(e.severity||e.message||e.iconId)&&(this.status=new E({severity:u.nvl(e.severity,this.status.severity),message:u.nvl(e.message,this.status.message),iconId:u.nvl(e.iconId,this.status.iconId)})),Ce.resolveTextProperty(this.status,"message",this.session),this._setStatus(this.status)}_render(){this.$container=this.$parent.appendDiv("notification"),this.$content=this.$container.appendDiv("notification-content"),this.$messageText=this.$content.appendDiv("notification-message"),this.htmlComp=T.install(this.$container,this.session)}_remove(){super._remove(),this._removeCloser(),this._removeIcon()}_renderProperties(){super._renderProperties(),this._renderStatus(),this._renderClosable()}setStatus(e){this.setProperty("status",e)}_setStatus(e){this.rendered&&this._removeStatus(),e=E.ensure(e)||E.info(),this._setProperty("status",e)}_removeStatus(){this.status&&this.$container.removeClass(this.status.cssClass())}_renderStatus(){this.status&&(this.$container.addClass(this.status.cssClass()),this._renderIconId()),this._renderMessage()}_renderMessage(){let e=this.status.message||"";this.htmlEnabled?(this.$messageText.html(e),this.$messageText.find(".app-link").on("click",this._onAppLinkAction.bind(this))):this.$messageText.html(y.nl2br(e)),this.invalidateLayoutTree()}setIconId(e){this.status||(this.status=E.info()),this.status.iconId=e,this.rendered&&this._renderStatus()}_renderIconId(){let e=this.status&&!!this.status.iconId;this.$container.toggleClass("has-icon",e),this.$container.toggleClass("no-icon",!e),e?this._renderIcon():this._removeIcon()}_renderIcon(){if(this._icon){this._icon.setIconDesc(this.status.iconId);return}this._icon=u.create(Zs,{parent:this,iconDesc:this.status.iconId,prepend:!0}),this._icon.one("destroy",()=>{this._icon=null}),this._icon.render(),this._icon.$container.addClass("notification-icon")}_removeIcon(){this._icon&&this._icon.destroy()}setClosable(e){this.setProperty("closable",e)}_renderClosable(){this.$container.toggleClass("closable",this.closable),this.$content.toggleClass("closable",this.closable),this.closable?this._renderCloser():this._removeCloser()}_removeCloser(){!this.$closer||(this.$closer.remove(),this.$closer=null)}_renderCloser(){this.$closer||(this.$closer=this.$content.appendDiv("closer").on("click",this._onCloseIconClick.bind(this)))}_onCloseIconClick(e){this.removing||this.trigger("close")}_onAppLinkAction(e){let s=a()(e.delegateTarget).data("ref");this.triggerAppLinkAction(s)}triggerAppLinkAction(e){this.trigger("appLinkAction",{ref:e})}}class kd extends ke{_onWidgetClose(e){this._send("close")}_onWidgetAppLinkAction(e){this._send("appLinkAction",{ref:e.ref})}_onWidgetEvent(e){e.type==="close"?this._onWidgetClose(e):e.type==="appLinkAction"?this._onWidgetAppLinkAction(e):super._onWidgetEvent(e)}}const We={filterAccordingToSelection(i,e,t,s,r){let n=[],{notAllowedTypes:o}=r||{};s===It.MENU_BAR?n=[i+".EmptySpace",i+".SingleSelection",i+".MultiSelection"]:s===It.CONTEXT_MENU?n=[i+".SingleSelection",i+".MultiSelection"]:s===It.HEADER&&(n=[i+".Header"]),n.indexOf(i+".SingleSelection")>-1&&e!==1&&p.remove(n,i+".SingleSelection"),n.indexOf(i+".MultiSelection")>-1&&e<=1&&p.remove(n,i+".MultiSelection"),o=p.ensure(o);let l=[];return i=i+".",o.forEach(h=>{h.slice(0,i.length)!==i&&(h=i+h),l.push(h)},this),We.filter(t,n,a().extend({},r,{notAllowedTypes:l}))},filter(i,e,t){if(!i)return;e=p.ensure(e);let{onlyVisible:s,enableDisableKeyStrokes:r,notAllowedTypes:n,defaultMenuTypes:o}=t||{};n=p.ensure(n),o=p.ensure(o);let l=[],h=0;return i.forEach(d=>{let c=d.childActions;if(c.length>0){if(c=We.filter(c,e,t),c.length===0){We._enableDisableMenuKeyStroke(d,r,!0);return}}else if(!We._checkType(d,e,o)||n.length!==0&&We._checkType(d,n,o)){We._enableDisableMenuKeyStroke(d,r,!0);return}if(s&&!d.visible){We._enableDisableMenuKeyStroke(d,r,!0);return}d.separator&&h++,We._enableDisableMenuKeyStroke(d,r,!1),l.push(d)}),h===l.length?[]:l},updateSeparatorVisibility(i){if(i=p.ensure(i),i=i.filter(s=>s.visible||s.separator),i.length===0)return;let e=!1,t=!1;i.forEach((s,r)=>{if(!s.ellipsis){if(!s.separator){e=!0;return}t=i[r+1]&&!i[r+1].separator&&!i[r+1].ellipsis,!e||!t?s.visibleOrig===void 0&&(s.visibleOrig=s.visible,s.setVisible(!1)):s.visibleOrig!==void 0&&(s.setVisible(s.visibleOrig),s.visibleOrig=void 0)}})},checkType(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return e=p.ensure(e),i.childActions.length>0?We.filter(i.childActions,e).length>0:We._checkType(i,e,t)},_enableDisableMenuKeyStroke(i,e,t){e&&(i.excludedByFilter=t)},_checkType(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];if(!e||e.length===0)return!1;let s=p.ensure(i.menuTypes);t=p.ensure(t),s.length===0&&(s=t);for(let r=0;r<e.length;r++)if(s.indexOf(e[r])>-1)return!0;return!1},createEllipsisMenu(i){return u.create(tl,i)},moveMenuIntoEllipsis(i,e){i.remove(),i._setOverflown(!0),i.overflowMenu=e;let t=e.childActions.slice();t.unshift(i),e.setChildActions(t)},removeMenuFromEllipsis(i,e){i._setOverflown(!1),i.overflowMenu=null,i.rendered||i.render(e)}};var It;(function(i){i[i.MENU_BAR=1]="MENU_BAR",i[i.CONTEXT_MENU=2]="CONTEXT_MENU",i[i.HEADER=3]="HEADER"})(It||(It={}));function Je(i,e,t){return e=jC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function jC(i){var e=XC(i,"string");return typeof e=="symbol"?e:String(e)}function XC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ne extends re{constructor(){super(),Je(this,"childActions",void 0),Je(this,"defaultMenu",void 0),Je(this,"excludedByFilter",void 0),Je(this,"menuTypes",void 0),Je(this,"menuStyle",void 0),Je(this,"uiCssClass",void 0),Je(this,"overflown",void 0),Je(this,"overflowMenu",void 0),Je(this,"parentMenu",void 0),Je(this,"ellipsis",void 0),Je(this,"rightAligned",void 0),Je(this,"popup",void 0),Je(this,"popupHorizontalAlignment",void 0),Je(this,"popupVerticalAlignment",void 0),Je(this,"stackable",void 0),Je(this,"separator",void 0),Je(this,"shrinkable",void 0),Je(this,"subMenuVisibility",void 0),Je(this,"menuFilter",void 0),Je(this,"createdBy",void 0),Je(this,"$submenuIcon",void 0),Je(this,"$subMenuBody",void 0),Je(this,"$placeHolder",void 0),this.childActions=[],this.defaultMenu=null,this.excludedByFilter=!1,this.menuTypes=[],this.menuStyle=ne.MenuStyle.NONE,this.overflown=!1,this.parentMenu=null,this.popup=null,this.popupHorizontalAlignment=void 0,this.popupVerticalAlignment=void 0,this.stackable=!0,this.separator=!1,this.shrinkable=!1,this.rightAligned=!1,this.subMenuVisibility=ne.SubMenuVisibility.DEFAULT,this.menuFilter=null,this.$submenuIcon=null,this.$subMenuBody=null,this._addCloneProperties(["defaultMenu","menuTypes","overflow","stackable","separator","shrinkable","parentMenu","menuFilter","subMenuVisibility"]),this._addWidgetProperties("childActions")}_init(e){super._init(e),this._setChildActions(this.childActions)}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.registerKeyStroke(new Nd(this))}_render(){this.separator?this._renderSeparator():this._renderItem(),this.$container.unfocusable(),this.htmlComp=T.install(this.$container,this.session)}_renderProperties(){super._renderProperties(),this._renderOverflown(),this._renderMenuStyle(),this._renderActionStyle(),this._updateIconAndTextStyle()}_remove(){super._remove(),this.$submenuIcon=null,this.$subMenuBody=null}_renderSeparator(){this.$container=this.$parent.appendDiv("menu-separator")}_renderItem(){this.$container=this.$parent.appendDiv("menu-item"),this.uiCssClass&&this.$container.addClass(this.uiCssClass);let e=this._onMouseEvent.bind(this);this.$container.on("mousedown",e).on("contextmenu",e).on("click",e),this._renderSubMenuIcon()}_renderActionStyle(){this.$container.toggleClass("menu-button",this.isButton()&&!this.overflown)}_renderSelected(){this._doActionTogglesSubMenu()||(super._renderSelected(),this.parent instanceof ft&&this.parent.updateNextToSelected()),this.selected?this._doActionTogglesSubMenu()?this._renderSubMenuItems(this,this.childActions):this._doActionTogglesPopup()&&this._openPopup():this._doActionTogglesSubMenu()&&this.rendered?this._removeSubMenuItems(this):(this._closePopup(),this._closeSubMenus()),this.$container.toggleClass("has-popup",this._doActionTogglesSubMenu()||this._doActionTogglesPopup())}_closeSubMenus(){this.childActions.forEach(e=>{e._doActionTogglesPopup()&&(e._closeSubMenus(),e.setSelected(!1))})}_removeSubMenuItems(e){this.parent instanceof ft?this.parent.removeSubMenuItems(e,!0):this.parent instanceof ne&&this.parent._removeSubMenuItems(e)}_renderSubMenuItems(e,t){let s=this.parent;if(s instanceof ft){s.renderSubMenuItems(e,t,!0);let r=o=>e.setSelected(!1),n=o=>{o.newValue===!1&&(s.off("destroy",r),e.off("propertyChange:selected",n))};s.one("destroy",r),e.on("propertyChange:selected",n)}else s instanceof ne&&s._renderSubMenuItems(e,t)}_togglesSubMenu(){return!0}_doActionTogglesSubMenu(){return this.childActions.length?this.parent instanceof ft?!0:this.parent instanceof ne?this.parent._togglesSubMenu():!1:!1}_onMouseEvent(e){e.type==="mousedown"&&this._doubleClickSupport.mousedown(e),this._allowMouseEvent(e)&&(K.cancel(this.$container),e.type==="mousedown"&&this._doActionTogglesPopup()?this.doAction():(e.type==="click"||e.type==="contextmenu")&&!this._doActionTogglesPopup()&&this.doAction())}_doActionTogglesPopup(){return this.childActions.length>0}_renderChildActions(){this.rendering||this._renderSubMenuIcon()}setSubMenuVisibility(e){this.setProperty("subMenuVisibility",e)}_renderSubMenuVisibility(){this._renderSubMenuIcon()}_renderSubMenuIcon(){let e=!1;if(this.childActions.length>0)switch(this.subMenuVisibility){case ne.SubMenuVisibility.DEFAULT:e=this._hasText();break;case ne.SubMenuVisibility.TEXT_OR_ICON:e=this._hasText()||!!this.iconId;break;case ne.SubMenuVisibility.ALWAYS:e=!0;break;case ne.SubMenuVisibility.NEVER:e=!1;break}if(e){if(!this.$submenuIcon){let t=ye.parseIconId(ne.SUBMENU_ICON);this.$submenuIcon=this.$container.appendSpan("submenu-icon").text(t.iconCharacter),this.invalidateLayoutTree()}}else this.$submenuIcon&&(this.$submenuIcon.remove(),this.$submenuIcon=null,this.invalidateLayoutTree());this.rendering||(this._renderTextPosition(),this._updateIconAndTextStyle())}_renderText(){super._renderText(),this.$container.toggleClass("has-text",y.hasText(this.text)&&this.textVisible),this.rendering||this._renderSubMenuIcon(),this.invalidateLayoutTree()}_renderTextPosition(){super._renderTextPosition();let e=this.$container;this.textPosition===re.TextPosition.BOTTOM&&this.$text&&this.iconId&&(e=this.$text),this.$submenuIcon&&this.$submenuIcon.appendTo(e)}_renderIconId(){super._renderIconId(),this.$container.toggleClass("has-icon",!!this.iconId),this.rendering||this._renderSubMenuIcon(),this.invalidateLayoutTree()}isTabTarget(){return this.enabledComputed&&this.visible&&!this.overflown&&(this.isButton()||!this.separator)&&(!this.parentMenu||this.parentMenu.visible&&!this.parentMenu.overflown)}recomputeEnabled(e){e===void 0&&(e=this._getInheritedAccessibility());let t,s;this.enabled&&this.inheritAccessibility&&!e&&this.childActions.length>0?(t=this._hasAccessibleChildMenu(),t?s=e:s=!1):(t=this._computeEnabled(this.inheritAccessibility,e),s=t),this._updateEnabledComputed(t,s)}_getInheritedAccessibility(){let e=this,t=e;for(;e;){if(!e.inheritAccessibility)return e.enabled;t=e,e=e.parentMenu}let s=t.parent;return s&&s.initialized&&s.enabledComputed!==void 0?s.enabledComputed:!0}_findRootMenu(){let e=this,t;for(;e;)t=e,e=e.parentMenu;return t}_hasAccessibleChildMenu(){let e=!1;return this.visitChildMenus(t=>!t.inheritAccessibility&&t.enabled&&t.visible?(e=!0,_e.TERMINATE):_e.CONTINUE),e}visitChildMenus(e){for(let t=0;t<this.childActions.length;t++){let s=this.childActions[t];if(s instanceof ne){let r=e(s);if(r===!0||r===_e.TERMINATE)return _e.TERMINATE;if(r!==_e.SKIP_SUBTREE&&(r=s.visitChildMenus(e),r===_e.TERMINATE))return _e.TERMINATE}}}_hasText(){return y.hasText(this.text)&&this.textVisible}_updateIconAndTextStyle(){let e=this._hasText(),t=!!(e&&this.iconId),s=!!this.iconId,r=!!this.$submenuIcon,n=s&&!r||!s&&r;this.$container.toggleClass("menu-textandicon",t),this.$container.toggleClass("menu-icononly",!e&&n)}_closePopup(){this.popup&&!this.popup.isRemovalPending()&&this.popup.close()}_canOpenPopup(){return this.popup&&this.popup.isRemovalPending()&&this.popup.removeImmediately(),!(this.popup||!this._doActionTogglesPopup())}_openPopup(){!this._canOpenPopup()||(this.popup=this._createPopup(),this.popup.open(),this.popup.one("destroy",e=>{this.popup=null}),this.popup.on("close",e=>this.setSelected(!1)),this.uiCssClass&&this.popup.$container.addClass(this.uiCssClass))}_createPopup(){return u.create(Qd,{parent:this,menu:this,menuFilter:this.menuFilter,horizontalAlignment:this.popupHorizontalAlignment,verticalAlignment:this.popupVerticalAlignment})}_createActionKeyStroke(){return new Hd(this)}isToggleAction(){return this.childActions.length>0||this.toggleAction}isButton(){return re.ActionStyle.BUTTON===this.actionStyle}addChildActions(e){this.insertChildActions(e)}insertChildAction(e){this.insertChildActions([e])}insertChildActions(e){if(e=p.ensure(e),e.length===0)return;let t=this.childActions;this.setChildActions(t.concat(e))}deleteChildAction(e){this.deleteChildActions([e])}deleteChildActions(e){if(e=p.ensure(e),e.length===0)return;let t=this.childActions.slice();p.removeAll(t,e),this.setChildActions(t)}setChildActions(e){this.setProperty("childActions",e)}_setChildActions(e){this.childActions.forEach(t=>{t.parentMenu=null}),this._setProperty("childActions",e),this.childActions.forEach(t=>{t.parentMenu=this}),this.initialized&&this.recomputeEnabled()}_setInheritAccessibility(e){this._setProperty("inheritAccessibility",e)&&this._recomputeEnabledInMenuHierarchy()}_setEnabled(e){this._setProperty("enabled",e)&&this._recomputeEnabledInMenuHierarchy()}_setVisible(e){this._setProperty("visible",e)&&this._recomputeEnabledInMenuHierarchy()}_recomputeEnabledInMenuHierarchy(){if(!this.initialized)return;let e=this._findRootMenu();e.recomputeEnabled(),e!==this&&this.recomputeEnabled()}setSelected(e){e!==this.selected&&(super.setSelected(e),!(!this._doActionTogglesSubMenu()&&!this._doActionTogglesPopup())&&this.overflowMenu&&!this.overflowMenu.selected&&this._handleSelectedInEllipsis())}_handleSelectedInEllipsis(){this.selected&&this.overflowMenu.setSelected(!0)}setStackable(e){this.setProperty("stackable",e)}_renderStackable(){this.invalidateLayoutTree()}setShrinkable(e){this.setProperty("shrinkable",e)}_renderShrinkable(){this.invalidateLayoutTree()}_setOverflown(e){this.overflown!==e&&(this._setProperty("overflown",e),this.rendered&&this._renderOverflown())}_renderOverflown(){this.$container.toggleClass("overflown",this.overflown),this._renderActionStyle()}setMenuTypes(e){this.setProperty("menuTypes",e)}setMenuStyle(e){this.setProperty("menuStyle",e)}_renderMenuStyle(){this.$container.toggleClass("default",this.menuStyle===ne.MenuStyle.DEFAULT)}setDefaultMenu(e){this.setProperty("defaultMenu",e)}setMenuFilter(e){this.setProperty("menuFilter",e),this.childActions.forEach(t=>t.setMenuFilter(e))}clone(e,t){let s=super.clone(e,t);return this._deepCloneProperties(s,"childActions",t),s._setChildActions(s.childActions),s}focus(){return this.trigger("focus").defaultPrevented?!1:super.focus()}}Je(ne,"SUBMENU_ICON",ye.ANGLE_DOWN_BOLD),Je(ne,"MenuStyle",{NONE:0,DEFAULT:1}),Je(ne,"SubMenuVisibility",{DEFAULT:"default",TEXT_OR_ICON:"textOrIcon",ALWAYS:"always",NEVER:"never"});function JC(i,e,t){return e=QC(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function QC(i){var e=ZC(i,"string");return typeof e=="symbol"?e:String(e)}function ZC(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class tl extends ne{constructor(){super(),JC(this,"hidden",void 0),this.hidden=!0,this.ellipsis=!0,this.stackable=!1,this.horizontalAlignment=1,this.iconId=ye.ELLIPSIS_V,this.tabbable=!1,this._addPreserveOnPropertyChangeProperties(["childActions"])}_render(){super._render(),this.$container.addClass("ellipsis")}setChildActions(e){super.setChildActions(e),e&&e.forEach(t=>t.setSelected(!1))}_renderProperties(){super._renderProperties(),this._renderHidden()}setHidden(e){this.setProperty("hidden",e)}_renderHidden(){this.$container.setVisible(!this.hidden)}isTabTarget(){return super.isTabTarget()&&!this.hidden}_childrenForEnabledComputed(){return this.childActions}}class il extends br{}class Hd extends sn{constructor(e){super(e)}_isEnabled(){return this.field.excludedByFilter?!1:super._isEnabled()}}class Nd extends aa{constructor(e){super(e),this.renderingHints.offset=16}}function sl(i,e,t){return e=eS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function eS(i){var e=tS(i,"string");return typeof e=="symbol"?e:String(e)}function tS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class io{constructor(e,t){sl(this,"session",void 0),sl(this,"objectType",void 0),sl(this,"emptySpaceTypes",void 0),sl(this,"selectionTypes",void 0),sl(this,"menuBar",void 0),this.session=e,this.objectType=t,this.emptySpaceTypes=["EmptySpace"],this.selectionTypes=["SingleSelection","MultiSelection"]}order(e){let t=[],s=[],r=[],n=[],o=!1,l=!1;return e.forEach(h=>{h.createdBy!==this&&(h.isButton()?t.push(h):h.horizontalAlignment===1?n.push(h):We.checkType(h,this._menuTypes(this.emptySpaceTypes))?(h.visible&&(o=!0),s.push(h)):We.checkType(h,this._menuTypes(this.selectionTypes))&&(h.visible&&(l=!0),r.push(h)))}),o&&l&&s.push(this._createSeparator()),{left:t.concat(s,r),right:n,all:t.concat(s,r).concat(n)}}_menuTypes(e){let t=[];e=e||[];for(let s=0;s<e.length;s++)t.push(this.objectType+"."+e[s]);return t}_createSeparator(){let e=u.create(ne,{parent:this.menuBar,separator:!0});return e.createdBy=this,e}}function iS(i,e,t){return e=sS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function sS(i){var e=rS(i,"string");return typeof e=="symbol"?e:String(e)}function rS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Vd extends ne{constructor(){super(),iS(this,"_childVisibleChangeHandler",void 0),this._childVisibleChangeHandler=this._onChildVisibleChange.bind(this)}_render(){this.$container=this.$parent.appendDiv("menu-item combo-menu"),this.uiCssClass&&this.$container.addClass(this.uiCssClass),this.$container.unfocusable(),this.htmlComp=T.install(this.$container,this.session)}_renderProperties(){super._renderProperties(),this._renderChildActions()}_setChildActions(e){this.childActions.forEach(t=>t.off("propertyChange:visible",this._childVisibleChangeHandler)),super._setChildActions(e),this.childActions.forEach(t=>t.on("propertyChange:visible",this._childVisibleChangeHandler))}_renderChildActions(){super._renderChildActions(),this.childActions.forEach(e=>{e.addCssClass("combo-menu-child"),e.render()}),Le.updateFirstLastMarker(this.childActions)}_togglesSubMenu(){return!1}_onChildVisibleChange(e){this.rendered&&Le.updateFirstLastMarker(this.childActions)}_doActionTogglesPopup(){return!1}isToggleAction(){return!1}isTabTarget(){return!1}}class Om extends il{}function vr(i,e,t){return e=nS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function nS(i){var e=oS(i,"string");return typeof e=="symbol"?e:String(e)}function oS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ft extends ue{constructor(){super(),vr(this,"menuItems",void 0),vr(this,"cloneMenuItems",void 0),vr(this,"bodyAnimating",void 0),vr(this,"animationDuration",void 0),vr(this,"$body",void 0),vr(this,"initialSubMenusToRender",void 0),vr(this,"menuFilter",void 0),vr(this,"_toggleSubMenuQueue",void 0),this.animateOpening=!0,this.animateRemoval=!0,this.menuItems=[],this.cloneMenuItems=!0,this.bodyAnimating=!1,this._toggleSubMenuQueue=[],this.animationDuration=300}_init(e){e.focusableContainer=!0,e.cloneMenuItems===!1&&this._addWidgetProperties("menuItems"),super._init(e)}_initKeyStrokeContext(){super._initKeyStrokeContext(),wr.registerKeyStrokes(this.keyStrokeContext,this,"menu-item")}_createLayout(){return new Wd(this)}_createBodyLayout(){return new Ri({pixelBasedSizing:!1})}_render(){super._render(),this.$container.addClass("context-menu-popup"),this._renderBody(),this._installScrollbars(),this._renderMenuItems()}_remove(){this._toggleSubMenuQueue=[],super._remove()}_renderBody(){this.$body=this.$container.appendDiv("context-menu"),T.install(this.$body,this.session).setLayout(this._createBodyLayout())}_installScrollbars(e){super._installScrollbars({axis:"y",scrollShadow:"none"})}_checkRemoveSubMenuItemsPossible(e,t){if(!this.rendered&&!this.rendering)return!1;let s=this.isOpeningAnimationRunning(),n=this.htmlComp.layout.resizeAnimationRunning;return this.bodyAnimating||s||n?(this._toggleSubMenuQueue.push(this.removeSubMenuItems.bind(this,e,t)),s&&this.$container.oneAnimationEnd(()=>this._processSubMenuQueue()),!1):!0}removeSubMenuItems(e,t){let s=e;if(!this._checkRemoveSubMenuItemsPossible(s,t))return;this.$body=s.__originalParent.$subMenuBody,this.$body.insertBefore(s.$subMenuBody),s.__originalParent._doActionTogglesSubMenu&&s.__originalParent._doActionTogglesSubMenu();let r=this.htmlComp.bounds();this._adjustTextAlignment(),T.get(this.$body).invalidateLayoutTree(),this.validateLayoutTree(),this.position(),t&&this._animateRemoveSubmenuItems(s,r)}_animateRemoveSubmenuItems(e,t){let s=e.$placeHolder.position(),r=this.htmlComp.insets(),n=this.htmlComp.bounds(),o=T.get(e.$subMenuBody).bounds(),l=T.get(this.$body).bounds(),h=new ie(0,r.top,o.width,o.height),d=new ie(0,r.top+s.top,l.width,e.$container.cssHeight());this.bodyAnimating=!0,this.$container.addClass("animating"),this.htmlComp.layout.disableAutoPosition(),this._animateResizePopup(this.htmlComp.$comp,t,n),this._animateTextOffset(e.$subMenuBody,e.$subMenuBody.data("text-offset")),e.$subMenuBody.cssWidthAnimated(h.width,d.width,{duration:this.animationDuration,progress:this.revalidateLayout.bind(this),complete:()=>this._completeAnimateRemoveSubMenuItems(e),queue:!1}).cssHeightAnimated(h.height,d.height,{duration:this.animationDuration,queue:!1}).cssTopAnimated(h.y,d.y,{duration:this.animationDuration,queue:!1}),this.$body.cssWidthAnimated(o.width,l.width,{duration:this.animationDuration,queue:!1}).cssHeightAnimated(o.height,l.height,{duration:this.animationDuration,queue:!1})}_completeAnimateRemoveSubMenuItems(e){this.bodyAnimating=!1,!(!this.rendered||!e.$container)&&(this.$container.removeClass("animating"),e.$placeHolder.replaceWith(e.$container),e.$container.toggleClass("expanded",!1),this._updateFirstLastClass(),this.updateNextToSelected("menu-item",e.$container),e.$subMenuBody.detach(),this._processSubMenuQueue())}_processSubMenuQueue(){let e=this._toggleSubMenuQueue.shift();e&&e()}_checkRenderSubMenuItemsPossible(e,t,s,r){if(!this.session.desktop.rendered&&!r)return this.initialSubMenusToRender={parentMenu:e,menus:t},!1;if(!this.rendered&&!this.rendering)return!1;let n=this.isOpeningAnimationRunning(),l=this.htmlComp.layout.resizeAnimationRunning;return this.bodyAnimating||n||l?(this._toggleSubMenuQueue.push(this.renderSubMenuItems.bind(this,e,t,s,r)),n&&this.$container.oneAnimationEnd(()=>this._processSubMenuQueue()),!1):!0}renderSubMenuItems(e,t,s,r){let n=e;if(!this._checkRenderSubMenuItemsPossible(n,t,s,r))return!1;let o=this.htmlComp.bounds(),l=this.$body;n.__originalParent.$subMenuBody=l,this.$body.find(".menu-item").removeClass("next-to-selected"),n.$subMenuBody?this.$body=n.$subMenuBody:(this._renderBody(),n.$subMenuBody=this.$body,this._renderMenuItems(t,r));let d=n.$container.prev(),c=n.$container.position();n.$placeHolder=n.$container.clone(),T.install(n.$placeHolder,this.session),d.length?n.$placeHolder.insertAfter(d):l.prepend(n.$placeHolder),this.$body.insertAfter(l),this.$body.prepend(n.$container),n.$container.toggleClass("expanded"),this._adjustTextAlignment(),T.get(this.$body).invalidateLayoutTree(),this.validateLayoutTree(),this.position(),this.updateNextToSelected(),s?this._animateRenderSubMenuItems(n,o,c):(l.detach(),this._updateFirstLastClass())}_animateRenderSubMenuItems(e,t,s){let r=e,n=r.__originalParent.$subMenuBody,o=this.htmlComp.bounds(),l=this.htmlComp.insets(),h=v.bounds(n),d=T.get(this.$body).bounds(),c=new ie(0,l.top+s.top,h.width,r.$container.cssHeight()),f=new ie(0,l.top,d.width,d.height);this.bodyAnimating=!0,this.$container.addClass("animating"),this.htmlComp.layout.disableAutoPosition(),this._animateResizePopup(this.htmlComp.$comp,t,o),this._animateTextOffset(this.$body,n.data("text-offset")),this.$body.cssWidthAnimated(c.width,f.width,{duration:this.animationDuration,progress:this.revalidateLayout.bind(this),complete:()=>this._completeAnimateRenderSubMenuItems(n),queue:!1}).cssHeightAnimated(c.height,f.height,{duration:this.animationDuration,queue:!1}).cssTopAnimated(c.y,f.y,{duration:this.animationDuration,queue:!1}),n.cssWidthAnimated(h.width,f.width,{duration:this.animationDuration,queue:!1}).cssHeightAnimated(h.height,f.height,{duration:this.animationDuration,queue:!1})}_completeAnimateRenderSubMenuItems(e){if(this.bodyAnimating=!1,!this.rendered)return;this.$container.removeClass("animating"),e&&(e.detach(),this.$body.cssTop(""),this._updateFirstLastClass()),this.htmlComp.layout.resetAutoPosition(),this._processSubMenuQueue()}_animateResizePopup(e,t,s){let r={duration:this.animationDuration,queue:!1};e.cssTopAnimated(t.y,s.y,r).cssLeftAnimated(t.x,s.x,r).cssWidthAnimated(t.width,s.width,r).cssHeightAnimated(t.height,s.height,r)}_animateTextOffset(e,t,s){s=u.nvl(s,this.$body.data("text-offset")),this.$visibleMenuItems(e).each((n,o)=>{let l=a()(o),h=l.children(".text"),d=this._calcTextPaddingLeft(l,t),c=this._calcTextPaddingLeft(l,s);h.cssAnimated({paddingLeft:d},{paddingLeft:c},{duration:this.animationDuration})})}_renderMenuItems(e,t){e=e||this._getMenuItems(),this.menuFilter&&(e=this.menuFilter(e,It.CONTEXT_MENU)),!(!e||e.length===0)&&(e.forEach(s=>{if(s.separator)return;let r=s.parent;(this.cloneMenuItems&&!s.cloneOf||!this.has(s))&&(s=s.clone({parent:this,textPosition:re.TextPosition.DEFAULT},{delegateEventsToOriginal:["acceptInput","action","click"],delegateAllPropertiesToClone:!0,delegateAllPropertiesToOriginal:!0,excludePropertiesToOriginal:["selected","logicalGrid","tabbable"]}),s.setTabbable(!1),this._attachCloneMenuListeners(s)),s.__originalParent||(s.__originalParent=r),s.render(this.$body),s.$container.removeClass("menu-button"),this._attachMenuListeners(s)}),this._handleInitialSubMenus(t),this._updateFirstLastClass(),this._adjustTextAlignment())}_attachCloneMenuListeners(e){e.on("propertyChange",this._onCloneMenuPropertyChange.bind(this)),e.childActions.forEach(this._attachCloneMenuListeners.bind(this))}_onCloneMenuPropertyChange(e){e.propertyName==="selected"&&e.source.cloneOf.triggerPropertyChange("selected",e.oldValue,e.newValue)}_handleInitialSubMenus(e){if(e)return;let t;for(;this.initialSubMenusToRender;)t=this.initialSubMenusToRender,this.initialSubMenusToRender=void 0,this.renderSubMenuItems(t.parentMenu,t.menus,!1,!0)}_attachMenuListeners(e){let t=this._onMenuItemAction.bind(this),s=this._onMenuItemPropertyChange.bind(this);e.on("action",t),e.on("propertyChange",s),this.one("remove",()=>{e.off("action",t),e.off("propertyChange",s)})}updateMenuItems(e){e=p.ensure(e),p.equals(this.menuItems,e)||this.close()}_getMenuItems(){return this.menuItems}$menuItems(){return this.$body.children(".menu-item")}$visibleMenuItems(e){return e=e||this.$body,e.children(".menu-item:visible")}_updateFirstLastClass(){let e,t;this.$body.children(".menu-item").each(function(){let s=a()(this);s.removeClass("first last"),s.isVisible()&&(e||(e=s),t=s)}),e&&e.addClass("first"),t&&t.addClass("last")}updateNextToSelected(e,t){e=e||"menu-item";let s=this.$body.find("."+e);t=t||this.$body.find("."+e+".selected"),s.removeClass("next-to-selected"),t.hasClass("selected")&&t.nextAll(":visible").first().addClass("next-to-selected")}_onMenuItemAction(e){e.source.isToggleAction()||e.defaultPrevented||this.close()}_onMenuItemPropertyChange(e){!this.rendered||(e.propertyName==="visible"?this._updateFirstLastClass():e.propertyName==="selected"&&this._deselectSiblings(e.source),this.position())}_deselectSiblings(e){e.$container.siblings(".menu-item").each((t,s)=>{a()(s).select(!1)})}_adjustTextAlignment(e){e=e||this.$body;let t=this.$visibleMenuItems(e),s=this._calcTextOffset(t);e.data("text-offset",s),this._updateTextOffset(s,t)}_calcTextOffset(e){let t=0;return e=e||this.$visibleMenuItems(),e.each((s,r)=>{let o=a()(r).children(".icon"),l=0;o.length>0&&(l=o.outerWidth(!0)),t=Math.max(t,l)}),t}_updateTextOffset(e,t){t=t||this.$visibleMenuItems(),t.each((s,r)=>{let n=a()(r);n.children(".text").css("padding-left",this._calcTextPaddingLeft(n,e));let l=T.optGet(n);l&&l.invalidateLayout()})}_calcTextPaddingLeft(e,t){let s=e.children(".icon"),r=0;return s.length>0&&(r=s.outerWidth(!0)),t-r}}class Wd extends Ii{constructor(e){super(e)}_setSize(e){if(this.popup.bodyAnimating){P.update(this.popup.get$Scrollable());return}super._setSize(e),P.update(this.popup.get$Scrollable()),T.get(this.popup.$body).pack()}invalidate(e){this.popup.bodyAnimating&&e&&e.isDescendantOf(this.popup.htmlComp)&&this.popup._toggleSubMenuQueue.unshift(()=>{if(!this.popup.rendered)return;let t=this.popup.$body.data("text-offset");this.popup._adjustTextAlignment(),this.popup.animateResize=!0,this.resizeAnimationDuration=this.popup.animationDuration,this.popup.revalidateLayoutTree(),this.popup.animateResize=!1,this.popup._animateTextOffset(this.popup.$body,t),this.popup.$container.promise().done(()=>this.popup._processSubMenuQueue())})}preferredLayoutSize(e,t){let s=this.popup.htmlComp,r=T.get(this.popup.$body),n;if(this.popup.bodyAnimating)n=v.size(this.popup.$body,t);else{let o=this.popup.$container.attr("style"),l=this.popup.$body.siblings(".context-menu");l.addClass("hidden"),this.popup.$body.css({width:"auto",height:"auto"}),r=T.get(this.popup.$body),n=r.prefSize(t),l.removeClass("hidden"),this.popup.$container.attr("style",o)}return n.add(s.insets()).add(r.margins())}}function lS(i,e,t){return e=aS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function aS(i){var e=hS(i,"string");return typeof e=="symbol"?e:String(e)}function hS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class rl extends O{constructor(e){super(),lS(this,"_menuItemClass",void 0),this.field=e,this.inheritAccessibility=!1}_accept(e){let t=super._accept(e);return!t||this.field.bodyAnimating?!1:t}_changeSelection(e,t){t.length!==0&&(t.select(!0).focus(),this.field.updateNextToSelected&&this.field.updateNextToSelected(this._menuItemClass,t),e.length>0&&e.select(!1))}}class nl extends rl{constructor(e,t){super(e),this._menuItemClass=t,this.stopImmediatePropagation=!0,this.which=[g.ENTER,g.SPACE],this.renderingHints.render=!1}handle(e){let t=wr._findMenuItems(this.field,this._menuItemClass).$selected;t.length>0&&t.data("widget").doAction()}}class zd extends nl{constructor(e,t){super(e,t),this._menuItemClass=t,this.which=[g[1],g[2],g[3],g[4],g[5],g[6],g[7],g[8],g[9]],this.renderingHints.render=!0,this.renderingHints.hAlign=ht.RIGHT,this.renderingHints.$drawingArea=(s,r)=>r.$menuItem}_accept(e){if(!super._accept(e))return!1;let s=wr._findMenuItems(this.field,this._menuItemClass),r=g.codesToKeys[e.which];return e.$menuItem=s.$allVisible.eq(r-1),e.$menuItem.length>0}handle(e){e.$menuItem.data("widget").doAction()}}class Kd extends rl{constructor(e,t){super(e),this._menuItemClass=t,this.which=[g.DOWN],this.renderingHints.render=!1}handle(e){let t=wr._findMenuItems(this.field,this._menuItemClass);t.$selected.length>0?this._changeSelection(t.$selected,t.$selected.nextAll(":visible").first()):this._changeSelection(t.$selected,t.$allVisible.first())}}class Gd extends rl{constructor(e,t){super(e),this._menuItemClass=t,this.which=[g.UP],this.renderingHints.render=!1}handle(e){let t=wr._findMenuItems(this.field,this._menuItemClass);t.$selected.length>0?this._changeSelection(t.$selected,t.$selected.prevAll(":visible").first()):this._changeSelection(t.$selected,t.$allVisible.last())}}class Ud extends nl{constructor(e,t){super(e,t),this._menuItemClass=t,this.which=[g.BACKSPACE],this.renderingHints.render=!0,this.renderingHints.$drawingArea=(s,r)=>r.$menuItem}_accept(e){if(!super._accept(e))return!1;let s=wr._findMenuItems(this.field,this._menuItemClass+".expanded");return s.$all.length>0?(e.$menuItem=s.$all,!0):!1}handle(e){e.$menuItem.data("widget").doAction()}}const wr={registerKeyStrokes(i,e,t){i.registerKeyStrokes([new Gd(e,t),new Kd(e,t),new nl(e,t),new zd(e,t),new Ud(e,t)])},_findMenuItems(i,e){return{$all:i.$body.find("."+e),$allVisible:i.$body.find("."+e+":visible"),$selected:i.$body.find("."+e+".selected")}}};function _a(i,e,t){return e=dS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function dS(i){var e=uS(i,"string");return typeof e=="symbol"?e:String(e)}function uS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class so extends ne{constructor(){super(),_a(this,"button",void 0),_a(this,"menubar",void 0),_a(this,"_buttonPropertyChangeHandler",void 0),_a(this,"_buttonDestroyHandler",void 0),this._removeWidgetProperties("childActions"),this._buttonPropertyChangeHandler=this._onButtonPropertyChange.bind(this),this._buttonDestroyHandler=this._onButtonDestroy.bind(this),this._addCloneProperties(["button"]),this.button=null,this.menubar=null}_init(e){if(super._init(e),!this.button)throw new Error("Cannot adapt to undefined button");this.button.adaptedBy=this,this._installListeners()}_destroy(){super._destroy(),delete this.button.adaptedBy}_installListeners(){this.button.on("propertyChange",this._buttonPropertyChangeHandler),this.button.on("destroy",this._buttonDestroyHandler)}_uninstallListeners(){this.button.off("propertyChange",this._buttonPropertyChangeHandler),this.button.off("destroy",this._buttonDestroyHandler)}_render(){super._render(),this.$container.attr("data-buttonadapter",this.button.id)}_onButtonPropertyChange(e){let t={};t[e.propertyName]=e.newValue,t=so.adaptButtonProperties(t);for(let s in t)this.setProperty(s,t[s])}_onButtonDestroy(e){this.destroy(),this._uninstallListeners()}doAction(){if(this.childActions.length>0)return super.doAction();let e=this.button.doAction();return e&&(this.isToggleAction()&&this.setSelected(!this.selected),this._doAction()),e}focus(){return this.rendered?(this.menubar.setTabbableMenu(this),this.session.focusManager.requestFocus(this.getFocusableElement())):(this.session.layoutValidator.schedulePostValidateFunction(this.focus.bind(this)),!1)}static adaptButtonProperties(e,t){t=t||{},["visible","selected","tooltipText","keyStroke","keyStrokes","cssClass","modelClass","classId","iconId","preventDoubleClick","enabled","inheritAccessibility","stackable","shrinkable"].forEach(n=>{t[n]=e[n]}),t.text=e.label,t.textPosition=r(e.labelPosition),t.horizontalAlignment=e.gridData?e.gridData.horizontalAlignment:void 0,t.actionStyle=s(e.displayStyle),t.toggleAction=e.displayStyle===Re.DisplayStyle.TOGGLE,t.childActions=e.menus,t.defaultMenu===void 0&&(t.defaultMenu=e.defaultButton);for(let n in t)t[n]===void 0&&delete t[n];return t;function s(n){if(n!==void 0)return n===Re.DisplayStyle.LINK?re.ActionStyle.DEFAULT:re.ActionStyle.BUTTON}function r(n){if(n!==void 0)return n===Re.LabelPosition.BOTTOM?re.TextPosition.BOTTOM:re.TextPosition.DEFAULT}}}function cS(i,e,t){return e=pS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function pS(i){var e=fS(i,"string");return typeof e=="symbol"?e:String(e)}function fS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Bm extends ne{constructor(){super(),cS(this,"field",void 0),this._addWidgetProperties("field")}_render(){this.$container=this.$parent.appendDiv("menu-item"),this.$container.addClass("form-field-menu"),this.uiCssClass&&this.$container.addClass(this.uiCssClass),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new ud({stretch:!1}))}_renderProperties(){super._renderProperties(),this._renderField()}_renderText(){super._renderText(),this.field&&this.field.rendered&&this.$text&&this.field.$container.insertAfter(this.$text)}setField(e){this.setProperty("field",e)}_renderField(){if(this.field){this.field.gridData=ze.createFromHints(this.field,1),this.field.render(this.$container);let e=new xs(this.field);e.validate(),this.field.setLayoutData(e),this.field.$container.addClass("content")}}_removeField(){this.field&&this.field.remove()}clone(e,t){let s=super.clone(e,t);return this._deepCloneProperties(s,["field"],t),s}isTabTarget(){return!1}_renderOverflown(){super._renderOverflown(),this.field._hideStatusMessage()}}class km extends il{_postCreateWidget(){super._postCreateWidget(),this.widget.field&&(this.widget.field.gridDataHints=new ze(this.widget.field.gridData))}}function ya(i,e,t){return e=mS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function mS(i){var e=gS(i,"string");return typeof e=="symbol"?e:String(e)}function gS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class qd extends I{constructor(){super(),ya(this,"compact",void 0),ya(this,"compactOrig",void 0),ya(this,"menus",void 0),ya(this,"uiMenuCssClass",void 0),this.compact=!1,this.menus=[],this.uiMenuCssClass="menu-box-item",this._addWidgetProperties("menus")}_init(e){super._init(e),this._initMenus(this.menus)}_initMenus(e){e.forEach(this._initMenu.bind(this))}_initMenu(e){e.uiCssClass=this.uiMenuCssClass}_render(){this.$container=this.$parent.appendDiv("menu-box"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new Yd(this))}_renderProperties(){super._renderProperties(),this._renderMenus(),this._renderCompact()}setMenus(e){this.setProperty("menus",e)}_renderMenus(){this.menus.forEach(e=>e.render()),this.invalidateLayoutTree()}_removeMenus(){this.menus.forEach(e=>e.remove()),this.invalidateLayoutTree()}setCompact(e){this.setProperty("compact",e)}_renderCompact(){this.$container.toggleClass("compact",this.compact),this.invalidateLayoutTree()}}function ba(i,e,t){return e=_S(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function _S(i){var e=yS(i,"string");return typeof e=="symbol"?e:String(e)}function yS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Yd extends ee{constructor(e){super(),ba(this,"menuBox",void 0),ba(this,"firstMenu",void 0),ba(this,"lastMenu",void 0),ba(this,"_ellipsis",void 0),this.menuBox=e,this.firstMenu=null,this.lastMenu=null}layout(e){let t=this.menuBox.htmlComp,s=t.size(),r=this.visibleMenus(),n=0;this.menuBox.session.layoutValidator.schedulePostValidateFunction(()=>{r.forEach(o=>{o.popup&&o.popup.position()})}),this.updateFirstAndLastMenuMarker(r),this.undoCollapse(r),this.undoCompact(r),this.undoShrink(r),n=this.actualPrefSize(r).width,!(n<=s.width)&&(this.compact(r),n=this.actualPrefSize(r).width,!(n<=s.width)&&(this.shrink(r),n=this.actualPrefSize(r).width,!(n<=s.width)&&this.collapse(s,n)))}preferredLayoutSize(e,t){let s=this.visibleMenus();return this.updateFirstAndLastMenuMarker(s),this.undoCollapse(s),this.undoCompact(s),this.undoShrink(s),this.actualPrefSize()}compact(e){this.menuBox.compactOrig===void 0&&(this.menuBox.compactOrig=this.menuBox.compact,this.menuBox.htmlComp.suppressInvalidate=!0,this.menuBox.setCompact(!0),this.menuBox.htmlComp.suppressInvalidate=!1),this.compactMenus(e)}undoCompact(e){this.menuBox.compactOrig!==void 0&&(this.menuBox.htmlComp.suppressInvalidate=!0,this.menuBox.setCompact(this.menuBox.compactOrig),this.menuBox.htmlComp.suppressInvalidate=!1,this.menuBox.compactOrig=void 0),this.undoCompactMenus(e)}compactMenus(e){e=e||this.visibleMenus(),e.forEach(t=>{t.compactOrig===void 0&&(t.compactOrig=t.compact,t.htmlComp.suppressInvalidate=!0,t.setCompact(!0),t.htmlComp.suppressInvalidate=!1)}),this._ellipsis&&this._ellipsis.setCompact(!0)}undoCompactMenus(e){e=e||this.visibleMenus(),e.forEach(t=>{t.compactOrig!==void 0&&(t.htmlComp.suppressInvalidate=!0,t.setCompact(t.compactOrig),t.htmlComp.suppressInvalidate=!1,t.compactOrig=void 0)}),this._ellipsis&&this._ellipsis.setCompact(!1)}shrink(e){this.shrinkMenus(e)}shrinkMenus(e){e=e||this.visibleMenus(),e.forEach(t=>{t.textVisibleOrig===void 0&&t.iconId&&(t.textVisibleOrig=t.textVisible,t.htmlComp.suppressInvalidate=!0,t.setTextVisible(!1),t.htmlComp.suppressInvalidate=!1)})}undoShrink(e){this.undoShrinkMenus(e)}undoShrinkMenus(e){e=e||this.visibleMenus(),e.forEach(t=>{t.textVisibleOrig!==void 0&&(t.htmlComp.suppressInvalidate=!0,t.setTextVisible(t.textVisibleOrig),t.htmlComp.suppressInvalidate=!1,t.textVisibleOrig=void 0)})}collapse(e,t){this._createAndRenderEllipsis(this.menuBox.$container);let s=this._moveOverflowMenusIntoEllipsis(e,t);this.updateFirstAndLastMenuMarker(s)}undoCollapse(e){e=e||this.visibleMenus(),this._destroyEllipsis(),this._removeMenusFromEllipsis(e)}_createAndRenderEllipsis(e){let t=We.createEllipsisMenu({parent:this.menuBox,hidden:!1,compact:this.menuBox.compact});t.uiCssClass=this.menuBox.uiMenuCssClass,t.render(e),this._ellipsis=t}_destroyEllipsis(){this._ellipsis&&(this._ellipsis.destroy(),this._ellipsis=null)}_moveOverflowMenusIntoEllipsis(e,t){let s=[this._ellipsis],r=v.size(this._ellipsis.$container,!0);return t+=r.width,this.visibleMenus().slice().reverse().forEach(n=>{if(t>e.width){let o=v.size(n.$container,!0);t-=o.width,We.moveMenuIntoEllipsis(n,this._ellipsis)}else s.unshift(n)}),s}_removeMenusFromEllipsis(e){e=e||this.visibleMenus(),e.forEach(t=>We.removeMenuFromEllipsis(t,this.menuBox.$container))}actualPrefSize(e){e=e||this.visibleMenus();let t=this._menusWidth(e),s=v.prefSize(this.menuBox.$container);return s.width=t+this.menuBox.htmlComp.insets().horizontal(),s}_menusWidth(e){let t=0,s=r=>v.size(r.htmlComp.$comp,{includeMargin:!0,exact:!0});return e=e||this.visibleMenus(),e.forEach(r=>{r.rendered&&(t+=s(r).width)}),this._ellipsis&&(t+=s(this._ellipsis).width),t}compactPrefSize(e){return e=e||this.visibleMenus(),this.updateFirstAndLastMenuMarker(e),this.undoCollapse(e),this.undoShrink(e),this.compact(e),this.actualPrefSize()}shrinkPrefSize(e){return e=e||this.visibleMenus(),this.updateFirstAndLastMenuMarker(e),this.undoCollapse(e),this.compact(e),this.shrink(e),this.actualPrefSize()}visibleMenus(){return this.menuBox.menus.filter(e=>e.visible)}updateFirstAndLastMenuMarker(e){let t=null,s=null;(e||[]).forEach(r=>{r.rendered&&(t||(t=r),s=r)}),(t!==this.firstMenu||s!==this.lastMenu)&&(this.firstMenu&&this.firstMenu.rendered&&this.firstMenu.$container.removeClass("first"),this.lastMenu&&this.lastMenu.rendered&&this.lastMenu.$container.removeClass("last"),this.firstMenu=t,this.lastMenu=s,this.firstMenu&&this.firstMenu.$container.addClass("first"),this.lastMenu&&this.lastMenu.$container.addClass("last"))}}function Lt(i,e,t){return e=bS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function bS(i){var e=vS(i,"string");return typeof e=="symbol"?e:String(e)}function vS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ce extends I{constructor(){super(),Lt(this,"menuSorter",void 0),Lt(this,"menuFilter",void 0),Lt(this,"position",void 0),Lt(this,"tabbable",void 0),Lt(this,"menuboxLeft",void 0),Lt(this,"menuboxRight",void 0),Lt(this,"menuItems",void 0),Lt(this,"orderedMenuItems",void 0),Lt(this,"defaultMenu",void 0),Lt(this,"ellipsisPosition",void 0),Lt(this,"hiddenByUi",void 0),Lt(this,"tabbableMenu",void 0),Lt(this,"_menuItemPropertyChangeHandler",void 0),Lt(this,"_focusHandler",void 0),Lt(this,"_ellipsis",void 0),this.menuSorter=null,this.menuFilter=null,this.position=ce.Position.TOP,this.tabbable=!0,this.menuboxLeft=null,this.menuboxRight=null,this.menuItems=[],this.orderedMenuItems={left:[],right:[],all:[]},this.defaultMenu=null,this.visible=!1,this.ellipsisPosition=ce.EllipsisPosition.RIGHT,this._menuItemPropertyChangeHandler=this._onMenuItemPropertyChange.bind(this),this._focusHandler=this._onMenuItemFocus.bind(this),this.hiddenByUi=!1,this._addWidgetProperties("menuItems")}_init(e){super._init(e),this.menuSorter=e.menuOrder||new nr,this.menuSorter.menuBar=this,e.menuFilter&&(this.menuFilter=(t,s)=>e.menuFilter(t,It.MENU_BAR)),this.menuboxLeft=u.create(va,{parent:this,cssClass:"left",tooltipPosition:this._oppositePosition()}),this.menuboxRight=u.create(va,{parent:this,cssClass:"right",tooltipPosition:this._oppositePosition()}),this._setMenuItems(p.ensure(this.menuItems)),this.updateVisibility()}_destroy(){super._destroy(),this._detachMenuHandlers()}_createKeyStrokeContext(){return new Oe}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.registerKeyStrokes([new Xd(this),new Jd(this)])}_render(){this.$container=this.$parent.appendDiv("menubar"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new er(this)),this.menuboxRight.render(this.$container),this.menuboxLeft.render(this.$container)}_renderProperties(){super._renderProperties(),this._renderMenuItems(),this._renderPosition()}setPosition(e){this.setProperty("position",e)}_setPosition(e){this._setProperty("position",e),this.menuboxLeft.setTooltipPosition(this._oppositePosition()),this.menuboxRight.setTooltipPosition(this._oppositePosition())}_renderPosition(){this.$container.toggleClass("bottom",this.position===ce.Position.BOTTOM)}_oppositePosition(){return this.position===ce.Position.TOP?ce.Position.BOTTOM:ce.Position.TOP}setEllipsisPosition(e){this.setProperty("ellipsisPosition",e)}_setChildMenuFilters(){this.orderedMenuItems.all.forEach(e=>e.setMenuFilter(this.menuFilter))}_attachMenuHandlers(){this.orderedMenuItems.all.forEach(e=>{e.events.count("propertyChange",this._menuItemPropertyChangeHandler)===0&&e.on("propertyChange",this._menuItemPropertyChangeHandler),e.events.count("focus",this._focusHandler)===0&&e.on("focus",this._focusHandler)})}_detachMenuHandlers(){this.orderedMenuItems.all.forEach(e=>{e.off("propertyChange",this._menuItemPropertyChangeHandler),e.off("focus",this._focusHandler)})}setMenuItems(e){let t=p.ensure(e);if(p.equals(this.menuItems,t)){this.menuboxRight.link(this.menuboxRight.menuItems),this.menuboxLeft.link(this.menuboxLeft.menuItems);return}this.setProperty("menuItems",t)}_setMenuItems(e,t){this._detachMenuHandlers(),this.orderedMenuItems=this._createOrderedMenus(e),t?(this.menuboxRight.setMenuItems(this.orderedMenuItems.right),this.menuboxLeft.setMenuItems(this.orderedMenuItems.left)):(this.menuboxLeft.setMenuItems(this.orderedMenuItems.left),this.menuboxRight.setMenuItems(this.orderedMenuItems.right)),this._setChildMenuFilters(),this._attachMenuHandlers(),this.updateVisibility(),this.updateDefaultMenu(),this._setProperty("menuItems",e)}_renderMenuItems(){Le.updateFirstLastMarker(this.menuItems),this.updateLeftOfButtonMarker(),this.invalidateLayoutTree()}_removeMenuItems(){}_createOrderedMenus(e){let t=this.menuSorter.order(e),s=-1,r;if(t.right.forEach(n=>{n.rightAligned=!0}),t.all.length>0){if(this._ellipsis&&(this._ellipsis.setChildActions([]),this._ellipsis.destroy()),r=u.create(tl,{parent:this,cssClass:"overflow-menu-item"}),this._ellipsis=r,this.ellipsisPosition===ce.EllipsisPosition.RIGHT){let n=this._getFirstStackableIndexPosition(t.right.slice().reverse());n>-1?(s=t.right.length-n,r.rightAligned=!0,t.right.splice(s,0,r)):(n=this._getFirstStackableIndexPosition(t.left.slice().reverse()),n>-1&&(s=t.left.length-n,t.left.splice(s,0,r)))}else s=this._getFirstStackableIndexPosition(t.left),s>-1?t.left.splice(s,0,r):(s=this._getFirstStackableIndexPosition(t.right),s>-1&&(r.rightAligned=!0,t.right.splice(s,0,r)));t.all=t.left.concat(t.right)}return t}_getFirstStackableIndexPosition(e){let t=-1;return e.some((s,r)=>s.stackable&&s.visible?(t=r,!0):!1),t}_updateTabbableMenu(){this.tabbable&&(this.defaultMenu&&this.defaultMenu.isTabTarget()?this.setTabbableMenu(this.defaultMenu):this.setTabbableMenu(p.find(this.orderedMenuItems.all,e=>e.isTabTarget())))}setTabbableMenu(e){!this.tabbable||e===this.tabbableMenu||(this.tabbableMenu&&this.tabbableMenu.setTabbable(!1),this.tabbableMenu=e,e&&e.setTabbable(!0))}setHiddenByUi(e){this.setProperty("hiddenByUi",e)}updateVisibility(){We.updateSeparatorVisibility(this.orderedMenuItems.left),We.updateSeparatorVisibility(this.orderedMenuItems.right),this.setVisible(!this.hiddenByUi&&this.orderedMenuItems.all.some(e=>e.visible&&!e.ellipsis))}updateDefaultMenu(e){let t=null;for(let s=0;s<this.orderedMenuItems.all.length;s++){let r=this.orderedMenuItems.all[s];if(!(!r.visible||!r.enabled||r.defaultMenu===!1)){if(r.defaultMenu){t=r;break}!t&&this._isDefaultKeyStroke(r.actionKeyStroke)&&(t=r)}}this.setDefaultMenu(t),u.nvl(e,!0)&&this._updateTabbableMenu()}_isDefaultKeyStroke(e){return u.isOneOf(g.ENTER,e.which)&&!e.ctrl&&!e.alt&&!e.shift}setDefaultMenu(e){this.setProperty("defaultMenu",e)}_setDefaultMenu(e){this.defaultMenu&&this.defaultMenu.setMenuStyle(ne.MenuStyle.NONE),e&&e.setMenuStyle(ne.MenuStyle.DEFAULT),this._setProperty("defaultMenu",e)}updateLeftOfButtonMarker(){this._updateLeftOfButtonMarker(this.orderedMenuItems.left),this._updateLeftOfButtonMarker(this.orderedMenuItems.right)}_updateLeftOfButtonMarker(e){let t,s;e=e.filter(r=>r.visible&&r.rendered);for(let r=0;r<e.length;r++)t=e[r],t.$container.removeClass("left-of-button"),r>0&&t.isButton()&&(s=e[r-1],s.$container.addClass("left-of-button"))}_onMenuItemPropertyChange(e){let t=e.source;if((e.propertyName==="overflown"||e.propertyName==="enabledComputed"||e.propertyName==="visible"||e.propertyName==="hidden")&&(!this.tabbableMenu||t===this.tabbableMenu)&&this._updateTabbableMenu(),(e.propertyName==="overflown"||e.propertyName==="hidden")&&(!this.defaultMenu||t===this.defaultMenu)&&this.updateDefaultMenu(),e.propertyName==="horizontalAlignment"&&this.reorderMenus(e.newValue<=0),e.propertyName==="visible"){let s=this.visible;this.updateVisibility(),!s&&this.visible&&this.revalidateLayout(),t.separator||this.reorderMenus()}(e.propertyName==="keyStroke"||e.propertyName==="enabledComputed"||e.propertyName==="defaultMenu"||e.propertyName==="visible")&&this.updateDefaultMenu()}_onMenuItemFocus(e){this.setTabbableMenu(e.source)}reorderMenus(e){let t=this.menuItems;this._setMenuItems(t,e),this.rendered&&this.updateLeftOfButtonMarker()}allMenusAsFlatList(){return p.flatMap(this.orderedMenuItems.all,e=>e instanceof Vd?e.childActions:[e])}}Lt(ce,"EllipsisPosition",{LEFT:"left",RIGHT:"right"}),Lt(ce,"Position",{TOP:"top",BOTTOM:"bottom"});function jd(i,e,t){return e=wS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function wS(i){var e=TS(i,"string");return typeof e=="symbol"?e:String(e)}function TS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class er extends ee{constructor(e){super(),jd(this,"collapsed",void 0),jd(this,"_menuBar",void 0),jd(this,"_overflowMenuItems",void 0),this._menuBar=e,this._overflowMenuItems=[],this.collapsed=!1}layout(e){let t=this._menuBar.orderedMenuItems.left.concat(this._menuBar.orderedMenuItems.right),s=this.visibleMenuItems(),r=T.get(e),n=p.find(t,o=>o.ellipsis);this._setFirstLastMenuMarker(s),this.preferredLayoutSize(e,{widthHint:r.availableSize().width,undo:!1}),n&&this._overflowMenuItems.length>0&&n.setHidden(!1),s.forEach(o=>o._setOverflown(!1)),this._overflowMenuItems.forEach(o=>o._setOverflown(!0)),n&&this._overflowMenuItems.length===0&&n.setHidden(!0),this._overflowMenuItems=this._overflowMenuItems.filter(o=>!o.separator),n&&(n._closePopup(),n.setChildActions(this._overflowMenuItems)),s.forEach(o=>o.validateLayout()),s.forEach(o=>{o.popup&&o.popup.position()})}preferredLayoutSize(e,t){if(this._overflowMenuItems=[],!this._menuBar.isVisible())return new F(0,0);let s=this.visibleMenuItems(),r=s.filter(c=>{let f=c.overflown;return c._setOverflown(!1),f}),n=s.filter(c=>{let f=!c.textVisible;return this.undoShrink([c]),f}),o=[...s],l=T.get(e),h=new F(0,0),d=Number.MAX_VALUE;return(t.widthHint===0||t.widthHint)&&(d=t.widthHint-l.insets().horizontal()),d<=0?h=this._minSize(s):(h=this._prefSize(s),h.width>d&&this.shrink(s),h=this._prefSizeWithOverflow(s,d)),u.nvl(t.undo,!0)&&(this.undoOverflow(r),this.undoShrink(o),this.shrink(n)),h.add(l.insets())}_prefSizeWithOverflow(e,t){let s=[];e.forEach((o,l)=>{o.stackable&&s.push(l)});let r=-1;this._setFirstLastMenuMarker(e);let n=this._prefSize(e);for(;n.width>t&&s.length>0;)this._menuBar.ellipsisPosition===ce.EllipsisPosition.RIGHT?r=s.splice(-1)[0]:r=s.splice(0,1)[0]-this._overflowMenuItems.length,this._overflowMenuItems.splice(0,0,e[r]),e.splice(r,1),this._setFirstLastMenuMarker(e),n=this._prefSize(e);return n}_minSize(e){let t=e.filter(s=>!s.stackable);return this.shrink(e),this._setFirstLastMenuMarker(t,!0),this._prefSize(t,!0)}_prefSize(e,t){let s=new F(0,0);return t=u.nvl(t,this._overflowMenuItems.length>0),this._setFirstLastMenuMarker(e,t),e.forEach(r=>{let n=new F(0,0);r.ellipsis?t&&(n=this._menuItemSize(r)):n=this._menuItemSize(r),s.height=Math.max(s.height,n.height),s.width+=n.width}),s}_menuItemSize(e){let t=e.$container.attr("class");e.$container.removeClass("overflown"),e.$container.removeClass("hidden"),e.htmlComp.invalidateLayout();let s=e.htmlComp.prefSize({useCssSize:!0,exact:!0}).add(v.margins(e.$container));return e.$container.attrOrRemove("class",t),s}_setFirstLastMenuMarker(e,t){let s=e;t=u.nvl(t,this._overflowMenuItems.length>0),this._menuBar.orderedMenuItems.all.forEach(r=>r.$container.removeClass("first last")),t||(s=s.filter(r=>!r.ellipsis)),s.length>0&&(s[0].$container.addClass("first"),s[s.length-1].$container.addClass("last"))}undoOverflow(e){e.forEach(t=>t._setOverflown(!0))}shrink(e){e.forEach(t=>{t.textVisibleOrig===void 0&&t.shrinkable&&t.icon&&(t.textVisibleOrig=t.textVisible,t.htmlComp.suppressInvalidate=!0,t.setTextVisible(!1),t.htmlComp.suppressInvalidate=!1)})}undoShrink(e){e.forEach(t=>{t.textVisibleOrig!==void 0&&(t.htmlComp.suppressInvalidate=!0,t.setTextVisible(t.textVisibleOrig),t.htmlComp.suppressInvalidate=!1,t.textVisibleOrig=void 0)})}visibleMenuItems(){return this._menuBar.orderedMenuItems.all.filter(e=>e.visible)}static size(e,t){let s=e.prefSize({widthHint:t.width});return s.width=t.width,s=s.subtract(e.margins()),s}}class Xd extends O{constructor(e){super(),this.field=e,this.which=[g.LEFT],this.renderingHints.render=!1,this.stopPropagation=!0,this.keyStrokeMode=O.Mode.DOWN,this.inheritAccessibility=!1}handle(e){let t=this.field.allMenusAsFlatList(),s=this.field.$container.find(":focus"),r,n,o;for(r=0;r<t.length;r++){if(n=t[r],s[0]===n.$container[0]){o&&(this.field.setTabbableMenu(o),o.focus());break}n.isTabTarget()&&(o=n)}}}class Jd extends O{constructor(e){super(),this.field=e,this.which=[g.RIGHT],this.renderingHints.render=!1,this.stopPropagation=!0,this.keyStrokeMode=O.Mode.DOWN,this.inheritAccessibility=!1}handle(e){let t=this.field.allMenusAsFlatList(),s=this.field.$container.find(":focus"),r,n,o=!1;for(r=0;r<t.length;r++){if(n=t[r],o&&n.isTabTarget()){this.field.setTabbableMenu(n),n.focus();break}s[0]===n.$container[0]&&(o=!0)}}}function CS(i,e,t){return e=SS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function SS(i){var e=PS(i,"string");return typeof e=="symbol"?e:String(e)}function PS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Qd extends ft{constructor(){super(),CS(this,"menu",void 0),this.menu=null,this.windowPaddingX=0,this.windowPaddingY=0}_init(e){e.anchor=e.menu,e.closeOnAnchorMouseDown=!1,super._init(e)}_render(){super._render(),this.$container.addClass("menu-bar-popup")}_getMenuItems(){return this.menu.childActions}}function Hm(i,e,t){return e=xS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function xS(i){var e=ES(i,"string");return typeof e=="symbol"?e:String(e)}function ES(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class va extends I{constructor(){super(),Hm(this,"menuItems",void 0),Hm(this,"tooltipPosition",void 0),this.menuItems=[],this.tooltipPosition="top",this._addWidgetProperties("menuItems")}_render(){this.$container=this.$parent.appendDiv("menubar-box"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new Zd(this))}_renderProperties(){super._renderProperties(),this._renderMenuItems()}_remove(){this._removeMenuItems(),super._remove()}setMenuItems(e){let t=p.ensure(e);p.equals(this.menuItems,t)||this.setProperty("menuItems",t)}_setMenuItems(e){this._setProperty("menuItems",e),this._updateTooltipPosition()}_removeMenuItems(){this.menuItems.forEach(e=>e.remove())}_renderMenuItems(){this.menuItems.forEach(e=>{e.render(this.$container),e.$container.addClass("menubar-item")}),this.rendering||this.invalidateLayoutTree()}_renderVisible(){super._renderVisible(),this.revalidateLayout()}setTooltipPosition(e){this.setProperty("tooltipPosition",e)}_setTooltipPosition(e){this._setProperty("tooltipPosition",e),this._updateTooltipPosition()}_updateTooltipPosition(){this.menuItems.forEach(e=>e.setTooltipPosition(this.tooltipPosition))}}function FS(i,e,t){return e=DS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function DS(i){var e=AS(i,"string");return typeof e=="symbol"?e:String(e)}function AS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Zd extends ee{constructor(e){super(),FS(this,"menubox",void 0),this.menubox=e}layout(e){}preferredLayoutSize(e,t){let s=null;return this.menubox.menuItems.filter(r=>!r.overflown&&r.isVisible()).reduce((r,n)=>(s=n.htmlComp.prefSize({useCssSize:!0,includeMargin:!0}),r.height=Math.max(r.height,s.height),r.width=Math.max(r.width,s.width),r),new F)}}function W(i,e,t){return e=$S(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function $S(i){var e=RS(i,"string");return typeof e=="symbol"?e:String(e)}function RS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class He extends I{constructor(){super(),W(this,"monthViewNumberOfWeeks",void 0),W(this,"numberOfHourDivisions",void 0),W(this,"widthPerDivision",void 0),W(this,"heightPerDivision",void 0),W(this,"startHour",void 0),W(this,"heightPerHour",void 0),W(this,"heightPerDay",void 0),W(this,"spaceBeforeScrollTop",void 0),W(this,"workDayIndices",void 0),W(this,"displayCondensed",void 0),W(this,"displayMode",void 0),W(this,"components",void 0),W(this,"selectedComponent",void 0),W(this,"loadInProgress",void 0),W(this,"selectedDate",void 0),W(this,"selectorStart",void 0),W(this,"selectorEnd",void 0),W(this,"showDisplayModeSelection",void 0),W(this,"rangeSelectionAllowed",void 0),W(this,"title",void 0),W(this,"useOverflowCells",void 0),W(this,"viewRange",void 0),W(this,"calendarToggleListWidth",void 0),W(this,"calendarToggleYearWidth",void 0),W(this,"menuInjectionTarget",void 0),W(this,"modesMenu",void 0),W(this,"menus",void 0),W(this,"yearPanel",void 0),W(this,"selectedRange",void 0),W(this,"needsScrollToStartHour",void 0),W(this,"$header",void 0),W(this,"$range",void 0),W(this,"$commands",void 0),W(this,"$grids",void 0),W(this,"$grid",void 0),W(this,"$topGrid",void 0),W(this,"$list",void 0),W(this,"$listContainer",void 0),W(this,"$listTitle",void 0),W(this,"$progress",void 0),W(this,"$headerRow1",void 0),W(this,"$headerRow2",void 0),W(this,"$title",void 0),W(this,"$select",void 0),W(this,"$window",void 0),W(this,"_showYearPanel",void 0),W(this,"_showListPanel",void 0),W(this,"_exactRange",void 0),W(this,"_listComponents",void 0),W(this,"_menuInjectionTargetMenusChangedHandler",void 0),W(this,"_moveData",void 0),W(this,"_rangeSelectionStarted",void 0),W(this,"_mouseMoveHandler",void 0),W(this,"_mouseUpHandler",void 0),W(this,"_mouseMoveRangeSelectionHandler",void 0),W(this,"_mouseUpRangeSelectionHandler",void 0),this.monthViewNumberOfWeeks=6,this.numberOfHourDivisions=2,this.heightPerDivision=30,this.startHour=6,this.heightPerHour=this.numberOfHourDivisions*this.heightPerDivision,this.heightPerDay=24*this.heightPerHour,this.spaceBeforeScrollTop=15,this.workDayIndices=[1,2,3,4,5],this.components=[],this.displayCondensed=!1,this.displayMode=He.DisplayMode.MONTH,this.loadInProgress=!1,this.selectedDate=new Date,this.showDisplayModeSelection=!0,this.rangeSelectionAllowed=!1,this.title=null,this.useOverflowCells=!0,this.viewRange=null,this.calendarToggleListWidth=270,this.calendarToggleYearWidth=215,this.$container=null,this.$header=null,this.$range=null,this.$commands=null,this.$grids=null,this.$grid=null,this.$topGrid=null,this.$list=null,this.$progress=null,this._showYearPanel=!1,this._showListPanel=!1,this._exactRange=null,this._listComponents=[],this.menuInjectionTarget=null,this._menuInjectionTargetMenusChangedHandler=null,this._moveData=null,this._mouseMoveHandler=this._onMouseMove.bind(this),this._mouseUpHandler=this._onMouseUp.bind(this),this._mouseMoveRangeSelectionHandler=this._onMouseMoveRangeSelection.bind(this),this._mouseUpRangeSelectionHandler=this._onMouseUpRangeSelection.bind(this),this.selectedRange=null,this._addWidgetProperties(["components","menus","selectedComponent"]),this._addPreserveOnPropertyChangeProperties(["selectedComponent"])}init(e){super.init(e)}isDay(){return this.displayMode===He.DisplayMode.DAY}isWeek(){return this.displayMode===He.DisplayMode.WEEK}isMonth(){return this.displayMode===He.DisplayMode.MONTH}isWorkWeek(){return this.displayMode===He.DisplayMode.WORK_WEEK}_createKeyStrokeContext(){return new Oe}_init(e){super._init(e),this.yearPanel=u.create(Ta,{parent:this}),this.yearPanel.on("dateSelect",this._onYearPanelDateSelect.bind(this)),this.modesMenu=u.create(iu,{parent:this,visible:!1,displayMode:this.displayMode}),this._setSelectedDate(this.selectedDate),this._setDisplayMode(this.displayMode),this._setMenuInjectionTarget(this.menuInjectionTarget),this._exactRange=this._calcExactRange(),this.yearPanel.setViewRange(this._exactRange),this.viewRange=this._calcViewRange()}setSelectedDate(e){this.setProperty("selectedDate",e)}_setSelectedDate(e){e=w.ensure(e),this._setProperty("selectedDate",e),this.yearPanel.selectDate(this.selectedDate)}_renderSelectedDate(){this._updateModel(!0,!1)}setDisplayMode(e){if(b.equals(this.displayMode,e))return;let t=this.displayMode;this._setDisplayMode(e),this.rendered&&this._renderDisplayMode(t)}_setDisplayMode(e){if(this._setProperty("displayMode",e),this.yearPanel.setDisplayMode(this.displayMode),this.modesMenu.setDisplayMode(e),this.isWorkWeek()){let t=this._dateParts(this.selectedDate,!0);t.day>4&&this.setSelectedDate(new Date(t.year,t.month,t.date-t.day+4))}this.selectedRange=null,this.trigger("selectedRangeChange")}_renderDisplayMode(e){this.rendering||(this._updateModel(!1,!0),(e===He.DisplayMode.MONTH||this.displayMode===He.DisplayMode.MONTH)&&(this._renderComponents(),this.needsScrollToStartHour=!0))}_setViewRange(e){e=Ve.ensure(e),this._setProperty("viewRange",e)}_setRangeSelectionAllowed(e){this.rangeSelectionAllowed=e,this.rangeSelectionAllowed||this._setSelectedRange(null)}_setSelectedRange(e){let t=Ve.ensure(e);t&&t.from&&t.to?(this.selectorStart=new Date(t.from),this.selectorStart.setHours(0,this._getHours(this.selectorStart)*60),this.selectorEnd=new Date(t.to),this.selectorEnd.setHours(0,this._getHours(this.selectorEnd)*60-30),this._setRangeSelection()):(this.selectorStart=null,this.selectorEnd=null,this._removeRangeSelection()),this._updateSelectedRange()}_setMenus(e){if(this._checkMenuInjectionTarget(this.menuInjectionTarget)){let t=this._removeInjectedMenus(this.menuInjectionTarget,this.menus);this.menuInjectionTarget.setMenus(e.concat(t))}this._setProperty("menus",e)}_setMenuInjectionTarget(e){if(b.isString(e)&&(e=u.widget(e)),this._checkMenuInjectionTarget(this.menuInjectionTarget)){e.off("propertyChange:menus",this._menuInjectionTargetMenusChangedHandler);let t=this._removeInjectedMenus(this.menuInjectionTarget,this.menus);this.menuInjectionTarget.setMenus(t)}this._checkMenuInjectionTarget(e)&&(e.setMenus(this.menus.concat(e.menus)),this._menuInjectionTargetMenusChangedHandler=t=>{this.menuInjectionTarget.menus.some(s=>this.menus.includes(s))||this.menuInjectionTarget.setMenus(this.menus.concat(this.menuInjectionTarget.menus))},e.on("propertyChange:menus",this._menuInjectionTargetMenusChangedHandler)),this._setProperty("menuInjectionTarget",e)}_checkMenuInjectionTarget(e){return e instanceof xe}_removeInjectedMenus(e,t){return e.menus.filter(s=>!t.includes(s))}_render(){this.$container=this.$parent.appendDiv("calendar");let e=new tu(this);this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(e);let t=x.get().type===x.Type.MOBILE;this.$header=this.$container.appendDiv("calendar-header"),this.$header.toggleClass("mobile",t),this.$headerRow1=this.$header.appendDiv("calendar-header-row first"),this.$headerRow2=this.$header.appendDiv("calendar-header-row last"),this.yearPanel.render(),this.$grids=this.$container.appendDiv("calendar-grids"),this.$topGrid=this.$grids.appendDiv("calendar-top-grid"),this.$topGrid.toggleClass("mobile",t),this.$grid=this.$grids.appendDiv("calendar-grid"),this.$grid.toggleClass("mobile",t),this.$listContainer=this.$container.appendDiv("calendar-list-container"),this.$list=this.$listContainer.appendDiv("calendar-list calendar-scrollable-components"),this.$listTitle=this.$list.appendDiv("calendar-list-title"),this.$range=this.$headerRow1.appendDiv("calendar-range"),this.$range.appendDiv("calendar-previous").on("click",this._onPreviousClick.bind(this)),this.$range.appendDiv("calendar-today",this.session.text("ui.CalendarToday")).on("click",this._onTodayClick.bind(this)),this.$range.appendDiv("calendar-next").on("click",this._onNextClick.bind(this)),this.$title=this.$headerRow1.appendDiv("calendar-title"),this.$select=this.$title.appendDiv("calendar-select"),this.$progress=this.$title.appendDiv("busyindicator-label"),this.$commands=this.$headerRow1.appendDiv("calendar-commands"),this.$commands.appendDiv("calendar-mode first",this.session.text("ui.CalendarDay")).attr("data-mode",He.DisplayMode.DAY).on("click",this._onDisplayModeClick.bind(this)),this.$commands.appendDiv("calendar-mode",this.session.text("ui.CalendarWorkWeek")).attr("data-mode",He.DisplayMode.WORK_WEEK).on("click",this._onDisplayModeClick.bind(this)),this.$commands.appendDiv("calendar-mode",this.session.text("ui.CalendarWeek")).attr("data-mode",He.DisplayMode.WEEK).on("click",this._onDisplayModeClick.bind(this)),this.$commands.appendDiv("calendar-mode last",this.session.text("ui.CalendarMonth")).attr("data-mode",He.DisplayMode.MONTH).on("click",this._onDisplayModeClick.bind(this)),this.modesMenu.render(this.$commands),this.$commands.appendDiv("calendar-toggle-year").on("click",this._onYearClick.bind(this)),this.$commands.appendDiv("calendar-toggle-list").on("click",this._onListClick.bind(this));let s=this.$topGrid.appendDiv("calendar-week-header");s.appendDiv("calendar-week-name");for(let h=0;h<7;h++)s.appendDiv("calendar-day-name").data("day",h);this.$topGrid.appendDiv("calendar-week-task").attr("data-axis-name",this.session.text("ui.CalendarDay"));let r=this.$topGrid.appendDiv("calendar-week-allday-container");r.appendDiv("calendar-week-name");let n=this._onDayContextMenu.bind(this);for(let h=0;h<7;h++)r.appendDiv("calendar-day").addClass("calendar-scrollable-components").data("day",h).on("contextmenu",n);for(let h=1;h<7;h++){let d=this.$grid.appendDiv("calendar-week");for(let c=0;c<8;c++){let f=d.appendDiv();h>0&&c===0?f.addClass("calendar-week-name"):h>0&&c>0&&f.addClass("calendar-day").data("day",c).data("week",h).on("contextmenu",n)}}let o=this._onDayMouseDown.bind(this,!0);this.$grid.find(".calendar-day").on("mousedown",o);let l=this._onDayMouseDown.bind(this,!1);this.$topGrid.find(".calendar-day").on("mousedown",l),this.$window=this.$container.window(),this.$container.on("mousedown touchstart",this._onMouseDown.bind(this)),this._updateScreen(!1,!1)}_renderProperties(){super._renderProperties(),this._renderComponents(),this._renderSelectedComponent(),this._renderLoadInProgress(),this._renderDisplayMode()}_renderComponents(){this.components.sort(this._sortFromTo),this.components.forEach(e=>e.remove()),this.components.forEach(e=>e.render()),this._arrangeComponents(),this._updateListPanel()}_renderSelectedComponent(){this.selectedComponent&&this.selectedComponent.setSelected(!0)}_renderLoadInProgress(){this.$progress.setVisible(this.loadInProgress)}updateScrollPosition(e){this.rendered?this._updateScrollPosition(!0,e):this.session.layoutValidator.schedulePostValidateFunction(this._updateScrollPosition.bind(this,!0,e))}_updateScrollPosition(e,t){if(this.isMonth())this._scrollToSelectedComponent(t);else if(this.selectedComponent)if(this.selectedComponent.fullDay)this._scrollToSelectedComponent(t),e&&this._scrollToInitialTime(t);else{let s=w.parseJsonDate(this.selectedComponent.fromDate),r=this._dayPosition(s.getHours(),s.getMinutes())/100,n=this.heightPerDay*r;P.scrollTop(this.$grid,n-this.spaceBeforeScrollTop,{animate:t})}else e&&this._scrollToInitialTime(t)}_scrollToSelectedComponent(e){this.selectedComponent&&this.selectedComponent._$parts[0]&&this.selectedComponent._$parts[0].parent()&&this.selectedComponent._$parts[0].isVisible()&&P.scrollTo(this.selectedComponent._$parts[0].parent(),this.selectedComponent._$parts[0],{animate:e})}_scrollToInitialTime(e){if(this.needsScrollToStartHour=!1,!this.isMonth())if(this.selectedComponent&&!this.selectedComponent.fullDay){let t=w.parseJsonDate(this.selectedComponent.fromDate),s=this._dayPosition(t.getHours(),t.getMinutes())/100,r=this.heightPerDay*s;P.scrollTop(this.$grid,r-this.spaceBeforeScrollTop,{animate:e})}else{let t=this.heightPerHour*this.startHour;P.scrollTop(this.$grid,t-this.spaceBeforeScrollTop,{animate:e})}}_onPreviousClick(){this._navigateDate(He.Direction.BACKWARD)}_onNextClick(){this._navigateDate(He.Direction.FORWARD)}_dateParts(e,t){let s={year:e.getFullYear(),month:e.getMonth(),date:e.getDate(),day:e.getDay()};return t&&(s.day=(e.getDay()+6)%7),s}_navigateDate(e){this.selectedDate=this._calcSelectedDate(e),this._updateModel(!0,!1)}_calcSelectedDate(e){let t=this._dateParts(this.selectedDate),s=e,r=e*7,n=e;if(this.isDay())return new Date(t.year,t.month,t.date+s);if(this.isWeek()||this.isWorkWeek())return new Date(t.year,t.month,t.date+r);if(this.isMonth())return w.shift(this.selectedDate,0,n,0)}_updateModel(e,t){this._exactRange=this._calcExactRange(),this.yearPanel.setViewRange(this._exactRange),this.viewRange=this._calcViewRange(),this.trigger("modelChange"),this._updateScreen(e,t)}_calcExactRange(){let e,t,s=this._dateParts(this.selectedDate,!0);if(this.isDay())e=new Date(s.year,s.month,s.date),t=new Date(s.year,s.month,s.date+1);else if(this.isWeek())e=new Date(s.year,s.month,s.date-s.day),t=new Date(s.year,s.month,s.date-s.day+6);else if(this.isMonth())e=new Date(s.year,s.month,1),t=new Date(s.year,s.month+1,0);else if(this.isWorkWeek())e=new Date(s.year,s.month,s.date-s.day),t=new Date(s.year,s.month,s.date-s.day+4);else throw new Error("invalid value for displayMode");return new Ve(e,t)}_calcViewRange(){let e=s(this._exactRange.from),t=r(e);return new Ve(e,t);function s(n){let o,l=new Date(n.valueOf());for(o=0;o<42;o++)if(l.setDate(l.getDate()-1),l.getDay()===1&&l.getMonth()!==n.getMonth())return l;throw new Error("failed to calc viewFrom date")}function r(n){let o,l=new Date(n.valueOf());for(o=0;o<42;o++)l.setDate(l.getDate()+1);return l}}_onTodayClick(e){this.selectedDate=new Date,this._updateModel(!0,!1)}_onDisplayModeClick(e){let t=a()(e.target).data("mode");this.setDisplayMode(t)}_onYearClick(e){this._showYearPanel=!this._showYearPanel,this._updateScreen(!0,!0)}_onListClick(e){this._showListPanel=!this._showListPanel,this._updateScreen(!1,!0)}_onDayMouseDown(e,t){let s=new Date(a()(t.delegateTarget).data("date")),r=!1;if(e&&(this.isDay()||this.isWeek()||this.isWorkWeek())){let n=this._getSelectedSeconds(t);n<60*60*24&&(s.setSeconds(n),r=!0),this._startRangeSelection(t)}this._setSelection(s,null,!1,r)}_getSelectedDate(e){let t=null;return a()(e.target).hasClass("calendar-day")?t=a()(e.target).data("date"):(a()(e.target).hasClass("calendar-component")||a()(e.target).parents(".calendar-component").length>0||a()(e.target).hasClass("calendar-range-selector"))&&(t=a()(e.target).closest(".calendar-day").data("date")),t?new Date(t):null}_getSelectedSeconds(e){let t=e.originalEvent.layerY;return a()(e.target).hasClass("calendar-component")||a()(e.target).parents(".calendar-component").length>0?t+=a()(e.target).closest(".calendar-component").position().top:a()(e.target).hasClass("calendar-range-selector")&&(t+=a()(e.target).position().top),Math.floor(t/this.heightPerDivision)/this.numberOfHourDivisions*60*60}_getSelectedDateTime(e){let t=this._getSelectedDate(e);if(t&&(this.isDay()||this.isWeek()||this.isWorkWeek())){let s=this._getSelectedSeconds(e);s<60*60*24&&t.setSeconds(s)}return t}_setSelection(e,t,s,r){let n=!1,o=w.compareDays(this.selectedDate,e)!==0;(o||r)&&(n=!0,o&&a()(".calendar-day",this.$container).each((l,h)=>{let d=a()(h),c=d.data("date");!c||w.compareDays(c,this.selectedDate)===0?d.select(!1):w.compareDays(c,e)===0&&d.select(!0)}),this.selectedDate=e),this.selectedComponent!==t&&(n=!0,this.selectedComponent&&this.selectedComponent.setSelected(!1),t&&t.setSelected(!0),this.selectedComponent=t),n&&(this.trigger("selectionChange"),o&&this._updateListPanel(),s&&this._updateScrollPosition(!1,!0)),this._showYearPanel&&this.yearPanel.selectDate(this.selectedDate)}_updateScreen(e,t){a().log.isInfoEnabled()&&a().log.info("(Calendar#_updateScreen)"),a()(".calendar-mode",this.$commands).select(!1),a()('[data-mode="'+this.displayMode+'"]',this.$commands).select(!0),a()(".selected",this.$grid).select(!1),this.layoutLabel(),this.layoutSize(t),this.layoutAxis(),this._showYearPanel&&this.yearPanel.selectDate(this.selectedDate),this._updateListPanel(),this._updateScrollbars(this.$grid,t),e&&!this.isMonth()&&this._updateTopGrid(),this._setSelectedRange(this.selectedRange)}layoutSize(e){a()("div",this.$container).removeData(["new-width","new-height"]),this.isMonth()?(this.$topGrid.addClass("calendar-top-grid-short"),this.$grid.removeClass("calendar-grid-short")):(this.$topGrid.removeClass("calendar-top-grid-short"),this.$grid.addClass("calendar-grid-short"));let t=a()(".selected",this.$grid),s=a()(".selected",this.$topGrid),r=this.$container.width(),n=this.$grid.height(),o=this.$grid.innerWidth()-this.$grid.width(),l=r-o;a()(".calendar-toggle-year",this.$commands).select(this._showYearPanel),this._showYearPanel?(this.yearPanel.$container.data("new-width",this.calendarToggleYearWidth),l-=this.calendarToggleYearWidth,r-=this.calendarToggleYearWidth):this.yearPanel.$container.data("new-width",0),a()(".calendar-toggle-list",this.$commands).select(this._showListPanel),this._showListPanel?(this.$list.parent().data("new-width",this.calendarToggleListWidth),l-=this.calendarToggleListWidth,r-=this.calendarToggleListWidth):this.$list.parent().data("new-width",0),this.$grids.data("new-width",r);let h=a()(),d=a()(".calendar-week",this.$grid);if(this.isDay()||this.isWeek()||this.isWorkWeek()){d.removeClass("calendar-week-noborder");let f=t.parent();h=d.not(f),h.data("new-height",0),h.removeClass("invisible"),f.data("new-height",this.heightPerDay),f.addClass("calendar-week-noborder"),f.removeClass("hidden invisible"),a()(".calendar-day",f).data("new-height",this.heightPerDay),a()(".calendar-week-name",this.$grid).addClass("invisible"),a()(".calendar-week-allday-container",this.$topGrid).removeClass("hidden"),a()(".calendar-week-task",this.$topGrid).removeClass("hidden")}else{let f=n/this.monthViewNumberOfWeeks;d.removeClass("calendar-week-noborder invisible hidden"),d.eq(0).addClass("calendar-week-noborder"),d.data("new-height",f),a()(".calendar-day",this.$grid).data("new-height",f);let m=a()(".calendar-week-name",this.$grid);m.removeClass("hidden invisible"),m.data("new-height",f),a()(".calendar-week-allday-container",this.$topGrid).addClass("hidden"),a()(".calendar-week-task",this.$topGrid).addClass("hidden")}let c=l-45;if(this.isDay())a()(".calendar-day-name, .calendar-day",this.$topGrid).data("new-width",0),a()(".calendar-day",this.$grid).data("new-width",0),a()(".calendar-day-name:nth-child("+(s.index()+1)+")",this.$topGrid).data("new-width",c),a()(".calendar-day:nth-child("+(s.index()+1)+")",this.$topGrid).data("new-width",c),a()(".calendar-day:nth-child("+(t.index()+1)+")",this.$grid).data("new-width",c),this.widthPerDivision=c;else if(this.isWorkWeek()){this.$topGrid.find(".calendar-day-name").data("new-width",0),this.$grids.find(".calendar-day").data("new-width",0);let f=Math.round(c/this.workDayIndices.length);this.$topGrid.find(".calendar-day-name").slice(0,5).data("new-width",f),this.$topGrid.find(".calendar-day").slice(0,5).data("new-width",f),a()(".calendar-day:nth-child(-n+6)",this.$grid).data("new-width",f),this.widthPerDivision=f}else if(this.isMonth()||this.isWeek()){let f=Math.round(c/7);this.$grids.find(".calendar-day").data("new-width",f),this.$topGrid.find(".calendar-day-name").data("new-width",f),this.widthPerDivision=f}this.isMonth()&&a()(".component-month",this.$grid).each(function(){let f=a()(this),m=f.closest(".calendar-day");f.toggleClass("compact",m.data("new-width")<ro.MONTH_COMPACT_THRESHOLD)}),a()("div",this.$container).each((f,m)=>{let _=a()(m),C=_.data("new-width"),S=_.data("new-height");if(_.stop(!1,!0),C!==void 0&&C!==_.outerWidth())if(e){let R={complete:()=>this._afterLayout(_,e)};_[0]===this.$grids[0]&&(R.progress=()=>this._afterLayout(_,e)),_.animate({width:C},R)}else _.css("width",C),this._afterLayout(_,e);S!==void 0&&S!==_.outerHeight()&&(S>0&&_.removeClass("hidden"),e?_.animateAVCSD("height",S,()=>{S===0&&_.addClass("hidden"),this._afterLayout(_,e)}):(_.css("height",S),S===0&&_.addClass("hidden"),this._afterLayout(_,e)))})}_afterLayout(e,t){this._updateScrollbars(e,t),this._updateWeekdayNames()}_updateWeekdayNames(){let e=this.$topGrid.width(),t;this.isDay()?e/=1:this.isWorkWeek()?e/=this.workDayIndices.length:(this.isWeek()||this.isMonth())&&(e/=7),e>90?t=this.session.locale.dateFormat.symbols.weekdaysOrdered:t=this.session.locale.dateFormat.symbols.weekdaysShortOrdered,a()(".calendar-day-name",this.$topGrid).each(function(s){a()(this).attr("data-day-name",t[s])})}_updateScrollbars(e,t){a()(".calendar-scrollable-components",e).each((r,n)=>{P.update(a()(n),!0)}),this.updateScrollPosition(t)}_uninstallComponentScrollbars(e){e.find(".calendar-scrollable-components").each((t,s)=>{P.uninstall(a()(s),this.session)})}_updateTopGrid(){a()(".calendar-component",this.$topGrid).each((t,s)=>{let r=a()(s).data("component");r&&r.remove()});let e=this.components.filter(t=>t.fullDay);e.forEach(t=>t.remove()),e.forEach(t=>t.render()),this._updateScrollbars(this.$topGrid,!1)}layoutYearPanel(){this._showYearPanel&&(P.update(this.yearPanel.$yearList),this.yearPanel._scrollYear())}layoutLabel(){let e,t,s,r=this._exactRange.from,n=this._exactRange.to;if(this.isDay())e=this._format(r,"d. MMMM yyyy");else if(this.isWorkWeek()||this.isWeek()){let f=this.session.text("ui.to");r.getMonth()===n.getMonth()?e=y.join(" ",this._format(r,"d."),f,this._format(n,"d. MMMM yyyy")):r.getFullYear()===n.getFullYear()?e=y.join(" ",this._format(r,"d. MMMM"),f,this._format(n,"d. MMMM yyyy")):e=y.join(" ",this._format(r,"d. MMMM yyyy"),f,this._format(n,"d. MMMM yyyy"))}else this.isMonth()&&(e=this._format(r,"MMMM yyyy"));this.$select.text(e),t=a()(".calendar-day",this.$grid);let o,l,h,d=this._exactRange.from.getMonth(),c=new Date(this.viewRange.from.valueOf());for(o=0;o<this.monthViewNumberOfWeeks;o++)for(l=0;l<7;l++)h="",this.workDayIndices.indexOf(c.getDay())===-1?h=c.getMonth()!==d?" weekend-out":" weekend":h=c.getMonth()!==d?" out":"",w.isSameDay(c,new Date)&&(h+=" now"),w.isSameDay(c,this.selectedDate)&&(h+=" selected"),this.isMonth()||(h+=" calendar-no-label"),c.getDate()>9&&c.getDate()<20&&(h+=" center-nice"),e=this._format(c,"dd"),t.eq(o*7+l).removeClass("weekend-out weekend out selected now calendar-no-label").addClass(h).attr("data-day-name",e).data("date",new Date(c.valueOf())),c.setDate(c.getDate()+1);if(!this.isMonth()){s=a()(".calendar-day",this.$topGrid);let f=new Date(this._exactRange.from.valueOf());for(c=w.firstDayOfWeek(f,1),l=0;l<7;l++)h="",this.workDayIndices.indexOf(c.getDay())===-1?h=c.getMonth()!==d?" weekend-out":" weekend":h=c.getMonth()!==d?" out":"",w.isSameDay(c,new Date)&&(h+=" now"),w.isSameDay(c,this.selectedDate)&&(h+=" selected"),e=this._format(c,"dd"),s.eq(l).removeClass("weekend-out weekend out selected now").addClass(h).attr("data-day-name",e).data("date",new Date(c.valueOf())),c.setDate(c.getDate()+1)}}layoutAxis(){let e;a()(".calendar-week-axis, .calendar-week-task",this.$grid).remove();let t=this.session;if(a()(".calendar-week-name",this.$container).each(function(s){s>0&&(e=a()(this),e.text(t.text("ui.CW",w.weekInYear(e.next().data("date"))+"")))}),!this.isMonth()){let s=a()(".calendar-week",this.$grid);for(let r=0;r<24;r++){let n=("00"+r).slice(-2),o=r*this.heightPerHour;s.appendDiv("calendar-week-axis hour"+(r===0?" first":"")).attr("data-axis-name",n+":00").css("top",o+"px");for(let l=1;l<this.numberOfHourDivisions;l++)o+=this.heightPerDivision,s.appendDiv("calendar-week-axis").attr("data-axis-name","").css("top",o+"px")}}}_onYearPanelDateSelect(e){this.selectedDate=e.date,this._updateModel(!0,!1)}_updateListPanel(){this._showListPanel&&(P.uninstall(this.$list,this.session),this._listComponents.forEach(e=>e.remove()),this._listComponents=[],this._renderListPanel(),P.install(this.$list,{parent:this,session:this.session,axis:"y"}))}_remove(){this._uninstallComponentScrollbars(this.$grid),this._uninstallComponentScrollbars(this.$topGrid),this.$window.off("mousemove touchmove",this._mouseMoveHandler).off("mouseup touchend touchcancel",this._mouseUpHandler),this._moveData=null,super._remove()}_renderListPanel(){let e,t=[];this.$listTitle.text(this._format(this.selectedDate,"d. MMMM yyyy")),this.components.forEach(r=>{s.call(this,r)&&t.push(r)});function s(r){let n=w.trunc(this.selectedDate);return w.compare(n,r.coveredDaysRange.from)>=0&&w.compare(n,r.coveredDaysRange.to)<=0}t.forEach(r=>{e=new eu(this.selectedDate,r),e.render(this.$list),this._listComponents.push(e)})}_selectedComponentChanged(e,t,s){this._setSelection(t,e,s,!1)}_onDayContextMenu(e){this._showContextMenu(e,He.MenuTypes.EmptySpace)}_showContextMenu(e,t){e.preventDefault(),e.stopPropagation();let s=function(n,o){if(!this.rendered||!this.attached)return;let l=We.filter(this.menus,[o],{onlyVisible:!0}),h=a()(n.currentTarget);if(l.length===0)return;u.create(ft,{parent:this,menuItems:l,location:{x:n.pageX,y:n.pageY},$anchor:h}).open()}.bind(this);this.session.onRequestsDone(s,e,t)}_arrangeComponents(){let e,t,s,r,n,o,l,h,d=a()(".calendar-day",this.$grid);for(e=0;e<d.length;e++){if(s=d.eq(e),n=s.children(".calendar-component:not(.component-task)"),r=s.children(".calendar-component"),h=s.data("date"),o=s.children(".calendar-scrollable-components"),o.length>0&&(P.uninstall(o,this.session),o.remove()),this.isMonth()&&r.length>0){for(o=s.appendDiv("calendar-scrollable-components"),t=0;t<r.length;t++){let c=r.eq(t);!this.isMonth()&&!c.hasClass("component-task")||o.append(c)}P.install(o,{parent:this,session:this.session,axis:"y"})}this.isMonth()&&n.length>2?s.addClass("many-items"):!this.isMonth()&&n.length>1&&(l=this._getComponents(n),this._arrange(l,h),this._arrangeComponentSetPlacement(n,h))}this.isMonth()?(this._uninstallScrollbars(),this._uninstallComponentScrollbars(this.$topGrid),this.$grid.removeClass("calendar-scrollable-components")):(this.$grid.addClass("calendar-scrollable-components"),this._installScrollbars({parent:this,session:this.session,axis:"y"}),this.$topGrid.find(".calendar-scrollable-components").each((c,f)=>{let m=a()(f);if(m.data("scrollable")){P.update(m);return}P.install(m,{parent:this,session:this.session,axis:"y",scrollShadow:"none"})}))}_getComponents(e){let t,s,r=[];for(t=0;t<e.length;t++)s=e.eq(t),r.push(s.data("component"));return r}_sort(e){e.sort(this._sortFromTo)}_arrange(e,t){let s=[],r=t+"";this._sort(e);for(let n=0;n<e.length;n++){let o=e[n];o.stack||(o.stack={}),o.stack[r]={}}for(let n=0;n<e.length;n++){let o=e[n],l=o.getPartDayPosition(t);s.length>0&&this._allEndBefore(s,l.from,t)&&(s=[]);let h=this._findReplacableColumn(s,l.from,t);h>=0?(s[h]=o,o.stack[r].x=h):(s.push(o),o.stack[r].x=s.length-1);for(let d=0;d<s.length;d++)s[d].stack[r].w=s.length}}_allEndBefore(e,t,s){let r;for(r=0;r<e.length;r++)if(!this._endsBefore(e[r],t,s))return!1;return!0}_findReplacableColumn(e,t,s){let r;for(r=0;r<e.length;r++)if(this._endsBefore(e[r],t,s))return r;return-1}_endsBefore(e,t,s){return e.getPartDayPosition(s).to<=t}_arrangeComponentSetPlacement(e,t){let s,r,n;for(s=0;s<e.length;s++)r=e.eq(s),n=r.data("component").stack[t+""],r.css("width",100/n.w+"%").css("left",n.x*100/n.w+"%")}get$Scrollable(){return this.$grid}_onMouseDown(e){if(this._moveData)return;let t=this._getCalendarComponentForMouseEvent(e);!t||!t.draggable||!this.isMonth()&&t.fullDay||t._$parts.length>1||e.which!==3&&(this.$window.off("mousemove touchmove",this._mouseMoveHandler).off("mouseup touchend touchcancel",this._mouseUpHandler).on("mousemove touchmove",this._mouseMoveHandler).on("mouseup touchend touchcancel",this._mouseUpHandler),this._moveData=this._newMoveData(e),this._onComponentMouseDown(e,t),this._moveData.onMove=this._onComponentMouseMove.bind(this),this._moveData.onUp=this._onComponentMouseUp.bind(this))}_onMouseMove(e){ot.fixTouchEvent(e),this._moveData.event=e,this._moveData.currentCursorPosition=new X(e.pageX-this._moveData.containerOffset.left+this._moveData.containerScrollPosition.x,e.pageY-this._moveData.containerOffset.top+this._moveData.containerScrollPosition.y),this._scrollViewportWhileDragging(e),this._moveData.onMove&&!this._moveData.cancelled&&this._moveData.onMove(e)}_scrollViewportWhileDragging(e){if(!this._moveData||this._moveData.mode==="pan"||this._moveData.cancelled)return;this._moveData.viewportScroller||(this._moveData.viewportScroller=u.create(Ps,a().extend({viewportWidth:this.$grid.width(),viewportHeight:this.$grid.height(),active:()=>!!this._moveData,scroll:(s,r)=>{let n=this.get$Scrollable().scrollTop()+r;P.scrollTop(this.get$Scrollable(),n),this._moveData.containerScrollPosition=new X(this.get$Scrollable().scrollLeft(),this.get$Scrollable().scrollTop())}})));let t=this._moveData.currentCursorPosition.subtract(this._moveData.containerScrollPosition);this._moveData.viewportScroller.update(t)}_onMouseUp(e){this.$window.off("mousemove touchmove",this._mouseMoveHandler).off("mouseup touchend touchcancel",this._mouseUpHandler),ot.fixTouchEvent(e),this._moveData.event=e,this._moveData.onUp&&!this._moveData.cancelled&&this._moveData.onUp(e),this._moveData=null}_onComponentMouseDown(e,t){this._moveData.component=t;let s=t._$parts[0];this._moveData.logicalX=s.closest(".calendar-day").data().day,this._moveData.logicalY=Math.round(s.position().top)/this.heightPerDivision,this.isMonth()&&(this._moveData.logicalY=s.closest(".calendar-day").data().week),e.preventDefault()}_onComponentMouseMove(e){this._moveData.rafId||(this._moveData.rafId=requestAnimationFrame(this._whileComponentMove.bind(this)))}_onComponentMouseUp(e){this._endComponentMove()}_whileComponentMove(){this._moveData.rafId=null;let e=new X(this._moveData.currentCursorPosition.x-this._moveData.startCursorPosition.x,this._moveData.currentCursorPosition.y-this._moveData.startCursorPosition.y);if(!this._moveData.moving){if(Math.abs(e.x)<7&&Math.abs(e.y)<7)return;this._moveData.moving=!0}let t=this.toLogicalPosition(e),s=1,r=this.isMonth()?1:0,n=this.isWorkWeek()?this.workDayIndices.length:7,o=this.isMonth()?this.monthViewNumberOfWeeks:24*this.numberOfHourDivisions-Math.ceil(this._moveData.component.getLengthInHoursDecimal()*this.numberOfHourDivisions);function l(d){let c=d.x,f=d.y;c<s?t.x-=c-s:c>n&&(t.x-=c-n),f<r?t.y-=f-r:f>o&&(t.y-=f-o)}l(new X(this._moveData.logicalX,this._moveData.logicalY).add(t)),this._moveData.distance=t;let h=new X(this._moveData.logicalX,this._moveData.logicalY).add(this._moveData.distance);this._setComponentLogicalPosition(this._moveData.component,h)}_endComponentMove(){this._moveData.rafId&&(cancelAnimationFrame(this._moveData.rafId),this._moveData.rafId=null);let e=this._moveData.component;if(this._moveData.distance){let t=!1,s=new X(this._moveData.logicalX,this._moveData.logicalY).add(this._moveData.distance),r=s.x-this._moveData.logicalX,n=s.y-this._moveData.logicalY;if(t=t||!!r||!!n,t){let o=w.parseJsonDate(e.toDate),l=w.parseJsonDate(e.fromDate),h=r;if(this.isMonth())h+=n*7;else{let d=this._hourMinuteByDivision(n);l=w.shiftTime(l,d.hour,d.minute),o=w.shiftTime(o,d.hour,d.minute)}l=w.shift(l,0,0,h),o=w.shift(o,0,0,h),e.fromDate=this._format(l,"yyyy-MM-dd HH:mm:ss.SSS"),e.toDate=this._format(o,"yyyy-MM-dd HH:mm:ss.SSS"),e.coveredDaysRange=new Ve(w.trunc(l),w.trunc(o)),this._renderComponents(),this.trigger("componentMove",{component:e})}}}_setComponentLogicalPosition(e,t){let s=e._$parts[0],r=s.closest(".calendar-day").data("day"),n=s.closest(".calendar-day").data("week");if(e.rendered)if(this.isMonth()){if(r!==t.x||n!==t.y){let o=a()(".calendar-week:not(.hidden) > .calendar-day").filter(function(){return a()(this).data("day")===t.x&&a()(this).data("week")===t.y}),l=o.find(".calendar-scrollable-components");o=l.length>0?l:o,s.detach().appendTo(o)}}else{r!==t.x&&s.detach().appendTo(a()(".calendar-week:not(.hidden) > .calendar-day").filter(function(){return a()(this).data("day")===t.x}));let o=this._dayPositionByDivision(t.y)+"%";s.css("top",o)}}_getCalendarComponentForMouseEvent(e){let t=a()(e.target);for(t=a().ensure(t);t&&t.length>0;){let s=t.data("component");if(s)return s;t=t.parent()}return null}_newMoveData(e){let t={};return t.event=e,t.cancel=()=>{t.cancelled=!0},t.unitX=this.widthPerDivision,t.unitY=this.heightPerDivision,this.isMonth()&&(t.unitY=a()(e.target).closest(".calendar-day").height()),t.containerOffset=this.$grid.offset(),t.containerScrollPosition=new X(this.get$Scrollable().scrollLeft(),this.get$Scrollable().scrollTop()),t.startCursorPosition=new X(e.pageX-t.containerOffset.left+t.containerScrollPosition.x,e.pageY-t.containerOffset.top+t.containerScrollPosition.y),t.currentCursorPosition=t.startCursorPosition,t}toLogicalPosition(e,t,s){let r;return e instanceof X?(r=e,s=t):r=new X(e,t),this.isDay()&&(r.x=0),new X(Ke.round(r.x/this._moveData.unitX,s),Ke.round(r.y/this._moveData.unitY,s))}_hourMinuteByDivision(e){e/=this.numberOfHourDivisions;let t=Math.floor(e),s=e-t,r=1/60;s=r*Math.round(s/r);let n=Math.floor(s*60);return{hour:t,minute:n}}_dayPositionByDivision(e){let t=this._hourMinuteByDivision(e);return this._dayPosition(t.hour,t.minute)}_dayPosition(e,t){let s;return e<0?s=0:s=100/(24*60)*(e*60+t),Math.round(s*100)/100}_format(e,t){return w.format(e,this.session.locale,t)}_sortFromTo(e,t){let s=w.parseJsonDate(e.fromDate),r=w.parseJsonDate(t.fromDate),n=w.compare(s,r);if(n!==0)return n;let o=w.parseJsonDate(e.toDate),l=w.parseJsonDate(t.toDate),h=w.compare(o,l);if(h!==0)return h;let d=e.item&&e.item.subject?e.item.subject:"",c=t.item&&t.item.subject?t.item.subject:"";return d.localeCompare(c)}_startRangeSelection(e){if(!this.rangeSelectionAllowed||this._rangeSelectionStarted||x.get().type===x.Type.MOBILE)return;let t=this._getSelectedDateTime(e);e.which===3&&this.selectedRange&&t&&w.compare(t,this.selectedRange.from)>=0&&w.compare(t,this.selectedRange.to)<0||!a()(e.target).hasClass("calendar-range-selector")&&!a()(e.target).hasClass("calendar-day")||(this.selectorStart=this._getSelectedDateTime(e),this.selectorStart&&(this.selectorEnd=new Date(this.selectorStart),!(!this.selectorStart||!this.selectorEnd)&&(this.$window.off("mousemove",this._mouseMoveRangeSelectionHandler).off("mouseup",this._mouseUpRangeSelectionHandler).on("mousemove",this._mouseMoveRangeSelectionHandler).on("mouseup",this._mouseUpRangeSelectionHandler),this._setRangeSelection(),this._rangeSelectionStarted=!0)))}_findDayInCalendar(e){let t=null;return a()(".calendar-day",this.$container).each((s,r)=>{let n=a()(r),o=n.data("date");w.compareDays(o,e)===0&&(t=n)}),t}_setRangeSelection(){let e,t;if(!this.selectorStart||!this.selectorEnd)return;this._removeRangeSelection(),w.compare(this.selectorStart,this.selectorEnd)>0?(e=this.selectorEnd,t=this.selectorStart):(e=this.selectorStart,t=this.selectorEnd);let s=w.compareDays(t,e)+1;if(s===1)this._appendCalendarRangeSelection(e,e,t);else if(s>1){this._appendCalendarRangeSelection(e,e,null);for(let r=1;r<s-1;r++){let n=new Date(e);n.setDate(n.getDate()+r),this._appendCalendarRangeSelection(n,null,null)}this._appendCalendarRangeSelection(t,null,t)}}_removeRangeSelection(){a()(".calendar-range-selector").remove()}_appendCalendarRangeSelection(e,t,s){let r=this._findDayInCalendar(e);if(!r)return;let n=t?this._dayPosition(this._getHours(t),0):0,o=s?this._dayPosition(this._getHours(s)+.5,0):100;r.appendDiv("calendar-range-selector").css("top",n+"%").css("height",o-n+"%")}_getHours(e){return Math.round((e.getHours()+e.getMinutes()/60)*2)/2}_onMouseMoveRangeSelection(e){let t=this._getSelectedDateTime(e);t&&(this.selectorEnd=t),this._setRangeSelection()}_onMouseUpRangeSelection(e){this._mouseMoveRangeSelectionHandler&&this.$window.off("mousemove",this._mouseMoveRangeSelectionHandler),this._mouseUpRangeSelectionHandler&&this.$window.off("mouseup",this._mouseUpRangeSelectionHandler),this._rangeSelectionStarted&&(this._rangeSelectionStarted=!1,this.rendered&&(this._setRangeSelection(),this._updateSelectedRange()))}_updateSelectedRange(){let e,t;this.selectorStart&&this.selectorEnd?(w.compare(this.selectorStart,this.selectorEnd)>0?(e=new Date(this.selectorEnd),t=new Date(this.selectorStart)):(e=new Date(this.selectorStart),t=new Date(this.selectorEnd)),e.setHours(0,this._getHours(e)*60),t.setHours(0,this._getHours(t)*60+30),this.selectedRange=new Ve(e,t)):this.selectedRange=null,this.trigger("selectedRangeChange")}}W(He,"DisplayMode",{DAY:1,WEEK:2,MONTH:3,WORK_WEEK:4}),W(He,"Direction",{BACKWARD:-1,FORWARD:1}),W(He,"MenuTypes",{EmptySpace:"Calendar.EmptySpace",CalendarComponent:"Calendar.CalendarComponent"});class Nm extends ke{_postCreateWidget(){this._sendViewRangeChange()}_onWidgetEvent(e){e.type==="viewRangeChange"?this._sendViewRangeChange():e.type==="modelChange"?this._sendModelChange():e.type==="selectionChange"?this._sendSelectionChange():e.type==="componentMove"?this._sendComponentMove(e):e.type==="selectedRangeChange"?this._sendSelectedRangeChange():super._onWidgetEvent(e)}_jsonViewRange(){return w.toJsonDateRange(this.widget.viewRange)}_jsonSelectedRange(){return this.widget.selectedRange?w.toJsonDateRange(this.widget.selectedRange):null}_jsonSelectedDate(){return w.toJsonDate(this.widget.selectedDate)}_sendViewRangeChange(){this._send("viewRangeChange",{viewRange:this._jsonViewRange()})}_sendSelectedRangeChange(){this._send("selectedRangeChange",{selectedRange:this._jsonSelectedRange()})}_sendModelChange(){let e={viewRange:this._jsonViewRange(),selectedDate:this._jsonSelectedDate(),displayMode:this.widget.displayMode};this._send("modelChange",e)}_sendSelectionChange(){let e=this.widget.selectedComponent?this.widget.selectedComponent.id:null;this._send("selectionChange",{date:this._jsonSelectedDate(),componentId:e})}_sendComponentMove(e){this._send("componentMove",{componentId:e.component.id,fromDate:e.component.fromDate,toDate:e.component.toDate})}}function Bs(i,e,t){return e=MS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function MS(i){var e=IS(i,"string");return typeof e=="symbol"?e:String(e)}function IS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ro extends I{constructor(){super(),Bs(this,"fromDate",void 0),Bs(this,"toDate",void 0),Bs(this,"selected",void 0),Bs(this,"fullDay",void 0),Bs(this,"draggable",void 0),Bs(this,"item",void 0),Bs(this,"stack",void 0),Bs(this,"coveredDaysRange",void 0),Bs(this,"_$parts",void 0),this.selected=!1,this.fullDay=!1,this.item=null,this._$parts=[]}_init(e){super._init(e),this._syncCoveredDaysRange(e.coveredDaysRange)}_syncCoveredDaysRange(e){e&&(this.coveredDaysRange=new Ve(w.parseJsonDate(e.from),w.parseJsonDate(e.to)))}_remove(){this._$parts.forEach(e=>e.remove()),this._$parts=[],super._remove()}_startLoopDay(){return w.compare(this.coveredDaysRange.from,this.parent.viewRange.from)>0?this.coveredDaysRange.from:this.parent.viewRange.from}_render(){let e,t,s;if(!this.coveredDaysRange)return;let r=this._startLoopDay(),n=w.parseJsonDate(this.toDate),o=w.parseJsonDate(this.fromDate),l=this.coveredDaysRange.to;if(!this.fullDay){let d=w.trunc(n);!w.isSameDay(o,n)&&w.compare(n,d)===0&&(n=w.shiftTime(n,0,0,0,-1),l=w.shift(l,0,0,-1))}n=w.toJsonDate(n);let h=w.shift(l,0,0,1);if(!(w.compare(r,h)>0))for(;!w.isSameDay(r,h)&&(e=r,r=w.shift(r,0,0,1),!(w.compare(e,this.parent.viewRange.to)>0));){if(this.fullDay&&!this.parent.isMonth()?t=this._findDayInGrid(e,this.parent.$topGrid):t=this._findDayInGrid(e,this.parent.$grid),!t)continue;s=t.appendDiv("calendar-component"),s.addClass(this.item.cssClass).data("component",this).data("partDay",e).on("mouseup",this._onMouseUp.bind(this)).on("contextmenu",this._onContextMenu.bind(this)),s.appendDiv("calendar-component-leftcolorborder");let d=s.appendDiv("content");if(this.item.subjectIconId&&d.appendIcon(this.item.subjectIconId),d.appendSpan("subject",this.item.subject),this._$parts.push(s),this.parent.isMonth()){let c=t.data("new-width")||t.width();s.addClass("component-month").toggleClass("compact",c<ro.MONTH_COMPACT_THRESHOLD)}else if(this.fullDay){let c=a()(".component-task",t).length;this._arrangeTask(30+26*c),s.addClass("component-task")}else{let c=w.parseJsonDate(this.fromDate),f=w.parseJsonDate(n),m=this._getHours(this.fromDate),_=this._getHours(n);s.addClass("component-day"),w.isSameDay(w.trunc(this.coveredDaysRange.from),w.trunc(l))?this._partPosition(s,m,_):w.isSameDay(e,c)?this._partPosition(s,m,25).addClass("component-open-bottom"):w.isSameDay(e,f)?this._partPosition(s,0,_).addClass("component-open-top"):this._partPosition(s,0,25).addClass("component-open-top").addClass("component-open-bottom")}}}_getHours(e){let t=w.parseJsonDate(e);return t.getHours()+t.getMinutes()/60}getLengthInHoursDecimal(){let e=w.parseJsonDate(this.toDate),t=w.parseJsonDate(this.fromDate);return(e.getTime()-t.getTime())/(1e3*60*60)}_findDayInGrid(e,t){return t.find(".calendar-day").filter(function(s,r){return w.isSameDay(a()(this).data("date"),e)}).eq(0)}_isTask(){return!this.parent.isMonth()&&this.fullDay}_arrangeTask(e){this._$parts.forEach(t=>t.css("top",e+"px"))}_isDayPart(){return!this.parent.isMonth()&&!this.fullDay}_getHourRange(e){let t=new B(this._getHours(this.fromDate),this._getHours(this.toDate)),s=new Ve(w.parseJsonDate(this.fromDate),w.parseJsonDate(this.toDate));return w.isSameDay(e,s.from)&&w.isSameDay(e,s.to)?new B(t.from,t.to):w.isSameDay(e,s.from)?new B(t.from,24):w.isSameDay(e,s.to)?new B(0,t.to):new B(0,24)}getPartDayPosition(e){return this._getDisplayDayPosition(this._getHourRange(e))}_getDisplayDayPosition(e){let t=new B(this.parent._dayPosition(e.from,0),this.parent._dayPosition(e.to,0)),s=Math.round(100*100/24/this.parent.numberOfHourDivisions)/100;return t.size()<s?new B(t.from,t.from+s):t}_partPosition(e,t,s){let r=s===25?23:0;s=Math.min(24,s);let n=new B(t,s),o=this._getDisplayDayPosition(n);return r=Math.round(100*(100/1920*r))/100,e.css("top",o.from+"%").css("height",o.to-o.from-r+"%")}_renderProperties(){super._renderProperties(),this._renderSelected()}_renderSelected(){this._$parts.forEach(e=>e.toggleClass("comp-selected",this.selected))}setSelected(e){this.setProperty("selected",e)}updateSelectedComponent(e,t){this.parent._selectedComponentChanged(this,e.data("partDay"),t)}_onMouseUp(e){if(this.parent._moveData&&this.parent._moveData.moving||this.parent._rangeSelectionStarted)return;let t=a()(e.delegateTarget);if(this.updateSelectedComponent(t,!1),e.button===0){let s=u.create(eo,{parent:this.parent,$anchor:t,closeOnAnchorMouseDown:!0,closeOnMouseDownOutside:!0,closeOnOtherPopupOpen:!0,horizontalAlignment:ue.Alignment.LEFT,verticalAlignment:ue.Alignment.CENTER,trimWidth:!1,trimHeight:!0,horizontalSwitch:!0,verticalSwitch:!1,withArrow:!0,cssClass:"popup",scrollType:"remove",location:{y:e.originalEvent.clientY},content:{objectType:da,htmlEnabled:!0,scrollable:!0,cssClass:"calendar-component-tooltip-content tooltip-content",value:this.description(!0)}});s.open(),s.$container.find(".app-link").on("click",this._onAppLinkAction.bind(this))}}_onContextMenu(e){this.parent._showContextMenu(e,He.MenuTypes.CalendarComponent)}_format(e,t){return w.format(e,this.session.locale,t)}description(e){let t=null,s=a()("<div>"),r=w.parseJsonDate(this.fromDate),n=w.parseJsonDate(this.toDate),o=y.hasText(this.item.description)||this.item.descriptionElements,l=s.appendDiv("calendar-component-header");if(o&&l.addClass("with-description"),y.hasText(this.item.subject)){y.hasText(this.item.subjectLabel)&&l.appendDiv("calendar-component-title-label",this.item.subjectLabel);let h=l.appendDiv("calendar-component-title",this.item.subject);e&&y.hasText(this.item.subjectAppLink)&&h.addClass("app-link").attr("data-ref",this.item.subjectAppLink)}if(this.fullDay||(w.isSameDay(r,n)?t=this.session.text("ui.FromXToY",this._format(r,"HH:mm"),this._format(n,"HH:mm")):t=this.session.text("ui.FromXToY",this._format(r,"EEEE HH:mm "),this._format(n,"EEEE HH:mm"))),y.hasText(t)){let h=l.appendDiv("calendar-component-intro");h.appendIcon(ye.CLOCK),h.appendSpan("",t)}if(o){let h=s.appendDiv("calendar-component-description-container");if(y.hasText(this.item.description)&&h.appendSpan("calendar-component-description").html(y.nl2br(this.item.description)),this.item.descriptionElements){let d=!1;for(let c=0;c<this.item.descriptionElements.length;c++)if(this.item.descriptionElements[c].iconId){d=!0;break}for(let c=0;c<this.item.descriptionElements.length;c++){let f=this.item.descriptionElements[c],m=h.appendDiv("calendar-component-description-element");c===0&&m.addClass("first"),c===this.item.descriptionElements.length-1&&m.addClass("last"),(y.hasText(f.iconId)||d)&&m.appendIcon(f.iconId);let _=m.appendDiv("text").html(y.nl2br(f.text));e&&y.hasText(f.appLink)&&_.addClass(" app-link").attr("data-ref",f.appLink)}}}return s[0].innerHTML}triggerAppLinkAction(e){this.trigger("appLinkAction",{ref:e})}_onAppLinkAction(e){let s=a()(e.delegateTarget).data("ref");this.triggerAppLinkAction(s)}}Bs(ro,"MONTH_COMPACT_THRESHOLD",100);class Vm extends ke{_onWidgetAppLinkAction(e){this._send("appLinkAction",{ref:e.ref})}_onWidgetEvent(e){e.type==="appLinkAction"?this._onWidgetAppLinkAction(e):super._onWidgetEvent(e)}}function ol(i,e,t){return e=LS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function LS(i){var e=OS(i,"string");return typeof e=="symbol"?e:String(e)}function OS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class eu{constructor(e,t){ol(this,"partDay",void 0),ol(this,"source",void 0),ol(this,"$container",void 0),ol(this,"_selectedListener",void 0),ol(this,"_removeListener",void 0),this.partDay=e,this.source=t,this.$container=null,this._selectedListener=t.on("propertyChange:selected",s=>{this.$container.toggleClass("comp-selected",s.newValue)}),this._removeListener=t.on("remove",this.remove.bind(this))}render(e){let t=this.source;this.$container=e.appendDiv("calendar-component").data("partDay",this.partDay).addClass(t.item.cssClass).toggleClass("comp-selected",t.selected).on("mousedown",this._onMouseDown.bind(this,t)).on("contextmenu",t._onContextMenu.bind(t)),this.$container.appendDiv("calendar-component-leftcolorborder"),this.$container.appendDiv("content").html(t.description(!1))}_onMouseDown(e,t){t.preventDefault();let s=$(t.delegateTarget);e.updateSelectedComponent(s,!0)}remove(){this.source.removeListener(this._selectedListener),this.source.removeListener(this._removeListener),this.$container.remove()}}function wa(i,e,t){return e=BS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function BS(i){var e=kS(i,"string");return typeof e=="symbol"?e:String(e)}function kS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class tu extends ee{constructor(e){super(),wa(this,"calendar",void 0),wa(this,"stacked",void 0),wa(this,"compacted",void 0),wa(this,"compactWidth",void 0),this.calendar=e,this.stacked=!1,this.compacted=!1,this.compactWidth=550}layout(e){let t=0,s=0,r=this.calendar.yearPanel.$container,n=this.calendar.$grids,o=this.calendar.$listContainer,l=this.calendar.$header;t+=e.cssMarginTop()+e.cssMarginBottom(),e.css("height","calc(100% - "+t+"px)"),this.undoCompact(),this.undoStack(),l[0].scrollWidth>e.width()&&this.stack(),(e.width()<this.compactWidth||l[0].scrollWidth>e.width())&&this.compact(),s=l.outerHeight(!0),r.css("height","calc(100% - "+(s+r.cssMarginY())+"px)"),n.css("height","calc(100% - "+(s+n.cssMarginY())+"px)"),o.css("height","calc(100% - "+(s+o.cssMarginY())+"px)"),this.calendar.layoutSize(),this.calendar.layoutYearPanel()}compact(){if(this.compacted)return;let e=this.calendar.$headerRow2;this.calendar.$title.appendTo(this.calendar.$headerRow2),e.show(),this.compacted=!0}undoCompact(){if(!this.compacted)return;let e=this.calendar.$headerRow2;this.calendar.$title.insertBefore(this.calendar.$commands),e.hide(),this.compacted=!1}stack(){this.stacked||(this.calendar.$commands.children(".calendar-mode").hide(),this.calendar.modesMenu.setVisible(!0),this.stacked=!0)}undoStack(){!this.stacked||(this.calendar.$commands.children(".calendar-mode").show(),this.calendar.modesMenu.setVisible(!1),this.stacked=!1)}}function HS(i,e,t){return e=NS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function NS(i){var e=VS(i,"string");return typeof e=="symbol"?e:String(e)}function VS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class no extends ne{constructor(){super(...arguments),HS(this,"displayMode",void 0)}doAction(){return this.prepareDoAction()?(this.setSelected(!0),this.parentMenu.setSelected(!1),!0):!1}}function Wm(i,e,t){return e=WS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function WS(i){var e=zS(i,"string");return typeof e=="symbol"?e:String(e)}function zS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class iu extends ne{constructor(){super(),Wm(this,"calendar",void 0),Wm(this,"displayMode",void 0),this.cssClass="calendar-mode-menu"}_init(e){super._init(e),this.calendar=this.parent;let t=[];t.push(u.create(no,{parent:this,displayMode:He.DisplayMode.DAY,text:this.session.text("ui.CalendarDay")})),t.push(u.create(no,{parent:this,displayMode:He.DisplayMode.WORK_WEEK,text:this.session.text("ui.CalendarWorkWeek")})),t.push(u.create(no,{parent:this,displayMode:He.DisplayMode.WEEK,text:this.session.text("ui.CalendarWeek")})),t.push(u.create(no,{parent:this,displayMode:He.DisplayMode.MONTH,text:this.session.text("ui.CalendarMonth")})),this.insertChildActions(t),this.childActions.forEach(s=>s.on("propertyChange",this._onMenuPropertyChange.bind(this))),this._setDisplayMode(this.displayMode)}setDisplayMode(e){this.setProperty("displayMode",e)}_setDisplayMode(e){this._setProperty("displayMode",e);let t=this.getMenuForMode(this.displayMode);t.setSelected(!0),this.setText(t.text)}getMenuForMode(e){return p.find(this.childActions,t=>t.displayMode===e)}_onMenuPropertyChange(e){if(e.propertyName==="selected"){let t=e;if(t.newValue){let r=t.source,n=r.displayMode;this.setDisplayMode(n),this.calendar.setDisplayMode(n),this.childActions.forEach(o=>{o!==r&&o.setSelected(!1)})}}}}function zm(i,e,t){return e=KS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function KS(i){var e=GS(i,"string");return typeof e=="symbol"?e:String(e)}function GS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ve{constructor(e,t){zm(this,"from",void 0),zm(this,"to",void 0),this.from=e,this.to=t}equals(e){return e?w.equals(this.from,e.from)&&w.equals(this.to,e.to):!1}toString(){return"scout.DateRange[from="+(this.from===null?"null":this.from.toUTCString())+" to="+(this.to===null?"null":this.to.toUTCString())+"]"}static ensure(e){return!e||e instanceof Ve?e:new Ve(w.ensure(e.from),w.ensure(e.to))}}function on(i,e,t){return e=US(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function US(i){var e=qS(i,"string");return typeof e=="symbol"?e:String(e)}function qS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ta extends I{constructor(){super(...arguments),on(this,"$yearTitle",void 0),on(this,"$yearList",void 0),on(this,"selectedDate",void 0),on(this,"displayMode",void 0),on(this,"alwaysSelectFirstDay",void 0),on(this,"yearRendered",void 0),on(this,"viewRange",void 0)}_init(e){super._init(e),this.alwaysSelectFirstDay=e.alwaysSelectFirstDay}_render(){this.$container=this.$parent.appendDiv("year-panel-container"),this.$yearTitle=this.$container.appendDiv("year-panel-title"),this.$yearList=this.$container.appendDiv("year-panel-list")}renderContent(){this.removeContent(),this._drawYear(),this._installScrollbars({axis:"y"}),this.yearRendered=!0,this._colorYear()}get$Scrollable(){return this.$yearList}removeContent(){this._uninstallScrollbars(),this.$yearList.empty(),this.yearRendered=!1}_remove(){this.removeContent(),super._remove()}_drawYear(){let e,t,s,r,n,o=this.selectedDate.getFullYear();for(this.$yearTitle.data("year",o).empty(),this.$yearTitle.appendDiv("year-title-item",o-1+"").data("year-diff",-1).on("click",this._onYearClick.bind(this)),this.$yearTitle.appendDiv("year-title-item selected",o+""),this.$yearTitle.appendDiv("year-title-item",o+1+"").data("year-diff",1).on("click",this._onYearClick.bind(this)),t=0;t<12;t++){e=new Date(o,t,1),s=this.$yearList.appendDiv("year-month").attr("data-title",this._format(e,"MMMM"));for(let l=1;l<=31&&(r=new Date(o,t,l),r.getMonth()===t);l++)n=s.appendDiv("year-day",l+"").data("date",r),(r.getDay()===0||r.getDay()===6)&&n.addClass("weekend"),l===1&&n.css("margin-left",(r.getDay()+6)%7*n.outerWidth())}a()(".year-day",this.$yearList).on("click",this._onYearDayClick.bind(this)).on("mouseenter",this._onYearHoverIn.bind(this)).on("mouseleave",this._onYearHoverOut.bind(this)),P.update(this.$yearList)}_colorYear(){if(!this.yearRendered)return;a()(".year-day.year-range, .year-day.year-range-day",this.$yearList).removeClass("year-range year-range-day");let e=this,t,s;a()(".year-day",this.$yearList).each(function(){t=a()(this),s=t.data("date"),e.displayMode!==He.DisplayMode.DAY&&s>=e.viewRange.from&&s<e.viewRange.to&&t.addClass("year-range"),w.isSameDay(s,e.selectedDate)&&t.addClass("year-range-day")}),this._scrollYear()}_scrollYear(){let e,t,s,r=a()(".year-range-day",this.$yearList),n=r.parent(),o=r.parent().parent();!n[0]||(e=n[0].offsetTop,t=n.outerHeight()/2,s=o.outerHeight()/2,this.$yearList.animateAVCSD("scrollTop",e+t-s))}_format(e,t){return w.format(e,this.session.locale,t)}selectDate(e){this.selectedDate=e,this.rendered&&((!e||e.getFullYear()!==this.$yearTitle.data("year"))&&this.renderContent(),this._colorYear())}setDisplayMode(e){e!==this.displayMode&&(this._setProperty("displayMode",e),this.rendered&&this._colorYear())}setViewRange(e){e!==this.viewRange&&(this._setProperty("viewRange",e),this.rendered&&this._colorYear())}_onYearClick(e){let t=ae.DisplayMode,s=a()(e.target).data("year-diff"),r=this.selectedDate.getFullYear(),n=this.selectedDate.getMonth(),o=this.selectedDate.getDate(),l=new Date(r+s,n,o),h,d,c;this.alwaysSelectFirstDay&&(u.isOneOf(this.displayMode,t.WEEK,t.WORK_WEEK,t.CALENDAR_WEEK)?(h=w.weekInYear(this.selectedDate),d=w.weekInYear(l),c=h-d,l=w.shift(l,0,0,c*7),l=w.shiftToNextOrPrevMonday(l,0)):u.isOneOf(this.displayMode,t.MONTH,t.YEAR)&&(l=new Date(r+s,n,1))),this.selectedDate=l,this.trigger("dateSelect",{date:this.selectedDate})}_onYearDayClick(e){this.selectedDate=a()(".year-hover-day",this.$yearList).data("date"),this.selectedDate&&this.trigger("dateSelect",{date:this.selectedDate})}_onYearHoverIn(e){let t=a()(e.target),s=t.data("date"),r=s.getFullYear(),n=s.getMonth(),o=s.getDate(),l=(s.getDay()+6)%7,h,d,c,f;this.displayMode===He.DisplayMode.DAY?(h=new Date(r,n,o),d=new Date(r,n,o)):this.displayMode===He.DisplayMode.WEEK?(h=new Date(r,n,o-l),d=new Date(r,n,o-l+6)):this.displayMode===He.DisplayMode.WORK_WEEK?(h=new Date(r,n,o-l),d=new Date(r,n,o-l+4),s>d&&(s=d)):this.displayMode===He.DisplayMode.MONTH?(h=new Date(r,n,1),d=new Date(r,n+1,0)):this.displayMode===ae.DisplayMode.YEAR?(h=new Date(r,n,1),d=h):(h=new Date(r,n,o-l),d=h),this.alwaysSelectFirstDay&&(s=h),a()(".year-day",this.$yearList).each(function(){c=a()(this),f=c.data("date"),f>=h&&f<=d?c.addClass("year-hover"):c.removeClass("year-hover"),w.isSameDay(s,f)&&c.addClass("year-hover-day")})}_onYearHoverOut(e){a()(".year-day.year-hover, .year-day.year-hover-day",this.$yearList).removeClass("year-hover year-hover-day")}}function ji(i,e,t){return e=YS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function YS(i){var e=jS(i,"string");return typeof e=="symbol"?e:String(e)}function jS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class su extends ts{constructor(){super(),ji(this,"objectType",void 0),ji(this,"widget",void 0),ji(this,"validationFailedTextKey",void 0),ji(this,"validationFailedText",void 0),ji(this,"emptyMandatoryElementsTextKey",void 0),ji(this,"emptyMandatoryElementsText",void 0),ji(this,"invalidElementsTextKey",void 0),ji(this,"invalidElementsText",void 0),ji(this,"saveChangesQuestionTextKey",void 0),ji(this,"askIfNeedSave",void 0),ji(this,"askIfNeedSaveText",void 0),ji(this,"handlers",void 0),this.widget=null,this.validationFailedTextKey=null,this.validationFailedText=null,this.emptyMandatoryElementsTextKey=null,this.emptyMandatoryElementsText=null,this.invalidElementsTextKey=null,this.invalidElementsText=null,this.saveChangesQuestionTextKey=null,this.askIfNeedSave=!0,this.askIfNeedSaveText=null,this.handlers={load:this._defaultLoad.bind(this),save:this._defaultSave.bind(this)}}init(e){u.assertParameter("widget",e.widget),a().extend(this,e),b.isNullOrUndefined(this.validationFailedText)&&(this.validationFailedText=this.session().text(this.validationFailedTextKey)),b.isNullOrUndefined(this.emptyMandatoryElementsText)&&(this.emptyMandatoryElementsText=this.session().text(this.emptyMandatoryElementsTextKey)),b.isNullOrUndefined(this.invalidElementsText)&&(this.invalidElementsText=this.session().text(this.invalidElementsTextKey)),b.isNullOrUndefined(this.askIfNeedSaveText)&&(this.askIfNeedSaveText=this.session().text(this.saveChangesQuestionTextKey))}load(){return this._load().then(()=>{this.markAsSaved(),this.trigger("postLoad")})}_load(){return this.handlers.load().then(e=>{this.trigger("load")})}_defaultLoad(){return a().resolvedPromise()}ok(){return this._whenInvalid(this._validate).then(e=>{if(!e)return this.requiresSave()?this._whenInvalid(this._save).then(t=>{if(!t)return this.markAsSaved(),this.close()}):this.close()})}cancel(){return this.requiresSave()&&this.askIfNeedSave?this._showYesNoCancelMessageBox(this.askIfNeedSaveText,this.ok.bind(this),this.close.bind(this)):this.close()}reset(){return this.load().then(()=>{this.trigger("reset")})}close(){return this._close()}_close(){return this.trigger("close"),a().resolvedPromise()}save(){return this._whenInvalid(this._validate).then(e=>{if(!(e||!this.requiresSave()))return this._whenInvalid(this._save).then(t=>{t||this.markAsSaved()})})}_save(){return this.handlers.save().then(e=>(this.trigger("save"),e))}_defaultSave(){return a().resolvedPromise()}markAsSaved(){}requiresSave(){return!1}setAskIfNeedSave(e){this.askIfNeedSave=e}_whenInvalid(e){return e.call(this).then(s=>!s||s.severity===E.Severity.OK?a().resolvedPromise(!1):this._showStatusMessageBox(s)).catch(s=>this._showStatusMessageBox(t(s)));function t(s){return s instanceof E?s:typeof s=="string"?E.error({message:s}):E.error({message:s.message})}}_showYesNoCancelMessageBox(e,t,s){return rr.createYesNoCancel(this.widget).withHeader(e).buildAndOpen().then(r=>r===vi.Buttons.YES?t():r===vi.Buttons.NO?s():a().resolvedPromise())}_showStatusMessageBox(e){return rr.createOk(this.widget).withSeverity(e.severity).withHeader(this.validationFailedText).withBody(e.message,!0).buildAndOpen().then(()=>{let t=e.severity===E.Severity.ERROR;return a().resolvedPromise(t)})}_validate(){let e=this._validateElements();return e.isValid()&&(e=this._validateWidget()),a().resolvedPromise(e)}_validateElements(){let e=this.invalidElements(),t=new E;return e.missingElements.length===0&&e.invalidElements.length===0?t.severity=E.Severity.OK:(t.severity=E.Severity.ERROR,t.message=this._createInvalidElementsMessageHtml(e.missingElements,e.invalidElements),this._revealInvalidElement(p.first(e.missingElements)||p.first(e.invalidElements))),t}_revealInvalidElement(e){}_validateWidget(){return E.ok()}invalidElements(){return{missingElements:[],invalidElements:[]}}_createInvalidElementsMessageHtml(e,t){let s=a()("<div>"),r=e.length>0,n=t.length>0;return r&&o.call(this,s,this.emptyMandatoryElementsText,e,this._missingElementText),r&&n&&s.appendElement("<br>"),n&&o.call(this,s,this.invalidElementsText,t,this._invalidElementText),s.html();function o(l,h,d,c){l.appendDiv().text(h);let f=l.appendElement("<ul>");d.forEach(m=>{f.appendElement("<li>").text(c.call(this,m))})}}_invalidElementText(e){return""}_missingElementText(e){return""}session(){return this.widget.session}handle(e,t){if(["load","save"].indexOf(e)===-1)throw new Error("Cannot register handler for unsupported type '"+e+"'");this.handlers[e]=t}}function J(i,e,t){return e=XS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function XS(i){var e=JS(i,"string");return typeof e=="symbol"?e:String(e)}function JS(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ae extends I{constructor(){super(),J(this,"activityMap",void 0),J(this,"activitySelectable",void 0),J(this,"availableDisplayModes",void 0),J(this,"displayMode",void 0),J(this,"displayModeOptions",void 0),J(this,"headerVisible",void 0),J(this,"label",void 0),J(this,"resources",void 0),J(this,"resourceMap",void 0),J(this,"selectionMode",void 0),J(this,"selectionRange",void 0),J(this,"selectedResources",void 0),J(this,"viewRange",void 0),J(this,"startRange",void 0),J(this,"lastRange",void 0),J(this,"beginScale",void 0),J(this,"endScale",void 0),J(this,"selectedActivity",void 0),J(this,"menus",void 0),J(this,"startRow",void 0),J(this,"lastRow",void 0),J(this,"menuBar",void 0),J(this,"header",void 0),J(this,"yearPanel",void 0),J(this,"transformLeft",void 0),J(this,"transformWidth",void 0),J(this,"yearPanelVisible",void 0),J(this,"$range",void 0),J(this,"$modes",void 0),J(this,"$selector",void 0),J(this,"$grid",void 0),J(this,"$highlight",void 0),J(this,"$timeline",void 0),J(this,"$timelineLarge",void 0),J(this,"$timelineSmall",void 0),J(this,"$scaleTitle",void 0),J(this,"$scale",void 0),J(this,"_resourceTitleWidth",void 0),J(this,"_rangeSelectionStarted",void 0),J(this,"_tooltipSupport",void 0),J(this,"_gridScrollHandler",void 0),J(this,"_cellMousemoveHandler",void 0),J(this,"_resizeMousemoveHandler",void 0),this.activityMap={},this.activitySelectable=!1,this.availableDisplayModes=[],this.displayMode=null,this.displayModeOptions={},this.headerVisible=!0,this.label=null,this.resources=[],this.resourceMap={},this.selectionMode=ae.SelectionMode.MULTI_RANGE,this.selectionRange=new Ve,this.selectedResources=[],this.viewRange=new Ve,this.selectedActivity=null,this.startRow=null,this.lastRow=null,this._resourceTitleWidth=20,this._rangeSelectionStarted=!1,this.$container=null,this.$range=null,this.$modes=null,this.$grid=null,this.transformLeft=e=>e,this.transformWidth=(e,t)=>t-e,this.yearPanelVisible=!1,this._addWidgetProperties(["menus"])}_createKeyStrokeContext(){return new Oe}_init(e){super._init(e),this.yearPanel=u.create(Ta,{parent:this,alwaysSelectFirstDay:!0}),this.yearPanel.on("dateSelect",this._onYearPanelDateSelect.bind(this)),this.header=u.create(ru,{parent:this}),this.header.on("todayClick",this._onTodayClick.bind(this)),this.header.on("yearClick",this._onYearClick.bind(this)),this.header.on("previousClick",this._onPreviousClick.bind(this)),this.header.on("nextClick",this._onNextClick.bind(this)),this.header.on("displayModeClick",this._onDisplayModeClick.bind(this)),this.menuBar=u.create(ce,{parent:this,position:ce.Position.BOTTOM,menuOrder:new ou(this.session,"Planner"),cssClass:"bounded"});for(let t=0;t<this.resources.length;t++)this._initResource(this.resources[t]);this._setDisplayMode(this.displayMode),this._setAvailableDisplayModes(this.availableDisplayModes),this._setViewRange(this.viewRange),this._setSelectedResources(this.selectedResources),this._setSelectedActivity(this.selectedActivity),this._setSelectionRange(this.selectionRange),this._setMenus(this.menus),this._setDisplayModeOptions(this.displayModeOptions),this._tooltipSupport=new la({parent:this,arrowPosition:50})}_initResource(e){e.activities.forEach(t=>this._initActivity(t)),this.resourceMap[e.id]=e}_initActivity(e){e.beginTime=w.parseJsonDate(e.beginTime),e.endTime=w.parseJsonDate(e.endTime),this.activityMap[e.id]=e}_render(){this.$container=this.$parent.appendDiv("planner");let e=new nu(this);this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(e),this.header.render(),this.yearPanel.render(),this.$grid=this.$container.appendDiv("planner-grid").on("mousedown",".resource-cells",this._onCellMouseDown.bind(this)).on("mousedown",".resource-title",this._onResourceTitleMouseDown.bind(this)).on("contextmenu",".resource-title",this._onResourceTitleContextMenu.bind(this)).on("contextmenu",".planner-activity",this._onActivityContextMenu.bind(this)),this.$scale=this.$container.appendDiv("planner-scale"),this.menuBar.render(),K.install(this.$grid,{parent:this,selector:".planner-activity",text:function(t){let s=this.activityById(t.attr("data-id"));if(s)return s.tooltipText}.bind(this)}),this._installScrollbars(),this._gridScrollHandler=this._onGridScroll.bind(this),this.$grid.on("scroll",this._gridScrollHandler)}_renderProperties(){super._renderProperties(),this._renderViewRange(),this._renderHeaderVisible(),this._renderYearPanelVisible(!1),this._renderResources(),this._renderSelectedActivity(),this._renderSelectedResources(),setTimeout(this._renderSelectionRange.bind(this))}get$Scrollable(){return this.$grid}_onPreviousClick(e){this._navigateDate(ae.Direction.BACKWARD)}_onNextClick(e){this._navigateDate(ae.Direction.FORWARD)}_navigateDate(e){let t=new Ve(this.viewRange.from,this.viewRange.to),s=ae.DisplayMode;this.displayMode===s.DAY?(t.from=w.shift(this.viewRange.from,0,0,e),t.to=w.shift(this.viewRange.to,0,0,e)):u.isOneOf(this.displayMode,s.WEEK,s.WORK_WEEK)?(t.from=w.shift(this.viewRange.from,0,0,e*7),t.from=w.ensureMonday(t.from,-1*e),t.to=w.shift(this.viewRange.to,0,0,e*7)):u.isOneOf(this.displayMode,s.MONTH,s.CALENDAR_WEEK)?(t.from=w.shift(this.viewRange.from,0,e,0),t.from=w.ensureMonday(t.from,-1*e),t.to=w.shift(this.viewRange.to,0,e,0)):this.displayMode===s.YEAR&&(t.from=w.shift(this.viewRange.from,0,3*e,0),t.to=w.shift(this.viewRange.to,0,3*e,0)),this.setViewRange(t)}_onTodayClick(e){let t=this._today(),s=t.getFullYear(),r=t.getMonth(),n=t.getDate(),o=(t.getDay()+6)%7,l=ae.DisplayMode;this.displayMode===l.DAY?t=new Date(s,r,n):this.displayMode===l.YEAR?t=new Date(s,r,1):t=new Date(s,r,n-o),this.setViewRangeFrom(t)}_today(){return new Date}_onDisplayModeClick(e){let t=e.displayMode;this.setDisplayMode(t)}_onYearClick(e){this.setYearPanelVisible(!this.yearPanelVisible)}_onYearPanelDateSelect(e){this.setViewRangeFrom(e.date)}_onResourceTitleMouseDown(e){let t=a()(e.target).parent();t.isSelected()&&(e.which===3||e.which===1&&e.ctrlKey)||(this.startRow=t.data("resource"),this.lastRow=this.startRow,this._select())}_onResourceTitleContextMenu(e){this._showContextMenu(e,ae.MenuTypes.Resource)}_onRangeSelectorContextMenu(e){this._showContextMenu(e,ae.MenuTypes.Range)}_onActivityContextMenu(e){this._showContextMenu(e,ae.MenuTypes.Activity)}_showContextMenu(e,t){e.preventDefault(),e.stopPropagation();let s=function(n,o){if(!this.rendered||!this.attached)return;let l=this._filterMenus([o],!0),h=a()(n.currentTarget);if(l.length===0)return;u.create(ft,{parent:this,menuItems:l,location:{x:n.pageX,y:n.pageY},$anchor:h}).open()}.bind(this);this.session.onRequestsDone(s,e,t)}_onGridScroll(e){this._reconcileScrollPos()}_reconcileScrollPos(){let e=this.$grid.scrollLeft();this.$scale.scrollLeft(e)}_renderRange(){if(!this.viewRange.from||!this.viewRange.to)return;let e,t=new Date(this.viewRange.to.valueOf()-1),s=this.session.text("ui.to"),r=ae.DisplayMode;w.isSameDay(this.viewRange.from,t)?e=this._dateFormat(this.viewRange.from,"d. MMMM yyyy"):this.viewRange.from.getMonth()===t.getMonth()&&this.viewRange.from.getFullYear()===t.getFullYear()?e=y.join(" ",this._dateFormat(this.viewRange.from,"d."),s,this._dateFormat(t,"d. MMMM yyyy")):this.viewRange.from.getFullYear()===t.getFullYear()?this.displayMode===r.YEAR?e=y.join(" ",this._dateFormat(this.viewRange.from,"MMMM"),s,this._dateFormat(t,"MMMM yyyy")):e=y.join(" ",this._dateFormat(this.viewRange.from,"d.  MMMM"),s,this._dateFormat(t,"d. MMMM yyyy")):this.displayMode===r.YEAR?e=y.join(" ",this._dateFormat(this.viewRange.from,"MMMM yyyy"),s,this._dateFormat(t,"MMMM yyyy")):e=y.join(" ",this._dateFormat(this.viewRange.from,"d.  MMMM yyyy"),s,this._dateFormat(t,"d. MMMM yyyy")),a()(".planner-select",this.header.$range).text(e)}_renderScale(){if(!this.viewRange.from||!this.viewRange.to)return;let e=this,t=ae.DisplayMode;this.$scale.empty(),this.$grid.children(".planner-small-scale-item-line").remove(),this.$grid.children(".planner-large-scale-item-line").remove(),this.$scaleTitle=this.$scale.appendDiv("planner-scale-title"),this._renderLabel(),this.$timeline=this.$scale.appendDiv("timeline"),this.$timelineLarge=this.$timeline.appendDiv("timeline-large"),this.$timelineSmall=this.$timeline.appendDiv("timeline-small"),this.displayMode===t.DAY?this._renderDayScale():u.isOneOf(this.displayMode,t.WORK_WEEK,t.WEEK)?this._renderWeekScale():this.displayMode===t.MONTH?this._renderMonthScale():this.displayMode===t.CALENDAR_WEEK?this._renderCalendarWeekScale():this.displayMode===t.YEAR&&this._renderYearScale();let s=this.$timelineSmall.children(".scale-item"),r=this.$timelineLarge.children(".scale-item"),n=100/s.length;r.each(function(){let h=a()(this),d=e.$grid.prependDiv("planner-large-scale-item-line");h.css("width",h.data("count")*n+"%").data("scale-item-line",d),h.prependDiv("planner-large-scale-item-line").css("left",0)}),s.each(function(h){let d=a()(this);if(d.css("width",n+"%"),!d.data("first")){let c=e.$grid.prependDiv("planner-small-scale-item-line");d.data("scale-item-line",c),d.prependDiv("planner-small-scale-item-line").css("left",0)}});let o=this.$timelineSmall.children().first().data("date-from");this.beginScale=o.valueOf();let l=this.$timelineSmall.children().last().data("date-to");if(this.endScale=l.valueOf(),u.isOneOf(this.displayMode,t.WORK_WEEK,t.WEEK)){let h=this.displayModeOptions[this.displayMode],d=h.interval,c=h.firstHourOfDay,f=h.lastHourOfDay;this.transformLeft=((m,_,C,S,R)=>L=>{let H=new Date(L);m=new Date(m),_=new Date(_);let we=_.valueOf()-m.valueOf(),rt=w.compareDays(H,m),Ze=w.compareDays(_,m),di=rt*36e5*24,zt=24/(S-C+1),ui=rt/Ze;return H.getHours()<C?(zt/we+ui)*100:H.getHours()>S?(ui=(rt+1)/Ze,(zt/we+ui)*100):((H.valueOf()-(m.valueOf()+C*36e5)-di)*zt/we+ui)*100})(this.viewRange.from,this.viewRange.to,c,f,d),this.transformWidth=((m,_,C,S,R)=>function(L,H){let we=_.valueOf()-m.valueOf(),rt=new B(L,H),Ze=this._findHiddenRangesInWeekMode(),di=rt.subtractAll(Ze).reduce((ui,Io)=>ui+Io.size(),0),zt=24/(S-C+1);return di*zt/we*100})(this.viewRange.from,this.viewRange.to,c,f,d)}else this.transformLeft=((h,d)=>c=>(c-h)/(d-h)*100)(this.beginScale,this.endScale),this.transformWidth=((h,d)=>(c,f)=>(f-c)/(d-h)*100)(this.beginScale,this.endScale)}_findHiddenRangesInWeekMode(){if(!u.isOneOf(this.displayMode,ae.DisplayMode.WORK_WEEK,ae.DisplayMode.WEEK))return[];let e=[],t=this.displayModeOptions[this.displayMode],s=t.firstHourOfDay,r=t.lastHourOfDay,n=new Date(this.viewRange.from.valueOf());for(;n<this.viewRange.to;){let o=new B(new Date(n.valueOf()).valueOf(),w.shiftTime(n,s).valueOf());o.size()>0&&e.push(o),o=new B(w.shiftTime(n,r+1).valueOf(),w.shiftTime(n,24).valueOf()),o.size()>0&&e.push(o),n.setHours(0),n.setMinutes(0),n.setDate(n.getDate()+1)}return e}_renderDayScale(){let e,t,s,r=!0,n=new Date(this.viewRange.from.valueOf()),o=this.displayModeOptions[this.displayMode],l=o.interval,h=o.labelPeriod,d=o.firstHourOfDay,c=o.lastHourOfDay;for(l=Math.min(l,60*(c-d+1));n<this.viewRange.to;)n.getHours()>=d&&n.getHours()<=c?(e=!1,(n.getMinutes()===0||r)&&(t=this.$timelineLarge.appendDiv("scale-item",this._dateFormat(n,"HH")).data("count",0),e=!0),s=this.$timelineSmall.appendDiv("scale-item",this._dateFormat(n,":mm")).data("date-from",new Date(n.valueOf())),n.getMinutes()%(l*h)!==0&&s.addClass("label-invisible"),n=w.shiftTime(n,0,l,0),this._incrementTimelineScaleItems(t,s,n,e),r=!1):n=w.shiftTime(n,0,l,0)}_renderWeekScale(){let e,t,s,r=!0,n=new Date(this.viewRange.from.valueOf()),o=this.displayModeOptions[this.displayMode],l=o.interval,h=o.labelPeriod,d=o.firstHourOfDay,c=o.lastHourOfDay;for(l=Math.min(l,60*(c-d+1));n<this.viewRange.to;)e=!1,n.getHours()<d&&n.setHours(d),(n.getHours()===d&&n.getMinutes()===0||r)&&(n.getMonth()===0||r?t=this.$timelineLarge.appendDiv("scale-item",this._dateFormat(n,"d. MMMM yyyy")).data("count",0):n.getDate()===1?t=this.$timelineLarge.appendDiv("scale-item",this._dateFormat(n,"d. MMMM")).data("count",0):t=this.$timelineLarge.appendDiv("scale-item",this._dateFormat(n,"d.")).data("count",0),e=!0),s=this.$timelineSmall.appendDiv("scale-item",this._dateFormat(n,"HH:mm")).data("date-from",new Date(n.valueOf())),((n.getHours()-d)*60+n.getMinutes())%(l*h)!==0&&s.addClass("label-invisible"),n=w.shiftTime(n,0,l,0,0),this._incrementTimelineScaleItems(t,s,n,e),r=!1,n.getHours()>c&&(n.setHours(0),n.setMinutes(0),n.setDate(n.getDate()+1))}_renderMonthScale(){let e,t,s,r=!0,n=new Date(this.viewRange.from.valueOf()),l=this.displayModeOptions[this.displayMode].labelPeriod;for(;n<this.viewRange.to;)e=!1,(n.getDate()===1||r)&&(n.getMonth()===0||r?t=this.$timelineLarge.appendDiv("scale-item",this._dateFormat(n,"MMMM yyyy")).data("count",0):t=this.$timelineLarge.appendDiv("scale-item",this._dateFormat(n,"MMMM")).data("count",0),e=!0),s=this.$timelineSmall.appendDiv("scale-item",this._dateFormat(n,"dd")).data("date-from",new Date(n.valueOf())),n.getDate()%l!==0&&s.addClass("label-invisible"),n=w.shift(n,0,0,1),this._incrementTimelineScaleItems(t,s,n,e),r=!1}_renderCalendarWeekScale(){let e,t,s,r=!0,n=new Date(this.viewRange.from.valueOf()),l=this.displayModeOptions[this.displayMode].labelPeriod;for(;n<this.viewRange.to;)e=!1,(n.getDate()<8||r===!0)&&(n.getMonth()===0||r===!0?n.getDate()>11?(t=this.$timelineLarge.appendDiv("scale-item").html("&nbsp;").data("count",0),r=2):(t=this.$timelineLarge.appendDiv("scale-item",this._dateFormat(n,"MMMM yyyy")).data("count",0),r=!1):r===2?(t=this.$timelineLarge.appendDiv("scale-item",this._dateFormat(n,"MMMM yyyy")).data("count",0),r=!1):t=this.$timelineLarge.appendDiv("scale-item",this._dateFormat(n,"MMMM")).data("count",0),e=!0),s=this.$timelineSmall.appendDiv("scale-item",w.weekInYear(n)+"").data("date-from",new Date(n.valueOf())).data("tooltipText",this._scaleTooltipText.bind(this)),this._tooltipSupport.install(s),w.weekInYear(n)%l!==0&&s.addClass("label-invisible"),n.setDate(n.getDate()+7),this._incrementTimelineScaleItems(t,s,n,e)}_renderYearScale(){let e,t,s,r=!0,n=new Date(this.viewRange.from.valueOf()),l=this.displayModeOptions[this.displayMode].labelPeriod;for(;n<this.viewRange.to;)e=!1,(n.getMonth()===0||r)&&(t=this.$timelineLarge.appendDiv("scale-item",this._dateFormat(n,"yyyy")).data("count",0),e=!0),s=this.$timelineSmall.appendDiv("scale-item",this._dateFormat(n,"MMMM")).data("date-from",new Date(n.valueOf())),n.getMonth()%l!==0&&s.addClass("label-invisible"),n=w.shift(n,0,1,0),this._incrementTimelineScaleItems(t,s,n,e),r=!1}_incrementTimelineScaleItems(e,t,s,r){e.data("count",e.data("count")+1),t.data("date-to",new Date(s.valueOf())).data("first",r)}_scaleTooltipText(e){let t=" "+this.session.text("ui.to")+" ",s=new Date(e.data("date-from").valueOf()),r=new Date(e.data("date-to").valueOf()-1);return s.getMonth()===r.getMonth()?this._dateFormat(s,"d.")+t+this._dateFormat(r,"d. MMMM yyyy"):s.getFullYear()===r.getFullYear()?this._dateFormat(s,"d. MMMM")+t+this._dateFormat(r,"d. MMMM yyyy"):this._dateFormat(s,"d. MMMM yyyy")+t+this._dateFormat(r,"d. MMMM yyyy")}_removeAllResources(){this.resources.forEach(e=>e.$resource.remove())}_renderResources(e){let t,s="";e=e||this.resources;for(let r=0;r<e.length;r++)t=e[r],s+=this._buildResourceHtml(t);a()(s).appendTo(this.$grid),this.$grid.children(".planner-resource").each((r,n)=>{let o=a()(n);t=this.resourceById(o.attr("data-id")),this._linkResource(o,t),this._linkActivitiesForResource(t)})}_linkResource(e,t){e.data("resource",t),t.$resource=e,t.$cells=e.children(".resource-cells")}_linkActivity(e,t){e.data("activity",t),t.$activity=e}_rerenderActivities(e){e=e||this.resources,e.forEach(t=>{this._removeActivitiesForResource(t),this._renderActivitiesForResource(t)})}_buildResourceHtml(e){let t='<div class="planner-resource" data-id="'+e.id+'">';return t+='<div class="resource-title">'+y.encode(e.resourceCell.text||"")+"</div>",t+='<div class="resource-cells">'+this._buildActivitiesHtml(e)+"</div>",t+="</div>",t}_renderActivitiesForResource(e){e.$cells.html(this._buildActivitiesHtml(e)),this._linkActivitiesForResource(e)}_linkActivitiesForResource(e){e.$cells.children(".planner-activity").each((t,s)=>{let r=a()(s),n=this.activityById(r.attr("data-id"));this._linkActivity(r,n)})}_buildActivitiesHtml(e){let t="";return e.activities.forEach(s=>{s.beginTime.valueOf()>=this.endScale||s.endTime.valueOf()<=this.beginScale||(t+=this._buildActivityHtml(s))}),t}_removeActivitiesForResource(e){e.activities.forEach(t=>{t.$activity&&(t.$activity.remove(),t.$activity=null)})}_buildActivityHtml(e){let t=100-Math.min(e.level*100,100),s=M.modelToCssColor(e.backgroundColor),r=M.modelToCssColor(e.foregroundColor),n=M.modelToCssColor(e.levelColor),o=e.beginTime,l=e.endTime,h=o.valueOf(),d=l.valueOf();h=Math.max(h,this.beginScale),d=Math.min(d,this.endScale);let c="planner-activity"+(e.cssClass?" "+e.cssClass:""),f="left: calc("+this.transformLeft(h)+"% + 2px);";f+=" width: calc("+this.transformWidth(h,d)+"% - 4px);",n&&(f+=" background-color: "+n+";",f+=" border-color: "+n+";"),!n&&s&&(f+=" background-color: "+s+";",f+=" border-color: "+s+";"),r&&(f+=" color: "+r+";");let m="planner-activity-level"+(e.cssClass?" "+e.cssClass:""),_=M.get(m,"background-color").backgroundColor;f+=" background-image: linear-gradient(to bottom, "+_+" 0%, "+_+" "+t+"%, transparent "+t+"%, transparent 100% );";let C="<div";return C+=' class="'+c+'"',C+=' style="'+f+'"',C+=' data-id="'+e.id+'"',C+=">"+y.encode(e.text||"")+"</div>",C}_onCellMouseDown(e){let t,s,r=a()(e.target),n=ae.SelectionMode,o=e.which===3||e.which===1&&e.ctrlKey;this.activitySelectable?(!o&&this.$selector&&this.$selector.hide(),t=this.$grid.elementFromPoint(e.pageX,e.pageY),!o&&this.$selector&&this.$selector.show(),t.hasClass("planner-activity")?(s=t.parent().parent(),this.selectResources([s.data("resource")]),this.selectActivity(t.data("activity")),this.selectRange(new Ve)):this.selectActivity(null)):this.selectActivity(null),this.selectionMode!==n.NONE&&(r.hasClass("selector")&&o||(this.selectedActivity||this._startRangeSelection(e.pageX,e.pageY),this._cellMousemoveHandler=this._onCellMousemove.bind(this,e),r.document().on("mousemove",this._cellMousemoveHandler).one("mouseup",this._onDocumentMouseUp.bind(this))))}_startRangeSelection(e,t){this.startRow=this._findRow(t),this.lastRow=this.startRow,this.startRange=this._findScale(e),this.lastRange=this.startRange,this._select(),this._rangeSelectionStarted=!0}_prepareRangeSelectionByMousemove(e,t){let s=e.pageX-t.pageX,r=e.pageY-t.pageY,n=ae.RANGE_SELECTION_MOVE_THRESHOLD;if(Math.abs(s)>=n)return!0;let o=this._findRow(e.pageY),l=this._findRow(t.pageY);return Math.abs(r)>=n&&this.selectionMode===ae.SelectionMode.MULTI_RANGE&&o!==l}_onCellMousemove(e,t){if(this.selectedActivity&&!this._rangeSelectionStarted){if(!this._prepareRangeSelectionByMousemove(e,t))return;this._startRangeSelection(e.pageX,e.pageY)}let s=this._findRow(t.pageY);s&&(this.lastRow=s);let r=this._findScale(t.pageX);r&&(this.lastRange=r),this._select()}_onResizeMouseDown(e){let t,s=a()(e.target);return this.startRow=this.selectedResources[0],this.lastRow=this.selectedResources[this.selectedResources.length-1],this.startRange=u.nvl(this._findScaleByFromDate(this.selectionRange.from),new B(this.selectionRange.from.getTime(),this.selectionRange.from.getTime())),this.lastRange=u.nvl(this._findScaleByToDate(this.selectionRange.to),new B(this.selectionRange.to.getTime(),this.selectionRange.to.getTime())),s.hasClass("selector-resize-left")&&(t=this.startRange,this.startRange=this.lastRange,this.lastRange=t),s.body().addClass("col-resize"),this._resizeMousemoveHandler=this._onResizeMousemove.bind(this),s.document().on("mousemove",this._resizeMousemoveHandler).one("mouseup",this._onDocumentMouseUp.bind(this)),!1}_onResizeMousemove(e){if(!this.rendered)return;let t=this._findScale(e.pageX);t&&(this.lastRange=t),this._select()}_onDocumentMouseUp(e){let t=a()(e.target);t.body().removeClass("col-resize"),this._cellMousemoveHandler&&(t.document().off("mousemove",this._cellMousemoveHandler),this._cellMousemoveHandler=null),this._resizeMousemoveHandler&&(t.document().off("mousemove",this._resizeMousemoveHandler),this._resizeMousemoveHandler=null),this._rangeSelectionStarted&&(this._rangeSelectionStarted=!1,this.rendered&&this._select())}_select(){if(!this.startRow||!this.lastRow)return;let e=!!(this.startRange&&this.lastRange),t=this.startRow.$resource,s=this.lastRow.$resource;this.selectionMode===ae.SelectionMode.SINGLE_RANGE&&(this.lastRow=this.startRow,s=this.startRow.$resource);let r=t[0].offsetTop<=s[0].offsetTop?t:s,n=t[0].offsetTop>s[0].offsetTop?t:s,o=a()(".planner-resource",this.$grid).toArray(),l=r[0].offsetTop,h=n[0].offsetTop;for(let d=o.length-1;d>=0;d--){let c=o[d];(c.offsetTop<l&&c.offsetTop<h||c.offsetTop>l&&c.offsetTop>h)&&o.splice(d,1)}if(this.selectResources(o.map(d=>a()(d).data("resource"))),this.selectActivity(null),e){let d=Math.min(this.lastRange.from.valueOf(),this.startRange.from.valueOf()),c=Math.max(this.lastRange.to.valueOf(),this.startRange.to.valueOf()),f=new Ve(new Date(d),new Date(c));f=this._adjustSelectionRange(f),this.selectRange(f)}}_adjustSelectionRange(e){let t=e.from.getTime(),s=e.to.getTime(),r=0,n=this.displayModeOptions[this.displayMode];n.interval>0&&n.minSelectionIntervalCount>0&&(r=n.minSelectionIntervalCount*n.interval*6e4);let o=n.lastHourOfDay,l=w.shiftTime(w.trunc(e.from),o+1),h=this._visibleViewRange();return this.lastRange.from<this.startRange.from?s-r>=h.from.getTime()?t=Math.min(t,s-r):(t=h.from.getTime(),s=Math.max(s,Math.min(t+r,h.to.getTime()))):t+r<=h.to.getTime()?(s=Math.max(s,Math.max(t+r,h.from.getTime())),s>=l.getTime()&&new B(t,s).size()===r&&(s=l.getTime(),t=Math.min(t,s-r))):(s=h.to.getTime(),t=Math.min(t,s-r)),new Ve(new Date(t),new Date(s))}_findRow(e){let t,s=v.offsetBounds(this.$grid),r=s.x+10;return e=Math.min(Math.max(e,0),s.y+s.height-1),t=this.$container.elementFromPoint(r,e,".planner-resource"),t.length>0?t.data("resource"):null}_findScale(e){let t,s=v.offsetBounds(this.$grid),r=this.$scale.offset().top+this.$scale.height()*.75;return e=Math.min(Math.max(e,0),s.x+s.width-1),t=this.$container.elementFromPoint(e,r,".scale-item"),t.length>0?new Ve(t.data("date-from").valueOf(),t.data("date-to").valueOf()):null}_findScaleByFromDate(e){return this._findScaleByFunction((t,s)=>{if(a()(s).data("date-from").getTime()===e.getTime())return!0})}_findScaleByToDate(e){return this._findScaleByFunction((t,s)=>{if(a()(s).data("date-to").getTime()===e.getTime())return!0})}_findScaleByFunction(e){let t=this.$timelineSmall.children(".scale-item").filter(e);return t.length?new Ve(t.data("date-from").valueOf(),t.data("date-to").valueOf()):null}_visibleViewRange(){let e=this.$timelineSmall.children(".scale-item");return new Ve(e.first().data("date-from"),e.last().data("date-to"))}_dateFormat(e,t){let s=new Date(e.valueOf());return new xt(this.session.locale,t).format(s)}_renderViewRange(){this._renderRange(),this._renderScale(),this.invalidateLayoutTree()}_renderHeaderVisible(){this.header.setVisible(this.headerVisible),this.invalidateLayoutTree()}_renderYearPanelVisible(e){let t;this.yearPanelVisible&&this.yearPanel.renderContent(),a()(".calendar-toggle-year",this.$modes).select(this.yearPanelVisible),this.yearPanelVisible?t=210:t=0,this.yearPanel.$container.animate({width:t},{duration:e?500:0,progress:this._onYearPanelWidthChange.bind(this),complete:this._afterYearPanelWidthChange.bind(this)})}_onYearPanelWidthChange(){if(!this.yearPanel.$container)return;let e=this.yearPanel.$container.outerWidth();this.$grid.css("width","calc(100% - "+e+"px)"),this.$scale.css("width","calc(100% - "+e+"px)"),this.revalidateLayout()}_afterYearPanelWidthChange(){this.yearPanelVisible||this.yearPanel.removeContent()}_setMenus(e){this.updateKeyStrokes(e,this.menus),this._setProperty("menus",e),this._updateMenuBar()}_updateMenuBar(){let e=this._filterMenus([ae.MenuTypes.EmptySpace,ae.MenuTypes.Resource,ae.MenuTypes.Activity,ae.MenuTypes.Range],!1,!0);this.menuBar.setMenuItems(e)}_filterMenus(e,t,s){return e=e||[],e.indexOf(ae.MenuTypes.Resource)>-1&&this.selectedResources.length===0&&p.remove(e,ae.MenuTypes.Resource),e.indexOf(ae.MenuTypes.Activity)>-1&&!this.selectedActivity&&p.remove(e,ae.MenuTypes.Activity),e.indexOf(ae.MenuTypes.Range)>-1&&!this.selectionRange.from&&!this.selectionRange.to&&p.remove(e,ae.MenuTypes.Range),We.filter(this.menus,e,{onlyVisible:t,enableDisableKeyStrokes:s})}setDisplayModeOptions(e){this.setProperty("displayModeOptions",e)}_setDisplayModeOptions(e){e&&this._adjustHours(e),this.displayModeOptions=e}_adjustHours(e){b.values(e).forEach(s=>{s.firstHourOfDay&&(s.firstHourOfDay=t(s.firstHourOfDay)),s.lastHourOfDay&&(s.lastHourOfDay=t(s.lastHourOfDay))});function t(s){return s<0?0:s>23?23:s}}_renderDisplayModeOptions(){this._renderRange(),this._renderScale(),this._rerenderActivities(),this._select(),this.invalidateLayoutTree()}_renderAvailableDisplayModes(){}_renderDisplayMode(){}_setViewRange(e){e=Ve.ensure(e),this._setProperty("viewRange",e),this.yearPanel.setViewRange(this.viewRange),this.yearPanel.selectDate(this.viewRange.from)}_setDisplayMode(e){this._setProperty("displayMode",e),this.yearPanel.setDisplayMode(this.displayMode),this.header.setDisplayMode(this.displayMode)}_setAvailableDisplayModes(e){this._setProperty("availableDisplayModes",e),this.header.setAvailableDisplayModes(this.availableDisplayModes)}_setSelectionRange(e){e=Ve.ensure(e),this._setProperty("selectionRange",e),this.session.onRequestsDone(this._updateMenuBar.bind(this))}_setSelectedResources(e){typeof e[0]=="string"&&(e=this.resourcesByIds(e)),this.rendered&&this._removeSelectedResources(),this._setProperty("selectedResources",e),this.session.onRequestsDone(this._updateMenuBar.bind(this))}_removeSelectedResources(){this.selectedResources.forEach(e=>e.$resource.select(!1))}_renderSelectedResources(){this.selectedResources.forEach(e=>e.$resource.select(!0))}_renderActivitySelectable(){this.selectedActivity&&this.selectedActivity.$activity&&this.selectedActivity.$activity.toggleClass("selected",this.activitySelectable)}_renderSelectionMode(){this.selectionMode===ae.SelectionMode.NONE?this.$selector&&(this.$selector.remove(),this.$highlight.remove()):this._renderSelectionRange()}_renderSelectionRange(){let e=this.selectionRange.from,t=this.selectionRange.to,s=this.selectedResources[0],r=this.selectedResources[this.selectedResources.length-1];if(this.$selector&&(this.$selector.remove(),this.$highlight.remove()),!s||!r||!this.selectionRange.from||!this.selectionRange.to)return;let n=s.$resource,o=r.$resource,l=Math.max(e.valueOf(),this.beginScale),h=Math.min(t.valueOf(),this.endScale),d=n[0].offsetTop<=o[0].offsetTop?n:o;this.$selector=d.children(".resource-cells").appendDiv("selector"),this.$selector.cssHeight(n.outerHeight()+Math.abs(o[0].offsetTop-n[0].offsetTop));let c=this.$selector.appendDiv("selector-resize-left").on("mousedown",this._onResizeMouseDown.bind(this)),f=this.$selector.appendDiv("selector-resize-right").on("mousedown",this._onResizeMouseDown.bind(this));this.$selector.css("left","calc("+this.transformLeft(l)+"% - "+c.cssWidth()+"px)").css("width","calc("+this.transformWidth(l,h)+"% + "+(c.cssWidth()+f.cssWidth())+"px)").on("contextmenu",this._onRangeSelectorContextMenu.bind(this)),this.$highlight=this.$timelineSmall.prependDiv("highlight");let m=this.$selector.cssLeft()+c.cssWidth()+this.$scaleTitle.cssWidth(),_=this.$selector.cssWidth()-(c.cssWidth()+f.cssWidth());this.$highlight.cssLeft(m).cssWidth(_)}_setSelectedActivity(e){typeof e=="string"&&(e=this.activityById(e)),this.rendered&&this._removeSelectedActivity(),this._setProperty("selectedActivity",e),this.session.onRequestsDone(this._updateMenuBar.bind(this))}_removeSelectedActivity(){this.selectedActivity&&this.selectedActivity.$activity&&this.selectedActivity.$activity.removeClass("selected")}_renderSelectedActivity(){this.selectedActivity&&this.selectedActivity.$activity&&this.selectedActivity.$activity.addClass("selected")}_renderLabel(){let e=this.label||"";this.$scaleTitle&&this.$scaleTitle.text(e)}resourcesByIds(e){return e.map(this.resourceById.bind(this))}activityById(e){return this.activityMap[e]}resourceById(e){return this.resourceMap[e]}setDisplayMode(e){this.setProperty("displayMode",e),this.startRange=null,this.lastRange=null}layoutYearPanel(){this.yearPanelVisible&&(P.update(this.yearPanel.$yearList),this.yearPanel._scrollYear())}setYearPanelVisible(e){this.yearPanelVisible!==e&&(this._setProperty("yearPanelVisible",e),this.rendered&&this._renderYearPanelVisible(!0))}setViewRangeFrom(e){let t=w.compareDays(this.viewRange.to,this.viewRange.from),s=new Ve(this.viewRange.from,this.viewRange.to);s.from=e,s.to=w.shift(e,0,0,t),this.setViewRange(s)}setViewRange(e){this.viewRange!==e&&(this._setViewRange(e),this.rendered&&(this._renderViewRange(),this._rerenderActivities(),this._renderSelectedActivity(),this.validateLayoutTree(),this._reconcileScrollPos()))}selectRange(e){e&&e.equals(this.selectionRange)||this.setProperty("selectionRange",e)}selectActivity(e){this.setProperty("selectedActivity",e)}selectResources(e){let t=p.ensure(e);p.equals(t,this.selectedResources)||(t=t.slice(),this.setProperty("selectedResources",t),this.trigger("resourcesSelected",{resources:t}),this.rendered&&this._renderSelectionRange())}deselectResources(e){let t=!1;e=p.ensure(e);let s=this.selectedResources.slice();return p.removeAll(s,e)&&(this.selectResources(s),t=!0),t}insertResources(e){e.forEach(t=>{this._initResource(t),this.resources.push(t)}),this.rendered&&(this._renderResources(e),this.invalidateLayoutTree())}deleteResources(e){this.deselectResources(e)&&this.selectRange(new Ve),e.forEach(t=>{p.remove(this.resources,t),delete this.resourceMap[t.id],t.activities.forEach(s=>delete this.activityMap[s.id]),this.rendered&&(t.$resource.remove(),delete t.$resource)}),this.invalidateLayoutTree()}deleteAllResources(){this.rendered&&(this._removeAllResources(),this.invalidateLayoutTree()),this.resources=[],this.resourceMap={},this.activityMap={},this.selectResources([]),this.selectRange(new Ve)}updateResources(e){e.forEach(t=>{let s=this.resourceMap[t.id];if(!s)throw new Error("Update event received for non existing resource. ResourceId: "+t.id);if(this._initResource(t),p.replace(this.resources,s,t),p.replace(this.selectedResources,s,t),this.rendered&&s.$resource){let r=a()(this._buildResourceHtml(t));s.$resource.replaceWith(r),r.css("min-width",s.$resource.css("min-width")),this._linkResource(r,t),this._linkActivitiesForResource(t)}})}}J(ae,"Direction",{BACKWARD:-1,FORWARD:1}),J(ae,"DisplayMode",{DAY:1,WEEK:2,MONTH:3,WORK_WEEK:4,CALENDAR_WEEK:5,YEAR:6}),J(ae,"SelectionMode",{NONE:0,SINGLE_RANGE:1,MULTI_RANGE:2}),J(ae,"RANGE_SELECTION_MOVE_THRESHOLD",10),J(ae,"MenuTypes",{Activity:"Planner.Activity",EmptySpace:"Planner.EmptySpace",Range:"Planner.Range",Resource:"Planner.Resource"});function QS(i,e,t){return e=ZS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ZS(i){var e=eP(i,"string");return typeof e=="symbol"?e:String(e)}function eP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Tr extends ke{constructor(){super(),this._addRemoteProperties(["displayMode","viewRange","selectionRange","selectedActivity"])}_orderPropertyNamesOnSync(e){return Object.keys(e).sort(this._createPropertySortFunc(Tr.PROPERTIES_ORDER))}_sendViewRange(e){this._send("property",{viewRange:w.toJsonDateRange(e)})}_sendSelectedActivity(){let e=null;this.widget.selectedActivity&&(e=this.widget.selectedActivity.id),this._send("property",{selectedActivity:e})}_sendSelectionRange(){let e=w.toJsonDateRange(this.widget.selectionRange);this._send("property",{selectionRange:e})}_onWidgetResourcesSelected(e){this._sendResourcesSelected()}_sendResourcesSelected(){let e=this.widget.selectedResources.map(t=>t.id);this._send("resourcesSelected",{resourceIds:e})}_onWidgetEvent(e){e.type==="resourcesSelected"?this._onWidgetResourcesSelected(e):super._onWidgetEvent(e)}_onResourcesInserted(e){this.widget.insertResources(e)}_onResourcesDeleted(e){let t=this.widget.resourcesByIds(e);this.addFilterForWidgetEventType("resourcesSelected"),this.addFilterForProperties({selectionRange:new Ve}),this.widget.deleteResources(t)}_onAllResourcesDeleted(){this.addFilterForWidgetEventType("resourcesSelected"),this.addFilterForProperties({selectionRange:new Ve}),this.widget.deleteAllResources()}_onResourcesSelected(e){let t=this.widget.resourcesByIds(e);this.addFilterForWidgetEventType("resourcesSelected"),this.widget.selectResources(t)}_onResourcesUpdated(e){this.widget.updateResources(e)}onModelAction(e){e.type==="resourcesInserted"?this._onResourcesInserted(e.resources):e.type==="resourcesDeleted"?this._onResourcesDeleted(e.resourceIds):e.type==="allResourcesDeleted"?this._onAllResourcesDeleted():e.type==="resourcesSelected"?this._onResourcesSelected(e.resourceIds):e.type==="resourcesUpdated"?this._onResourcesUpdated(e.resources):super.onModelAction(e)}static _initResourceRemote(e){return this.modelAdapter&&Ne.applyTo(e,"Resource"),this._initResourceOrig(e)}static _initActivityRemote(e){return this.modelAdapter&&Ne.applyTo(e,"Activity"),this._initActivityOrig(e)}static modifyPlannerPrototype(){!te.get().remote||(b.replacePrototypeFunction(ae,"_initResource",Tr._initResourceRemote,!0),b.replacePrototypeFunction(ae,"_initActivity",Tr._initActivityRemote,!0))}}QS(Tr,"PROPERTIES_ORDER",["displayMode","viewRange"]),te.addListener("bootstrap",Tr.modifyPlannerPrototype);function Ca(i,e,t){return e=tP(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function tP(i){var e=iP(i,"string");return typeof e=="symbol"?e:String(e)}function iP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ru extends I{constructor(){super(),Ca(this,"$range",void 0),Ca(this,"$commands",void 0),Ca(this,"availableDisplayModes",void 0),Ca(this,"displayMode",void 0),this.availableDisplayModes=[]}_render(){this.$container=this.$parent.appendDiv("planner-header"),this.$range=this.$container.appendDiv("planner-range"),this.$range.appendDiv("planner-previous").on("click",this._onPreviousClick.bind(this)),this.$range.appendDiv("planner-today",this.session.text("ui.CalendarToday")).on("click",this._onTodayClick.bind(this)),this.$range.appendDiv("planner-next").on("click",this._onNextClick.bind(this)),this.$range.appendDiv("planner-select"),this.$commands=this.$container.appendDiv("planner-commands"),this._renderAvailableDisplayModes(),this._renderDisplayMode()}setAvailableDisplayModes(e){this.setProperty("availableDisplayModes",e)}_renderAvailableDisplayModes(){let e=ae.DisplayMode;this.$commands.empty(),this.availableDisplayModes.length>1&&(this.availableDisplayModes.indexOf(e.DAY)>-1&&this.$commands.appendDiv("planner-mode",this.session.text("ui.CalendarDay")).attr("data-mode",e.DAY).on("click",this._onDisplayModeClick.bind(this)),this.availableDisplayModes.indexOf(e.WORK_WEEK)>-1&&this.$commands.appendDiv("planner-mode",this.session.text("ui.CalendarWorkWeek")).attr("data-mode",e.WORK_WEEK).on("click",this._onDisplayModeClick.bind(this)),this.availableDisplayModes.indexOf(e.WEEK)>-1&&this.$commands.appendDiv("planner-mode",this.session.text("ui.CalendarWeek")).attr("data-mode",e.WEEK).on("click",this._onDisplayModeClick.bind(this)),this.availableDisplayModes.indexOf(e.MONTH)>-1&&this.$commands.appendDiv("planner-mode",this.session.text("ui.CalendarMonth")).attr("data-mode",e.MONTH).on("click",this._onDisplayModeClick.bind(this)),this.availableDisplayModes.indexOf(e.CALENDAR_WEEK)>-1&&this.$commands.appendDiv("planner-mode",this.session.text("ui.CalendarCalendarWeek")).attr("data-mode",e.CALENDAR_WEEK).on("click",this._onDisplayModeClick.bind(this)),this.availableDisplayModes.indexOf(e.YEAR)>-1&&this.$commands.appendDiv("planner-mode",this.session.text("ui.CalendarYear")).attr("data-mode",e.YEAR).on("click",this._onDisplayModeClick.bind(this)));let t=this.$commands.children(".planner-mode");t.first().addClass("first"),t.last().addClass("last"),t.length===1&&(t.first().addClass("disabled"),t.off("click")),this.$commands.appendDiv("planner-toggle-year").on("click",this._onYearClick.bind(this))}setDisplayMode(e){this.setProperty("displayMode",e)}_renderDisplayMode(){a()(".planner-mode",this.$commands).select(!1),a()('[data-mode="'+this.displayMode+'"]',this.$commands).select(!0)}_onTodayClick(e){this.trigger("todayClick")}_onNextClick(e){this.trigger("nextClick")}_onPreviousClick(e){this.trigger("previousClick")}_onYearClick(e){this.trigger("yearClick")}_onDisplayModeClick(e){let t=a()(e.target).data("mode");this.setDisplayMode(t),this.trigger("displayModeClick",{displayMode:this.displayMode})}}function sP(i,e,t){return e=rP(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function rP(i){var e=nP(i,"string");return typeof e=="symbol"?e:String(e)}function nP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class nu extends ee{constructor(e){super(),sP(this,"planner",void 0),this.planner=e}layout(e){let t,s=this.planner.header.$container,r=this.planner.$scale,n=this.planner.$grid,o=this.planner.menuBar,l=this.planner.yearPanel.$container,h=0,d=0,c=0,f=0,m=0,_=T.get(o.$container),C=this.planner.htmlComp,S=C.availableSize().subtract(C.insets());o.$container.isVisible()&&(t=er.size(_,S),_.setSize(t),h=t.height,o.position==="top"&&(m+=h)),s.isVisible()&&(m+=v.size(s).height),r.css("top",m),f+=m+v.size(r).height,n.css("top",f),c=m+l.cssMarginY(),d=f+n.cssMarginY(),o.$container.isVisible()&&o.position==="bottom"&&(c+=h,d+=h),l.css("height","calc(100% - "+c+"px)"),n.css("height","calc(100% - "+d+"px)"),this._updateMinWidth(),this._layoutScaleLines(),P.update(this.planner.$grid,!0),this.planner.layoutYearPanel()}_updateMinWidth(){let e=this._minWidth(),t=this.planner.$scaleTitle,s=this.planner.$timeline;!s||(s.css("min-width",e),e+=t.outerWidth(!0),this.planner.resources.forEach(r=>r.$resource.css("min-width",e)))}_layoutScaleLines(){let e,t,s,r,n=this.planner.$timelineSmall,o=this.planner.$timelineLarge;!n||(t=n.children(".scale-item"),s=o.children(".scale-item"),s.each(function(){a()(this).data("scale-item-line").cssHeight(0)}),t.each(function(){let l=a()(this).data("scale-item-line");l&&l.cssHeight(0)}),P.reset(this.planner.$grid),e=this.planner.$grid[0].scrollHeight,r=this.planner.$scale[0].scrollLeft,s.each(function(){let l=a()(this);l.data("scale-item-line").cssLeft(r+l.position().left).cssHeight(e)}),t.each(function(){let l=a()(this),h=l.data("scale-item-line");h&&h.cssLeft(r+l.position().left).cssHeight(e)}))}_minWidth(){let e=this.planner.$timelineLarge.children(".scale-item"),t=this.planner.$timelineSmall.children(".scale-item"),s=e.length,r=t.length,n=ae.DisplayMode,o=v.insets(t,{includeBorder:!1}),l=r*o.horizontal();if(this.planner.displayMode===n.DAY)return Math.max(l,s*52);if(u.isOneOf(this.planner.displayMode,n.WORK_WEEK,n.WEEK))return Math.max(l,s*160);if(this.planner.displayMode===n.MONTH||this.planner.displayMode===n.CALENDAR_WEEK)return Math.max(l,r*23);if(this.planner.displayMode===n.YEAR)return Math.max(l,r*90)}}class ou extends io{constructor(e,t){super(e,t),this.selectionTypes=["Resource","Activity","Range"]}}function gi(i,e,t){return e=oP(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function oP(i){var e=lP(i,"string");return typeof e=="symbol"?e:String(e)}function lP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Km extends I{constructor(){super(),gi(this,"maximumUploadSize",void 0),gi(this,"acceptTypes",void 0),gi(this,"multiSelect",void 0),gi(this,"displayParent",void 0),gi(this,"files",void 0),gi(this,"boxButtons",void 0),gi(this,"uploadButton",void 0),gi(this,"cancelButton",void 0),gi(this,"fileInput",void 0),gi(this,"$content",void 0),gi(this,"$title",void 0),gi(this,"$files",void 0),gi(this,"dragAndDropHandler",void 0),gi(this,"_glassPaneRenderer",void 0),this.displayParent=null,this.files=[],this._glassPaneRenderer=null,this.maximumUploadSize=_i.DEFAULT_MAXIMUM_UPLOAD_SIZE,this.boxButtons=null,this.uploadButton=null,this.cancelButton=null,this.inheritAccessibility=!1,this._addWidgetProperties(["boxButtons","uploadButton","cancelButton"])}_init(e){super._init(e),this._setDisplayParent(this.displayParent),this._glassPaneRenderer=new Zr(this),this.fileInput=u.create(_i,{parent:this,acceptTypes:this.acceptTypes,maximumUploadSize:this.maximumUploadSize,multiSelect:this.multiSelect,visible:!x.get().supportsFile()}),this.fileInput.on("change",this._onFileChange.bind(this)),this.boxButtons=u.create(Xo,{parent:this}),this.boxButtons.addButton({text:this.session.text("ui.Browse")}).on("action",s=>this._onAddFileButtonClicked(s)),this.uploadButton=this.boxButtons.addButton({text:this.session.text("ui.Upload"),enabled:!1}),this.uploadButton.on("action",s=>this._onUploadButtonClicked(s)),this.cancelButton=this.boxButtons.addButton({text:this.session.text("Cancel")}),this.cancelButton.on("action",s=>this._onCancelButtonClicked(s))}_createKeyStrokeContext(){return new Oe}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.registerKeyStrokes([new sa(this.session,this),new jo(this,[g.SPACE,g.ENTER]),new Xn(this,()=>this.cancelButton?this.cancelButton.$container:null)])}_render(){this.$container=this.$parent.appendDiv("file-chooser").on("mousedown",this._onMouseDown.bind(this));let e=this.$container.appendDiv("drag-handle");this.$container.draggable(e),this.$content=this.$container.appendDiv("file-chooser-content"),this.$title=this.$content.appendDiv("file-chooser-title").text(this.session.text(this.multiSelect?"ui.ChooseFiles":"ui.ChooseFile")),this.fileInput.render(this.$content),this.$content.appendDiv("file-chooser-label").text(this.session.text("ui.FileChooserHint")),this.$files=this.$content.appendElement("<ul>","file-chooser-files"),this._installScrollbars(),this.boxButtons.render(),this.boxButtons.$container.addClass("file-chooser-buttons"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new hl(this)),this.$container.addClassForAnimation("animate-open"),this.$container.addClass("calc-helper");let t=this.$container.windowSize(),s=Math.min(this.$container.width(),t.width);this.$container.css("min-width",s),this.$container.css("max-width",s),this.$container.removeClass("calc-helper"),this._glassPaneRenderer.renderGlassPanes(),this._position()}_renderProperties(){super._renderProperties(),this._renderFiles()}_renderEnabled(){super._renderEnabled(),this._installOrUninstallDragAndDropHandler()}_postRender(){super._postRender(),this._installFocusContext()}_remove(){this._glassPaneRenderer.removeGlassPanes(),Fe.uninstallDragAndDropHandler(this),this._uninstallFocusContext(),super._remove()}_installFocusContext(){this.session.focusManager.installFocusContext(this.$container,Mt.AUTO)}_uninstallFocusContext(){this.session.focusManager.uninstallFocusContext(this.$container)}get$Scrollable(){return this.$files}_position(){this.$container.cssMarginLeft(-this.$container.outerWidth()/2)}setDisplayParent(e){this.setProperty("displayParent",e)}_setDisplayParent(e){this._setProperty("displayParent",e),e&&this.setParent(this.findDesktop().computeParentForDisplayParent(e))}setMaximumUploadSize(e){this.setProperty("maximumUploadSize",e),this.fileInput.setMaximumUploadSize(e)}open(){this.setDisplayParent(this.displayParent||this.session.desktop),this.displayParent.fileChooserController.registerAndRender(this)}close(){if(!this.rendered){this.cancel();return}this.cancelButton&&this.cancelButton.$container&&this.session.focusManager.requestFocus(this.cancelButton.$container)&&this.cancelButton.doAction()}cancel(){this.trigger("cancel").defaultPrevented||this._close()}_close(){this.displayParent&&this.displayParent.fileChooserController.unregisterAndRemove(this),this.destroy()}_installOrUninstallDragAndDropHandler(){Fe.installOrUninstallDragAndDropHandler({target:this,onDrop:e=>this.addFiles(e.files),dropMaximumSize:()=>this.maximumUploadSize,validateFiles:(e,t)=>{}})}browse(){this.fileInput.browse()}setAcceptTypes(e){this.setProperty("acceptTypes",e),this.fileInput.setAcceptTypes(e)}setMultiSelect(e){this.setProperty("multiSelect",e),this.fileInput.setMultiSelect(e)}addFiles(e){e instanceof FileList&&(e=qs.fileListToArray(e)),e=p.ensure(e),e.length!==0&&(this.multiSelect?(e=e.slice(),p.insertAll(e,this.files,0),this.setFiles(e)):this.setFiles([e[0]]))}removeFile(e){let t=this.files.slice();p.remove(t,e),this.setFiles(t),this.fileInput.clear()}setFiles(e){e instanceof FileList&&(e=qs.fileListToArray(e)),e=p.ensure(e);try{this.fileInput.validateMaximumUploadSize(e)}catch(t){rr.createOk(this).withHeader(this.session.text("ui.FileSizeLimitTitle")).withBody(t).withSeverity(E.Severity.ERROR).buildAndOpen();return}this.setProperty("files",e)}_renderFiles(){let e=this.files;this.$files.empty(),e.forEach(t=>{let s=this.$files.appendElement("<li>","file",t.name);s.append(" ");let r=s.appendSpan("remove").on("click",this.removeFile.bind(this,t)),n=s.makeElement("<a>","remove-link",this.session.text("Remove"));r.append(n)}),P.update(this.$files),this.uploadButton.setEnabled(e.length>0)}_onUploadButtonClicked(e){this.trigger("upload")}_onCancelButtonClicked(e){this.cancel()}_onAddFileButtonClicked(e){this.browse()}_onFileChange(e){this.addFiles(e.files)}_onMouseDown(e){let t=this.findParent(s=>s instanceof U&&s.isDialog());t&&t.activate()}_attach(){this.$parent.append(this.$container),super._attach()}_detach(){this.$container.detach(),super._detach()}}class Gm extends ke{_onWidgetCancel(e){e.preventDefault(),this._send("cancel")}_onWidgetEvent(e){e.type==="cancel"?this._onWidgetCancel(e):e.type==="upload"?this._onUpload(e):super._onWidgetEvent(e)}_onUpload(e){this.widget.rendered&&this.widget.uploadButton.setEnabled(!1),this.widget.files.length!==0&&(this.session.uploadFiles(this,this.widget.files,void 0,this.widget.maximumUploadSize),this.session.listen().done(()=>{this.widget&&this.widget.rendered&&this.widget.uploadButton.setEnabled(!0)}))}}function Um(i,e,t){return e=aP(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function aP(i){var e=hP(i,"string");return typeof e=="symbol"?e:String(e)}function hP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ll{constructor(e,t){Um(this,"displayParent",void 0),Um(this,"session",void 0),this.displayParent=e,this.session=t}registerAndRender(e){u.assertProperty(e,"displayParent"),this.displayParent.fileChoosers.push(e),this._render(e)}unregisterAndRemove(e){e&&(p.remove(this.displayParent.fileChoosers,e),this._remove(e))}remove(){this.displayParent.fileChoosers.forEach(this._remove.bind(this))}render(){this.displayParent.fileChoosers.forEach(e=>{e.setDisplayParent(this.displayParent),this._render(e)})}_render(e){if(e.displayParent||e._setProperty("displayParent",this.displayParent),this.displayParent.acceptView){if(!this.displayParent.acceptView(e))return}else if(!this.acceptView(e))return;if(e.rendered)return;let t;this.displayParent instanceof U&&this.displayParent.isPopupWindow()?t=this.displayParent.popupWindow.$container:t=this.session.desktop.$container,e.setTrackFocus(!0),e.render(t),this.displayParent.inFront()||e.detach()}_remove(e){e.remove()}attach(){this.displayParent.fileChoosers.forEach(e=>e.attach())}detach(){this.displayParent.fileChoosers.forEach(e=>e.detach())}acceptView(e){return this.displayParent.rendered}}function ks(i,e,t){return e=dP(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function dP(i){var e=uP(i,"string");return typeof e=="symbol"?e:String(e)}function uP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class _i extends I{constructor(){super(),ks(this,"acceptTypes",void 0),ks(this,"maximumUploadSize",void 0),ks(this,"multiSelect",void 0),ks(this,"text",void 0),ks(this,"uploadController",void 0),ks(this,"files",void 0),ks(this,"$fileInput",void 0),ks(this,"$text",void 0),ks(this,"dragAndDropHandler",void 0),this.acceptTypes=null,this.maximumUploadSize=_i.DEFAULT_MAXIMUM_UPLOAD_SIZE,this.multiSelect=!1,this.files=[],this.text=null}_init(e){super._init(e),this.uploadController=e.uploadController||e.parent}_render(){this.$fileInput=this.$parent.makeElement("<input>").attr("type","file").on("change",this._onFileChange.bind(this)),this.$container=this.$parent.appendDiv("file-input input-field"),this.$fileInput.appendTo(this.$container),this.$container.on("mousedown",this._onMouseDown.bind(this)),this.$text=this.$container.appendDiv("file-input-text")}_renderProperties(){super._renderProperties(),this._renderText(),this._renderAcceptTypes(),this._renderMultiSelect()}_renderEnabled(){super._renderEnabled(),this._installOrUninstallDragAndDropHandler(),this.$container.setTabbable(this.enabledComputed)}setText(e){this.setProperty("text",e)}_renderText(){let e=this.text||"";this.$text.text(e)}setAcceptTypes(e){this.setProperty("acceptTypes",e)}_renderAcceptTypes(){let e=this.acceptTypes||"";this.$fileInput.attr("accept",e)}setMultiSelect(e){this.setProperty("multiSelect",e)}_renderMultiSelect(){this.$fileInput.prop("multiple",this.multiSelect)}setMaximumUploadSize(e){this.setProperty("maximumUploadSize",e)}_remove(){Fe.uninstallDragAndDropHandler(this),super._remove()}_installOrUninstallDragAndDropHandler(){Fe.installOrUninstallDragAndDropHandler({target:this,onDrop:e=>{e.files.length>=1&&this._setFiles(e.files)},dropMaximumSize:()=>this.maximumUploadSize,validateFiles:(e,t)=>{}})}clear(){this._setFiles([]),this.setText(null),this.rendered&&this.$fileInput.val(null)}_setFiles(e){let t;if(e instanceof FileList?t=qs.fileListToArray(e):t=p.ensure(e),p.equals(this.files,t))return;let s="";t.length>0&&(s=t[0].name),this.files=t,this.setText(s),this.trigger("change",{files:t})}upload(){return this.files.length===0?!0:this.session.uploadFiles(this.uploadController,this.files,void 0,this.maximumUploadSize)}browse(){this.$fileInput.trigger("click")}_onFileChange(e){let t=this.$fileInput[0].files;t.length&&this._setFiles(t)}_onMouseDown(e){!this.enabled||this.browse()}validateMaximumUploadSize(e){if(!qs.validateMaximumUploadSize(e,this.maximumUploadSize))throw this.session.text("ui.FileSizeLimit",this.maximumUploadSize/1024/1024+"")}}ks(_i,"DEFAULT_MAXIMUM_UPLOAD_SIZE",50*1024*1024);function cP(i,e,t){return e=pP(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function pP(i){var e=fP(i,"string");return typeof e=="symbol"?e:String(e)}function fP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class qm{constructor(){cP(this,"location",void 0),this.location=null}matches(e){return!1}activate(e){this.location=e}deactivate(){}}function mP(i,e,t){return e=gP(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function gP(i){var e=_P(i,"string");return typeof e=="symbol"?e:String(e)}function _P(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}const jt={routes:[],events:new Bo,currentRoute:null,defaultLocation:null,setDefaultLocation(i){jt.defaultLocation="#"+i},prepare(i,e){y.startsWith(e,"#")||(e="#"+e),i.attr("href",e).on("mousedown",t=>(jt.activate(e),!1))},activate(i){i||(i=new RegExp("[^/]*$").exec(document.location.href)[0]),(y.empty(i)||i==="/")&&(i=jt.defaultLocation);let e,t=null;for(e=0;e<jt.routes.length;e++)if(t=jt.routes[e],t.matches(i)){if(t===jt.currentRoute&&t.location===i){a().log.isDebugEnabled()&&a().log.debug("Route has not changed - do not activate route");return}jt.currentRoute&&jt.currentRoute.deactivate(),jt.currentRoute=t,jt.currentRoute.activate(i),window.location.replace(i),a().log.isInfoEnabled()&&a().log.info("router: activated route for location=",i),jt.events.trigger("routeChange",new lu(t));return}a().log.warn("router: no route registered for location=",i)},register(i){jt.routes.push(i)},on(i,e){jt.events.on(i,e)},updateLocation(i){let e="#"+i;window.location.replace(e)}};class lu extends Kt{constructor(e){super({route:e}),mP(this,"route",void 0)}}window.addEventListener("popstate",i=>(jt.activate(null),!1));function oo(i,e,t){return e=yP(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function yP(i){var e=bP(i,"string");return typeof e=="symbol"?e:String(e)}function bP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class au extends I{constructor(){super(),oo(this,"value",void 0),oo(this,"minValue",void 0),oo(this,"maxValue",void 0),oo(this,"step",void 0),oo(this,"$sliderInput",void 0),oo(this,"$sliderValue",void 0),this.value=null,this.minValue=null,this.maxValue=null,this.step=null,this.$sliderInput=null,this.$sliderValue=null}_init(e){super._init(e),this.value=e.value,this.minValue=e.minValue,this.maxValue=e.maxValue,this.step=e.step}_render(){this.$container=this.$parent.appendDiv("slider"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new hu(this)),this.$sliderInput=this.$container.appendElement("<input>","slider-input").attr("type","range").on("change",this._onValueChange.bind(this)).addClass(x.get().cssClassForEdge()),this.$sliderValue=this.$container.appendSpan("slider-value",this.value+"")}_renderProperties(){super._renderProperties(),this._renderValue(),this._renderMinValue(),this._renderMaxValue(),this._renderStep()}_remove(){super._remove(),this.$sliderInput=null,this.$sliderValue=null}_renderValue(){let e=u.nvl(this.value,0);this.$sliderInput.val(e),this.$sliderValue.text(e)}_renderMinValue(){this.minValue?this.$sliderInput.attr("min",this.minValue):this.$sliderInput.removeAttr("min")}_renderMaxValue(){this.maxValue?this.$sliderInput.attr("max",this.maxValue):this.$sliderInput.removeAttr("max")}_renderStep(){this.step?this.$sliderInput.attr("step",this.step):this.$sliderInput.removeAttr("step")}_onValueChange(e){let t=Number(this.$sliderInput.val());b.isNumber(t)||(t=u.nvl(this.maxValue,this.minValue,0)),this.setValue(t)}setValue(e){this.setProperty("value",e)}}class Ym extends ke{constructor(){super(),this._addRemoteProperties(["value"])}}function vP(i,e,t){return e=wP(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function wP(i){var e=TP(i,"string");return typeof e=="symbol"?e:String(e)}function TP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class hu extends ee{constructor(e){super(),vP(this,"slider",void 0),this.slider=e}layout(e){let t=v.size(e);this.slider.$sliderInput.css("height",t.height),this.slider.$sliderValue.css("height",t.height)}}function CP(i,e,t){return e=SP(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function SP(i){var e=PP(i,"string");return typeof e=="symbol"?e:String(e)}function PP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class jm extends re{constructor(){super(),CP(this,"ref",void 0),this.selected=!1,this.ref=null}_init(e){e.owner=e.parent,super._init(e)}_render(){super._render(),this.$container.addClass("button mode")}_renderProperties(){super._renderProperties(),this._renderSelected()}_renderSelected(){this.$container.select(this.selected)}doAction(){return this.prepareDoAction()?(this.selected||this.setSelected(!0),!0):!1}toggle(){this.selected||this.setSelected(!0)}_renderIconId(){super._renderIconId(),this._updateLabelAndIconStyle(),this.invalidateLayoutTree()}_renderText(){super._renderText(),this._updateLabelAndIconStyle(),this.invalidateLayoutTree()}_updateLabelAndIconStyle(){let e=!!this.text;this.get$Icon().toggleClass("with-label",e)}}class Xm extends br{}function al(i,e,t){return e=xP(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function xP(i){var e=EP(i,"string");return typeof e=="symbol"?e:String(e)}function EP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class du extends I{constructor(){super(),al(this,"modes",void 0),al(this,"selectedMode",void 0),al(this,"$slider",void 0),al(this,"_isModeChanging",void 0),al(this,"_modePropertyChangeHandler",void 0),this._addWidgetProperties(["modes","selectedMode"]),this._addPreserveOnPropertyChangeProperties(["selectedMode"]),this.modes=[],this.selectedMode=null,this.$slider=null,this._isModeChanging=!1,this._modePropertyChangeHandler=this._onModePropertyChange.bind(this)}_init(e){super._init(e),this._setModes(this.modes),this._setSelectedMode(this.selectedMode)}_render(){this.$container=this.$parent.appendDiv("mode-selector"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new uu(this))}_renderProperties(){super._renderProperties(),this._renderSlider(),this._renderModes()}setModes(e){this.setProperty("modes",e)}_setModes(e){this.modes.forEach(t=>t.off("propertyChange",this._modePropertyChangeHandler)),this._setProperty("modes",p.ensure(e)),this.modes.forEach(t=>{t.on("propertyChange",this._modePropertyChangeHandler),t.selected&&this.setSelectedMode(t)})}_renderSlider(){this.$slider=this.$container.appendDiv("mode-slider")}_renderModes(){this.modes.forEach(e=>{e.render(),this._registerDragHandlers(e.$container)}),this._updateMarkers()}setSelectedMode(e){this.setProperty("selectedMode",e)}_setSelectedMode(e){this._isModeChanging=!0,this.selectedMode&&this.selectedMode!==e&&this.selectedMode.setSelected(!1),e&&!e.selected&&e.setSelected(!0),this._setProperty("selectedMode",e),this._isModeChanging=!1,this._updateMarkers()}_onModePropertyChange(e){e.propertyName==="selected"&&!this._isModeChanging?this.setSelectedMode(e.newValue?e.source:null):e.propertyName==="visible"?this._updateMarkers():e.propertyName==="enabled"&&this._updateSlider()}_updateMarkers(){let e=[],t=-1;this.modes.forEach(s=>{s.rendered&&(s.$container.removeClass("first last after-selected"),s.isVisible()&&(e.push(s),s.selected&&(t=e.length-1)))}),e.length&&(e[0].$container.addClass("first"),e[e.length-1].$container.addClass("last"),t>=0&&t<e.length-1&&e[t+1].$container.addClass("after-selected")),this._updateSlider()}_updateSlider(){if(!this.$slider)return;let e=0,t=0;this.selectedMode&&this.selectedMode.$container&&(e=v.position(this.selectedMode.$container).x,t=v.size(this.selectedMode.$container,{exact:!0}).width),this.$slider.cssLeft(e),this.$slider.cssWidth(t),this.$slider.setVisible(this.selectedMode&&this.selectedMode.$container&&this.selectedMode.enabled)}_registerDragHandlers(e){let t="mode-selector-dragging",s=o=>this.enabledComputed&&this.selectedMode&&this.selectedMode.$container===e&&this.modes.filter(l=>l.isVisible()&&l.enabled).length>1,r=o=>{let l=this.$container.width()-e.outerWidth(),h=0,d=Math.max(Math.min(o.newLeft,l),h);return this.$container.children().addClass(t),d!==o.originalLeft&&this.$slider.cssLeft(d),d},n=o=>{this.$container.children().removeClass(t);let l=this._computeNewSelectedMode(o);!l||l===this.selectedMode||!l.enabled?this._updateSlider():this.setSelectedMode(l)};ot.onSwipe(e,t,s,r,n)}_computeNewSelectedMode(e){return e.direction===0||Math.abs(e.deltaX)<=5?this.selectedMode:e.direction<0?this._findModeByPos(e.newLeft):this._findModeByPos(e.newLeft+this.$slider.width())}_findModeByPos(e){let t=this.modes.filter(s=>s.isVisible());for(let s=t.length-1;s>=0;s--){let r=t[s],n=Math.floor(v.position(r.$container).x);if(e>=n){let o=v.size(r.$container).width,l=n+o;if(e<=l)return r}}return null}findModeById(e){return p.find(this.modes,t=>t.id===e)}findModeByRef(e){return p.find(this.modes,t=>t.ref===e)}selectModeById(e){this.setSelectedMode(this.findModeById(e))}selectModeByRef(e){this.setSelectedMode(this.findModeByRef(e))}}function FP(i,e,t){return e=DP(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function DP(i){var e=AP(i,"string");return typeof e=="symbol"?e:String(e)}function AP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class uu extends ee{constructor(e){super(),FP(this,"modeSelector",void 0),this.modeSelector=e}layout(e){super.layout(e),this.modeSelector.$slider&&this.modeSelector.$slider.setVisible(!1),this.modeSelector._updateSlider()}preferredLayoutSize(e,t){let s=super.preferredLayoutSize(e,t),r=this.modeSelector.$container.attr("style");this.modeSelector.$container.css({width:"auto",height:"auto"});let n=0;return this.modeSelector.modes.filter(o=>o.rendered).forEach(o=>{let l=o.$container.attr("style");o.$container.css("flex","none");let h=o.htmlComp.prefSize().width;h>n&&(n=h),o.$container.attrOrRemove("style",l)}),this.modeSelector.$container.attrOrRemove("style",r),s.width=n*this.modeSelector.modes.length+this.modeSelector.htmlComp.insets().horizontal(),s}}function Y(i,e,t){return e=$P(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function $P(i){var e=RP(i,"string");return typeof e=="symbol"?e:String(e)}function RP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class U extends I{constructor(){super(),Y(this,"animateOpening",void 0),Y(this,"askIfNeedSave",void 0),Y(this,"askIfNeedSaveText",void 0),Y(this,"data",void 0),Y(this,"displayViewId",void 0),Y(this,"displayHint",void 0),Y(this,"maximized",void 0),Y(this,"headerVisible",void 0),Y(this,"modal",void 0),Y(this,"displayParent",void 0),Y(this,"dialogs",void 0),Y(this,"views",void 0),Y(this,"messageBoxes",void 0),Y(this,"fileChoosers",void 0),Y(this,"focusedElement",void 0),Y(this,"closable",void 0),Y(this,"cacheBounds",void 0),Y(this,"cacheBoundsKey",void 0),Y(this,"resizable",void 0),Y(this,"movable",void 0),Y(this,"rootGroupBox",void 0),Y(this,"saveNeeded",void 0),Y(this,"saveNeededVisible",void 0),Y(this,"formController",void 0),Y(this,"messageBoxController",void 0),Y(this,"fileChooserController",void 0),Y(this,"closeKeyStroke",void 0),Y(this,"showOnOpen",void 0),Y(this,"initialFocus",void 0),Y(this,"renderInitialFocusEnabled",void 0),Y(this,"popupWindow",void 0),Y(this,"title",void 0),Y(this,"subTitle",void 0),Y(this,"iconId",void 0),Y(this,"status",void 0),Y(this,"uiCssClass",void 0),Y(this,"lifecycle",void 0),Y(this,"detailForm",void 0),Y(this,"$statusIcons",void 0),Y(this,"$header",void 0),Y(this,"$statusContainer",void 0),Y(this,"$close",void 0),Y(this,"$saveNeeded",void 0),Y(this,"$icon",void 0),Y(this,"$title",void 0),Y(this,"$subTitle",void 0),Y(this,"$dragHandle",void 0),Y(this,"_glassPaneRenderer",void 0),Y(this,"_preMaximizedBounds",void 0),Y(this,"_resizeHandler",void 0),Y(this,"_windowResizeHandler",void 0),this._addWidgetProperties(["rootGroupBox","views","dialogs","initialFocus","messageBoxes","fileChoosers"]),this._addPreserveOnPropertyChangeProperties(["initialFocus"]),this.animateOpening=!0,this.askIfNeedSave=!0,this.askIfNeedSaveText=null,this.data={},this.displayViewId=null,this.displayHint=U.DisplayHint.DIALOG,this.displayParent=null,this.maximized=!1,this.headerVisible=null,this.modal=!0,this.logicalGrid=u.create(cu),this.dialogs=[],this.views=[],this.messageBoxes=[],this.fileChoosers=[],this.focusedElement=null,this.closable=!0,this.cacheBounds=!1,this.cacheBoundsKey=null,this.resizable=!0,this.movable=!0,this.rootGroupBox=null,this.saveNeeded=!1,this.saveNeededVisible=!1,this.formController=null,this.messageBoxController=null,this.fileChooserController=null,this.closeKeyStroke=null,this.showOnOpen=!0,this.initialFocus=null,this.renderInitialFocusEnabled=!0,this.popupWindow=null,this.title=null,this.subTitle=null,this.iconId=null,this.$statusIcons=[],this.$header=null,this.$statusContainer=null,this.$close=null,this.$saveNeeded=null,this.$icon=null,this.$title=null,this.$subTitle=null,this.$dragHandle=null,this._glassPaneRenderer=null,this._preMaximizedBounds=null,this._resizeHandler=this._onResize.bind(this),this._windowResizeHandler=this._onWindowResize.bind(this)}_init(e){super._init(e),this.resolveTextKeys(["title","askIfNeedSaveText"]),this.resolveIconIds(["iconId"]),this._setDisplayParent(this.displayParent),this._setViews(this.views),this.formController=u.create(ml,{displayParent:this,session:this.session}),this.messageBoxController=new gl(this,this.session),this.fileChooserController=new ll(this,this.session),this._setRootGroupBox(this.rootGroupBox),this._setStatus(this.status),this.cacheBoundsKey=u.nvl(e.cacheBoundsKey,this.objectType),this._installLifecycle(),this._setClosable(this.closable)}_createKeyStrokeContext(){return new Oe}_render(){this._renderForm()}_renderProperties(){super._renderProperties(),this._renderMaximized(),this._renderMovable(),this._renderResizable(),this._renderHeaderVisible(),this._renderCssClass(),this._renderModal(),this._installFocusContext(),this.renderInitialFocusEnabled&&this.renderInitialFocus()}_postRender(){super._postRender(),this.formController.render(),this.messageBoxController.render(),this.fileChooserController.render(),this._glassPaneRenderer&&this._glassPaneRenderer.renderGlassPanes()}_destroy(){super._destroy(),this._glassPaneRenderer&&(this._glassPaneRenderer=null)}_remove(){this.formController.remove(),this.messageBoxController.remove(),this.fileChooserController.remove(),this._glassPaneRenderer&&(this._glassPaneRenderer.removeGlassPanes(),this._glassPaneRenderer=null),this._uninstallFocusContext(),this._removeHeader(),this.$dragHandle=null,super._remove()}_renderForm(){let e;this.$container=this.$parent.appendDiv("form").data("model",this),this.uiCssClass&&this.$container.addClass(this.uiCssClass),this.htmlComp=T.install(this.$container,this.session),this.isDialog()?(this.$container.addClass("dialog"),e=new ds(this),this.htmlComp.validateRoot=!0,this.$container[0].addEventListener("mousedown",this._onDialogMouseDown.bind(this),!0)):(this.isPopupWindow()&&this.$container.addClass("popup-window"),e=new hl(this)),this.htmlComp.setLayout(e),this.rootGroupBox.render()}setModal(e){this.setProperty("modal",e)}_renderModal(){this.parent instanceof wo||(this.modal&&!this._glassPaneRenderer?(this._glassPaneRenderer=new Zr(this),this._glassPaneRenderer.renderGlassPanes()):!this.modal&&this._glassPaneRenderer&&(this._glassPaneRenderer.removeGlassPanes(),this._glassPaneRenderer=null))}_installLifecycle(){this.lifecycle=this._createLifecycle(),this.lifecycle.handle("load",this._onLifecycleLoad.bind(this)),this.lifecycle.handle("save",this._onLifecycleSave.bind(this)),this.lifecycle.on("postLoad",this._onLifecyclePostLoad.bind(this)),this.lifecycle.on("reset",this._onLifecycleReset.bind(this)),this.lifecycle.on("close",this._onLifecycleClose.bind(this))}_createLifecycle(){return u.create(fu,{widget:this,askIfNeedSave:this.askIfNeedSave,askIfNeedSaveText:this.askIfNeedSaveText})}open(){return this.load().then(()=>{this.destroyed||this.showOnOpen&&this.show()})}load(){return this.lifecycle.load()}whenLoad(){return this.when("load")}_onLifecycleLoad(){try{return this._load().then(e=>{this.destroyed||(this.setData(e),this.importData(),this.trigger("load"))}).catch(e=>this._handleLoadError(e))}catch(e){return this._handleLoadError(e)}}_handleLoadError(e){throw this.close(),e}_load(){return a().resolvedPromise().then(()=>this.data)}whenPostLoad(){return this.when("postLoad")}_onLifecyclePostLoad(){return this._postLoad().then(()=>{this.trigger("postLoad")})}_postLoad(){return a().resolvedPromise()}setData(e){this.setProperty("data",e)}importData(){}exportData(){return null}ok(){return this.lifecycle.ok()}save(){return this.lifecycle.save()}whenSave(){return this.when("save")}_onLifecycleSave(){let e=this.exportData();return this._save(e).then(t=>(this.setData(e),this.trigger("save"),t))}_validate(){return E.ok()}_save(e){return a().resolvedPromise()}reset(){return this.lifecycle.reset()}whenReset(){return this.when("reset")}_onLifecycleReset(){this.trigger("reset")}cancel(){return this.lifecycle.cancel()}close(){return this.lifecycle.close()}whenClose(){return this.when("close")}_onLifecycleClose(){let e=new Kt;this.trigger("close",e),e.defaultPrevented||this._close()}_close(){this.hide(),this.destroy()}abort(){let e=new Kt;this.trigger("abort",e),e.defaultPrevented||this._abort()}whenAbort(){return this.when("abort")}_abort(){let e=this.rootGroupBox.controls;e=e.concat(this.rootGroupBox.menus),e.filter(s=>{let r=s.enabled;return s.enabledComputed!==void 0&&(r=s.enabledComputed),s.visible&&r&&s.systemType}).some(s=>s.systemType===Re.SystemType.CLOSE)?this.close():this.cancel(),this._afterAbort()}_afterAbort(){!this.destroyed&&this.isShown()&&this.activate()}revealInvalidField(e){!e||this._revealInvalidField(e)}_revealInvalidField(e){let t=this._createRevealInvalidFieldEvent(e);this.trigger("revealInvalidField",t),!t.defaultPrevented&&e.reveal()}_createRevealInvalidFieldEvent(e){return new Kt({validationResult:e})}_createCloseKeyStroke(){return new ra(this,()=>this.$close)}_setClosable(e){this._setProperty("closable",e),this.closable?(this.closeKeyStroke=this._createCloseKeyStroke(),this.keyStrokeContext.registerKeyStroke(this.closeKeyStroke)):this.keyStrokeContext.unregisterKeyStroke(this.closeKeyStroke)}setClosable(e){this.setProperty("closable",e)}_renderClosable(){if(!!this.$header)if(this.$container.toggleClass("closable"),this.closable){if(this.$close)return;this.$close=this.$statusContainer.appendDiv("status closer").on("click",this._onCloseIconClick.bind(this))}else{if(!this.$close)return;this.$close.remove(),this.$close=null}}_onCloseIconClick(){this.abort()}setResizable(e){this.setProperty("resizable",e)}_renderResizable(){this.resizable&&this.isDialog()&&!this.maximized?this.$container.resizable().on("resize",this._resizeHandler):this.$container.unresizable().off("resize",this._resizeHandler)}_onResize(e){let t=this.htmlComp.layout,s=t.autoSize;return t.autoSize=!1,this.htmlComp.revalidateLayout(),t.autoSize=s,this.updateCacheBounds(),!1}setMovable(e){this.setProperty("movable",e)}_renderMovable(){if(this.movable&&this.isDialog()&&!this.maximized){if(this.$dragHandle)return;this.$dragHandle=this.$container.prependDiv("drag-handle"),this.$container.draggable(this.$dragHandle,a().throttle(this._onMove.bind(this),1e3/60))}else{if(!this.$dragHandle)return;this.$container.undraggable(this.$dragHandle),this.$dragHandle.remove(),this.$dragHandle=null}}_onDialogMouseDown(){this.activate()}activate(){this.session.desktop.activateForm(this)}show(){this.session.desktop.showForm(this)}hide(){this.session.desktop.hideForm(this)}isShown(){return this.session.desktop.isFormShown(this)}_renderHeader(){this.$header=this.$container.prependDiv("header"),this.$statusContainer=this.$header.appendDiv("status-container"),this.$icon=this.$header.appendDiv("icon-container"),this.$title=this.$header.appendDiv("title"),K.installForEllipsis(this.$title,{parent:this}),this.$subTitle=this.$header.appendDiv("sub-title"),K.installForEllipsis(this.$subTitle,{parent:this}),this._renderTitle(),this._renderSubTitle(),this._renderIconId(),this._renderStatus(),this._renderClosable(),this._renderSaveNeeded()}_removeHeader(){this.$title&&K.uninstall(this.$title),this.$subTitle&&K.uninstall(this.$subTitle),this.$header&&(this.$header.remove(),this.$header=null),this.$title=null,this.$subTitle=null,this.$statusContainer=null,this.$icon=null,this.$close=null,this.$saveNeeded=null}setRootGroupBox(e){this.setProperty("rootGroupBox",e)}_setRootGroupBox(e){this._setProperty("rootGroupBox",e),this.rootGroupBox&&this.rootGroupBox.setMainBox(!0)}_renderSaveNeeded(){if(!!this.$header){if(this.saveNeeded&&this.saveNeededVisible){if(this.$container.addClass("save-needed"),this.$saveNeeded)return;this.$close?this.$saveNeeded=this.$close.beforeDiv("status save-needer"):this.$saveNeeded=this.$statusContainer.appendDiv("status save-needer")}else{if(this.$container.removeClass("save-needed"),!this.$saveNeeded)return;this.$saveNeeded.remove(),this.$saveNeeded=null}this.invalidateLayoutTree()}}setAskIfNeedSave(e){this.setProperty("askIfNeedSave",e),this.lifecycle&&this.lifecycle.setAskIfNeedSave(e)}setDisplayViewId(e){this.setProperty("displayViewId",e)}setDisplayHint(e){this.setProperty("displayHint",e)}setSaveNeededVisible(e){this.setProperty("saveNeededVisible",e)}_renderSaveNeededVisible(){this._renderSaveNeeded()}_renderCssClass(e,t){e=e||this.cssClass,this.$container.removeClass(t),this.$container.addClass(e),this.invalidateLayoutTree()}setStatus(e){this.setProperty("status",e)}_setStatus(e){e=E.ensure(e),this._setProperty("status",e)}_renderStatus(){if(!!this.$header){if(this.$statusIcons.forEach(e=>{e.remove()}),this.$statusIcons=[],this.status){let e=this.status.asFlatList(),t;e.forEach(s=>{t=this._renderSingleStatus(s,t),t&&this.$statusIcons.push(t)})}this.invalidateLayoutTree()}}_renderSingleStatus(e,t){if(e&&e.iconId){let s=this.$statusContainer.appendIcon(e.iconId,"status");return e.cssClass()&&s.addClass(e.cssClass()),s.prependTo(this.$statusContainer),s}return t}addStatus(e){if(!e)return;const t=this.status&&this.status.children,s=new E({children:t});s.addStatus(e),this.setStatus(s)}removeStatus(e){if(!(!this.status||!e)){if(this.status.equals(e)){this.setStatus(null);return}if(this.status.containsStatusByPredicate(t=>e.equals(t))){const t=this.status.clone();t.removeAllStatusByPredicate(s=>e.equals(s)),this.setStatus(t)}}}getNotificationBadgeText(){const e=this._getNotificationBadgeStatus();if(e)return e.message}setNotificationBadgeText(e){this.removeStatus(this._getNotificationBadgeStatus()),e&&this.addStatus(new Ss({message:e,code:U._NOTIFICATION_BADGE_STATUS_CODE}))}_getNotificationBadgeStatus(){if(!!this.status)return this.status.asFlatList().find(e=>U._NOTIFICATION_BADGE_STATUS_CODE===e.code)}setShowOnOpen(e){this.setProperty("showOnOpen",e)}_updateTitleForDom(){let e=this.title;if(!e&&this.closable&&(e=y.plainText("&nbsp;")),e||this.subTitle){let r=t(this.$container,"title-box");e?t(r,"title").text(e).icon(this.iconId):s(r,"title"),y.hasText(e)?t(r,"sub-title").text(this.subTitle):s(r,"sub-title")}else s(this.$container,"title-box");function t(r,n){let o=r.children("."+n);return o.length===0&&(o=this.$parent.appendDiv(n)),o}function s(r,n){r.children("."+n).remove()}}isDialog(){return this.displayHint===U.DisplayHint.DIALOG}isPopupWindow(){return this.displayHint===U.DisplayHint.POPUP_WINDOW}isView(){return this.displayHint===U.DisplayHint.VIEW}_onMove(e){this.trigger("move",e),this.updateCacheBounds()}moveTo(e){this.$container.cssPosition(e),this.trigger("move",{left:e.x,top:e.y}),this.updateCacheBounds()}position(){let e,t=this.prefBounds();if(t){e=t.point();let s=this.$container.windowSize(),r=this.htmlComp.margins(),n=0,o=0,l=s.width-t.width-r.horizontal(),h=s.height-t.height-r.vertical();e.x=Math.max(n,Math.min(l,e.x)),e.y=Math.max(o,Math.min(h,e.y))}else e=ds.positionContainerInWindow(this.$container);this.moveTo(e)}updateCacheBounds(){this.cacheBounds&&!this.maximized&&this.storeCacheBounds(this.htmlComp.bounds())}appendTo(e){this.$container.appendTo(e)}setHeaderVisible(e){this.setProperty("headerVisible",e)}_renderHeaderVisible(){let e=this.headerVisible===null?this.isDialog():this.headerVisible;e&&!this.$header?this._renderHeader():!e&&this.$header&&this._removeHeader();let t=this.$header&&this.$header.hasClass("no-title");this.$container.toggleClass("header-visible",e&&!t),this.invalidateLayoutTree()}setTitle(e){this.setProperty("title",e)}_renderTitle(){this.$header&&(this.$title.text(this.title),this.$header.toggleClass("no-title",!this.title&&!this.subTitle)),this.invalidateLayoutTree()}setSubTitle(e){this.setProperty("subTitle",e)}_renderSubTitle(){this.$header&&(this.$subTitle.text(this.subTitle),this.$header.toggleClass("no-title",!this.title&&!this.subTitle)),this.invalidateLayoutTree()}setIconId(e){this.setProperty("iconId",e)}_renderIconId(){this.$header&&(this.$icon.icon(this.iconId),this.invalidateLayoutTree())}_setViews(e){e&&e.forEach(t=>{t.setDisplayParent(this)}),this._setProperty("views",e)}setDisabledStyle(e){this.rootGroupBox.setDisabledStyle(e)}setDisplayParent(e){this.setProperty("displayParent",e)}_setDisplayParent(e){e instanceof U&&e.parent instanceof wo&&e.isView()&&(e=U.findNonWrappedForm(e)),this._setProperty("displayParent",e),e&&this.setParent(this.findDesktop().computeParentForDisplayParent(e))}setMaximized(e){this.setProperty("maximized",e)}_renderMaximized(){!this.isDialog()||(this.maximized&&this.htmlComp.layouted&&(this._preMaximizedBounds=this.htmlComp.bounds()),this._maximize(),this.maximized||(this._preMaximizedBounds=null),this.maximized?this.$container.window().on("resize",this._windowResizeHandler):this.$container.window().off("resize",this._windowResizeHandler),this.rendered&&(this._renderMovable(),this._renderResizable()))}_onWindowResize(){this.maximized&&this._maximize()}_maximize(){if(!this.rendered)return;let e=this.htmlComp.layout,t=e.shrinkEnabled;e.shrinkEnabled=!0,this.revalidateLayoutTree(),this.position(),e.shrinkEnabled=t}prefBounds(){return this.maximized?null:this._preMaximizedBounds?this._preMaximizedBounds:this.cacheBounds?this.readCacheBounds():null}_attach(){this.$parent.append(this.$container),this.isView()&&this.invalidateLayoutTree(!1),(this.isView()||this.isDialog())&&!this.detailForm&&this.session.desktop._setFormActivated(this),super._attach()}_postAttach(){this.formController.attachDialogs(),this.messageBoxController.attach(),this.fileChooserController.attach(),super._attach()}_detach(){this.formController.detachDialogs(),this.messageBoxController.detach(),this.fileChooserController.detach(),this.$container.detach(),super._detach()}renderInitialFocus(){let e=!1;if(this.initialFocus)e=this.initialFocus.focus();else if(!this.$container.isOrHas(this.$container.activeElement())){let t=this.session.focusManager;e=t.requestFocusIfReady(t.findFirstFocusableElement(this.$container))}if(e){let t=this.$container.activeElement().scrollParent();t.scrollTop(0),t.scrollLeft(0)}}_initialFocusElement(){let e;return this.initialFocus&&(e=this.initialFocus.getFocusableElement()),e||(e=this.session.focusManager.findFirstFocusableElement(this.$container)),e}_installFocusContext(){(this.isDialog()||this.isPopupWindow())&&this.session.focusManager.installFocusContext(this.$container,Mt.NONE)}_uninstallFocusContext(){(this.isDialog()||this.isPopupWindow())&&this.session.focusManager.uninstallFocusContext(this.$container)}touch(){this.rootGroupBox.touch()}inFront(){return this.rendered&&this.attached}visitFields(e){this.rootGroupBox.visitFields(e)}visitDisplayChildren(e,t){t||(t=r=>!0);let s=r=>{e(r),r instanceof U&&r.visitDisplayChildren(e,t)};this.dialogs.filter(t).forEach(s,this),this.messageBoxes.filter(t).forEach(s,this),this.fileChoosers.filter(t).forEach(s,this)}storeCacheBounds(e){if(this.cacheBounds){let t="scout:formBounds:"+this.cacheBoundsKey;Se.setItemToLocalStorage(t,JSON.stringify(e))}}readCacheBounds(){if(!this.cacheBounds)return null;let e="scout:formBounds:"+this.cacheBoundsKey,t=Se.getItemFromLocalStorage(e);return t?(t=JSON.parse(t),new ie(t.x,t.y,t.width,t.height)):null}static findForm(e){let t=e.parent;for(;t&&!(t instanceof U);)t=t.parent;return t}static findNonWrappedForm(e){if(!e)return null;let t=null;return e.findParent(s=>{if(s instanceof U)return t=s,!(t.parent instanceof wo)}),t}}Y(U,"DisplayHint",{DIALOG:"dialog",POPUP_WINDOW:"popupWindow",VIEW:"view"}),Y(U,"_NOTIFICATION_BADGE_STATUS_CODE",197821);class Sa extends ke{_initModel(e,t){let s=super._initModel(e,t);return s.logicalGrid=null,s}_onWidgetEvent(e){e.type==="abort"?this._onWidgetAbort(e):e.type==="close"?this._onWidgetClose(e):super._onWidgetEvent(e)}_onWidgetAbort(e){e.preventDefault(),this._send("formClosing"),this.session.onRequestsDone(()=>{this.widget&&this.widget._afterAbort()})}_onWidgetClose(e){this._send("close")}onModelAction(e){e.type==="requestFocus"?this._onRequestFocus(e):e.type==="requestInput"?this._onRequestInput(e):super.onModelAction(e)}_onRequestFocus(e){this.session.getOrCreateWidget(e.formField,this.widget).focus()}_onRequestInput(e){this.session.getOrCreateWidget(e.formField,this.widget).requestInput()}}class cu extends Ql{_validate(e){e.rootGroupBox.gridData=ze.createFromHints(e.rootGroupBox)}}function MP(i,e,t){return e=IP(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function IP(i){var e=LP(i,"string");return typeof e=="symbol"?e:String(e)}function LP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class hl extends ee{constructor(e){super(),MP(this,"form",void 0),this.form=e}layout(e){let t=T.get(e),s=this._htmlRootGroupBox(),r;this.form.validateLogicalGrid(),r=t.availableSize().subtract(t.insets()).subtract(s.margins()),r.height-=this._headerHeight(),a().log.isTraceEnabled()&&a().log.trace("(FormLayout#layout) rootGbSize="+r),s.setSize(r)}preferredLayoutSize(e,t){t=t||{};let s=T.get(e),r=this._htmlRootGroupBox(),n;this.form.validateLogicalGrid();let o=this._headerHeight();return t.heightHint&&(t.heightHint-=o),n=r.prefSize(t).add(s.insets()).add(r.margins()),n.height+=o,n}_htmlRootGroupBox(){let e=this.form.$container.children(".root-group-box");return T.get(e)}_headerHeight(){let e=this.form.$header;return e&&e.css("position")!=="absolute"?v.prefSize(e,!0).height:0}}class pu extends sn{constructor(e){super(e)}handle(e){this.field.toggle()}_postRenderKeyBox(e,t){if(this.field.iconId){let s=e.find(".icon").width(),r=e.find(".key-box").outerWidth(),n=e.cssPaddingLeft(),o=s/2-r/2+n;e.find(".key-box").cssLeft(o)}}}function ln(i,e,t){return e=OP(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function OP(i){var e=BP(i,"string");return typeof e=="symbol"?e:String(e)}function BP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Hs extends ne{constructor(){super(),ln(this,"form",void 0),ln(this,"popupStyle",void 0),ln(this,"popupClosable",void 0),ln(this,"popupMovable",void 0),ln(this,"popupResizable",void 0),ln(this,"_formDestroyHandler",void 0),this.form=null,this.toggleAction=!0,this.popupStyle=null,this.popupClosable=!1,this.popupMovable=!1,this.popupResizable=!1,this._addWidgetProperties("form"),this._formDestroyHandler=this._onFormDestroy.bind(this)}_init(e){super._init(e),this.popupStyle||(this.session.userAgent.deviceType===x.Type.MOBILE?this.popupStyle=Hs.PopupStyle.MOBILE:this.popupStyle=Hs.PopupStyle.DEFAULT),this._setSelected(this.selected),this._setForm(this.form)}_renderForm(){!this.rendered||this._renderSelected()}clone(e,t){return e=e||{},e.form=this.form,super.clone(e,t)}setForm(e){this.setProperty("form",e)}_setForm(e){this.form&&this.form.off("destroy",this._formDestroyHandler),this._setProperty("form",e),this.form&&(this._adaptForm(this.form),this.form.one("destroy",this._formDestroyHandler))}_adaptForm(e){e.setDisplayHint(U.DisplayHint.VIEW),e.setModal(!1),e.setClosable(!1)}_onFormDestroy(e){(!this.popup||!this.popup.destroying)&&this.setSelected(!1),this.setForm(null);let t=this.findParent(s=>s instanceof ft);t&&!(t.destroying||t.removing)&&t.close()}_setSelected(e){this._setProperty("selected",e),this.popupStyle===Hs.PopupStyle.MOBILE&&this._doActionTogglesPopup()&&(this.selected?this._openPopup():this._closePopup())}_renderSelected(){super._renderSelected(),this.$container.addClass("has-popup")}_canOpenPopup(){return this._closeOtherPopupsForSameMenu(),super._canOpenPopup()}_closeOtherPopupsForSameMenu(){this._findOtherPopupsForSameMenu().forEach(e=>{if(e.isRemovalPending()){e.removeImmediately();return}if(e._rendered){let t=e.animateRemoval;e.animateRemoval=!1,e.close(),e.animateRemoval=t}})}_findOtherPopupsForSameMenu(){return this.session.desktop.getPopups().filter(e=>e===this.popup||e.has(this)?!1:this._popupBelongsToMenu(e))}_popupBelongsToMenu(e){return!!(e.parent.original()===this.original()||e.findChild(t=>t.original()===this.original()))}_createPopup(){return this.form.rootGroupBox.setMenuBarPosition(xe.MenuBarPosition.BOTTOM),this.popupStyle===Hs.PopupStyle.MOBILE?u.create(Fd,{parent:this.session.desktop,content:this.form,title:this.form.title}):u.create(eo,{parent:this,content:this.form,anchor:this,closeOnAnchorMouseDown:!1,cssClass:"form-menu-popup",horizontalAlignment:this.popupHorizontalAlignment,verticalAlignment:this.popupVerticalAlignment,closable:this.popupClosable,movable:this.popupMovable,resizable:this.popupResizable})}_doActionTogglesPopup(){return!!this.form}_handleSelectedInEllipsis(){this.popupStyle!==Hs.PopupStyle.MOBILE&&super._handleSelectedInEllipsis()}_createActionKeyStroke(){return new pu(this)}}ln(Hs,"PopupStyle",{DEFAULT:"default",MOBILE:"mobile"});class Jm extends il{}class fu extends su{constructor(){super(),this.validationFailedTextKey="FormValidationFailedTitle",this.emptyMandatoryElementsTextKey="FormEmptyMandatoryFieldsMessage",this.invalidElementsTextKey="FormInvalidFieldsMessage",this.saveChangesQuestionTextKey="FormSaveChangesQuestion"}init(e){u.assertParameter("widget",e.widget,U),super.init(e)}_reset(){this.widget.visitFields(e=>{e instanceof me&&e.resetValue()})}invalidElements(){let e=[],t=[];return this.widget.visitFields(s=>{let r=s.getValidationResult();if(!r.valid){if(!r.validByErrorStatus){t.push(r);return}r.validByMandatory||e.push(r)}}),{missingElements:e,invalidElements:t}}_invalidElementText(e){return y.plainText(e.label)}_missingElementText(e){return y.plainText(e.label)}_validateWidget(){return this.widget._validate()}_revealInvalidElement(e){this.widget.revealInvalidField(e)}markAsSaved(){this.widget.visitFields(e=>{e.markAsSaved()})}requiresSave(){let e=!1;return this.widget.visitFields(t=>{t.updateRequiresSave(),t.requiresSave&&(e=!0)}),e}}function kP(i,e,t){return e=HP(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function HP(i){var e=NP(i,"string");return typeof e=="symbol"?e:String(e)}function NP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class an extends ne{constructor(){super(),kP(this,"systemType",void 0),this.systemType=null}}class mu extends an{constructor(){super(),this.actionStyle=re.ActionStyle.BUTTON,this.keyStroke="esc",this.systemType=Re.SystemType.CANCEL,this.inheritAccessibility=!1,this.preventDoubleClick=!0}_init(e){super._init(e),this.text=u.nvl(this.text,this.session.text("CancelButton"))}_doAction(){let e=this.getForm(),t=new Kt;this.trigger("action",t),t.defaultPrevented||e.cancel()}}class Qm extends an{constructor(){super(),this.actionStyle=re.ActionStyle.BUTTON,this.keyStroke="esc",this.systemType=Re.SystemType.CLOSE,this.inheritAccessibility=!1,this.preventDoubleClick=!0}_init(e){super._init(e),this.text=u.nvl(this.text,this.session.text("CloseButton"))}_doAction(){let e=this.getForm(),t=new Kt;this.trigger("action",t),t.defaultPrevented||e.close()}}class gu extends an{constructor(){super(),this.actionStyle=re.ActionStyle.BUTTON,this.keyStroke="enter",this.systemType=Re.SystemType.OK,this.preventDoubleClick=!0}_init(e){super._init(e),this.text=u.nvl(this.text,this.session.text("OkButton"))}_doAction(){let e=this.getForm(),t=new Kt;this.trigger("action",t),t.defaultPrevented||e.ok()}}class Zm extends an{constructor(){super(),this.actionStyle=re.ActionStyle.BUTTON,this.systemType=Re.SystemType.RESET,this.preventDoubleClick=!0}_init(e){super._init(e),this.text=u.nvl(this.text,this.session.text("ResetButton"))}_doAction(){let e=this.getForm(),t=new Kt;this.trigger("action",t),t.defaultPrevented||e.reset()}}class eg extends an{constructor(){super(),this.actionStyle=re.ActionStyle.BUTTON,this.keyStroke="enter",this.systemType=Re.SystemType.SAVE,this.preventDoubleClick=!0}_init(e){super._init(e),this.text=u.nvl(this.text,this.session.text("SaveButton"))}_doAction(){let e=this.getForm(),t=new Kt;this.trigger("action",t),t.defaultPrevented||e.save()}}function tg(i,e,t){return e=VP(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function VP(i){var e=WP(i,"string");return typeof e=="symbol"?e:String(e)}function WP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ds extends hl{constructor(e){super(e),tg(this,"autoSize",void 0),tg(this,"shrinkEnabled",void 0),this.autoSize=!0,this.shrinkEnabled=!1}layout(e){if(!this.autoSize){super.layout(e);return}let t,s=this.form.htmlComp,r=this.form.prefBounds(),n=s.margins(),o=e.windowSize();r?t=r:t=s.bounds();let l=this._calcSize(e,t,r);e.toggleClass("full-width",this.form.maximized||t.x===0&&n.horizontal()===0&&o.width===l.width).toggleClass("full-height",this.form.maximized||t.y===0&&n.vertical()===0&&o.height===l.height),s.layouted&&!this.shrinkEnabled&&(l.width=Math.max(l.width,t.width),l.height=Math.max(l.height,t.height)),v.setSize(e,l),super.layout(e)}_calcSize(e,t,s){let r,n=this.form.htmlComp,o=n.margins(),l=e.windowSize();return this.form.maximized?l:s?(r=s.dimension(),r=ds.fitContainerInWindow(l,new X,r,o),r):(r=this.preferredLayoutSize(e,{widthOnly:!0}),r=ds.fitContainerInWindow(l,t.point(),r,o),r=this.preferredLayoutSize(e,{widthHint:r.width}).ceil(),r=ds.fitContainerInWindow(l,t.point(),r,o),r)}static fitContainerInWindow(e,t,s,r){let n=e.width-r.horizontal()-t.x,o=e.height-r.vertical()-t.y,l=new F;return l.width=Math.min(n,s.width),l.height=Math.min(o,s.height),l}static positionContainerInWindow(e){let t=e.windowSize(),s=T.get(e).size(!0),r=(t.width-s.width)/2,n=(t.height-s.height)/2,o=n/5;return n-=o,r=Math.floor(r),n=Math.floor(n),new X(r,n)}}function Pa(i,e,t){return e=zP(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function zP(i){var e=KP(i,"string");return typeof e=="symbol"?e:String(e)}function KP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}let _u;class oe{constructor(){Pa(this,"active",void 0),Pa(this,"globalState",void 0),Pa(this,"_responsiveHandlers",void 0),this.active=!0,this.globalState=null,this._responsiveHandlers=[]}init(){}destroy(){this._responsiveHandlers.forEach(e=>{e.destroy()})}setActive(e){this.active=e}setGlobalState(e){this.globalState=e}handleResponsive(e,t){if(!this.active||!e.responsiveHandler||!e.responsiveHandler.active())return!1;let s,r=e.responsiveHandler.state;return this.globalState?s=this.globalState:t<e.responsiveHandler.getCompactThreshold()&&e.responsiveHandler.acceptState(oe.ResponsiveState.COMPACT)?s=oe.ResponsiveState.COMPACT:(r===oe.ResponsiveState.COMPACT&&e.responsiveHandler.transform(oe.ResponsiveState.CONDENSED),t<e.responsiveHandler.getCondensedThreshold()&&e.responsiveHandler.acceptState(oe.ResponsiveState.CONDENSED)?s=oe.ResponsiveState.CONDENSED:s=oe.ResponsiveState.NORMAL),e.responsiveHandler.transform(s)}reset(e,t){!this.active||(!e.responsiveHandler||!e.responsiveHandler.active())&&!t||e.responsiveHandler.transform(oe.ResponsiveState.NORMAL,t)}registerHandler(e,t){e.responsiveHandler&&e.responsiveHandler.destroy(),e.responsiveHandler=t}unregisterHandler(e){e.responsiveHandler&&(e.responsiveHandler.destroy(),e.responsiveHandler=null)}static get(){return _u}}Pa(oe,"ResponsiveState",{NORMAL:"normal",CONDENSED:"condensed",COMPACT:"compact"}),te.addListener("prepare",()=>{_u||(_u=u.create(oe))});function Xi(i,e,t){return e=GP(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function GP(i){var e=UP(i,"string");return typeof e=="symbol"?e:String(e)}function UP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class xa{constructor(){Xi(this,"objectType",void 0),Xi(this,"widget",void 0),Xi(this,"compactThreshold",void 0),Xi(this,"condensedThreshold",void 0),Xi(this,"oldState",void 0),Xi(this,"state",void 0),Xi(this,"allowedStates",void 0),Xi(this,"transformations",void 0),Xi(this,"enabledTransformations",void 0),Xi(this,"_transformationsToApply",void 0),Xi(this,"_transformationsToReset",void 0),Xi(this,"_destroyHandler",void 0),this.widget=null,this.compactThreshold=-1,this.condensedThreshold=-1,this.oldState=oe.ResponsiveState.NORMAL,this.state=oe.ResponsiveState.NORMAL,this.allowedStates=[oe.ResponsiveState.NORMAL,oe.ResponsiveState.COMPACT],this.transformations=b.createMap(),this.enabledTransformations=b.createMap(),this._destroyHandler=this._onDestroy.bind(this)}init(e){a().extend(this,e),this.widget.one("destroy",this._destroyHandler)}destroy(){this.widget.off("destroy",this._destroyHandler)}getCompactThreshold(){return this.compactThreshold}getCondensedThreshold(){return this.condensedThreshold}active(){return!0}setAllowedStates(e){this.allowedStates=e}acceptState(e){return p.contains(this.allowedStates,e)}_registerTransformation(e,t){this.transformations[e]=t.bind(this)}_enableTransformation(e,t){let s=this.enabledTransformations[e];s||(s=[],this.enabledTransformations[e]=s),s.push(t)}_disableTransformation(e,t){p.remove(this.enabledTransformations[e],t)}_storeFieldProperty(e,t,s){e._setProperty("responsive-"+t,s)}_hasFieldProperty(e,t){return e.hasOwnProperty("responsive-"+t)}_getFieldProperty(e,t){return e["responsive-"+t]}transform(e,t){if(this.state===e&&!t)return!1;this.oldState=this.state,this.state=e;let s,r;return this.oldState!==this.state?(s=this.enabledTransformations[this.oldState]||[],r=this.enabledTransformations[this.state]||[]):(s=[],this.state!==oe.ResponsiveState.NORMAL&&p.pushAll(s,this.enabledTransformations[oe.ResponsiveState.NORMAL]),this.state!==oe.ResponsiveState.CONDENSED&&p.pushAll(s,this.enabledTransformations[oe.ResponsiveState.CONDENSED]),this.state!==oe.ResponsiveState.COMPACT&&p.pushAll(s,this.enabledTransformations[oe.ResponsiveState.COMPACT]),r=this.enabledTransformations[this.state]||[]),this._transformationsToApply=p.diff(r,s),this._transformationsToReset=p.diff(s,r),this._transform(),!0}_transform(){this._transformWidget(this.widget)}_transformWidget(e){this._transformationsToApply.forEach(t=>{this.transformations[t](e,!0)}),this._transformationsToReset.forEach(t=>{this.transformations[t](e,!1)})}_onDestroy(e){this.destroy()}}function Ea(i,e,t){return e=qP(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function qP(i){var e=YP(i,"string");return typeof e=="symbol"?e:String(e)}function YP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class lo extends xa{constructor(){super(),Ea(this,"_compositeFields",void 0),Ea(this,"_formFieldAddedHandler",void 0),Ea(this,"_htmlPropertyChangeHandler",void 0),this._initDefaults(),this.allowedStates=[oe.ResponsiveState.NORMAL,oe.ResponsiveState.CONDENSED,oe.ResponsiveState.COMPACT],this._formFieldAddedHandler=this._onFormFieldAdded.bind(this),this._compositeFields=[],this._htmlPropertyChangeHandler=this._onHtmlEnvironmentPropertyChange.bind(this)}_initDefaults(){this.compactThreshold=de.get().formColumnWidth}_onHtmlEnvironmentPropertyChange(){this._initDefaults()}init(e){super.init(e);let t=lo.TransformationType,s=oe.ResponsiveState;this._registerTransformation(t.LABEL_POSITION_ON_FIELD,this._transformLabelPositionOnField),this._registerTransformation(t.LABEL_POSITION_ON_TOP,this._transformLabelPositionOnTop),this._registerTransformation(t.LABEL_VISIBILITY,this._transformLabelVisibility),this._registerTransformation(t.STATUS_POSITION_ON_TOP,this._transformStatusPosition),this._registerTransformation(t.STATUS_VISIBILITY,this._transformStatusVisibility),this._registerTransformation(t.VERTICAL_ALIGNMENT,this._transformVerticalAlignment),this._registerTransformation(t.GRID_COLUMN_COUNT,this._transformGridColumnCount),this._registerTransformation(t.HIDE_PLACE_HOLDER_FIELD,this._transformHidePlaceHolderField),this._registerTransformation(t.FIELD_SCALABLE,this._transformFieldScalable),this._registerTransformation(t.RADIO_BUTTON_GROUP_USE_UI_HEIGHT,this._transformRadioButtonGroupUseUiHeight),this._enableTransformation(s.CONDENSED,t.LABEL_POSITION_ON_TOP),this._enableTransformation(s.CONDENSED,t.LABEL_VISIBILITY),this._enableTransformation(s.CONDENSED,t.VERTICAL_ALIGNMENT),this._enableTransformation(s.CONDENSED,t.RADIO_BUTTON_GROUP_USE_UI_HEIGHT),this._enableTransformation(s.COMPACT,t.LABEL_POSITION_ON_TOP),this._enableTransformation(s.COMPACT,t.LABEL_VISIBILITY),this._enableTransformation(s.COMPACT,t.STATUS_POSITION_ON_TOP),this._enableTransformation(s.COMPACT,t.STATUS_VISIBILITY),this._enableTransformation(s.COMPACT,t.VERTICAL_ALIGNMENT),this._enableTransformation(s.COMPACT,t.GRID_COLUMN_COUNT),this._enableTransformation(s.COMPACT,t.HIDE_PLACE_HOLDER_FIELD),this._enableTransformation(s.COMPACT,t.FIELD_SCALABLE),this._enableTransformation(s.COMPACT,t.RADIO_BUTTON_GROUP_USE_UI_HEIGHT),de.get().on("propertyChange",this._htmlPropertyChangeHandler),this.widget.visitFields(r=>{r instanceof Fr&&(r.on("propertyChange",this._formFieldAddedHandler),this._compositeFields.push(r))})}destroy(){super.destroy(),this._compositeFields.forEach(e=>e.off("propertyChange",this._formFieldAddedHandler)),de.get().off("propertyChange",this._htmlPropertyChangeHandler)}active(){return this.widget.responsive}getCondensedThreshold(){return this.condensedThreshold>0?this.condensedThreshold:this.widget.htmlComp.prefSize({widthOnly:!0}).width}_transform(){this.widget.visitFields(this._transformWidget.bind(this))}_transformWidget(e){if(e!==this.widget&&e instanceof xe&&e.responsive!==null)return _e.SKIP_SUBTREE;if(!(e instanceof A))return;let t;e.htmlComp&&(e.htmlComp.suppressValidate=!0,t=e.htmlComp.getParent(),t&&(t.suppressValidate=!0)),super._transformWidget(e),e.htmlComp&&(e.htmlComp.suppressValidate=!1),t&&(t.suppressValidate=!1)}_transformLabelPositionOnField(e,t){e.parent instanceof wl||e instanceof Dr||e instanceof sh||(t?(this._storeFieldProperty(e,"labelPosition",e.labelPosition),e.setLabelPosition(A.LabelPosition.ON_FIELD)):this._hasFieldProperty(e,"labelPosition")&&e.setLabelPosition(this._getFieldProperty(e,"labelPosition")))}_transformLabelPositionOnTop(e,t){e.parent instanceof wl||e instanceof Dr||e instanceof sh||e.labelPosition===A.LabelPosition.ON_FIELD||(t?(this._storeFieldProperty(e,"labelPosition",e.labelPosition),e.setLabelPosition(A.LabelPosition.TOP)):this._hasFieldProperty(e,"labelPosition")&&e.setLabelPosition(this._getFieldProperty(e,"labelPosition")))}_transformLabelVisibility(e,t){e instanceof Dr&&(t?(this._storeFieldProperty(e,"labelVisible",e.labelVisible),e.setLabelVisible(!1)):this._hasFieldProperty(e,"labelVisible")&&e.setLabelVisible(this._getFieldProperty(e,"labelVisible")))}getGridData(e){return new ze(e.gridDataHints)}setGridData(e,t){e.setGridDataHints(t)}_transformStatusPosition(e,t){t?(this._storeFieldProperty(e,"statusPosition",e.statusPosition),e.setStatusPosition(A.StatusPosition.TOP)):this._hasFieldProperty(e,"statusPosition")&&e.setStatusPosition(this._getFieldProperty(e,"statusPosition"))}_transformStatusVisibility(e,t){t?(this._storeFieldProperty(e,"statusVisible",e.statusVisible),e.setStatusVisible(!1)):this._hasFieldProperty(e,"statusVisible")&&e.setStatusVisible(this._getFieldProperty(e,"statusVisible"))}_transformVerticalAlignment(e,t){let s=e instanceof Re&&e.displayStyle===Re.DisplayStyle.DEFAULT,r=e instanceof Dr,n=e.labelPosition===A.LabelPosition.ON_FIELD&&e.gridData&&e.gridData.h===1;if(!(s||r||n)||!e.gridData)return;let o=this.getGridData(e);t?(this._storeFieldProperty(e,"fillVertical",o.fillVertical),this._storeFieldProperty(e,"verticalAlignment",o.verticalAlignment),o.fillVertical=!1,o.verticalAlignment=1):(this._hasFieldProperty(e,"fillVertical")&&(o.fillVertical=this._getFieldProperty(e,"fillVertical")),this._hasFieldProperty(e,"verticalAlignment")&&(o.verticalAlignment=this._getFieldProperty(e,"verticalAlignment"))),this.setGridData(e,o)}_transformGridColumnCount(e,t){e instanceof xe&&(t?(this._storeFieldProperty(e,"gridColumnCount",e.gridColumnCount),e.setGridColumnCount(1)):this._hasFieldProperty(e,"gridColumnCount")&&e.setGridColumnCount(this._getFieldProperty(e,"gridColumnCount")))}_transformHidePlaceHolderField(e,t){e instanceof lh&&(t?(this._storeFieldProperty(e,"visible",e.visible),e.setVisible(!1)):this._hasFieldProperty(e,"visible")&&e.setVisible(this._getFieldProperty(e,"visible")))}_transformFieldScalable(e,t){if(e.parent instanceof wl)return;let s=this.getGridData(e);t&&s.weightX===0?(this._storeFieldProperty(e,"weightX",s.weightX),s.weightX=1):t||this._hasFieldProperty(e,"weightX")&&(s.weightX=this._getFieldProperty(e,"weightX")),this.setGridData(e,s)}_transformRadioButtonGroupUseUiHeight(e,t){if(!(e instanceof or))return;let s=this.getGridData(e);t&&!s.useUiHeight?(this._storeFieldProperty(e,"useUiHeight",s.useUiHeight),s.useUiHeight=!0):t||this._hasFieldProperty(e,"useUiHeight")&&(s.useUiHeight=this._getFieldProperty(e,"useUiHeight")),this.setGridData(e,s)}_onFormFieldAdded(e){this.state!==oe.ResponsiveState.NORMAL&&(e.propertyName==="fields"||e.propertyName==="tabItems")&&p.diff(e.newValue,e.oldValue).forEach(s=>s.visitFields(this._transformWidget.bind(this)))}}Ea(lo,"TransformationType",{LABEL_POSITION_ON_FIELD:"labelPositionOnField",LABEL_POSITION_ON_TOP:"labelPositionOnTop",LABEL_VISIBILITY:"labelVisibility",STATUS_POSITION_ON_TOP:"statusPositionOnTop",STATUS_VISIBILITY:"statusVisibility",VERTICAL_ALIGNMENT:"verticalAlignment",GRID_COLUMN_COUNT:"gridColumnCount",HIDE_PLACE_HOLDER_FIELD:"hidePlaceHolderField",FIELD_SCALABLE:"fieldScalable",RADIO_BUTTON_GROUP_USE_UI_HEIGHT:"radioButtonGroupUseUiHeight"});class ig extends xa{constructor(){super(),this.compactThreshold=500,this.allowedStates=[oe.ResponsiveState.NORMAL,oe.ResponsiveState.COMPACT]}init(e){super.init(e),this._registerTransformation("navigationVisible",this._transformNavigationVisible),this._enableTransformation(oe.ResponsiveState.COMPACT,"navigationVisible")}_transformNavigationVisible(e,t){t?(this._storeFieldProperty(e,"navigationVisible",e.navigationVisible),e.setNavigationVisible(!1)):this._hasFieldProperty(e,"navigationVisible")&&e.setNavigationVisible(this._getFieldProperty(e,"navigationVisible"))}}function Cr(i,e,t){return e=jP(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function jP(i){var e=XP(i,"string");return typeof e=="symbol"?e:String(e)}function XP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Fa extends U{constructor(){super(),Cr(this,"outline",void 0),Cr(this,"nodes",void 0),Cr(this,"tileOverviewTitle",void 0),Cr(this,"scrollable",void 0),Cr(this,"pageTileGrid",void 0),Cr(this,"contentHtmlComp",void 0),Cr(this,"$content",void 0),Cr(this,"_desktopNavigationVisibilityChangeHandler",void 0),this.outline=null,this.nodes=null,this.tileOverviewTitle=null,this.scrollable=!0,this._addWidgetProperties(["pageTileGrid"]),this.$content=null,this.$title=null,this._desktopNavigationVisibilityChangeHandler=this._onDesktopNavigationVisibilityChange.bind(this)}_init(e){super._init(e),this.pageTileGrid||(this.pageTileGrid=this._createPageTileGrid()),this.addCssClass("dimmed-background")}_renderForm(){super._renderForm(),this.htmlComp.setLayout(new Ri),this.$content=this.$container.appendDiv("tile-overview-content"),this.contentHtmlComp=T.install(this.$content,this.session),this.contentHtmlComp.setLayout(new Ri({stretch:this.outline.compact})),this.$title=this.$content.appendDiv("tile-overview-title").text(this.tileOverviewTitle),T.install(this.$title,this.session),this.$title.cssMaxHeight(this.$title.cssHeight()),this._updateTitle(!1),this.findDesktop().on("propertyChange:navigationVisible",this._desktopNavigationVisibilityChangeHandler)}_remove(){this.$content=null,this.$title=null,this.findDesktop().off("propertyChange:navigationVisible",this._desktopNavigationVisibilityChangeHandler),super._remove()}_renderProperties(){super._renderProperties(),this.pageTileGrid.rendered&&(this.pageTileGrid=this._createPageTileGrid()),this._renderPageTileGrid(),this._renderScrollable()}_renderPageTileGrid(){this.pageTileGrid.render(this.$content)}_createPageTileGrid(){return u.create(Dh,{parent:this,outline:this.outline,nodes:this.nodes})}setScrollable(e){this.setProperty("scrollable",e)}_renderScrollable(){this.scrollable?this._installScrollbars({axis:"y"}):this._uninstallScrollbars()}setPage(e){this.outline=e.getOutline(),this.nodes=e.childNodes,this.tileOverviewTitle=e.text,this.setScrollable(!this.outline.compact),this.pageTileGrid.setCompact(this.outline.compact),this.pageTileGrid.setOutline(this.outline),this.pageTileGrid.setPage(e),this.pageTileGrid.setNodes(this.nodes)}_updateTitle(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;!this.$title||(this.$title.toggleClass("animated",e),this.$title.toggleClass("removed",this.findDesktop().navigationVisible))}_onDesktopNavigationVisibilityChange(e){this._updateTitle()}}class sg extends Sa{}class rg extends Sa{_initModel(e,t){let s=super._initModel(e,t);if(!s.jsFormObjectType||!s.jsFormObjectType.length)throw new Error("jsFormObjectType not set");let r={parent:s.parent,owner:s.owner,objectType:s.jsFormObjectType,displayParent:s.displayParent,displayHint:s.displayHint,data:s.inputData};return s.jsFormModel&&(r=$.extend(!0,{},s.jsFormModel,r)),r}_createWidget(e){let t=super._createWidget(e);return t.showOnOpen=!1,t.open(),t}_onWidgetEvent(e){e.type==="save"?this._onWidgetSave(e):super._onWidgetEvent(e)}_onWidgetSave(e){this._send("save",{outputData:this.widget.data})}_onWidgetClose(e){e.preventDefault(),this._send("formClosing")}_onWidgetAbort(e){}}function D(i,e,t){return e=JP(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function JP(i){var e=QP(i,"string");return typeof e=="symbol"?e:String(e)}function QP(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class V extends I{constructor(){super(),D(this,"autoResizeColumns",void 0),D(this,"columnAddable",void 0),D(this,"columnLayoutDirty",void 0),D(this,"columns",void 0),D(this,"contextColumn",void 0),D(this,"checkable",void 0),D(this,"displayViewId",void 0),D(this,"checkableStyle",void 0),D(this,"cellEditorPopup",void 0),D(this,"compact",void 0),D(this,"openFieldPopupOnCellEdit",void 0),D(this,"compactHandler",void 0),D(this,"compactColumn",void 0),D(this,"dropType",void 0),D(this,"dropMaximumSize",void 0),D(this,"dragAndDropHandler",void 0),D(this,"groupingStyle",void 0),D(this,"header",void 0),D(this,"tableStatus",void 0),D(this,"rowBorders",void 0),D(this,"headerEnabled",void 0),D(this,"headerVisible",void 0),D(this,"headerMenusEnabled",void 0),D(this,"hasReloadHandler",void 0),D(this,"hierarchical",void 0),D(this,"hierarchicalStyle",void 0),D(this,"keyStrokes",void 0),D(this,"menus",void 0),D(this,"menuBar",void 0),D(this,"menuBarVisible",void 0),D(this,"contextMenu",void 0),D(this,"multiCheck",void 0),D(this,"multiSelect",void 0),D(this,"multilineText",void 0),D(this,"scrollToSelection",void 0),D(this,"selectedRows",void 0),D(this,"sortEnabled",void 0),D(this,"tableControls",void 0),D(this,"tableStatusVisible",void 0),D(this,"tableTileGridMediator",void 0),D(this,"tileMode",void 0),D(this,"tileTableHeader",void 0),D(this,"tileProducer",void 0),D(this,"footer",void 0),D(this,"footerVisible",void 0),D(this,"filters",void 0),D(this,"rows",void 0),D(this,"rootRows",void 0),D(this,"visibleRows",void 0),D(this,"estimatedRowCount",void 0),D(this,"maxRowCount",void 0),D(this,"aggregateRowHeight",void 0),D(this,"truncatedCellTooltipEnabled",void 0),D(this,"checkableColumn",void 0),D(this,"rowIconColumn",void 0),D(this,"uiCssClass",void 0),D(this,"visibleRowsMap",void 0),D(this,"rowLevelPadding",void 0),D(this,"rowsMap",void 0),D(this,"rowHeight",void 0),D(this,"rowWidth",void 0),D(this,"rowInsets",void 0),D(this,"rowMargins",void 0),D(this,"rowIconVisible",void 0),D(this,"rowIconColumnWidth",void 0),D(this,"staticMenus",void 0),D(this,"selectionHandler",void 0),D(this,"tooltips",void 0),D(this,"tableNodeColumn",void 0),D(this,"updateBuffer",void 0),D(this,"viewRangeSize",void 0),D(this,"viewRangeDirty",void 0),D(this,"viewRangeRendered",void 0),D(this,"virtual",void 0),D(this,"textFilterEnabled",void 0),D(this,"filterSupport",void 0),D(this,"filteredElementsDirty",void 0),D(this,"$data",void 0),D(this,"$emptyData",void 0),D(this,"$fillBefore",void 0),D(this,"$fillAfter",void 0),D(this,"_renderViewportBlocked",void 0),D(this,"_filterMenusHandler",void 0),D(this,"_aggregateRows",void 0),D(this,"_filteredRows",void 0),D(this,"_maxLevel",void 0),D(this,"_animationRowLimit",void 0),D(this,"_blockLoadThreshold",void 0),D(this,"_doubleClickSupport",void 0),D(this,"_permanentHeadSortColumns",void 0),D(this,"_permanentTailSortColumns",void 0),D(this,"_popupOpenHandler",void 0),D(this,"_rerenderViewPortAfterAttach",void 0),D(this,"_renderViewPortAfterAttach",void 0),D(this,"_triggerRowsSelectedPending",void 0),D(this,"_animateAggregateRows",void 0),D(this,"_postAttachActions",void 0),D(this,"_desktopPropertyChangeHandler",void 0),D(this,"_imageLoadListener",void 0),D(this,"_insertedRows",void 0),D(this,"_$mouseDownRow",void 0),D(this,"_mouseDownRowId",void 0),D(this,"_mouseDownColumn",void 0),this.autoResizeColumns=!1,this.columnAddable=!1,this.columnLayoutDirty=!1,this.columns=[],this.contextColumn=null,this.checkable=!1,this.checkableStyle=V.CheckableStyle.CHECKBOX,this.cellEditorPopup=null,this.compact=!1,this.compactHandler=u.create(yu,{table:this}),this.compactColumn=null,this.dropType=0,this.dropMaximumSize=Fe.DEFAULT_DROP_MAXIMUM_SIZE,this.groupingStyle=V.GroupingStyle.TOP,this.header=null,this.headerEnabled=!0,this.headerVisible=!0,this.headerMenusEnabled=!0,this.hasReloadHandler=!1,this.hierarchical=!1,this.hierarchicalStyle=V.HierarchicalStyle.DEFAULT,this.keyStrokes=[],this.menus=[],this.menuBar=null,this.menuBarVisible=!0,this.contextMenu=null,this.multiCheck=!0,this.multiSelect=!0,this.multilineText=!1,this.scrollToSelection=!1,this.scrollTop=0,this.selectedRows=[],this.sortEnabled=!0,this.tableControls=[],this.tableStatusVisible=!1,this.tableTileGridMediator=null,this.tileMode=!1,this.tileTableHeader=null,this.tileProducer=null,this.footer=null,this.footerVisible=!1,this.filters=[],this.rows=[],this.rootRows=[],this.visibleRows=[],this.estimatedRowCount=0,this.maxRowCount=0,this.truncatedCellTooltipEnabled=null,this.visibleRowsMap={},this.rowLevelPadding=0,this.rowsMap={},this.rowHeight=0,this.rowWidth=0,this.rowInsets=new Ge,this.rowMargins=new Ge,this.rowIconVisible=!1,this.rowIconColumnWidth=De.NARROW_MIN_WIDTH,this.staticMenus=[],this.selectionHandler=new Cu(this),this.tooltips=[],this._filteredRows=[],this.tableNodeColumn=null,this._maxLevel=0,this._aggregateRows=[],this._animationRowLimit=25,this._blockLoadThreshold=25,this.updateBuffer=new Fu(this),this.viewRangeSize=10,this.viewRangeDirty=!1,this.viewRangeRendered=new B(0,0),this.virtual=!0,this.textFilterEnabled=!0,this.filterSupport=this._createFilterSupport(),this.filteredElementsDirty=!1,this._doubleClickSupport=new Vr,this._permanentHeadSortColumns=[],this._permanentTailSortColumns=[],this._filterMenusHandler=this._filterMenus.bind(this),this._popupOpenHandler=this._onDesktopPopupOpen.bind(this),this._rerenderViewPortAfterAttach=!1,this._renderViewPortAfterAttach=!1,this._postAttachActions=[],this._desktopPropertyChangeHandler=this._onDesktopPropertyChange.bind(this),this._addWidgetProperties(["tableControls","menus","keyStrokes","staticMenus","tileTableHeader","tableTileGridMediator"]),this.$data=null,this.$emptyData=null,this.$fillBefore=null,this.$fillAfter=null}_init(e){super._init(e),this.resolveConsts([{property:"hierarchicalStyle",constType:V.HierarchicalStyle},{property:"checkableStyle",constType:V.CheckableStyle},{property:"groupingStyle",constType:V.GroupingStyle}]),this._initColumns(),this.rows.forEach((t,s)=>{this.rows[s]=this._initRow(t)}),this.setFilters(this.filters),this._updateRowStructure({updateTree:!0}),this.menuBar=this._createMenuBar(),this.menuBar.on("propertyChange:visible",()=>this._refreshMenuBarClasses()),this._setSelectedRows(this.selectedRows),this._setKeyStrokes(this.keyStrokes),this._setMenus(this.menus),this._setTableControls(this.tableControls),this._setTableStatus(this.tableStatus),this._calculateValuesForBackgroundEffect(),this._setTileMode(this.tileMode),this._setTileTableHeader(this.tileTableHeader),this._sortWhileInit()}_initRow(e){let t;return e instanceof Xt?t=e:t=this._createRow(e),this.rowsMap[t.id]=t,this.trigger("rowInit",{row:t}),t}_createRow(e){let t=e||{};return t.objectType=u.nvl(t.objectType,Xt),t.parent=this,u.create(t)}_initColumns(){let e=this.columns;this.columns=e.map((t,s)=>{let r,n=t;return n.session=this.session,n instanceof De?(r=n,r._setTable(this)):(n.table=this,r=u.create(n)),r.index<0&&(r.index=s),r.checkable&&(this.checkableColumn=r),r}),this._setCheckable(this.checkable),this.rowIconVisible&&this._insertRowIconColumn(),this._setCompact(this.compact),this._calculateTableNodeColumn(),this._setHeadAndTailSortColumns(),this.columnLayoutDirty=!0}_destroy(){this._destroyColumns(),super._destroy()}_destroyColumns(){this.columns.forEach(e=>e.destroy()),this.checkableColumn=null,this.compactColumn=null,this.rowIconColumn=null,this.columns=[]}_calculateTableNodeColumn(){let e=this.visibleColumns().filter(s=>s.nodeColumnCandidate),t=p.first(e);this.tableNodeColumn&&this.tableNodeColumn!==t&&(this.tableNodeColumn.minWidth=this.tableNodeColumn.__initialMinWidth),this.tableNodeColumn=t,this.tableNodeColumn&&(this.tableNodeColumn.__initialMinWidth=this.tableNodeColumn.minWidth,this.tableNodeColumn.minWidth=this.rowLevelPadding*this._maxLevel+this.tableNodeColumn.tableNodeLevel0CellPadding+8,this.tableNodeColumn.minWidth>this.tableNodeColumn.width&&(this._isDataRendered()?this.resizeColumn(this.tableNodeColumn,this.tableNodeColumn.minWidth):this.tableNodeColumn.width=this.tableNodeColumn.minWidth))}_createLoadingSupport(){return new ss({widget:this,$container:()=>this.$container.hasClass("knight-rider-loading")?this.$container:this.$data})}_createKeyStrokeContext(){return new Oe}_initKeyStrokeContext(){super._initKeyStrokeContext(),this._initTableKeyStrokeContext()}_initTableKeyStrokeContext(){this.keyStrokeContext.registerKeyStrokes([new ec(this),new tc(this),new rc(this),new nc(this),new ic(this),new sc(this),new Yu(this),new ju(this),new Ju(this),new Xu(this),new Qu(this),new Zu(this),new qu(this),new ia(this,this.showContextMenu,this),new po(this,this.handleAppLinkAction)])}_insertBooleanColumn(){if(this.checkableStyle===V.CheckableStyle.TABLE_ROW)return;let e=u.create(cn,{session:this.session,fixedWidth:!0,fixedPosition:!0,guiOnly:!0,nodeColumnCandidate:!1,headerMenuEnabled:!1,showSeparator:!1,width:De.NARROW_MIN_WIDTH,table:this});p.insert(this.columns,e,0),this.checkableColumn=e}_insertRowIconColumn(){let e=0,t=u.create(Ra,{session:this.session,fixedWidth:!0,fixedPosition:!0,guiOnly:!0,nodeColumnCandidate:!1,headerMenuEnabled:!1,showSeparator:!1,width:this.rowIconColumnWidth,table:this});this.columns[0]===this.checkableColumn&&(e=1),p.insert(this.columns,t,e),this.rowIconColumn=t}handleAppLinkAction(e){let t=a()(e.target),s=this._columnAtX(t.offset().left),r=t.findUp(n=>n.hasClass("table-row"),this.$container).data("row");this._triggerAppLinkAction(s,r,t.data("ref"),t)}_isDataRendered(){return this.rendered&&this.$data!==null}_render(){this.$container=this.$parent.appendDiv("table").addDeviceClass(),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new Tu(this)),this.uiCssClass&&this.$container.addClass(this.uiCssClass),this.tileMode?this._renderTileMode():this._renderData(),this.session.desktop.on("popupOpen",this._popupOpenHandler),this.session.desktop.on("propertyChange",this._desktopPropertyChangeHandler)}_renderData(){this.$data=this.$container.appendDiv("table-data"),this.$data.on("mousedown",".table-row",this._onRowMouseDown.bind(this)).on("mouseup",".table-row",this._onRowMouseUp.bind(this)).on("dblclick",".table-row",this._onRowDoubleClick.bind(this)).on("contextmenu",e=>e.preventDefault()),this._installScrollbars({axis:"both"}),this._installImageListeners(),this._installCellTooltipSupport(),this._calculateRowInsets(),this._updateRowWidth(),this._updateRowHeight(),this._renderViewport(),this.scrollToSelection&&this.revealSelection()}_renderProperties(){super._renderProperties(),this._renderTableHeader(),this._renderMenuBarVisible(),this._renderFooterVisible(),this._renderCheckableStyle(),this._renderHierarchicalStyle(),this._renderTextFilterEnabled()}_setCssClass(e){super._setCssClass(e);let t=["table-row-level-padding"];this.cssClass&&t.push(this.cssClass);let s=t.reduce((r,n)=>r+" "+n,"");this.setRowLevelPadding(M.getSize(s,"width","width",15))}_removeData(){this._removeAggregateRows(),this._uninstallImageListeners(),this._uninstallCellTooltipSupport(),this._uninstallScrollbars(),this._removeRows(),this.$fillBefore=null,this.$fillAfter=null,this.$data.remove(),this.$data=null,this.$emptyData=null}_remove(){this.session.desktop.off("propertyChange",this._desktopPropertyChangeHandler),this.session.desktop.off("popupOpen",this._popupOpenHandler),Fe.uninstallDragAndDropHandler(this),this.header=null,this.$data&&this._removeData(),this.filterSupport.remove(),super._remove()}setRowLevelPadding(e){this.setProperty("rowLevelPadding",e)}_renderRowLevelPadding(){this._rerenderViewport()}setTableControls(e){this.setProperty("tableControls",e)}_renderTableControls(){this.footer&&this.footer._renderControls()}_setTableControls(e){let t;for(t=0;t<this.tableControls.length;t++)this.keyStrokeContext.unregisterKeyStroke(this.tableControls[t]);for(this._setProperty("tableControls",e),t=0;t<this.tableControls.length;t++)this.keyStrokeContext.registerKeyStroke(this.tableControls[t]);this._updateFooterVisibility(),this.tableControls.forEach(s=>{s.tableFooter=this.footer})}_onImageLoadOrError(e){let t=a()(e.target);if(t.data("measure")==="in-progress")return;t.toggleClass("broken",e.type==="error");let s=t.closest(".table-row"),r=s.data("row");if(!r)return;let n=r.height;r.height=this._measureRowHeight(s),n!==r.height&&this.invalidateLayoutTree()}_onRowMouseDown(e){this._doubleClickSupport.mousedown(e),this._$mouseDownRow=a()(e.currentTarget),this._mouseDownRowId=this._$mouseDownRow.data("row").id,this._mouseDownColumn=this._columnAtX(e.pageX),this._$mouseDownRow.window().one("mouseup",()=>{this._$mouseDownRow=null,this._mouseDownRowId=null,this._mouseDownColumn=null}),this.setContextColumn(this._columnAtX(e.pageX)),this.selectionHandler.onMouseDown(e);let t=e.which===3,s=this._$mouseDownRow.data("row"),r=a()(e.target);if(this._isRowControl(r)&&(s.expanded?this.collapseRow(s):this.expandRow(s)),u.isOneOf(this.checkableStyle,V.CheckableStyle.TABLE_ROW,V.CheckableStyle.CHECKBOX_TABLE_ROW)&&(!t||!s.checked)&&!a()(e.target).is(".table-row-control")&&!(r.hasClass("checkable")||r.parent().hasClass("checkable"))&&this.checkRow(s,!s.checked),t)return this.showContextMenu({pageX:e.pageX,pageY:e.pageY}),!1}_isRowControl(e){return e.hasClass("table-row-control")||e.parent().hasClass("table-row-control")}_onRowMouseUp(e){let t,s=e.which;if(this._doubleClickSupport.doubleClicked())return;let r=a()(e.currentTarget);if(this.selectionHandler.onMouseUp(e),!this._$mouseDownRow||this._mouseDownRowId!==r.data("row").id)return;let n=r,o=this._columnAtX(e.pageX);if(o!==this._mouseDownColumn)return;let l=a()(e.target);if(this._isRowControl(l))return;let h=n.data("row");s===1&&(o.onMouseUp(e,n),t=this._find$AppLink(e)),t?this._triggerAppLinkAction(o,h,t.data("ref"),t):this._triggerRowClick(e,h,s,o)}_onRowDoubleClick(e){let t=a()(e.currentTarget),s=this._columnAtX(e.pageX);this.doRowAction(t.data("row"),s)}showContextMenu(e){this.session.onRequestsDone(this._showContextMenu.bind(this,e))}_showContextMenu(e){if(e=e||{},!this._isDataRendered()||!this.attached||this.selectedRows.length===0)return;let t=this._filterMenusForContextMenu();if(t.length===0)return;let s=u.nvl(e.pageX,null),r=u.nvl(e.pageY,null);if(s===null||r===null){let n=this.isRowSelectedAndVisible(this.selectionHandler.lastActionRow)?this.selectionHandler.lastActionRow:this.getLastSelectedAndVisibleRow();if(n!==null){let o=n.$row,l=o.offset(),h=v.offsetBounds(this.$data);l.left+=this.$data.scrollLeft(),s=l.left+10,r=l.top+o.outerHeight()/2,r=Math.min(Math.max(r,h.y+1),h.bottom()-1)}else s=this.$data.offset().left+10,r=this.$data.offset().top+10}this.contextMenu&&this.contextMenu.close(),this.contextMenu=u.create(ft,{parent:this,menuItems:t,location:{x:s,y:r},$anchor:this.$data,menuFilter:this._filterMenusHandler}),this.contextMenu.open()}isRowSelectedAndVisible(e){return!this.isRowSelected(e)||!e.$row?!1:v.offsetBounds(e.$row).intersects(v.offsetBounds(this.$data))}getLastSelectedAndVisibleRow(){for(let e=this.viewRangeRendered.to;e>=this.viewRangeRendered.from;e--)if(this.isRowSelectedAndVisible(this.rows[e]))return this.rows[e];return null}onColumnVisibilityChanged(){this.columnLayoutDirty=!0,this._calculateTableNodeColumn(),this.trigger("columnStructureChanged"),this._isDataRendered()&&(this._updateRowWidth(),this.redraw())}_onScroll(e){let t=this.$data[0].scrollTop,s=this.$data[0].scrollLeft;this.scrollTop!==t&&this._renderViewport(),this.scrollTop=t,this.scrollLeft=s}_renderTableStatus(){this.trigger("statusChanged")}setContextColumn(e){this.setProperty("contextColumn",e)}_hasVisibleTableControls(){return this.tableControls.some(e=>e.visible)}hasAggregateTableControl(){return this.tableControls.some(e=>e instanceof Vs)}_createHeader(){return u.create(wu,{parent:this,table:this,enabled:this.headerEnabled,headerMenusEnabled:this.headerMenusEnabled})}_createFooter(){return u.create(bu,{parent:this,table:this})}_installCellTooltipSupport(){K.install(this.$data,{parent:this,selector:".table-cell",text:this._cellTooltipText.bind(this),htmlEnabled:this._isAggregatedTooltip.bind(this),arrowPosition:50,arrowPositionUnit:"%",nativeTooltip:!x.get().isCustomEllipsisTooltipPossible()})}_uninstallCellTooltipSupport(){K.uninstall(this.$data)}_cellTooltipText(e){let t,s=e.parent(),r=this.columnFor$Cell(e,s),n=s.data("row");if(n&&(t=this.cell(r,n).tooltipText),t)return t;if(this._isAggregatedTooltip(e)&&e.text().trim()){let o=e.children(".text"),l=e.children(".table-cell-icon"),h=l.length&&!l.isVisible();if(o.length&&o.isContentTruncated()||h){let d=e.clone();if(d.children(".table-cell-icon").setVisible(!0),e.css("direction")==="rtl"){let c=d.children().get().map(f=>f.outerHTML).reverse();return y.join("",...c)}return d.html()}}if(this._isTruncatedCellTooltipEnabled(r)&&e.isContentTruncated())return y.plainText(e.html(),{trim:!0,removeFontIcons:!0})}setTruncatedCellTooltipEnabled(e){this.setProperty("truncatedCellTooltipEnabled",e)}_isTruncatedCellTooltipEnabled(e){return this.truncatedCellTooltipEnabled===null?!this.headerVisible||!this.headerEnabled||e.fixedWidth:this.truncatedCellTooltipEnabled}_isAggregatedTooltip(e){let t=e.parent();return t.data("aggregateRow")||t.hasClass("table-aggregate")}reload(e){!this.hasReloadHandler||(this._removeRows(),this._isDataRendered()&&(this._removeAggregateRows(),this._renderFiller()),this._triggerReload(e))}setLoading(e){!e&&this.updateBuffer.isBuffering()||super.setLoading(e)}exportToClipboard(){this._triggerClipboardExport()}_exportToClipboard(){rs.copyText({parent:this,text:this._selectedRowsToText()})}_selectedRowsToText(){let e=this.visibleColumns();return this.selectedRows.map(t=>e.map(s=>{let r=s.cell(t),n;return s instanceof cn?n=r.value?"X":"":r.htmlEnabled?n=y.plainText(r.text):n=r.text,this._unwrapText(n)}).join("	")).join(`
`)}_unwrapText(e){return y.nvl(e).split(/[\n\r]/).map(t=>t.replace(/\t/g," ")).map(t=>t.trim()).filter(t=>!!t.length).join(" ")}setMultiSelect(e){this.setProperty("multiSelect",e)}toggleSelection(){this.selectedRows.length===this.visibleRows.length?this.deselectAll():this.selectAll()}selectAll(){this.selectRows(this.visibleRows)}deselectAll(){this.selectRows([])}checkAll(e,t){let s=a().extend(t,{checked:e});this.checkRows(this.visibleRows,s)}uncheckAll(e){this.checkAll(!1,e)}updateScrollbars(){P.update(this.$data)}_sort(e){let t=this._sortColumns();return this._isSortingPossible(t)?(this.clearAggregateRows(e),t.length&&(t=p.union(t,this.columns),this._sortImpl(t),this._triggerRowOrderChanged(),this._isDataRendered()&&this._renderRowOrderChanges(),this._group(e)),!0):!1}_isSortingPossible(e){return e.every(t=>t.isSortingPossible())}_sortColumns(){let e=[];for(let t=0;t<this.columns.length;t++){let s=this.columns[t],r=s.sortIndex;r>=0&&(e[r]=s)}return e}_sortImpl(e){let t=(s,r)=>{for(let n=0;n<e.length;n++){let o=e[n],l=o.compare(s,r);if(o.sortActive&&!o.sortAscending&&(l=-l),l!==0)return l}return 0};if(this.hierarchical){this._sortHierarchical(t);let s=[];this.visitRows(r=>s.push(r)),this.rows=s}else this.rows.sort(t),this.rootRows=this.rows;this._updateRowStructure({filteredRows:!0,applyFilters:!1,visibleRows:!0})}visitRows(e,t,s){s=u.nvl(s,0),t=t||this.rootRows,t.forEach(r=>{e(r,s),this.visitRows(e,r.childRows,s+1)})}_sortHierarchical(e,t){t=t||this.rootRows,t.sort(e),t.forEach(s=>this._sortHierarchical(e,s.childRows))}_renderRowOrderChanges(){let e,t=this.$rows(),s={};t.length===this.visibleRows.length&&t.each((r,n)=>{let o=!1,l=a()(n),h=l.data("row");if(this._insertedRows){for(let d=0;d<this._insertedRows.length;d++)if(this._insertedRows[d].id===h.id){o=!0;break}}o||(e=!0,s[h.id]=l.offset().top)}),this._rerenderViewport(),this._order$AggregateRows(),this.scrollToSelection&&this.revealSelection(),e&&(t=this.$rows(),t.each((r,n)=>{let o=a()(n),l=o.data("row"),h=s[l.id];h!==void 0&&o.css("top",h-o.offset().top).animate({top:0},{progress:function(){this._triggerRowOrderChanged(l,!0),this.updateScrollbars()}.bind(this)})}))}setSortEnabled(e){this.setProperty("sortEnabled",e)}sort(e,t,s,r){s=u.nvl(s,!1),r=u.nvl(r,!1);let n=!s;r?this._removeSortColumn(e):this._addSortColumn(e,t,s),this.header&&this.header.onSortingChanged();let o=this._sort(n),l={column:e,sortAscending:e.sortAscending};r&&(l.sortingRemoved=!0),s&&(l.multiSort=!0),o||(l.sortingRequested=!0,this._animateAggregateRows=n),this.trigger("sort",l)}_addSortColumn(e,t,s){if(t=u.nvl(t,e.sortAscending?"asc":"desc"),s=u.nvl(s,!0),this._updateSortIndexForColumn(e,s),!s){let r=this._groupedColumns().length;this._sortColumns().length===1&&r===1||(e.grouped=!1)}e.sortAscending=t==="asc",e.sortActive=!0}_updateSortIndexForColumn(e,t){let s=-1;if(t)(!e.sortActive||e.sortIndex===-1)&&(s=Math.max(-1,p.max(this.columns.map(r=>r.sortIndex===void 0||r.initialAlwaysIncludeSortAtEnd?-1:r.sortIndex))),e.sortIndex=s+1,this._permanentTailSortColumns.forEach(r=>{r.sortIndex++}));else{e.initialAlwaysIncludeSortAtBegin||e.initialAlwaysIncludeSortAtEnd||(e.sortIndex=this._permanentHeadSortColumns.length),p.eachSibling(this.columns,e,n=>{n.sortActive&&this._removeSortColumnInternal(n)});let r=e.initialAlwaysIncludeSortAtBegin||e.initialAlwaysIncludeSortAtEnd?0:1;this._permanentTailSortColumns.forEach((n,o)=>{n.sortIndex=this._permanentHeadSortColumns.length+r+o})}}_removeSortColumn(e){e.initialAlwaysIncludeSortAtBegin||e.initialAlwaysIncludeSortAtEnd||(p.eachSibling(this.columns,e,t=>{t.sortIndex>e.sortIndex&&(t.sortIndex=t.sortIndex-1)}),this._removeSortColumnInternal(e))}_removeSortColumnInternal(e){e.initialAlwaysIncludeSortAtBegin||e.initialAlwaysIncludeSortAtEnd||(e.sortActive=!1,e.grouped=!1,e.sortIndex=-1)}isGroupingPossible(e){let t=!0;return this.hierarchical||!this.sortEnabled?!1:this._permanentHeadSortColumns&&this._permanentHeadSortColumns.length===0?!0:e.initialAlwaysIncludeSortAtBegin?(t=!0,p.eachSibling(this._permanentHeadSortColumns,e,s=>{s.sortIndex<e.sortIndex&&(t=t&&s.grouped)}),t):e.initialAlwaysIncludeSortAtEnd?!1:(this._permanentHeadSortColumns.forEach(s=>{t=t&&s.grouped}),t)}isAggregationPossible(e){return!(e instanceof Bi)||e.grouped||!e.allowedAggregationFunctions||e.allowedAggregationFunctions.length<=1?!1:this.isGrouped()||this.hasAggregateTableControl()}changeAggregation(e,t){this.changeAggregations([e],[t])}changeAggregations(e,t){e.forEach((s,r)=>{let n=t[r];s.aggregationFunction!==n&&(s.setAggregationFunction(n),this._triggerAggregationFunctionChanged(s))}),this._group()}_addGroupColumn(e,t,s){let r=-1;!this.isGroupingPossible(e)||(t=u.nvl(t,e.sortAscending?"asc":"desc"),s=u.nvl(s,!0),e.initialAlwaysIncludeSortAtBegin||e.initialAlwaysIncludeSortAtEnd?e.initialAlwaysIncludeSortAtBegin&&(e.grouped=!0):(s?(r=Math.max(-1,p.max(this.columns.map(n=>n.sortIndex===void 0||n.initialAlwaysIncludeSortAtEnd||!n.grouped?-1:n.sortIndex))),e.sortActive?(p.eachSibling(this.columns,e,n=>{n.sortActive&&!(n.initialAlwaysIncludeSortAtBegin||n.initialAlwaysIncludeSortAtEnd)&&n.sortIndex>r&&n.sortIndex<e.sortIndex&&n.sortIndex++}),e.sortIndex=r+1):(e.sortIndex=r+1,p.eachSibling(this.columns,e,n=>{n.sortActive&&!(n.initialAlwaysIncludeSortAtBegin||n.initialAlwaysIncludeSortAtEnd)&&n.sortIndex>r&&n.sortIndex++}),this._permanentTailSortColumns.forEach(n=>{n.sortIndex++}))):(r=this._permanentHeadSortColumns.length,e.sortActive?(p.eachSibling(this.columns,e,n=>{n.sortActive&&!(n.initialAlwaysIncludeSortAtBegin||n.initialAlwaysIncludeSortAtEnd)&&n.sortIndex>=r&&n.sortIndex<e.sortIndex&&n.sortIndex++}),e.sortIndex=r):(p.eachSibling(this.columns,e,n=>{n.sortActive&&!(n.initialAlwaysIncludeSortAtBegin||n.initialAlwaysIncludeSortAtEnd)&&n.sortIndex>=r&&n.sortIndex++}),e.sortIndex=r,this._permanentTailSortColumns.forEach(n=>{n.sortIndex++})),p.eachSibling(this.columns,e,n=>{n.sortActive&&!(n.initialAlwaysIncludeSortAtBegin||n.initialAlwaysIncludeSortAtEnd)&&n.sortIndex>=r&&(n.grouped=!1)})),e.sortAscending=t==="asc",e.sortActive=!0),e.grouped=!0)}_removeGroupColumn(e){e.grouped=!1,e.initialAlwaysIncludeSortAtBegin&&this.columns.forEach(t=>{t.sortIndex>=e.sortIndex&&(t.grouped=!1)}),this._removeSortColumn(e)}_buildRowDiv(e){let t=this.rowWidth,s="table-row";e.cssClass&&(s+=" "+e.cssClass),e.enabled||(s+=" disabled"),e.checked&&this.checkableStyle===V.CheckableStyle.TABLE_ROW&&(s+=" checked"),e.filterAccepted||(s+=" filter-not-accepted"),p.empty(e.childRows)&&(s+=" leaf");let r='<div class="'+s+'" style="width: '+t+'px">';for(let n=0;n<this.columns.length;n++){let o=this.columns[n];o.isVisible()&&(r+=o.buildCellForRow(e))}return r+="</div>",r}_calculateRowInsets(){let e=this.$data.appendDiv("table-row");this.rowMargins=v.margins(e),this.rowBorders=v.borders(e),e.remove()}_updateRowWidth(){this.rowWidth=this.visibleColumns().reduce((e,t)=>this.autoResizeColumns?e+t.width:e+t.realWidthIfAvailable(),this.rowBorders.horizontal())}_updateRealColumnWidths(e){if(!x.get().hasTableCellZoomBug())return!1;let t=!1;return e=e||this.$rows().eq(0),this.visibleColumns().forEach((s,r)=>{this._updateRealColumnWidth(s,r,e)&&(t=!0)}),t}_updateRealColumnWidth(e,t,s){if(!x.get().hasTableCellZoomBug())return!1;s=s||this.$rows().eq(0);let r=this.$cell(u.nvl(t,e),s);if(r.length===0&&e._realWidth!==null)return e._realWidth=null,!0;let n=v.size(r,{exact:!0}).width;return n!==e._realWidth?(e._realWidth=n,!0):!1}_updateRowHeight(){let e=this.$data.appendDiv("table-row"),t=this._build$AggregateRow().appendTo(this.$data);e.appendDiv("table-cell").html("&nbsp;"),t.appendDiv("table-cell table-aggregate-cell").appendSpan("text").html("&nbsp;"),this.rowHeight=this._measureRowHeight(e),this.aggregateRowHeight=this._measureRowHeight(t),e.remove(),t.remove()}_updateRowHeights(){this.rows.forEach(e=>{e.$row?e.height=this._measureRowHeight(e.$row):e.height=null}),this._aggregateRows.forEach(e=>{e.$row?e.height=this._measureRowHeight(e.$row):e.height=null})}_renderRowsInRange(e){let t="",s=0,r=!1,n=this.visibleRows;if(n.length===0)return;if(e=new B(0,this.rows.length).intersect(e),this.viewRangeRendered.size()>0&&!e.intersect(this.viewRangeRendered).equals(new B(0,0)))throw new Error("New range must not intersect with existing.");e.to<=this.viewRangeRendered.from&&(r=!0);let l=this.viewRangeRendered.union(e);if(l.length===2)throw new Error("Can only prepend or append rows to the existing range. Existing: "+this.viewRangeRendered+". New: "+l);this.viewRangeRendered=l[0],this._removeEmptyData();for(let d=e.from;d<e.to;d++){let c=n[d];t+=this._buildRowDiv(c),s++}let h=this.$data.makeElement(t);r?this.$fillBefore?h=h.insertAfter(this.$fillBefore):h=h.prependTo(this.$data):this.$fillAfter?h=h.insertBefore(this.$fillAfter):h=h.appendTo(this.$data),h.each((d,c)=>{let f=a()(c);this.viewRangeRendered.size()===s&&this._updateRealColumnWidths(f)&&(this._updateRowWidth(),this.header&&this.header.rendered&&this.header.resizeHeaderItems()),f.cssWidth(this.rowWidth);let m=n[e.from+d];V.linkRowToDiv(m,f),this._installRow(m)}),a().log.isTraceEnabled()&&(a().log.trace(s+" new rows rendered from "+e),a().log.trace(this._rowsRenderedInfo()))}_rowsRenderedInfo(){let e=this.$rows().length,t="("+this.viewRangeRendered+")";return e+" rows rendered "+t}moveRowToTop(e){let t=this.rows.indexOf(e);this.moveRow(t,0)}moveRowToBottom(e){let t=this.rows.indexOf(e);this.moveRow(t,this.rows.length-1)}moveRowUp(e){let t=this.rows.indexOf(e),s=t-1;if(this.hierarchical){let r=this.rows.filter(l=>e.parentRow===l.parentRow),n=r.indexOf(e),o=r[n-1];o?s=this.rows.indexOf(o):s=0}this.moveRow(t,s)}moveRowDown(e){let t=this.rows.indexOf(e),s=t+1;if(this.hierarchical){let r=this.rows.filter(l=>e.parentRow===l.parentRow),n=r.indexOf(e),o=r[n+1];o?s=this.rows.indexOf(o):s=this.rows.length}this.moveRow(t,s)}moveVisibleRowUp(e){let t=this.rows.indexOf(e),s=this.visibleRows.indexOf(e),r,n;if(this.hierarchical){let o=this.visibleRows.filter(l=>e.parentRow===l.parentRow);if(r=o[o.indexOf(e)-1],r)n=this.rows.indexOf(r);else return}else{if(r=this.visibleRows[s-1],!r)return;n=this.rows.indexOf(r)}this.moveRow(t,n)}moveVisibleRowDown(e){let t=this.rows.indexOf(e),s=this.visibleRows.indexOf(e),r,n;if(this.hierarchical){let o=this.visibleRows.filter(l=>e.parentRow===l.parentRow);if(r=o[o.indexOf(e)+1],r)n=this.rows.indexOf(r);else return}else{if(r=this.visibleRows[s+1],!r)return;n=this.rows.indexOf(r)}this.moveRow(t,n)}moveRow(e,t){let s=this.rows.length;e=Math.max(e,0),e=Math.min(e,s-1),t=Math.max(t,0),t=Math.min(t,s-1),e!==t&&(p.move(this.rows,e,t),this.updateRowOrder(this.rows))}_removeRowsInRange(e){let t=0,s=this.visibleRows;e=new B(0,s.length).intersect(e);let n=this.viewRangeRendered.subtract(e);if(n.length===2)throw new Error("Can only remove rows at the beginning or end of the existing range. "+this.viewRangeRendered+". New: "+n);this.viewRangeRendered=n[0];for(let o=e.from;o<e.to;o++){let l=s[o];this._removeRow(l),t++}a().log.isTraceEnabled()&&(a().log.trace(t+" rows removed from "+e+"."),a().log.trace(this._rowsRenderedInfo()))}removeAllRows(){this._isDataRendered()&&this.$rows().each((e,t)=>{let s=a()(t),r=s.data("row");s.hasClass("hiding")||this._removeRow(r)}),this.viewRangeRendered=new B(0,0)}_removeRows(e){if(!e){this.removeAllRows();return}let t=this.isAttachedAndRendered();e=p.ensure(e),e.forEach(s=>{let r=this.visibleRows.indexOf(s);if(r===-1)return;let n=Boolean(s.$row),o=this.viewRangeRendered.contains(r);if(t){if(!n&&o)throw new Error("Inconsistency found while removing row. Row is undefined but inside rendered view range. RowIndex: "+r);if(n&&!o)throw new Error("Inconsistency found while removing row. Row is rendered but not inside rendered view range. RowIndex: "+r)}this._removeRow(s),(o||r<this.viewRangeRendered.from)&&(r<this.viewRangeRendered.from?(this.viewRangeRendered.from--,this.viewRangeRendered.to--):r<=this.viewRangeRendered.to&&this.viewRangeRendered.to--)})}_removeRow(e){let t=e.$row;!t||(this._destroyTooltipsForRow(e),this._destroyCellEditorForRow(e),t.hasClass("hiding")||(t.remove(),e.$row=null))}_showRow(e){let t=e.$row;!t||t.is(".showing")||(t.hide(),t.addClass("showing"),t.removeClass("hiding"),t.stop().slideDown({duration:250,complete:()=>{t.removeClass("showing"),this.updateScrollbars()}}))}_hideRow(e){let t=e.$row;!t||t.is(".hiding")||(t.addClass("hiding"),t.removeClass("showing"),t.stop().slideUp({duration:250,complete:()=>{!e.$row||(t.remove(),t[0]===e.$row[0]&&(e.$row=null),this.updateScrollbars())}}))}_installRow(e){if(e.height=this._measureRowHeight(e.$row),e.hasError&&this._showCellErrorForRow(e),this.cellEditorPopup&&!this.cellEditorPopup.rendered&&this.cellEditorPopup.row.id===e.id){let t=this.cellEditorPopup.cell.field;this.startCellEdit(this.cellEditorPopup.column,e,t)}}_calcRowLevelPadding(e){return e?this._calcRowLevelPadding(e.parentRow)+this.rowLevelPadding:-this.rowLevelPadding}_showCellErrorForRow(e){let t=this.$cellsForRow(e.$row),s=this;t.each(function(r){let n=a()(this),o=s.cellByCellIndex(r,e);o.errorStatus&&s._showCellError(e,n,o.errorStatus)})}_showCellError(e,t,s){let r=s.message,n=u.create(xu,{parent:this,text:r,autoRemove:!1,$anchor:t,table:this});n.render(),n.row=e,this.tooltips.push(n)}_columnAtX(e){let t=0,s=this.$data.offset().left+this.rowBorders.left+this.rowMargins.left,r=this.$data.scrollLeft();if(e<s)return this.columns[0];s-=r;let n=this.visibleColumns(),o=p.find(n,l=>{if(t=s+l.width,e>=s&&e<t)return!0;s=t});return o||(o=n[n.length-1]),o}_find$AppLink(e){let t=a()(e.target),s=a()(e.delegateTarget),r=t.findUp(n=>n.hasClass("app-link"),s);return r.length>0?r:null}_filterMenus(e,t,s,r,n){return We.filterAccordingToSelection("Table",this.selectedRows.length,e,t,{onlyVisible:s,enableDisableKeyStrokes:r,notAllowedTypes:n})}_filterMenusForContextMenu(){return this._filterMenus(this.menus,It.CONTEXT_MENU,!0,!1,["Header"])}setStaticMenus(e){this.setProperty("staticMenus",e),this._updateMenuBar()}_removeMenus(){}notifyRowSelectionFinished(){this._triggerRowsSelectedPending&&(this._triggerRowsSelected(),this._triggerRowsSelectedPending=!1),this.session.onRequestsDone(this._updateMenuBar.bind(this))}_triggerRowClick(e,t,s,r){this.trigger("rowClick",{originalEvent:e,row:t,mouseButton:s,column:r})}_triggerRowAction(e,t){this.trigger("rowAction",{row:e,column:t})}focusCell(e,t){let s=this.cell(e,t);this.enabledComputed&&t.enabled&&s.editable&&this.prepareCellEdit(e,t)}prepareCellEdit(e,t,s){let r=a().resolvedPromise();return this.cellEditorPopup&&(r=this.cellEditorPopup.waitForCompleteCellEdit()),r.then(this.prepareCellEditInternal.bind(this,e,t,s))}prepareCellEditInternal(e,t,s){if(this.openFieldPopupOnCellEdit=u.nvl(s,!1),!this.trigger("prepareCellEdit",{column:e,row:t}).defaultPrevented){this.selectRow(t);let n=e.createEditor(t);this.startCellEdit(e,t,n)}}cell(e,t){return e===this.rowIconColumn?u.create(Pt,{iconId:t.iconId,cssClass:y.join(" ","row-icon-cell",t.cssClass)}):e===this.checkableColumn?u.create(Pt,{value:t.checked,editable:!0,cssClass:t.cssClass}):e===this.compactColumn?u.create(Pt,{text:t.compactValue,htmlEnabled:!0}):t.cells[e.index]}cellByCellIndex(e,t){return this.cell(this.columns[e],t)}cellValue(e,t){let s=this.cell(e,t);return s&&(s.value!==void 0?s.value:"")}cellText(e,t){let s=this.cell(e,t);return s&&s.text||""}nextEditableCellPos(e,t,s){let r=this.columns.indexOf(e),n=r+1;s&&(n=r-1);let o=this.nextEditableCellPosForRow(n,t,s);if(o)return o;let l=c=>{if(!c.$row)return!1;if(n=0,s&&(n=this.columns.length-1),o=this.nextEditableCellPosForRow(n,c,s),o)return!0},h=this.rows.indexOf(t),d=h+1;return s&&(d=h-1),p.findFrom(this.rows,d,l,s),o}nextEditableCellPosForRow(e,t,s){let r=o=>{if(!o.isVisible()||o.guiOnly)return!1;let l=this.cell(o,t);return this.enabledComputed&&t.enabled&&l.editable},n=p.findFrom(this.columns,e,r,s);if(n)return{column:n,row:t}}clearAggregateRows(e){this._aggregateRows.forEach(t=>{t.prevRow&&(t.prevRow.aggregateRowAfter=null),t.nextRow&&(t.nextRow.aggregateRowBefore=null)}),this._isDataRendered()&&(this._removeAggregateRows(e),this._renderSelection()),this._aggregateRows=[]}_forEachVisibleColumn(e,t,s){let r;this.visibleColumns().forEach((n,o)=>{n[e]?(s&&(r=n.cellValueOrTextForCalculation(s)),t[o]=n[e](t[o],r)):t[o]=void 0})}_group(e){let t,s,r=this._groupedColumns(),n=this.groupingStyle===V.GroupingStyle.TOP,o=[];if(this.clearAggregateRows(),!r.length)return;let l=this.visibleRows;this._forEachVisibleColumn("aggrStart",o),l.forEach((h,d)=>{t||(t=h),this._forEachVisibleColumn("aggrStep",o,h);let c=l[d+1];(d===l.length-1||this._isNewGroup(r,h,c))&&(this._forEachVisibleColumn("aggrFinish",o),this._addAggregateRow(o,n?s:h,n?t:c),this._forEachVisibleColumn("aggrStart",o),t=null,s=h)}),this._isDataRendered()&&(this._renderAggregateRows(e),this._renderSelection())}_isNewGroup(e,t,s){let r=!1;if(!s)return!0;for(let n=0;n<e.length;n++){let o=e[n],l=o&&o.cellTextForGrouping&&typeof o.cellTextForGrouping=="function";if(r=r||l&&o.cellTextForGrouping(t)!==o.cellTextForGrouping(s),r=r||!l&&this.cellText(o,t)!==this.cellText(o,s),r)return!0}return!1}_groupedColumns(){return this.columns.filter(e=>e.grouped)}_addAggregateRow(e,t,s){let r={contents:e.slice(),prevRow:t,nextRow:s};this._aggregateRows.push(r),t&&(t.aggregateRowAfter=r),s&&(s.aggregateRowBefore=r)}_removeAggregateRows(e){this._aggregateRows.length!==0&&(e=u.nvl(e,!1),e?this._aggregateRows.forEach(t=>this._hideRow(t)):(this._aggregateRows.forEach(t=>this._removeRow(t)),this.updateScrollbars()))}_renderAggregateRows(e){let t=this.groupingStyle===V.GroupingStyle.TOP,s=t?"insertBefore":"insertAfter";e=u.nvl(e,!1),this._aggregateRows.forEach(r=>{if(r.$row)return;let n=t?r.nextRow:r.prevRow;if(!n||!n.$row)return;let o=this._build$AggregateRow(r);o[s](n.$row).width(this.rowWidth),this.visibleColumns().map(l=>a()(l.buildCellForAggregateRow(r)).appendTo(o)).forEach(l=>this._resizeAggregateCell(l)),r.height=this._measureRowHeight(o),r.$row=o,e&&this._showRow(r)})}_build$AggregateRow(e){let t=this.groupingStyle===V.GroupingStyle.TOP,s=this.$container.makeDiv("table-aggregate-row").data("aggregateRow",e);return s.toggleClass("grouping-style-top",t),s.toggleClass("grouping-style-bottom",!t),s}groupColumn(e,t,s,r){if(t=u.nvl(t,!1),r=u.nvl(r,!1),r&&this._removeGroupColumn(e),!this.isGroupingPossible(e))return;r||this._addGroupColumn(e,s,t),this.header&&this.header.onSortingChanged();let n=this._sort(!0),o={column:e,groupAscending:e.sortAscending};r&&(o.groupingRemoved=!0),t&&(o.multiGroup=!0),n||(o.groupingRequested=!0,this._animateAggregateRows=!0),this.trigger("group",o)}removeColumnGrouping(e){e&&this.groupColumn(e,!1,"asc",!0)}removeAllColumnGroupings(){this.columns.filter(e=>e.grouped).forEach(this.removeColumnGrouping.bind(this))}isGrouped(){return this.columns.some(e=>e.grouped)}setColumnBackgroundEffect(e,t){e.setBackgroundEffect(t)}_updateBackgroundEffect(){this.columns.forEach(e=>{!e.backgroundEffect||e.updateBackgroundEffect()})}_calculateValuesForBackgroundEffect(){this.columns.forEach(e=>{!e.backgroundEffect||e.calculateMinMaxValues()})}_markAutoOptimizeWidthColumnsAsDirty(){this.columns.forEach(e=>{e.autoOptimizeWidthRequired=!0})}_markAutoOptimizeWidthColumnsAsDirtyIfNeeded(e,t,s){let r=!1;for(let n=e.length-1;n>=0;n--){let o=e[n];this.cellValue(o,t)!==this.cellValue(o,s)&&(o.autoOptimizeWidthRequired=!0,e.splice(n,1),r=!0)}return r}setMultiCheck(e){this.setProperty("multiCheck",e)}checkedRows(){return this.rows.filter(e=>e.checked)}checkRow(e,t,s){let r=a().extend(s,{checked:t});this.checkRows([e],r)}checkRows(e,t){let s=a().extend({checked:!0,checkOnlyEnabled:!0},t),r=[];!this.checkable||!this.enabledComputed&&s.checkOnlyEnabled||(e=p.ensure(e),e.forEach(n=>{if(!(!n.enabled&&s.checkOnlyEnabled||n.checked===s.checked)){if(!this.multiCheck&&s.checked)for(let o=0;o<this.rows.length;o++)this.rows[o].checked&&(this.rows[o].checked=!1,r.push(this.rows[o]));n.checked=s.checked,r.push(n)}}),this._isDataRendered()&&r.forEach(n=>this._renderRowChecked(n)),this._triggerRowsChecked(r))}uncheckRow(e,t){this.uncheckRows([e],t)}uncheckRows(e,t){let s=a().extend({checked:!1},t);this.checkRows(e,s)}isTableNodeColumn(e){return this.hierarchical&&this.tableNodeColumn===e}collapseRow(e){this.collapseRows(p.ensure(e))}collapseAll(){this.expandRowsInternal(this.rootRows,!1,!0)}expandAll(){this.expandRowsInternal(this.rootRows,!0,!0)}collapseRows(e,t){this.expandRowsInternal(e,!1,t)}expandRow(e,t){this.expandRows(p.ensure(e),t)}expandRows(e,t){this.expandRowsInternal(e,!0,t)}expandRowsInternal(e,t,s){let r=[],n=[];e=e||this.rootRows,t=u.nvl(t,!0),s=u.nvl(s,!1),s?this.visitRows(o=>{o.expanded!==t&&(o.expanded=t,r.push(o),o.$row&&n.push(o))},e):r=e.filter(o=>{let l=o.expanded!==t;return l&&o.$row&&n.push(o),o.expanded=t,l}),r.length!==0&&(this._updateRowStructure({visibleRows:!0}),this._triggerRowsExpanded(r),this._isDataRendered()&&(this._renderRowDelta(),n.forEach(o=>o.animateExpansion()),e[0].$row&&P.ensureExpansionVisible({element:e[0],$element:e[0].$row,$scrollable:this.get$Scrollable(),isExpanded:o=>o.expanded,getChildren:o=>o.childRows,defaultChildHeight:this.rowHeight})))}doRowAction(e,t){this.selectedRows.length!==1||this.selectedRows[0]!==e||(t=t||this.columns[0],!(!e||!t)&&this._triggerRowAction(e,t))}insertRow(e){this.insertRows([e])}insertRows(e){let t=p.ensure(e);if(t.length===0)return;let s=this.rows.length===0;t.forEach((n,o)=>{let l=this._initRow(n);l.status=Xt.Status.INSERTED,t[o]=l,this.rows.push(l)});let r=t;this.filterSupport.applyFilters(r),this._updateRowStructure({updateTree:!0,filteredRows:!0,applyFilters:!1,visibleRows:!0}),this.filterCount()>0&&r.some(n=>n.filterAccepted)&&this._triggerFilter(),this._calculateValuesForBackgroundEffect(),this._markAutoOptimizeWidthColumnsAsDirty(),this._triggerRowsInserted(r),this._sortAfterInsert(s),this._isDataRendered()&&(this.hierarchical&&this._renderRowOrderChanges(),this._insertedRows?p.pushAll(this._insertedRows,r):(this._insertedRows=r,setTimeout(()=>{this._insertedRows=null},0)),this.viewRangeDirty=!0,this._renderViewport(),this.invalidateLayoutTree())}_sortAfterInsert(e){this._sort()}_sortWhileInit(){this._sort()}deleteRow(e){this.deleteRows([e])}deleteRows(e){if(e=p.ensure(e),e.length===0)return;let t,s,r=[];this.visitRows(n=>{!this.rowsMap[n.id]||(r.push(n),this._isDataRendered()&&(this.cellEditorPopup&&this.cellEditorPopup.row.id===n.id&&this.cellEditorPopup.cancelEdit(),this._removeRows(n),t=!0),p.remove(this.rows,n),p.remove(this.visibleRows,n),this.filterCount()>0&&p.remove(this._filteredRows,n)&&(s=!0),delete this.rowsMap[n.id],this.selectionHandler.lastActionRow===n&&this.selectionHandler.clearLastSelectedRowMarker())},e),this.deselectRows(r),this._updateRowStructure({updateTree:!0,filteredRows:!0,applyFilters:!1,visibleRows:!0}),s&&this._triggerFilter(),this._group(),this._updateBackgroundEffect(),this._markAutoOptimizeWidthColumnsAsDirty(),this._triggerRowsDeleted(e),t&&(this._renderViewport(),this._renderRangeMarkers(),this._renderFiller(),this._renderEmptyData(),this.invalidateLayoutTree())}deleteAllRows(){let e=this.filterCount()>0&&this._filteredRows.length>0,t=this.rows;this._isDataRendered()&&(this.cellEditorPopup&&this.cellEditorPopup.cancelEdit(),this.selectionHandler.clearLastSelectedRowMarker(),this._removeRows()),this.rows=[],this.rowsMap={},this._filteredRows=[],this.deselectAll(),this._updateRowStructure({updateTree:!0,filteredRows:!0,applyFilters:!1,visibleRows:!0}),e&&this._triggerFilter(),this._markAutoOptimizeWidthColumnsAsDirty(),this._group(),this._updateBackgroundEffect(),this._triggerAllRowsDeleted(t),this._isDataRendered()&&(this._renderFiller(),this._renderViewport(),this._renderEmptyData(),this.invalidateLayoutTree())}updateRow(e){this.updateRows([e])}updateRows(e){if(e=p.ensure(e),e.length===0)return;if(this.updateBuffer.isBuffering()){this.updateBuffer.buffer(e);return}let t,s,r,n=this.columns.filter(c=>c.autoOptimizeWidth&&!c.autoOptimizeWidthRequired),o={};this.rows.forEach((c,f)=>{o[c.id]=f});let l={},h=!1,d=e.map(c=>{let f=c.parentRow,m=this.rowsMap[c.id];if(l[c.id]=m,!m)throw new Error("Update event received for non existing row. RowId: "+c.id);c.parentRow&&(typeof c.parentRow=="string"?f=c.parentRow:b.isNullOrUndefined(c.parentRow.id)||(f=c.parentRow.id)),h=h||u.nvl(m._parentRowId,null)!==u.nvl(f,null),s=s||m.expanded!==u.nvl(c.expanded,!1);let _=this._initRow(c);return _.status===Xt.Status.NON_CHANGED&&_.cells.some((C,S)=>{let R=m.cells[S];return!R||R.value!==C.value?(_.status=Xt.Status.UPDATED,!0):!1}),this.selectionHandler.lastActionRow===m&&(this.selectionHandler.lastActionRow=_),p.replace(this.selectedRows,m,_),this.rows[o[_.id]]=_,_.filterAccepted=m.filterAccepted,this.filterCount()>0&&(t=this._applyFiltersForRow(_)||t),r=this._markAutoOptimizeWidthColumnsAsDirtyIfNeeded(n,m,_),_});this._updateRowStructure({updateTree:!0,filteredRows:!0,applyFilters:!1,visibleRows:!0}),this._triggerRowsUpdated(d),this._isDataRendered()&&(this._renderUpdateRows(d,l),h&&this._renderRowOrderChanges()),t&&this._triggerFilter(),(t||s)&&this._renderRowDelta(),this._sortAfterUpdate(),this._updateBackgroundEffect(),this.invalidateLayoutTree()}_renderUpdateRows(e,t){e.forEach(s=>{let r=t[s.id];if(!r.$row||r.$row.hasClass("hiding"))return;let n=a()(this._buildRowDiv(s));n.copyCssClasses(r.$row,V.SELECTION_CLASSES+" first last"),r.$row.replaceWith(n),V.linkRowToDiv(s,n),this._destroyTooltipsForRow(s),this._destroyCellEditorForRow(s),this._installRow(s),r.$row.hasClass("showing")&&r.$row.outerHeight()<s.$row.outerHeight()/3&&this._showRow(s)})}_sortAfterUpdate(){this._sort()}isHierarchical(){return this.hierarchical}_setHierarchical(e){this.hierarchical!==e&&(e&&this.removeAllColumnGroupings(),this._setProperty("hierarchical",e))}updateRowOrder(e){if(e=p.ensure(e),e.length!==this.rows.length)throw new Error("Row order may not be updated because lengths of the arrays differ.");this.rows=e.slice(),this._updateRowStructure({updateTree:!0,filteredRows:!0,applyFilters:!1,visibleRows:!0}),this.clearAggregateRows(this._animateAggregateRows),this._isDataRendered()&&this._renderRowOrderChanges(),this._triggerRowOrderChanged(),this._group(this._animateAggregateRows),this._animateAggregateRows=!1}_destroyTooltipsForRow(e){for(let t=this.tooltips.length-1;t>=0;t--)this.tooltips[t].row.id===e.id&&(this.tooltips[t].destroy(),this.tooltips.splice(t,1))}_destroyCellEditorForRow(e){this.cellEditorPopup&&this.cellEditorPopup.rendered&&this.cellEditorPopup.row.id===e.id&&this.cellEditorPopup.destroy()}startCellEdit(e,t,s){if(s.destroyed)return;if(!this._isDataRendered()){this._postRenderActions.push(this.startCellEdit.bind(this,e,t,s));return}if(!this.$container.isAttached()){this._postAttachActions.push(this.startCellEdit.bind(this,e,t,s));return}this.trigger("startCellEdit",{column:e,row:t,field:s}),this.ensureRowRendered(t);let r=e.startCellEdit(t,s);return this.cellEditorPopup=r,this.$container.toggleClass("has-cell-editor-popup",!!r),r}endCellEdit(e,t){if(!this.cellEditorPopup){e.destroy();return}this._destroyCellEditorPopup(this._updateCellFromEditor.bind(this,this.cellEditorPopup,e,t))}_updateCellFromEditor(e,t,s){s=u.nvl(s,!1),s&&e.column.updateCellFromEditor(e.row,t),t.destroy()}completeCellEdit(){let e=this.cellEditorPopup.cell.field;if(!this.trigger("completeCellEdit",{field:e,row:this.cellEditorPopup.row,column:this.cellEditorPopup.column,cell:this.cellEditorPopup.cell}).defaultPrevented)return this.endCellEdit(e,!0)}cancelCellEdit(){let e=this.cellEditorPopup.cell.field;this.trigger("cancelCellEdit",{field:e,row:this.cellEditorPopup.row,column:this.cellEditorPopup.column,cell:this.cellEditorPopup.cell}).defaultPrevented||this.endCellEdit(e)}scrollTo(e,t){this.viewRangeRendered.size()!==0&&(this.ensureRowRendered(e),e.$row&&P.scrollTo(this.$data,e.$row,t))}scrollPageUp(){let e=Math.max(0,this.$data[0].scrollTop-this.$data.height());this.setScrollTop(e)}scrollPageDown(){let e=Math.min(this.$data[0].scrollHeight,this.$data[0].scrollTop+this.$data.height());this.setScrollTop(e)}setScrollTop(e){this.setProperty("scrollTop",e),this._isDataRendered()&&this._renderViewport()}_renderScrollTop(){this.rendering||P.scrollTop(this.get$Scrollable(),this.scrollTop)}get$Scrollable(){return this.$data?this.$data:this.$container}setScrollToSelection(e){this.setProperty("scrollToSelection",e)}revealSelection(){if(!this._isDataRendered()){this.session.layoutValidator.schedulePostValidateFunction(this.revealSelection.bind(this));return}this.selectedRows.length>0&&this.scrollTo(this.selectedRows[0])}revealChecked(){let e=p.find(this.rows,t=>t.checked);e&&this.scrollTo(e)}rowById(e){return this.rowsMap[e]}rowsByIds(e){return e.map(this.rowById.bind(this))}rowsToIds(e){return e.map(t=>t.id)}hasRow(e){return Boolean(this.rowsMap[e.id])}_renderSelection(e){e=p.ensure(e||this.selectedRows);let t=(s,r,n)=>{let o=s.hasClass(n);return r&&!o?(s.addClass(n),1):!r&&o?(s.removeClass(n),1):0};this._renderNoRowsSelectedMarker();for(let s=0;s<e.length;s++){let r=e[s];if(!r.$row)continue;let n=this.selectedRows.indexOf(r)!==-1,o=this.visibleRows,l=o.indexOf(r)-1,h=l>=0&&this.selectedRows.indexOf(o[l])!==-1,d=o.indexOf(r)+1,c=d<o.length&&this.selectedRows.indexOf(o[d])!==-1;n&&h&&r.aggregateRowBefore&&(h=!1),n&&c&&r.aggregateRowAfter&&(c=!1);let f=t(r.$row,n,"selected")+t(r.$row,n&&!h&&c,"select-top")+t(r.$row,n&&h&&!c,"select-bottom")+t(r.$row,n&&!h&&!c,"select-single")+t(r.$row,n&&h&&c,"select-middle");f>0&&h&&e.indexOf(o[l])===-1&&e.push(o[l]),f>0&&c&&e.indexOf(o[d])===-1&&e.push(o[d])}this.cellEditorPopup&&this.cellEditorPopup.rendered&&this.selectedRows.indexOf(this.cellEditorPopup.row)>-1&&(this.cellEditorPopup.position(),this.cellEditorPopup.pack())}_removeSelection(){this.$container.addClass("no-rows-selected"),this.selectedRows.forEach(e=>{!e.$row||(e.$row.select(!1),e.$row.toggleClass(V.SELECTION_CLASSES,!1))})}_renderNoRowsSelectedMarker(){this.$container.toggleClass("no-rows-selected",this.selectedRows.length===0)}addRowToSelection(e,t){this.selectedRows.indexOf(e)>-1||(t=t!==void 0?t:!0,this.selectedRows.push(e),e.$row&&this._isDataRendered()&&(e.$row.select(!0),this._renderSelection(e),this.scrollToSelection&&this.revealSelection()),this._triggerRowsSelectedPending=!0,t||this.notifyRowSelectionFinished())}removeRowFromSelection(e,t){t=t!==void 0?t:!0,p.remove(this.selectedRows,e)&&(this._isDataRendered()&&this._renderSelection(e),t?this._triggerRowsSelectedPending=!0:this._triggerRowsSelected())}selectRow(e,t){this.selectRows(e,t)}selectRows(e,t){e=p.ensure(e).filter(r=>Boolean(this.visibleRowsMap[r.id])),!p.equalsIgnoreOrder(e,this.selectedRows)&&(this._isDataRendered()&&this._removeSelection(),!this.multiSelect&&e.length>1&&(e=[e[0]]),this.selectedRows=e,this._triggerRowsSelected(t),this._updateMenuBar(),this._isDataRendered()&&(this._renderSelection(),this.scrollToSelection&&this.revealSelection()))}deselectRow(e){this.deselectRows(e)}deselectRows(e){e=p.ensure(e);let t=this.selectedRows.slice();p.removeAll(t,e)&&this.selectRows(t)}isRowSelected(e){return this.selectedRows.indexOf(e)>-1}filterCount(){return this.filters.length}filteredRows(){return this._filteredRows}$rows(e){let t=".table-row";return e&&(t+=", .table-aggregate-row"),this.$data.find(t)}$aggregateRows(){return this.$data.find(".table-aggregate-row")}selectedRow(){return this.selectedRows.length>0?this.selectedRows[0]:null}$selectedRows(){return this.$data?this.$data.find(".selected"):a()()}$cellsForColIndex(e,t){let s=".table-row > div:nth-of-type("+e+")";return t&&(s+=", .table-aggregate-row > div:nth-of-type("+e+")"),this.$data.find(s)}$cellsForRow(e){return e.children(".table-cell")}$cell(e,t){let s;return typeof e!="number"?s=this.visibleColumns().indexOf(e):s=e,t.children(".table-cell").eq(s)}columnById(e){return p.find(this.columns,t=>t.id===e)}columnFor$Cell(e,t){t=t||e.parent();let s=this.$cellsForRow(t).index(e);return this.visibleColumns()[s]}columnsByIds(e){return e.map(this.columnById.bind(this))}getVisibleRows(){return this.visibleRows}_updateRowStructure(e){let t=u.nvl(e.updateTree,!1),s=u.nvl(e.filteredRows,t),r=u.nvl(e.applyFilters,s),n=u.nvl(e.filtersChanged,!1),o=u.nvl(e.visibleRows,s);t&&this._rebuildTreeStructure(),s&&this._updateFilteredRows(r,n),o&&this._updateVisibleRows()}_rebuildTreeStructure(){let e=!1;if(this.rows.forEach(t=>{t.childRows=[],e=e||!b.isNullOrUndefined(t.parentRow)}),!e){this.rootRows=this.rows,this._setHierarchical(e);return}this._setHierarchical(e),this.rootRows=[],this.rows.forEach(t=>{let s;if(b.isNullOrUndefined(t.parentRow)){t.parentRow=null,t._parentRowId=null,this.rootRows.push(t);return}if(!b.isNullOrUndefined(t.parentRow.id))s=this.rowsMap[t.parentRow.id];else{let r=t.parentRow;s=this.rowsMap[r]}if(s)t.parentRow=s,t._parentRowId=s.id,s.childRows.push(t);else throw new Error("Parent row of "+t+" can not be resolved.")}),this._maxLevel=0,this.rows=[],this.visitRows((t,s)=>{t.hierarchyLevel=s,this._maxLevel=Math.max(s,this._maxLevel),this.rows.push(t)}),this._calculateTableNodeColumn()}_updateFilteredRows(e,t){t=Boolean(t),e=u.nvl(e,!0),this._filteredRows=this.rows.filter(s=>(e&&(t=this._applyFiltersForRow(s)||t),s.filterAccepted)),t&&this._triggerFilter()}_updateVisibleRows(){if(this.visibleRows=this._computeVisibleRows(),this.visibleRowsMap=this.visibleRows.reduce((e,t)=>(e[t.id]=t,e),{}),this.initialized){let e=this.selectedRows.filter(t=>!this.visibleRowsMap[t.id]);this.deselectRows(e)}}_computeVisibleRows(e){let t=[];return e=e||this.rootRows,e.forEach(s=>{let r=this._computeVisibleRows(s.childRows);(s.filterAccepted||r.length>0)&&t.push(s),s.expandable=r.length>0,s.expanded&&(t=t.concat(r))}),t}visibleChildRows(e){return e.childRows.filter(t=>Boolean(this.visibleRowsMap[t.id]))}_renderRowDelta(){if(!this._isDataRendered())return;let e=[],t=[];this.$rows().each((s,r)=>{let n=a()(r),o=n.data("row");this.visibleRows.indexOf(o)<0?(o.$row.detach(),t.push(o)):n.hasClass("hiding")?n.stop(!1,!0):e.push(o)}),this._rerenderViewport(),t.forEach(s=>s.$row.insertAfter(this.$fillBefore)),this._order$Rows().insertAfter(this.$fillBefore),this._order$AggregateRows(),t.forEach(s=>this._hideRow(s)),this.$rows().each((s,r)=>{let n=a()(r),o=n.data("row");n.hasClass("hiding")||e.indexOf(o)<0&&this._showRow(o)}),this._renderScrollTop(),this._renderEmptyData()}_order$Rows(e){return e=e||this.$rows(),e.sort((t,s)=>{let r=a()(t),n=a()(s),o=r.data("row"),l=n.data("row");return this.rows.indexOf(o)-this.rows.indexOf(l)})}_order$AggregateRows(e){e=e||this.$aggregateRows(),e.each((t,s)=>{let r=a()(s),n=r.data("aggregateRow");!n||!n.prevRow||r.insertAfter(n.prevRow.$row)})}_applyFiltersForRow(e){return this.filterSupport.applyFiltersForElement(e)}filteredBy(){let e=[];return this.filters.forEach(t=>{t instanceof Qt&&e.push(t.createLabel())}),e}resetUserFilter(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.filters.filter(t=>t instanceof Qt).forEach(t=>this.removeFilter(t,e)),this._triggerFilterReset()}hasUserFilter(){return this.filters.filter(e=>e instanceof Qt).length>0}resizeToFit(e,t){if(e.fixedWidth)return;let s=e.calculateOptimalWidth();b.isPlainObject(s)?s.always(this._resizeToFit.bind(this,e,t)):this._resizeToFit(e,t,s)}_resizeToFit(e,t,s){s!==-1&&(t&&t>0&&s>t&&(s=t),e.width!==s&&this.resizeColumn(e,s),e.autoOptimizeWidthRequired=!1,this._triggerColumnResizedToFit(e))}addFilter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(e instanceof Qt){let r=this.getFilter(e.createKey());this.filterSupport.removeFilter(r,!1)}let s=this.filterSupport.addFilter(e,t);s&&s.length&&this.trigger("filterAdded",{filter:s[0]})}removeFilter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,s=this.filterSupport.removeFilter(e,t);s&&s.length&&this.trigger("filterRemoved",{filter:s[0]})}removeFilterByKey(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;this.removeFilter(this.getFilter(e),t)}getFilter(e){return p.find(this.filters,t=>t instanceof Qt?b.equals(t.createKey(),e):!1)}setFilters(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;this.resetUserFilter(!1);let s=e.map(l=>this._ensureFilter(l)),r=this.filterSupport.setFilters(s,t),n=r.filtersAdded,o=r.filtersRemoved;n.forEach(l=>this.trigger("filterAdded",{filter:l})),o.forEach(l=>this.trigger("filtersRemoved",{filter:l}))}_ensureFilter(e){if(e instanceof Qt||!e.objectType)return e;let t=e;return t.column&&(t.column=this.columnById(t.column)),t.table=this,t.session=this.session,u.create(t)}filter(){this.filterSupport.filter()}_filter(e){this._updateRowStructure(a().extend({},e,{filteredRows:!0})),this._renderRowDelta(),this._group(),this.revealSelection()}_createFilterSupport(){return new On({widget:this,$container:()=>this.$container,getElementsForFiltering:()=>this.rows,createTextFilter:()=>u.create(fs,{session:this.session,table:this}),updateTextFilterText:(e,t)=>b.equals(e.text,t)?!1:(e.text=t,!0)})}setTextFilterEnabled(e){this.setProperty("textFilterEnabled",e)}isTextFilterFieldVisible(){return this.textFilterEnabled&&!this.footerVisible}_renderTextFilterEnabled(){this.filterSupport.renderFilterField()}updateFilteredElements(e,t){this.filteredElementsDirty&&(this._filter({filteredRows:!0,applyFilters:!1,filtersChanged:!0}),this.filteredElementsDirty=!1)}resizeColumn(e,t){e.fixedWidth||(t=Math.floor(t),e.setWidth(t),this._isDataRendered()&&this._renderResizeColumn(e,t),this._triggerColumnResized(e))}_renderResizeColumn(e,t){let s=this.visibleColumns().indexOf(e);if(s!==-1){let r=s+1;this.$cellsForColIndex(r,!0).css("min-width",t).css("max-width",t),this._updateRealColumnWidth(e),this._updateRowWidth(),this.$rows(!0).css("width",this.rowWidth),this._updateRowHeights(),this._renderFiller(),this._renderViewport(),this.updateScrollbars(),this._renderEmptyData()}this._aggregateRows.forEach(r=>{r.$row&&this._resizeAggregateCell(this.$cell(e,r.$row))})}_resizeAggregateCell(e){let t=this._getAggrCellRange(e);this._updateAggrCell(t[0]),t.length>1&&this._updateAggrCell(t[t.length-1])}_getAggrCellRange(e){let t=[],s=e.parent(),r=this.visibleColumns(),n=e,o,l=d=>!d.hasClass("empty");if(l(e))o=e.hasClass("halign-right")?-1:1;else{o=1;let d=r.indexOf(this.columnFor$Cell(e));for(let c=d-1;c>=0&&(n=this.$cell(r[c],s),!l(n));c--);}t.push(n);let h=r.indexOf(this.columnFor$Cell(n));for(let d=h+o;d>=0&&d<r.length;d+=o){let c=this.$cell(r[d],s);if(t.push(c),l(c))break}return t}_updateAggrCell(e){let t=e.children(".text");if(!t||!t.length||e.hasClass("empty"))return;let s=e.children(".table-cell-icon").first(),r=this._getAggrCellWidth(e,s);r=this._updateAggrIconVisibility(s,t,r),t.cssMaxWidth(r)}_getWidthWithMarginCached(e){if(!e||!e.length)return 0;let t="widthWithMargin",s=e.data(t);if(s)return s;let r=e.isVisible();r||e.setVisible(!0);let n=v.size(e,{includeMargin:!0}).width;return r||e.setVisible(!1),e.data(t,n),n}_getAggrCellWidth(e,t){let s=e.cssMaxWidth()-e.cssPaddingX();t&&t.length&&t.isVisible()&&(s-=this._getWidthWithMarginCached(t));let r=this._getAggrCellRange(e);for(let n=1;n<r.length;n++){let o=r[n];if(o.hasClass("empty"))s+=o.cssMaxWidth();else{if(e.hasClass("halign-right")!==o.hasClass("halign-right")){let d=o.cssMaxWidth(),c=o.children().toArray().map(m=>a()(m)).filter(m=>m.isVisible()).map(m=>v.size(m,{includeMargin:!0}).width).reduce((m,_)=>m+_,0)+e.cssPaddingLeft(),f=d-c;o.hasClass("halign-center")&&(f/=2),s+=f}break}}return Math.max(0,s)}_updateAggrIconVisibility(e,t,s){if(!e||!e.length)return s;let r=e.isVisible(),n=this._getWidthWithMarginCached(e),o=this._getWidthWithMarginCached(t),h=s-o+(r?n:0)>n;return h===r?s:(e.setVisible(h),s+(h?-n:n))}moveColumn(e,t,s,r){s=this._considerFixedPositionColumns(t,s);let n=this.visibleColumns(),o=n[s],l=this.columns.indexOf(o);p.remove(this.columns,e),p.insert(this.columns,e,l),n=this.visibleColumns(),s=n.indexOf(e),this._calculateTableNodeColumn(),this._triggerColumnMoved(e,t,s,r),this._aggregateRows.forEach(h=>p.move(h.contents,t,s)),this._isDataRendered()&&this._rerenderViewport()}_considerFixedPositionColumns(e,t){let s=-1;return t>e?(s=p.findIndexFrom(this.visibleColumns(),e,r=>r.fixedPosition),s>-1&&(t=Math.min(t,s-1))):(s=p.findIndexFromReverse(this.visibleColumns(),e,r=>r.fixedPosition),s>-1&&(t=Math.max(t,s+1))),t}_renderColumnOrderChanges(e){let t,s=this;this.header&&this.header.onOrderChanged(e),this.$rows(!0).each(function(){let r=a()(this),n=a()(),o=r.children();for(let l=0;l<s.columns.length;l++){let h=s.columns[l];for(let d=0;d<e.length;d++)if(e[d]===h){t=o[d];break}n.push(t)}r.prepend(n)})}_triggerRowsInserted(e){this.trigger("rowsInserted",{rows:e})}_triggerRowsDeleted(e){this.trigger("rowsDeleted",{rows:e})}_triggerRowsUpdated(e){this.trigger("rowsUpdated",{rows:e})}_triggerAllRowsDeleted(e){this.trigger("allRowsDeleted",{rows:e})}_triggerRowsSelected(e){this.trigger("rowsSelected",{debounce:e})}_triggerRowsChecked(e){this.trigger("rowsChecked",{rows:e})}_triggerRowsExpanded(e){this.trigger("rowsExpanded",{rows:e})}_triggerFilter(){this.trigger("filter")}_triggerFilterReset(){this.trigger("filterReset")}_triggerAppLinkAction(e,t,s,r){this.trigger("appLinkAction",{column:e,row:t,ref:s,$appLink:r})}_triggerReload(e){this.trigger("reload",{reloadReason:e})}_triggerClipboardExport(){this.trigger("clipboardExport").defaultPrevented||this._exportToClipboard()}_triggerRowOrderChanged(e,t){let s={row:e,animating:t};this.trigger("rowOrderChanged",s)}_triggerColumnResized(e){let t={column:e};this.trigger("columnResized",t)}_triggerColumnResizedToFit(e){let t={column:e};this.trigger("columnResizedToFit",t)}_triggerColumnMoved(e,t,s,r){let n={column:e,oldPos:t,newPos:s,dragged:r};this.trigger("columnMoved",n)}_triggerAggregationFunctionChanged(e){let t={column:e};this.trigger("aggregationFunctionChanged",t)}setHeaderVisible(e){this.setProperty("headerVisible",e)}_renderHeaderVisible(){this._renderTableHeader()}setHeaderEnabled(e){this.setProperty("headerEnabled",e)}_renderHeaderEnabled(){this._removeTableHeader(),this._renderTableHeader()}setHeaderMenusEnabled(e){this.setProperty("headerMenusEnabled",e),this.header&&this.header.setHeaderMenusEnabled(this.headerMenusEnabled)}hasPermanentHeadOrTailSortColumns(){return this._permanentHeadSortColumns.length!==0||this._permanentTailSortColumns.length!==0}_setHeadAndTailSortColumns(){let e=this.columns.filter(t=>t.sortIndex>=0);e.sort((t,s)=>t.sortIndex-s.sortIndex),this._permanentHeadSortColumns=[],this._permanentTailSortColumns=[],e.forEach(t=>{t.initialAlwaysIncludeSortAtBegin?this._permanentHeadSortColumns.push(t):t.initialAlwaysIncludeSortAtEnd&&this._permanentTailSortColumns.push(t)})}setTileMode(e){this.setProperty("tileMode",e)}_setTileMode(e){e&&(this._ensureMediator(),this.tileTableHeader||this._setTileTableHeader(this._createTileTableHeader()),this.tableTileGridMediator.loadTiles(),this.tableTileGridMediator.activate()),this._setProperty("tileMode",e),!e&&this.tableTileGridMediator&&this.tableTileGridMediator.deactivate()}_ensureMediator(){this.tableTileGridMediator||(this.tableTileGridMediator=u.create(un,{parent:this,gridColumnCount:6}))}_renderTileMode(){this.tableTileGridMediator&&this.tableTileGridMediator.renderTileMode()}createTiles(e){return e.map(t=>{let s=this.createTileForRow(t);return this._adaptTile(s),s.rowId=t.id,s})}_adaptTile(e){e.gridDataHints={weightX:0}}createTileForRow(e){if(this.tileProducer)return this.tileProducer(e);throw new Error("Cannot create a tile without a producer.")}setTileProducer(e){this.setProperty("tileProducer",e)}_setTileTableHeader(e){e&&e.addCssClass("tile-table-header"),this._setProperty("tileTableHeader",e)}_createTileTableHeader(){return u.create(Vf,{parent:this})}setRowIconVisible(e){this.setProperty("rowIconVisible",e)}_setRowIconVisible(e){this._setProperty("rowIconVisible",e);let t=this.rowIconColumn;this.rowIconVisible&&!t?(this._insertRowIconColumn(),this._calculateTableNodeColumn(),this.trigger("columnStructureChanged")):!this.rowIconVisible&&t&&(t.destroy(),p.remove(this.columns,t),this.rowIconColumn=null,this._calculateTableNodeColumn(),this.trigger("columnStructureChanged"))}_renderRowIconVisible(){this.columnLayoutDirty=!0,this._updateRowWidth(),this.redraw()}_renderRowIconColumnWidth(){!this.rowIconVisible||this._renderRowIconVisible()}setRowIconColumnWidth(e){this.setProperty("rowIconColumnWidth",e)}_setRowIconColumnWidth(e){this._setProperty("rowIconColumnWidth",e);let t=this.rowIconColumn;t&&(t.width=e)}_setSelectedRows(e){typeof e[0]=="string"&&(e=this.rowsByIds(e)),this._setProperty("selectedRows",e)}setMenus(e){this.setProperty("menus",e)}_setMenus(e){this.updateKeyStrokes(e,this.menus),this._setProperty("menus",e),this._updateMenuBar(),this.header&&this.header.updateMenuBar()}setMenuBarVisible(e){this.setProperty("menuBarVisible",e)}_setMenuBarVisible(e){this._setProperty("menuBarVisible",e),this._updateMenuBar()}_renderMenuBarVisible(){this.menuBarVisible?(this.menuBar.render(),this._refreshMenuBarPosition()):this.menuBar.remove(),this._updateMenuBar(),this.invalidateLayoutTree()}_refreshMenuBarPosition(){this.$container.removeClass("menubar-top"),this.$container.removeClass("menubar-bottom"),this.menuBarVisible&&this.menuBar.rendered&&(this.menuBar.position===ce.Position.TOP?(this.menuBar.$container.prependTo(this.$container),this.$container.addClass("menubar-top")):(this.menuBar.$container.appendTo(this.$container),this.$container.addClass("menubar-bottom")))}_createMenuBar(){return u.create(ce,{parent:this,position:ce.Position.BOTTOM,menuOrder:new io(this.session,"Table"),menuFilter:this._filterMenusHandler,cssClass:"bounded"})}_updateMenuBar(){if(this.menuBarVisible){let e=["Header"],t=this._filterMenus(this.menus,It.MENU_BAR,!1,!0,e);t=this.staticMenus.concat(t),this.menuBar.setMenuItems(t)}else this.menuBar.setMenuItems([]);if(this._refreshMenuBarClasses(),this.contextMenu){let e=this._filterMenus(this.menus,It.CONTEXT_MENU,!0,!1,["Header"]);this.contextMenu.updateMenuItems(e)}}_refreshMenuBarClasses(){!this.$container||(this.$container.toggleClass("has-menubar",this.menuBar&&this.menuBar.visible),this.$container.toggleClass("menubar-top",this.menuBar&&this.menuBar.position===ce.Position.TOP),this.$container.toggleClass("menubar-bottom",this.menuBar&&this.menuBar.position!==ce.Position.TOP))}_setKeyStrokes(e){this.updateKeyStrokes(e,this.keyStrokes),this._setProperty("keyStrokes",e)}setTableStatus(e){this.setProperty("tableStatus",e)}_setTableStatus(e){e=E.ensure(e),this._setProperty("tableStatus",e)}setTableStatusVisible(e){this.setProperty("tableStatusVisible",e),this._updateFooterVisibility()}_updateFooterVisibility(){this.setFooterVisible(this.tableStatusVisible||this._hasVisibleTableControls())}setHierarchicalStyle(e){this.setProperty("hierarchicalStyle",e)}_renderHierarchicalStyle(){this.$container.toggleClass("structured",V.HierarchicalStyle.STRUCTURED===this.hierarchicalStyle)}setFooterVisible(e){this._setProperty("footerVisible",e),e&&!this.footer&&(this.footer=this._createFooter()),this.tableControls.forEach(t=>{t.tableFooter=this.footer}),this.rendered&&this._renderFooterVisible(),!e&&this.footer&&(this.footer.destroy(),this.footer=null)}_renderBackgroundEffect(){this.columns.forEach(e=>{!e.backgroundEffect||e._renderBackgroundEffect()})}_renderRowChecked(e){if(!this.checkable||!e.$row)return;let t;if(this.checkableStyle===V.CheckableStyle.TABLE_ROW)t=e.$row;else{if(!this.checkableColumn)throw new Error("checkableColumn not set");t=this.checkableColumn.$checkBox(e.$row)}t.toggleClass("checked",e.checked)}setCheckable(e){this.setProperty("checkable",e)}_setCheckable(e){this._setProperty("checkable",e),this._updateCheckableColumn()}_updateCheckableColumn(){let e=this.checkableColumn,t=this.checkable&&u.isOneOf(this.checkableStyle,V.CheckableStyle.CHECKBOX,V.CheckableStyle.CHECKBOX_TABLE_ROW);t&&!e?(this._insertBooleanColumn(),this._calculateTableNodeColumn(),this.trigger("columnStructureChanged")):!t&&e&&e.guiOnly&&(e.destroy(),p.remove(this.columns,e),this.checkableColumn=null,this._calculateTableNodeColumn(),this.trigger("columnStructureChanged"))}_renderCheckable(){this.columnLayoutDirty=!0,this._updateRowWidth(),this.redraw()}setCheckableStyle(e){this.setProperty("checkableStyle",e)}_setCheckableStyle(e){this._setProperty("checkableStyle",e),this._updateCheckableColumn()}_renderCheckableStyle(){this.$container.toggleClass("checkable",u.isOneOf(this.checkableStyle,V.CheckableStyle.TABLE_ROW,V.CheckableStyle.CHECKBOX_TABLE_ROW)),this.$container.toggleClass("table-row-check",this.checkableStyle===V.CheckableStyle.TABLE_ROW),this._isDataRendered()&&(this._updateRowWidth(),this.redraw())}setCompact(e){this.setProperty("compact",e)}_setCompact(e){this._setProperty("compact",e),this._updateCompactColumn(),this.compactHandler&&this.compactHandler.handle(this.compact)}_updateCompactColumn(){let e=this.compactColumn;return this.compact&&!e?(this._insertCompactColumn(),!0):!this.compact&&e?(e.destroy(),p.remove(this.columns,e),this.compactColumn=null,!0):!1}_insertCompactColumn(){let e=u.create(Ru,{session:this.session,table:this,guiOnly:!0,headerMenuEnabled:!1});this.columns.push(e),this.compactColumn=e}_renderCompact(){this.columnLayoutDirty=!0,this._updateRowWidth(),this.redraw()}setGroupingStyle(e){this.setProperty("groupingStyle",e)}_setGroupingStyle(e){this._setProperty("groupingStyle",e),this._group()}_renderGroupingStyle(){this._rerenderViewport()}redraw(){!this._isDataRendered()||(this._rerenderHeaderColumns(),this._rerenderViewport(),this.invalidateLayoutTree())}_rerenderHeaderColumns(){this.header&&(this.header.rerenderColumns(),this.invalidateLayoutTree())}_renderTableHeader(){if(this.tileMode)return;let e=!1;this.headerVisible&&!this.header?(this.header=this._createHeader(),this.header.render(),this._renderEmptyData(),e=!0):!this.headerVisible&&this.header&&(this._removeTableHeader(),this._removeEmptyData(),e=!0),this.$container.toggleClass("header-invisible",!this.header),e&&this.invalidateLayoutTree()}_removeTableHeader(){this.header&&(this.header.destroy(),this.header=null)}_renderEmptyData(){!this.header||this.visibleRows.length>0||(this.$emptyData||(this.$emptyData=this.$data.appendDiv().html("&nbsp;")),this.$emptyData.css("min-width",this.rowWidth).css("max-width",this.rowWidth),this.updateScrollbars())}_removeEmptyData(){this.header&&this.visibleRows.length===0||this.$emptyData&&(this.$emptyData.remove(),this.$emptyData=null,this.updateScrollbars())}_renderFooterVisible(){!this.footer||(this.footerVisible?this._renderFooter():this._removeFooter(),this.invalidateLayoutTree(),this.filterSupport.renderFilterField())}_renderFooter(){this.footer.rendered||this.footer.render()}_removeFooter(){!this.footer.rendered||this.footer.remove()}_renderEnabled(){super._renderEnabled(),this._installOrUninstallDragAndDropHandler();let e=this.enabledComputed;this.tileMode||this.$data.setEnabled(e),this.$container.setTabbableOrFocusable(e)}_renderDisabledStyle(){super._renderDisabledStyle(),this._renderDisabledStyleInternal(this.$data)}setAutoResizeColumns(e){this.setProperty("autoResizeColumns",e)}_renderAutoResizeColumns(){!this.autoResizeColumns&&x.get().hasTableCellZoomBug()&&this.visibleColumns().forEach((e,t)=>{e._realWidth=null}),this.columnLayoutDirty=!0,this.invalidateLayoutTree()}setMultilineText(e){this.setProperty("multilineText",e)}_renderMultilineText(){this._markAutoOptimizeWidthColumnsAsDirty(),this.redraw()}setDropType(e){this.setProperty("dropType",e)}_renderDropType(){this._installOrUninstallDragAndDropHandler()}setDropMaximumSize(e){this.setProperty("dropMaximumSize",e)}_installOrUninstallDragAndDropHandler(){Fe.installOrUninstallDragAndDropHandler({target:this,doInstall:()=>this.dropType&&this.enabledComputed,selector:".table-data,.table-row",onDrop:e=>this.trigger("drop",e),dropType:()=>this.dropType,additionalDropProperties:e=>{let t=a()(e.currentTarget),s={rowId:""};if(t.hasClass("table-row")){let r=t.data("row");s.rowId=r.id}return s}})}_installImageListeners(){this._imageLoadListener=this._onImageLoadOrError.bind(this),this.$data[0].addEventListener("load",this._imageLoadListener,!0),this.$data[0].addEventListener("error",this._imageLoadListener,!0)}_uninstallImageListeners(){this.$data[0].removeEventListener("load",this._imageLoadListener,!0),this.$data[0].removeEventListener("error",this._imageLoadListener,!0)}calculateViewRangeSize(){if(this._updateRowHeight(),this.rowHeight===0)throw new Error("Cannot calculate view range with rowHeight = 0");return Math.ceil(this.$data.outerHeight()/this.rowHeight)*2}setViewRangeSize(e){this.viewRangeSize!==e&&(this._setProperty("viewRangeSize",e),this._isDataRendered()&&this._renderViewport())}_calculateCurrentViewRange(){let e,t=this.$data[0].scrollTop;return this.$data[0].scrollHeight-this.$data[0].clientHeight===0?e=0:e=this._rowIndexAtScrollTop(t),this._calculateViewRangeForRowIndex(e)}_rowIndexAtScrollTop(e){let t=0,s=-1;return this.visibleRows.some((r,n)=>(t+=this._heightForRow(r),e<t?(s=n,!0):!1)),s}_heightForRow(e){let t=0,s=e.aggregateRowBefore;return this.groupingStyle===V.GroupingStyle.BOTTOM&&(s=e.aggregateRowAfter),e.height?t=e.height:t=this.rowHeight,s&&(s.height?t+=s.height:t+=this.aggregateRowHeight),t}_measureRowHeight(e){return v.size(e,{includeMargin:!0,exact:!0}).height}_calculateViewRangeForRowIndex(e){if(!this.virtual)return new B(0,this.visibleRows.length);let t=new B,s=Math.floor(this.viewRangeSize/4);return t.from=Math.max(e-s,0),t.to=Math.min(t.from+this.viewRangeSize,this.visibleRows.length),this.viewRangeSize-t.size()>0&&(t.from=Math.max(t.to-this.viewRangeSize,0)),t}_renderViewport(){if(!this.isAttachedAndRendered()){this._renderViewPortAfterAttach=!0;return}if(this._renderViewportBlocked||this.visibleColumns().length===0)return;if(!this.$container.isEveryParentVisible()){this.invalidateLayoutTree();return}let e=this._calculateCurrentViewRange();this._renderViewRange(e),this._renderLastRowAtBottomMarker(),this._renderNoRowsSelectedMarker()}_rerenderViewport(){if(!this.isAttachedAndRendered()){this._rerenderViewPortAfterAttach=!0;return}this._removeRows(),this._removeAggregateRows(),this._renderFiller(),this._renderViewport()}_renderViewRangeForRowIndex(e){let t=this._calculateViewRangeForRowIndex(e);this._renderViewRange(t)}_renderViewRange(e){if(e.from===this.viewRangeRendered.from&&e.to===this.viewRangeRendered.to&&!this.viewRangeDirty)return;this._removeRangeMarkers();let t=e.subtract(this.viewRangeRendered);if(this.viewRangeRendered.subtract(e).forEach(r=>this._removeRowsInRange(r)),t.forEach(r=>this._renderRowsInRange(r)),this.viewRangeRendered.size()>0){let r=this.visibleRows,n=r[this.viewRangeRendered.from],o=r[this.viewRangeRendered.to-1];if(!n.$row||!o.$row)throw new Error("Rows not rendered as expected. "+this.viewRangeRendered+". First: "+v.debugOutput(n.$row)+". Last: "+v.debugOutput(o.$row)+". Length: visibleRows="+this.visibleRows.length+" rows="+this.rows.length)}this._renderRangeMarkers(),this._removeAggregateRows(),this._renderAggregateRows(),this._renderFiller(),this._renderEmptyData(),this._renderBackgroundEffect(),this._renderSelection(),this.viewRangeDirty=!1}_renderLastRowAtBottomMarker(){if(this.$rows().is(":animated"))return;let e=this._lastVisibleRow();e&&e.$row?this.$data.toggleClass("last-row-at-bottom",Math.ceil(v.offsetBounds(e.$row).bottom())>=v.offsetBounds(this.$data).bottom()):this.$data.removeClass("last-row-at-bottom")}_lastVisibleRow(){return this.visibleRows[this.visibleRows.length-1]}_removeRangeMarkers(){this._modifyRangeMarkers("removeClass")}_renderRangeMarkers(){this._modifyRangeMarkers("addClass")}_modifyRangeMarkers(e){if(this.viewRangeRendered.size()===0)return;let t=this.visibleRows;s(t[this.viewRangeRendered.from],"first"),s(t[this.viewRangeRendered.to-1],"last");function s(r,n){r&&r.$row&&r.$row[e](n)}}ensureRowRendered(e){if(e.$row)return;let t=this.visibleRows.indexOf(e);t<0||this._renderViewRangeForRowIndex(t)}_renderFiller(){this.$fillBefore||(this.$fillBefore=this.$data.prependDiv("table-data-fill"),this._applyFillerStyle(this.$fillBefore));let e=this._calculateFillerHeight(new B(0,this.viewRangeRendered.from));this.$fillBefore.cssHeight(e),this.$fillBefore.cssWidth(this.rowWidth),a().log.isTraceEnabled()&&a().log.trace("FillBefore height: "+e),this.$fillAfter||(this.$fillAfter=this.$data.appendDiv("table-data-fill"),this._applyFillerStyle(this.$fillAfter));let t=this._calculateFillerHeight(new B(this.viewRangeRendered.to,this.visibleRows.length));this.$fillAfter.cssHeight(t),this.$fillAfter.cssWidth(this.rowWidth),a().log.isTraceEnabled()&&a().log.trace("FillAfter height: "+t)}_applyFillerStyle(e){let t=e.css("background-color"),s=((1-1/this.rowHeight)*100).toFixed(2)+"%";e.css({background:"linear-gradient(to bottom, transparent, transparent "+s+", "+t+" "+s+", "+t+")",backgroundSize:"100% "+this.rowHeight+"px",backgroundColor:"transparent"})}_calculateFillerHeight(e){let t=0;for(let s=e.from;s<e.to;s++){let r=this.visibleRows[s];t+=this._heightForRow(r)}return t}containsAggregatedNumberColumn(){return this.initialized?this.visibleColumns().some(e=>e instanceof Bi&&e.aggregationFunction!=="none"):!1}updateColumnStructure(e){this._destroyColumns(),this.columns=e,this._initColumns(),this.trigger("columnStructureChanged"),this._isDataRendered()&&(this._updateRowWidth(),this.$rows(!0).css("width",this.rowWidth),this._rerenderHeaderColumns(),this._renderEmptyData())}updateColumnOrder(e){if(e.length!==this.columns.length)throw new Error("Column order may not be updated because lengths of the arrays differ.");let t=this.columns.slice();for(let s=0;s<e.length;s++){let r=e[s],n=p.findIndex(this.columns,o=>o.id===r.id);if(n<0)throw new Error("Column with id "+r.id+"not found.");n!==s&&p.move(this.columns,n,s)}this._isDataRendered()&&this._renderColumnOrderChanges(t)}updateColumnHeaders(e){let t;for(let s=0;s<e.length;s++){let r=this.columnById(e[s].id);t=a().extend(t,r),r.text=e[s].text,r.headerTooltipText=e[s].headerTooltipText,r.headerTooltipHtmlEnabled=e[s].headerTooltipHtmlEnabled,r.headerCssClass=e[s].headerCssClass,r.headerHtmlEnabled=e[s].headerHtmlEnabled,r.headerBackgroundColor=e[s].headerBackgroundColor,r.headerForegroundColor=e[s].headerForegroundColor,r.headerFont=e[s].headerFont,r.headerIconId=e[s].headerIconId,r.sortActive=e[s].sortActive,r.sortAscending=e[s].sortAscending,r.grouped&&!e[s].grouped&&this._removeGroupColumn(r),r.grouped=e[s].grouped,!r.sortActive&&r.sortIndex!==-1?this._removeSortColumn(r):r.grouped&&r.sortActive&&r.sortIndex===-1?this._addGroupColumn(r):r.sortActive&&r.sortIndex===-1?this._addSortColumn(r):r.sortIndex=e[s].sortIndex,this._isDataRendered()&&this.header&&this.header.updateHeader(r,t)}}_attach(){this.$parent.append(this.$container),super._attach()}_postAttach(){this._rerenderViewportAfterAttach();let e=this.htmlComp.getParent();this.htmlComp.setSize(e.size()),super._postAttach()}_renderOnAttach(){super._renderOnAttach(),this._rerenderViewportAfterAttach(),this._renderViewportAfterAttach();let e=this._postAttachActions;this._postAttachActions=[],e.forEach(t=>t())}_rerenderViewportAfterAttach(){this._rerenderViewPortAfterAttach&&(this._rerenderViewport(),this._rerenderViewPortAfterAttach=!1,this._renderViewPortAfterAttach=!1)}_renderViewportAfterAttach(){this._renderViewPortAfterAttach&&(this._renderViewport(),this._renderViewPortAfterAttach=!1)}_detach(){this.$container.detach(),super._detach()}_destroyCellEditorPopup(e){if(!this.cellEditorPopup)return;let t=()=>{this.cellEditorPopup.destroy(),this.cellEditorPopup=null,this.$container&&this.$container.removeClass("has-cell-editor-popup"),e&&e()},s=this.cellEditorPopup.waitForCompleteCellEdit();s.state()==="resolved"?t():s.then(t)}setVirtual(e){this._setProperty("virtual",e)}setCellValue(e,t,s){e.setCellValue(t,s)}setCellText(e,t,s){e.setCellText(t,s)}setCellErrorStatus(e,t,s){e.setCellErrorStatus(t,s)}visibleColumns(e){return this.filterColumns(t=>t.isVisible(),e)}displayableColumns(e){return this.filterColumns(t=>t.displayable,e)}filterColumns(e,t){return t=u.nvl(t,!0),this.columns.filter(s=>e(s)&&(t||!s.guiOnly))}_onDesktopPopupOpen(e){let t=e.popup;!this.isFocusable(!1)||this.has(t)&&t instanceof ft&&(this.$container.addClass("focused"),t.one("destroy",()=>{this._isDataRendered()&&this.$container.removeClass("focused")}))}_onDesktopPropertyChange(e){e.propertyName==="dense"&&this.menuBar.invalidateLayoutTree()}markRowsAsNonChanged(e){p.ensure(e||this.rows).forEach(t=>{t.status=Xt.Status.NON_CHANGED})}static parseHorizontalAlignment(e){return e>0?"right":e===0?"center":"left"}static linkRowToDiv(e,t){e&&(e.$row=t),t&&t.data("row",e)}}D(V,"MenuTypes",{EmptySpace:"Table.EmptySpace",SingleSelection:"Table.SingleSelection",MultiSelection:"Table.MultiSelection",Header:"Table.Header"}),D(V,"HierarchicalStyle",{DEFAULT:"default",STRUCTURED:"structured"}),D(V,"GroupingStyle",{TOP:"top",BOTTOM:"bottom"}),D(V,"CheckableStyle",{CHECKBOX:"checkbox",TABLE_ROW:"tableRow",CHECKBOX_TABLE_ROW:"checkbox_table_row"}),D(V,"ReloadReason",{UNSPECIFIED:"unspecified",SEARCH:"search",OVERRIDE_ROW_LIMIT:"overrideRowLimit",RESET_ROW_LIMIT:"resetRowLimit",ORGANIZE_COLUMNS:"organizeColumns",DATA_CHANGED_TRIGGER:"dataChangedTrigger"}),D(V,"SELECTION_CLASSES","select-middle select-top select-bottom select-single selected");function ZP(i,e,t){return e=ex(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ex(i){var e=tx(i,"string");return typeof e=="symbol"?e:String(e)}function tx(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class hn extends ke{constructor(){super(),ZP(this,"_rebuildingTable",void 0),this._addRemoteProperties(["contextColumn"])}_initProperties(e){super._initProperties(e),e.compactHandler=null}_postCreateWidget(){this.widget.hasUserFilter()&&this._onWidgetFilter()}_sendRowsSelected(e,t){let s={rowIds:e};this._send("rowsSelected",s,{delay:t?250:0,coalesce:function(r){return this.target===r.target&&this.type===r.type}})}_sendRowClick(e,t,s){let r={rowId:e,columnId:s,mouseButton:t};this._send("rowClick",r)}_onWidgetRowsSelected(e){let t=this.widget.rowsToIds(this.widget.selectedRows);this._sendRowsSelected(t,e.debounce)}_onWidgetRowClick(e){let t;e.column!==void 0&&(t=e.column.id),this._sendRowClick(e.row.id,e.mouseButton,t)}_onWidgetFilterAdded(e){let t=e.filter;!(t instanceof Qt)||t instanceof Ji&&t.column.guiOnly||this._send("filterAdded",t.createFilterAddedEventData())}_onWidgetFilterRemoved(e){let t=e.filter;!(t instanceof Qt)||t instanceof Ji&&t.column.guiOnly||this._send("filterRemoved",t.createFilterRemovedEventData())}_onWidgetColumnResized(e){this._sendColumnResized(e.column)}_sendColumnResized(e){if(e.fixedWidth||e.guiOnly||this.widget.autoResizeColumns)return;let t={columnId:e.id,width:e.width};this._send("columnResized",t,{delay:750,coalesce:function(s){return this.target===s.target&&this.type===s.type&&this.columnId===s.columnId},showBusyIndicator:!1})}_onWidgetAggregationFunctionChanged(e){this._sendAggregationFunctionChanged(e.column)}_sendAggregationFunctionChanged(e){if(e.guiOnly)return;let t={columnId:e.id,aggregationFunction:e.aggregationFunction};this._send("aggregationFunctionChanged",t)}_onWidgetColumnBackgroundEffectChanged(e){this._sendColumnBackgroundEffectChanged(e.column)}_sendColumnBackgroundEffectChanged(e){if(e.guiOnly)return;let t={columnId:e.id,backgroundEffect:e.backgroundEffect};this._send("columnBackgroundEffectChanged",t)}_onWidgetColumnOrganizeAction(e){this._send("columnOrganizeAction",{action:e.action,columnId:e.column.id})}_onWidgetColumnMoved(e){let t=e.newPos;this.widget.columns.forEach((s,r)=>{s.guiOnly&&t--}),this._sendColumnMoved(e.column,t)}_sendColumnMoved(e,t){if(e.guiOnly)return;let s={columnId:e.id,index:t};this._send("columnMoved",s)}_onWidgetPrepareCellEdit(e){e.preventDefault(),this._sendPrepareCellEdit(e.row,e.column)}_sendPrepareCellEdit(e,t){if(t.guiOnly)return;let s={rowId:e.id,columnId:t.id};this._send("prepareCellEdit",s)}_onWidgetCompleteCellEdit(e){e.preventDefault(),this._sendCompleteCellEdit()}_sendCompleteCellEdit(){this._send("completeCellEdit")}_onWidgetCancelCellEdit(e){e.preventDefault(),this._sendCancelCellEdit()}_sendCancelCellEdit(){this._send("cancelCellEdit")}_onWidgetRowsChecked(e){this._sendRowsChecked(e.rows)}_sendRowsChecked(e){let t={rows:[]};for(let s=0;s<e.length;s++)t.rows.push({rowId:e[s].id,checked:e[s].checked});this._send("rowsChecked",t)}_onWidgetRowsExpanded(e){this._sendRowsExpanded(e.rows)}_sendRowsExpanded(e){let t={rows:e.map(s=>({rowId:s.id,expanded:s.expanded}))};this._send("rowsExpanded",t)}_onWidgetFilter(){let e=this.widget.rowsToIds(this.widget.filteredRows());this._sendFilter(e)}_sendFilter(e){let t={};e.length===this.widget.rows.length?t.remove=!0:t.rowIds=e,this._send("filter",t,{delay:250,coalesce:function(s){return this.target===s.target&&this.type===s.type&&this.remove===s.remove},showBusyIndicator:!1})}_onWidgetSort(e){e.column.guiOnly||this._send("sort",{columnId:e.column.id,sortAscending:e.sortAscending,sortingRemoved:e.sortingRemoved,multiSort:e.multiSort,sortingRequested:e.sortingRequested})}_onWidgetGroup(e){e.column.guiOnly||this._send("group",{columnId:e.column.id,groupAscending:e.groupAscending,groupingRemoved:e.groupingRemoved,multiGroup:e.multiGroup,groupingRequested:e.groupingRequested})}_onWidgetRowAction(e){this._sendRowAction(e.row,e.column)}_sendRowAction(e,t){t.guiOnly&&(t=p.find(this.widget.columns,r=>!r.guiOnly));let s=t?t.id:null;this._send("rowAction",{rowId:e.id,columnId:s})}_onWidgetAppLinkAction(e){this._sendAppLinkAction(e.column,e.ref)}_sendAppLinkAction(e,t){this._send("appLinkAction",{columnId:e.id,ref:t})}_sendContextColumn(e){e.guiOnly&&(e=null,this.widget.contextColumn=null);let t=null;e&&(t=e.id),this._send("property",{contextColumn:t})}_onWidgetReload(e){let t={reloadReason:e.reloadReason};this._send("reload",t)}_onWidgetExportToClipboard(e){this._send("clipboardExport"),e.preventDefault()}_onWidgetEvent(e){e.type==="rowsSelected"?this._onWidgetRowsSelected(e):e.type==="rowsChecked"?this._onWidgetRowsChecked(e):e.type==="rowsExpanded"?this._onWidgetRowsExpanded(e):e.type==="filter"?this._onWidgetFilter():e.type==="sort"?this._onWidgetSort(e):e.type==="group"?this._onWidgetGroup(e):e.type==="rowClick"?this._onWidgetRowClick(e):e.type==="rowAction"?this._onWidgetRowAction(e):e.type==="prepareCellEdit"?this._onWidgetPrepareCellEdit(e):e.type==="completeCellEdit"?this._onWidgetCompleteCellEdit(e):e.type==="cancelCellEdit"?this._onWidgetCancelCellEdit(e):e.type==="appLinkAction"?this._onWidgetAppLinkAction(e):e.type==="clipboardExport"?this._onWidgetExportToClipboard(e):e.type==="reload"?this._onWidgetReload(e):e.type==="filterAdded"?this._onWidgetFilterAdded(e):e.type==="filterRemoved"?this._onWidgetFilterRemoved(e):e.type==="columnResized"?this._onWidgetColumnResized(e):e.type==="columnMoved"?this._onWidgetColumnMoved(e):e.type==="columnBackgroundEffectChanged"?this._onWidgetColumnBackgroundEffectChanged(e):e.type==="columnOrganizeAction"?this._onWidgetColumnOrganizeAction(e):e.type==="aggregationFunctionChanged"?this._onWidgetAggregationFunctionChanged(e):e.type==="drop"&&this.widget.dragAndDropHandler?this.widget.dragAndDropHandler.uploadFiles(e):super._onWidgetEvent(e)}_onRowsInserted(e){this.widget.insertRows(e),this._rebuildingTable=!1}_onRowsDeleted(e){let t=this.widget.rowsByIds(e);this.addFilterForWidgetEventType("rowsSelected"),this.widget.deleteRows(t)}_onAllRowsDeleted(){this.addFilterForWidgetEventType("rowsSelected"),this.widget.deleteAllRows()}_onRowsUpdated(e){this.widget.updateRows(e)}_onRowsSelected(e){let t=this.widget.rowsByIds(e);this.addFilterForWidgetEventType("rowsSelected"),this.widget.selectRows(t),this.widget.selectionHandler.clearLastSelectedRowMarker()}_onRowsChecked(e){let t=[],s=[];e.forEach(r=>{let n=this.widget.rowById(r.id);r.checked?t.push(n):s.push(n)}),this.addFilterForWidgetEventType("rowsChecked"),this.widget.checkRows(t,{checked:!0,checkOnlyEnabled:!1}),this.widget.uncheckRows(s,{checkOnlyEnabled:!1})}_onRowsExpanded(e){let t=[],s=[];e.forEach(r=>{let n=this.widget.rowById(r.id);r.expanded?t.push(n):s.push(n)}),this.addFilterForWidgetEventType("rowsExpanded"),this.widget.expandRows(t),this.widget.collapseRows(s)}_onRowOrderChanged(e){let t=this.widget.rowsByIds(e);this.widget.updateRowOrder(t)}_onColumnStructureChanged(e){this._rebuildingTable=!0,this.widget.updateColumnStructure(e)}_onColumnOrderChanged(e){let t=this.widget.columnsByIds(e);this.widget.updateColumnOrder(t)}_onColumnHeadersUpdated(e){e.forEach(t=>Ne.applyTo(t)),this.widget.updateColumnHeaders(e),this.widget.tileMode&&this.widget.tableTileGridMediator&&(this.widget.tableTileGridMediator._onTableGroup(),this.widget.updateRowOrder(this.widget.rows))}_onStartCellEdit(e,t,s){let r=this.widget.columnById(e),n=this.widget.rowById(t),o=this.session.getOrCreateWidget(s,this.widget);this.widget.startCellEdit(r,n,o)}_onEndCellEdit(e){let t=this.session.getModelAdapter(e);if(!t)throw new Error("Field adapter could not be resolved. Id: "+e);this.widget.endCellEdit(t.widget)}_onRequestFocus(){this.widget.focus()}_onScrollToSelection(){this.widget.revealSelection()}_onColumnBackgroundEffectChanged(e){e.eventParts.forEach(function(t){let s=this.widget.columnById(t.columnId),r=t.backgroundEffect;this.addFilterForWidgetEvent(n=>n.type==="columnBackgroundEffectChanged"&&n.column.id===s.id&&n.column.backgroundEffect===r),s.setBackgroundEffect(r)},this)}_onRequestFocusInCell(e){let t=this.widget.rowById(e.rowId),s=this.widget.columnById(e.columnId);this.widget.focusCell(s,t)}_onAggregationFunctionChanged(e){let t=[],s=[];e.eventParts.forEach(function(r){let n=r.aggregationFunction,o=this.widget.columnById(r.columnId);this.addFilterForWidgetEvent(l=>l.type==="aggregationFunctionChanged"&&l.column.id===o.id&&l.column.aggregationFunction===n),t.push(o),s.push(n)},this),this.widget.changeAggregations(t,s)}_onFiltersChanged(e){this.addFilterForWidgetEventType("filterAdded"),this.addFilterForWidgetEventType("filterRemoved"),this.widget.setFilters(e),this._rebuildingTable||this.widget.filter()}onModelAction(e){e.type==="rowsInserted"?this._onRowsInserted(e.rows):e.type==="rowsDeleted"?this._onRowsDeleted(e.rowIds):e.type==="allRowsDeleted"?this._onAllRowsDeleted():e.type==="rowsSelected"?this._onRowsSelected(e.rowIds):e.type==="rowOrderChanged"?this._onRowOrderChanged(e.rowIds):e.type==="rowsUpdated"?this._onRowsUpdated(e.rows):e.type==="filtersChanged"?this._onFiltersChanged(e.filters):e.type==="rowsChecked"?this._onRowsChecked(e.rows):e.type==="rowsExpanded"?this._onRowsExpanded(e.rows):e.type==="columnStructureChanged"?this._onColumnStructureChanged(e.columns):e.type==="columnOrderChanged"?this._onColumnOrderChanged(e.columnIds):e.type==="columnHeadersUpdated"?this._onColumnHeadersUpdated(e.columns):e.type==="startCellEdit"?this._onStartCellEdit(e.columnId,e.rowId,e.fieldId):e.type==="endCellEdit"?this._onEndCellEdit(e.fieldId):e.type==="requestFocus"?this._onRequestFocus():e.type==="scrollToSelection"?this._onScrollToSelection():e.type==="aggregationFunctionChanged"?this._onAggregationFunctionChanged(e):e.type==="columnBackgroundEffectChanged"?this._onColumnBackgroundEffectChanged(e):e.type==="requestFocusInCell"?this._onRequestFocusInCell(e):super.onModelAction(e)}exportAdapterData(e){return e=super.exportAdapterData(e),delete e.selectedRows,e.rows=[],e.columns.forEach(t=>{delete t.classId,delete t.modelClass}),e}_initRowModel(e){let t=e||{};return t.objectType=u.nvl(t.objectType,"TableRow"),Ne.applyTo(t),t}static _createRowRemote(e){return this.modelAdapter&&(e=this.modelAdapter._initRowModel(e)),this._createRowOrig(e)}static modifyTablePrototype(){!te.get().remote||(b.replacePrototypeFunction(V,"_createRow",hn._createRowRemote,!0),b.replacePrototypeFunction(V,"_sortWhileInit",function(){this.modelAdapter?this._group():this._sortWhileInitOrig()},!0),b.replacePrototypeFunction(V,"_sortAfterInsert",function(e){this.modelAdapter?e&&this._group():this._sortAfterInsertOrig(e)},!0),b.replacePrototypeFunction(V,"_sortAfterUpdate",function(){this.modelAdapter?this._group():this._sortAfterUpdateOrig()},!0),b.replacePrototypeFunction(V,"_isSortingPossible",function(e){return this.modelAdapter?u.nvl(this.uiSortPossible,!0)&&this._isSortingPossibleOrig(e):this._isSortingPossibleOrig(e)},!0),b.replacePrototypeFunction(V,"sort",function(e,t,s,r){this.modelAdapter&&e.guiOnly||this.sortOrig(e,t,s,r)},!0),b.replacePrototypeFunction(V,"_createTileTableHeader",function(){if(!this.modelAdapter)return this._createTileTableHeaderOrig()},!0),b.replacePrototypeFunction(V,"createTiles",function(e){if(!this.modelAdapter)return this.createTilesOrig(e)},!0))}static modifyColumnPrototype(){!te.get().remote||(b.replacePrototypeFunction(De,"init",function(e){e.table&&e.table.modelAdapter&&!e.guiOnly&&(e=a().extend({},e),Ne.applyTo(e)),this.initOrig(e)},!0),b.replacePrototypeFunction(De,"_ensureCell",function(e){if(this.table.modelAdapter){let t;return b.isPlainObject(e)?(t=e,t.value=this._parseValue(t.value),t.text&&t.value===void 0&&!t.errorStatus&&(t.value=this._parseValue(t.text)),t.value===void 0&&(t.value=null)):t={value:this._parseValue(e)},Ne.applyTo(t,"Cell"),u.create(Pt,t)}return this._ensureCellOrig(e)},!0),b.replacePrototypeFunction(De,"isSortingPossible",function(){return this.table.modelAdapter?u.nvl(this.uiSortPossible,!0)&&this.installComparator():this.isSortingPossibleOrig()},!0))}static modifyBooleanColumnPrototype(){!te.get().remote||b.replacePrototypeFunction(cn,"_toggleCellValue",function(e,t){this.table.modelAdapter||this._toggleCellValueOrig(e,t)},!0)}}te.addListener("bootstrap",hn.modifyTablePrototype),te.addListener("bootstrap",hn.modifyColumnPrototype),te.addListener("bootstrap",hn.modifyBooleanColumnPrototype);function ao(i,e,t){return e=ix(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ix(i){var e=sx(i,"string");return typeof e=="symbol"?e:String(e)}function sx(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class yu{constructor(){ao(this,"objectType",void 0),ao(this,"table",void 0),ao(this,"useOnlyVisibleColumns",void 0),ao(this,"maxContentLines",void 0),ao(this,"_oldStates",void 0),ao(this,"_updateHandler",void 0),this.table=null,this.useOnlyVisibleColumns=!0,this.maxContentLines=3,this._oldStates=b.createMap(),this._updateHandler=null}init(e){$.extend(this,e)}setUseOnlyVisibleColumns(e){this.useOnlyVisibleColumns=e}setMaxContentLines(e){this.maxContentLines=e}handle(e){e?(this._compactColumns(!0),this._attachTableHandler()):(this._detachTableHandler(),this._compactColumns(!1)),this._adjustTable(e),e&&this.updateValues(this.table.rows)}_adjustTable(e){e?(this._cacheAndSetProperty("headerVisible",()=>this.table.headerVisible,()=>this.table.setHeaderVisible(!1)),this._cacheAndSetProperty("autoResizeColumns",()=>this.table.autoResizeColumns,()=>this.table.setAutoResizeColumns(!0))):(this._resetProperty("headerVisible",t=>this.table.setHeaderVisible(t)),this._resetProperty("autoResizeColumns",t=>this.table.setAutoResizeColumns(t)))}_cacheAndSetProperty(e,t,s){b.isNullOrUndefined(this._oldStates[e])&&(this._oldStates[e]=t()),s()}_resetProperty(e,t){let s=this._oldStates[e];b.isNullOrUndefined(s)||(t(s),delete this._oldStates[e])}_compactColumns(e){this.table.displayableColumns(!1).forEach(t=>t.setCompacted(e,!1)),this.table.onColumnVisibilityChanged()}_attachTableHandler(){this._updateHandler==null&&(this._updateHandler=this._onTableEvent.bind(this),this.table.on("rowsInserted rowsUpdated columnStructureChanged",this._updateHandler))}_detachTableHandler(){this._updateHandler!=null&&(this.table.off("rowsInserted rowsUpdated columnStructureChanged",this._updateHandler),this._updateHandler=null)}updateValues(e){if(e.length===0)return;let t=this._getColumns();e.forEach(s=>this._updateValue(t,s))}_updateValue(e,t){t.setCompactValue(this.buildValue(e,t))}buildValue(e,t){return this._buildValue(this._createBean(e,t))}_createBean(e,t){let s=new Mu;return this._processColumns(e,t,s),this._postProcessBean(s),s}_processColumns(e,t,s){e.forEach((r,n)=>this._processColumn(r,n,t,s))}_getColumns(){return this.table.filterColumns(e=>this._acceptColumn(e))}_acceptColumn(e){return!e.guiOnly&&(!this.useOnlyVisibleColumns||e.visible&&e.displayable)}_processColumn(e,t,s,r){this._updateBean(r,e,t,s)}_updateBean(e,t,s,r){this._acceptColumnForTitle(t,s)?e.setTitleLine(this._createCompactLine(t,s,r)):this._acceptColumnForTitleSuffix(t,s)?e.setTitleSuffixLine(this._createCompactLine(t,s,r)):this._acceptColumnForSubtitle(t,s)?e.setSubtitleLine(this._createCompactLine(t,s,r)):e.addContentLine(this._createCompactLine(t,s,r))}_acceptColumnForTitle(e,t){return t===0}_acceptColumnForSubtitle(e,t){return t===1}_acceptColumnForTitleSuffix(e,t){return!1}_createCompactLine(e,t,s){let r;this._showLabel(e,t,s)&&(r=e.headerCell());let n=e.cell(s),o=new Iu(r,n);return this._adaptCompactLine(o,e,r,n),o}_showLabel(e,t,s){return!this._acceptColumnForTitle(e,t)&&!this._acceptColumnForSubtitle(e,t)&&!this._acceptColumnForTitleSuffix(e,t)}_adaptCompactLine(e,t,s,r){if(t instanceof cn){let n="",o=r.value;o?n="X":o===null&&(n="?"),e.textBlock.setText(n)}}_postProcessBean(e){e.transform({maxContentLines:this.maxContentLines}),e.title&&!e.subtitle&&!e.titleSuffix&&!e.content&&(e.setContent(e.title),e.setTitle(""))}_buildValue(e){let t=e.title+e.titleSuffix+e.subtitle?" has-header":"",s=e.moreContent?'<div class="compact-cell-more"><span class="more-link link">'.concat(this.table.session.text("More"),"</span></div>"):"";return`
<div class="compact-cell-header">
  <div class="compact-cell-title">
    <span class="left">`.concat(e.title,`</span>
    <span class="right">`).concat(e.titleSuffix,`</span>
    </div>
  <div class="compact-cell-subtitle">`).concat(e.subtitle,`</div>
</div>
<div class="compact-cell-content`).concat(t,'">').concat(e.content,`</div>
<div class="compact-cell-more-content hidden`).concat(t,'">').concat(e.moreContent,`</div>
  `).concat(s)}_onTableEvent(e){let t;e.type==="columnStructureChanged"?t=this.table.rows:t=e.rows,this.updateValues(t)}}function Qe(i,e,t){return e=rx(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function rx(i){var e=nx(i,"string");return typeof e=="symbol"?e:String(e)}function nx(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Xt{constructor(){Qe(this,"objectType",void 0),Qe(this,"cells",void 0),Qe(this,"checked",void 0),Qe(this,"compactValue",void 0),Qe(this,"enabled",void 0),Qe(this,"filterAccepted",void 0),Qe(this,"height",void 0),Qe(this,"hasError",void 0),Qe(this,"id",void 0),Qe(this,"initialized",void 0),Qe(this,"iconId",void 0),Qe(this,"parentRow",void 0),Qe(this,"parent",void 0),Qe(this,"childRows",void 0),Qe(this,"expanded",void 0),Qe(this,"status",void 0),Qe(this,"nodeId",void 0),Qe(this,"hierarchyLevel",void 0),Qe(this,"cssClass",void 0),Qe(this,"aggregateRowAfter",void 0),Qe(this,"aggregateRowBefore",void 0),Qe(this,"lookupRow",void 0),Qe(this,"$row",void 0),Qe(this,"page",void 0),Qe(this,"expandable",void 0),this.$row=null,this.aggregateRowAfter=null,this.cells=[],this.checked=!1,this.compactValue=null,this.enabled=!0,this.filterAccepted=!0,this.height=null,this.hasError=!1,this.id=null,this.initialized=!1,this.parentRow=null,this.parent=null,this.childRows=[],this.expanded=!1,this.status=Xt.Status.NON_CHANGED,this.hierarchyLevel=0}init(e){this._init(e),this.initialized=!0}_init(e){if(!e.parent)throw new Error("missing property 'parent'");a().extend(this,e),this._initCells()}_initCells(){this.getTable().columns.forEach(e=>{if(!e.guiOnly){let t=this.cells[e.index];t=e.initCell(t,this),this.cells[e.index]=t}})}animateExpansion(){let e=this.$row;if(!e)return;let t=e.find(".table-row-control");this.expanded?t.addClassForAnimation("expand-rotate"):t.addClassForAnimation("collapse-rotate")}hasFilterAcceptedChildren(){return this.childRows.some(e=>e.filterAccepted||e.hasFilterAcceptedChildren())}getTable(){return this.parent}setCompactValue(e){this.compactValue=e}setFilterAccepted(e){this.filterAccepted=e}}Qe(Xt,"Status",{NON_CHANGED:"nonChanged",INSERTED:"inserted",UPDATED:"updated"});function Sr(i,e,t){return e=ox(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ox(i){var e=lx(i,"string");return typeof e=="symbol"?e:String(e)}function lx(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Et{constructor(e,t){Sr(this,"session",void 0),Sr(this,"locale",void 0),Sr(this,"_allData",void 0),Sr(this,"_allAxis",void 0),Sr(this,"_rows",void 0),Sr(this,"_table",void 0),this.session=t,this.locale=t.locale,this._allData=[],this._allAxis=[],this._rows=e.rows,this._table=e}addData(e,t){let s={},r=this.locale;return this._allData.push(s),s.column=e,s.format=n=>r.decimalFormat.format(n),t===Et.NumberGroup.COUNT?(s.norm=n=>1,s.group=n=>n.length):t===Et.NumberGroup.SUM?(s.norm=n=>isNaN(n)||n===null||n===""?null:parseFloat(n),s.group=n=>n.reduce((o,l)=>o+l)):t===Et.NumberGroup.AVG&&(s.norm=n=>isNaN(n)||n===null||n===""?null:parseFloat(n),s.group=n=>{let o=n.reduce((h,d)=>h+d),l=n.reduce((h,d)=>d===null?h:h+1,0);return l===0?null:o/l}),s}addAxis(e,t){let s=[],r=this.locale,n=this.session,o=this.session.text.bind(this.session),l=o("ui.EmptyCell");return this._allAxis.push(s),s.column=e,s.normTable=[],s.sortCodeMap={},s.add=h=>{s.indexOf(h)===-1&&s.push(h)},s.reorder=()=>{s.sort((h,d)=>{if(h===null)return 1;if(d===null)return-1;let c=s.sortCodeMap[h],f=s.sortCodeMap[d];return!b.isNullOrUndefined(c)||!b.isNullOrUndefined(f)?mt.NUMERIC.compare(c,f):h-d})},s.norm=h=>{if(h===null||h==="")return null;let d=s.normTable.indexOf(h);return d===-1?s.normTable.push(h)-1:d},s.format=h=>h===null?l:s.normTable[h],s.deterministicKeyToKey=h=>s.norm(h),s.keyToDeterministicKey=h=>h===null?null:s.format(h),s.normDeterministic=h=>s.keyToDeterministicKey(s.norm(h)),e instanceof Lu?(t===Et.DateGroup.NONE?(s.norm=h=>h===null||h===""?null:h.getTime(),s.format=h=>{if(h===null)return null;let d=e.format;return d?d=xt.ensure(r,d):d=r.dateFormat,d.format(new Date(h))}):t===Et.DateGroup.YEAR?(s.norm=h=>h===null||h===""?null:h.getFullYear(),s.format=h=>h===null?l:String(h)):t===Et.DateGroup.MONTH?(s.norm=h=>h===null||h===""?null:h.getMonth(),s.format=h=>h===null?l:r.dateFormatSymbols.months[h]):t===Et.DateGroup.WEEKDAY?(s.norm=h=>h===null||h===""?null:(h.getDay()+7-r.dateFormatSymbols.firstDayOfWeek)%7,s.format=h=>h===null?l:r.dateFormatSymbols.weekdaysOrdered[h]):t===Et.DateGroup.DATE&&(s.norm=h=>h===null||h===""?null:w.trunc(h).getTime(),s.format=h=>h===null?l:w.format(new Date(h),r,r.dateFormatPatternDefault)),s.deterministicKeyToKey=h=>h,s.keyToDeterministicKey=h=>h,s.normDeterministic=h=>s.norm(h)):e instanceof Bi?(s.norm=h=>isNaN(h)||h===null||h===""?null:parseFloat(h),s.format=h=>isNaN(h)||h===null?l:e.decimalFormat.format(h),s.deterministicKeyToKey=h=>h,s.keyToDeterministicKey=h=>h,s.normDeterministic=h=>s.norm(h)):e instanceof cn?(s.norm=h=>e.triStateEnabled&&h===null?-1:h===!0?1:0,s.format=h=>{if(h===-1)return o("ui.BooleanColumnGroupingMixed");if(h===0)return o("ui.BooleanColumnGroupingFalse");if(h===1)return o("ui.BooleanColumnGroupingTrue")},s.deterministicKeyToKey=h=>h,s.keyToDeterministicKey=h=>h,s.normDeterministic=h=>s.norm(h)):e instanceof Ra?(s.textIsIcon=!0,s.deterministicKeyToKey=h=>h,s.keyToDeterministicKey=h=>h,s.normDeterministic=h=>s.norm(h)):s.reorder=()=>{let h=mt.TEXT;h.install(n),s.sort((d,c)=>{if(d===null)return 1;if(c===null)return-1;let f=s.sortCodeMap[d],m=s.sortCodeMap[c];return!b.isNullOrUndefined(f)||!b.isNullOrUndefined(m)?mt.NUMERIC.compare(f,m):h.compare(s.format(d),s.format(c))})},s}calculate(){let e={},t=0;for(let s=0;s<this._rows.length;s++){let r=this._rows[s],n=[];for(let h=0;h<this._allAxis.length;h++){let d=this._allAxis[h].column,c=d.cellValueOrTextForCalculation(r),f=this._allAxis[h].norm(c);if(f!==void 0){this._allAxis[h].add(f);let m=d.cell(r);m.sortCode!==null&&(this._allAxis[h].sortCodeMap[f]=m.sortCode),n.push(f)}}let o=JSON.stringify(n),l=[];for(let h=0;h<this._allData.length;h++){let d=this._table.cellValue(this._allData[h].column,r),c=this._allData[h].norm(d);c!==void 0&&l.push(c)}e[o]?e[o].push(l):(e[o]=[l],t++)}for(let s=0;s<this._allData.length;s++){let r=this._allData[s];r.total=0,r.min=null,r.max=null;for(let o in e)if(e.hasOwnProperty(o)){let l=e[o],h=[];for(let c=0;c<l.length;c++)h.push(l[c][s]);let d=this._allData[s].group(h);if(e[o][s]=d,r.total+=d,d===null)continue;(d<r.min||r.min===null)&&(r.min=d),(d>r.max||r.min===null)&&(r.max=d)}u.nvl(r.max,0)===0&&(r.max=.1);let n=Math.ceil(Math.log(r.max)/Math.LN10)-1;r.max=Math.ceil(r.max/Math.pow(10,n))*Math.pow(10,n),r.max=Math.ceil(r.max/4)*4}for(let s=0;s<this._allAxis.length;s++){let r=this._allAxis[s];r.min=p.min(r),r.max=p.max(r),r.indexOf(null)!==-1&&(r.max=r.max+1),r.reorder()}return e.getValue=s=>{let r=JSON.stringify(s);return e.hasOwnProperty(r)?e[r]:null},e.length=t,e}columnCount(e){let t=this.columns(e),s=[],r=0;for(let n=0;n<t.length;n++){let o=t[n];s.push([o,[]]);let l=s[r][1];for(let h=0;h<this._rows.length;h++){let d=this._rows[h],c=o.cellValueOrTextForCalculation(d);l.indexOf(c)===-1&&l.push(c)}s[r][1]=l.length,r++}return s}isEmpty(){return this._rows.length===0||this.columns().length===0}columns(e){return e=u.nvl(e,!0),this._table.visibleColumns().filter(t=>!(t.guiOnly||e&&t instanceof Bi))}isMatrixValid(){return this._table.rows.length===0||this.columns(!1).length===this._table.rows[0].cells.length}}Sr(Et,"DateGroup",{NONE:0,YEAR:256,MONTH:257,WEEKDAY:258,DATE:259}),Sr(Et,"NumberGroup",{COUNT:-1,SUM:1,AVG:2});function $e(i,e,t){return e=ax(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ax(i){var e=hx(i,"string");return typeof e=="symbol"?e:String(e)}function hx(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class bu extends I{constructor(){super(),$e(this,"table",void 0),$e(this,"filterText",void 0),$e(this,"animating",void 0),$e(this,"open",void 0),$e(this,"resizing",void 0),$e(this,"selectedControl",void 0),$e(this,"searchFieldKeyStrokeContext",void 0),$e(this,"$controlContent",void 0),$e(this,"$controlContainer",void 0),$e(this,"$resizer",void 0),$e(this,"$clearIcon",void 0),$e(this,"_$controls",void 0),$e(this,"_$info",void 0),$e(this,"_compactStyle",void 0),$e(this,"_tableInfoTooltip",void 0),$e(this,"_tableStatusTooltip",void 0),$e(this,"_$infoLoad",void 0),$e(this,"_$infoSelection",void 0),$e(this,"_tableRowsChangedHandler",void 0),$e(this,"_tableFilterHandler",void 0),$e(this,"_tableFilterAddedHandler",void 0),$e(this,"_tableFilterRemovedHandler",void 0),$e(this,"_tableRowsSelectedHandler",void 0),$e(this,"_tableStatusChangedHandler",void 0),$e(this,"_tablePropertyChangeHandler",void 0),$e(this,"_focusFilterFieldKeyStroke",void 0),$e(this,"_autoHideTableStatusTooltipTimeoutId",void 0),$e(this,"_$window",void 0),$e(this,"_$body",void 0),$e(this,"_$infoFilter",void 0),$e(this,"_$infoTableStatus",void 0),$e(this,"_$infoTableStatusIcon",void 0),$e(this,"_$textFilter",void 0),this._compactStyle=!1,this.animating=!1,this.open=!1,this.resizing=!1,this.table=null,this._tableRowsChangedHandler=this._onTableRowsChanged.bind(this),this._tableFilterHandler=this._onTableFilter.bind(this),this._tableFilterAddedHandler=this._onTableFilterAdded.bind(this),this._tableFilterRemovedHandler=this._onTableFilterRemoved.bind(this),this._tableRowsSelectedHandler=this._onTableRowsSelected.bind(this),this._tableStatusChangedHandler=this._onTableStatusChanged.bind(this),this._tablePropertyChangeHandler=this._onTablePropertyChange.bind(this)}_init(e){super._init(e),this.searchFieldKeyStrokeContext=new As,this.searchFieldKeyStrokeContext.$bindTarget=()=>this._$textFilter,this.searchFieldKeyStrokeContext.$scopeTarget=()=>this._$textFilter,this._focusFilterFieldKeyStroke=null}_render(){let e,t;this.$container=this.$parent.appendDiv("table-footer"),this._$window=this.$parent.window(),this._$body=this.$parent.body(),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new vu(this)),this.$controlContainer=this.$container.appendDiv("table-control-container").hide(),this.$controlContent=this.$controlContainer.appendDiv("table-control-content focus-boundary"),this._$controls=this.$container.appendDiv("table-controls"),this._$info=this.$container.appendDiv("table-info"),t=this._$info.appendDiv("table-filter"),this._$textFilter=Z.makeTextField(this.$container,"table-text-filter").appendTo(t).on("input","",this._createOnFilterFieldInputFunction().bind(this)).placeholder(this.session.text("ui.FilterBy_")),this.table.$container.data("filter-field",this._$textFilter),this._focusFilterFieldKeyStroke=new Ol(this.table),this.table.keyStrokeContext.registerKeyStroke(this._focusFilterFieldKeyStroke),e=this.table.getFilter(fs.TYPE),e&&this._$textFilter.val(e.text),this.$clearIcon=t.appendSpan("clear-icon unfocusable action text-field-icon").on("mousedown",this._onDeleteFilterMouseDown.bind(this)),this._$infoLoad=this._$info.appendDiv("table-info-item table-info-load").on("click","",this._onInfoLoadClick.bind(this)),this._$infoFilter=this._$info.appendDiv("table-info-item table-info-filter").on("click","",this._onInfoFilterClick.bind(this)),this._$infoSelection=this._$info.appendDiv("table-info-item table-info-selection").on("click","",this._onInfoSelectionClick.bind(this)),this._$infoTableStatus=this._$info.appendDiv("table-info-item table-info-status").on("mousedown",this._onStatusMouseDown.bind(this)),this._$infoTableStatusIcon=this._$infoTableStatus.appendSpan("icon font-icon"),this._renderControls(),this._renderInfo(),this._updateInfoVisibility(),this.table.on("rowsInserted",this._tableRowsChangedHandler),this.table.on("rowsDeleted",this._tableRowsChangedHandler),this.table.on("allRowsDeleted",this._tableRowsChangedHandler),this.table.on("filter",this._tableFilterHandler),this.table.on("filterAdded",this._tableFilterAddedHandler),this.table.on("filterRemoved",this._tableFilterRemovedHandler),this.table.on("rowsSelected",this._tableRowsSelectedHandler),this.table.on("statusChanged",this._tableStatusChangedHandler),this.table.on("propertyChange",this._tablePropertyChangeHandler),this.session.keyStrokeManager.installKeyStrokeContext(this.searchFieldKeyStrokeContext)}getFocusableElement(){return this._$textFilter}_renderProperties(){this._updateHasFilterText()}_remove(){this.session.keyStrokeManager.uninstallKeyStrokeContext(this.searchFieldKeyStrokeContext),this._hideTableStatusTooltip(),this.$resizer=null,this.$controlContainer.stop(!1,!0),this.animating=!1,this.open=!1,this.table.keyStrokeContext.unregisterKeyStroke(this._focusFilterFieldKeyStroke),this._focusFilterFieldKeyStroke=null,this.table.off("rowsInserted",this._tableRowsChangedHandler),this.table.off("rowsDeleted",this._tableRowsChangedHandler),this.table.off("allRowsDeleted",this._tableRowsChangedHandler),this.table.off("filter",this._tableFilterHandler),this.table.off("filterAdded",this._tableFilterAddedHandler),this.table.off("filterRemoved",this._tableFilterRemovedHandler),this.table.off("rowsSelected",this._tableRowsSelectedHandler),this.table.off("statusChanged",this._tableStatusChangedHandler),this.table.off("propertyChange",this._tablePropertyChangeHandler),super._remove()}_renderResizerVisible(){this.selectedControl.resizerVisible?(this._renderResizer(),this.$controlContainer.addClass("has-resizer")):this.$resizer&&(this.$resizer.remove(),this.$resizer=null,this.$controlContainer.removeClass("has-resizer"))}_renderResizer(){if(this.$resizer)return;this.$resizer=this.$controlContainer.prependDiv("table-control-resize").on("mousedown","",e.bind(this));function e(t){let s=this.$controlContainer.height(),r=Math.floor(t.pageY);this._$window.on("mousemove.tablefooter",n.bind(this)).one("mouseup",o.bind(this)),this._$body.addClass("row-resize"),this.resizing=!0;function n(l){if(!this.rendered)return;let d=Math.floor(l.pageY)-r,c=this.table.$container.height()-this.table.footer.$container.height(),f=Math.min(s-d,c);this.$controlContainer.height(f);let m=v.insets(this.$controlContainer);this.$controlContent.outerHeight(f-m.vertical()),this._revalidateTableLayout()}function o(){this.selectedControl&&this.rendered&&this.$controlContainer.height()<100&&this.selectedControl.setSelected(!1),this._$window.off("mousemove.tablefooter"),this._$body.removeClass("row-resize"),this.resizing=!1}return!1}}_renderControls(){let e=this.table.tableControls;e?e.forEach(t=>{t.setParent(this),t.render(this._$controls)}):this._$controls.empty()}_renderInfo(){this._renderInfoLoad(),this._renderInfoTableStatus(),this._renderInfoFilter(),this._renderInfoSelection()}_renderInfoLoad(){let e=this._$infoLoad,t=this.table.rows.length,s=this.table.estimatedRowCount,r=this.table.maxRowCount;e.empty(),this._compactStyle?(t<=1?e.appendSpan().text(this.session.text("ui.NumRowLoadedMin")):e.appendSpan().text(this.session.text("ui.NumRowsLoadedMin")),e.appendSpan("table-info-button").text(this.computeCountInfo(t))):(t<=1?e.appendSpan().text(this.session.text("ui.NumRowLoaded",this.computeCountInfo(t))):s&&s>t?e.appendSpan().text(this.session.text("ui.NumRowsLoaded",this.computeCountInfo(t,s))):e.appendSpan().text(this.session.text("ui.NumRowsLoaded",this.computeCountInfo(t))),this.table.hasReloadHandler&&(s&&r&&t<s&&t<r?s<r?e.appendSpan("table-info-button").text(this.session.text("ui.LoadAllData")).appendTo(e):e.appendSpan("table-info-button").text(this.session.text("ui.LoadNData",this.computeCountInfo(r))).appendTo(e):e.appendSpan("table-info-button").text(this.session.text("ui.ReloadData")).appendTo(e))),e.setEnabled(this.table.hasReloadHandler),this.htmlComp.layouting||this.invalidateLayoutTree(!1)}_renderInfoFilter(){let e=this._$infoFilter,t=this.table.filteredRows().length,s=this.table.filteredBy().join(", ");e.empty(),this._compactStyle?(t<=1?e.appendSpan().text(this.session.text("ui.NumRowFilteredMin")):e.appendSpan().text(this.session.text("ui.NumRowsFilteredMin")),e.appendSpan("table-info-button").text(this.computeCountInfo(t))):(s?t<=1?e.appendSpan().text(this.session.text("ui.NumRowFilteredBy",this.computeCountInfo(t),s)):e.appendSpan().text(this.session.text("ui.NumRowsFilteredBy",this.computeCountInfo(t),s)):t<=1?e.appendSpan().text(this.session.text("ui.NumRowFiltered",this.computeCountInfo(t))):e.appendSpan().text(this.session.text("ui.NumRowsFiltered",this.computeCountInfo(t))),this.table.hasUserFilter()&&e.appendSpan("table-info-button").text(this.session.text("ui.RemoveFilter")).appendTo(e)),this.htmlComp.layouting||this.invalidateLayoutTree(!1)}_renderInfoSelection(){let e=this._$infoSelection,t=this.table.filteredRows().length,s=this.table.selectedRows.length,r=t>0&&t===s;e.empty(),this._compactStyle?(s<=1?e.appendSpan().text(this.session.text("ui.NumRowSelectedMin")):e.appendSpan().text(this.session.text("ui.NumRowsSelectedMin")),e.appendSpan("table-info-button").text(this.computeCountInfo(s))):(s<=1?e.appendSpan().text(this.session.text("ui.NumRowSelected",this.computeCountInfo(s))):e.appendSpan().text(this.session.text("ui.NumRowsSelected",this.computeCountInfo(s))),e.appendSpan("table-info-button").text(this.session.text(r?"ui.SelectNone":"ui.SelectAll")).appendTo(e)),this.htmlComp.layouting||this.invalidateLayoutTree(!1)}_renderInfoTableStatus(){let e=this._$infoTableStatus,t=this.table.tableStatus;e.removeClass(E.SEVERITY_CSS_CLASSES),t&&e.addClass(t.cssClass()),this.htmlComp.layouting||this.invalidateLayoutTree(!1)}_updateInfoVisibility(){this._updateInfoFilterVisibility(),this._updateInfoSelectionVisibility(),this._updateInfoTableStatusVisibility()}_updateInfoFilterVisibility(){let e=this.table.filteredBy().length>0;this._setInfoVisible(this._$infoFilter,e)}_updateInfoSelectionVisibility(){let e=this.table.multiSelect;this._setInfoVisible(this._$infoSelection,e)}_updateInfoTableStatusVisibility(){if(this.table.tableStatus){let t=null;u.isOneOf(this.table.tableStatus.uiState,"user-hidden","auto-hidden")||(this._$infoTableStatus.addClass("tooltip-active"),t=function(){this.table.tableStatus&&!u.isOneOf(this.table.tableStatus.uiState,"user-hidden","auto-hidden")&&this._showTableStatusTooltip()}.bind(this)),this._setInfoVisible(this._$infoTableStatus,!0,t)}else this._hideTableStatusTooltip(),this._setInfoVisible(this._$infoTableStatus,!1)}_setInfoVisible(e,t,s){if(e.isVisible()===t&&!(t&&e.hasClass("hiding"))){s&&s();return}if(!this.rendered){e.setVisible(t);return}if(t){let n={progress:this.revalidateLayout.bind(this),complete:()=>{s&&s()}};e.data("animationComplete",n.complete),e[0].style.width===""&&e.cssWidth(0),e.stop().removeClass("hiding").setVisible(!0).cssWidthToContentAnimated(n)}else e.addClass("hiding"),e.stop().animate({width:0},{progress:this.revalidateLayout.bind(this),complete:()=>{e.removeClass("hiding"),e.setVisible(!1)}})}_toggleTableInfoTooltip(e,t){this._tableInfoTooltip?this._tableInfoTooltip.destroy():(this._tableInfoTooltip=u.create(t,{parent:this,tableFooter:this,arrowPosition:50,arrowPositionUnit:"%",$anchor:e}),this._tableInfoTooltip.one("destroy",()=>{this._tableInfoTooltip=null}),this._tableInfoTooltip.render())}computeCountInfo(e,t){return e=u.nvl(e,0),t?this.session.text("ui.TableRowCount",this.session.text("ui.CountOfApproxTotal",this.session.locale.decimalFormat.format(e),this.session.locale.decimalFormat.format(t))):e===0?this._compactStyle?this.session.text("ui.TableRowCount",this.session.locale.decimalFormat.format(0)):this.session.text("ui.TableRowCount0"):e===1?this.session.text("ui.TableRowCount1"):this.session.text("ui.TableRowCount",this.session.locale.decimalFormat.format(e))}_revalidateTableLayout(){this.table.htmlComp.revalidateLayoutTree()}openControlContainer(e){this.open;let t=this.$controlContent.data("control");this.animating&&t!==e&&t.onControlContainerClosed(),this.animating=!0,this.open=!0;let s=this.computeControlContainerHeight(this.table,e),r=v.insets(this.$controlContainer);this.$controlContent.outerHeight(s-r.vertical()),this.$controlContainer[0].style.height===""&&this.$controlContainer.outerHeight(0),this.$controlContainer.outerHeight()>s&&this.table.invalidateLayoutTree(),this.$controlContainer.stop(!0).show().delay(1).animate({height:s},{duration:this.rendered?e.animateDuration:0,complete:function(){this.animating=!1,e.onControlContainerOpened(),this.table.invalidateLayoutTree()}.bind(this)})}closeControlContainer(e,t){if(!this.open)return;t=a().extend({},{animate:!0},t),this.open=!1,this.animating=!0,this.table.invalidateLayoutTree();let s=function(){this.animating=!1,this.$controlContainer.hide(),e.onControlContainerClosed()}.bind(this);t.animate?this.$controlContainer.stop(!0).show().animate({height:0},{duration:e.animateDuration,complete:s}):s()}computeControlContainerHeight(e,t,s){let r=0,n=0,o=v.size(e.$container).height,l=0,h=v.margins(u.nvl(e.$data,e.$container)),d=h.top+h.bottom,c=e.menuBar,f=e.footer,m=e.htmlComp,_=m.availableSize().subtract(m.insets());if(!!f){if(e.menuBarVisible&&c.visible){let C=T.get(c.$container);r=er.size(C,_).height}if(n=v.size(f.$container).height,f.open&&(f.animating?l=u.nvl(t&&t.height,l):(l=v.size(f.$controlContainer).height,!f.resizing&&s&&(l=Math.max(t&&t.height,l)))),this.table.htmlComp.layouted){let C=o-(d+r+n);l=Math.min(l,C)}return l}}_hideTableStatusTooltip(){clearTimeout(this._autoHideTableStatusTooltipTimeoutId),this._tableStatusTooltip&&this._tableStatusTooltip.destroy()}_showTableStatusTooltip(){if(this._tableStatusTooltip&&(this._tableStatusTooltip.destroy(),this._tableStatusTooltip=null),!this.rendered&&!this.rendering)return;let e=this.table.tableStatus,t=e?e.message:null;y.empty(t)||(this._tableStatusTooltip=u.create(ls,{parent:this,text:t,severity:e.severity,autoRemove:!e.isError(),$anchor:this._$infoTableStatusIcon}),this._tableStatusTooltip.one("destroy",()=>{this._tableStatusTooltip=null}),this._tableStatusTooltip.render(),this._$infoTableStatus.addClass("tooltip-active"),this._tableStatusTooltip.on("remove",()=>{this._$infoTableStatus.removeClass("tooltip-active"),clearTimeout(this._autoHideTableStatusTooltipTimeoutId),this.table.tableStatus&&!this.table.tableStatus.isError()&&(this.table.tableStatus.uiState="auto-hidden")}),clearTimeout(this._autoHideTableStatusTooltipTimeoutId),!e.isError()&&!e.isWarning()&&!e.uiState&&(this.table.tableStatus.uiState="auto-hidden",this._autoHideTableStatusTooltipTimeoutId=setTimeout(()=>this._hideTableStatusTooltip(),5e3)))}_updateHasFilterText(){this._$textFilter.toggleClass("has-text",!!this._$textFilter.val())}onControlSelected(e){let t=this.selectedControl;this.selectedControl=e,e&&(this._renderResizerVisible(),t&&t.height!==e.height&&this.openControlContainer(e))}_onStatusMouseDown(e){this._tableStatusTooltip?(this._hideTableStatusTooltip(),this.table.tableStatus.uiState="user-hidden"):(this._showTableStatusTooltip(),this._tableStatusTooltip.rendered&&(this.table.tableStatus.uiState="user-shown"))}_createOnFilterFieldInputFunction(){let e=a().debounce(this._applyFilter.bind(this));return function(t){this._updateHasFilterText(),e()}}_onDeleteFilterMouseDown(e){this._$textFilter.val(""),this._updateHasFilterText(),this._applyFilter(),e.preventDefault()}_applyFilter(){let e=this._$textFilter.val();if(this.filterText!==e)if(this.filterText=e,e){let t=u.create(fs,{session:this.session,table:this.table});t.text=e,this.table.addFilter(t)}else this.table.removeFilterByKey(fs.TYPE)}_onInfoLoadClick(){if(!!this._$infoLoad.isEnabled())if(this._compactStyle)this._toggleTableInfoTooltip(this._$infoLoad,"TableInfoLoadTooltip");else{let e=this.table.rows.length,t=this.table.estimatedRowCount,s=this.table.maxRowCount;t&&s&&e<t&&e<s?this.table.reload(V.ReloadReason.OVERRIDE_ROW_LIMIT):this.table.reload()}}_onInfoFilterClick(){this._compactStyle?this._toggleTableInfoTooltip(this._$infoFilter,"TableInfoFilterTooltip"):this.table.resetUserFilter()}_onInfoSelectionClick(){this._compactStyle?this._toggleTableInfoTooltip(this._$infoSelection,"TableInfoSelectionTooltip"):this.table.toggleSelection()}_onTableRowsChanged(e){this._renderInfoLoad()}_onTableFilter(e){this._renderInfoFilter(),this._updateInfoFilterVisibility(),this._renderInfoSelection()}_onTableFilterAdded(e){if(this._renderInfoFilter(),this._updateInfoFilterVisibility(),e.filter instanceof Qt&&e.filter.filterType===fs.TYPE){let t=e.filter;this._$textFilter.val()!==t.text&&(this._$textFilter.val(t.text),this._updateHasFilterText(),this._applyFilter())}}_onTableFilterRemoved(e){this._renderInfoFilter(),this._updateInfoFilterVisibility(),e.filter instanceof Qt&&e.filter.filterType===fs.TYPE&&(this._$textFilter.val(""),this._updateHasFilterText(),this._applyFilter())}_onTableRowsSelected(e){this._renderInfoSelection()}_onTableStatusChanged(e){this._renderInfoTableStatus(),this._updateInfoTableStatusVisibility()}_onTablePropertyChange(e){e.propertyName==="multiSelect"&&this._updateInfoSelectionVisibility()}}function dx(i,e,t){return e=ux(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ux(i){var e=cx(i,"string");return typeof e=="symbol"?e:String(e)}function cx(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class vu extends ee{constructor(e){super(),dx(this,"_tableFooter",void 0),this._tableFooter=e}layout(e){let t,s=this._tableFooter._$controls,r=this._tableFooter._$info,n=r.find(".table-info-item"),o=v.size(e).width,l=v.size(s,!0).width,h=v.size(r,!0).width;n.each(function(){let f=a()(this);f.isVisible()&&!f.hasClass("hiding")&&(f.data("oldWidth",f.outerWidth()),f.css("width","auto"))}),r.css("max-width",""),this._tableFooter._compactStyle&&(this._tableFooter._compactStyle=!1,this._tableFooter._renderInfo()),h=v.size(r,!0).width,l+h<=o&&(this._tableFooter._tableInfoTooltip&&this._tableFooter._tableInfoTooltip.destroy(),t=!0),t||(this._tableFooter._compactStyle=!0,this._tableFooter._renderInfo(),h=v.size(r,!0).width,l+h<=o&&(t=!0),r.css("max-width",Math.max(o-l-r.cssMarginX(),0)));let d=this._tableFooter.htmlComp.layouted;this._setInfoItemsSize(n,d);let c=this._tableFooter._tableStatusTooltip;c&&c.rendered&&c.position(),this._tableFooter._tableInfoTooltip&&this._tableFooter._tableInfoTooltip.rendered&&this._tableFooter._tableInfoTooltip.position(),this._tableFooter.table.tableControls.forEach(f=>f.revalidateLayout())}_setInfoItemsSize(e,t){e.each(function(){let s=a()(this);if(s.isVisible()&&!s.hasClass("hiding")){let r=s.data("animationComplete");t?(s.stop().cssWidthAnimated(s.data("oldWidth"),s.outerWidth(),{complete:r}),s.removeData("oldWidth")):s.cssWidth(s.outerWidth())}})}}function px(i,e,t){return e=fx(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function fx(i){var e=mx(i,"string");return typeof e=="symbol"?e:String(e)}function mx(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ng extends ls{constructor(){super(...arguments),px(this,"tableFooter",void 0)}_init(e){super._init(e),this.tableFooter=e.tableFooter;let t=u.create(ne,{parent:this,text:this.session.text("ui.RemoveFilter")});t.on("action",this._onRemoveFilterClick.bind(this)),this.setMenus(t)}_renderText(){let e=this.tableFooter.table,t=e.filteredRows().length,s=e.filteredBy().join(", ");this.$content.appendSpan().text(this.session.text("ui.NumRowsFilteredBy",this.tableFooter.computeCountInfo(t),s))}_onRemoveFilterClick(){this.tableFooter.table.resetUserFilter(),this.destroy()}}function gx(i,e,t){return e=_x(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function _x(i){var e=yx(i,"string");return typeof e=="symbol"?e:String(e)}function yx(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class og extends ls{constructor(){super(...arguments),gx(this,"tableFooter",void 0)}_init(e){super._init(e),this.tableFooter=e.tableFooter;let t=u.create(ne,{parent:this,text:this.session.text("ui.ReloadData")});t.on("action",this._onReloadClick.bind(this)),this.setMenus(t)}_renderText(){let e=this.tableFooter.table,t=e.rows.length;this.$content.text(this.session.text("ui.NumRowsLoaded",this.tableFooter.computeCountInfo(t)))}_onReloadClick(){this.tableFooter.table.reload(),this.destroy()}}function bx(i,e,t){return e=vx(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function vx(i){var e=wx(i,"string");return typeof e=="symbol"?e:String(e)}function wx(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class lg extends ls{constructor(){super(...arguments),bx(this,"tableFooter",void 0)}_init(e){super._init(e),this.tableFooter=e.tableFooter;let t=u.create(ne,{parent:this,text:this.session.text("ui.SelectNone")});t.on("action",this._onSelectNoneClick.bind(this));let s=u.create(ne,{parent:this,text:this.session.text("ui.SelectAll")});s.on("action",this._onSelectAllClick.bind(this)),this.setMenus([t,s])}_renderText(){let e=this.tableFooter.table,t=e.selectedRows.length;this.$content.text(this.session.text("ui.NumRowsSelected",this.tableFooter.computeCountInfo(t)))}_onSelectNoneClick(){this.tableFooter.table.deselectAll(),this.destroy()}_onSelectAllClick(){this.tableFooter.table.selectAll(),this.destroy()}}function Jt(i,e,t){return e=Tx(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Tx(i){var e=Cx(i,"string");return typeof e=="symbol"?e:String(e)}function Cx(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class wu extends I{constructor(){super(),Jt(this,"headerMenusEnabled",void 0),Jt(this,"table",void 0),Jt(this,"dragging",void 0),Jt(this,"columnMoved",void 0),Jt(this,"menuBar",void 0),Jt(this,"tableHeaderMenu",void 0),Jt(this,"$menuBarContainer",void 0),Jt(this,"$filler",void 0),Jt(this,"_tableDataScrollHandler",void 0),Jt(this,"_tableAddFilterRemovedHandler",void 0),Jt(this,"_tableColumnResizedHandler",void 0),Jt(this,"_tableColumnMovedHandler",void 0),Jt(this,"_renderedColumns",void 0),Jt(this,"_$window",void 0),Jt(this,"_$body",void 0),Jt(this,"_fixTimeout",void 0),this.dragging=!1,this.headerMenusEnabled=!0,this.table=null,this._tableDataScrollHandler=this._onTableDataScroll.bind(this),this._tableAddFilterRemovedHandler=this._onTableAddFilterRemoved.bind(this),this._tableColumnResizedHandler=this._onTableColumnResized.bind(this),this._tableColumnMovedHandler=this._onTableColumnMoved.bind(this),this._renderedColumns=[]}_init(e){super._init(e),this.menuBar=u.create(ce,{parent:this,tabbable:!1,position:ce.Position.BOTTOM,menuOrder:new nr}),this.menuBar.on("propertyChange",this._onMenuBarPropertyChange.bind(this)),this.updateMenuBar()}_render(){this.$container=this.table.$data.beforeDiv("table-header").cssBorderLeftWidth(this.table.rowBorders.left||""),this.$filler=this.$container.appendDiv("table-header-item filler").css("visibility","hidden"),this.$menuBarContainer=this.$container.appendDiv("menubar-container").setVisible(this.menuBar.visible),this.menuBar.render(this.$menuBarContainer),this._$window=this.$container.window(),this._$body=this.$container.body(),this._renderColumns(),this.table.$data.on("scroll",this._tableDataScrollHandler),this.table.on("filterAdded",this._tableAddFilterRemovedHandler),this.table.on("filterRemoved",this._tableAddFilterRemovedHandler),this.table.on("columnResized",this._tableColumnResizedHandler),this.table.on("columnMoved",this._tableColumnMovedHandler)}_remove(){this.table.$data.off("scroll",this._tableDataScrollHandler),this.table.off("filterAdded",this._tableAddFilterRemovedHandler),this.table.off("filterRemoved",this._tableAddFilterRemovedHandler),this.table.off("columnResized",this._tableColumnResizedHandler),this.table.off("columnMoved",this._tableColumnMovedHandler),this._removeColumns(),super._remove()}rerenderColumns(){this._removeColumns(),this._renderColumns()}_renderColumns(){let e=this._visibleColumns();e.forEach(this._renderColumn,this),e.length===0&&this.$filler.css("visibility","visible").html("&nbsp;").addClass("empty"),this._reconcileScrollPos()}_renderColumn(e,t){let s=e.realWidthIfAvailable(),r=this._visibleColumns(),n=t===0,o=t===r.length-1,l=this.$filler.beforeDiv("table-header-item").setEnabled(this.enabled).data("column",e),h=v.margins(l);s-=h.horizontal(),l.cssMinWidth(s).cssMaxWidth(s),l.appendSpan("table-header-item-text"),this.enabled&&l.on("click",this._onHeaderItemClick.bind(this)).on("mousedown",this._onHeaderItemMouseDown.bind(this)),this.session.inspector&&Hn.applyInfo(e,l),n&&l.addClass("first"),o&&l.addClass("last"),e.$header=l,this._installHeaderItemTooltip(e),this._decorateHeader(e);let d=e.showSeparator;if(o&&!this.enabled&&(d=!1),d){let c=this.$filler.beforeDiv("table-header-resize");e.fixedWidth||!this.enabled?c.setEnabled(!1):c.on("mousedown","",this._onSeparatorMouseDown.bind(this)).on("dblclick",this._onSeparatorDblclick.bind(this)),e.$separator=c}this._renderedColumns.push(e)}_removeColumns(){this._renderedColumns.slice().forEach(this._removeColumn,this)}_removeColumn(e){e.$header&&(e.$header.remove(),e.$header=null),e.$separator&&(e.$separator.remove(),e.$separator=null),p.remove(this._renderedColumns,e)}resizeHeaderItem(e){if(!e||!e.$header)return;let t=e.$header,s=e.realWidthIfAvailable(),r=v.margins(t),n=this.menuBar.visible?this.$menuBarContainer.outerWidth(!0):0,o=this._visibleColumns(),l=o.indexOf(e),h=l===o.length-1;if(s-=r.horizontal(),h&&n>0){let d=this.$container.width()-this.table.rowWidth+v.insets(this.$container).right;if(d<n){let c=n;e.$separator&&(c+=e.$separator.width()),d>0&&(c-=d);let f=s;s=Math.max(s-c,e.minWidth),this.$filler.cssWidth(f-s)}}t.cssMinWidth(s).cssMaxWidth(s)}resizeHeaderItems(){this._visibleColumns().forEach(this.resizeHeaderItem.bind(this))}_reconcileScrollPos(){let e=this.table.get$Scrollable().scrollLeft(),t=this._lastVisibleColumn();this.resizeHeaderItem(t),this.$container.scrollLeft(e),this.$menuBarContainer.cssRight(-1*e)}_arrangeHeaderItems(e){let t=this;e.each(function(){a()(this).css("left",a()(this).data("old-pos")-a()(this).offset().left).animate({left:0},{progress:function(s,r,n){let o=a()(this);!o.isSelected()||(P.scrollHorizontalTo(t.table.$data,o),t.tableHeaderMenu&&t.tableHeaderMenu.rendered&&t.tableHeaderMenu.position())}})})}_installHeaderItemTooltip(e){K.install(e.$header,{parent:this,text:this._headerItemTooltipText.bind(this),arrowPosition:50,arrowPositionUnit:"%",nativeTooltip:!x.get().isCustomEllipsisTooltipPossible(),htmlEnabled:this._headerItemTooltipHtmlEnabled.bind(this)})}_installHeaderItemTooltips(){this._visibleColumns().forEach(this._installHeaderItemTooltip,this)}_uninstallHeaderItemTooltip(e){K.uninstall(e.$header)}_uninstallHeaderItemTooltips(){this._visibleColumns().forEach(this._uninstallHeaderItemTooltip,this)}_headerItemTooltipText(e){let t=e.data("column");if(t&&y.hasText(t.headerTooltipText))return t.headerTooltipText;let s=e.children(".table-header-item-text");if(s.isContentTruncated()||e.width()+e.position().left>e.parent().width()){let r=y.plainText(s.html(),{trim:!0});if(y.hasText(r))return r}return null}_headerItemTooltipHtmlEnabled(e){return e.data("column").headerTooltipHtmlEnabled}setHeaderMenusEnabled(e){this.setProperty("headerMenusEnabled",e)}_renderHeaderMenusEnabled(){this._visibleColumns().forEach(e=>this._decorateHeader(e))}openHeaderMenu(e){this.tableHeaderMenu&&this.closeHeaderMenu(),this.tableHeaderMenu=e.createTableHeaderMenu(this),this.tableHeaderMenu.open(),e.trigger("headerMenuOpen",{menu:this.tableHeaderMenu}),this.tableHeaderMenu.one("destroy",()=>{e.trigger("headerMenuClose",{menu:this.tableHeaderMenu})})}closeHeaderMenu(){this.tableHeaderMenu.destroy(),this.tableHeaderMenu=null}findHeaderItems(){return this.$container.find(".table-header-item:not(.filler)")}updateHeader(e,t){!e.isVisible()||this._decorateHeader(e,t)}_decorateHeader(e,t){this._renderColumnCssClass(e,t),this._renderColumnText(e),this._renderColumnIconId(e),this._renderColumnState(e),this._renderColumnLegacyStyle(e),this._renderColumnHeaderMenuEnabled(e),this._renderColumnHorizontalAlignment(e)}_renderColumnCssClass(e,t){let s=e.$header;t&&s.removeClass(t.headerCssClass),s.addClass(e.headerCssClass)}_renderColumnText(e){let t=e.text,s=e.$header,r=s.children(".table-header-item-text");e.headerHtmlEnabled||(t=y.nl2br(t)),r.htmlOrNbsp(t,"empty"),this._updateColumnIconAndTextStyle(e)}_renderColumnIconId(e){e.$header.icon(e.headerIconId),this._updateColumnIconAndTextStyle(e)}_renderColumnHorizontalAlignment(e){e.$header.removeClass("halign-left halign-center halign-right"),e.$header.addClass("halign-"+V.parseHorizontalAlignment(e.horizontalAlignment))}_updateColumnIconAndTextStyle(e){let t=e.$header.data("$icon"),s=e.$header.children(".table-header-item-text");t&&t.toggleClass("with-text",!!e.text),s.setVisible(!(t&&s.html()==="&nbsp;")),e.$header.toggleClass("table-header-item-icon-only",!!(e.headerIconId&&!e.text))}_renderColumnLegacyStyle(e){M.legacyStyle(e,e.$header,"header")}_renderColumnHeaderMenuEnabled(e){e.$header.toggleClass("disabled",!this._isHeaderMenuEnabled(e)||!this.enabled)}_renderColumnState(e){let t=e.$header,s=this.table.getFilter(e.id);t.children(".table-header-item-state").remove();let r=t.appendSpan("table-header-item-state");if(r.empty(),t.removeClass("sort-asc sort-desc sorted group-asc group-desc grouped filtered"),r.removeClass("sort-asc sort-desc sorted group-asc group-desc grouped filtered"),e.sortActive){let n=e.sortAscending?"asc":"desc";e.grouped&&t.addClass("group-"+n),t.addClass("sorted sort-"+n),r.addClass("sorted sort-"+n)}if(e.grouped||s){let n=r.appendDiv("left");e.grouped&&(t.addClass("grouped"),r.addClass("grouped"),n.appendDiv().text("G")),s&&(t.addClass("filtered"),r.addClass("filtered"),n.appendDiv().text("F"))}r.appendDiv("right"),this._adjustColumnMinWidth(e)}_adjustColumnMinWidth(e){let t=this.table.getFilter(e.id);e.sortActive||e.grouped||t?(e.minWidth<De.DEFAULT_MIN_WIDTH&&(e.__minWidthWithoutState=e.minWidth,e.__widthWithoutState=e.width,e.minWidth=De.DEFAULT_MIN_WIDTH),e.width<e.minWidth&&this.table.resizeColumn(e,e.minWidth)):b.isNullOrUndefined(e.__minWidthWithoutState)||(e.minWidth=e.__minWidthWithoutState,e.width===De.DEFAULT_MIN_WIDTH&&this.table.resizeColumn(e,e.__widthWithoutState),e.__minWidthWithoutState=null,e.__widthWithoutState=null)}updateMenuBar(){let e=this.table._filterMenus(this.table.menus,It.HEADER);this.menuBar.setHiddenByUi(!this.enabled),this.menuBar.setMenuItems(e)}_onTableColumnResized(e){let t=e.column,s=this._lastVisibleColumn();this.resizeHeaderItem(t),s!==t&&this.resizeHeaderItem(s)}onSortingChanged(){this._visibleColumns().forEach(this._renderColumnState,this)}_onTableColumnMoved(e){let t=e.column,s=e.oldPos,r=e.newPos,n=t.$header,o=this.findHeaderItems(),l=o.eq(s),h=l.next(".table-header-resize"),d=this._visibleColumns(),c=d.length-1;o.each(function(){a()(this).data("old-pos",a()(this).offset().left)}),r<s?o.eq(r).before(l):(o.eq(r).after(l),l.before(l.next(".table-header-resize"))),l.after(h),o.length>0&&(o.eq(0).removeClass("first"),o.eq(o.length-1).removeClass("last")),d.length>0&&(d[0].$header.addClass("first"),d[c].$header.addClass("last")),(s===c||r===c)&&d.forEach(f=>this.resizeHeaderItem(f)),e.dragged?n.css("left",parseInt(n.css("left"),0)+n.data("old-pos")-n.offset().left).addClass("releasing").animateAVCSD("left",0,()=>n.removeClass("releasing")):this._arrangeHeaderItems(o)}_visibleColumns(){return this.table.visibleColumns()}_lastVisibleColumn(){return p.last(this._visibleColumns())}onOrderChanged(e){let t=this.findHeaderItems();t.each(function(){a()(this).data("old-pos",a()(this).offset().left)}),this._visibleColumns().forEach(s=>{let r=s.$header,n=r.next(".table-header-resize");this.$container.append(r),this.$container.append(n)}),this.$container.append(this.$filler),this._arrangeHeaderItems(t)}_isHeaderMenuEnabled(e){return!!(e.headerMenuEnabled&&this.headerMenusEnabled)}_onHeaderItemClick(e){let t=a()(e.currentTarget),s=t.data("column");return this.dragging||this.columnMoved?(this.dragging=!1,this.columnMoved=!1):this.table.sortEnabled&&(e.shiftKey||e.ctrlKey||!this._isHeaderMenuEnabled(s))?this.table.sort(s,t.hasClass("sort-asc")?"desc":"asc",e.shiftKey):this.tableHeaderMenu&&this.tableHeaderMenu.isOpenFor(t)?this.closeHeaderMenu():this._isHeaderMenuEnabled(s)&&this.openHeaderMenu(s),!1}_onHeaderItemMouseDown(e){if(e.button>0)return;let t=0,s=this,r=Math.floor(e.pageX),n=a()(e.currentTarget),o=n.data("column"),l=this._visibleColumns().indexOf(o),h=l,d=n.outerWidth(),c=n.siblings(".table-header-item:not(.filler)");if(o.fixedPosition)return;this.dragging=!1,this.columnMoved=!1,this._$window.on("mousemove.tableheader","",f).one("mouseup","",C);function f(S){if(t=Math.floor(S.pageX)-r,-2<t&&t<2)return;s.dragging=!0,n.addClass("moving"),s.$container&&s.$container.addClass("moving"),n.css("left",t);let R=_(n);c.each(function(L){let H=a()(this),we=_(H);R<we&&L<l?H.css("left",d):R>we&&L>=l?H.css("left",-d):H.css("left",0)}),s.tableHeaderMenu&&(s.tableHeaderMenu.destroy(),s.tableHeaderMenu=null),s.rendered&&s._uninstallHeaderItemTooltips()}function m(S){let R=S.html(),L=S.html("<span>"+R+"</span>").find("span:first").width();return S.html(R),L}function _(S){return S.hasClass("halign-right")?S.offset().left+S.outerWidth()-m(S)/2:S.offset().left+m(S)/2}function C(S){if(s._$window&&s._$window.off("mousemove.tableheader"),!s.dragging)return!0;(t<0?c:a()(c.get().reverse())).each(function(L){if(a()(this).css("left")!=="0px")return h=s._visibleColumns().indexOf(a()(this).data("column")),!1}),h>-1&&l!==h?(s.table.moveColumn(n.data("column"),l,h,!0),s.dragging=!1,s.columnMoved=!0):(n.addClass("releasing"),n.animateAVCSD("left","",()=>{s.dragging=!1,n.removeClass("releasing")})),c.each(function(){a()(this).css("left","")}),n.removeClass("moving"),s.$container&&s.$container.removeClass("moving"),s.rendered&&s._installHeaderItemTooltips()}}_onSeparatorDblclick(e){if(!(e.button>0))if(e.shiftKey)this._visibleColumns().forEach(function(t){this.table.resizeToFit(t)},this);else{let t=a()(e.target).prev(),s=t.data("column");this.table.resizeToFit(s)}}_onSeparatorMouseDown(e){if(e.button>0)return;let t=Math.floor(e.pageX),s=a()(e.target).prev(),r=s.data("column"),n=this,o=r.width,l=this.$container.appendDiv("table-column-resize-helper").css("width",this.table.rowWidth+this.table.rowBorders.horizontal()),h=this.table.$data.appendDiv("table-column-resize-helper").css("width",this.table.rowWidth);this._$window.on("mousemove.tableheader",d).one("mouseup",c),this._$body.addClass("col-resize"),e.preventDefault();function d(f){let m=Math.floor(f.pageX)-t,_=o+m;_=Math.max(_,r.minWidth),n.rendered&&_!==r.width&&n.table.resizeColumn(r,_)}function c(f){l.remove(),h.remove(),n._$window&&n._$window.off("mousemove.tableheader"),n._$body&&n._$body.removeClass("col-resize"),n.table.rendered&&r.width!==o&&n.table.resizeColumn(r,r.width)}}_onTableDataScroll(){P.fix(this.$menuBarContainer),this._reconcileScrollPos(),this._fixTimeout=P.unfix(this.$menuBarContainer,this._fixTimeout)}_onMenuBarPropertyChange(e){this.rendered&&e.propertyName==="visible"&&this.$menuBarContainer.setVisible(e.newValue)}_onTableAddFilterRemoved(e){if(!(e.filter instanceof Ji))return;let t=e.filter.column;e.filter.filterType===Ji.TYPE&&t.$header&&this._renderColumnState(t)}}function Q(i,e,t){return e=Sx(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Sx(i){var e=Px(i,"string");return typeof e=="symbol"?e:String(e)}function Px(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class yi extends ue{constructor(){super(),Q(this,"column",void 0),Q(this,"tableHeader",void 0),Q(this,"compact",void 0),Q(this,"table",void 0),Q(this,"filterTable",void 0),Q(this,"filter",void 0),Q(this,"filterCheckedMode",void 0),Q(this,"filterSortMode",void 0),Q(this,"hasFilterTable",void 0),Q(this,"hasFilterFields",void 0),Q(this,"leftGroups",void 0),Q(this,"moveGroup",void 0),Q(this,"hierarchyGroup",void 0),Q(this,"toBeginButton",void 0),Q(this,"forwardButton",void 0),Q(this,"backwardButton",void 0),Q(this,"toEndButton",void 0),Q(this,"sortingGroup",void 0),Q(this,"sortAscButton",void 0),Q(this,"sortDescButton",void 0),Q(this,"sortAscAddButton",void 0),Q(this,"sortDescAddButton",void 0),Q(this,"columnActionsGroup",void 0),Q(this,"addColumnButton",void 0),Q(this,"removeColumnButton",void 0),Q(this,"modifyColumnButton",void 0),Q(this,"groupButton",void 0),Q(this,"groupAddButton",void 0),Q(this,"barChartButton",void 0),Q(this,"colorGradient1Button",void 0),Q(this,"colorGradient2Button",void 0),Q(this,"filterFieldsGroupBox",void 0),Q(this,"$rightGroups",void 0),Q(this,"$headerItem",void 0),Q(this,"$columnActions",void 0),Q(this,"$columnFilters",void 0),Q(this,"$filterTableGroup",void 0),Q(this,"$filterToggleChecked",void 0),Q(this,"$filterTableGroupTitle",void 0),Q(this,"$filterSortOrder",void 0),Q(this,"$filterFieldsGroup",void 0),Q(this,"$body",void 0),Q(this,"_onColumnMovedHandler",void 0),Q(this,"_tableFilterHandler",void 0),Q(this,"_tableHeaderScrollHandler",void 0),Q(this,"_filterTableRowsCheckedHandler",void 0),this.column=null,this.tableHeader=null,this.table=null,this.filter=null,this.filterCheckedMode=yi.CheckedMode.ALL,this.filterSortMode=yi.SortMode.ALPHABETICALLY,this.hasFilterTable=!1,this.hasFilterFields=!1,this.animateOpening=!0,this.animateRemoval=!0,this.focusableContainer=!0,this.leftGroups=[],this.moveGroup=null,this.toBeginButton=null,this.forwardButton=null,this.backwardButton=null,this.toEndButton=null,this.sortingGroup=null,this.sortDescButton=null,this.sortAscAddButton=null,this.sortDescAddButton=null,this.columnActionsGroup=null,this.addColumnButton=null,this.removeColumnButton=null,this.modifyColumnButton=null,this.groupButton=null,this.groupAddButton=null,this.barChartButton=null,this.colorGradient1Button=null,this.colorGradient2Button=null,this.$rightGroups=[],this.$headerItem=null,this.$columnActions=null,this.$columnFilters=null,this.$filterTableGroup=null,this.$filterToggleChecked=null,this.$filterTableGroupTitle=null,this.$filterSortOrder=null,this.$filterFieldsGroup=null,this._onColumnMovedHandler=this._onColumnMoved.bind(this),this._tableHeaderScrollHandler=this._onAnchorScroll.bind(this),this.on("locationChange",this._onLocationChange.bind(this)),this.inheritAccessibility=!1}_init(e){e.scrollType=e.scrollType||"none",super._init(e),this.tableHeader=e.tableHeader,this.column=e.column,this.table=this.tableHeader.table,this.$headerItem=this.$anchor,this.table.on("columnMoved",this._onColumnMovedHandler),this.filter=this.table.getFilter(this.column.id),this.filter||(this.filter=this.column.createFilter()),this.filter.calculate(),this.filter.on("filterFieldsChanged",this._updateFilterTable.bind(this)),this._updateFilterTableCheckedMode(),this.hasFilterTable=this.filter.availableValues.length>0,this.hasFilterFields=this.filter.hasFilterFields,this.hasFilterTable&&(this._tableFilterHandler=this._onFilterTableChanged.bind(this),this.table.on("filterAdded",this._tableFilterHandler),this.table.on("filterRemoved",this._tableFilterHandler),this._filterTableRowsCheckedHandler=this._onFilterTableRowsChecked.bind(this))}_createLayout(){return new dn(this)}_render(){this.leftGroups=[],this.$rightGroups=[],this.$headerItem.select(!0),this.$container=this.$parent.appendDiv("popup table-header-menu"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(this._createLayout()),this.$body=this.$container.appendDiv("table-header-menu-body"),T.install(this.$body,this.session),this._installScrollbars({axis:"y",scrollShadow:"none"}),this.$columnActions=this.$body.appendDiv("table-header-menu-actions"),(this.hasFilterTable||this.hasFilterFields)&&(this.$columnFilters=this.$body.appendDiv("table-header-menu-filters"),T.install(this.$columnFilters,this.session).setLayout(new Ri)),this.tableHeader.$container.on("scroll",this._tableHeaderScrollHandler),this.table.visibleColumns().filter(t=>!t.fixedPosition).length>1&&!this.column.fixedPosition&&this.leftGroups.push(this._renderMovingGroup()),this.table.sortEnabled&&this.leftGroups.push(this._renderSortingGroup()),this._isColumnActionsGroupVisible()&&this.leftGroups.push(this._renderColumnActionsGroup()),(this.table.isGroupingPossible(this.column)||this.column.grouped)&&this.leftGroups.push(this._renderGroupingGroup()),this.leftGroups.push(this._renderHierarchyGroup()),this.table.isAggregationPossible(this.column)&&this.leftGroups.push(this._renderAggregationGroup()),this.column instanceof Bi&&this.leftGroups.push(this._renderColoringGroup()),this.hasFilterTable&&this.$rightGroups.push(this._renderFilterTable()),this.hasFilterFields&&this.$rightGroups.push(this._renderFilterFields()),this._onColumnMoved(),this.table.enabled&&this.table.$container.addClass("focused")}validateFocus(){this.filterFieldsGroupBox&&this.filterFieldsGroupBox.focus(),super.validateFocus()}get$Scrollable(){return this.$body}_updateFirstLast(){e(this.leftGroups.filter(s=>s.isVisible())),e(this.$rightGroups);function e(s){s.forEach((r,n,o)=>{t(r,"first",n===0),t(r,"last",n===o.length-1)})}function t(s,r,n){(s instanceof Ns?s.$container:s).toggleClass(r,n)}}_remove(){this.filterTable&&this.filterTable.off("rowsChecked",this._filterTableRowsCheckedHandler),this.tableHeader.rendered&&this.tableHeader.$container.off("scroll",this._tableHeaderScrollHandler),this.$headerItem.select(!1),this.table.off("columnMoved",this._onColumnMovedHandler),this.table.off("filterAdded",this._tableFilterHandler),this.table.off("filterRemoved",this._tableFilterHandler),super._remove(),this.table.rendered&&this.table.$container.removeClass("focused")}_renderMovingGroup(){let e=this.table,t=this.column,s=e.visibleColumns().indexOf(t);return this.moveGroup=u.create(Ns,{parent:this,textKey:"ui.Move",cssClass:"first"}),this.toBeginButton=u.create(dt,{parent:this.moveGroup,text:"${textKey:ui.toBegin}",cssClass:"move move-top"}),this.toBeginButton.on("action",()=>{e.moveColumn(t,s,0),s=e.visibleColumns().indexOf(t)}),this.forwardButton=u.create(dt,{parent:this.moveGroup,text:"${textKey:ui.forward}",cssClass:"move move-up"}),this.forwardButton.on("action",()=>{e.moveColumn(t,s,Math.max(s-1,0)),s=e.visibleColumns().indexOf(t)}),this.backwardButton=u.create(dt,{parent:this.moveGroup,text:"${textKey:ui.backward}",cssClass:"move move-down"}),this.backwardButton.on("action",()=>{e.moveColumn(t,s,Math.min(s+1,e.header.findHeaderItems().length-1)),s=e.visibleColumns().indexOf(t)}),this.toEndButton=u.create(dt,{parent:this.moveGroup,text:"${textKey:ui.toEnd}",cssClass:"move move-bottom"}),this.toEndButton.on("action",()=>{e.moveColumn(t,s,e.header.findHeaderItems().length-1),s=e.visibleColumns().indexOf(t)}),this.moveGroup.render(this.$columnActions),this.moveGroup}_onColumnMoved(){let e=this.table,t=this.column;if(this.moveGroup){let s=e.visibleColumns(),r=e.visibleColumns().indexOf(t),n=s[r-1]&&!s[r-1].fixedPosition,o=s[r+1]&&!s[r+1].fixedPosition;this.toBeginButton.setEnabled(n),this.forwardButton.setEnabled(n),this.backwardButton.setEnabled(o),this.toEndButton.setEnabled(o)}this.hierarchyGroup.setVisible(this.table.isTableNodeColumn(t)),this._updateFirstLast()}_isColumnActionsGroupVisible(){return this.table.columnAddable||this.column.removable||this.column.modifiable}_renderColumnActionsGroup(){let e=this.column,t=this;return this.columnActionsGroup=u.create(Ns,{parent:this,textKey:"ui.Column"}),this.addColumnButton=u.create(dt,{parent:this.columnActionsGroup,text:"${textKey:ui.addColumn}",cssClass:"add-column",visible:this.table.columnAddable}),this.addColumnButton.on("action",s.bind(this,"add")),this.removeColumnButton=u.create(dt,{parent:this.columnActionsGroup,text:"${textKey:ui.removeColumn}",cssClass:"remove-column",visible:this.column.removable}),this.removeColumnButton.on("action",s.bind(this,"remove")),this.modifyColumnButton=u.create(dt,{parent:this.columnActionsGroup,text:"${textKey:ui.changeColumn}",cssClass:"change-column",visible:this.column.modifiable}),this.modifyColumnButton.on("action",s.bind(this,"modify")),this.columnActionsGroup.render(this.$columnActions),this.columnActionsGroup;function s(r){t.close(),this.table.trigger("columnOrganizeAction",{action:r,column:e})}}_renderSortingGroup(){let e=this.table,t=this.column,s=this;return this.sortingGroup=u.create(Ns,{parent:this,textKey:"ColumnSorting"}),e.hasPermanentHeadOrTailSortColumns()||(this.sortAscButton=u.create(dt,{parent:this.sortingGroup,text:"${textKey:ui.ascending}",cssClass:"sort sort-asc",direction:"asc",toggleAction:!0}),this.sortAscButton.on("action",r.bind(this.sortAscButton)),this.sortDescButton=u.create(dt,{parent:this.sortingGroup,text:"${textKey:ui.descending}",cssClass:"sort sort-desc",direction:"desc",toggleAction:!0}),this.sortDescButton.on("action",r.bind(this.sortDescButton))),this.sortAscAddButton=u.create(dt,{parent:this.sortingGroup,text:"${textKey:ui.ascendingAdditionally}",cssClass:"sort sort-asc-add",direction:"asc",toggleAction:!0}),this.sortAscAddButton.on("action",n.bind(this.sortAscAddButton)),this.sortDescAddButton=u.create(dt,{parent:this.sortingGroup,text:"${textKey:ui.descendingAdditionally}",cssClass:"sort sort-desc-add",direction:"desc",toggleAction:!0}),this.sortDescAddButton.on("action",n.bind(this.sortDescAddButton)),this._updateSortingSelectedState(),this.sortingGroup.render(this.$columnActions),this.sortingGroup;function r(){s.close(),o(this.direction,!1,!this.selected)}function n(){s.close(),o(this.direction,!0,!this.selected)}function o(l,h,d){e.sort(t,l,h,d),s._updateSortingSelectedState()}}_updateSortingSelectedState(){if(!this.table.sortEnabled)return;let e=!1,t=this._sortColumnCount();if(this.sortingGroup.children.forEach(s=>s.setSelected(!1)),t===1&&!this.table.hasPermanentHeadOrTailSortColumns())this.column.sortActive?this.column.sortAscending?this.sortAscButton.setSelected(!0):this.sortDescButton.setSelected(!0):e=!0;else if((t>1||this.table.hasPermanentHeadOrTailSortColumns())&&(e=!0,this.column.sortActive)){this.column.sortAscending?this.sortAscAddButton.setSelected(!0):this.sortDescAddButton.setSelected(!0);let s=this.column.sortIndex+1+"";this.sortAscAddButton.setIconId(s),this.sortDescAddButton.setIconId(s)}this.sortAscAddButton.setVisible(e),this.sortDescAddButton.setVisible(e)}_renderGroupingGroup(){let e=this,t=this.table,s=this.column,r=this._groupColumnCount(),n=u.create(Ns,{parent:this,textKey:"ui.Grouping"});return this.groupButton=u.create(dt,{parent:n,text:"${textKey:ui.groupingApply}",cssClass:"group",additional:!1,toggleAction:!0}),this.groupButton.on("action",o.bind(this.groupButton)),this.groupAddButton=u.create(dt,{parent:n,text:"${textKey:ui.additionally}",cssClass:"group-add",additional:!0,toggleAction:!0}),this.groupAddButton.on("action",o.bind(this.groupAddButton)),r===0?this.groupAddButton.setVisible(!1):r===1&&this.column.grouped?(this.groupButton.setSelected(!0),this.groupAddButton.setVisible(!1)):r>1&&this.groupAddButton.setVisible(!0),t.hasPermanentHeadOrTailSortColumns()&&r>0&&(this.groupButton.setVisible(!1),this.groupAddButton.setVisible(!0)),this.column.grouped&&(r===1?this.groupAddButton.setSelected(!0):r>1&&(this.groupAddButton.setSelected(!0),this.groupAddButton.setIconId(this.column.sortIndex+1+""))),n.render(this.$columnActions),n;function o(){let l=s.sortIndex>=0&&!s.sortAscending?"desc":"asc";e.close(),t.groupColumn(s,this.additional,l,!this.selected)}}_renderHierarchyGroup(){let e=this.table,t=this;return this.hierarchyGroup=u.create(Ns,{parent:this,textKey:"ui.Hierarchy",visible:this.table.isTableNodeColumn(this.column)}),u.create(dt,{parent:this.hierarchyGroup,text:"${textKey:ui.CollapseAll}",cssClass:"hierarchy-collapse-all",enabled:!!p.find(e.rows,n=>n.expanded&&!p.empty(n.childRows))}).on("action",()=>{t.close(),e.collapseAll()}),u.create(dt,{parent:this.hierarchyGroup,text:"${textKey:ui.ExpandAll}",cssClass:"hierarchy-expand-all",enabled:!!p.find(e.rows,n=>!n.expanded&&!p.empty(n.childRows))}).on("action",()=>{t.close(),e.expandAll()}),this.hierarchyGroup.render(this.$columnActions),this.hierarchyGroup}_renderAggregationGroup(){let e=this.table,t=this.column,s=t.aggregationFunction,r=this,n=u.create(Ns,{parent:this,textKey:"ui.Aggregation"}),o=p.ensure(t.allowedAggregationFunctions),l=o.indexOf("none")!==-1;return h("${textKey:ui.Sum}","sum"),h("${textKey:ui.Average}","avg"),h("${textKey:ui.Minimum}","min"),h("${textKey:ui.Maximum}","max"),n.children.forEach(c=>c.setSelected(c.aggregation===s)),n.render(this.$columnActions),n;function h(c,f){if(o.indexOf(f)!==-1){let m=u.create(dt,{parent:n,text:c,cssClass:"aggregation-function "+f,aggregation:f,toggleAction:l});m.on("action",d.bind(m))}}function d(){r.close(),e.changeAggregation(t,this.aggregation===s?"none":this.aggregation)}}_renderColoringGroup(){let e=this.table,t=this.column,s=this,r=t.backgroundEffect,n=u.create(Ns,{parent:this,textKey:"ui.Coloring"});return this.colorGradient1Button=u.create(dt,{parent:n,text:"${textKey:ui.fromRedToGreen}",cssClass:"color color-gradient1",backgroundEffect:"colorGradient1",toggleAction:!0}),this.colorGradient1Button.on("action",o.bind(this.colorGradient1Button)),this.colorGradient2Button=u.create(dt,{parent:n,text:"${textKey:ui.fromGreenToRed}",cssClass:"color color-gradient2",backgroundEffect:"colorGradient2",toggleAction:!0}),this.colorGradient2Button.on("action",o.bind(this.colorGradient2Button)),x.get().supportsCssGradient()&&(this.barChartButton=u.create(dt,{parent:n,text:"${textKey:ui.withBarChart}",cssClass:"color color-bar-chart",backgroundEffect:"barChart",toggleAction:!0}),this.barChartButton.on("action",o.bind(this.barChartButton))),n.children.forEach(l=>l.setSelected(l.backgroundEffect===r)),n.render(this.$columnActions),n;function o(){s.close(),e.setColumnBackgroundEffect(t,this.selected?this.backgroundEffect:null)}}_renderFilterTable(){this.$filterTableGroup=this.$columnFilters.appendDiv("table-header-menu-group first"),T.install(this.$filterTableGroup,this.session).setLayout(new Ri);let t=this.$filterTableGroup.appendDiv("table-header-menu-filter-actions");this.$filterSortOrder=t.appendDiv("link table-header-menu-toggle-sort-order").on("click",this._onSortModeClick.bind(this)).addClass(this.filterSortMode.cssClass),this.$filterToggleChecked=t.appendDiv("link table-header-menu-filter-toggle-checked").text(this.session.text(this.filterCheckedMode.text)).on("click",this._onFilterCheckedModeClick.bind(this)),this.$filterTableGroupTitle=this.$filterTableGroup.appendDiv("table-header-menu-group-text").text(this._filterByText()),T.install(this.$filterTableGroupTitle,this.session),this.filterTable=this._createFilterTable(),this.filterTable.on("rowsChecked",this._filterTableRowsCheckedHandler);let s=[];return this.filter.availableValues.forEach(r=>{let n={cells:[u.create(Pt,{text:this.filter.column instanceof Bi?r.text:null,value:this.filter.column instanceof Bi?r.key:r.text,iconId:r.iconId,htmlEnabled:r.htmlEnabled,cssClass:r.cssClass}),r.count,r.key===null?1:0],checked:this.filter.selectedValues.indexOf(r.key)>-1,dataMap:{filterValue:r}};s.push(n)}),this.filterTable.insertRows(s),this.filterTable.render(this.$filterTableGroup),setTimeout(this.filterTable.revealChecked.bind(this.filterTable)),this.$filterTableGroup}_createFilterTable(){let e=De;return this.column instanceof Bi&&(e=Bi),u.create(V,{parent:this,headerVisible:!1,multiSelect:!1,autoResizeColumns:!0,checkable:!0,cssClass:"table-header-menu-filter-table",checkableStyle:V.CheckableStyle.TABLE_ROW,columns:[{objectType:e,text:"filter-value",width:120,sortActive:!0,sortIndex:1,horizontalAlignment:-1},{objectType:Bi,text:"aggregate-count",cssClass:"table-header-menu-filter-number-column",width:50,minWidth:32,autoOptimizeWidth:!0},{objectType:Bi,displayable:!1,sortActive:!0,sortIndex:0}]})}_filterByText(){let e=this.session.text("ui.Filter"),t=this.filter.selectedValues.length,s=this.filter.availableValues.length;return t&&s?e+=" "+this.session.text("ui.FilterInfoXOfY",t+"",s+""):s&&(e+=" "+this.session.text("ui.FilterInfoCount",s+"")),e}_onFilterCheckedModeClick(){let e=yi.CheckedMode,t=this.filterCheckedMode.checkAll;this.filter.selectedValues=[],this.filterCheckedMode===e.ALL?(this.filterCheckedMode=e.NONE,this.filter.availableValues.forEach(s=>this.filter.selectedValues.push(s.key))):this.filterCheckedMode=e.ALL,this.filterTable.checkAll(t),this._updateFilterTableActions()}_onSortModeClick(){let e=yi.SortMode;this.filterSortMode===e.ALPHABETICALLY?(this.filterTable.sort(this.filterTable.columns[1],"desc"),this.filterSortMode=e.AMOUNT):(this.filterTable.sort(this.filterTable.columns[2],"asc"),this.filterTable.sort(this.filterTable.columns[0],"asc",!0),this.filterSortMode=e.ALPHABETICALLY),this._updateFilterTableActions()}_updateFilterTable(){this.filter.filterActive()?this.table.addFilter(this.filter):this.table.removeFilterByKey(this.column.id)}_updateFilterTableActions(){this.$filterToggleChecked.text(this.session.text(this.filterCheckedMode.text));let e=yi.SortMode,t=this.filterSortMode===yi.SortMode.ALPHABETICALLY;this.$filterSortOrder.toggleClass(e.ALPHABETICALLY.cssClass,t),this.$filterSortOrder.toggleClass(e.AMOUNT.cssClass,!t)}_renderFilterFields(){this.filterFieldsGroupBox=u.create(Hf,{parent:this,filter:this.filter}),this.$filterFieldsGroup=this.$columnFilters.appendDiv("table-header-menu-group");let e=T.install(this.$filterFieldsGroup,this.session);e.setLayout(new Ri);let t=this.$filterFieldsGroup.appendDiv("table-header-menu-group-text").text(this.filter.filterFieldsTitle());return e=T.install(t,this.session),this.filterFieldsGroupBox.render(this.$filterFieldsGroup),this.$filterFieldsGroup}isOpenFor(e){return this.rendered&&this.belongsTo(e)}_countColumns(e){return this.table.visibleColumns().reduce((t,s)=>t+(s[e]?1:0),0)}_sortColumnCount(){return this._countColumns("sortActive")}_groupColumnCount(){return this._countColumns("grouped")}_renderCompact(){this.$body.toggleClass("compact",this.compact),this.invalidateLayoutTree()}setCompact(e){this.setProperty("compact",e)}_onLocationChange(e){let t=v.offsetBounds(this.$headerItem),s=this.tableHeader.$container;this.$container.setVisible(!0);let r=v.offsetBounds(this.$container),n=P.isLocationInView(new X(t.x,t.y),s);n||(n=P.isLocationInView(new X(t.x+t.width,t.y+t.height),s),n=n&&P.isLocationInView(new X(r.x+r.width,r.y),s)),this.$container.setVisible(n)}_onAnchorScroll(e){this.position()}_onFilterTableRowsChecked(e){this.filter.selectedValues=[],this.filterTable.rows.forEach(t=>{t.checked&&this.filter.selectedValues.push(t.dataMap.filterValue.key)}),this._updateFilterTable()}_onFilterTableChanged(){this.$filterTableGroupTitle.text(this._filterByText()),this._updateFilterTableCheckedMode(),this._updateFilterTableActions()}_updateFilterTableCheckedMode(){this.filter.selectedValues.length===0?this.filterCheckedMode=yi.CheckedMode.ALL:this.filterCheckedMode=yi.CheckedMode.NONE}_onMouseDownOutside(e){this.$headerItem.isOrHas(e.target)||this.close()}}Q(yi,"CheckedMode",{ALL:{checkAll:!0,text:"ui.SelectAllFilter"},NONE:{checkAll:!1,text:"ui.SelectNoneFilter"}}),Q(yi,"SortMode",{ALPHABETICALLY:{text:"ui.SortAlphabeticallyFilter",cssClass:"table-header-menu-toggle-sort-order-alphabetically"},AMOUNT:{text:"ui.SortByAmountFilter",cssClass:"table-header-menu-toggle-sort-order-amount"}});function xx(i,e,t){return e=Ex(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Ex(i){var e=Fx(i,"string");return typeof e=="symbol"?e:String(e)}function Fx(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class dn extends Ii{constructor(e){super(e),this.doubleCalcPrefSize=!1}layout(e){if(super.layout(e),!this.popup.hasFilterFields&&!this.popup.hasFilterTable)return;let t,s=this.popup.$columnFilters,r=v.insets(s),n=v.margins(s),o=new F;if(this.popup.$body.hasClass("compact")?t=T.get(s).prefSize():(t=this.preferredLayoutSize(e).subtract(v.insets(e)),t=t.subtract(n)),t.width=s.cssWidth(),s.cssHeight(t.height),this.popup.hasFilterFields){let h=this.popup.$filterFieldsGroup;T.get(h.find(".form-field")).setSize(new F(t.width-r.horizontal(),this._filterFieldsGroupBoxHeight())),o=v.size(h,!0)}if(this.popup.hasFilterTable){let h=this.popup.$filterTableGroup,d=v.insets(h),c=this.popup.filterTable.htmlComp,f=t.height-r.vertical();f-=o.height,f-=this._groupTitleHeight(h),f-=d.vertical(),f=Math.min(f,dn.TABLE_MAX_HEIGHT),c.setSize(new F(t.width-r.horizontal(),f))}this._setMaxWidth();let l=v.size(this.popup.$columnActions);this._setMaxWidth(l.width)}_adjustSizeWithAnchor(e){let t=this.popup.htmlComp,s=this.popup.windowPaddingX,r=t.margins(),n=t.offsetBounds(),h=this.popup.$container.window().width()-r.horizontal()-n.x-s;return n.width>h&&(this.popup.$body.addClass("compact"),e=this.preferredLayoutSize(this.popup.$container)),super._adjustSizeWithAnchor(e)}_groupTitleHeight(e){return v.size(e.find(".table-header-menu-group-text"),!0).height}_filterFieldsGroupBoxHeight(){return this.popup.filterFieldsGroupBox.htmlComp.prefSize().height}preferredLayoutSize(e,t){let s=0,r=0,n=v.insets(e),o=this._getMaxWidth();if(this._setMaxWidth(),r=v.size(this.popup.$columnActions,!0).height,this.popup.hasFilterTable){let h=this.popup.$filterTableGroup,d=this.popup.filterTable.htmlComp.size(!0).height,c=v.insets(h);d=Math.min(d,dn.TABLE_MAX_HEIGHT);let f=d;f+=this._groupTitleHeight(h),f+=c.vertical(),s+=f}if(this.popup.hasFilterFields){let h=this.popup.$filterFieldsGroup,d=v.insets(h),c=this._filterFieldsGroupBoxHeight();c+=this._groupTitleHeight(h),c+=d.vertical(),s+=c}if(this.popup.hasFilterFields||this.popup.hasFilterTable){let h=v.margins(this.popup.$columnFilters),d=v.insets(this.popup.$columnFilters);s+=h.vertical(),s+=d.vertical()}let l=v.prefSize(e);return this.popup.$body.hasClass("compact")?l.height=r+s+n.vertical():l.height=Math.max(r,s)+n.vertical(),this._setMaxWidth(o),l}_getMaxWidth(){return parseInt(this.popup.$columnActions.css("max-width"),10)}_setMaxWidth(e){this.popup.$columnActions.css("max-width",e||"")}}xx(dn,"TABLE_MAX_HEIGHT",330);function Da(i,e,t){return e=Dx(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Dx(i){var e=Ax(i,"string");return typeof e=="symbol"?e:String(e)}function Ax(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ns extends I{constructor(){super(),Da(this,"text",void 0),Da(this,"textKey",void 0),Da(this,"last",void 0),Da(this,"$text",void 0),this.text=null,this.textKey=null,this.visible=!0,this.last=!1}_init(e){super._init(e),this.text=u.nvl(this.text,this.session.text(this.textKey))}_render(){this.$container=this.$parent.appendDiv("table-header-menu-group buttons"),this.$text=this.$container.appendDiv("table-header-menu-group-text"),this.cssClass&&this.$container.addClass(this.cssClass),this._renderText(),this.children.forEach(e=>e.render()),Le.updateFirstLastMarker(this.children)}appendText(e){this.text=this.session.text(this.textKey)+" "+e,this.rendered&&this._renderText()}resetText(){this.text=this.session.text(this.textKey),this.rendered&&this._renderText()}_renderText(){this.$text.text(this.text)}setLast(e){this.setProperty("last",e)}_renderLast(){this.$container.toggleClass("last",this.last)}}function dl(i,e,t){return e=$x(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function $x(i){var e=Rx(i,"string");return typeof e=="symbol"?e:String(e)}function Rx(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class dt extends re{constructor(){super(),dl(this,"aggregation",void 0),dl(this,"backgroundEffect",void 0),dl(this,"direction",void 0),dl(this,"additional",void 0),dl(this,"$icon",void 0),this.textVisible=!1,this.tabbable=!0}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.registerKeyStroke(new aa(this))}_render(){super._render(),this.$container=this.$container.addClass("table-header-menu-command button").unfocusable().on("mouseenter",this._onMouseOver.bind(this)).on("mouseleave",this._onMouseOut.bind(this)),this.$icon=this.$container.appendSpan("icon font-icon")}_renderProperties(){super._renderProperties(),this._renderToggleAction()}_onMouseOver(){let e=this.selected?this.session.text("ui.remove"):this.text;this.parent.appendText(e)}_onMouseOut(){this.parent.resetText()}_renderToggleAction(){this.$container.toggleClass("togglable",this.toggleAction)}_renderIconId(){this.iconId?this.$icon.attr("data-icon",this.iconId):this.$icon.removeAttr("data-icon")}}function ag(i,e,t){return e=Mx(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Mx(i){var e=Ix(i,"string");return typeof e=="symbol"?e:String(e)}function Ix(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Tu extends ee{constructor(e){super(),ag(this,"table",void 0),ag(this,"_dataHeightPositive",void 0),this.table=e,this._dataHeightPositive=!1}layout(e){let t=0,s=0,r=0,n=0,o=0,l=this.table.tableTileGridMediator?this.table.tableTileGridMediator.tileAccordion:null,h=this.table.$data,d=v.margins(u.nvl(h,this.table.$container)),c=d.top+d.bottom,f=this.table.menuBar,m=this.table.footer,_=this.table.header,C=this.table.tileTableHeader,S=this.table.visibleColumns(),R=S[S.length-1],L=this.table.htmlComp,H=L.availableSize({exact:!0}).subtract(L.insets());if(this.table.menuBarVisible&&f.visible){let Ze=T.get(f.$container),di=er.size(Ze,H);Ze.setSize(di),t=di.height}if(e.css("--menubar-height",t+"px"),_&&(r=v.size(_.$container).height,_.menuBar&&_.menuBar.validateLayout()),m){s=v.size(m.$container).height,o=m.computeControlContainerHeight(this.table,m.selectedControl,!this._dataHeightPositive);let Ze=v.insets(m.$controlContainer);m.animating||(m.$controlContainer.cssHeight(o),m.$controlContent.outerHeight(o-Ze.vertical()),m.revalidateLayout())}if(C&&C.visible){let Ze=C.htmlComp.prefSize({widthHint:H.width});Ze.width=H.width,Ze=Ze.subtract(C.htmlComp.margins()),C.htmlComp.setSize(Ze),n=Ze.height}let we=c+t+o+s+r+n,rt=H.height-we;e.css("--controls-height",we+"px"),h?(h.css("height","calc(100% - "+we+"px)"),this._dataHeightPositive=h.height()>0):l&&l.htmlComp&&(l.htmlComp.setSize(new F(H.width,rt)),P.update(l.$container),this._dataHeightPositive=rt>0),this.table.tileMode||(this._layoutColumns(),_&&_.resizeHeaderItem(R),this.table.setViewRangeSize(this.table.calculateViewRangeSize()),L.layouted||this.table._renderScrollTop(),this.table._renderViewport(),L.layouted||this.table._renderScrollTop(),this.table.tooltips.forEach(Ze=>{Ze.rendered&&Ze.position()}),this.table.cellEditorPopup&&this.table.cellEditorPopup.rendered&&(this.table.cellEditorPopup.position(),this.table.cellEditorPopup.pack()),this.table.updateScrollbars())}_layoutColumns(e){this._autoOptimizeColumnsWidths();let t=this.table.htmlComp,s=this.table.columnLayoutDirty||!t.sizeCached;if(!s){let r=e||t.size().width;s=t.sizeCached.width!==r}s&&(this.table.autoResizeColumns&&this._autoResizeColumns(e),this._updateRealColumnWidths(),this.table.columnLayoutDirty=!1)}_updateRealColumnWidths(){this.table._updateRealColumnWidths()&&(this.table._updateRowWidth(),this.table.header&&this.table.header.rendered&&this.table.header.resizeHeaderItems(),this.table.$rows(!0).css("width",this.table.rowWidth))}_autoOptimizeColumnsWidths(){this.table.visibleColumns().forEach(e=>{e.autoOptimizeWidth&&e.autoOptimizeWidthRequired&&this.table.resizeToFit(e,e.autoOptimizeMaxWidth)})}_autoResizeColumns(e){let t,s,r=[],n=0,o=0,l=e||this.table.$data.width(),h=Math.floor(l-(this.table.rowBorders.horizontal()+this.table.rowMargins.horizontal()));if(this.table.visibleColumns().forEach(f=>{f.fixedWidth||f.autoOptimizeWidth?h-=f.width:(r.push(f),n+=f.width,o+=f.initialWidth)}),h===n)return;let d=h,c=r.filter(f=>{let m=Math.max(f.minWidth,f.initialWidth);return o===0?s=1/r.length:s=f.initialWidth/o,t=Math.floor(s*d),t<m?(t=m,d=Math.max(d-t,0),!0):!1});c.forEach((f,m)=>{let _=Math.max(f.minWidth,f.initialWidth);p.remove(r,f),t=_,o-=f.initialWidth,m===c.length-1&&d>0&&r.length===0&&(t+=d,d=0),t!==f.width&&this.table.resizeColumn(f,t)}),h=d,r.forEach((f,m)=>{o===0?s=1/r.length:s=f.initialWidth/o,t=Math.floor(s*h),d-=t,m===r.length-1&&d>0&&(t+=d,d=0),t!==f.width&&this.table.resizeColumn(f,t)})}preferredLayoutSize(e,t){return this.table.tileMode?new Ri().preferredLayoutSize(e,t):(this._layoutColumns(t.widthHint),this.table._renderViewport(),super.preferredLayoutSize(e,t))}}function us(i,e,t){return e=Lx(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Lx(i){var e=Ox(i,"string");return typeof e=="symbol"?e:String(e)}function Ox(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Cu{constructor(e){us(this,"table",void 0),us(this,"mouseMoveSelectionEnabled",void 0),us(this,"lastActionRow",void 0),us(this,"mouseOverHandler",void 0),us(this,"select",void 0),us(this,"counterDebug",void 0),us(this,"fromIndex",void 0),us(this,"toIndex",void 0),us(this,"_mouseDown",void 0),us(this,"_prevSelectedRowIndex",void 0),us(this,"_maxSelectedRowIndex",void 0),this.table=e,this.mouseMoveSelectionEnabled=!0,this._mouseDown=!1,this.lastActionRow=null,this.mouseOverHandler=null,this.select=!0,this.counterDebug=0,this.fromIndex=-1,this.toIndex=-1,this._prevSelectedRowIndex=-1,this._maxSelectedRowIndex=-1}clearLastSelectedRowMarker(){this.lastActionRow=null}onMouseDown(e){let t=a()(e.currentTarget),s=t.data("row"),r=t.isSelected(),n=this.table.visibleRows;if(this._mouseDown=!0,this.select=!0,this.table.multiSelect&&e.shiftKey){if(this.table.selectedRows.indexOf(s)>-1)return;if(this.table.selectedRows.length===0&&(this.lastActionRow=s),!this.lastActionRow){let o=n.indexOf(s),l=this.table.selectedRows[0],h=this.table.selectedRows[this.table.selectedRows.length-1];o<=(n.indexOf(l)+n.indexOf(h))/2?this.lastActionRow=l:this.lastActionRow=h,this._maxSelectedRowIndex=n.indexOf(h),this._prevSelectedRowIndex=n.indexOf(this.lastActionRow)}this.fromIndex=n.indexOf(this.lastActionRow)}else e.ctrlKey?this.select=!r:(!r||this.table.selectedRows.length>1&&e.which!==3)&&(this.table._removeSelection(),this.table.selectedRows=[]);this.fromIndex<0&&(this.fromIndex=n.indexOf(s)),(e.which!==3||!r)&&(this.toIndex=n.indexOf(s),this.handleSelection(e),this.table.notifyRowSelectionFinished()),this.mouseMoveSelectionEnabled&&e.which!==3&&(this.table.$data.off("mouseover",this.mouseOverHandler),this.mouseOverHandler=this.onMouseOver.bind(this),this.table.$data.on("mouseover",".table-row",this.mouseOverHandler)),t.window().one("mouseup.selectionHandler",this.onMouseUp.bind(this)),this.lastActionRow=s}onMouseOver(e){let s=a()(e.currentTarget).data("row"),r=this.table.visibleRows;this.toIndex=r.indexOf(s),this.handleSelection(e),this.lastActionRow=s}handleSelection(e){let t,s=this.table.visibleRows;if(this.table.multiSelect){let r=this.toIndex,n=r<this._prevSelectedRowIndex,o=r>this._prevSelectedRowIndex,l=this._prevSelectedRowIndex<this.fromIndex,h=this._prevSelectedRowIndex>this.fromIndex;if(!e.ctrlKey){if(n&&h?t=s.slice(r+1,this._maxSelectedRowIndex+1):o&&l&&(t=s.slice(this._maxSelectedRowIndex,r)),t&&e.shiftKey){let d=this.getMinMaxSelectionIndizes();t=t.reduce((c,f)=>{let m=s.indexOf(f);return u.isOneOf(m,d[0],d[1])&&c.push(f),c},[])}t&&t.forEach(d=>this.table.removeRowFromSelection(d,!0))}this._maxSelectedRowIndex=n?Math.min(this._maxSelectedRowIndex,r):o?Math.max(this._maxSelectedRowIndex,r):r,this._prevSelectedRowIndex=r}else this.select&&(this.table._removeSelection(),this.table.selectedRows=[]),this.fromIndex=this.toIndex;this._selectRange(this.fromIndex,this.toIndex,this.select)}_selectRange(e,t,s){let r=this.table.visibleRows,n=Math.min(e,t),o=Math.max(e,t)+1,l=r.slice(n,o);s?l.forEach(h=>this.table.addRowToSelection(h,!0)):l.forEach(h=>this.table.removeRowFromSelection(h,!0))}getMinMaxSelectionIndizes(){let e=this.table.selectedRows,t=this.table.visibleRows;if(!e||e.length===0)return[-1,-1];let s=-1,r=-1;return e.forEach(n=>{let o=t.indexOf(n);(s===-1||o<s)&&(s=o),(r===-1||o>r)&&(r=o)}),[s,r]}onMouseUp(e){!this._mouseDown||!this.table.rendered||(this._mouseDown=!1,this.table.$data.off("mouseover",this.mouseOverHandler),this.fromIndex=-1,this.toIndex=-1,this.select=!0,this.table.notifyRowSelectionFinished())}}function Ue(i,e,t){return e=Bx(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Bx(i){var e=kx(i,"string");return typeof e=="symbol"?e:String(e)}function kx(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class un extends I{constructor(){super(),Ue(this,"table",void 0),Ue(this,"tileAccordion",void 0),Ue(this,"tiles",void 0),Ue(this,"tileMappings",void 0),Ue(this,"tilesMap",void 0),Ue(this,"groupForTileMap",void 0),Ue(this,"tableState",void 0),Ue(this,"exclusiveExpand",void 0),Ue(this,"gridColumnCount",void 0),Ue(this,"tileGridLayoutConfig",void 0),Ue(this,"withPlaceholders",void 0),Ue(this,"_isUpdatingTiles",void 0),Ue(this,"_tableHierarchyFilter",void 0),Ue(this,"_destroyHandler",void 0),Ue(this,"_tileAccordionPropertyChangeHandler",void 0),Ue(this,"_tileAccordionActionHandler",void 0),Ue(this,"_tileAccordionClickHandler",void 0),Ue(this,"_tableFilterAddedHandler",void 0),Ue(this,"_tableFilterRemovedHandler",void 0),Ue(this,"_tableFilterHandler",void 0),Ue(this,"_tableGroupHandler",void 0),Ue(this,"_tableRowsSelectedHandler",void 0),Ue(this,"_tableRowsInsertedHandler",void 0),Ue(this,"_tableRowsDeletedHandler",void 0),Ue(this,"_tableAllRowsDeletedHandler",void 0),Ue(this,"_tableRowOrderChangedHandler",void 0),Ue(this,"_tablePropertyChangeHandler",void 0),this.table=null,this.tileAccordion=null,this.tiles=[],this.tileMappings=[],this.tilesMap={},this.groupForTileMap={},this.tableState={},this._tileAccordionPropertyChangeHandler=this._onTileAccordionPropertyChange.bind(this),this._tileAccordionActionHandler=this._onTileAccordionAction.bind(this),this._tileAccordionClickHandler=this._onTileAccordionClick.bind(this),this._tableFilterAddedHandler=this._onTableFilterAdded.bind(this),this._tableFilterRemovedHandler=this._onTableFilterRemoved.bind(this),this._tableFilterHandler=this._onTableFilter.bind(this),this._tableGroupHandler=this._onTableGroup.bind(this),this._tableRowsSelectedHandler=this._onTableRowsSelected.bind(this),this._tableRowsInsertedHandler=this._onTableRowsInserted.bind(this),this._tableRowsDeletedHandler=this._onTableRowsDeleted.bind(this),this._tableAllRowsDeletedHandler=this._onTableAllRowsDeleted.bind(this),this._tableRowOrderChangedHandler=this._onTableRowOrderChangedHandler.bind(this),this._tablePropertyChangeHandler=this._onTablePropertyChange.bind(this),this._destroyHandler=this._uninstallListeners.bind(this),this.exclusiveExpand=!1,this.gridColumnCount=null,this.tileGridLayoutConfig=null,this.withPlaceholders=null,this._addWidgetProperties(["tileAccordion","tiles","tileMappings"])}init(e){super._init(e),this.table=this.parent,this.tileAccordion||(this.tileAccordion=this._createTileAccordion(),this._installListeners()),this.tableState.headerVisible=this.table.headerVisible,this._setTiles(this.tiles),this._setTileMappings(this.tileMappings)}_installListeners(){this.tileAccordion.on("propertyChange",this._tileAccordionPropertyChangeHandler),this.tileAccordion.on("tileAction",this._tileAccordionActionHandler),this.tileAccordion.on("tileClick",this._tileAccordionClickHandler),this.table.on("filterAdded",this._tableFilterAddedHandler),this.table.on("filterRemoved",this._tableFilterRemovedHandler),this.table.on("filter",this._tableFilterHandler),this.table.on("group",this._tableGroupHandler),this.table.on("rowsSelected",this._tableRowsSelectedHandler),this.table.on("rowsInserted",this._tableRowsInsertedHandler),this.table.on("rowsDeleted",this._tableRowsDeletedHandler),this.table.on("allRowsDeleted",this._tableAllRowsDeletedHandler),this.table.on("rowOrderChanged",this._tableRowOrderChangedHandler),this.table.on("propertyChange",this._tablePropertyChangeHandler),this.tileAccordion.on("destroy",this._destroyHandler),this.table.on("destroy",this._destroyHandler)}_uninstallListeners(){this.tileAccordion.off("propertyChange",this._tileAccordionPropertyChangeHandler),this.tileAccordion.off("tileAction",this._tileAccordionActionHandler),this.tileAccordion.off("tileClick",this._tileAccordionClickHandler),this.table.off("filterAdded",this._tableFilterAddedHandler),this.table.off("filterRemoved",this._tableFilterRemovedHandler),this.table.off("filter",this._tableFilterHandler),this.table.off("group",this._tableGroupHandler),this.table.off("rowsSelected",this._tableRowsSelectedHandler),this.table.off("rowsInserted",this._tableRowsInsertedHandler),this.table.off("rowsDeleted",this._tableRowsDeletedHandler),this.table.off("allRowsDeleted",this._tableAllRowsDeletedHandler),this.table.off("rowOrderChanged",this._tableRowOrderChangedHandler),this.table.off("propertyChange",this._tablePropertyChangeHandler),this.tileAccordion.off("destroy",this._destroyHandler),this.table.off("destroy",this._destroyHandler)}setGridColumnCount(e){this.setProperty("gridColumnCount",e),this.tileAccordion&&this.tileAccordion.setGridColumnCount(e)}setTileGridLayoutConfig(e){this.setProperty("tileGridLayoutConfig",e),this.tileAccordion&&this.tileAccordion.setTileGridLayoutConfig(e)}setWithPlaceholders(e){this.setProperty("withPlaceholders",e),this.tileAccordion&&this.tileAccordion.setWithPlaceholders(e)}_setTileMappings(e){if(this._setProperty("tileMappings",e),!e)return;let t=e.map(this.resolveMapping,this);this._setTiles(t)}setTiles(e){this.setProperty("tiles",e)}_setTiles(e){this._isUpdatingTiles=!0,p.removeAll(this.tiles,e),this.reset(),this._setTilesInternal(e),this._isUpdatingTiles=!1}_setTilesInternal(e){if(e.some(s=>this.table.rowsMap[s.rowId]===void 0)){this.table.initialized?this.table.one("rowsInserted",this._setTilesInternal.bind(this,e)):this.table.one("init",this._setTilesInternal.bind(this,e));return}this._refreshTilesMap(e),this._initGroups(e),this._setProperty("tiles",e),this.tileAccordion.setTiles(this.tiles),this._updateGroupVisibility(),this._syncSelectionFromTableToTile()}loadTiles(){let e=this.table.rows.filter(s=>!s.parentRow),t=this.table.createTiles(e);t&&this.setTiles(t)}resolveMapping(e){let t=e.tile;return t.rowId=e.tableRow,t.setParent(this),t.setOwner(this),t}_refreshTilesMap(e){e||(e=this.tiles,this.tilesMap={}),e.forEach(t=>{this.tilesMap[t.rowId]=t})}getTilesForRows(e){return e.map(t=>this.tilesMap[t.id]).filter(t=>!!t)}_initGroups(e){let t=p.find(this.table.columns,s=>s.grouped&&s.sortIndex===0);e.forEach(s=>{let r=this.table.rowsMap[s.rowId],n=t?t.cellTextForGrouping(r):"default";n=u.nvl(n,""),this.groupForTileMap[r.id]=n;let o=this.tileAccordion.getGroupById(n);o||(o=this._createTileGroup(n,t,r),this._adaptTileGrid(o.body),this.tileAccordion.insertGroup(o)),s.parent=o})}_adaptTileGrid(e){b.mandatoryFunction(e,"_showContextMenu");let t=e._showContextMenu;e._showContextMenu=s=>{b.mandatoryFunction(this.table,"_filterMenusForContextMenu"),s.menuItems=this.table._filterMenusForContextMenu(),u.assertProperty(this.table,"_filterMenusHandler"),s.menuFilter=this.table._filterMenusHandler,t.call(e,s)},e.keyStrokeContext.$bindTarget=this.table.keyStrokeContext.$bindTarget}_createTileAccordion(){return u.create(Vp,{parent:this.table,virtual:!0,selectable:!0,multiSelect:this.table.multiSelect,exclusiveExpand:this.exclusiveExpand,gridColumnCount:this.gridColumnCount,tileGridLayoutConfig:this.tileGridLayoutConfig,withPlaceholders:this.withPlaceholders})}_createTileGroup(e,t,s){let r,n,o;if(t){r=t.htmlEnabled;let l=t.createAggrGroupCell(s);n=l.text,o=l.iconId}return u.create(mi,{parent:this.tileAccordion,id:e,headerVisible:e!=="default",title:n,titleHtmlEnabled:r,iconId:o,body:{objectType:$n,scrollable:!1}})}activate(){this.tableState.headerVisible=this.table.headerVisible,this.table.setHeaderVisible(!1),this.table.tileTableHeader&&this.table.tileTableHeader.setVisible(!0),this.table.tableControls.forEach(t=>{t instanceof Vs&&(this.tableState.aggregateTableControlSelected=t.selected,t.setSelected(!1,{closeWhenUnselected:!0,animate:!1}),t.setVisible(!1))}),this.tableState.loadingSupportContainer=this.table.loadingSupport.options$Container,this.table.loadingSupport.options$Container=function(){return this.tileAccordion.$container}.bind(this),p.find(this.table.rows,t=>!!t.parentRow)!==null&&(this._tableHierarchyFilter=u.create(oc,{table:this.table}),this.table.addFilter(this._tableHierarchyFilter)),this._syncFiltersFromTableToTile(),this._syncScrollTopFromTableToTile()}deactivate(){this.table.tableControls.forEach(e=>{e instanceof Vs&&e.setVisible(!0)}),this.table._setProperty("headerVisible",this.tableState.headerVisible),this.table.tileTableHeader&&this.table.tileTableHeader.setVisible(!1),this.tableState.loadingSupportContainer&&(this.table.loadingSupport.options$Container=this.tableState.loadingSupportContainer),this._tableHierarchyFilter&&(this.table.removeFilter(this._tableHierarchyFilter),this._tableHierarchyFilter=null),this._syncScrollTopFromTileGridToTable(),this.reset()}reset(){this.tilesMap={},this.groupForTileMap={},this.tileAccordion.deleteAllTiles(),this.tileAccordion.deleteAllGroups(),this.tiles.forEach(e=>e.destroy())}renderTileMode(){this.table.tileMode?(this.table.$data&&this.table._removeData(),this._renderTileTableHeader(),this._renderTileAccordion()):(this._removeTileTableHeader(),this._removeTileAccordion(),this.table._renderData(),this.table._renderTableHeader(),this.tableState.aggregateTableControlSelected&&p.find(this.table.tableControls,e=>e instanceof Vs).setSelected(!0)),this.table._refreshMenuBarPosition()}destroy(){this.tiles.forEach(e=>e.destroy()),this.tileAccordion.destroy(),this.tileAccordion=null}insertTiles(e){e=p.ensure(e),e.length!==0&&this.setTiles(this.tiles.concat(e))}deleteTiles(e){e||(e=this.tiles.slice()),p.removeAll(this.tiles,e),e.forEach(t=>{delete this.tilesMap[t.rowId],delete this.groupForTileMap[t.rowId];let s=this.tileAccordion.getGroupByTile(t);s&&s.body.tiles.length===1&&this.tileAccordion.deleteGroup(s),t.destroy()}),this.tileAccordion.deleteTiles(e)}_onTileAccordionPropertyChange(e){!this.table.tileMode||(e.propertyName==="selectedTiles"?(this._syncSelectionFromTileGridToTable(e.source.getSelectedTiles()),this.tileAccordion.rendered&&this.tileAccordion.$container.document(!0).getSelection().removeAllRanges()):e.propertyName==="filteredTiles"&&this._updateGroupVisibility())}_onTileAccordionAction(e){!this.table.tileMode||this.table.doRowAction(this.table.rowsMap[e.tile.rowId])}_onTileAccordionClick(e){!this.table.tileMode||this.table._triggerRowClick(e.originalEvent,this.table.rowsMap[e.tile.rowId],e.mouseButton)}_onTableRowsSelected(e){!this.table.tileMode||this._syncSelectionFromTableToTile()}_onTableRowsInserted(e){!this.table.tileMode||this.insertTiles(this.table.createTiles(e.rows))}_onTableRowsDeleted(e){!this.table.tileMode||this.deleteTiles(this.getTilesForRows(e.rows))}_onTableAllRowsDeleted(e){!this.table.tileMode||this.deleteTiles()}_onTableRowOrderChangedHandler(e){!this.table.tileMode||a().isEmptyObject(this.tilesMap)||(this.tiles=this.table.rows.map(t=>this.tilesMap[t.id]),this.tileAccordion.setTiles(this.tiles))}_onTableGroup(e){!this.table.tileMode||(this.tileAccordion.deleteAllGroups(),this._initGroups(this.tiles),this.tileAccordion.setTiles(this.tiles))}_onTableFilterAdded(e){!this.table.tileMode||this._addFilter(e.filter)}_onTableFilterRemoved(e){!this.table.tileMode||this.tileAccordion.removeFilter(e.filter.tileFilter)}_addFilter(e){let t={table:this.table,accept:s=>{let r=this.table.rowsMap[s.rowId];return r?e.accept(r):!1}};e.tileFilter&&this.tileAccordion.removeFilter(e.tileFilter,!1),e.tileFilter=t,this.tileAccordion.addFilter(t)}_onTableFilter(e){!this.table.tileMode||this.tileAccordion.filter()}_syncSelectionFromTableToTile(){this.tileAccordion&&this.tileAccordion.selectTiles(this.getTilesForRows(this.table.selectedRows))}_syncSelectionFromTileGridToTable(e){if(!this._isUpdatingTiles){let t=e.map(s=>this.table.rowsMap[s.rowId]).filter(s=>Boolean(s));this.table.selectRows(t)}}_updateGroupVisibility(){this.tileAccordion.groups.forEach(e=>{let t=e.body,s=t.filters.length>0&&t.filteredTiles.length===0;e.setVisible(!s),e.setTitleSuffix(t.filteredTiles.length+"")})}_syncScrollTopFromTableToTile(){let e=this.table._rowIndexAtScrollTop(this.table.scrollTop);if(e<=0)return;let t=this.tilesMap[this.table.rows[e].id];if(!t)return;this.tileAccordion.scrollTop=null;let s={align:"top"};if(!t.rendered){this.table.session.layoutValidator.schedulePostValidateFunction(t.reveal.bind(t,s));return}t.reveal(s)}_syncScrollTopFromTileGridToTable(){let e=this.tileAccordion.tileAtScrollTop(this.tileAccordion.scrollTop);if(e){let t={align:"top"};this.table._isDataRendered()?this.table.scrollTo(this.table.rowsMap[e.rowId],t):this.table.session.layoutValidator.schedulePostValidateFunction(this.table.scrollTo.bind(this.table,this.table.rowsMap[e.rowId],t))}}_syncFiltersFromTableToTile(){this.tileAccordion&&(this.tileAccordion.setFilters([]),this.table.filters.forEach(e=>this._addFilter(e)))}_onTablePropertyChange(e){e.propertyName==="multiSelect"&&this.tileAccordion.setMultiSelect(e.newValue)}_renderTileTableHeader(){this.table.tileTableHeader&&this.table.tileTableHeader.render()}_removeTileTableHeader(){this.table.tileTableHeader&&this.table.tileTableHeader.remove()}_renderTileAccordion(){this.tileAccordion.rendered||this.tileAccordion.render()}_removeTileAccordion(){this.tileAccordion.rendered&&this.tileAccordion.remove()}}class Su extends ke{static modifyTableTileGridMediator(){!te.get().remote||(b.replacePrototypeFunction(un,"loadTiles",function(){if(!this.modelAdapter)return this.loadTilesOrig()},!0),b.replacePrototypeFunction(un,"_onTableRowsInserted",function(e){if(!this.modelAdapter)return this._onTableRowsInsertedOrig(e)},!0),b.replacePrototypeFunction(un,"_onTableRowsDeleted",function(e){if(!this.modelAdapter)return this._onTableRowsDeletedOrig(e)},!0),b.replacePrototypeFunction(un,"_onTableAllRowsDeleted",function(e){if(!this.modelAdapter)return this._onTableAllRowsDeletedOrig(e)},!0))}}te.addListener("bootstrap",Su.modifyTableTileGridMediator);function ul(i,e,t){return e=Hx(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Hx(i){var e=Nx(i,"string");return typeof e=="symbol"?e:String(e)}function Nx(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Aa extends I{constructor(){super(),ul(this,"table",void 0),ul(this,"page",void 0),ul(this,"row",void 0),ul(this,"_tableRowsUpdatedHandler",void 0),ul(this,"_tableRowsInsertedHandler",void 0),this.table=null,this.page=null,this.row=null,this._tableRowsUpdatedHandler=this._onTableRowsUpdated.bind(this),this._tableRowsInsertedHandler=this._onTableRowsInserted.bind(this)}_init(e){super._init(e),this.row=this.page.row,this.table.on("rowsUpdated",this._tableRowsUpdatedHandler),this.table.on("rowsInserted",this._tableRowsInsertedHandler)}_destroy(){this.table.off("rowsUpdated",this._tableRowsUpdatedHandler),this.table.off("rowsInserted",this._tableRowsInsertedHandler),super._destroy()}_render(){this.$container=this.$parent.appendDiv("table-row-detail"),this.htmlComp=T.install(this.$container,this.session),this._renderRow()}_renderRow(){this.table.visibleColumns().forEach(this._renderCell.bind(this)),this.invalidateLayoutTree()}_renderCell(e){let t=this.table.cell(e,this.row);if(y.empty(t.text)&&!t.iconId)return;let s;e.headerHtmlEnabled?s=y.plainText(e.text):s=e.text,y.empty(s)&&(e.headerTooltipHtmlEnabled?s=y.plainText(e.headerTooltipText):s=e.headerTooltipText);let r=e.cellTextForRowDetail(this.row),n=this.$container.appendDiv("table-row-detail-field");y.empty(s)||n.appendSpan("table-row-detail-name").text(s+": ");let o=t.iconId,l=!y.empty(r);o&&n.appendIcon(o,"table-row-detail-icon").toggleClass("with-text",l),l&&n.appendSpan("table-row-detail-value").html(r)}_refreshRow(){this.$container.empty(),this._renderRow()}_onTableRowsUpdated(e){if(!this.rendered)return;let t=e.rows,s=p.find(t,r=>r.id===this.row.id);!s||(this.row=s,this._refreshRow())}_onTableRowsInserted(e){!this.rendered||e.source.rows.indexOf(this.page.row)<0||(this.row=this.page.row,this._refreshRow())}}function hg(i,e,t){return e=Vx(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Vx(i){var e=Wx(i,"string");return typeof e=="symbol"?e:String(e)}function Wx(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class dg extends I{constructor(){super(),hg(this,"tableRow",void 0),hg(this,"tile",void 0),this.tableRow=null,this.tile=null,this._addWidgetProperties(["tile"])}}class ug extends ke{}function Pu(i,e,t){return e=zx(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function zx(i){var e=Kx(i,"string");return typeof e=="symbol"?e:String(e)}function Kx(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class xu extends ls{constructor(){super(...arguments),Pu(this,"table",void 0),Pu(this,"row",void 0),Pu(this,"_rowOrderChangedFunc",void 0)}_init(e){super._init(e),this.table=e.table}_render(){super._render(),this._rowOrderChangedFunc=e=>{e.animating?e.row===this.row&&this.position():this.position()},this.table.on("rowOrderChanged",this._rowOrderChangedFunc)}_remove(){super._remove(),this.table.off("rowOrderChanged",this._rowOrderChangedFunc)}}function Eu(i,e,t){return e=Gx(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Gx(i){var e=Ux(i,"string");return typeof e=="symbol"?e:String(e)}function Ux(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Fu{constructor(e){Eu(this,"promises",void 0),Eu(this,"table",void 0),Eu(this,"_rowMap",void 0),this._rowMap={},this.promises=[],this.table=e}pushPromise(e){this.promises.push(e),this.table._renderViewportBlocked=!0,this.table.setLoading(!0);let t=function(){p.remove(this.promises,e),this.promises.length===0&&this.process()}.bind(this);e.then(t,t)}isBuffering(){return this.promises.length>0}buffer(e){e=p.ensure(e),e.forEach(t=>{this._rowMap[t.id]=t})}process(){if(this.table.destroyed)return;let e=b.values(this._rowMap);this.table.updateRows(e),this._rowMap={},this.table.setLoading(!1),this.table._renderViewportBlocked=!1,this.table._isDataRendered()&&this.table._renderViewport()}}function qx(i,e,t){return e=Yx(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Yx(i){var e=jx(i,"string");return typeof e=="symbol"?e:String(e)}function jx(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Du extends Vn{constructor(){super(),qx(this,"table",void 0),this.table=null}_init(e){super._init(e)}_data(){let e=[];return e.push([null,this.session.text("NoGrouping"),"BOLD"]),this.table.visibleColumns().forEach(t=>{this.table.isGroupingPossible(t)&&e.push([t,u.nvl(t.text,t.headerTooltipText)])}),e}_dataToLookupRow(e){return u.create(Ys,{key:e[0],text:e[1],font:e[2]})}}function Xx(i,e,t){return e=Jx(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Jx(i){var e=Qx(i,"string");return typeof e=="symbol"?e:String(e)}function Qx(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Au extends Vn{constructor(){super(),Xx(this,"table",void 0),this.table=null}_data(){let e=[];return this.table.visibleColumns().forEach(t=>{t.isSortingPossible()&&(e.push([{column:t,asc:!0},u.nvl(t.text,t.headerTooltipText)+" ("+this.session.text("ui.ascending")+")",ye.LONG_ARROW_UP_BOLD]),e.push([{column:t,asc:!1},u.nvl(t.text,t.headerTooltipText)+" ("+this.session.text("ui.descending")+")",ye.LONG_ARROW_DOWN_BOLD]))}),e}_dataToLookupRow(e){return u.create(Ys,{key:e[0],text:e[1],iconId:e[2]})}}const mt={TEXT:{collator:null,installed:!1,install(i){return this.installed?!!this.collator:(x.get().supportsInternationalization()?(this.collator=new window.Intl.Collator(i.locale.languageTag),a().log.isInfoEnabled()&&a().log.info("(comparators.TEXT#install) Browser supports i18n - installed Intl.Collator, can sort in Browser")):a().log.isInfoEnabled()&&a().log.info("(comparators.TEXT#install) Browser doesn't support i18n. Must sort on server"),this.installed=!0,!!this.collator)},compare(i,e){return!i&&!e?0:i?e?this.collator?this.collator.compare(i,e):i<e?-1:i>e?1:0:1:-1},compareIgnoreCase(i,e){return i||(i=null),e||(e=null),i===e?0:i===null?-1:e===null?1:this.compare(i.toLowerCase(),e.toLowerCase())}},NUMERIC:{install(i){return!0},compare(i,e){return b.isNullOrUndefined(i)&&b.isNullOrUndefined(e)?0:b.isNullOrUndefined(i)?-1:b.isNullOrUndefined(e)?1:i<e?-1:i>e?1:0}},ALPHANUMERIC:{collator:null,installed:!1,install(i){return mt.TEXT.install(i),this.collator=mt.TEXT.collator,!!this.collator&&mt.NUMERIC.install(i)},compare(i,e){return this._compare(i,e,!1)},compareIgnoreCase(i,e){return this._compare(i,e,!0)},_compare(i,e,t){if(!i&&!e)return 0;if(!i)return-1;if(!e)return 1;let s="(([0-9]+)|([^0-9]+))",r=new RegExp(s,"g"),n=new RegExp(s,"g"),o=r.exec(i+""),l=n.exec(e+"");for(;o&&l;){let h=parseInt(o[1],0),d=parseInt(l[1],0);if(!isNaN(h)&&!isNaN(d)){let c=mt.NUMERIC.compare(h,d);if(c!==0)return c}else{let c=t?mt.TEXT.compareIgnoreCase(o[1],l[1]):mt.TEXT.compare(o[1],l[1]);if(c!==0)return c}o=r.exec(i+""),l=n.exec(e+"")}return!o&&!l?0:o?1:-1}},compare(i){let e=0;for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];return s.some(n=>{if(n.length!==2)throw new Error("The pair must have exactly 2 elements");return e=i(n[0],n[1]),e!==0}),e}};function N(i,e,t){return e=Zx(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Zx(i){var e=eE(i,"string");return typeof e=="symbol"?e:String(e)}function eE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class De extends Ml{constructor(){super(),N(this,"objectType",void 0),N(this,"id",void 0),N(this,"autoOptimizeWidth",void 0),N(this,"autoOptimizeWidthRequired",void 0),N(this,"session",void 0),N(this,"autoOptimizeMaxWidth",void 0),N(this,"cssClass",void 0),N(this,"compacted",void 0),N(this,"editable",void 0),N(this,"removable",void 0),N(this,"modifiable",void 0),N(this,"fixedWidth",void 0),N(this,"fixedPosition",void 0),N(this,"grouped",void 0),N(this,"headerCssClass",void 0),N(this,"headerIconId",void 0),N(this,"headerHtmlEnabled",void 0),N(this,"headerTooltipText",void 0),N(this,"headerBackgroundColor",void 0),N(this,"headerForegroundColor",void 0),N(this,"headerFont",void 0),N(this,"headerTooltipHtmlEnabled",void 0),N(this,"horizontalAlignment",void 0),N(this,"htmlEnabled",void 0),N(this,"initialAlwaysIncludeSortAtBegin",void 0),N(this,"initialAlwaysIncludeSortAtEnd",void 0),N(this,"index",void 0),N(this,"initialized",void 0),N(this,"guiOnly",void 0),N(this,"mandatory",void 0),N(this,"optimalWidthMeasurer",void 0),N(this,"sortActive",void 0),N(this,"checkable",void 0),N(this,"sortAscending",void 0),N(this,"sortIndex",void 0),N(this,"summary",void 0),N(this,"type",void 0),N(this,"width",void 0),N(this,"initialWidth",void 0),N(this,"minWidth",void 0),N(this,"showSeparator",void 0),N(this,"table",void 0),N(this,"tableNodeColumn",void 0),N(this,"maxLength",void 0),N(this,"text",void 0),N(this,"textWrap",void 0),N(this,"filterType",void 0),N(this,"comparator",void 0),N(this,"displayable",void 0),N(this,"visible",void 0),N(this,"textBased",void 0),N(this,"headerMenuEnabled",void 0),N(this,"tableNodeLevel0CellPadding",void 0),N(this,"expandableIconLevel0CellPadding",void 0),N(this,"nodeColumnCandidate",void 0),N(this,"$header",void 0),N(this,"$separator",void 0),N(this,"_realWidth",void 0),N(this,"_tableColumnsChangedHandler",void 0),this.autoOptimizeWidth=!1,this.autoOptimizeWidthRequired=!1,this.autoOptimizeMaxWidth=-1,this.compacted=!1,this.removable=!1,this.cssClass=null,this.editable=!1,this.modifiable=!1,this.fixedWidth=!1,this.fixedPosition=!1,this.grouped=!1,this.headerCssClass=null,this.headerIconId=null,this.headerHtmlEnabled=!1,this.headerTooltipText=null,this.headerTooltipHtmlEnabled=!1,this.horizontalAlignment=-1,this.htmlEnabled=!1,this.index=-1,this.initialized=!1,this.mandatory=!1,this.optimalWidthMeasurer=new $u(this),this.sortActive=!1,this.sortAscending=!0,this.sortIndex=-1,this.summary=!1,this.type="text",this.width=60,this.initialWidth=void 0,this.minWidth=De.DEFAULT_MIN_WIDTH,this.showSeparator=!0,this.table=null,this.tableNodeColumn=!1,this.maxLength=4e3,this.text=null,this.textWrap=!1,this.filterType="TextColumnUserFilter",this.comparator=mt.TEXT,this.displayable=!0,this.visible=!0,this.textBased=!0,this.headerMenuEnabled=!0,this.tableNodeLevel0CellPadding=28,this.expandableIconLevel0CellPadding=13,this.nodeColumnCandidate=!0,this._tableColumnsChangedHandler=this._onTableColumnsChanged.bind(this),this._realWidth=null,this.$header=null,this.$separator=null}init(e){this.session=e.session,a().extend(this,e),this.initialWidth===void 0&&(this.initialWidth=u.nvl(this.width,0)),this._init(e),this.initialized=!0}_init(e){Ce.resolveTextProperty(this,"text"),Ce.resolveTextProperty(this,"headerTooltipText"),ye.resolveIconProperty(this,"headerIconId"),this._setTable(this.table),this._setDisplayable(this.displayable),this._setAutoOptimizeWidth(this.autoOptimizeWidth)}destroy(){this._destroy(),this._setTable(null)}_destroy(){}_setTable(e){this.table&&this.table.off("columnMoved columnStructureChanged",this._tableColumnsChangedHandler),this.table=e,this.table&&this.table.on("columnMoved columnStructureChanged",this._tableColumnsChangedHandler)}initCell(e,t){let s=this._ensureCell(e);return this._initCell(s),b.isNullOrUndefined(s.text)&&this._updateCellText(t,s),s}_ensureCell(e){let t;if(e instanceof Pt)t=e,t.value=this._parseValue(t.value);else{let s=Pt;t=u.create(s,{value:this._parseValue(e)})}return t}_parseValue(e){return e}_updateCellText(e,t){let s=t.value;if(!e)return;let r=this._formatValue(s,e);b.isPromise(r)?this.setCellTextDeferred(r,e,t):this.setCellText(e,r,t)}_formatValue(e,t){return u.nvl(e,"")}_initCell(e){return e.cssClass=u.nvl(e.cssClass,this.cssClass),e.editable=u.nvl(e.editable,this.editable),e.horizontalAlignment=u.nvl(e.horizontalAlignment,this.horizontalAlignment),e.htmlEnabled=u.nvl(e.htmlEnabled,this.htmlEnabled),e.mandatory=u.nvl(e.mandatory,this.mandatory),e}buildCellForRow(e){let t=this.cell(e);return this.buildCell(t,e)}buildCellForAggregateRow(e){let t;if(this.grouped){let s=this.table.groupingStyle===V.GroupingStyle.TOP?e.nextRow:e.prevRow;t=this.createAggrGroupCell(s)}else{let s=e.contents[this.table.columns.indexOf(this)];t=this.createAggrValueCell(s)}return this.buildCell(t,{})}buildCell(e,t){u.assertParameter("cell",e,Pt);let s=this.table.isTableNodeColumn(this),r=0;s&&(r=this.table._calcRowLevelPadding(t));let n=this._text(e),o=this._icon(e.iconId,!!n)||"",l=this._cellCssClass(e,s),h=this._cellStyle(e,s,r);e.errorStatus&&(t.hasError=!0);let d;return!n&&!o?(d="&nbsp;",l=y.join(" ",l,"empty")):e.flowsLeft?d=n+o:d=o+n,s&&t.expandable&&(this.tableNodeColumn=!0,d=this._expandIcon(t.expanded,r)+d,t.expanded&&(l+=" expanded")),this._buildCell(e,d,h,l)}_buildCell(e,t,s,r){return'<div class="'+r+'" style="'+s+'">'+t+"</div>"}_expandIcon(e,t){let s="padding-left: "+(t+this.expandableIconLevel0CellPadding)+"px",r="table-row-control";return e&&(r+=" expanded"),'<div class="'+r+'" style="'+s+'"></div>'}_icon(e,t){let s,r;if(!!e)return s="table-cell-icon",t&&(s+=" with-text"),r=ye.parseIconId(e),r.isFontIcon()?(s+=" font-icon",'<span class="'+r.appendCssClass(s)+'">'+r.iconCharacter+"</span>"):(s+=" image-icon",'<img class="'+s+'" src="'+r.iconUrl+'">')}_text(e){let t=e.text||"";return e.htmlEnabled||(t=e.encodedText()||"",this.table.multilineText&&(t=y.nl2br(t,!1)),t&&(t='<span class="text">'+t+"</span>")),t}_cellCssClass(e,t){let s="table-cell";e.mandatory&&(s+=" mandatory"),(!this.table.multilineText||!this.textWrap)&&(s+=" white-space-nowrap"),e.editable&&(s+=" editable"),e.errorStatus&&(s+=" has-error"),e.iconId&&!e.text&&(s+=" icon-only"),s+=" halign-"+V.parseHorizontalAlignment(e.horizontalAlignment);let r=this.table.visibleColumns(),n=r.indexOf(this);return n===0&&(s+=" first"),n===r.length-1&&(s+=" last"),t&&(s+=" table-node"),e.cssClass&&(s+=" "+e.cssClass),s}_cellStyle(e,t,s){let r,n=this.width;return n===0?"display: none;":(r="min-width: "+n+"px; max-width: "+n+"px; ",t&&(r+=" padding-left: "+(this.tableNodeLevel0CellPadding+s)+"px; "),r+=M.legacyStyle(e),r)}onMouseUp(e,t){let s=t.data("row"),r=this.cell(s);this.isCellEditable(s,r,e)&&this.table.prepareCellEdit(this,s,!0)}isCellEditable(e,t,s){return this.table.enabledComputed&&e.enabled&&t.editable&&!s.ctrlKey&&!s.shiftKey}startCellEdit(e,t){let s=e.$row,r=this.cell(e),n=this.table.$cell(this,s);r.field=t,r.field.gridData.horizontalAlignment=r.horizontalAlignment;let o=this._createEditorPopup(e,r);return o.$anchor=n,o.open(this.table.$data),o}_createEditorPopup(e,t){let s=Nu;return u.create(s,{parent:this.table,column:this,row:e,cell:t})}cell(e){return this.table.cell(this,e)}headerCell(){let e=Pt;return u.create(e,{value:this.text,text:this.text,iconId:this.headerIconId,cssClass:this.headerCssClass,tooltipText:this.headerTooltipText,htmlEnabled:this.headerHtmlEnabled})}selectedCell(){let e=this.table.selectedRow();return this.table.cell(this,e)}cellValueOrText(e){return this.textBased?this.table.cellText(this,e):this.table.cellValue(this,e)}cellValue(e){return this.table.cellValue(this,e)}cellText(e){return this.table.cellText(this,e)}cellValueOrTextForCalculation(e){let t=this.cell(e),s=this.cellValueOrText(e);return b.isNullOrUndefined(s)?null:this._preprocessValueOrTextForCalculation(s,t)}_preprocessValueOrTextForCalculation(e,t){return typeof e=="string"?this._preprocessTextForCalculation(e,t==null?void 0:t.htmlEnabled):e}_preprocessTextForCalculation(e,t){return this._preprocessText(e,{removeHtmlTags:t,removeNewlines:!0,trim:!0})}cellTextForGrouping(e){let t=this.cell(e);return this._preprocessTextForGrouping(t.text,t.htmlEnabled)}_preprocessTextForGrouping(e,t){return this._preprocessText(e,{removeHtmlTags:t,trim:!0})}cellTextForTextFilter(e){let t=this.cell(e);return this._preprocessTextForTextFilter(t.text,t.htmlEnabled)}_preprocessTextForTextFilter(e,t){return this._preprocessText(e,{removeHtmlTags:t})}cellTextForRowDetail(e){let t=this.cell(e);return this._preprocessText(this._text(t),{removeHtmlTags:t.htmlEnabled})}_preprocessText(e,t){return e==null||(t=t||{},t.removeHtmlTags&&(e=y.plainText(e)),t.removeNewlines&&(e=e.replace(`
`," ")),t.trim&&(e=e.trim())),e}setCellValue(e,t){let s=this.cell(e);this._setCellValue(e,t,s),this._updateCellText(e,s)}_setCellValue(e,t,s){t=this._parseValue(t),s.value!==t&&e.status===Xt.Status.NON_CHANGED&&(e.status=Xt.Status.UPDATED),s.setValue(t)}setCellTextDeferred(e,t,s){e.done(r=>this.setCellText(t,r,s)).fail(r=>{this.setCellText(t,"",s),a().log.error("Could not resolve cell text for value "+s.value,r)}),this.table.updateBuffer.pushPromise(e)}setCellText(e,t,s){s||(s=this.cell(e)),s.text!==t&&(s.setText(t),e.initialized&&this.table&&this.table.updateRow(e))}setCellErrorStatus(e,t,s){s||(s=this.cell(e)),s.setErrorStatus(t)}setCellIconId(e,t){let s=this.cell(e);s.iconId!==t&&(s.setIconId(t),e.initialized&&this.table.updateRow(e))}setHorizontalAlignment(e){!this.setProperty("horizontalAlignment",e)||(this.table.rows.forEach(s=>this.cell(s).setHorizontalAlignment(e)),this.table.updateRows(this.table.rows),this.table.header&&this.table.header.updateHeader(this))}setEditable(e){!this.setProperty("editable",e)||(this.table.rows.forEach(s=>this.cell(s).setEditable(e)),this.table.updateRows(this.table.rows))}setMandatory(e){!this.setProperty("mandatory",e)||(this.table.rows.forEach(s=>this.cell(s).setMandatory(e)),this.table.updateRows(this.table.rows))}setCssClass(e){!this.setProperty("cssClass",e)||(this.table.rows.forEach(s=>this.cell(s).setCssClass(e)),this.table.updateRows(this.table.rows))}setWidth(e){!this.setProperty("width",e)||this.table.resizeColumn(this,e)}createAggrGroupCell(e){let t=this.cell(e),s=Pt;return this.initCell(u.create(s,{value:t.value,text:this.cellTextForGrouping(e),iconId:t.iconId,horizontalAlignment:this.horizontalAlignment,htmlEnabled:!1,cssClass:"table-aggregate-cell"+(t.cssClass?" "+t.cssClass:""),backgroundColor:"inherit",flowsLeft:this.horizontalAlignment>0}))}createAggrValueCell(e){return this.createAggrEmptyCell()}createAggrEmptyCell(){let e=Pt;return this.initCell(u.create(e,{empty:!0,cssClass:"table-aggregate-cell"}))}calculateOptimalWidth(){return this.optimalWidthMeasurer.measure()}createFilter(){return u.create(this.filterType,{session:this.session,table:this.table,column:this})}createTableHeaderMenu(e){let t=this.$header;return u.create(yi,{parent:e,column:t.data("column"),tableHeader:e,$anchor:t})}createEditor(e){let t=this._createEditor(e),s=this.cell(e);this._initEditorField(t,s),t.setLabelVisible(!1),t.setFieldStyle(A.FieldStyle.CLASSIC);let r=new ze(t.gridDataHints);return r.horizontalAlignment=s.horizontalAlignment,t.setGridDataHints(r),t}_initEditorField(e,t){t.errorStatus?this._updateEditorFromInvalidCell(e,t):this._updateEditorFromValidCell(e,t)}_updateEditorFromValidCell(e,t){e.setValue(t.value)}_updateEditorFromInvalidCell(e,t){e.setErrorStatus(t.errorStatus),e.setDisplayText(t.text)}_createEditor(e){return u.create(ki,{parent:this.table,maxLength:this.maxLength,multilineText:this.table.multilineText,wrapText:this.textWrap})}updateCellFromEditor(e,t){t.errorStatus?this._updateCellFromInvalidEditor(e,t):this._updateCellFromValidEditor(e,t)}_updateCellFromInvalidEditor(e,t){this.setCellErrorStatus(e,t.errorStatus),this.setCellText(e,t.displayText)}_updateCellFromValidEditor(e,t){this.setCellErrorStatus(e,null),this.setCellValue(e,t.value)}installComparator(){return this.comparator.install(this.session)}isSortingPossible(){return this.installComparator(),!0}compare(e,t){let s=this.table.cell(this,e),r=this.table.cell(this,t);if(s.sortCode!==null||r.sortCode!==null)return mt.NUMERIC.compare(s.sortCode,r.sortCode);let n=this.cellValueOrText(e),o=this.cellValueOrText(t);return this.comparator.compare(n,o)}isVisible(){return this.displayable&&this.visible&&!this.compacted}setVisible(e,t){this.visible!==e&&this._setVisible(e,t)}_setVisible(e,t){this._setProperty("visible",e),u.nvl(t,this.initialized)&&this.table.onColumnVisibilityChanged()}setDisplayable(e,t){this.displayable!==e&&this._setDisplayable(e,t)}_setDisplayable(e,t){this._setProperty("displayable",e),u.nvl(t,this.initialized)&&this.table.onColumnVisibilityChanged()}setCompacted(e,t){this.compacted!==e&&this._setCompacted(e,t)}_setCompacted(e,t){this._setProperty("compacted",e),u.nvl(t,this.initialized)&&this.table.onColumnVisibilityChanged()}setAutoOptimizeWidth(e){this.setProperty("autoOptimizeWidth",e)}_setAutoOptimizeWidth(e){this._setProperty("autoOptimizeWidth",e),this.autoOptimizeWidthRequired=e,this.initialized&&(this.table.columnLayoutDirty=!0,this.table.invalidateLayoutTree())}setMaxLength(e){this.setProperty("maxLength",e)}setText(e){this.setProperty("text",e)&&this.table.header&&this.table.header.updateHeader(this)}setHeaderIconId(e){this.setProperty("headerIconId",e)&&this.table.header&&this.table.header.updateHeader(this)}setHeaderCssClass(e){let t=a().extend({},this);this.setProperty("headerCssClass",e)&&this.table.header&&this.table.header.updateHeader(this,t)}setHeaderHtmlEnabled(e){this.setProperty("headerHtmlEnabled",e)&&this.table.header&&this.table.header.updateHeader(this)}setHeaderTooltipText(e){this.setProperty("headerTooltipText",e)}setHeaderTooltipHtmlEnabled(e){this.setProperty("headerTooltipHtmlEnabled",e)}setTextWrap(e){this.setProperty("textWrap",e)&&this.table.rendered&&this.table.multilineText&&(this.autoOptimizeWidthRequired=!0,this.table.redraw())}isContentValid(e){let t=this.cell(e),s=!t.errorStatus||t.errorStatus.severity!==E.Severity.ERROR,r=!t.mandatory||this._hasCellValue(t);return{valid:s&&r,validByErrorStatus:s,validByMandatory:r}}_hasCellValue(e){return!!e.value}_onTableColumnsChanged(e){this.table.visibleColumns().indexOf(this)===0?(this.tableNodeLevel0CellPadding=28,this.expandableIconLevel0CellPadding=13):(this.tableNodeLevel0CellPadding=23,this.expandableIconLevel0CellPadding=8)}realWidthIfAvailable(){return this._realWidth||this.width}}N(De,"DEFAULT_MIN_WIDTH",60),N(De,"SMALL_MIN_WIDTH",38),N(De,"NARROW_MIN_WIDTH",34);function Pr(i,e,t){return e=tE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function tE(i){var e=iE(i,"string");return typeof e=="symbol"?e:String(e)}function iE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class $u{constructor(e){Pr(this,"column",void 0),Pr(this,"table",void 0),Pr(this,"deferred",void 0),Pr(this,"imageCount",void 0),Pr(this,"completeImageCount",void 0),Pr(this,"$measurement",void 0),Pr(this,"_imageLoadOrErrorHandler",void 0),Pr(this,"_columnCellContents",void 0),this.column=e,this.table=null,this.$measurement=null,this.deferred=null,this.imageCount=0,this.completeImageCount=0,this._imageLoadOrErrorHandler=this._onImageLoadOrError.bind(this),this._columnCellContents={}}measure(){if(a().log.isDebugEnabled()&&a().log.debug("Optimal width measuring started for column "+this.column.id),this.table=this.column.table,this.$measurement&&(a().log.isDebugEnabled()&&a().log.debug("Optimal width measuring aborted for column "+this.column.id),this._resolve(-1)),this.$measurement=this.table.$data.makeDiv("hidden"),this.imageCount=0,this.completeImageCount=0,this._appendElements(),this.table.$data.append(this.$measurement),this.completeImageCount>=this.imageCount){let e=this._measure();return a().log.isDebugEnabled()&&a().log.debug("Optimal width measuring done (sync) for column "+this.column.id+": "+e),this.remove(),e}return a().log.isDebugEnabled()&&a().log.debug("Not all images loaded, deferring measurement for column "+this.column.id+". Images complete: "+this.completeImageCount+"/"+this.imageCount),this.$measurement[0].addEventListener("load",this._imageLoadOrErrorHandler,!0),this.$measurement[0].addEventListener("error",this._imageLoadOrErrorHandler,!0),this.deferred=a().Deferred(),this.deferred.promise()}remove(){!this.$measurement||(this.$measurement[0].removeEventListener("load",this._imageLoadOrErrorHandler,!0),this.$measurement[0].removeEventListener("error",this._imageLoadOrErrorHandler,!0),this.$measurement.remove(),this.$measurement=null)}_measure(){let e=this.column.minWidth,t=0;return this.$measurement.addClass("invisible").removeClass("hidden").children().each(function(){this.dataset.overlap&&(t=Math.max(t,parseInt(this.dataset.overlap,10))),e=Math.max(e,v.size(a()(this),!0).width)}),e+t}_resolve(e){this.remove(),this.deferred&&(this.deferred.resolve(e),this.deferred=null)}_appendElements(){this._appendHeader(),this._appendRows(),this._appendAggregateRows()}_appendHeader(){this.column.$header&&this._appendToMeasurement(this.column.$header.clone())}_appendRows(){this.table.rows.forEach(this._appendRow.bind(this)),this._columnCellContents={}}_appendRow(e){let t=this.column.buildCellForRow(e);this._columnCellContents[t]||(this._columnCellContents[t]=!0,this._appendToMeasurement(a()(t)))}_appendAggregateRows(){this.table._aggregateRows.forEach(this._appendAggregateRow.bind(this))}_appendAggregateRow(e){this._appendToMeasurement(this._build$CellForAggregateRow(e))}_build$CellForAggregateRow(e){let t=this.table.visibleColumns(),s=t.indexOf(this.column),r=this.table._build$AggregateRow(e);r.appendTo(this.table.$data),t.map(l=>l.buildCellForAggregateRow(e)).forEach(l=>a()(l).appendTo(r));let n=r.children().eq(s),o=this._getAggregateOverlap(n);return o>0&&(n[0].dataset.overlap=o+""),r.detach(),n}_getAggregateOverlap(e){if(!e||!e.length||e.hasClass("empty"))return 0;let t=this.table._getAggrCellRange(e);if(t.length<2)return 0;let s=t[t.length-1];if(s.hasClass("empty")||e.hasClass("halign-right")===s.hasClass("halign-right"))return 0;let r=s.children(".text");if(!r||!r.length)return 0;let n=v.size(r).width-s.cssMaxWidth()+s.cssPaddingLeft();if(n<=0)return 0;for(let o=t.length-1;o>0;o--){let l=t[o];l.hasClass("empty")&&(n-=l.cssMaxWidth())}return Math.max(0,n)}_appendToMeasurement(e){e.find("img").each((s,r)=>{let n=a()(r);n.data("measure","in-progress"),r.complete&&(n.data("complete",r.complete),this.completeImageCount++),this.imageCount++}),e.css({minWidth:"",maxWidth:""}).appendTo(this.$measurement)}_onImageLoadOrError(e){if(!a()(e.target).data("complete")&&(this.completeImageCount++,a().log.isTraceEnabled()&&a().log.trace("Images complete (async) "+this.completeImageCount+"/"+this.imageCount,e.target.src),this.completeImageCount>=this.imageCount)){let s=this._measure();a().log.isDebugEnabled()&&a().log.debug("Optimal width measuring done (async) for column "+this.column.id+": "+s),this._resolve(s)}}}class cg extends De{constructor(){super(),this.comparator=mt.ALPHANUMERIC}}class pg extends De{buildCellForRow(e){let t=this.cell(e),s=this._cellCssClass(t),r=this._cellStyle(t),n=a()(super._buildCell(t,"",r,s)),o=this.table.cellValue(this,e);return t.errorStatus&&(e.hasError=!0),this._renderValue(n,o),n[0].outerHTML}_renderValue(e,t){}_plainTextForRow(e){let t=this.table.cell(this,e);if(!t.plainText){let s=this.buildCellForRow(e);t.plainText=y.plainText(s)}return t.plainText}cellValueOrTextForCalculation(e){let t=this._plainTextForRow(e);return this._preprocessTextForCalculation(t)}cellTextForGrouping(e){let t=this._plainTextForRow(e);return this._preprocessTextForGrouping(t)}cellTextForTextFilter(e){let t=this._plainTextForRow(e);return this._preprocessTextForTextFilter(t)}compare(e,t){let s=this._plainTextForRow(e),r=this._plainTextForRow(t);return this.comparator.compareIgnoreCase(s,r)}}function sE(i,e,t){return e=rE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function rE(i){var e=nE(i,"string");return typeof e=="symbol"?e:String(e)}function nE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class cn extends De{constructor(){super(),sE(this,"triStateEnabled",void 0),this.comparator=mt.NUMERIC,this.filterType="ColumnUserFilter",this.horizontalAlignment=0,this.minWidth=De.SMALL_MIN_WIDTH,this.triStateEnabled=!1,this.textBased=!1}_formatValue(e,t){return this.triStateEnabled&&e===null?"?":e?"X":""}buildCell(e,t){let s="",r=t.enabled,n=this.table.isTableNodeColumn(this),o=0;if(n&&(o=this.table._calcRowLevelPadding(t)),e.empty)return super.buildCell(e,t);r=r&&e.editable;let l=this._cellCssClass(e,n),h=this._cellStyle(e,n,o);r||(l+=" disabled");let d="check-box";return e.value===!0&&(d+=" checked"),this.triStateEnabled&&e.value!==!0&&e.value!==!1&&(d+=" undefined"),r||(d+=" disabled"),n&&t.expandable&&(this.tableNodeColumn=!0,s=this._expandIcon(t.expanded,o)+s,t.expanded&&(l+=" expanded")),s=s+'<div class="'+d+'"></div>',this._buildCell(e,s,h,l)}$checkBox(e){return this.table.$cell(this,e).children(".check-box")}_cellCssClass(e,t){let s=super._cellCssClass(e);return s=s.replace(" editable",""),s+=" checkable",t&&(s+=" table-node"),s}onMouseUp(e,t){let s=t.data("row"),r=this.cell(s);this.table.checkableColumn===this?this.table.checkRow(s,!s.checked):this.isCellEditable(s,r,e)&&this._toggleCellValue(s,r)}_toggleCellValue(e,t){let s=t.value;this.triStateEnabled?s===!1?this.setCellValue(e,!0):s===!0?this.setCellValue(e,null):s===null&&this.setCellValue(e,!1):this.setCellValue(e,!s)}_createEditor(e){return u.create(Dr,{parent:this.table,triStateEnabled:this.triStateEnabled})}cellTextForGrouping(e){let t=this.cell(e);return this.triStateEnabled&&t.value===null?this.session.text("ui.BooleanColumnGroupingMixed"):t.value===!0?this.session.text("ui.BooleanColumnGroupingTrue"):this.session.text("ui.BooleanColumnGroupingFalse")}setTriStateEnabled(e){this.triStateEnabled!==e&&(this.triStateEnabled=e,this.table.rows.forEach(t=>this._updateCellText(t,this.cell(t))))}}class Ru extends De{constructor(){super(),this.cssClass="compact-cell",this.htmlEnabled=!0,this.width=120,this.textWrap=!0}_onMoreLinkAction(e,t){let r=this.table.$cell(this,e).find(".compact-cell-more-content"),n=!r.isVisible();r.setVisible(n),t.setVisible(!n),this.table.invalidateLayoutTree()}onMouseUp(e,t){let s=$(e.target),r=$(e.delegateTarget),n=s.findUp(o=>o.hasClass("more-link"),r);n.length>0&&this._onMoreLinkAction(t,n)}}function tr(i,e,t){return e=oE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function oE(i){var e=lE(i,"string");return typeof e=="symbol"?e:String(e)}function lE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Mu{constructor(){tr(this,"title",void 0),tr(this,"titleLine",void 0),tr(this,"titleSuffix",void 0),tr(this,"titleSuffixLine",void 0),tr(this,"subtitle",void 0),tr(this,"subtitleLine",void 0),tr(this,"contentLines",void 0),tr(this,"content",void 0),tr(this,"moreContent",void 0),this.title="",this.titleSuffix="",this.subtitle="",this.content="",this.moreContent="",this.contentLines=[]}setTitle(e){this.title=u.nvl(e,"")}setTitleLine(e){this.titleLine=e}setTitleSuffix(e){this.titleSuffix=u.nvl(e,"")}setTitleSuffixLine(e){this.titleSuffixLine=e}setSubtitle(e){this.subtitle=u.nvl(e,"")}setSubtitleLine(e){this.subtitleLine=e}addContentLine(e){this.contentLines.push(e)}setContent(e){this.content=u.nvl(e,"")}setMoreContent(e){this.moreContent=u.nvl(e,"")}transform(e){let t=u.nvl(e.removeEmptyContentLines,!0),s=u.nvl(e.maxContentLines,1e3);this.titleLine&&this.setTitle(this.titleLine.build()),this.titleSuffixLine&&this.setTitleSuffix(this.titleSuffixLine.build()),this.subtitleLine&&this.setSubtitle(this.subtitleLine.build());let r=[];t&&(r=this.contentLines.filter(l=>!!l.build())),s+1===r.length&&s++;let n=Math.min(r.length,s),o=y.join(`
`,...r.slice(0,n).map(l=>l.build()));if(o&&this.setContent(o),n<r.length){let l=y.join(`
`,...r.slice(n,r.length).map(h=>h.build()));this.setMoreContent(l)}}}function fg(i,e,t){return e=aE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function aE(i){var e=hE(i,"string");return typeof e=="symbol"?e:String(e)}function hE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Iu{constructor(e,t){fg(this,"labelBlock",void 0),fg(this,"textBlock",void 0),this.labelBlock=null,this.textBlock=null,e instanceof Pt?this.setLabelBlock(this.convertHeaderCellToBlock(e)):this.setLabelBlock(new cl(e)),t instanceof Pt?this.setTextBlock(this.convertCellToBlock(t)):this.setTextBlock(new cl(t))}convertHeaderCellToBlock(e){return this.convertCellToBlock(e)}convertCellToBlock(e){let t=new cl;return e!=null&&(t.setText(e.text),t.setIcon(e.iconId),t.setEncodeHtmlEnabled(!e.htmlEnabled)),t}setLabelBlock(e){u.assertParameter("block",e),this.labelBlock=e}setTextBlock(e){u.assertParameter("block",e),this.textBlock=e}build(){let e=this.labelBlock.build();e&&(e+=": ");let t=this.textBlock.build();return t?`
<div class="compact-cell-line">
  <span class="compact-cell-line-label">`.concat(e,`</span>
  <span class="compact-cell-line-value">`).concat(t,`</span>
</div>`):""}}function ho(i,e,t){return e=dE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function dE(i){var e=uE(i,"string");return typeof e=="symbol"?e:String(e)}function uE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class cl{constructor(e,t){ho(this,"text",void 0),ho(this,"icon",void 0),ho(this,"encodeHtmlEnabled",void 0),ho(this,"nlToBrEnabled",void 0),ho(this,"htmlToPlainTextEnabled",void 0),ho(this,"_processedText",void 0),this.text="",this.icon="",this._processedText=null,this.encodeHtmlEnabled=!0,this.nlToBrEnabled=!1,this.htmlToPlainTextEnabled=!1,this.setText(e),this.setIcon(t)}setText(e){this.text=u.nvl(e,"")}processedText(){return this._processedText==null&&(this._processedText=this.processText()),this._processedText}setIcon(e){this.icon=u.nvl(e,"")}setEncodeHtmlEnabled(e){this.encodeHtmlEnabled!==e&&(this._processedText=null),this.encodeHtmlEnabled=e}setNlToBrEnabled(e){this.nlToBrEnabled!==e&&(this._processedText=null),this.nlToBrEnabled=e}setHtmlToPlainTextEnabled(e){this.htmlToPlainTextEnabled!==e&&(this._processedText=null),this.htmlToPlainTextEnabled=e}processText(){let e=this.text;return this.htmlToPlainTextEnabled?(this.nlToBrEnabled&&(e=y.nl2br(e,!1)),e=y.plainText(e)):this.encodeHtmlEnabled&&(e=y.encode(e)),this.nlToBrEnabled&&(e=y.nl2br(e,!1)),e}build(){return this.icon?$("<div>").appendIcon(this.icon).addClass(this.processedText()?" with-text":"").parent()[0].innerHTML+this.processedText():this.processedText()}}function $a(i,e,t){return e=cE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function cE(i){var e=pE(i,"string");return typeof e=="symbol"?e:String(e)}function pE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Lu extends De{constructor(){super(),$a(this,"format",void 0),$a(this,"groupFormat",void 0),$a(this,"hasDate",void 0),$a(this,"hasTime",void 0),this.format=null,this.groupFormat="yyyy",this.hasDate=!0,this.hasTime=!1,this.filterType="DateColumnUserFilter",this.comparator=mt.NUMERIC,this.textBased=!1}_init(e){super._init(e),this._setFormat(this.format),this._setGroupFormat(this.groupFormat)}setFormat(e){this.setProperty("format",e)}_setFormat(e){e||(e=this._getDefaultFormat(this.session.locale));let t=xt.ensure(this.session.locale,e);this._setProperty("format",t),this.initialized&&this.table.rows.forEach(s=>this._updateCellText(s,this.cell(s)))}setGroupFormat(e){this.setProperty("groupFormat",e)}_setGroupFormat(e){e||(e=this._getDefaultFormat(this.session.locale));let t=xt.ensure(this.session.locale,e);this._setProperty("groupFormat",t),this.initialized&&this.table._group()}_formatValue(e,t){return this.format.format(e)}_parseValue(e){return w.ensure(e)}_getDefaultFormat(e){return this.hasDate&&this.hasTime?e.dateFormatPatternDefault+" "+e.timeFormatPatternDefault:this.hasDate?e.dateFormatPatternDefault:e.timeFormatPatternDefault}cellTextForGrouping(e){let t=this.table.cellValue(this,e);return this.groupFormat.format(t)}_createEditor(e){return u.create(kt,{parent:this.table,hasDate:this.hasDate,hasTime:this.hasTime})}}class Ra extends De{constructor(){super(),this.minWidth=De.NARROW_MIN_WIDTH,this.filterType="ColumnUserFilter",this.textBased=!1}_initCell(e){return super._initCell(e),e.text=null,e.iconId=e.value||e.iconId,e}_formatValue(e,t){return null}setCellValue(e,t){super.setCellValue(e,t),this.setCellIconId(e,this.cell(e).value)}cellTextForGrouping(e){return this.table.cell(this,e).value}createAggrGroupCell(e){let t=super.createAggrGroupCell(e);return t.text=null,t}}function Oi(i,e,t){return e=fE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function fE(i){var e=mE(i,"string");return typeof e=="symbol"?e:String(e)}function mE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Bi extends De{constructor(){super(),Oi(this,"aggregationFunction",void 0),Oi(this,"backgroundEffect",void 0),Oi(this,"decimalFormat",void 0),Oi(this,"minValue",void 0),Oi(this,"maxValue",void 0),Oi(this,"calcMinValue",void 0),Oi(this,"calcMaxValue",void 0),Oi(this,"allowedAggregationFunctions",void 0),Oi(this,"aggrStart",void 0),Oi(this,"aggrStep",void 0),Oi(this,"aggrFinish",void 0),Oi(this,"aggrSymbol",void 0),Oi(this,"backgroundEffectFunc",void 0),this.aggregationFunction="sum",this.backgroundEffect=null,this.decimalFormat=null,this.minValue=null,this.maxValue=null,this.calcMinValue=null,this.calcMaxValue=null,this.horizontalAlignment=1,this.filterType="NumberColumnUserFilter",this.comparator=mt.NUMERIC,this.textBased=!1,this.allowedAggregationFunctions=["sum","avg","min","max","none"]}_init(e){super._init(e),this._setDecimalFormat(this.decimalFormat),this._setAggregationFunction(this.aggregationFunction)}setDecimalFormat(e){this.setProperty("decimalFormat",e)}_setDecimalFormat(e){e||(e=this._getDefaultFormat(this.session.locale));let t=Ls.ensure(this.session.locale,e);this._setProperty("decimalFormat",t),this.initialized&&this.table.rows.forEach(s=>this._updateCellText(s,this.cell(s)))}_getDefaultFormat(e){return e.decimalFormatPatternDefault}_formatValue(e,t){return this.decimalFormat.format(e)}_parseValue(e){return Ke.ensure(e)}setAggregationFunction(e){this.setProperty("aggregationFunction",e)}_setAggregationFunction(e){if(this._setProperty("aggregationFunction",e),e==="sum")this.aggrStart=wt.sumStart,this.aggrStep=wt.sumStep,this.aggrFinish=wt.sumFinish,this.aggrSymbol=wt.sumSymbol;else if(e==="avg")this.aggrStart=wt.avgStart,this.aggrStep=wt.avgStep,this.aggrFinish=wt.avgFinish,this.aggrSymbol=wt.avgSymbol;else if(e==="min")this.aggrStart=wt.minStart,this.aggrStep=wt.minStep,this.aggrFinish=wt.minFinish,this.aggrSymbol=wt.minSymbol;else if(e==="max")this.aggrStart=wt.maxStart,this.aggrStep=wt.maxStep,this.aggrFinish=wt.maxFinish,this.aggrSymbol=wt.maxSymbol;else if(e==="none"){let t=()=>{};this.aggrStart=t,this.aggrStep=t,this.aggrFinish=t,this.aggrSymbol=void 0}}createAggrValueCell(e){let t=this._formatValue(e),s=Pt;return u.create(s,{text:t,iconId:t?this.aggrSymbol:null,horizontalAlignment:this.horizontalAlignment,cssClass:"table-aggregate-cell "+this.aggregationFunction,flowsLeft:this.horizontalAlignment>0})}_cellStyle(e,t,s){let r=super._cellStyle(e,t,s);if(!this.backgroundEffect||e.value===void 0||y.contains(e.cssClass,"table-aggregate-cell"))return r;this.backgroundEffectFunc||(this.backgroundEffectFunc=this._resolveBackgroundEffectFunc());let n=this.backgroundEffectFunc(this._preprocessValueOrTextForCalculation(e.value));return n.backgroundColor&&(r+="background-color: "+n.backgroundColor+";"),n.backgroundImage&&(r+="background-image: "+n.backgroundImage+";"),r}_preprocessValueOrTextForCalculation(e,t){return this.decimalFormat.round(e)}setBackgroundEffect(e){!this.setProperty("backgroundEffect",e)||(this.backgroundEffectFunc=this._resolveBackgroundEffectFunc(),this.table.trigger("columnBackgroundEffectChanged",{column:this}),this.backgroundEffect&&(this.calcMinValue===null||this.calcMaxValue===null)&&this.calculateMinMaxValues(),this.backgroundEffect||(this.calcMinValue=null,this.calcMaxValue=null),this.table.rendered&&this._renderBackgroundEffect())}updateBackgroundEffect(){this.calculateMinMaxValues(),this.table.rendered&&this._renderBackgroundEffect()}_resolveBackgroundEffectFunc(){let e=this.backgroundEffect;if(e==="colorGradient1")return this._colorGradient1.bind(this);if(e==="colorGradient2")return this._colorGradient2.bind(this);if(e==="barChart")return this._barChart.bind(this);if(e!==null)return a().log.warn("Unsupported backgroundEffect: "+e),()=>({})}_renderBackgroundEffect(){this.table.visibleRows.forEach(e=>{if(!e.$row)return;let t=this.cell(e),s=this.table.$cell(this,e.$row);t.value!==void 0&&(s[0].style.cssText=this._cellStyle(t))})}calculateMinMaxValues(){let e,t,s=this.table.rows;for(let r=0;r<s.length;r++){let n=s[r],o=this.cellValueOrTextForCalculation(n);(o<e||e===void 0)&&(e=o),(o>t||t===void 0)&&(t=o)}this.calcMinValue=u.nvl(e,null),this.calcMaxValue=u.nvl(t,null)}_colorGradient1(e){let t=M.get("column-background-effect-gradient1-start","backgroundColor"),s=M.get("column-background-effect-gradient1-end","backgroundColor"),r=M.rgb(t.backgroundColor),n=M.rgb(s.backgroundColor);return this._colorGradient(e,r,n)}_colorGradient2(e){let t=M.get("column-background-effect-gradient2-start","backgroundColor"),s=M.get("column-background-effect-gradient2-end","backgroundColor"),r=M.rgb(t.backgroundColor),n=M.rgb(s.backgroundColor);return this._colorGradient(e,r,n)}_colorGradient(e,t,s){let r=(e-this.calcMinValue)/(this.calcMaxValue-this.calcMinValue),n=Math.ceil(t.red-r*(t.red-s.red)),o=Math.ceil(t.green-r*(t.green-s.green)),l=Math.ceil(t.blue-r*(t.blue-s.blue));return{backgroundColor:"rgb("+n+","+o+", "+l+")"}}_barChart(e){let t=Math.ceil((e-this.calcMinValue)/(this.calcMaxValue-this.calcMinValue)*100)+"",s=M.get("column-background-effect-bar-chart","backgroundColor").backgroundColor;return{backgroundImage:"linear-gradient(to left, "+s+" 0%, "+s+" "+t+"%, transparent "+t+"%, transparent 100% )"}}_createEditor(e){return u.create(Pn,{parent:this.table,maxValue:this.maxValue,minValue:this.minValue,decimalFormat:this.decimalFormat})}_hasCellValue(e){return!b.isNullOrUndefined(e.value)}}function xr(i,e,t){return e=gE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function gE(i){var e=_E(i,"string");return typeof e=="symbol"?e:String(e)}function _E(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class mg extends De{constructor(){super(),xr(this,"codeType",void 0),xr(this,"lookupCall",void 0),xr(this,"browseHierarchy",void 0),xr(this,"browseMaxRowCount",void 0),xr(this,"browseAutoExpandAll",void 0),xr(this,"browseLoadIncremental",void 0),xr(this,"activeFilterEnabled",void 0),xr(this,"_lookupCallBatchContext",void 0),this.codeType=null,this.lookupCall=null,this.browseHierarchy=!1,this.browseMaxRowCount=le.DEFAULT_BROWSE_MAX_COUNT,this.browseAutoExpandAll=!0,this.browseLoadIncremental=!1,this.activeFilterEnabled=!1,this._lookupCallBatchContext=null}_init(e){super._init(e),this._setLookupCall(this.lookupCall),this._setCodeType(this.codeType)}_initCell(e){return super._initCell(e),e.sortCode=this._calculateCellSortCode(e),e}_calculateCellSortCode(e){if(!this.codeType)return null;let t=Tt.get(this.codeType,e.value);return t?t.sortCode:null}_updateAllCellSortCodes(){this.table.rows.map(e=>this.cell(e)).forEach(e=>e.setSortCode(this._calculateCellSortCode(e)))}setLookupCall(e){this.setProperty("lookupCall",e)}_setLookupCall(e){let t=Ut.ensure(e,this.session);this._setProperty("lookupCall",t),this.initialized&&this._updateAllCellSortCodes()}setCodeType(e){this.setProperty("codeType",e)}_setCodeType(e){if(this._setProperty("codeType",e),e){let t=Ul;this.lookupCall=u.create(t,{session:this.session,codeType:e})}this.initialized&&this._updateAllCellSortCodes()}setBrowseHierarchy(e){this.setProperty("browseHierarchy",e)}setBrowseMaxRowCount(e){this.setProperty("browseMaxRowCount",e)}setBrowseAutoExpandAll(e){this.setProperty("browseAutoExpandAll",e)}setBrowseLoadIncremental(e){this.setProperty("browseLoadIncremental",e)}setActiveFilterEnabled(e){this.setProperty("activeFilterEnabled",e)}_formatValue(e,t){if(!this.lookupCall)return u.nvl(e,"");if(this.lookupCall.batch)return this._batchFormatValue(e);let s=this.lookupCall.clone();return this.trigger("prepareLookupCall",{lookupCall:s,row:t}),s.textByKey(e)}_batchFormatValue(e){if(b.isNullOrUndefined(e))return $.resolvedPromise("");let t=this._lookupCallBatchContext;if(!t){const s=$.Deferred();t={keySet:new Set,result:s.promise()},this._lookupCallBatchContext=t,setTimeout(()=>{this._lookupCallBatchContext=null;let r=this.lookupCall.clone();this.trigger("prepareLookupCall",{lookupCall:r}),r.textsByKeys([...t.keySet]).then(n=>s.resolve(n)).catch(n=>s.reject(n))})}return t.keySet.add(e),t.result.then(s=>s[b.ensureValidKey(e)]||"")}_updateEditorFromValidCell(e,t){if(b.isNullOrUndefined(t.value)){e.setValue(null);return}let s=new Ys;s.key=t.value,s.text=t.text,e.setLookupRow(s)}_createEditor(e){let t=u.create(le,{parent:this.table,codeType:this.codeType,lookupCall:this.lookupCall?this.lookupCall.clone():null,browseHierarchy:this.browseHierarchy,browseMaxRowCount:this.browseMaxRowCount,browseAutoExpandAll:this.browseAutoExpandAll,browseLoadIncremental:this.browseLoadIncremental,activeFilterEnabled:this.activeFilterEnabled});return t.on("prepareLookupCall",s=>{this.trigger("prepareLookupCall",{lookupCall:s.lookupCall,row:e})}),t.on("lookupCallDone",s=>{this.trigger("lookupCallDone",{result:s.result})}),t}_updateCellFromValidEditor(e,t){this.setCellErrorStatus(e,null);let s=this.cell(e),r=s.text,n=t.displayText;s.setText(n),this._setCellValue(e,t.value,s),e.initialized&&r!==n&&s.text===n&&this.table.updateRow(e),this._updateCellText(e,s)}_hasCellValue(e){let t=e.value;return b.isNumber(t)?!b.isNullOrUndefined(t):!!t}_setCellValue(e,t,s){super._setCellValue(e,t,s),s.setSortCode(this._calculateCellSortCode(s))}}class Ou extends sn{constructor(e){super(e),this.renderingHints.offset=6}handle(e){this.field.toggle()}_postRenderKeyBox(e,t){if(this.field.iconId){let s=e.find(".icon").width(),r=e.find(".key-box").outerWidth(),n=e.cssPaddingLeft(),o=s/2-r/2+n;e.find(".key-box").cssLeft(o)}}}function cs(i,e,t){return e=yE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function yE(i){var e=bE(i,"string");return typeof e=="symbol"?e:String(e)}function bE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ps extends re{constructor(){super(),cs(this,"tableFooter",void 0),cs(this,"table",void 0),cs(this,"contentRendered",void 0),cs(this,"height",void 0),cs(this,"animateDuration",void 0),cs(this,"resizerVisible",void 0),cs(this,"denseClass",void 0),cs(this,"tableControlKeyStrokeContext",void 0),cs(this,"$contentContainer",void 0),this.tableFooter=null,this.contentRendered=!1,this.height=null,this.animateDuration=null,this.resizerVisible=!0,this.toggleAction=!0,this.showTooltipWhenSelected=!1}_init(e){this.parent=e.parent,this.table=this.getTable(),super._init(e),this.denseClass=this.session.desktop.dense?" dense":"",ps.CONTAINER_SIZE=M.getSize("table-control-container"+this.denseClass,"height","height",ps.CONTAINER_SIZE),this.height=ps.CONTAINER_SIZE,this.animateDuration=ps.CONTAINER_ANIMATE_DURATION,this._setSelected(this.selected)}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.tableControlKeyStrokeContext=this._createKeyStrokeContextForTableControl()}_createKeyStrokeContextForTableControl(){let e=new Oe;return e.$scopeTarget=()=>this.tableFooter.$controlContent,e.$bindTarget=()=>this.tableFooter.$controlContent,e.registerKeyStroke(new Uu(this)),e}_createLayout(){return new Yn}_render(){let e="table-control ";this.cssClass&&(e+=this.cssClass+"-table-control"),this.$container=this.$parent.appendDiv(e).on("mousedown",this._onMouseDown.bind(this)).data("control",this),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(this._createLayout())}remove(){this.removeContent(),super.remove()}_renderContent(e){}_removeContent(){}removeContent(){this.contentRendered&&(this._removeContent(),this.cssClass&&(this.tableFooter.$controlContainer.removeClass(this.cssClass+"-table-control-container"),this.tableFooter.$controlContent.removeClass(this.cssClass+"-table-control-content")),this.session.keyStrokeManager.uninstallKeyStrokeContext(this.tableControlKeyStrokeContext),this.contentRendered=!1)}renderContent(){!this.contentRendered&&!this.isContentAvailable()||!this.selected||(this.tableFooter.open||this.tableFooter.openControlContainer(this),this.contentRendered||(this.cssClass&&(this.tableFooter.$controlContainer.addClass(this.cssClass+"-table-control-container"),this.tableFooter.$controlContent.addClass(this.cssClass+"-table-control-content")),this.tableFooter.$controlContent.data("control",this),this._renderContent(this.tableFooter.$controlContent),this.session.keyStrokeManager.installKeyStrokeContext(this.tableControlKeyStrokeContext),this.htmlComp&&this.htmlComp.invalidateLayoutTree(!1),this.contentRendered=!0))}get$Scrollable(){return this.$contentContainer}_renderSelected(e,t){e=u.nvl(e,this.selected),t=$.extend({},{closeWhenUnselected:!0},t),this.$container.select(e),e?(this.tableFooter.onControlSelected(this),this.renderContent()):this.rendered&&(t.closeWhenUnselected&&this===this.tableFooter.selectedControl?(this.tableFooter.onControlSelected(null),this.tableFooter.closeControlContainer(this,t)):this.removeContent()),this._updateTooltip()}isContentAvailable(){return!0}toggle(){!this.enabledComputed||(this.tableFooter.selectedControl===this?this.setSelected(!1):this.setSelected(!0))}setSelected(e,t){e&&!this.visible||e!==this.selected&&(this.tableFooter&&this.tableFooter.selectedControl&&this.tableFooter.selectedControl!==this&&this.tableFooter.selectedControl.setSelected(!1,{closeWhenUnselected:!1}),this._setSelected(e),t=$.extend({},{closeWhenUnselected:!0},t),this.rendered?this._renderSelected(e,t):t.closeWhenUnselected&&this.tableFooter&&this===this.tableFooter.selectedControl&&!e&&this.tableFooter.onControlSelected(null))}_setSelected(e){this._setProperty("selected",e)}_configureTooltip(){let e=super._configureTooltip();return e.cssClass="table-control-tooltip",e}_onMouseDown(e){this.toggle()}onControlContainerOpened(){}onControlContainerClosed(){this.removeContent()}_createActionKeyStroke(){return new Ou(this)}getTable(){let e=this.parent;for(;e;){if(e instanceof V)return e;e=e.parent}return null}}cs(ps,"CONTAINER_SIZE",345),cs(ps,"CONTAINER_ANIMATE_DURATION",350);class Ma extends br{_goOffline(){this.widget.isContentAvailable()||(this._enabledBeforeOffline=this.widget.enabled,this.widget.setEnabled(!1))}_goOnline(){this.widget.isContentAvailable()||this.widget.setEnabled(this._enabledBeforeOffline)}}function Bu(i,e,t){return e=vE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function vE(i){var e=wE(i,"string");return typeof e=="symbol"?e:String(e)}function wE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class pn extends Hs{constructor(){super(),Bu(this,"tableControl",void 0),Bu(this,"_tableControlPropertyChangeHandler",void 0),Bu(this,"_tableControlDestroyHandler",void 0),this.tableControl=null,this._tableControlPropertyChangeHandler=this._onTableControlPropertyChange.bind(this),this._tableControlDestroyHandler=this._onTableControlDestroy.bind(this),this._addCloneProperties(["tableControl"])}_init(e){if(super._init(e),!this.tableControl)throw new Error("Cannot adapt to undefined tableControl");this._installListeners()}_destroy(){this._uninstallListeners(),super._destroy()}_installListeners(){this.tableControl.on("propertyChange",this._tableControlPropertyChangeHandler),this.tableControl.on("destroy",this._tableControlDestroyHandler)}_uninstallListeners(){this.tableControl.off("propertyChange",this._tableControlPropertyChangeHandler),this.tableControl.off("destroy",this._tableControlDestroyHandler)}_render(){super._render(),this.$container.attr("data-tableControlAdapter",this.tableControl.id)}_onTableControlPropertyChange(e){let t={};t[e.propertyName]=e.newValue,t=pn.adaptTableControlProperties(t);for(let s in t)this.setProperty(s,t[s])}_onTableControlDestroy(e){this.destroy(),this._uninstallListeners()}doAction(){return this.tableControl.doAction()}setSelected(e){this.tableControl.setSelected(e)}static adaptTableControlProperties(e,t){t=t||{},["text","iconId","enabled","visible","selected","tooltipText","keyStroke","keyStrokes","modelClass","classId","form"].forEach(s=>{t[s]=e[s]});for(let s in t)t[s]===void 0&&delete t[s];return t}}function Er(i,e,t){return e=TE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function TE(i){var e=CE(i,"string");return typeof e=="symbol"?e:String(e)}function CE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Vs extends ps{constructor(){super(),Er(this,"aggregateRow",void 0),Er(this,"_tableDataScrollHandler",void 0),Er(this,"_tableColumnResizedHandler",void 0),Er(this,"_tableColumnMovedHandler",void 0),Er(this,"_tableColumnStructureChangedHandler",void 0),Er(this,"_tableChangedHandler",void 0),Er(this,"_aggregationFunctionChangedHandler",void 0),this._tableDataScrollHandler=this._onTableDataScroll.bind(this),this._tableColumnResizedHandler=this._onTableColumnResized.bind(this),this._tableColumnMovedHandler=this._onTableColumnMoved.bind(this),this._tableColumnStructureChangedHandler=this._onTableColumnStructureChanged.bind(this),this._tableChangedHandler=this._onTableChanged.bind(this),this._aggregationFunctionChangedHandler=this._onAggregationFunctionChanged.bind(this),this.animateDuration=Vs.CONTAINER_ANIMATE_DURATION,this.aggregateRow=[],this.cssClass="aggregate",this.height=0,this.iconId=ye.SUM,this.tooltipText="${textKey:ui.Total}",this.resizerVisible=!1}_init(e){super._init(e),this.table.on("columnStructureChanged",this._tableColumnStructureChangedHandler),this.table.on("aggregationFunctionChanged",this._aggregationFunctionChangedHandler)}_destroy(){super._destroy(),this.table.off("columnStructureChanged",this._tableColumnStructureChangedHandler),this.table.off("aggregationFunctionChanged",this._aggregationFunctionChangedHandler)}_render(){super._render(),this._updateEnabledAndSelectedState(),this.height=this.table.rowHeight+v.insets(this.table.footer.$controlContainer).vertical()}_renderContent(e){this.$contentContainer=e.appendDiv("table-aggregate"),this._aggregate(),this._renderAggregate(),this._reconcileScrollPos(),this.table.$data.on("scroll",this._tableDataScrollHandler),this.table.on("columnResized",this._tableColumnResizedHandler),this.table.on("columnMoved",this._tableColumnMovedHandler),this.table.on("rowsSelected rowsInserted rowsUpdated rowsDeleted filter group allRowsDeleted",this._tableChangedHandler)}_removeContent(){this.$contentContainer.remove(),this.table.$data.off("scroll",this._tableDataScrollHandler),this.table.off("columnResized",this._tableColumnResizedHandler),this.table.off("columnMoved",this._tableColumnMovedHandler),this.table.off("rowsSelected rowsInserted rowsUpdated rowsDeleted filter group allRowsDeleted",this._tableChangedHandler)}_renderAggregate(){let e=[];this.table.visibleColumns().forEach((t,s)=>{let r,n,o;r=this.aggregateRow[s];let l=r==null||t.grouped;l?n=t.createAggrEmptyCell():n=t.createAggrValueCell(r),o=a()(t.buildCell(n,{})),l||e.push(o),this._installCellTooltip(o),this.aggregateRow.selection&&o.addClass("selection"),o.appendTo(this.$contentContainer)}),this.aggregateRow.selection&&this.$contentContainer.addClass("selection"),e.forEach(t=>this.table._resizeAggregateCell(t))}_rerenderAggregate(){this.$contentContainer.empty(),this._renderAggregate(),this._reconcileScrollPos()}_installCellTooltip(e){K.install(e,{parent:this,text:this.table._cellTooltipText.bind(this.table),htmlEnabled:!0,arrowPosition:50,arrowPositionUnit:"%",nativeTooltip:!x.get().isCustomEllipsisTooltipPossible()})}_aggregate(){let e,t=[],s=this.table.selectedRows;s.length>1?(e=s,t.selection=!0):e=this.table.filteredRows(),this.table._forEachVisibleColumn("aggrStart",t),e.forEach(r=>this.table._forEachVisibleColumn("aggrStep",t,r)),this.table._forEachVisibleColumn("aggrFinish",t),this.aggregateRow=t,this.contentRendered&&this.selected&&this._rerenderAggregate()}_reconcileScrollPos(){let e=this.table.$data.scrollLeft();this.$contentContainer.scrollLeft(e)}_updateEnabledAndSelectedState(e){if(!this.initialized)return;let t=this.table.containsAggregatedNumberColumn();t?e&&!this.table.isGrouped()&&this.setSelected(!0):this.selected&&this.setSelected(!1),this.setEnabled(t)}_setEnabled(e){super._setEnabled(e),this._updateEnabledAndSelectedState()}_setSelected(e){this._setProperty("selected",e),this._updateEnabledAndSelectedState()}_onTableDataScroll(){this._reconcileScrollPos()}_onTableChanged(){this._aggregate()}_onAggregationFunctionChanged(){this._updateEnabledAndSelectedState(!0),this.contentRendered&&this.selected&&this._aggregate()}_onTableColumnResized(){this._rerenderAggregate()}_onTableColumnMoved(e){p.move(this.aggregateRow,e.oldPos,e.newPos),this._rerenderAggregate()}_onTableColumnStructureChanged(){this._updateEnabledAndSelectedState(),this.contentRendered&&this.selected&&this._aggregate()}}Er(Vs,"CONTAINER_ANIMATE_DURATION",200);class ku extends Ma{static modifyAggregateTableControlPrototype(){!te.get().remote||b.replacePrototypeFunction(Vs,"_onTableColumnStructureChanged",function(e){this.modelAdapter?this._updateEnabledAndSelectedState():this._onTableColumnStructureChangedOrig()},!0)}}te.addListener("bootstrap",ku.modifyAggregateTableControlPrototype);function gg(i,e,t){return e=SE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function SE(i){var e=PE(i,"string");return typeof e=="symbol"?e:String(e)}function PE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class _g extends ps{constructor(){super(),gg(this,"form",void 0),gg(this,"_formDestroyedHandler",void 0),this._addWidgetProperties("form"),this._formDestroyedHandler=this._onFormDestroyed.bind(this)}_init(e){super._init(e),this._setForm(this.form)}_createLayout(){return new Hu(this)}_renderContent(e){this.form.renderInitialFocusEnabled=!1,this.form.render(e);let t=this.form.rootGroupBox;t.controls[0]instanceof yo&&t.controls[0].$container.addClass("in-table-control"),this.form.$container.height(e.height()),this.form.$container.width(e.width()),this.form.htmlComp.validateRoot=!0,this.form.htmlComp.validateLayout()}_removeContent(){this.form&&this.form.remove()}_removeForm(){this.removeContent()}_renderForm(e){this.renderContent()}isContentAvailable(){return!!this.form}setForm(e){this.setProperty("form",e)}_setForm(e){this.form&&this.form.off("destroy",this._formDestroyedHandler),e&&(e.on("destroy",this._formDestroyedHandler),this._adaptForm(e)),this._setProperty("form",e)}_adaptForm(e){e.rootGroupBox.setMenuBarPosition(xe.MenuBarPosition.BOTTOM),e.setDisplayHint(U.DisplayHint.VIEW),e.setModal(!1),e.setAskIfNeedSave(!1),e.setClosable(!1)}onControlContainerOpened(){!this.form||!this.form.rendered||this.form.renderInitialFocus()}_onFormDestroyed(e){this._removeForm(),this._setForm(null)}}class yg extends Ma{}function xE(i,e,t){return e=EE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function EE(i){var e=FE(i,"string");return typeof e=="symbol"?e:String(e)}function FE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Hu extends ee{constructor(e){super(),xE(this,"control",void 0),this.control=e}layout(e){if(!this.control.contentRendered||!this.control.form)return;let t=this.control.form,s=t.htmlComp,r=v.size(this.control.tableFooter.$controlContent),n=r.subtract(s.margins());if(s.setSize(n),t.rootGroupBox.controls[0]instanceof yo){let l=t.rootGroupBox.controls[0].selectedTab,h=document.activeElement;l&&l.scrollable&&h&&l.$body.has(h)&&P.scrollTo(l.$body,a()(h))}}}function fn(i,e,t){return e=DE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function DE(i){var e=AE(i,"string");return typeof e=="symbol"?e:String(e)}function AE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Nu extends ue{constructor(){super(),fn(this,"table",void 0),fn(this,"column",void 0),fn(this,"row",void 0),fn(this,"cell",void 0),fn(this,"_rowOrderChangedFunc",void 0),fn(this,"_pendingCompleteCellEdit",void 0),fn(this,"_keyStrokeHandler",void 0),this.table=null,this.column=null,this.row=null,this.cell=null,this._pendingCompleteCellEdit=null,this._keyStrokeHandler=this._onKeyStroke.bind(this)}_init(e){e.scrollType=e.scrollType||"position",super._init(e),this.table=e.column.table,this.link(this.cell.field)}_createLayout(){return new Wu(this)}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.registerKeyStrokes([new Ku(this),new Gu(this)])}_createCloseKeyStroke(){return new zu(this)}_open(e){this.render(e),this.position(),this.pack()}_getDefaultOpen$Parent(){return this.table.$data}_render(){super._render();let e="",t=this.table.visibleColumns(),s=t.indexOf(this.column);s===0?e="first":s===t.length-1&&(e="last"),this.$container.addClass("cell-editor-popup "+e).data("popup",this);let r=this.cell.field;r.mode=A.Mode.CELLEDITOR,r.render(),r.prepareForCellEdit({cssClass:e}),this.$anchor.css("visibility","hidden"),this._rowOrderChangedFunc=n=>{n.animating?n.row===this.row&&this.position():this.position()},this.table.on("rowOrderChanged",this._rowOrderChangedFunc),this.table.enabled&&this.table.$container.addClass("focused"),this.session.keyStrokeManager.on("keyStroke",this._keyStrokeHandler)}_alignWithSelection(){let e=this._rowSelectionBounds().y;e<0&&(this.$container.cssMarginTop(e),this.$container.addClass("overflow-top"))}_rowSelectionBounds(){let e=new ie,t=getComputedStyle(this.row.$row[0],":after");return t&&(e=new ie(a().pxToNumber(t.left),a().pxToNumber(t.top),a().pxToNumber(t.width),a().pxToNumber(t.height))),e}_postRender(){super._postRender();let e=this.cell.field;e.onCellEditorRendered&&e.onCellEditorRendered({openFieldPopup:this.table.openFieldPopupOnCellEdit,cellEditorPopup:this})}_remove(){super._remove(),this.session.keyStrokeManager.off("keyStroke",this._keyStrokeHandler),this.table.off("rowOrderChanged",this._rowOrderChangedFunc),this.table.rendered&&this.table.$container.removeClass("focused"),this.$anchor.css("visibility","")}position(e){let t=this.table.$data,s=this.row.$row,r=this.$anchor,n=t.cssPaddingLeft()+s.cssMarginLeft()+s.cssBorderLeftWidth();this._alignWithSelection();let o=v.bounds(r),l=v.bounds(s);this.setLocation(new X(n+o.x,t.scrollTop()+l.y))}completeEdit(e){if(this._pendingCompleteCellEdit)return this._pendingCompleteCellEdit;let s=this.cell.field.acceptInput();return!s||!u.nvl(e,!0)?(this._pendingCompleteCellEdit=a().resolvedPromise(),this.table.completeCellEdit()):this._pendingCompleteCellEdit=s.then(()=>this.table.completeCellEdit()),this._pendingCompleteCellEdit.then(()=>{this._pendingCompleteCellEdit=a().resolvedPromise()}),this._pendingCompleteCellEdit}isCompleteCellEditRequested(){return!!this._pendingCompleteCellEdit}cancelEdit(){this.table.cancelCellEdit(),this.remove()}_onMouseDownOutside(e){let t=a()(e.target).closest(".table-row",this.table.$container[0]);this.completeEdit(),t.length>0&&!t.isAttached()&&this._propagateMouseDownToTableRow(e)}_propagateMouseDownToTableRow(e){let s=this.table.$container.document(!0).elementFromPoint(e.pageX,e.pageY),r=a()(s);r.closest(".table-row",this.table.$container[0]).length!==0&&ot.propagateEvent(r[0],e)}_onKeyStroke(e){!this._invokeCompleteEditBeforeKeyStroke(e)||this.completeEdit(!1)}_invokeCompleteEditBeforeKeyStroke(e){return!(!this.session.keyStrokeManager.invokeAcceptInputOnActiveValueField(e.keyStroke,e.keyStrokeContext)||this.$container.isOrHas(e.keyStrokeContext.$getScopeTarget()))}waitForCompleteCellEdit(){return this._pendingCompleteCellEdit?this._pendingCompleteCellEdit.promise():a().resolvedPromise()}}function Vu(i,e,t){return e=$E(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function $E(i){var e=RE(i,"string");return typeof e=="symbol"?e:String(e)}function RE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Wu extends ee{constructor(e){super(),Vu(this,"cellEditorPopup",void 0),Vu(this,"_field",void 0),Vu(this,"_htmlContainer",void 0),this.cellEditorPopup=e,this._field=e.cell.field,this._htmlContainer=e.htmlComp}layout(e){let t=this._field.htmlComp,s=this._htmlContainer.availableSize({exact:!0}).subtract(this._htmlContainer.insets()).subtract(t.margins());t.setSize(s)}preferredLayoutSize(e,t){let s=this.cellEditorPopup.row.$row,r=this.cellEditorPopup.$anchor,n=v.bounds(r,{exact:!0}),o=v.bounds(s,{exact:!0}),l=this.cellEditorPopup.$container.cssMarginLeft();l<0&&(n.width=n.width+-l);let h=this.cellEditorPopup._rowSelectionBounds().height;return h&&(this._htmlContainer.$comp.toggleClass("overflow-bottom",h>o.height&&this._htmlContainer.$comp.cssMarginTop()===0),o.height=h),new F(n.width,o.height)}}class zu extends O{constructor(e){super(),this.field=e,this.which=[g.ESC],this.stopPropagation=!0}handle(e){this.field.cancelEdit()}}class Ku extends O{constructor(e){super(),this.field=e,this.which=[g.ENTER],this.stopPropagation=!0}handle(e){this.field.completeEdit()}}class Gu extends O{constructor(e){super(),this.field=e,this.which=[g.TAB],this.shift=void 0}_accept(e){return super._accept(e)&&!this.field.isCompleteCellEditRequested()}handle(e){let t=e.shiftKey,s=this.field.table,r=this.field.column,n=this.field.row;this.field.completeEdit().then(()=>{let o=s.nextEditableCellPos(r,n,t);o&&s.prepareCellEdit(o.column,o.row)})}}class Ws extends O{constructor(e){super(),this.repeatable=!0,this.field=e,this.shift=e.multiSelect?void 0:!1,this.stopPropagation=!0,this.keyStrokeMode=O.Mode.DOWN,this.inheritAccessibility=!1}_accept(e){if(!super._accept(e))return!1;if(!this.field.visibleRows.length)return this._applyPropagationFlags(e),!1;let s=this.field.$container.activeElement(),r=s[0].tagName.toLowerCase(),n=this.field.$container.data("filter-field");return(!n||s[0]!==n[0])&&(r==="textarea"||r==="input")&&(!e.originalEvent||e.originalEvent&&!e.originalEvent.smartFieldEvent)?!1:(this.field.$container.addClass("keyboard-navigation"),!0)}_viewportInfo(){let e=this.field,t={},s=e.visibleRows;if(s.length===0)return t;let r=v.offsetBounds(e.$data),n=v.insets(e.$data),o=e.$data.cssMarginTop();r=r.subtract(n),o<0&&(r.y-=Math.abs(o),r.height+=Math.abs(o));let l=this._findFirstRowInViewport(e,r),h=this._findLastRowInViewport(e,s.indexOf(l),r);return t.firstRow=l,t.lastRow=h,t}firstRowAfterSelection(){let e=this.field.$selectedRows();if(!e.length)return;let t=this.field.visibleRows,s=e.last().data("row"),r=this.field.filteredRows().indexOf(s);return t[r+1]}firstRowBeforeSelection(){let e=this.field.$selectedRows();if(!e.length)return;let t=this.field.visibleRows,s=e.first().data("row"),r=this.field.visibleRows.indexOf(s);return t[r-1]}_findLastSelectedRowBefore(e,t){let s=e.visibleRows;if(t===0)return s[t];let r=p.findFromReverse(s,t,(n,o)=>{let l=s[o-1];return l?!e.isRowSelected(l):!1});return r||(r=s[0]),r}_findLastSelectedRowAfter(e,t){let s=e.visibleRows;if(t===s.length-1)return s[t];let r=p.findFrom(s,t,(n,o)=>{let l=s[o+1];return l?!e.isRowSelected(l):!1});return r||(r=s[s.length-1]),r}_findFirstRowInViewport(e,t){let s=e.visibleRows;return p.find(s,(r,n)=>{let o=r.$row;if(!o)return!1;let l=o.offset(),h=r.$row.cssMarginTop();return h<0&&(l.top+=Math.abs(h)),t.contains(l.left,l.top)})}_findLastRowInViewport(e,t,s){let r=e.visibleRows;return t===r.length-1?r[t]:p.findFromForward(r,t,(n,o)=>{let l=r[o+1];if(!l)return!0;let h=l.$row;if(!h)return!0;let d=v.offsetBounds(h);return!s.contains(d.x,d.y+d.height-1)})}_isEnabled(){return!this.field.tileMode&&super._isEnabled()}}class Uu extends O{constructor(e){super(),this.field=e,this.which=[g.ESC],this.stopPropagation=!0,this.renderingHints.render=!1}handle(e){this.field.toggle()}}class qu extends O{constructor(e){super(),this.field=e,this.which=[g.C],this.ctrl=!0,this.renderingHints.render=!1,this.inheritAccessibility=!1}handle(e){this.field.exportToClipboard()}}class Yu extends Ws{constructor(e){super(e),this.which=[g.SUBTRACT,g.LEFT],this.renderingHints.text="-",this.renderingHints.$drawingArea=(t,s)=>{let r=this.field.selectedRows[0];if(r)return r.$row}}_accept(e){if(!super._accept(e))return!1;let s=this.field.selectedRows[0];return s?s.expanded&&s.expandable?!0:!!s.parentRow:!1}handle(e){let t=this.field.selectedRows[0];if(!t)return;let s=this.field,r=!1;t.expanded&&t.expandable?(s.collapseRow(t),r=!0):t.parentRow&&(s.selectRow(t.parentRow),s.selectionHandler.lastActionRow=t.parentRow,r=!0),r&&!s.isFocused()&&s.focus()}}class ju extends Ws{constructor(e){super(e),this.which=[g.ADD,g.RIGHT],this.renderingHints.text="+",this.renderingHints.$drawingArea=(t,s)=>{let r=this.field.selectedRows[0];if(r)return r.$row}}_accept(e){if(!super._accept(e))return!1;let s=this.field.selectedRows[0];return s?s.expandable:!1}handle(e){let t=this.field,s=t.selectedRows[0];if(!!s&&s.expandable){if(s.expanded){let r=t.visibleChildRows(s);t.selectRow(r[0]),t.selectionHandler.lastActionRow=r[0]}else t.expandRow(s);t.isFocused()||t.focus()}}}class Xu extends O{constructor(e){super(),this.field=e,this.ctrl=!0,this.which=[g.A],this.renderingHints.offset=14,this.renderingHints.$drawingArea=(t,s)=>this.field.footer?this.field.footer._$infoSelection.find(".table-info-button"):null,this.inheritAccessibility=!1}handle(e){let t=this.field;t.toggleSelection(),t.selectionHandler.lastActionRow=null}}class Ju extends O{constructor(e){super(),this.field=e,this.ctrl=!0,this.which=[g.ENTER],this.stopPropagation=!0,this.renderingHints.$drawingArea=(t,s)=>{let r=s._editPosition,n=this.field.visibleColumns().indexOf(r.column);return n===0?r.row.$row:this.field.$cell(n,r.row.$row)}}_accept(e){if(!super._accept(e)||this.field.cellEditorPopup)return!1;let s=this.field.selectedRows;if(!s.length)return!1;let r=this.field.nextEditableCellPosForRow(0,s[0]);return r?(e._editPosition=r,!0):!1}handle(e){let t=e._editPosition;this.field.prepareCellEdit(t.column,t.row,!0)}}class Qu extends O{constructor(e){super(),this.field=e,this.which=[g.F5],this.renderingHints.offset=14,this.renderingHints.$drawingArea=(t,s)=>this.field.footer?this.field.footer._$infoLoad.find(".table-info-button"):null}_accept(e){return super._accept(e)&&this.field.hasReloadHandler}handle(e){this.field.reload()}}class Zu extends O{constructor(e){super(),this.field=e,this.which=[g.SPACE],this.stopPropagation=!0,this.renderingHints.render=!1}_accept(e){return super._accept(e)&&this.field.checkable&&this.field.selectedRows.length>0}handle(e){let t=this.field.selectedRows.filter(r=>r.enabled),s=t.some(r=>!r.checked);t.forEach(r=>this.field.checkRow(r,s))}}class ec extends Ws{constructor(e){super(e),this.which=[g.UP],this.renderingHints.text="",this.renderingHints.$drawingArea=(t,s)=>{let r=this.firstRowBeforeSelection();if(r)return r.$row}}handle(e){let t=this.field,s=t.visibleRows,r=t.selectedRows,n=t.selectionHandler.lastActionRow,o=-1,l=-1,h,d;if(n&&(o=s.indexOf(n)),s.length>1&&(r.length>0||o>-1)){if(o<0&&(s.length===r.length?n=p.last(s):n=p.first(r),o=s.indexOf(n)),o===0)return;if(l=o-1,d=s[l],h=[d],e.shiftKey)if(t.isRowSelected(d)){h=[],p.pushAll(h,r);let c=t.selectionHandler.getMinMaxSelectionIndizes();u.isOneOf(o,c[0],c[1])&&p.remove(h,n)}else h=p.union(h,r),d=this._findLastSelectedRowBefore(t,l)}else h=[p.last(s)],d=h[0];t.selectionHandler.lastActionRow=d,t.selectRows(h,!0),t.scrollTo(d),t.isFocused()||t.focus()}}class tc extends Ws{constructor(e){super(e),this.which=[g.DOWN],this.renderingHints.text="",this.renderingHints.$drawingArea=(t,s)=>{let r=this.firstRowAfterSelection();if(r)return r.$row}}handle(e){let t=this.field,s=t.visibleRows,r=t.selectedRows,n=t.selectionHandler.lastActionRow,o=-1,l=-1,h,d;if(n&&(o=s.indexOf(n)),s.length>1&&(r.length>0||o>-1)){if(o<0&&(s.length===r.length?n=p.first(s):n=p.last(r),o=s.indexOf(n)),o===s.length-1)return;if(l=o+1,h=s[l],d=[h],e.shiftKey)if(t.isRowSelected(h)){d=[],p.pushAll(d,r);let c=t.selectionHandler.getMinMaxSelectionIndizes();u.isOneOf(o,c[0],c[1])&&p.remove(d,n)}else d=p.union(r,d),h=this._findLastSelectedRowAfter(t,l)}else d=[p.first(s)],h=d[0];t.selectionHandler.lastActionRow=h,t.selectRows(d,!0),t.scrollTo(h),t.isFocused()||t.focus()}}class ic extends Ws{constructor(e){super(e),this.which=[g.HOME],this.renderingHints.text="Home",this.renderingHints.$drawingArea=(t,s)=>{let r=this._viewportInfo();if(r.firstRow)return r.firstRow.$row}}handle(e){let t=this.field,s=t.visibleRows,r=p.first(s),n=t.selectedRows,o=[],l=t.selectionHandler.lastActionRow,h=-1;e.shiftKey&&n.length>0?(l&&(h=s.indexOf(l)),h<0&&(l=p.first(n),h=s.indexOf(l)),o=s.slice(0,h),o=p.union(o,n)):o=[r],t.selectionHandler.lastActionRow=r,t.selectRows(o),t.scrollTo(r),t.isFocused()||t.focus()}}class sc extends Ws{constructor(e){super(e),this.which=[g.END],this.renderingHints.text="End",this.renderingHints.$drawingArea=(t,s)=>{let r=this._viewportInfo();if(r.lastRow)return r.lastRow.$row}}handle(e){let t=this.field,s=t.visibleRows,r=p.last(s),n=t.selectedRows,o=[],l=t.selectionHandler.lastActionRow,h=-1;e.shiftKey&&n.length>0?(l&&(h=s.indexOf(l)),h<0&&(l=p.last(n),h=s.indexOf(l)),o=s.slice(h+1,s.length),o=p.union(n,o)):o=[r],t.selectionHandler.lastActionRow=r,t.selectRows(o),t.scrollTo(r),t.isFocused()||t.focus()}}class rc extends Ws{constructor(e){super(e),this.which=[g.PAGE_UP],this.renderingHints.text="PgUp",this.renderingHints.$drawingArea=(t,s)=>{let r=this._viewportInfo();if(r.firstRow)return r.firstRow.$row}}handle(e){let t=this.field,s=this._viewportInfo(),r=t.visibleRows,n=t.selectedRows,o=p.first(n),l=t.selectionHandler.lastActionRow,h=-1,d;!s.firstRow&&(t.scrollPageUp(),s=this._viewportInfo(),!s.firstRow)||(l&&(h=r.indexOf(l)),h<0&&(l=o,h=r.indexOf(l)),!(n.length>0&&l===s.firstRow&&!(n.length>1&&!e.shiftKey)&&(t.scrollPageUp(),s=this._viewportInfo(),!s.firstRow))&&(e.shiftKey&&n.length>0?(d=r.slice(r.indexOf(s.firstRow),h),d=p.union(n,d)):d=[s.firstRow],t.selectionHandler.lastActionRow=s.firstRow,t.selectRows(d,!0),t.isFocused()||t.focus()))}}class nc extends Ws{constructor(e){super(e),this.which=[g.PAGE_DOWN],this.renderingHints.text="PgDn",this.renderingHints.$drawingArea=(t,s)=>{let r=this._viewportInfo();if(r.lastRow)return r.lastRow.$row}}handle(e){let t=this.field,s=this._viewportInfo(),r=t.visibleRows,n=t.selectedRows,o=p.last(n),l=t.selectionHandler.lastActionRow,h=-1,d;!s.lastRow&&(t.scrollPageDown(),s=this._viewportInfo(),!s.lastRow)||(l&&(h=r.indexOf(l)),h<0&&(l=o,h=r.indexOf(l)),!(n.length>0&&l===s.lastRow&&!(n.length>1&&!e.shiftKey)&&(t.scrollPageDown(),s=this._viewportInfo(),!s.lastRow))&&(e.shiftKey&&n.length>0?(d=r.slice(h+1,r.indexOf(s.lastRow)+1),d=p.union(n,d)):d=[s.lastRow],t.selectionHandler.lastActionRow=s.lastRow,t.selectRows(d,!0),t.isFocused()||t.focus()))}}function Ia(i,e,t){return e=ME(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ME(i){var e=IE(i,"string");return typeof e=="symbol"?e:String(e)}function IE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Qt extends ts{constructor(){super(),Ia(this,"objectType",void 0),Ia(this,"session",void 0),Ia(this,"table",void 0),Ia(this,"filterType",void 0),this.session=null}init(e){if(this.session=e.session,!this.session)throw new Error("Session expected: "+this);this._init(e)}_init(e){a().extend(this,e)}createFilterAddedEventData(){return{filterType:this.filterType}}createFilterRemovedEventData(){return{filterType:this.filterType}}createKey(){return this.filterType}equals(e){return e instanceof Qt?b.equals(this.createKey(),e.createKey()):!1}}function mn(i,e,t){return e=LE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function LE(i){var e=OE(i,"string");return typeof e=="symbol"?e:String(e)}function OE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ji extends Qt{constructor(){super(),mn(this,"column",void 0),mn(this,"hasFilterFields",void 0),mn(this,"availableValues",void 0),mn(this,"selectedValues",void 0),mn(this,"matrix",void 0),mn(this,"xAxis",void 0),this.filterType=Ji.TYPE,this.hasFilterFields=!1,this.availableValues=[],this.selectedValues=[]}axisGroup(){return Et.NumberGroup.COUNT}calculate(){let e,t;this.matrix=new Et(this.table,this.session),this.matrix.addData(this.column,Et.NumberGroup.COUNT),this.xAxis=this.matrix.addAxis(this.column,this.axisGroup());let s=this.matrix.calculate();this.selectedValues.forEach(r=>{e=!1,this.xAxis.some(n=>this.xAxis.keyToDeterministicKey(n)===r?(e=!0,!0):!1),e||(this.xAxis.push(this.xAxis.deterministicKeyToKey(r)),t=!0)}),t&&this.xAxis.reorder(),this.availableValues=[],this.xAxis.forEach(r=>{let n=this.xAxis.keyToDeterministicKey(r),o=this.xAxis.format(r),l=null;r!==null&&this.xAxis.textIsIcon&&(l=o,o=null);let h=s.getValue([r]);this.availableValues.push({key:n,text:o,iconId:l,htmlEnabled:!1,cssClass:null,count:h?h[0]:0})})}createFilterAddedEventData(){let e=super.createFilterAddedEventData();return e.columnId=this.column.id,e.selectedValues=this.selectedValues,e}createFilterRemovedEventData(){let e=super.createFilterRemovedEventData();return e.columnId=this.column.id,e}createLabel(){return this.column.headerHtmlEnabled?y.plainText(this.column.text).replace(/\n/g," "):this.column.text||""}createKey(){return this.column.id}accept(e){this.xAxis||this.calculate();let t=!0,s=!0,r=this.column.cellValueOrTextForCalculation(e),n=this.xAxis.normDeterministic(r);return this.tableFilterActive()&&(t=this.selectedValues.indexOf(n)>-1),this.fieldsFilterActive()&&(s=this.acceptByFields(r,n,e)),t&&s}filterActive(){return this.tableFilterActive()||this.fieldsFilterActive()}tableFilterActive(){return this.selectedValues.length>0}triggerFilterFieldsChanged(){this.trigger("filterFieldsChanged")}acceptByFields(e,t,s){return!0}fieldsFilterActive(){return!1}addFilterFields(e){}modifyFilterFields(){}filterFieldsTitle(){return null}createComparator(){return mt.NUMERIC}}mn(Ji,"TYPE","column");function La(i,e,t){return e=BE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function BE(i){var e=kE(i,"string");return typeof e=="symbol"?e:String(e)}function kE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class bg extends Ji{constructor(){super(),La(this,"dateFrom",void 0),La(this,"dateTo",void 0),La(this,"dateFromField",void 0),La(this,"dateToField",void 0),this.dateFrom=null,this.dateFromField=null,this.dateTo=null,this.dateToField=null,this.hasFilterFields=!0}_init(e){super._init(e),this.dateFrom=w.parseJsonDate(e.dateFrom),this.dateTo=w.parseJsonDate(e.dateTo)}axisGroup(){return this.column.hasDate?Et.DateGroup.YEAR:Et.DateGroup.NONE}createFilterAddedEventData(){let e=super.createFilterAddedEventData();return e.dateFrom=w.toJsonDate(this.dateFrom),e.dateTo=w.toJsonDate(this.dateTo),e}fieldsFilterActive(){return!!this.dateFrom||!!this.dateTo}acceptByFields(e,t,s){if(!e)return!1;let r=e.valueOf(),n=this.dateFrom?this.dateFrom.valueOf():null,o=this.dateTo?w.shift(this.dateTo,0,0,1).valueOf()-1:null;if(n&&o)return r>=n&&r<=o;if(n)return r>=n;if(o)return r<=o;throw new Error("illegal state")}filterFieldsTitle(){return this.session.text("ui.DateRange")}addFilterFields(e){this.dateFromField=e.addFilterField(kt,"ui.from"),this.dateFromField.setValue(this.dateFrom),this.dateFromField.on("propertyChange",this._onPropertyChange.bind(this)),this.dateToField=e.addFilterField(kt,"ui.to"),this.dateToField.setValue(this.dateTo),this.dateToField.on("propertyChange",this._onPropertyChange.bind(this))}_onPropertyChange(e){e.propertyName==="value"&&(this.dateFrom=this.dateFromField.value,this.dateTo=this.dateToField.value,a().log.isDebugEnabled()&&a().log.debug("(DateColumnUserFilter#_onAcceptInput) dateFrom="+this.dateFrom+" dateTo="+this.dateTo),this.triggerFilterFieldsChanged())}modifyFilterFields(){this.dateFromField.$field.on("input","",a().debounce(this._onInput.bind(this))),this.dateToField.$field.on("input","",a().debounce(this._onInput.bind(this)))}_onInput(e){!this.dateFromField.rendered||(this.dateFrom=this.dateFromField.value,this.dateTo=this.dateToField.value,this.triggerFilterFieldsChanged())}}function Oa(i,e,t){return e=HE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function HE(i){var e=NE(i,"string");return typeof e=="symbol"?e:String(e)}function NE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class vg extends Ji{constructor(){super(),Oa(this,"numberFrom",void 0),Oa(this,"numberTo",void 0),Oa(this,"numberFromField",void 0),Oa(this,"numberToField",void 0),this.numberFrom=null,this.numberFromField=null,this.numberTo=null,this.numberToField=null,this.hasFilterFields=!0}createFilterAddedEventData(){let e=super.createFilterAddedEventData();return e.numberFrom=this.numberFrom,e.numberTo=this.numberTo,e}fieldsFilterActive(){return b.isNumber(this.numberFrom)||b.isNumber(this.numberTo)}acceptByFields(e,t,s){let r=b.isNumber(this.numberFrom),n=b.isNumber(this.numberTo);if(r&&n)return t>=this.numberFrom&&t<=this.numberTo;if(r)return t>=this.numberFrom;if(n)return t<=this.numberTo}filterFieldsTitle(){return this.session.text("ui.NumberRange")}addFilterFields(e){this.numberFromField=e.addFilterField(Pn,"ui.from"),this.numberFromField.decimalFormat=this.column.decimalFormat,this.numberFromField.setValue(this.numberFrom),this.numberFromField.on("propertyChange",this._onPropertyChange.bind(this)),this.numberToField=e.addFilterField(Pn,"ui.to"),this.numberToField.decimalFormat=this.column.decimalFormat,this.numberToField.setValue(this.numberTo),this.numberToField.on("propertyChange",this._onPropertyChange.bind(this))}_onPropertyChange(e){e.propertyName==="value"&&(this.numberFrom=this.numberFromField.value,this.numberTo=this.numberToField.value,a().log.isDebugEnabled()&&a().log.debug("(NumberColumnUserFilter#_onPropertyChange) numberFrom="+this.numberFrom+" numberTo="+this.numberTo),this.triggerFilterFieldsChanged())}}function wg(i,e,t){return e=VE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function VE(i){var e=WE(i,"string");return typeof e=="symbol"?e:String(e)}function WE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Tg extends Ji{constructor(){super(),wg(this,"freeText",void 0),wg(this,"freeTextField",void 0),this.freeText=null,this.freeTextField=null,this.hasFilterFields=!0}createFilterAddedEventData(){let e=super.createFilterAddedEventData();return e.freeText=this.freeText,e}fieldsFilterActive(){return y.hasText(this.freeText)}acceptByFields(e,t,s){let r=y.nvl(this.freeText).toLowerCase();return y.nvl(this.column.cellTextForTextFilter(s)).toLowerCase().indexOf(r)>-1}filterFieldsTitle(){return this.session.text("ui.FreeText")}addFilterFields(e){this.freeTextField=u.create(ki,{parent:e,labelVisible:!1,statusVisible:!1,maxLength:100,displayText:this.freeText,updateDisplayTextOnModify:!0}),this.freeTextField.on("acceptInput",this._onAcceptInput.bind(this)),e.addField0(this.freeTextField)}_onAcceptInput(e){let t=this.freeTextField.$field.val();this.freeText=t.trim(),a().log.isDebugEnabled()&&a().log.debug("(TextColumnUserFilter#_onAcceptInput) freeText="+this.freeText),this.triggerFilterFieldsChanged()}modifyFilterFields(){this.freeTextField.removeMandatoryIndicator()}}function Ba(i,e,t){return e=zE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function zE(i){var e=KE(i,"string");return typeof e=="symbol"?e:String(e)}function KE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class fs extends Qt{constructor(){super(),Ba(this,"text",void 0),Ba(this,"_cachedText",void 0),Ba(this,"_cachedTextLowerCase",void 0),this.filterType=fs.TYPE}createFilterAddedEventData(){let e=super.createFilterAddedEventData();return e.text=this.text,e}createLabel(){return this.text}accept(e){let t=this.table.visibleColumns().reduce((r,n)=>r+n.cellTextForTextFilter(e)+" ",""),s=u.nvl(this.text,"");return s!==this._cachedText&&(this._cachedText=s,this._cachedTextLowerCase=s.toLowerCase()),t=t.trim().toLowerCase(),t.indexOf(this._cachedTextLowerCase)>-1}}Ba(fs,"TYPE","text");function GE(i,e,t){return e=UE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function UE(i){var e=qE(i,"string");return typeof e=="symbol"?e:String(e)}function qE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class oc{constructor(){GE(this,"table",void 0)}init(e){a().extend(this,e)}accept(e){return!e.parentRow}createLabel(){return this.table.session.text("ui.TileView")}}function ka(i,e,t){return e=YE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function YE(i){var e=jE(i,"string");return typeof e=="symbol"?e:String(e)}function jE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Cg{constructor(e){ka(this,"acceptedKeys",void 0),ka(this,"keySupplier",void 0),ka(this,"active",void 0),ka(this,"alwaysAcceptedRowIds",void 0),this.acceptedKeys=[],this.keySupplier=e||(t=>t.lookupRow&&t.lookupRow.key),this.active=!0,this.alwaysAcceptedRowIds=[]}accept(e){if(!this.active||p.empty(this.acceptedKeys)||this.alwaysAcceptedRowIds.indexOf(e.id)!==-1)return!0;let t=this.keySupplier(e);return this.acceptedKeys.indexOf(t)!==-1}setAcceptedKeys(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this.acceptedKeys=p.ensure(t)}setActive(e){this.active=e}setAlwaysAcceptedRowIds(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this.alwaysAcceptedRowIds=t}}function Ha(i,e,t){return e=XE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function XE(i){var e=JE(i,"string");return typeof e=="symbol"?e:String(e)}function JE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Sg{constructor(e){Ha(this,"acceptedText",void 0),Ha(this,"textSupplier",void 0),Ha(this,"active",void 0),Ha(this,"alwaysAcceptedRowIds",void 0),this.acceptedText=null,this.textSupplier=e||(t=>t.lookupRow&&t.lookupRow.text),this.active=!0,this.alwaysAcceptedRowIds=[]}accept(e){if(!this.active||y.empty(this.acceptedText)||this.alwaysAcceptedRowIds.indexOf(e.id)!==-1)return!0;let t=this.textSupplier(e);return y.empty(t)?!1:y.contains(t.toLowerCase(),this.acceptedText.toLowerCase())}setAcceptedText(e){this.acceptedText=e}setActive(e){this.active=e}setAlwaysAcceptedRowIds(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this.alwaysAcceptedRowIds=t}}function Na(i,e,t){return e=QE(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function QE(i){var e=ZE(i,"string");return typeof e=="symbol"?e:String(e)}function ZE(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Va extends I{constructor(){super(),Na(this,"preselectedTime",void 0),Na(this,"selectedTime",void 0),Na(this,"viewDate",void 0),Na(this,"resolution",void 0),this.preselectedTime=null,this.selectedTime=null,this.resolution=null}_init(e){super._init(e),this.resolution=e.timeResolution}_render(){this.$container=this.$parent.appendDiv("time-picker").toggleClass("touch-only",x.get().supportsOnlyTouch()),this.$parent.appendDiv("time-picker-separator"),this.htmlComp=T.install(this.$container,this.session),this._renderTimeSelection(),this._installScrollbars()}_renderTimeSelection(){let e,t=w.trunc(new Date),s=w.ceil(new Date,this.resolution),r=0,n,o,l=this.$parent.makeDiv("day-table");for(e=0;e<24;e++){t.setMinutes(0),r=t.getHours(),n=l.appendDiv("hour-row");let h=n.appendDiv("cell  hours").data("time",new Date(t)).on("click",this._onTimeClick.bind(this));for(s.getHours()===t.getHours()&&h.addClass("now"),h.appendSpan("text").text(w.format(t,this.session.locale,"HH"));r===t.getHours();)o=n.appendDiv("cell minutes").data("time",new Date(t)).on("click",this._onTimeClick.bind(this)),o.appendSpan("text").text(w.format(t,this.session.locale,"mm")),w.isSameTime(s,t)&&o.addClass("now"),t.setMinutes(t.getMinutes()+this.resolution)}return l.appendTo(this.$container),l}_installScrollbars(e){this._uninstallScrollbars(),super._installScrollbars({axis:"y"})}_scrollTo(e){!e||(this.parent instanceof za?setTimeout(()=>{this.rendered&&P.scrollTo(this.$container,e,"center")}):P.scrollTo(this.$container,e,"center"))}preselectTime(e){e&&this.setSelectedTime(null),this.setPreselectedTime(e)}setPreselectedTime(e){this.setProperty("preselectedTime",e)}_renderPreselectedTime(){let e;this.$container.find(".cell").each((t,s)=>{let r=a()(s),n=r.data("time");r.removeClass("preselected"),this.preselectedTime&&(r.hasClass("hours")&&this.preselectedTime.getHours()===n.getHours()||r.hasClass("minutes")&&w.isSameTime(this.preselectedTime,n))&&(r.addClass("preselected"),e=r)}),this._scrollTo(e)}selectTime(e){e&&this.setPreselectedTime(null),this.setSelectedTime(e)}setSelectedTime(e){this.setProperty("selectedTime",e)}_renderSelectedTime(){let e;this.$container.find(".cell").each((t,s)=>{let r=a()(s),n=r.data("time");r.removeClass("selected"),this.selectedTime&&(r.hasClass("hours")&&this.selectedTime.getHours()===n.getHours()||r.hasClass("minutes")&&w.isSameTime(this.selectedTime,n))&&(r.addClass("selected"),e=r)}),this._scrollTo(e)}shiftSelectedTime(e,t,s){let r=this.preselectedTime;this.selectedTime&&(r=w.shiftTime(this.selectedTime,e,t*this.resolution,s)),r&&this.selectTime(this._snapToTimeGrid(r))}_snapToTimeGrid(e){if(!e)return e;let t=e.getMinutes();return t=parseInt(t/this.resolution+"")*this.resolution,e.setMinutes(t),e}_onTimeClick(e){let t=a()(e.currentTarget),s=new Date(t.data("time"));this.selectTime(s),this.trigger("timeSelect",{time:s})}}function Pg(i,e,t){return e=eF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function eF(i){var e=tF(i,"string");return typeof e=="symbol"?e:String(e)}function tF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Wa extends ue{constructor(){super(),Pg(this,"picker",void 0),Pg(this,"field",void 0),this.windowPaddingX=0,this.windowPaddingY=0,this.picker=null}_init(e){e.scrollType=e.scrollType||"layoutAndPosition",e.withFocusContext=!1,super._init(e),this.picker=u.create(Va,{parent:this,timeResolution:e.timeResolution})}_createLayout(){return new lc(this)}_render(){this.$container=this.$parent.appendDiv("popup time-picker-popup"),this.$container.toggleClass("alternative",this.field.fieldStyle===A.FieldStyle.ALTERNATIVE),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(this._createLayout()),this.htmlComp.validateRoot=!0,this.findDesktop().adjustOverlayOrder(this),this.picker.render()}getTimePicker(){return this.picker}_isMouseDownOnAnchor(e){let t=e.target;return this.field.$timeField.isOrHas(t)||this.field.$timeFieldIcon.isOrHas(t)||this.field.$timeClearIcon&&this.field.$timeClearIcon.isOrHas(t)}}class lc extends Ii{constructor(e){super(e),this.doubleCalcPrefSize=!1}layout(e){let t,s=this.popup.htmlComp,r=this.popup.picker.htmlComp;super.layout(e),t=s.size().subtract(s.insets()).subtract(r.margins()),r.setSize(t),this.popup.htmlComp.layouted&&this.popup.position()}preferredLayoutSize(e,t){let s,r=this.popup.htmlComp,n=this.popup.picker.htmlComp;return s=n.prefSize().add(r.insets()).add(n.margins()),s}}class za extends el{_init(e){super._init(e),this._field.on("acceptInput",this._onFieldAcceptInput.bind(this)),this.addCssClass("time-picker-touch-popup")}_initWidget(e){this._widget=u.create(Va,{parent:this,timeResolution:e.timeResolution})}_render(){super._render(),this._field.$container.addClass("time")}getTimePicker(){return this._widget}_onFieldAcceptInput(e){this._touchField.setDisplayText(e.displayText),this._touchField.setErrorStatus(e.errorStatus),(e.errorStatus?e.errorStatus.containsStatus(pi):!1)||this._touchField.setValue(e.value),this._touchField._triggerAcceptInput(e.whileTyping)}_acceptInput(){this._field.acceptTime(),this.close()}}function k(i,e,t){return e=iF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function iF(i){var e=sF(i,"string");return typeof e=="symbol"?e:String(e)}function sF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class pe extends I{constructor(){super(),k(this,"toggleBreadcrumbStyleEnabled",void 0),k(this,"breadcrumbTogglingThreshold",void 0),k(this,"autoCheckChildren",void 0),k(this,"checkable",void 0),k(this,"checkableStyle",void 0),k(this,"displayStyle",void 0),k(this,"dropType",void 0),k(this,"dropMaximumSize",void 0),k(this,"lazyExpandingEnabled",void 0),k(this,"menus",void 0),k(this,"contextMenu",void 0),k(this,"menuBar",void 0),k(this,"keyStrokes",void 0),k(this,"multiCheck",void 0),k(this,"nodes",void 0),k(this,"nodesMap",void 0),k(this,"nodePaddingLevelCheckable",void 0),k(this,"nodePaddingLevelNotCheckable",void 0),k(this,"nodePaddingLevelDiffParentHasIcon",void 0),k(this,"nodePaddingLeft",void 0),k(this,"nodeCheckBoxPaddingLeft",void 0),k(this,"nodeControlPaddingLeft",void 0),k(this,"nodePaddingLevel",void 0),k(this,"scrollToSelection",void 0),k(this,"scrollTopHistory",void 0),k(this,"selectedNodes",void 0),k(this,"prevSelectedNode",void 0),k(this,"filters",void 0),k(this,"textFilterEnabled",void 0),k(this,"filterSupport",void 0),k(this,"filteredElementsDirty",void 0),k(this,"filterAnimated",void 0),k(this,"rebuildSuppressed",void 0),k(this,"breadcrumbFilter",void 0),k(this,"dragAndDropHandler",void 0),k(this,"checkedNodes",void 0),k(this,"groupedNodes",void 0),k(this,"visibleNodesFlat",void 0),k(this,"visibleNodesMap",void 0),k(this,"viewRangeRendered",void 0),k(this,"viewRangeDirty",void 0),k(this,"viewRangeSize",void 0),k(this,"startAnimationFunc",void 0),k(this,"runningAnimations",void 0),k(this,"runningAnimationsFinishFunc",void 0),k(this,"nodeHeight",void 0),k(this,"nodeWidth",void 0),k(this,"maxNodeWidth",void 0),k(this,"nodeWidthDirty",void 0),k(this,"requestFocusOnNodeControlMouseDown",void 0),k(this,"initialTraversing",void 0),k(this,"$data",void 0),k(this,"$fillBefore",void 0),k(this,"$fillAfter",void 0),k(this,"_additionalContainerClasses",void 0),k(this,"_renderViewportBlocked",void 0),k(this,"_doubleClickSupport",void 0),k(this,"_$animationWrapper",void 0),k(this,"_$expandAnimationWrappers",void 0),k(this,"_filterMenusHandler",void 0),k(this,"_popupOpenHandler",void 0),k(this,"_inSelectionPathList",void 0),k(this,"_scrollDirections",void 0),k(this,"_changeNodeTaskScheduled",void 0),k(this,"_$mouseDownNode",void 0),this.toggleBreadcrumbStyleEnabled=!1,this.breadcrumbTogglingThreshold=null,this.autoCheckChildren=!1,this.checkable=!1,this.checkableStyle=pe.CheckableStyle.CHECKBOX_TREE_NODE,this.displayStyle=pe.DisplayStyle.DEFAULT,this.dropType=0,this.dropMaximumSize=Fe.DEFAULT_DROP_MAXIMUM_SIZE,this.lazyExpandingEnabled=!0,this.menus=[],this.contextMenu=null,this.menuBar=null,this.keyStrokes=[],this.multiCheck=!0,this.nodes=[],this.nodesMap={},this.nodePaddingLevelCheckable=23,this.nodePaddingLevelNotCheckable=18,this.nodePaddingLevelDiffParentHasIcon=null,this.nodePaddingLeft=null,this.nodeCheckBoxPaddingLeft=29,this.nodeControlPaddingLeft=null,this.nodePaddingLevel=this.nodePaddingLevelNotCheckable,this.scrollToSelection=!1,this.scrollTop=0,this.scrollTopHistory=[],this.selectedNodes=[],this.prevSelectedNode=null,this.filters=[],this.textFilterEnabled=!0,this.filterSupport=this._createFilterSupport(),this.filteredElementsDirty=!1,this.filterAnimated=!0,this.checkedNodes=[],this.groupedNodes={},this.visibleNodesFlat=[],this.visibleNodesMap={},this._addWidgetProperties(["menus","keyStrokes"]),this._additionalContainerClasses="",this._doubleClickSupport=new Vr,this._$animationWrapper=null,this._$expandAnimationWrappers=[],this._filterMenusHandler=this._filterMenus.bind(this),this._popupOpenHandler=this._onDesktopPopupOpen.bind(this),this._inSelectionPathList={},this._changeNodeTaskScheduled=!1,this.viewRangeRendered=new B(0,0),this.viewRangeSize=20,this.startAnimationFunc=function(){this.runningAnimations++}.bind(this),this.runningAnimations=0,this.runningAnimationsFinishFunc=function(){this.runningAnimations--,this.runningAnimations<=0&&(this.runningAnimations=0,this._renderViewportBlocked=!1,this.invalidateLayoutTree())}.bind(this),this.nodeHeight=0,this.nodeWidth=0,this.maxNodeWidth=0,this.nodeWidthDirty=!1,this.$data=null,this._scrollDirections="both",this.requestFocusOnNodeControlMouseDown=!0,this._$mouseDownNode=null}_init(e){super._init(e),this.setFilters(this.filters,!1),this.addFilter(new ac(this),!1),this.breadcrumbFilter=new hc(this),this.displayStyle===pe.DisplayStyle.BREADCRUMB&&this.addFilter(this.breadcrumbFilter,!1),this.initialTraversing=!0,this._setCheckable(this.checkable),this.ensureTreeNodes(this.nodes),this._initNodes(this.nodes),this.initialTraversing=!1,this.menuBar=u.create(ce,{parent:this,position:ce.Position.BOTTOM,menuOrder:new io(this.session,"Tree"),menuFilter:this._filterMenusHandler,cssClass:"bounded"}),this._updateItemPath(!0),this._setDisplayStyle(this.displayStyle),this._setKeyStrokes(this.keyStrokes),this._setMenus(this.menus)}_initNodes(e,t){e||(e=this.nodes),pe.visitNodes(this._initTreeNode.bind(this),e,t),typeof this.selectedNodes[0]=="string"&&(this.selectedNodes=this.nodesByIds(this.selectedNodes)),this._updateSelectionPath(),e.forEach(s=>this.applyFiltersForNode(s)),pe.visitNodes((s,r)=>this._addToVisibleFlatList(s,!1),e,t)}ensureTreeNodes(e){for(let t=0;t<e.length;t++){let s=e[t];s.childNodeIndex=u.nvl(s.childNodeIndex,t),!(s instanceof ir)&&(e[t]=this._createTreeNode(s))}}_createTreeNode(e){return e=e||{},e.objectType=u.nvl(e.objectType,ir),e.parent=this,u.create(e)}_createKeyStrokeContext(){return new Oe}_initKeyStrokeContext(){super._initKeyStrokeContext(),this._initTreeKeyStrokeContext()}_initTreeKeyStrokeContext(){let e=Te.NONE;this.keyStrokeContext.registerKeyStrokes([new dc(this),new Ka(this,e),new Ga(this,e),new uc(this,e),new qa(this,e),new Ua(this,e),new Ya(this,e)])}_setMenus(e){this.updateKeyStrokes(e,this.menus),this._setProperty("menus",e),this._updateMenuBar()}_updateMenuBar(){let e=this._filterMenus(this.menus,It.MENU_BAR,!1,!0);this.menuBar.setMenuItems(e);let t=this._filterMenus(this.menus,It.CONTEXT_MENU,!0);this.contextMenu&&this.contextMenu.updateMenuItems(t)}_setKeyStrokes(e){this.updateKeyStrokes(e,this.keyStrokes),this._setProperty("keyStrokes",e)}_resetTreeNode(e,t){e.reset()}isSelectedNode(e){return this.selectedNodes.indexOf(e)>-1}_updateSelectionPath(){let e=this.selectedNodes[0];if(!e)return;this._inSelectionPathList[e.id]=!0,e.childNodes.forEach(s=>{this._inSelectionPathList[s.id]=!0});let t=e.parentNode;for(;t;)this._inSelectionPathList[t.id]=!0,t=t.parentNode}_initTreeNode(e,t){this.nodesMap[e.id]=e,t&&(e.parentNode=t,e.level=e.parentNode.level+1),e.checked&&this.checkedNodes.push(e),this._initTreeNodeInternal(e,t),this._updateMarkChildrenChecked(e,!0,e.checked),e.initialized=!0}_initTreeNodeInternal(e,t){}_destroy(){super._destroy(),this.visitNodes(this._destroyTreeNode.bind(this)),this.nodes=[]}_destroyTreeNode(e){delete this.nodesMap[e.id],this._removeFromFlatList(e,!1),e.destroy(),this._onNodeDeleted&&this._onNodeDeleted(e)}_onNodeDeleted(e){}visitNodes(e,t){return pe.visitNodes(e,this.nodes,t)}_render(){this.$container=this.$parent.appendDiv("tree"),this._additionalContainerClasses&&this.$container.addClass(this._additionalContainerClasses);let e=new pl(this);this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(e),this._renderData(),this.menuBar.render(),this.session.desktop.on("popupOpen",this._popupOpenHandler),this._renderCheckableStyle()}_renderData(){this.$data=this.$container.appendDiv("tree-data").on("contextmenu",this._onContextMenu.bind(this)).on("mousedown",".tree-node",this._onNodeMouseDown.bind(this)).on("mouseup",".tree-node",this._onNodeMouseUp.bind(this)).on("dblclick",".tree-node",this._onNodeDoubleClick.bind(this)).on("mousedown",".tree-node-control",this._onNodeControlMouseDown.bind(this)).on("mouseup",".tree-node-control",this._onNodeControlMouseUp.bind(this)).on("dblclick",".tree-node-control",this._onNodeControlDoubleClick.bind(this)),T.install(this.$data,this.session),this.isHorizontalScrollingEnabled()&&this.$data.toggleClass("scrollable-tree",!0),this._installScrollbars({axis:this._scrollDirections}),this._installNodeTooltipSupport(),this._updateNodeDimensions(),this._renderDisplayStyle(),this._renderViewport()}_renderProperties(){super._renderProperties(),this._renderTextFilterEnabled()}_postRender(){super._postRender(),this._renderSelection()}_remove(){this.session.desktop.off("popupOpen",this._popupOpenHandler),this.filterSupport.remove(),this._$animationWrapper&&this._$animationWrapper.stop(!1,!0),this.visitNodes(this._resetTreeNode.bind(this)),Fe.uninstallDragAndDropHandler(this),this._uninstallNodeTooltipSupport(),this.$fillBefore=null,this.$fillAfter=null,this.$data=null,this.viewRangeRendered=new B(0,0),super._remove()}isHorizontalScrollingEnabled(){return this._scrollDirections==="both"||this._scrollDirections==="x"}isTreeNodeCheckEnabled(){return this.checkableStyle===pe.CheckableStyle.CHECKBOX_TREE_NODE}_onScroll(e){let t=this.scrollToSelection;this.scrollToSelection=!1;let s=this.$data[0].scrollTop,r=this.$data[0].scrollLeft;this.scrollTop!==s&&this.rendered&&this._renderViewport(),this.scrollTop=s,this.scrollLeft=r,this.scrollToSelection=t}setScrollTop(e){this.setProperty("scrollTop",e),this.rendered&&(this._renderViewport(),this._renderScrollTop())}_renderScrollTop(){this.rendering||P.scrollTop(this.$data,this.scrollTop)}get$Scrollable(){return this.$data}_renderViewport(){if(this.runningAnimations>0||this._renderViewportBlocked||!this.$container.isEveryParentVisible())return;let e=this._calculateCurrentViewRange();this._renderViewRange(e)}_calculateCurrentViewRange(){let e,t=this.$data[0].scrollTop;return this.$data[0].scrollHeight-this.$data[0].clientHeight===0&&this.visibleNodesFlat.length>0?e=this.visibleNodesFlat[0]:e=this._nodeAtScrollTop(t),this._calculateViewRangeForNode(e)}_rerenderViewport(){this._renderViewportBlocked||(this._removeRenderedNodes(),this._renderFiller(),this._updateDomNodeWidth(),this._renderViewport())}_removeRenderedNodes(){this.$data.find(".tree-node").each((t,s)=>{let r=a()(s),n=r.data("node");r.hasClass("hiding")||this._removeNode(n)}),this.viewRangeRendered=new B(0,0)}_renderViewRangeForNode(e){let t=this._calculateViewRangeForNode(e);this._renderViewRange(t)}_renderNodesInRange(e){let t=!1,s=this.visibleNodesFlat;if(s.length===0)return;if(e=new B(0,s.length).intersect(e),this.viewRangeRendered.size()>0&&!e.intersect(this.viewRangeRendered).equals(new B(0,0)))throw new Error("New range must not intersect with existing.");e.to<=this.viewRangeRendered.from&&(t=!0);let n=this.viewRangeRendered.union(e);if(n.length===2)throw new Error("Can only prepend or append rows to the existing range. Existing: "+this.viewRangeRendered+". New: "+n);this.viewRangeRendered=n[0];let o=this.ensureRangeVisible(e);a().log.isTraceEnabled()&&a().log.trace(o+" new nodes rendered from "+e)}ensureRangeVisible(e){let t=this.visibleNodesFlat,s=[];for(let r=e.from;r<e.to;r++){let n=t[r];n.attached||s.push(n)}return this._insertNodesInDOM(s),s.length}_renderFiller(){this.$fillBefore||(this.$fillBefore=this.$data.prependDiv("tree-data-fill"));let e=this._calculateFillerDimension(new B(0,this.viewRangeRendered.from));this.$fillBefore.cssHeight(e.height),this.isHorizontalScrollingEnabled()&&(this.$fillBefore.cssWidth(e.width),this.maxNodeWidth=Math.max(e.width,this.maxNodeWidth)),a().log.isTraceEnabled()&&a().log.trace("FillBefore height: "+e.height),this.$fillAfter||(this.$fillAfter=this.$data.appendDiv("tree-data-fill"));let t={height:0,width:0};t=this._calculateFillerDimension(new B(this.viewRangeRendered.to,this.visibleNodesFlat.length)),this.$fillAfter.cssHeight(t.height),this.isHorizontalScrollingEnabled()&&(this.$fillAfter.cssWidth(t.width),this.maxNodeWidth=Math.max(t.width,this.maxNodeWidth)),a().log.isTraceEnabled()&&a().log.trace("FillAfter height: "+t.height)}_calculateFillerDimension(e){let t=0;this.rendered&&(t=this.$data.width());let s={height:0,width:Math.max(t,this.maxNodeWidth)};for(let r=e.from;r<e.to;r++){let n=this.visibleNodesFlat[r];s.height+=this._heightForNode(n),s.width=Math.max(s.width,this._widthForNode(n))}return s}_removeNodesInRange(e){let t,s=0,r=this.visibleNodesFlat;e=new B(0,r.length).intersect(e);let o=this.viewRangeRendered.subtract(e);if(o.length===2)throw new Error("Can only remove nodes at the beginning or end of the existing range. "+this.viewRangeRendered+". New: "+o);this.viewRangeRendered=o[0];for(let l=e.from;l<e.to;l++)t=r[l],this._removeNode(t),s++;a().log.isTraceEnabled()&&a().log.trace(s+" nodes removed from "+e+".")}_removeNode(e){let t=e.$node;!t||t.hasClass("hiding")||(t.detach(),e.attached=!1)}_renderViewRange(e){if(e.from===this.viewRangeRendered.from&&e.to===this.viewRangeRendered.to&&!this.viewRangeDirty){this.nodeWidthDirty&&(this._renderFiller(),this._updateDomNodeWidth());return}if(this.viewRangeDirty)this.viewRangeRendered=e,this.ensureRangeVisible(e);else{let t=e.subtract(this.viewRangeRendered),s=this.viewRangeRendered.subtract(e),r=new B(0,this.visibleNodesFlat.length);s.forEach(n=>{this._removeNodesInRange(n),r.to<n.to&&(this.viewRangeRendered=e)}),t.forEach(n=>{this._renderNodesInRange(n)})}if(this.viewRangeRendered.size()>0){let t=this.visibleNodesFlat,s=t[this.viewRangeRendered.from],r=t[this.viewRangeRendered.to-1];if(this.viewRangeDirty){let n=s.$node.prevAll(".tree-node"),o=r.$node.nextAll(".tree-node");this._cleanupNodes(n),this._cleanupNodes(o)}if(!s.attached||!r.attached)throw new Error("Nodes not rendered as expected. "+this.viewRangeRendered+". First: "+v.debugOutput(s.$node)+". Last: "+v.debugOutput(r.$node)+". Length: visibleNodesFlat="+this.visibleNodesFlat.length+" nodes="+this.nodes.length+" nodesMap="+Object.keys(this.nodesMap).length)}this._postRenderViewRange(),this.viewRangeDirty=!1}_postRenderViewRange(){this._renderFiller(),this._updateDomNodeWidth(),this._renderSelection()}_visibleNodesInViewRange(){return this.visibleNodesFlat.slice(this.viewRangeRendered.from,this.viewRangeRendered.to)}_updateDomNodeWidth(){if(!this.isHorizontalScrollingEnabled()||!this.rendered||!this.nodeWidthDirty)return;let e=this._visibleNodesInViewRange(),t=this.maxNodeWidth;t=e.reduce((s,r)=>Math.max(r.width,s),u.nvl(t,0)),e.forEach(s=>s.$node.cssWidth(t)),this.nodeWidthDirty=!1}_cleanupNodes(e){for(let t=0;t<e.length;t++)this._removeNode(e.eq(t).data("node"))}_nodeAtScrollTop(e){let t=0,s;this.visibleNodesFlat.some((n,o)=>(t+=this._heightForNode(n),e<t?(s=n,!0):!1));let r=this.visibleNodesFlat.length;return!s&&r>0&&(s=this.visibleNodesFlat[r-1]),s}_heightForNode(e){let t=0;return e.height?t=e.height:t=this.nodeHeight,t}_widthForNode(e){let t=0;return e.width?t=e.width:t=this.nodeWidth,t}_calculateViewRangeForNode(e){let t=new B,s=Math.floor(this.viewRangeSize/pe.VIEW_RANGE_DIVISOR),r,n=this.visibleNodesFlat.indexOf(e);return t.from=Math.max(n-s,0),t.to=Math.min(t.from+this.viewRangeSize,this.visibleNodesFlat.length),!e||n===-1||(r=this.viewRangeSize-t.size(),r>0&&(t.from=Math.max(t.to-this.viewRangeSize,0))),t}calculateViewRangeSize(){if(this._updateNodeDimensions(),this.nodeHeight===0)throw new Error("Cannot calculate view range with nodeHeight = 0");let e=pe.VIEW_RANGE_DIVISOR/2,t=Math.ceil(this.$data.outerHeight()/this.nodeHeight)*e;return Math.max(pe.VIEW_RANGE_DIVISOR,t)}setViewRangeSize(e){this.viewRangeSize!==e&&(this._setProperty("viewRangeSize",e),this.rendered&&this._renderViewport())}_updateNodeDimensions(){let e=this._createTreeNode(),t=this._renderNode(e).appendTo(this.$data);if(this.nodeHeight=t.outerHeight(!0),this.isHorizontalScrollingEnabled()){let s=this.nodeWidth;this.nodeWidth=t.outerWidth(!0),s!==this.nodeWidth&&(this.viewRangeDirty=!0)}e.reset()}updateNodeHeights(){this.visibleNodesFlat.forEach(e=>{e.attached?e.height=e.$node.outerHeight(!0):e.height=null})}removeAllNodes(){this._removeNodes(this.nodes)}_removeNodes(e,t){e.length!==0&&(e.forEach(s=>{this._removeFromFlatList(s,!0),s.childNodes.length>0&&this._removeNodes(s.childNodes,s),s.$node&&(this._$animationWrapper&&this._$animationWrapper.find(s.$node).length>0&&this._$animationWrapper.stop(!1,!0),s.reset())}),p.ensure(t).forEach(s=>{s&&s.$node&&s.childNodes.length===0&&s.$node.removeClass("expanded lazy")}),this.rendered&&(this.viewRangeDirty=!0,this.invalidateLayoutTree()))}_renderNode(e){let t=this._computeNodePaddingLeft(e);return e.render(this.$container,t),e.$node}_removeMenus(){}_filterMenus(e,t,s,r){return We.filterAccordingToSelection("Tree",this.selectedNodes.length,e,t,{onlyVisible:s,enableDisableKeyStrokes:r})}_renderEnabled(){super._renderEnabled(),this._installOrUninstallDragAndDropHandler();let e=this.enabledComputed;this.$data.setEnabled(e),this.$container.setTabbableOrFocusable(e)}_renderDisabledStyle(){super._renderDisabledStyle(),this._renderDisabledStyleInternal(this.$data)}setCheckable(e){this.setProperty("checkable",e)}_setCheckable(e){this._setProperty("checkable",e),this._updateNodePaddingLevel()}_updateNodePaddingLevel(){this.isBreadcrumbStyleActive()?this.nodePaddingLevel=0:this.checkable?this.nodePaddingLevel=this.nodePaddingLevelCheckable:this.nodePaddingLevel=this.nodePaddingLevelNotCheckable}setCheckableStyle(e){this.setProperty("checkableStyle",e)}_renderCheckable(){let e=s=>Boolean(s.$node),t=s=>{let r=s.$node,n=r.children(".tree-node-control"),o=r.children(".tree-node-checkbox");s._updateControl(n),this.checkable?o.length===0&&s._renderCheckbox():o.remove(),r.cssPaddingLeft(this._computeNodePaddingLeft(s)),s.childNodes&&s.childNodes.filter(e).forEach(t)};this.nodes.filter(e).forEach(t)}_renderDisplayStyle(){this.$container.toggleClass("breadcrumb",this.isBreadcrumbStyleActive()),this.nodePaddingLeft=null,this.nodeControlPaddingLeft=null;let e=b.values(this.nodesMap).filter(t=>!!t.$node).map(t=>t.$node.get(0));this._updateNodePaddingsLeft(a()(e)),this.invalidateLayoutTree()}_renderExpansion(e,t){let s={expandLazyChanged:!1,expansionChanged:!1};a().extend(s,t);let r=e.$node,n=e.expanded;!r||r.length===0||e.childNodes.length!==0&&(r.toggleClass("lazy",n&&e.expandedLazy),!(!s.expansionChanged&&!s.expandLazyChanged)&&(n?r.addClass("expanded"):r.removeClass("expanded")))}_renderSelection(){this.selectedNodes.length===0&&this.nodes.forEach(e=>{e.rendered&&e.$node.addClass("child-of-selected")}),this.$container.toggleClass("no-nodes-selected",this.selectedNodes.length===0),this.selectedNodes.forEach(e=>{if(!this.visibleNodesMap[e.id])return;let t=e.parentNode;for(t&&t.rendered&&t.$node.addClass("parent-of-selected");t;)t.rendered&&t.$node.addClass("ancestor-of-selected"),t=t.parentNode;e.expanded&&e.childNodes.forEach(s=>{s.rendered&&s.$node.addClass("child-of-selected")}),e.rendered&&e.$node.select(!0)});for(let e=this.viewRangeRendered.from;e<this.viewRangeRendered.to&&!(e>=this.visibleNodesFlat.length);e++){let t=this.visibleNodesFlat[e];t&&t.rendered&&t.$node.toggleClass("group",Boolean(this.groupedNodes[t.id]))}this._updateNodePaddingsLeft(),this._highlightPrevSelectedNode(),this.scrollToSelection&&this.revealSelection()}_renderCheckableStyle(){this.$data.toggleClass("checkable",this.isTreeNodeCheckEnabled())}_highlightPrevSelectedNode(){!this.isBreadcrumbStyleActive()||!this.prevSelectedNode||!this.prevSelectedNode.rendered||this.prevSelectedNode.prevSelectionAnimationDone||this.prevSelectedNode.$node.hasClass("animate-prev-selected")||this.prevSelectedNode.$node.addClassForAnimation("animate-prev-selected").oneAnimationEnd(()=>{this.prevSelectedNode.prevSelectionAnimationDone=!0})}_removeSelection(){this.selectedNodes.length===0&&this.nodes.forEach(e=>{e.rendered&&e.$node.removeClass("child-of-selected")}),this.prevSelectedNode&&this.prevSelectedNode.rendered&&this.prevSelectedNode.$node.removeClass("animate-prev-selected"),this.selectedNodes.forEach(this._removeNodeSelection,this)}_removeNodeSelection(e){e.rendered&&e.$node.select(!1);let t=e.parentNode;for(t&&t.rendered&&t.$node.removeClass("parent-of-selected");t&&t.rendered;)t.$node.removeClass("ancestor-of-selected"),t=t.parentNode;e.expanded&&e.childNodes.forEach(s=>{s.rendered&&s.$node.removeClass("child-of-selected")})}setDropType(e){this.setProperty("dropType",e)}_renderDropType(){this._installOrUninstallDragAndDropHandler()}setDropMaximumSize(e){this.setProperty("dropMaximumSize",e)}_installOrUninstallDragAndDropHandler(){Fe.installOrUninstallDragAndDropHandler({target:this,doInstall:()=>this.dropType&&this.enabledComputed,selector:".tree-data,.tree-node",onDrop:e=>this.trigger("drop",e),dropType:()=>this.dropType,additionalDropProperties:e=>{let t=a()(e.currentTarget),s={nodeId:""};if(t.hasClass("tree-node")){let r=t.data("node");s.nodeId=r.id}return s}})}_updateMarkChildrenChecked(e,t,s,r){if(!this.checkable)return;if(r){let o=!1;for(let l=0;l<e.childNodes.length;l++){let h=e.childNodes[l];if(h.checked||h.childrenChecked){e.childrenChecked=!0,s=!0,o=!0,this.rendered&&e.$node&&e.$node.children(".tree-node-checkbox").children(".check-box").toggleClass("children-checked",!0);break}}o||(e.childrenChecked=!1,this.rendered&&e.$node&&e.$node.children(".tree-node-checkbox").children(".check-box").toggleClass("children-checked",!1))}if(!e.parentNode||e.parentNode.checked)return;let n=!1;if(!s&&!t){let o=!1;for(let l=0;l<e.parentNode.childNodes.length;l++){let h=e.parentNode.childNodes[l];if(h.checked||h.childrenChecked){o=!0;break}}o!==e.parentNode.childrenChecked&&(e.parentNode.childrenChecked=o,n=!0)}s&&!e.parentNode.childrenChecked&&(e.parentNode.childrenChecked=!0,n=!0),n&&(this._updateMarkChildrenChecked(e.parentNode,t,s),this.rendered&&e.parentNode.$node&&(s?e.parentNode.$node.children(".tree-node-checkbox").children(".check-box").toggleClass("children-checked",!0):e.parentNode.$node.children(".tree-node-checkbox").children(".check-box").toggleClass("children-checked",!1)))}_installNodeTooltipSupport(){K.install(this.$data,{parent:this,selector:".tree-node",text:this._nodeTooltipText.bind(this),arrowPosition:50,arrowPositionUnit:"%",nativeTooltip:!x.get().isCustomEllipsisTooltipPossible()})}_uninstallNodeTooltipSupport(){K.uninstall(this.$data)}_nodeTooltipText(e){let t=e.data("node");if(t.tooltipText)return t.tooltipText;if(this._isTruncatedNodeTooltipEnabled()&&e.isContentTruncated())return t.$text.text()}_isTruncatedNodeTooltipEnabled(){return!0}setDisplayStyle(e){this.displayStyle!==e&&(this._renderViewportBlocked=!0,this._setDisplayStyle(e),this.rendered&&this._renderDisplayStyle(),this._renderViewportBlocked=!1)}_setDisplayStyle(e){if(this._setProperty("displayStyle",e),this.displayStyle===pe.DisplayStyle.BREADCRUMB){if(this.selectedNodes.length>0){let t=this.selectedNodes[0];t.expanded||this.expandNode(t)}this.filterAnimated=!1,this.addFilter(this.breadcrumbFilter,!1),this.filterVisibleNodes()}else this.removeFilter(this.breadcrumbFilter),this.filterAnimated=!0;this._updateNodePaddingLevel()}_updateNodePaddingsLeft(e){(e||this.$nodes()).each((s,r)=>{let n=a()(r),o=n.data("node"),l=this._computeNodePaddingLeft(o);n.cssPaddingLeft(b.isNullOrUndefined(l)?"":l),o._updateControl(n.children(".tree-node-control"))})}setBreadcrumbStyleActive(e){e?this.setDisplayStyle(pe.DisplayStyle.BREADCRUMB):this.setDisplayStyle(pe.DisplayStyle.DEFAULT)}isNodeInBreadcrumbVisible(e){return this._inSelectionPathList[e.id]===void 0?!1:this._inSelectionPathList[e.id]}isBreadcrumbStyleActive(){return this.displayStyle===pe.DisplayStyle.BREADCRUMB}setToggleBreadcrumbStyleEnabled(e){this.setProperty("toggleBreadcrumbStyleEnabled",e)}setBreadcrumbTogglingThreshold(e){this.setProperty("breadcrumbTogglingThreshold",e)}expandNode(e,t){this.setNodeExpanded(e,!0,t)}collapseNode(e,t){this.setNodeExpanded(e,!1,t)}collapseAll(){this.rebuildSuppressed=!0,this.visitNodes(e=>this.collapseNode(e)),this.rendered&&this._rerenderViewport(),this.rebuildSuppressed=!1}setNodeExpanded(e,t,s){s=s||{};let r=s.lazy;b.isNullOrUndefined(r)&&(e.expanded===t?r=e.expandedLazy:t?r=e.lazyExpandingEnabled:r=!1);let n=u.nvl(s.renderAnimated,!0);if(this.lazyExpandingEnabled||(r=!1),this.isBreadcrumbStyleActive()&&!t&&this.selectedNodes.indexOf(e)>-1){this.setNodeExpanded(e,!0,s);return}if(s.collapseChildNodes){let l=b.valueCopy(s);l.renderExpansion=!1,e.childNodes.forEach(h=>{h.expanded&&this.collapseNode(h,l)})}let o={expansionChanged:!1,expandLazyChanged:!1};(e.expanded!==t||e.expandedLazy!==r)&&(o.expansionChanged=e.expanded!==t,o.expandLazyChanged=e.expandedLazy!==r,e.expanded=t,e.expandedLazy=r,o.expansionChanged?e.parentNode?this._rebuildParent(e.parentNode,s):e.filterAccepted?this._addToVisibleFlatList(e,!1):this._removeFromFlatList(e,!1):o.expandLazyChanged&&this.applyFiltersForNode(e,!1,n),this.groupedNodes[e.id]&&this._updateItemPath(!1,e),e.expanded?e.ensureLoadChildren().done(this._addChildrenToFlatList.bind(this,e,null,n,null,!0)):this._removeChildrenFromFlatList(e,n),this.trigger("nodeExpanded",{node:e,expanded:t,expandedLazy:r}),this.viewRangeDirty=!0),this.rendered&&u.nvl(s.renderExpansion,!0)&&this._renderExpansion(e,o),this.rendered&&this.ensureExpansionVisible(e)}setNodeExpandedRecursive(e,t,s){pe.visitNodes(r=>this.setNodeExpanded(r,t,s),e)}_rebuildParent(e,t){if(!this.rebuildSuppressed&&(e.expanded||e.expandedLazy?this._addChildrenToFlatList(e,null,!0,null,!0):this._removeChildrenFromFlatList(e,!1),this.rendered&&u.nvl(t.renderExpansion,!0))){let s={expansionChanged:!0};this._renderExpansion(e,s)}}_removeChildrenFromFlatList(e,t){if(this.visibleNodesMap[e.id]){let r=this.visibleNodesFlat.indexOf(e),n=0,o=e.level,l=[];t=t&&this.rendered,this._$animationWrapper&&this._$animationWrapper.stop(!1,!0),this._$expandAnimationWrappers.forEach(h=>h.stop(!1,!0));for(let h=r+1;h<this.visibleNodesFlat.length&&this.visibleNodesFlat[h].level>o;h++){let d=this.visibleNodesFlat[h];this.isHorizontalScrollingEnabled()&&d.width===this.maxNodeWidth&&(this.maxNodeWidth=0,this.nodeWidthDirty=!0),delete this.visibleNodesMap[this.visibleNodesFlat[h].id],d.attached&&t?(this._$animationWrapper||(this._$animationWrapper=a()('<div class="animation-wrapper">').insertBefore(d.$node),this._$animationWrapper.data("parentNode",e)),d.isDescendantOf(this._$animationWrapper.data("parentNode"))&&this._$animationWrapper.append(d.$node),d.attached=!1,d.displayBackup=d.$node.css("display"),l.push(d)):d.attached&&!t&&this.hideNode(d,!1,!1),n++}return this.visibleNodesFlat.splice(r+1,n),t&&(this._renderViewportBlocked=!0,l.length>0?this._$animationWrapper.animate({height:0},{start:this.startAnimationFunc,complete:s.bind(this,l),step:()=>this.revalidateLayoutTree(),duration:200,queue:!1}):this._$animationWrapper?(this._$animationWrapper.remove(),this._$animationWrapper=null,s.call(this,l)):this._renderViewportBlocked=!1),l}return[];function s(r){r.forEach(n=>{n.$node.detach(),n.$node.css("display",n.displayBackup),n.displayBackup=null}),this._$animationWrapper&&(this._$animationWrapper.remove(),this._$animationWrapper=null),this.runningAnimationsFinishFunc()}}_removeFromFlatList(e,t){if(this.visibleNodesMap[e.id]){let s=this.visibleNodesFlat.indexOf(e);this._removeChildrenFromFlatList(e,!1),this.isHorizontalScrollingEnabled()&&e.width===this.maxNodeWidth&&(this.maxNodeWidth=0,this.nodeWidthDirty=!0),this.visibleNodesFlat.splice(s,1),delete this.visibleNodesMap[e.id],this.hideNode(e,t)}}_addToVisibleFlatList(e,t){if(!this.visibleNodesMap[e.id]&&e.filterAccepted&&(!e.parentNode||e.parentNode.expanded&&this.visibleNodesMap[e.parentNode.id]))if(this.initialTraversing)this._addToVisibleFlatListNoCheck(e,this.visibleNodesFlat.length,t);else{let s=this._findInsertPositionInFlatList(e);this._addToVisibleFlatListNoCheck(e,s,t)}}_addChildrenToFlatList(e,t,s,r,n){if(!this.visibleNodesMap[e.id])return 0;let o=Boolean(r);return t=t||this.visibleNodesFlat.indexOf(e),s=s&&this.rendered,this._$animationWrapper&&!o&&this._$animationWrapper.stop(!1,!0),r?r.setInsertAt(t):r=this.newInsertBatch(t+1),e.childNodes.forEach((l,h)=>{if(!l.initialized||((l.filterDirty||n)&&this.applyFiltersForNode(l,!1).newlyHidden.forEach(m=>this._removeFromFlatList(m,!1)),!l.filterAccepted))return;let d;this.visibleNodesMap[l.id]?(this.insertBatchInVisibleNodes(r,this._showNodes(r),s),this.checkAndHandleBatchAnimationWrapper(e,!1,r),r=this.newInsertBatch(r.nextBatchInsertIndex()),r=this._addChildrenToFlatListIfExpanded(1,l,d,s,r,n)):(r.insertNodes.push(l),this.visibleNodesMap[l.id]=!0,r=this.checkAndHandleBatch(r,e,s),r=this._addChildrenToFlatListIfExpanded(0,l,d,s,r,n))}),o||(this.insertBatchInVisibleNodes(r,this._showNodes(r),s),this.invalidateLayoutTree()),r}_addChildrenToFlatListIfExpanded(e,t,s,r,n,o){return t.expanded&&t.childNodes.length&&(n.containsNode(t.parentNode)||n.length()>1?s=n.insertAt():s=this._findInsertPositionInFlatList(t),s+=e,n=this._addChildrenToFlatList(t,s,r,n,o)),n}_showNodes(e){return this.viewRangeRendered.from+this.viewRangeSize>=e.lastBatchInsertIndex()&&this.viewRangeRendered.from<=e.lastBatchInsertIndex()}_findInsertPositionInFlatList(e){let t,s=e.parentNode;s?t=s.childNodes:t=this.nodes;let r=e,n=t.filter(f=>Boolean(this.visibleNodesMap[f.id])||f===r);if(n.length===0)return this._findPositionInFlatList(s)+1;let o=n.indexOf(e);if(o===0)return this._findPositionInFlatList(s)+1;let l=n[o-1],h=this._findPositionInFlatList(l);if(h===-1)return this._findPositionInFlatList(s)+1;let d,c;for(d=h;d<this.visibleNodesFlat.length;d++)if(c=this.visibleNodesFlat[d],!this._isInSameSubTree(l,c))return d;return this.visibleNodesFlat.length}_findPositionInFlatList(e){return this.visibleNodesFlat.indexOf(e)}_isInSameSubTree(e,t){do{if(t===e||t.parentNode===e)return!0;t=t.parentNode}while(t);return!1}isChildOfSelectedNodes(e){for(;e;){if(this.selectedNodes.indexOf(e.parentNode)>-1)return!0;e=e.parentNode}return!1}newInsertBatch(e){return{insertNodes:[e,0],$animationWrapper:null,lastBatchInsertIndex:function(){return this.isEmpty()?this.insertAt():this.insertAt()+this.insertNodes.length-3},nextBatchInsertIndex:function(){return this.lastBatchInsertIndex()+(this.isEmpty()?1:2)},isEmpty:function(){return this.insertNodes.length===2},length:function(){return this.insertNodes.length-2},insertAt:function(){return this.insertNodes[0]},setInsertAt:function(t){this.insertNodes[0]=t},containsNode:function(t){return this.insertNodes.indexOf(t)!==-1}}}checkAndHandleBatchAnimationWrapper(e,t,s){if(t&&this.viewRangeRendered.from<=s.lastBatchInsertIndex()&&this.viewRangeRendered.to>=s.lastBatchInsertIndex()&&!s.$animationWrapper){let n=s.lastBatchInsertIndex()-1,o=this.viewRangeRendered.from===s.lastBatchInsertIndex()?null:this.visibleNodesFlat[n];if(o&&n>=this.viewRangeRendered.from&&n<this.viewRangeRendered.to&&!o.attached&&this.showNode(o,!1,n),o&&o.attached)s.$animationWrapper=a()('<div class="animation-wrapper">').insertAfter(o.$node);else if(e.attached)s.$animationWrapper=a()('<div class="animation-wrapper">').insertAfter(e.$node);else if(this.$fillBefore)s.$animationWrapper=a()('<div class="animation-wrapper">').insertAfter(this.$fillBefore);else{let l=this.visibleNodesFlat[s.lastBatchInsertIndex()];s.$animationWrapper=a()('<div class="animation-wrapper">').insertBefore(l.$node)}s.animationCompleteFunc=r,this._$expandAnimationWrappers.push(s.$animationWrapper)}function r(){s.$animationWrapper.replaceWith(s.$animationWrapper.contents()),p.remove(this._$expandAnimationWrappers,s.$animationWrapper),s.$animationWrapper=null,this.runningAnimationsFinishFunc()}}checkAndHandleBatch(e,t,s){return this.viewRangeRendered.from-1===e.lastBatchInsertIndex()&&(this.insertBatchInVisibleNodes(e,!1,!1),e=this.newInsertBatch(e.lastBatchInsertIndex()+1)),this.checkAndHandleBatchAnimationWrapper(t,s,e),this.viewRangeRendered.from+this.viewRangeSize-1===e.lastBatchInsertIndex()&&(this.insertBatchInVisibleNodes(e,!0,s),e=this.newInsertBatch(e.lastBatchInsertIndex()+1)),e}insertBatchInVisibleNodes(e,t,s){if(!e.isEmpty())if(this.visibleNodesFlat.splice(...e.insertNodes),t){let r=e.insertAt();for(let n=2;n<e.insertNodes.length;n++){let o=e.insertNodes[n];this.showNode(o,!1,r),e.$animationWrapper&&e.$animationWrapper.append(o.$node),r++}if(e.$animationWrapper){let n=e.$animationWrapper.outerHeight();e.$animationWrapper.css("height",0).animate({height:n},{start:this.startAnimationFunc,complete:e.animationCompleteFunc.bind(this),step:()=>this.revalidateLayoutTree(),duration:200,queue:!1})}}else e.$animationWrapper&&e.animationCompleteFunc&&e.animationCompleteFunc.call(this)}_addToVisibleFlatListNoCheck(e,t,s){p.insert(this.visibleNodesFlat,e,t),this.visibleNodesMap[e.id]=!0,this.showNode(e,s,t)}scrollTo(e,t){this.viewRangeRendered.size()!==0&&(e.attached||this._renderViewRangeForNode(e),e.attached&&P.scrollTo(this.$data,e.$node,t))}revealSelection(){if(!this.rendered){this.session.layoutValidator.schedulePostValidateFunction(this.revealSelection.bind(this));return}this.selectedNodes.length>0&&(this.visibleNodesMap[this.selectedNodes[0].id]||this._expandAllParentNodes(this.selectedNodes[0]),this.scrollTo(this.selectedNodes[0]),this.ensureExpansionVisible(this.selectedNodes[0]))}ensureExpansionVisible(e){!e||!e.$node||this.selectedNodes[0]!==e||P.ensureExpansionVisible({element:e,$element:e.$node,$scrollable:this.get$Scrollable(),isExpanded:t=>t.expanded,getChildren:t=>t.childNodes,nodePaddingLevel:this.nodePaddingLevel,defaultChildHeight:this.nodeHeight})}deselectAll(){this.selectNodes([])}selectNode(e,t){this.selectNodes(e,t)}selectNodes(e,t){e=p.ensure(e),!p.equalsIgnoreOrder(e,this.selectedNodes)&&(this.rendered&&(this._rememberScrollTopBeforeSelection(),this._removeSelection()),this.prevSelectedNode&&(this.prevSelectedNode.prevSelectionAnimationDone=!1),this.prevSelectedNode=this.selectedNodes[0],this._setSelectedNodes(e,t),this.rendered&&(this._renderSelection(),this._updateScrollTopAfterSelection()))}_rememberScrollTopBeforeSelection(){this.isBreadcrumbStyleActive()?this.selectedNodes.length>0&&(this.scrollTopHistory[this.selectedNodes[0].level]=this.$data[0].scrollTop):this.scrollTopHistory=[]}_updateScrollTopAfterSelection(){if(!this.isBreadcrumbStyleActive())return;let e=-1;this.selectedNodes.length>0&&(e=this.selectedNodes[0].level),this.scrollTopHistory.splice(e+1);let t=this.scrollTopHistory[e];t>=0&&this.setScrollTop(t)}_setSelectedNodes(e,t){this.selectedNodes=e.slice(),this._nodesSelectedInternal(e),this._triggerNodesSelected(t),this.selectedNodes.length>0&&!this.visibleNodesMap[this.selectedNodes[0].id]&&this._expandAllParentNodes(this.selectedNodes[0]),this._updateItemPath(!0),this.isBreadcrumbStyleActive()&&(this.selectedNodes.length>0&&!this.selectedNodes[0].expanded&&(this.expandNode(this.selectedNodes[0]),this.selectedNodes[0].filterDirty=!0),this.filter()),this.session.onRequestsDone(this._updateMenuBar.bind(this))}_nodesSelectedInternal(e){}deselectNode(e){this.deselectNodes(e)}deselectNodes(e,t){e=p.ensure(e),t=t||{},t.collectChildren&&(e=e.concat(this._collectNodesIfDescendants(e,this.selectedNodes)));let s=this.selectedNodes.slice();p.removeAll(s,e)&&this.selectNodes(s)}isNodeSelected(e){return this.selectedNodes.indexOf(e)>-1}_computeNodePaddingLeft(e){if(this._computeNodePaddings(),this.isBreadcrumbStyleActive())return this.nodePaddingLeft;let t=this.nodePaddingLeft+this._computeNodePaddingLeftForLevel(e);return this.checkable&&(t+=this.nodeCheckBoxPaddingLeft),t}_computeNodeControlPaddingLeft(e){return this.nodeControlPaddingLeft+this._computeNodePaddingLeftForLevel(e)}_computeNodePaddingLeftForLevel(e){if(this.checkable||!this.nodePaddingLevelDiffParentHasIcon)return e.level*this.nodePaddingLevel;let t=0,s=e.parentNode;for(;s;)t+=this.nodePaddingLevel,s.iconId&&!s.childNodes[0].iconId&&(t+=this.nodePaddingLevelDiffParentHasIcon),s=s.parentNode;return t}_computeNodePaddings(){if(this.nodePaddingLeft!==null&&this.nodeControlPaddingLeft!==null&&this.nodePaddingLevelDiffParentHasIcon!==null)return;let e=this.$data.appendDiv("tree-node"),t=e.appendDiv("tree-node-control");this.nodePaddingLeft===null&&(this.nodePaddingLeft=e.cssPaddingLeft()),this.nodeControlPaddingLeft===null&&(this.nodeControlPaddingLeft=t.cssPaddingLeft()),this.nodePaddingLevelDiffParentHasIcon===null&&(this.nodePaddingLevelDiffParentHasIcon=this.$container.cssPxValue("--node-padding-level-diff-parent-has-icon")),e.remove()}_expandAllParentNodes(e){let t,s=e,r=[];s=e;let n=[];for(;s.parentNode;)r.push(s.parentNode),this.visibleNodesMap[s.id]||n.push(s),s=s.parentNode;for(t=r.length-1;t>=0;t--)n.indexOf(r[t])!==-1&&this._addToVisibleFlatList(r[t],!1),r[t].expanded||this.expandNode(r[t],{renderExpansion:!1,renderAnimated:!1});this.rendered&&n.length>0&&(this._rerenderViewport(),this.invalidateLayoutTree())}_updateChildNodeIndex(e,t){if(!(!e||!e.length))for(let s=u.nvl(t,0);s<e.length;s++)e[s].childNodeIndex=s}insertNode(e,t){this.insertNodes([e],t)}insertNodes(e,t){let s=p.ensure(e).slice();if(s.length===0)return;this.ensureTreeNodes(s);let r=s;if(t&&!(t instanceof ir))throw new Error("parent has to be a tree node: "+t);if(r.sort((n,o)=>n.childNodeIndex-o.childNodeIndex),t){if(t.childNodes&&t.childNodes.length>0?(r.forEach(n=>{t.childNodes.indexOf(n)<0&&p.insert(t.childNodes,n,n.childNodeIndex)}),this._updateChildNodeIndex(t.childNodes,r[0].childNodeIndex)):r.forEach(n=>t.childNodes.push(n)),this._initNodes(r,t),this.groupedNodes[t.id]&&this._updateItemPath(!1,t),this.rendered){let n={expansionChanged:!0};this._renderExpansion(t,n),this.ensureExpansionVisible(t)}}else this.nodes&&this.nodes.length>0?(r.forEach(n=>{this.nodes.indexOf(n)<0&&p.insert(this.nodes,n,n.childNodeIndex)}),this._updateChildNodeIndex(this.nodes,r[0].childNodeIndex)):p.pushAll(this.nodes,r),this._initNodes(r,t);this.rendered&&(this.viewRangeDirty=!0,this.invalidateLayoutTree()),this.trigger("nodesInserted",{nodes:r,parentNode:t})}updateNode(e){this.updateNodes([e])}updateNodes(e){if(e=p.ensure(e),e.length===0)return;let t=[];e.forEach(s=>{let r,n=this.nodesMap[s.id];s===n?r=!0:r=this._applyUpdatedNodeProperties(n,s),r&&(this.applyFiltersForNode(n),this._updateItemPath(!1,n.parentNode),this.rendered&&n._decorate()),t.push(n)}),this.trigger("nodesUpdated",{nodes:t})}_applyUpdatedNodeProperties(e,t){let s=!1;return e.leaf!==t.leaf&&(e.leaf=t.leaf,s=!0),e.enabled!==t.enabled&&(e.enabled=t.enabled,s=!0),e.lazyExpandingEnabled!==t.lazyExpandingEnabled&&(e.lazyExpandingEnabled=t.lazyExpandingEnabled,(!t.lazyExpandingEnabled||!this.lazyExpandingEnabled)&&(e.expandedLazy=!1),s=!0),s}deleteNode(e,t){this.deleteNodes([e],t)}deleteAllNodes(){this.deleteAllChildNodes()}deleteNodes(e,t){let s=[],r=[],n=[];e=p.ensure(e).slice(),e.length!==0&&(e.forEach(o=>{let l=t||o.parentNode;if(l){if(o.parentNode!==l)throw new Error("Unexpected parent. Node.parent: "+o.parentNode+", parentNode: "+t);p.remove(l.childNodes,o),r.indexOf(l)===-1&&r.push(l)}else p.remove(this.nodes,o),n=this.nodes;this._destroyTreeNode(o),s.push(o),this._updateMarkChildrenChecked(o,!1,!1),pe.visitNodes(this._destroyTreeNode.bind(this),o.childNodes)}),r.forEach(o=>this._updateChildNodeIndex(o.childNodes)),this._updateChildNodeIndex(n),this.deselectNodes(s,{collectChildren:!0}),this.uncheckNodes(s,{collectChildren:!0}),this.rendered&&this._removeNodes(s,t||r),this.trigger("nodesDeleted",{nodes:e,parentNode:t}))}_collectNodesIfDescendants(e,t){let s=[];return t.forEach(r=>{e.some(n=>n.isAncestorOf(r))&&s.push(r)}),s}deleteAllChildNodes(e){let t;e?(t=e.childNodes,e.childNodes=[]):(t=this.nodes,this.nodes=[]),pe.visitNodes(s.bind(this),t),this.deselectNodes(t,{collectChildren:!0}),this.uncheckNodes(t,{collectChildren:!0}),this.rendered&&this._removeNodes(t,e),this.trigger("allChildNodesDeleted",{parentNode:e});function s(r){this._destroyTreeNode(r),this._updateMarkChildrenChecked(r,!1,!1)}}updateNodeOrder(e,t){if(e=p.ensure(e),this._updateChildNodeIndex(e),t){if(t.childNodes.length!==e.length)throw new Error("Node order may not be updated because lengths of the arrays differ.");t.childNodes=e.slice(),this._removeChildrenFromFlatList(t,!1),t.expanded&&this._addChildrenToFlatList(t,null,!1)}else{if(this.nodes.length!==e.length)throw new Error("Node order may not be updated because lengths of the arrays differ.");this.nodes=e.slice(),this.nodes.forEach(s=>{this._removeFromFlatList(s,!1),this._addToVisibleFlatList(s,!1),s.expanded&&this._addChildrenToFlatList(s,null,!1)})}this.trigger("childNodeOrderChanged",{parentNode:t})}checkNode(e,t,s){let r=a().extend(s,{checked:t});this.checkNodes([e],r)}checkNodes(e,t){let s={checked:!0,checkOnlyEnabled:!0,checkChildren:this.autoCheckChildren,triggerNodesChecked:!0};a().extend(s,t);let r=[];!this.checkable||!this.enabledComputed&&s.checkOnlyEnabled||(e=p.ensure(e),e.forEach(n=>{if(!n.enabled&&s.checkOnlyEnabled||n.checked===s.checked||!n.filterAccepted){s.checkChildren&&this.checkNodes(n.childNodes,s);return}if(!this.multiCheck&&s.checked){for(let o=0;o<this.checkedNodes.length;o++)this.checkedNodes[o].checked=!1,this._updateMarkChildrenChecked(this.checkedNodes[o],!1,!1,!0),r.push(this.checkedNodes[o]);this.checkedNodes=[]}if(n.checked=s.checked,n.checked?this.checkedNodes.push(n):p.remove(this.checkedNodes,n),r.push(n),this._updateMarkChildrenChecked(n,!1,s.checked,!0),s.checkChildren){let o=a().extend({},s,{triggerNodesChecked:!1});this.checkNodes(n.childNodes,o)}}),s.triggerNodesChecked&&r.length>0&&this.trigger("nodesChecked",{nodes:r}),this.rendered&&r.forEach(n=>n._renderChecked()))}uncheckNode(e,t){let s=a().extend({checkOnlyEnabled:!0},t);this.uncheckNodes([e],s)}uncheckNodes(e,t){let s={checked:!1,collectChildren:!1};a().extend(s,t),s.collectChildren&&(e=e.concat(this._collectNodesIfDescendants(e,this.checkedNodes))),this.checkNodes(e,s)}_triggerNodesSelected(e){this.trigger("nodesSelected",{debounce:e})}_showContextMenu(e){let t=function(s){if(!this.rendered)return;let r=this._filterMenus(this.menus,It.CONTEXT_MENU,!0),n=a()(s.currentTarget);r.length!==0&&(this.contextMenu&&this.contextMenu.close(),this.contextMenu=u.create(ft,{parent:this,menuItems:r,location:{x:s.pageX,y:s.pageY},$anchor:n,menuFilter:this._filterMenusHandler}),this.contextMenu.open())};this.session.onRequestsDone(t.bind(this),e)}_onNodeMouseDown(e){if(this._doubleClickSupport.mousedown(e),this._doubleClickSupport.doubleClicked())return!1;let t=a()(e.currentTarget),s=t.data("node");if(!!this.hasNode(s))return this._$mouseDownNode=t,t.window().one("mouseup",()=>{this._$mouseDownNode=null}),this.selectNodes(s),this.checkable&&s.enabled&&this._isCheckboxClicked(e)&&(x.get().loosesFocusIfPseudoElementIsRemoved()&&this.focusAndPreventDefault(e),this.checkNode(s,!s.checked)),!0}_onNodeMouseUp(e){if(this._doubleClickSupport.doubleClicked())return!1;let t=a()(e.currentTarget),s=t.data("node");if(!(!this._$mouseDownNode||this._$mouseDownNode[0]!==t[0]))return this.trigger("nodeClick",{node:s}),!0}_isCheckboxClicked(e){return this.isTreeNodeCheckEnabled()?!0:a()(e.target).is(".check-box")}_updateItemPath(e,t){let s,r,n;if(e&&(this.groupedNodes={},this._inSelectionPathList={}),!t){if(s=this.selectedNodes,s.length===0)return;for(r=s[0],e&&(this._inSelectionPathList[r.id]=!0,r.childNodes&&r.childNodes.forEach(l=>{this._inSelectionPathList[l.id]=!0})),n=r.level;r.parentNode;){let l=r.parentNode;if(this._isGroupingEnd(l)&&!t&&(t=r,!e))break;e&&(this._inSelectionPathList[l.id]=!0),r=l}t=t||s[0],this.groupedNodes[t.id]=!0}r=t,r&&r.expanded&&this.groupedNodes[r.id]&&o.call(this,r.childNodes);function o(l){l.forEach(h=>{this.groupedNodes[h.id]=!0,h._decorate(),h.filterDirty&&this.applyFiltersForNode(h),h.expanded&&h.filterAccepted&&o.call(this,h.childNodes)})}}_isGroupingEnd(e){return!1}selectedNode(){return this.selectedNodes.length===0?null:this.selectedNodes[0]}$selectedNodes(){return this.$data.find(".selected")}$nodes(){return this.$data.find(".tree-node")}addFilter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;this.filterSupport.addFilter(e,t)}removeFilter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;this.filterSupport.removeFilter(e,t)}setFilters(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;this.filterSupport.setFilters(e,t)}filter(){this.filterSupport.filter()}_filter(){let e=[],t=[];return this.nodes.forEach(s=>{let r=this.applyFiltersForNode(s,!1,this.filterAnimated);e.push(...r.newlyHidden),t.push(...r.newlyShown)}),{newlyHidden:e,newlyShown:t}}updateFilteredElements(e,t){!this.filteredElementsDirty||(t.textFilterText&&this.nodesByIds(Object.keys(this.nodesMap)).filter(s=>s.filterAccepted).forEach(s=>this._expandAllParentNodes(s)),e.newlyShown.forEach(s=>this._addToVisibleFlatList(s,this.filterAnimated)),e.newlyHidden.forEach(s=>this._removeFromFlatList(s,this.filterAnimated)),this.filteredElementsDirty=!1)}filterVisibleNodes(e){let t=[];for(let s=this.visibleNodesFlat.length-1;s>=0;s--){let r=this.visibleNodesFlat[s],n=this._applyFiltersForNodeRec(r,!0,e);n.newlyHidden.length&&(r.filterAccepted||t.push(...n.newlyHidden),this.viewRangeDirty=!0)}t.forEach(s=>this._removeFromFlatList(s,e)),this._nodesFiltered(t)}_nodesFiltered(e){this.deselectNodes(e)}applyFiltersForNode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=this._applyFiltersForNodeRec(e,!0,s),n=e.parentNode;for(;n;){let o=this._applyFiltersForNodeRec(n,!1,s);r.newlyHidden.unshift(...o.newlyHidden),r.newlyShown.unshift(...o.newlyShown),n=n.parentNode}return this._nodesFiltered(r.newlyHidden),t&&(r.newlyShown.forEach(o=>this._addToVisibleFlatList(o,s)),r.newlyHidden.forEach(o=>this._removeFromFlatList(o,s))),r}_applyFiltersForNodeRec(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=[],n=[];s=s&&this.filterAnimated;let o=this._applyFiltersForNode(e),l=!1;return e.level<32&&(t?e.childNodes.forEach(h=>{let d=this._applyFiltersForNodeRec(h,!0,s);r.push(...d.newlyHidden),n.push(...d.newlyShown),l=l||h.filterAccepted}):e.filterAccepted||(l=e.childNodes.some(h=>h.filterAccepted))),!e.filterAccepted&&l&&(e.setFilterAccepted(!0),o=!o),o&&((e.filterAccepted?n:r).unshift(e),this.rendered&&(this.viewRangeDirty=!0)),{newlyHidden:r,newlyShown:n}}_applyFiltersForNode(e){let t=this.filterSupport.applyFiltersForElement(e);return(t||e.filterDirty)&&(e.filterDirty=!1,e.childNodes.forEach(s=>{s.filterDirty=!0})),t}_createFilterSupport(){return new On({widget:this,$container:()=>this.$container,filterElements:this._filter.bind(this),getElementText:e=>e.text})}setTextFilterEnabled(e){this.setProperty("textFilterEnabled",e)}isTextFilterFieldVisible(){return this.textFilterEnabled}_renderTextFilterEnabled(){this.filterSupport.renderFilterField()}_insertNodesInDOM(e,t){!this.rendered&&!this.rendering||(e=e.filter(s=>{let r=t===void 0?this.visibleNodesFlat.indexOf(s):t;return r===-1||!(this.viewRangeRendered.from+this.viewRangeSize>=r&&this.viewRangeRendered.from<=r&&this.viewRangeSize>0)||s.attached?!1:(s.rendered||this._renderNode(s),s._decorate(),this._insertNodeInDOMAtPlace(s,r),this.prevSelectedNode===s&&this._highlightPrevSelectedNode(),s.rendered=!0,s.attached=!0,!0)}),this._installNodes(e))}_installNodes(e){this.isHorizontalScrollingEnabled()&&e.forEach(t=>{t.$node.css("width","auto"),t.$node.css("display","inline-block")}),e.forEach(t=>{if(t.height=t.$node.outerHeight(!0),!this.isHorizontalScrollingEnabled())return;let s=t.$node.outerWidth(),r=t.width?t.width:0;r===this.maxNodeWidth&&s<this.maxNodeWidth?(this.maxNodeWidth=0,this.nodeWidthDirty=!0):s>this.maxNodeWidth?(this.maxNodeWidth=s,this.nodeWidthDirty=!0):s===r&&s===0&&(this.nodeWidthDirty=!0),t.width=s}),this.isHorizontalScrollingEnabled()&&e.forEach(t=>{this.nodeWidthDirty||t.$node.css("width",this.maxNodeWidth),t.$node.css("display","")})}_ensureNodeInDOM(e,t,s){e&&!e.attached&&e===this.visibleNodesFlat[s]&&s>=this.viewRangeRendered.from&&s<this.viewRangeRendered.to&&this.showNode(e,t,s)}_insertNodeInDOMAtPlace(e,t){let s=e.$node;if(t===0){this.$fillBefore?s.insertAfter(this.$fillBefore):this.$data.prepend(s);return}let r=this.visibleNodesFlat[t-1];if(this._ensureNodeInDOM(r,!1,t-1),r.attached){s.insertAfter(r.$node);return}if(t+1<this.visibleNodesFlat.length){let n=this.visibleNodesFlat[t+1];if(n.attached){s.insertBefore(n.$node);return}}this.$fillBefore?s.insertAfter(this.$fillBefore):this.$data.prepend(s)}showNode(e,t,s){if(!this.rendered||e.attached&&!e.$node.hasClass("hiding")||(e.attached||(this._ensureNodeInDOM(e.parentNode,t,s-1),this._insertNodesInDOM([e],s)),!e.rendered))return;let r=e.$node;if(r.is(".showing"))return;r.removeClass("hiding");let n=this;t&&(r.addClass("showing"),r.hide(),r.stop(!1,!0).slideDown({duration:250,start:n.startAnimationFunc,complete:()=>{n.runningAnimationsFinishFunc(),r.removeClass("showing")}}))}hideNode(e,t,s){if(!this.rendered||!e.attached)return;this.viewRangeDirty=!0;let r=this,n=e.$node;!n||n.is(".hiding")||(n.removeClass("showing"),t?(n.addClass("hiding"),this._renderViewportBlocked=!0,n.stop(!1,!0).slideUp({duration:250,start:r.startAnimationFunc,complete:()=>{r.runningAnimationsFinishFunc(),n.removeClass("hiding"),n.hasClass("showing")||(n.css("display",""),n.detach(),e.attached=!1)}})):s||(n.detach(),e.attached=!1,r.invalidateLayoutTree()))}nodesToIds(e){return e.map(t=>t.id)}nodesByIds(e){return e.map(t=>this.nodesMap[t])}nodeById(e){return this.nodesMap[e]}hasNode(e){return Boolean(this.nodeById(e.id))}_onNodeDoubleClick(e){if(this.isBreadcrumbStyleActive())return;let t=a()(e.currentTarget),s=t.data("node"),r=!t.hasClass("expanded");this.doNodeAction(s,r)}doNodeAction(e,t){this.trigger("nodeAction",{node:e}),this.checkable===!0&&this.isTreeNodeCheckEnabled()&&e.enabled||this.setNodeExpanded(e,t,{lazy:!1})}_onNodeControlMouseDown(e){if(this._doubleClickSupport.mousedown(e),this._doubleClickSupport.doubleClicked())return!1;let t=a()(e.currentTarget).parent(),s=t.data("node"),r=!t.hasClass("expanded"),n={lazy:!1};if(t.hasClass("lazy"))if(e.ctrlKey||e.shiftKey)r=!1,n.collapseChildNodes=!0;else return this.expandNode(s,n),!1;return this.requestFocusOnNodeControlMouseDown&&this.focus(),this.selectNodes(s),this.setNodeExpanded(s,r,n),a().suppressEvent(e),!0}_onNodeControlMouseUp(e){return!1}_onNodeControlDoubleClick(e){return!1}_onContextMenu(e){e.preventDefault(),this._showContextMenu(e)}changeNode(e){this.applyFiltersForNode(e),this.rendered&&(e._decorate(),!!this.nodePaddingLevelDiffParentHasIcon&&!!this.visibleNodesMap[e.id]&&(e.expanded||!!e.parentNode)&&!this._changeNodeTaskScheduled&&(queueMicrotask(()=>{this._updateNodePaddingsLeft(),this._changeNodeTaskScheduled=!1}),this._changeNodeTaskScheduled=!0)),this.trigger("nodeChanged",{node:e})}_onDesktopPopupOpen(e){let t=e.popup;!this.isFocusable(!1)||this.has(t)&&t instanceof ft&&(this.$container.addClass("focused"),t.one("destroy",()=>{this.rendered&&this.$container.removeClass("focused")}))}updateScrollbars(){P.update(this.$data)}static collectSubtree(e,t){if(!e)return a()();let s=parseFloat(e.attr("data-level")),r=e.next();for(;r.length>0;){let o=parseFloat(r.attr("data-level"));if(isNaN(o)||o<=s)break;r=r.next()}let n=e.nextUntil(r);return(t===void 0||t)&&(n=n.add(e)),n}static visitNodes(e,t,s){let r,n;if(!!t)for(r=0;r<t.length;r++)n=t[r],!e(n,s)&&n.childNodes.length>0&&pe.visitNodes(e,n.childNodes,n)}}k(pe,"DisplayStyle",{DEFAULT:"default",BREADCRUMB:"breadcrumb"}),k(pe,"CheckableStyle",{CHECKBOX:"checkbox",CHECKBOX_TREE_NODE:"checkbox_tree_node"}),k(pe,"MenuTypes",{EmptySpace:"Tree.EmptySpace",SingleSelection:"Tree.SingleSelection",MultiSelection:"Tree.MultiSelection",Header:"Tree.Header"}),k(pe,"VIEW_RANGE_DIVISOR",4);class uo extends ke{constructor(){super(),this._addRemoteProperties(["displayStyle"])}_sendNodesSelected(e,t){let s={nodeIds:e};this._send("nodesSelected",s,{delay:t?250:0,coalesce:function(r){return this.target===r.target&&this.type===r.type}})}_onWidgetNodeClick(e){this._send("nodeClick",{nodeId:e.node.id})}_onWidgetNodeAction(e){this._send("nodeAction",{nodeId:e.node.id})}_onWidgetNodesSelected(e){let t=this.widget.nodesToIds(this.widget.selectedNodes);this._sendNodesSelected(t,e.debounce)}_onWidgetNodeExpanded(e){this._send("nodeExpanded",{nodeId:e.node.id,expanded:e.expanded,expandedLazy:e.expandedLazy})}_onWidgetNodesChecked(e){this._sendNodesChecked(e.nodes)}_sendNodesChecked(e){let t={nodes:[]};for(let s=0;s<e.length;s++)t.nodes.push({nodeId:e[s].id,checked:e[s].checked});this._send("nodesChecked",t)}_onWidgetEvent(e){e.type==="nodesSelected"?this._onWidgetNodesSelected(e):e.type==="nodeClick"?this._onWidgetNodeClick(e):e.type==="nodeAction"?this._onWidgetNodeAction(e):e.type==="nodeExpanded"?this._onWidgetNodeExpanded(e):e.type==="nodesChecked"?this._onWidgetNodesChecked(e):e.type==="drop"&&this.widget.dragAndDropHandler?this.widget.dragAndDropHandler.uploadFiles(e):super._onWidgetEvent(e)}onModelAction(e){e.type==="nodesInserted"?this._onNodesInserted(e.nodes,e.commonParentNodeId):e.type==="nodesUpdated"?this._onNodesUpdated(e.nodes):e.type==="nodesDeleted"?this._onNodesDeleted(e.nodeIds,e.commonParentNodeId):e.type==="allChildNodesDeleted"?this._onAllChildNodesDeleted(e.commonParentNodeId):e.type==="nodesSelected"?this._onNodesSelected(e.nodeIds):e.type==="nodeExpanded"?this._onNodeExpanded(e.nodeId,e):e.type==="nodeChanged"?this._onNodeChanged(e.nodeId,e):e.type==="nodesChecked"?this._onNodesChecked(e.nodes):e.type==="childNodeOrderChanged"?this._onChildNodeOrderChanged(e.childNodeIds,e.parentNodeId):e.type==="requestFocus"?this._onRequestFocus():e.type==="scrollToSelection"?this._onScrollToSelection():super.onModelAction(e)}_onNodesInserted(e,t){let s;if(t!=null&&(s=this.widget.nodesMap[t],!s))throw new Error("Parent node could not be found. Id: "+t);this.widget.insertNodes(e,s)}_onNodesUpdated(e){this.widget.updateNodes(e)}_onNodesDeleted(e,t){let s;if(t!=null&&(s=this.widget.nodesMap[t],!s))throw new Error("Parent node could not be found. Id: "+t);this.addFilterForWidgetEventType("nodesSelected"),this.addFilterForWidgetEventType("nodesChecked");let r=this.widget.nodesByIds(e);this.widget.deleteNodes(r,s)}_onAllChildNodesDeleted(e){let t;if(e!=null&&(t=this.widget.nodesMap[e],!t))throw new Error("Parent node could not be found. Id: "+e);this.addFilterForWidgetEventType("nodesSelected"),this.addFilterForWidgetEventType("nodesChecked"),this.widget.deleteAllChildNodes(t)}_onNodesSelected(e){this.addFilterForWidgetEvent(s=>s.type==="nodesSelected"&&p.equals(e,this.widget.nodesToIds(this.widget.selectedNodes)));let t=this.widget.nodesByIds(e);this.widget.selectNodes(t)}_onNodeExpanded(e,t){let s=this.widget.nodesMap[e],r={lazy:t.expandedLazy},n=b.createMap();n[e]=!0,t.recursive&&pe.visitNodes(o=>{n[o.id]=!0},s.childNodes),this.addFilterForWidgetEvent(o=>o.type==="nodeExpanded"&&n[o.node.id]&&t.expanded===o.expanded&&t.expandedLazy===o.expandedLazy),this.widget.setNodeExpanded(s,t.expanded,r),t.recursive&&this.widget.setNodeExpandedRecursive(s.childNodes,t.expanded,r)}_onNodeChanged(e,t){let s=this.widget.nodesMap[e];Ne.applyTo(t,"TreeNode"),s.text=t.text,s.cssClass=t.cssClass,s.iconId=t.iconId,s.tooltipText=t.tooltipText,s.foregroundColor=t.foregroundColor,s.backgroundColor=t.backgroundColor,s.font=t.font,s.htmlEnabled=t.htmlEnabled,this.widget.changeNode(s)}_onNodesChecked(e){let t=[],s=[];e.forEach(r=>{let n=this.widget.nodeById(r.id);r.checked?t.push(n):s.push(n)}),this.addFilterForWidgetEventType("nodesChecked"),this.widget.checkNodes(t,{checked:!0,checkChildren:!1,checkOnlyEnabled:!1}),this.widget.uncheckNodes(s,{checkChildren:!1,checkOnlyEnabled:!1})}_onChildNodeOrderChanged(e,t){let s=this.widget.nodeById(t),r=this.widget.nodesByIds(e);this.widget.updateNodeOrder(r,s)}_onRequestFocus(){this.widget.focus()}_onScrollToSelection(){this.widget.revealSelection()}_initNodeModel(e){return e=e||{},e.objectType=u.nvl(e.objectType,this._getDefaultNodeObjectType()),Ne.applyTo(e),e}_getDefaultNodeObjectType(){return"TreeNode"}static _createTreeNodeRemote(e){return this.modelAdapter&&(e=this.modelAdapter._initNodeModel(e)),this._createTreeNodeOrig(e)}static modifyTreePrototype(){!te.get().remote||b.replacePrototypeFunction(pe,"_createTreeNode",uo._createTreeNodeRemote,!0)}}te.addListener("bootstrap",uo.modifyTreePrototype);function be(i,e,t){return e=rF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function rF(i){var e=nF(i,"string");return typeof e=="symbol"?e:String(e)}function nF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ir{constructor(){be(this,"objectType",void 0),be(this,"checked",void 0),be(this,"childNodes",void 0),be(this,"cssClass",void 0),be(this,"enabled",void 0),be(this,"expanded",void 0),be(this,"expandedLazy",void 0),be(this,"htmlEnabled",void 0),be(this,"iconId",void 0),be(this,"id",void 0),be(this,"initialExpanded",void 0),be(this,"lazyExpandingEnabled",void 0),be(this,"leaf",void 0),be(this,"level",void 0),be(this,"parent",void 0),be(this,"parentNode",void 0),be(this,"session",void 0),be(this,"text",void 0),be(this,"tooltipText",void 0),be(this,"foregroundColor",void 0),be(this,"backgroundColor",void 0),be(this,"font",void 0),be(this,"initialized",void 0),be(this,"rendered",void 0),be(this,"attached",void 0),be(this,"destroyed",void 0),be(this,"filterAccepted",void 0),be(this,"filterDirty",void 0),be(this,"childrenLoaded",void 0),be(this,"childrenChecked",void 0),be(this,"height",void 0),be(this,"width",void 0),be(this,"displayBackup",void 0),be(this,"prevSelectionAnimationDone",void 0),be(this,"$node",void 0),be(this,"$text",void 0),be(this,"childNodeIndex",void 0),be(this,"_loadChildrenPromise",void 0),this.$node=null,this.$text=null,this.attached=!1,this.checked=!1,this.childNodes=[],this.childrenLoaded=!1,this.childrenChecked=!1,this.cssClass=null,this.destroyed=!1,this.enabled=!0,this.expanded=!1,this.expandedLazy=!1,this.filterAccepted=!0,this.filterDirty=!1,this.htmlEnabled=!1,this.iconId=null,this.id=null,this.initialized=!1,this.initialExpanded=!1,this.lazyExpandingEnabled=!1,this.leaf=!1,this.level=0,this.parent=null,this.parentNode=void 0,this.prevSelectionAnimationDone=!1,this.rendered=!1,this.session=null,this.text=null,this._loadChildrenPromise=null}init(e){let t=this._jsonModel();t&&(e=a().extend({},t,e)),this._init(e),e.initialExpanded===void 0&&(this.initialExpanded=this.expanded)}destroy(){this.destroyed||(this._destroy(),this.destroyed=!0)}_destroy(){}getTree(){return this.parent}_init(e){u.assertParameter("parent",e.parent,pe),this.session=e.session||e.parent.session,a().extend(this,e),Ce.resolveTextProperty(this,"text"),ye.resolveIconProperty(this,"iconId"),this.hasChildNodes()&&this.getTree().ensureTreeNodes(this.childNodes)}_jsonModel(){return null}reset(){this.$node&&(this.$node.remove(),this.$node=null),this.rendered=!1,this.attached=!1}hasChildNodes(){return this.childNodes.length>0}isAncestorOf(e){for(;e;){if(e.parentNode===this)return!0;e=e.parentNode}return!1}isDescendantOf(e){return e===this.parentNode?!0:this.parentNode?this.parentNode.isDescendantOf(e):!1}setFilterAccepted(e){this.filterAccepted=e}loadChildren(){return a().resolvedPromise()}ensureLoadChildren(){if(this.childrenLoaded)return a().resolvedPromise();if(this._loadChildrenPromise)return this._loadChildrenPromise;let e=this.loadChildren();return e.state()==="resolved"?(this._loadChildrenPromise=null,e):(this._loadChildrenPromise=e,e.done(this._onLoadChildrenDone.bind(this)),e)}_onLoadChildrenDone(){this._loadChildrenPromise=null}setText(e){this.text=e}render(e,t){this.$node=e.makeDiv("tree-node").data("node",this).attr("data-nodeid",this.id).attr("data-level",this.level),b.isNullOrUndefined(t)||this.$node.cssPaddingLeft(t),this.$text=this.$node.appendSpan("text"),this._renderControl(),this.getTree().checkable&&this._renderCheckbox(),this._renderText(),this._renderIcon()}_renderText(){this.htmlEnabled?this.$text.html(this.text):this.$text.textOrNbsp(this.text)}_renderChecked(){!this.rendered||this.$node.children(".tree-node-checkbox").children(".check-box").toggleClass("checked",this.checked)}_renderIcon(){this.$node.toggleClass("has-icon",!!this.iconId),this.$node.icon(this.iconId,e=>e.insertBefore(this.$text))}$icon(){return this.$node.children(".icon")}_renderControl(){let e=this.$node.prependDiv("tree-node-control");this._updateControl(e)}_updateControl(e){let t=this.getTree();e.toggleClass("checkable",t.checkable),e.cssPaddingLeft(t._computeNodeControlPaddingLeft(this)),e.setVisible(!this.leaf)}_renderCheckbox(){this.$node.prependDiv("tree-node-checkbox").appendDiv("check-box").toggleClass("checked",this.checked).toggleClass("disabled",!this.enabled).toggleClass("children-checked",!!this.childrenChecked)}_decorate(){if(!this.$node)return;let e=this.$node,t=this.getTree();e.attr("class",this._preserveCssClasses(e)),e.addClass(this.cssClass),e.toggleClass("leaf",!!this.leaf),e.toggleClass("expanded",!!this.expanded&&this.childNodes.length>0),e.toggleClass("lazy",e.hasClass("expanded")&&this.expandedLazy),e.toggleClass("group",!!t.groupedNodes[this.id]),e.setEnabled(!!this.enabled),e.children(".tree-node-control").setVisible(!this.leaf),e.children(".tree-node-checkbox").children(".check-box").toggleClass("disabled",!this.enabled),(!this.parentNode&&t.selectedNodes.length===0||t.isChildOfSelectedNodes(this))&&e.addClass("child-of-selected"),this._renderText(),this._renderIcon(),M.legacyStyle(this._getStyles(),e),this.parentNode&&this.parentNode.expandedLazy&&!this.parentNode.childNodes.some(r=>!!t.visibleNodesMap[r.id])&&this.parentNode.$node&&this.parentNode.$node.removeClass("lazy")}_getStyles(){return this}_preserveCssClasses(e){let t="tree-node";return e.isSelected()&&(t+=" selected"),e.hasClass("ancestor-of-selected")&&(t+=" ancestor-of-selected"),e.hasClass("parent-of-selected")&&(t+=" parent-of-selected"),t}}function xg(i,e,t){return e=oF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function oF(i){var e=lF(i,"string");return typeof e=="symbol"?e:String(e)}function lF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class pl extends ee{constructor(e){super(),xg(this,"tree",void 0),xg(this,"nodeDimensionsDirty",void 0),this.tree=e,this.nodeDimensionsDirty=!1}layout(e){this._layout(e),P.update(this.tree.$data)}_layout(e){let t=this.tree.menuBar,s=t.htmlComp,r=this.tree.htmlComp,n=r.availableSize({exact:!0}).subtract(r.insets());this.tree.toggleBreadcrumbStyleEnabled&&this._sizeChanged(r)&&this.tree.setBreadcrumbStyleActive(Math.floor(n.width)<=this.tree.breadcrumbTogglingThreshold);let o=0,l;t.$container.isVisible()&&(l=er.size(s,n),s.setSize(l),o+=l.height),e.css("--menubar-height",((l||{}).height||0)+"px"),this._setDataHeight(o),this.tree.setViewRangeSize(this.tree.calculateViewRangeSize()),this.nodeDimensionsDirty=this.nodeDimensionsDirty||this._sizeChanged(r),this.nodeDimensionsDirty&&(this.nodeDimensionsDirty=!1,this.tree.isHorizontalScrollingEnabled()?(this.tree.nodeWidthDirty=!0,this.tree.maxNodeWidth=0):(this.tree.updateNodeHeights(),this.tree._renderViewport(),this.tree._renderFiller())),r.layouted||this.tree._renderScrollTop(),this.tree._renderViewport(),r.layouted||this.tree._renderScrollTop()}_sizeChanged(e){return e.sizeCached&&Math.ceil(e.sizeCached.width)!==Math.ceil(e.size().width)}_setDataHeight(e){let t=this.tree.$data;e+=t.cssMarginTop()+t.cssMarginBottom(),t.css("height",e===0?"100%":"calc(100% - "+e+"px)")}preferredLayoutSize(e,t){return this.tree._renderViewport(),this.tree.htmlComp.layouted||(this.nodeDimensionsDirty=!0),v.prefSize(e,t)}}function aF(i,e,t){return e=hF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function hF(i){var e=dF(i,"string");return typeof e=="symbol"?e:String(e)}function dF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ac{constructor(e){aF(this,"tree",void 0),this.tree=e}accept(e){if(e.expanded||(e.childNodes.forEach(t=>{t._lazyNodeFilterAccepted=!1}),!e.parentNode||!e.parentNode.expandedLazy||!e.parentNode.lazyExpandingEnabled||!this.tree.lazyExpandingEnabled))return!0;for(let t=0;t<this.tree.selectedNodes.length;t++){let s=this.tree.selectedNodes[t];if(typeof s=="string")break;if(s===e)return e._lazyNodeFilterAccepted=!0,!0}return!!e._lazyNodeFilterAccepted}}function uF(i,e,t){return e=cF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function cF(i){var e=pF(i,"string");return typeof e=="symbol"?e:String(e)}function pF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class hc{constructor(e){uF(this,"tree",void 0),this.tree=e}accept(e){return this.tree.selectedNodes.length===0?e.parentNode===void 0:this.tree.isNodeInBreadcrumbVisible(e)}}class sr extends O{constructor(e,t){super(),this.field=e,this.repeatable=!0,this.stopPropagation=!0,this.renderingHints.hAlign=ht.RIGHT,this.ctrl=Te.isCtrl(t),this.shift=Te.isShift(t),this.alt=Te.isAlt(t),this.keyStrokeMode=O.Mode.DOWN,this.inheritAccessibility=!1}_accept(e){return super._accept(e)?(this.field.selectedNodes.length>0&&(e._treeCurrentNode=this.field.selectedNodes[0],e._$treeCurrentNode=e._treeCurrentNode.$node),this.field.$container.addClass("keyboard-navigation"),!0):!1}handle(e){let t=this._computeNewSelection(e._treeCurrentNode);t&&this.selectNodesAndReveal(t,!0)}_computeNewSelection(e){return[]}selectNodesAndReveal(e,t){this.field.selectNodes(e,t),this.field.revealSelection(),this.field.isFocused()||this.field.focus()}}class dc extends O{constructor(e){super(),this.field=e,this.which=[g.SPACE],this.renderingHints.render=!1}_accept(e){return super._accept(e)&&this.field.checkable&&this.field.selectedNodes.length>0}handle(e){let t=this.field.selectedNodes.filter(r=>r.enabled),s=t.some(r=>!r.checked);t.forEach(r=>this.field.checkNode(r,s))}}class Ka extends sr{constructor(e,t){super(e,t),this.which=[g.UP],this.renderingHints.text="",this.renderingHints.$drawingArea=(s,r)=>{let n=this._computeNewSelection(r._treeCurrentNode);if(n)return n.$node}}_computeNewSelection(e){let t=this.field.visibleNodesFlat;if(t.length!==0)return e?t[t.indexOf(e)-1]:p.last(t)}}class Ga extends sr{constructor(e,t){super(e,t),this.which=[g.DOWN],this.renderingHints.text="",this.renderingHints.$drawingArea=(s,r)=>{let n=this._computeNewSelection(r._treeCurrentNode);if(n)return n.$node}}_computeNewSelection(e){let t=this.field.visibleNodesFlat;if(t.length!==0)return e?t[t.indexOf(e)+1]:t[0]}}class Ua extends sr{constructor(e,t){super(e,t),this.which=[g.END],this.renderingHints.$drawingArea=(s,r)=>{let n=this._computeNewSelection(r._treeCurrentNode);if(n)return n.$node}}handle(e){let t=this._computeNewSelection(e._treeCurrentNode);t&&this.selectNodesAndReveal(t)}_computeNewSelection(e){let t=this.field.visibleNodesFlat;if(t.length!==0)return p.last(t)}}class uc extends sr{constructor(e,t){super(e,t),this.which=[g.HOME],this.renderingHints.hAlign=ht.RIGHT,this.renderingHints.$drawingArea=(s,r)=>{if(this.field.visibleNodesFlat.length>0)return this.field.visibleNodesFlat[0].$node}}handle(e){this.field.collapseAll(),this.field.visibleNodesFlat.length>0&&this.selectNodesAndReveal(this.field.visibleNodesFlat[0])}}class qa extends sr{constructor(e,t){super(e,t),this.which=[g.SUBTRACT],this.renderingHints.text="-",this.renderingHints.$drawingArea=(s,r)=>{let n=r._treeCurrentNode;if(n.expanded)return n.$node;if(n.parentNode)return n.parentNode.$node}}_accept(e){let t=super._accept(e),s=e._treeCurrentNode;return t&&!!s&&(s.expanded||!!s.parentNode)}handle(e){let t=e._treeCurrentNode;t.expanded?this.field.collapseNode(t):t.parentNode&&this.selectNodesAndReveal(t.parentNode,!0)}}class Ya extends sr{constructor(e,t){super(e,t),this.which=[g.ADD],this.renderingHints.text="+",this.renderingHints.$drawingArea=(s,r)=>{let n=r._treeCurrentNode;if(this.isNodeExpandable(n))return n.$node;if(n.childNodes.length>0)return n.childNodes[0].$node}}_accept(e){let t=super._accept(e),s=e._treeCurrentNode;return t&&s&&(this.isNodeExpandable(s)||s.childNodes.length>0)}isNodeExpandable(e){return!e.expanded&&!e.leaf}handle(e){let t=e._treeCurrentNode;if(this.isNodeExpandable(t))this.field.expandNode(t,{lazy:!1});else{let s=t.childNodes.filter(function(r){return this.field.visibleNodesFlat.indexOf(r)>-1},this);s.length>0&&this.selectNodesAndReveal(s[0],!0)}}}function fF(i,e,t){return e=mF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function mF(i){var e=gF(i,"string");return typeof e=="symbol"?e:String(e)}function gF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Eg extends pe{constructor(){super(),fF(this,"$nodesContainer",void 0),this._scrollDirections="y"}_initTreeKeyStrokeContext(){this.keyStrokeContext.registerKeyStrokes([new pc(this),new fc(this),new mc(this),new gc(this)])}_createTreeNode(e){return e=u.nvl(e,{}),e.parent=this,u.create(cc,e)}_render(){this.$container=this.$parent.appendDiv("compact-tree");let e=new pl(this);this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(e),this.$data=this.$container.appendDiv("tree-data"),this._installScrollbars({borderless:!0}),this.menuBar=u.create(ce,{parent:this,menuOrder:new io(this.session,"Tree")}),this.menuBar.render(),this.$nodesContainer=this.$data.appendDiv("nodes"),this._updateNodeDimensions(),this._renderViewport(),this.invalidateLayoutTree()}_calculateCurrentViewRange(){return this.viewRangeSize=this.visibleNodesFlat.length,new B(0,Math.max(this.visibleNodesFlat.length,0))}calculateViewRangeSize(){return this.visibleNodesFlat.length}_insertNodeInDOMAtPlace(e,t){let s=this.visibleNodesFlat[t-1],r;if(!s)e.$node.prependTo(this.$nodesContainer);else if(s.level<e.level)e.$node.insertAfter(s.$node.children()[0]);else{r=s.$node;for(let n=0;n<s.level-e.level;n++)r=r.parent();e.$node.insertAfter(r)}}selectNodes(e,t){let s=[];e=p.ensure(e),e.forEach(r=>{r.isSection()?r.childNodes.length>0&&s.push(r.childNodes[0]):s.push(r)}),super.selectNodes(s,t)}_renderExpansion(e,t){}_updateItemPath(e,t){}}class cc extends ir{render(e,t){let s=this.getTree();if(this.isSection()){let r=s.$container.makeDiv("section expanded").data("node",this);r.appendDiv("title").text(this.text),this.$node=r}else{let r=this.parentNode.$node;this.$node=r.makeDiv("section-node").data("node",this).on("mousedown",s._onNodeMouseDown.bind(s)).on("mouseup",s._onNodeMouseUp.bind(s))}}_decorate(){if(!this.$node)return;let e,t=this.$node;t.hasClass("section")?(t=t.children("title"),e="title"):(e="section-node",t.isSelected()&&(e+=" selected")),t.removeClass(),t.addClass(e),t.addClass(this.cssClass),t.text(this.text),M.legacyStyle(this,t),y.hasText(this.tooltipText)&&t.attr("title",this.tooltipText)}isSection(){return this.level===0}}class co extends O{constructor(e){super(),this.repeatable=!0,this.field=e,this.keyStrokeMode=O.Mode.DOWN}_accept(e){if(!super._accept(e)||!this.field.nodes||!this.field.nodes.length)return!1;let s=this.field.$nodesContainer.find(".section-node.selected"),r=s.data("node"),n=this._findNextNode(s,r);return n?(e._nextNode=n,!0):!1}handle(e){this.field.selectNodes(e._nextNode),this.field.checkNode(e._nextNode,!0)}_findNextNode(e,t){throw new Error("method must be overwritten by subclass")}}class pc extends co{constructor(e){super(e),this.which=[g.UP],this.renderingHints.text=""}_findNextNode(e,t){return t?e.prev(".section-node").data("node")||e.parent().prev(".section").children(".section-node").last().data("node"):p.last(p.last(this.field.nodes).childNodes)}}class fc extends co{constructor(e){super(e),this.which=[g.DOWN],this.renderingHints.text=""}_findNextNode(e,t){return t?e.next(".section-node").data("node")||e.parent().next(".section").children(".section-node").first().data("node"):p.first(p.first(this.field.nodes).childNodes)}}class mc extends co{constructor(e){super(e),this.renderingHints.text="",this.which=[g.LEFT]}_findNextNode(e,t){return e.parent().prev(".section").children(".section-node").first().data("node")||e.parent().children(".section-node").not(e).first().data("node")}}class gc extends co{constructor(e){super(e),this.renderingHints.text="",this.which=[g.RIGHT]}_findNextNode(e,t){return e.parent().next(".section").children(".section-node").first().data("node")}}function _F(i,e){let t=i.is("div");if(arguments.length===2)t?i.text(e):i.val(e);else return t?i.text():i.val()}const Z={makeTextField(i,e){return i.makeElement("<input>",e).attr("type","text").attr("autocomplete","NoAutocomplete").disableSpellcheck()},appendIcon(i,e){let t=i.appendSpan("icon unfocusable text-field-icon");return e&&t.addClass(e),t},initTouch(i,e){i.embedded=u.nvl(e.embedded,!1),i.touchMode=u.nvl(e.touchMode,x.get().supportsOnlyTouch())},valOrText:_F,makeInputOrDiv(i,e){return i.touchMode?Z.makeInputDiv(i,e):Z.makeTextField(i.$container,e)},makeInputDiv(i,e){return i.$container.makeDiv(y.join(" ","input-field",e))},handleOnClick(i){return i.enabledComputed&&!i.embedded&&!i.popup},activateFirstField(i,e){let t=Le.findFirstFocusableWidget(e,i);t&&t.activate()},linkElementWithLabel(i,e){let t=e.attr("id");t||(t=Le.createUniqueId("lbl"),e.attr("id",t));let s=i.attr("aria-labelledby")||"";s&&(t+=" "+s),i.attr("aria-labelledby",t)},eventOutsideProposalField(i,e){let t=n(i.$field,e)||n(i.$icon,e)||n(i.$clearIcon,e),s=o(i.popup,e),r=o(i.tooltip(),e);return!t&&!s&&!r;function n(l,h){return l&&l.isOrHas(h)}function o(l,h){return l&&l.rendered&&l.$container.isOrHas(h)}},selectAllParentTabsOf(i){!i||!(i instanceof A)||i.visitParentFields(Z.selectIfIsTab)},selectIfIsTab(i){!i||!(i instanceof wp)||i.select()},adjustStatusPositionForScrollShadow(i,e){i.htmlComp&&(i.htmlComp.suppressInvalidate=!0),e()?Le.preserveAndSetProperty(()=>i.setStatusPosition(A.StatusPosition.TOP),()=>i.statusPosition,i,"_statusPositionOrig"):Le.resetProperty(t=>i.setStatusPosition(t),i,"_statusPositionOrig"),i.htmlComp&&(i.htmlComp.suppressInvalidate=!1)}};function yF(i,e,t){return e=bF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function bF(i){var e=vF(i,"string");return typeof e=="symbol"?e:String(e)}function vF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class po extends O{constructor(e,t){super(),yF(this,"appLinkTriggerFunction",void 0),this.field=e,this.appLinkTriggerFunction=t,this.which=[g.SPACE],this.renderingHints.render=!1}_accept(e){return super._accept(e)&&a()(e.target).hasClass("app-link")}handle(e){this.appLinkTriggerFunction.call(this.field,e)}}function zs(i,e,t){return e=wF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function wF(i){var e=TF(i,"string");return typeof e=="symbol"?e:String(e)}function TF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ja extends I{constructor(){super(),zs(this,"autoRemove",void 0),zs(this,"status",void 0),zs(this,"position",void 0),zs(this,"menus",void 0),zs(this,"tooltip",void 0),zs(this,"contextMenu",void 0),zs(this,"updating",void 0),zs(this,"_parents",void 0),zs(this,"_parentPropertyChangeListener",void 0),zs(this,"_parentHierarchyChangeListener",void 0),this.tooltip=null,this.contextMenu=null,this.status=null,this.updating=!1,this.autoRemove=!0,this.position=A.StatusPosition.DEFAULT,this._parents=[],this._parentPropertyChangeListener=this._onParentPropertyChange.bind(this),this._parentHierarchyChangeListener=this._onParentHierarchyChange.bind(this)}_render(){this.$container=this.$parent.appendSpan("status").on("mousedown",this._onStatusMouseDown.bind(this)),this.htmlComp=T.install(this.$container,this.session)}_remove(){super._remove(),this.tooltip&&(this.tooltip.destroy(),this.tooltip=null),this.contextMenu&&(this.contextMenu.destroy(),this.contextMenu=null),this._removeParentListeners()}_renderProperties(){super._renderProperties(),this._renderPosition()}update(e,t,s,r){this.updating=!0,this.setStatus(e),this.setMenus(t),this.setAutoRemove(s),this.updating=!1,this._updatePopup(r)}clearStatus(){this.setStatus(null)}setStatus(e){this.setProperty("status",e)}_setStatus(e){e=E.ensure(e),this._setProperty("status",e)}_renderStatus(){this.updating||this._updatePopup()}setPosition(e){this.setProperty("position",e)}_renderPosition(){this.$container.toggleClass("top",this.position===A.StatusPosition.TOP),this.invalidateLayoutTree()}_renderVisible(){super._renderVisible(),this.visible||this.hidePopup()}setMenus(e){this.setProperty("menus",p.ensure(e))}_renderMenus(){this.updating||this._updatePopup()}setAutoRemove(e){this.setProperty("autoRemove",e)}_renderAutoRemove(){this.updating||this._updatePopup()}hideTooltip(){this.tooltip&&(this.trigger("hideTooltip").defaultPrevented||(this.tooltip.destroy(),this._removeParentListeners()))}_updatePopup(e){this._requiresTooltip()||this.hideTooltip(),p.empty(this.menus)&&this.hideContextMenu(),e===!0?this.showTooltip():e===!1&&this.hideTooltip()}_requiresTooltip(){return!(!this.status||!this.rendered||p.empty(this.menus)&&!y.hasText(this.status.message))}showTooltip(){!this._requiresTooltip()||this.trigger("showTooltip").defaultPrevented||(this._updateParentListeners(),this.hideContextMenu(),this.tooltip&&this.tooltip.autoRemove!==this.autoRemove&&this.hideTooltip(),this.tooltip?(this.tooltip.setText(this.status.message),this.tooltip.setSeverity(this.status.severity),this.tooltip.setMenus(this.menus)):(this.tooltip=u.create(ls,{parent:this,$anchor:this.$container,text:this.status.message,severity:this.status.severity,autoRemove:this.autoRemove,menus:this.menus}),this.tooltip.render(),this.$container.addClass("selected"),this.tooltip.one("destroy",()=>{this.tooltip=null,this.$container&&this.$container.removeClass("selected")})))}hideContextMenu(){this.contextMenu&&this.contextMenu.close()}showContextMenu(){p.empty(this.menus)||(this.hidePopup(),this.contextMenu&&this.contextMenu.isRemovalPending()&&this.contextMenu.removeImmediately(),this.contextMenu=u.create(ft,{parent:this,$anchor:this.$container,menuItems:this.menus,cloneMenuItems:!1,closeOnAnchorMouseDown:!1}),this.contextMenu.open(),this.$container.addClass("selected"),this.contextMenu.one("destroy",()=>{this.contextMenu=null,this.$container&&this.$container.removeClass("selected")}))}hidePopup(){this.hideTooltip(),this.hideContextMenu()}togglePopup(){if(this.status){this.hideContextMenu(),this.toggleTooltip();return}p.empty(this.menus)?this.hidePopup():(this.hideTooltip(),this.session.onRequestsDone(()=>{!this.rendered||this.toggleContextMenu()}))}toggleTooltip(){this.tooltip?this.hideTooltip():this.showTooltip()}toggleContextMenu(){this.contextMenu?this.hideContextMenu():this.showContextMenu()}_onStatusMouseDown(e){this.trigger("statusMouseDown",e).defaultPrevented||this.togglePopup()}_updateTooltipVisibility(e){this.isEveryParentVisible()?setTimeout(()=>{!this.rendered||!this.isEveryParentVisible()||this.tooltip&&!this.tooltip.rendered&&this.tooltip.render()}):this.tooltip&&this.tooltip.rendered&&this.tooltip.remove()}_onParentHierarchyChange(e){this._updateParentListeners()}_onParentPropertyChange(e){e.propertyName==="visible"&&this._updateTooltipVisibility(e.source)}_removeParentListeners(){this._parents.forEach(e=>{e.off("hierarchyChange",this._parentHierarchyChangeListener),e.off("propertyChange",this._parentPropertyChangeListener)}),this._parents=[]}_updateParentListeners(){this._removeParentListeners();let e=this.parent;for(;e;)e.on("hierarchyChange",this._parentHierarchyChangeListener),e.on("propertyChange",this._parentPropertyChangeListener),this._parents.push(e),e=e.parent}}function z(i,e,t){return e=CF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function CF(i){var e=SF(i,"string");return typeof e=="symbol"?e:String(e)}function SF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class A extends I{constructor(){super(),z(this,"dropType",void 0),z(this,"dropMaximumSize",void 0),z(this,"empty",void 0),z(this,"errorStatus",void 0),z(this,"fieldStyle",void 0),z(this,"gridData",void 0),z(this,"gridDataHints",void 0),z(this,"mode",void 0),z(this,"fieldStatus",void 0),z(this,"keyStrokes",void 0),z(this,"displayText",void 0),z(this,"label",void 0),z(this,"labelVisible",void 0),z(this,"labelPosition",void 0),z(this,"labelWidthInPixel",void 0),z(this,"labelUseUiWidth",void 0),z(this,"labelHtmlEnabled",void 0),z(this,"mandatory",void 0),z(this,"statusMenuMappings",void 0),z(this,"menus",void 0),z(this,"menusVisible",void 0),z(this,"defaultMenuTypes",void 0),z(this,"preventInitialFocus",void 0),z(this,"requiresSave",void 0),z(this,"statusPosition",void 0),z(this,"statusVisible",void 0),z(this,"suppressStatus",void 0),z(this,"touched",void 0),z(this,"tooltipText",void 0),z(this,"font",void 0),z(this,"foregroundColor",void 0),z(this,"backgroundColor",void 0),z(this,"labelFont",void 0),z(this,"labelForegroundColor",void 0),z(this,"labelBackgroundColor",void 0),z(this,"tooltipAnchor",void 0),z(this,"onFieldTooltipOptionsCreator",void 0),z(this,"dragAndDropHandler",void 0),z(this,"disabledCopyOverlay",void 0),z(this,"$label",void 0),z(this,"$field",void 0),z(this,"$clearIcon",void 0),z(this,"$fieldContainer",void 0),z(this,"$icon",void 0),z(this,"$pseudoStatus",void 0),z(this,"$status",void 0),z(this,"$mandatory",void 0),z(this,"$disabledCopyOverlay",void 0),z(this,"_menuPropertyChangeHandler",void 0),this.dropType=0,this.dropMaximumSize=Fe.DEFAULT_DROP_MAXIMUM_SIZE,this.empty=!0,this.errorStatus=null,this.fieldStyle=A.DEFAULT_FIELD_STYLE,this.gridData=null,this.gridDataHints=new ze,this.mode=A.Mode.DEFAULT,this.keyStrokes=[],this.label=null,this.labelVisible=!0,this.labelPosition=A.LabelPosition.DEFAULT,this.labelWidthInPixel=0,this.labelUseUiWidth=!1,this.labelHtmlEnabled=!1,this.mandatory=!1,this.statusMenuMappings=[],this.menus=[],this.menusVisible=!0,this.defaultMenuTypes=[],this.preventInitialFocus=!1,this.requiresSave=!1,this.statusPosition=A.StatusPosition.DEFAULT,this.statusVisible=!0,this.suppressStatus=null,this.touched=!1,this.tooltipText=null,this.tooltipAnchor=A.TooltipAnchor.DEFAULT,this.onFieldTooltipOptionsCreator=null,this.$label=null,this.$field=null,this.$fieldContainer=null,this.$icon=null,this.$status=null,this.disabledCopyOverlay=!1,this.$disabledCopyOverlay=null,this._addWidgetProperties(["keyStrokes","menus","statusMenuMappings"]),this._addCloneProperties(["dropType","dropMaximumSize","errorStatus","fieldStyle","gridDataHints","gridData","label","labelVisible","labelPosition","labelWidthInPixel","labelUseUiWidth","mandatory","mode","preventInitialFocus","requiresSave","touched","statusVisible","statusPosition","statusMenuMappings","tooltipText","tooltipAnchor"]),this._menuPropertyChangeHandler=this._onMenuPropertyChange.bind(this)}_createKeyStrokeContext(){return new Oe}_createLoadingSupport(){return new ss({widget:this})}_init(e){super._init(e),this.resolveConsts([{property:"labelPosition",constType:A.LabelPosition}]),this.resolveTextKeys(["label","tooltipText"]),this._setKeyStrokes(this.keyStrokes),this._setMenus(this.menus),this._setErrorStatus(this.errorStatus),this._setGridDataHints(this.gridDataHints),this._setGridData(this.gridData),this._updateEmpty()}_initProperty(e,t){e==="gridDataHints"?this._initGridDataHints(t):super._initProperty(e,t)}_initGridDataHints(e){e instanceof ze?this.gridDataHints=e:b.isPlainObject(e)?a().extend(this.gridDataHints,e):this.gridDataHints=e}_render(){this.addContainer(this.$parent),this.addLabel(),this.addField(this.$parent.makeDiv()),this.addMandatoryIndicator(),this.addStatus()}_renderProperties(){super._renderProperties(),this._renderMandatory(),this._renderTooltipText(),this._renderErrorStatus(),this._renderMenus(),this._renderLabel(),this._renderLabelVisible(),this._renderStatusVisible(),this._renderStatusPosition(),this._renderFont(),this._renderForegroundColor(),this._renderBackgroundColor(),this._renderLabelFont(),this._renderLabelForegroundColor(),this._renderLabelBackgroundColor(),this._renderGridData(),this._renderPreventInitialFocus(),this._renderFieldStyle()}_remove(){super._remove(),this._removeField(),this._removeStatus(),this._removeLabel(),this._removeIcon(),this.removeMandatoryIndicator(),this._removeDisabledCopyOverlay(),Fe.uninstallDragAndDropHandler(this)}setFieldStyle(e){this.setProperty("fieldStyle",e)}_renderFieldStyle(){if(this._renderFieldStyleInternal(this.$container),this._renderFieldStyleInternal(this.$fieldContainer),this._renderFieldStyleInternal(this.$field),this.rendered){let e=this.htmlComp.getParent();e&&e.invalidateLayoutTree(),this.invalidateLayoutTree()}}_renderFieldStyleInternal(e){!e||e.toggleClass("alternative",this.fieldStyle===A.FieldStyle.ALTERNATIVE)}setMandatory(e){this.setProperty("mandatory",e)}_renderMandatory(){this.$container.toggleClass("mandatory",this.mandatory)}_errorStatus(){return this.errorStatus}setErrorStatus(e){this.setProperty("errorStatus",e)}_setErrorStatus(e){e=E.ensure(e),this._setProperty("errorStatus",e)}addErrorStatus(e){if(typeof e=="string"&&(e=this._createErrorStatus(e)),!(e instanceof E))throw new Error("errorStatus is not a Status");let t=this._errorStatus();t?t=t.ensureChildren():t=E.ok("Root"),t.addStatus(e),this.setErrorStatus(t)}_createErrorStatus(e){return E.error(e)}containsStatus(e){return this.errorStatus?this.errorStatus.containsStatus(e):!1}setSuppressStatus(e){this.setProperty("suppressStatus",e)}_renderSuppressStatus(){this._renderErrorStatus()}_isSuppressStatusIcon(){return u.isOneOf(this.suppressStatus,A.SuppressStatus.ALL,A.SuppressStatus.ICON)}_isSuppressStatusField(){return u.isOneOf(this.suppressStatus,A.SuppressStatus.ALL,A.SuppressStatus.FIELD)}removeErrorStatus(e){this.removeErrorStatusByPredicate(t=>t instanceof e)}removeErrorStatusByPredicate(e){let t=this._errorStatus();if(!!t&&t.containsStatusByPredicate(e)){let s=t.clone();s.removeAllStatusByPredicate(e),s.hasChildren()?this.setErrorStatus(s):this.clearErrorStatus()}}clearErrorStatus(){this.setErrorStatus(null)}_renderErrorStatus(){let e=this._errorStatus(),t=!!e,s=t&&!this._isSuppressStatusField()?"has-"+e.cssClass():"";this._updateErrorStatusClasses(s,t),this._updateFieldStatus()}_updateErrorStatusClasses(e,t){this._updateErrorStatusClassesOnElement(this.$container,e,t),this._updateErrorStatusClassesOnElement(this.$field,e,t)}_updateErrorStatusClassesOnElement(e,t,s){!e||e.removeClass(A.SEVERITY_CSS_CLASSES).addClass(t)}setTooltipText(e){this.setProperty("tooltipText",e)}_renderTooltipText(){this._updateTooltip()}setTooltipAnchor(e){this.setProperty("tooltipAnchor",e)}_renderTooltipAnchor(){this._updateTooltip()}_updateTooltip(){let e=this.hasStatusTooltip();if(this.$container.toggleClass("has-tooltip",e),this.$field&&this.$field.toggleClass("has-tooltip",e),this._updateFieldStatus(),this.$fieldContainer)if(this.hasOnFieldTooltip()){let t=this.onFieldTooltipOptionsCreator||this._createOnFieldTooltipOptions;K.install(this.$fieldContainer,t.call(this))}else K.uninstall(this.$fieldContainer)}hasStatusTooltip(){return this.tooltipAnchor===A.TooltipAnchor.DEFAULT&&y.hasText(this.tooltipText)}hasOnFieldTooltip(){return this.tooltipAnchor===A.TooltipAnchor.ON_FIELD&&y.hasText(this.tooltipText)}setOnFieldTooltipOptionsCreator(e){this.onFieldTooltipOptionsCreator=e}_createOnFieldTooltipOptions(){return{parent:this,text:this.tooltipText,arrowPosition:50}}_renderVisible(){super._renderVisible(),this.rendered&&this._renderErrorStatus()}setLabel(e){this.setProperty("label",e)}_renderLabel(){let e=this.label;this.labelPosition===A.LabelPosition.ON_FIELD?(this._renderPlaceholder(),this.$label&&this.$label.text("")):this.$label&&(this._removePlaceholder(),this.$label.contentOrNbsp(this.labelHtmlEnabled,e,"empty").toggleClass("top",this.labelPosition===A.LabelPosition.TOP),(this.labelUseUiWidth||this.labelWidthInPixel===A.LabelWidth.UI)&&this.invalidateLayoutTree())}_renderEmptyLabel(){this.$label.html("&nbsp;").toggleClass("top",this.labelPosition===A.LabelPosition.TOP)}_renderPlaceholder(e){e=u.nvl(e,this.$field),e&&e.placeholder(this.label)}_removePlaceholder(e){e=u.nvl(e,this.$field),e&&e.placeholder("")}setLabelVisible(e){this.setProperty("labelVisible",e)}_renderLabelVisible(){let e=this.labelVisible;if(this._renderChildVisible(this.$label,e),this.$container.toggleClass("label-hidden",!e),this.rendered&&this.labelPosition===A.LabelPosition.TOP){let t=this.htmlComp.getParent();t&&t.invalidateLayoutTree()}}setLabelWidthInPixel(e){this.setProperty("labelWidthInPixel",e)}_renderLabelWidthInPixel(){this.invalidateLayoutTree()}setLabelUseUiWidth(e){this.setProperty("labelUseUiWidth",e)}_renderLabelUseUiWidth(){this.invalidateLayoutTree()}setStatusVisible(e){this.setProperty("statusVisible",e)}_renderStatusVisible(){this._updateFieldStatus()}setStatusPosition(e){this.setProperty("statusPosition",e)}_renderStatusPosition(){this._updateFieldStatus()}tooltip(){return this.fieldStatus?this.fieldStatus.tooltip:null}_updateFieldStatus(){if(!this.fieldStatus)return;let e,t=this._errorStatus(),s=null,r=this._computeStatusVisible(),n=!0;if(this.fieldStatus.setPosition(this.statusPosition),this.fieldStatus.setVisible(r),!!r){if(t){if(this.mode===A.Mode.CELLEDITOR)return;s=t,n=!s.isError(),e=this._getMenusForStatus(t)}else this.hasStatusTooltip()?(s=u.create(E,{message:this.tooltipText,severity:E.Severity.INFO}),e=this.getContextMenuItems()):e=this.getContextMenuItems();this.fieldStatus.update(s,e,n,this._isInitialShowStatus())}}_isInitialShowStatus(){return!!this._errorStatus()}_computeStatusVisible(){let e=this._errorStatus(),t=this.statusVisible,s=!!e,r=this.hasStatusTooltip();return!this._isSuppressStatusIcon()&&this.visible&&(t||s||r||this._hasMenus()&&this.menusVisible)}_renderChildVisible(e,t){if(!!e&&e.isVisible()!==t)return e.setVisible(t),this.invalidateLayoutTree(),!0}setLabelPosition(e){this.setProperty("labelPosition",e)}_renderLabelPosition(){if(this._renderLabel(),this.rendered){let e=this.htmlComp.getParent();e&&e.invalidateLayoutTree(),this.invalidateLayoutTree()}}setLabelHtmlEnabled(e){this.setProperty("labelHtmlEnabled",e)}_renderLabelHtmlEnabled(){this._renderLabel()}_renderEnabled(){super._renderEnabled(),this.$field&&this.$field.setEnabled(this.enabledComputed),this._updateDisabledCopyOverlay(),this._installOrUninstallDragAndDropHandler()}_renderDisabledStyle(){this._renderDisabledStyleInternal(this.$container),this._renderDisabledStyleInternal(this.$fieldContainer),this._renderDisabledStyleInternal(this.$field),this._renderDisabledStyleInternal(this.$mandatory)}setFont(e){this.setProperty("font",e)}_renderFont(){M.legacyFont(this,this.$field)}setForegroundColor(e){this.setProperty("foregroundColor",e)}_renderForegroundColor(){M.legacyForegroundColor(this,this.$field)}setBackgroundColor(e){this.setProperty("backgroundColor",e)}_renderBackgroundColor(){M.legacyBackgroundColor(this,this.$field)}setLabelFont(e){this.setProperty("labelFont",e)}_renderLabelFont(){M.legacyFont(this,this.$label,"label")}setLabelForegroundColor(e){this.setProperty("labelForegroundColor",e)}_renderLabelForegroundColor(){M.legacyForegroundColor(this,this.$label,"label")}setLabelBackgroundColor(e){this.setProperty("labelBackgroundColor",e)}_renderLabelBackgroundColor(){M.legacyBackgroundColor(this,this.$label,"label")}setGridDataHints(e){this.setProperty("gridDataHints",e)}_setGridDataHints(e){e||(e=new ze),this._setProperty("gridDataHints",ze.ensure(e))}_renderGridDataHints(){this.parent.invalidateLogicalGrid()}_setGridData(e){e||(e=new ze),this._setProperty("gridData",ze.ensure(e))}_renderGridData(){if(this.rendered){let e=this.htmlComp.getParent();e&&e.invalidateLayoutTree()}}setMenus(e){this.setProperty("menus",e)}_setMenus(e){e=p.ensure(e),this.menus.forEach(t=>t.off("propertyChange",this._menuPropertyChangeHandler)),this.updateKeyStrokes(e,this.menus),this._setProperty("menus",e),this.menus.forEach(t=>t.on("propertyChange",this._menuPropertyChangeHandler))}insertMenu(e){this.insertMenus([e])}insertMenus(e){if(e=p.ensure(e),e.length===0)return;let t=this.menus;this.setMenus(t.concat(e))}deleteMenu(e){this.deleteMenus([e])}deleteMenus(e){if(e=p.ensure(e),e.length===0)return;let t=this.menus.slice();p.removeAll(t,e),this.setMenus(t)}_onMenuPropertyChange(e){e.propertyName==="visible"&&this.rendered&&this._updateMenus()}getContextMenuItems(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=this.getCurrentMenuTypes();return t.length?We.filter(this.menus,t,{onlyVisible:e,defaultMenuTypes:this.defaultMenuTypes}):e?this.menus.filter(s=>s.visible):this.menus}_getMenusForStatus(e){return this.statusMenuMappings.filter(t=>!t.menu||!t.menu.visible?!1:(t.codes.length===0||t.codes.indexOf(e.code)>-1)&&(t.severities.length===0||t.severities.indexOf(e.severity)>-1)).map(t=>t.menu)}_hasMenus(){return!!(this.menus&&this.getContextMenuItems().length>0)}_updateMenus(){!this.rendered&&!this.rendering||(this.$container.toggleClass("has-menus",this._hasMenus()&&this.menusVisible),this._updateFieldStatus())}_renderMenus(){this._updateMenus()}_renderStatusMenuMappings(){this._updateMenus()}setMenusVisible(e){this.setProperty("menusVisible",e)}_setMenusVisible(e){this._setProperty("menusVisible",e)}_renderMenusVisible(){this._updateMenus()}getCurrentMenuTypes(){return this._getCurrentMenuTypes()}_getCurrentMenuTypes(){return[]}_setKeyStrokes(e){this.updateKeyStrokes(e,this.keyStrokes),this._setProperty("keyStrokes",e)}_$tooltipParent(){}_hideStatusMessage(){this.fieldStatus&&this.fieldStatus.hideTooltip()}_renderPreventInitialFocus(){this.$container.toggleClass("prevent-initial-focus",!!this.preventInitialFocus)}focus(){if(!this.rendered)return this.session.layoutValidator.schedulePostValidateFunction(this.focus.bind(this)),!1;if(!this.enabledComputed)return!1;let e=this.getFocusableElement();return e?this.session.focusManager.requestFocus(e):!1}getFocusableElement(){return this.rendered&&this.$field?this.$field[0]:null}_onFieldFocus(e){this.setFocused(!0)}_onFieldBlur(e){this.setFocused(!1)}activate(){if(!this.enabledComputed||!this.rendered)return;let e=this.getFocusableElement();e&&a().ensure(e).focus()}get$Scrollable(){return this.$field}getParentGroupBox(){let e=this.parent;for(;e&&!(e instanceof xe);)e=e.parent;return e}getParentField(){return this.parent}addLabel(){this.$label=this.$container.appendElement("<label>"),K.installForEllipsis(this.$label,{parent:this}),this.$label.on("click",this._onLabelClick.bind(this))}_onLabelClick(e){!y.hasText(this.label)||this.activate()}_removeLabel(){!this.$label||(K.uninstall(this.$label),this.$label.remove(),this.$label=null)}_linkWithLabel(e){!this.$label||!e||Z.linkElementWithLabel(e,this.$label)}_removeIcon(){!this.$icon||(this.$icon.remove(),this.$icon=null)}addField(e){this.$fieldContainer||this.addFieldContainer(e),this.$field=e,this._linkWithLabel(e),this.$field.on("blur",this._onFieldBlur.bind(this)).on("focus",this._onFieldFocus.bind(this))}addFieldContainer(e){this.$fieldContainer=e.addClass("field"),(this.$container.has(e[0]).length===0||e.next().length>0)&&e.appendTo(this.$container)}_removeField(){this.$field&&(this.$field.remove(),this.$field=null),this.$fieldContainer&&(this.$fieldContainer.remove(),this.$fieldContainer=null)}addStatus(){this.fieldStatus||(this.fieldStatus=u.create(ja,{parent:this,position:this.statusPosition,visible:this._computeStatusVisible()}),this.fieldStatus.render(),this.$status=this.fieldStatus.$container,this._updateFieldStatus())}_removeStatus(){!this.fieldStatus||(this.fieldStatus.destroy(),this.$status=null,this.fieldStatus=null)}addPseudoStatus(){this.$pseudoStatus=this.$container.appendSpan("status")}addMandatoryIndicator(){this.$mandatory=this.$container.appendSpan("mandatory-indicator")}removeMandatoryIndicator(){!this.$mandatory||(this.$mandatory.remove(),this.$mandatory=null)}addIcon(e){e||(e=this.$container),this.$icon=Z.appendIcon(e).on("mousedown",this._onIconMouseDown.bind(this))}_onIconMouseDown(e){!this.enabledComputed||this.$field.focus()}addContainer(e,t,s){this.$container=e.appendDiv("form-field"),t&&this.$container.addClass(t);let r=T.install(this.$container,this.session);r.setLayout(s||this._createLayout()),this.htmlComp=r}_createLayout(){return new oi(this)}updateInnerAlignment(e){e=e||{};let t=e.$fieldContainer||this.$fieldContainer;this._updateElementInnerAlignment(e,t),t!==this.$container&&this._updateElementInnerAlignment(e,this.$container)}_updateElementInnerAlignment(e,t){e=e||{};let s=u.nvl(e.useHorizontalAlignment,!0),r=u.nvl(e.useVerticalAlignment,!0);if(!!t&&(t.removeClass("has-inner-alignment halign-left halign-center halign-right valign-top valign-middle valign-bottom"),s||r)){t.addClass("has-inner-alignment");let n=this.gridData;if(this.parent.logicalGrid&&(n=this.gridDataHints),s){let o=n.horizontalAlignment;t.addClass(o<0?"halign-left":o>0?"halign-right":"halign-center")}if(r){let o=n.verticalAlignment;t.addClass(o<0?"valign-top":o>0?"valign-bottom":"valign-middle")}this.invalidateLayout()}}addCellEditorFieldCssClasses(e,t){e.addClass("cell-editor-field").addClass(x.get().cssClassForEdge()),t.cssClass&&e.addClass(t.cssClass)}prepareForCellEdit(e){e=e||{},this.$mandatory&&this.removeMandatoryIndicator(),this.$status&&(this.$status.remove(),this.$status=null),this.$container&&this.$container.addClass("cell-editor-form-field"),this.$field&&this.addCellEditorFieldCssClasses(this.$field,e)}setDropType(e){this.setProperty("dropType",e)}_renderDropType(){this._installOrUninstallDragAndDropHandler()}setDropMaximumSize(e){this.setProperty("dropMaximumSize",e)}_installOrUninstallDragAndDropHandler(){Fe.installOrUninstallDragAndDropHandler(this._getDragAndDropHandlerOptions())}_getDragAndDropHandlerOptions(){return{target:this,doInstall:()=>this.dropType&&this.enabledComputed,container:()=>this.$field||this.$container,dropType:()=>this.dropType,onDrop:e=>this.trigger("drop",e)}}_updateDisabledCopyOverlay(){this.disabledCopyOverlay&&!x.get().supportsCopyFromDisabledInputFields()&&(this.enabledComputed?this._removeDisabledCopyOverlay():(this._renderDisabledCopyOverlay(),this.revalidateLayout()))}_renderDisabledCopyOverlay(){this.$disabledCopyOverlay||(this.$disabledCopyOverlay=this.$container.appendDiv("disabled-overlay").on("contextmenu",this._createCopyContextMenu.bind(this)))}_removeDisabledCopyOverlay(){this.$disabledCopyOverlay&&(this.$disabledCopyOverlay.remove(),this.$disabledCopyOverlay=null)}_createCopyContextMenu(e){if(!this.visible||y.empty(this.displayText))return;let t=u.create(ne,{parent:this,text:this.session.text("ui.Copy"),inheritAccessibility:!1});t.on("action",r=>this.exportToClipboard()),u.create(ft,{parent:this,menuItems:[t],cloneMenuItems:!1,location:{x:e.pageX,y:e.pageY}}).open()}visitFields(e){return e(this)}visitParentFields(e){let t=this.parent;for(;t instanceof A;)e(t),t=t.parent}markAsSaved(){this.setProperty("touched",!1),this.updateRequiresSave()}touch(){this.setProperty("touched",!0),this.updateRequiresSave()}updateRequiresSave(){!this.initialized||(this.requiresSave=this.touched||this.computeRequiresSave())}computeRequiresSave(){return!1}getValidationResult(){let e=!this._errorStatus(),t=!this.mandatory||!this.empty;return{valid:e&&t,validByErrorStatus:e,validByMandatory:t,field:this,label:this.label,reveal:()=>{Z.selectAllParentTabsOf(this),this.focus()}}}_updateEmpty(){}requestInput(){this.enabledComputed&&this.rendered&&this.focus()}clone(e,t){let s=super.clone(e,t);return this._deepCloneProperties(s,"menus",t),s}exportToClipboard(){if(!this.displayText)return;let e=this.trigger("clipboardExport",{text:this.displayText});e.defaultPrevented||this._exportToClipboard(e.text)}_exportToClipboard(e){rs.copyText({parent:this,text:e})}}z(A,"FieldStyle",{CLASSIC:"classic",ALTERNATIVE:"alternative"}),z(A,"SuppressStatus",{ALL:"all",ICON:"icon",FIELD:"field"}),z(A,"DEFAULT_FIELD_STYLE",A.FieldStyle.ALTERNATIVE),z(A,"StatusPosition",{DEFAULT:"default",TOP:"top"}),z(A,"LabelPosition",{DEFAULT:0,LEFT:1,ON_FIELD:2,RIGHT:3,TOP:4,BOTTOM:5}),z(A,"TooltipAnchor",{DEFAULT:"default",ON_FIELD:"onField"}),z(A,"LabelWidth",{DEFAULT:0,UI:-1}),z(A,"FULL_WIDTH",0),z(A,"Mode",{DEFAULT:"default",CELLEDITOR:"celleditor"}),z(A,"SEVERITY_CSS_CLASSES","has-error has-warning has-info has-ok");function Fg(i,e,t){return e=PF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function PF(i){var e=xF(i,"string");return typeof e=="symbol"?e:String(e)}function xF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class at extends ke{constructor(){super(),Fg(this,"enabledWhenOffline",void 0),Fg(this,"_currentMenuTypes",void 0),this.enabledWhenOffline=!1,this._currentMenuTypes=[]}_initProperties(e){super._initProperties(e),this._currentMenuTypes=p.ensure(e.currentMenuTypes),delete e.currentMenuTypes}_syncCurrentMenuTypes(e){this._currentMenuTypes=p.ensure(e),this.widget._updateMenus()}_goOffline(){this.enabledWhenOffline||(this._enabledBeforeOffline=this.widget.enabled,this.widget.setEnabled(!1))}_goOnline(){this.enabledWhenOffline||this.widget.setEnabled(this._enabledBeforeOffline)}_onWidgetEvent(e){e.type==="drop"&&this.widget.dragAndDropHandler?this.widget.dragAndDropHandler.uploadFiles(e):super._onWidgetEvent(e)}static modifyFormFieldPrototype(){!te.get().remote||b.replacePrototypeFunction(A,"getCurrentMenuTypes",at.getCurrentMenuTypes,!0)}static getCurrentMenuTypes(){let e=this.modelAdapter;return e?e._currentMenuTypes:this.getCurrentMenuTypesOrig()}}te.addListener("bootstrap",at.modifyFormFieldPrototype);function gn(i,e,t){return e=EF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function EF(i){var e=FF(i,"string");return typeof e=="symbol"?e:String(e)}function FF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class oi extends ee{constructor(e){super(),gn(this,"formField",void 0),gn(this,"mandatoryIndicatorWidth",void 0),gn(this,"statusWidth",void 0),gn(this,"rowHeight",void 0),gn(this,"compactFieldWidth",void 0),gn(this,"htmlPropertyChangeHandler",void 0),this.formField=e,this._initDefaults(),this.htmlPropertyChangeHandler=this._onHtmlEnvironmentPropertyChange.bind(this),de.get().on("propertyChange",this.htmlPropertyChangeHandler),this.formField.one("remove",()=>{de.get().off("propertyChange",this.htmlPropertyChangeHandler)})}_initDefaults(){this.mandatoryIndicatorWidth=de.get().fieldMandatoryIndicatorWidth,this.statusWidth=de.get().fieldStatusWidth,this.rowHeight=de.get().formRowHeight,this.compactFieldWidth=oi.COMPACT_FIELD_WIDTH}_onHtmlEnvironmentPropertyChange(){this._initDefaults(),this.formField.invalidateLayoutTree()}layout(e){let t,s,r=T.get(e),n=this.formField,o=n.tooltip(),l=this.labelWidth(),h=this.statusWidth,d=r.insets({includeBorder:!1}),c=d.top,f=d.right,m=d.bottom,_=d.left;if(this._isLabelVisible()){if((n.labelWidthInPixel===A.LabelWidth.UI||n.labelUseUiWidth)&&(n.$label.hasClass("empty")?l=0:l=v.prefSize(n.$label).width),u.isOneOf(n.labelPosition,A.LabelPosition.DEFAULT,A.LabelPosition.LEFT))v.setBounds(n.$label,_,c,l,this.rowHeight),_+=l+n.$label.cssMarginX();else if(n.labelPosition===A.LabelPosition.TOP){let C=v.prefSize(n.$label).height;n.$label.cssHeight(C),c+=C+n.$label.cssMarginY(),t=!0}}if(n.$mandatory&&n.$mandatory.isVisible()&&(n.$mandatory.cssTop(c).cssLeft(_).cssWidth(this.mandatoryIndicatorWidth),_+=n.$mandatory.outerWidth(!0)),this._isStatusVisible())if(n.$status.cssWidth(h),n.statusPosition===A.StatusPosition.TOP&&t){let C=v.prefSize(n.$status,{useCssSize:!0}).height,S=d.top+n.$label.cssPaddingTop()+n.$label.height()/2-C/2;n.$status.cssTop(S).cssRight(f+n.$label.cssMarginRight()).cssHeight(C);let R=v.size(n.$status,!0).width;n.$label.cssPaddingRight(R)}else n.$status.cssTop(c).cssRight(f).cssHeight(this.rowHeight),f+=h+n.$status.cssMarginX();if(n.$fieldContainer){let C=new Ge(c-d.top,f-d.right,m-d.bottom,_-d.left),S=v.margins(n.$fieldContainer),R=r.availableSize({exact:!0}).subtract(r.insets()).subtract(C).subtract(S);s=new ie(_,c,R.width,R.height),n.$fieldContainer.css("position")!=="absolute"&&(s.x=0,s.y=0);let L=T.optGet(n.$fieldContainer);if(L?L.setBounds(s):v.setBounds(n.$fieldContainer,s),this.compactFieldWidth>-1&&(n.$field.toggleClass("compact",s.width<=this.compactFieldWidth),n.$container.toggleClass("compact",s.width<=this.compactFieldWidth)),t){let H=R.add(S).width-n.$label.cssMarginX();n.$mandatory&&n.$mandatory.isVisible()&&(H+=n.$mandatory.outerWidth(!0)),n.$label.cssWidth(H)}}if(n.$fieldContainer){let C=this._$elementForIconLayout(),S=v.borders(C),R=v.offsetBounds(C);c+=S.top,f+=S.right,s.x+=S.left,s.y+=S.top,s.height=R.height-S.top-S.bottom,s.width=R.width-S.left-S.right,n.$icon&&this._layoutIcon(n,s,f,c),n.$clearIcon&&this._layoutClearIcon(n,s,f,c)}o&&o.rendered&&o.position(),n.$field&&P.update(n.$field,!0),this._layoutDisabledCopyOverlay()}_layoutDisabledCopyOverlay(){if(this.formField.$field&&this.formField.$disabledCopyOverlay){let e=this.formField.$disabledCopyOverlay,t=this.formField.$field,s=t.position(),r=v.insets(t,{includePadding:!0}),n=t[0],o=t.css("overflow-x"),l=t.css("overflow-y"),h=o==="scroll"||o==="auto"&&n.scrollWidth-n.clientWidth>0,d=l==="scroll"||l==="auto"&&n.scrollHeight-n.clientHeight>0,c=x.get().scrollbarWidth;e.css("top",s.top).css("left",s.left).width(t.width()+r.horizontal()-(d?c:0)).height(t.height()+r.vertical()-(h?c:0))}}_isLabelVisible(){return!!this.formField.$label&&this.formField.labelVisible}_isStatusVisible(){return!!this.formField.$status&&(this.formField.statusVisible||this.formField.$status.isVisible())}preferredLayoutSize(e,t){let s=T.get(this.formField.$container),r=this.formField,n=new F,o=new F,l=new F,h=new F,d=u.nvl(t.widthHint,0),c=u.nvl(t.heightHint,0),f=r.statusPosition===A.StatusPosition.TOP&&this._isLabelVisible()&&r.labelPosition===A.LabelPosition.TOP;if(r.$mandatory&&r.$mandatory.isVisible()&&(o.width=this.mandatoryIndicatorWidth+r.$mandatory.cssMarginX(),d-=o.width),this._isLabelVisible()&&(n.width=this.labelWidth()+r.$label.cssMarginX(),n.height=this.rowHeight,r.labelPosition===A.LabelPosition.TOP?(n.width=0,n.height=v.prefSize(r.$label,!0).height):(r.labelWidthInPixel===A.LabelWidth.UI||r.labelUseUiWidth)&&(r.$label.hasClass("empty")?n.width=0:n=v.prefSize(r.$label,!0)),u.isOneOf(r.labelPosition,A.LabelPosition.DEFAULT,A.LabelPosition.LEFT)?d-=n.width:r.labelPosition===A.LabelPosition.TOP&&(c-=n.height)),this._isStatusVisible()&&(l.width=this.statusWidth+r.$status.cssMarginX(),f||(l.height=this.rowHeight,d-=l.width)),r.$fieldContainer){let _=v.margins(r.$fieldContainer),C=T.optGet(r.$fieldContainer);C||(d-=_.horizontal(),c-=_.vertical()),t.widthHint&&(t.widthHint=d),t.heightHint&&(t.heightHint=c),C?h=C.prefSize(t).add(_):h=v.prefSize(r.$fieldContainer,t).add(_)}let m=new F;return m.width=h.width,m.height=h.height,m.width+=o.width,m.height=Math.max(m.height,o.height),u.isOneOf(r.labelPosition,A.LabelPosition.DEFAULT,A.LabelPosition.LEFT)?(m.width+=n.width,m.height=Math.max(m.height,n.height)):r.labelPosition===A.LabelPosition.TOP&&(m.width=Math.max(m.width,n.width),m.height+=n.height),f||(m.width+=l.width,m.height=Math.max(m.height,l.height)),m=m.add(s.insets()),m}_$elementForIconLayout(){return this.formField.$field}_layoutIcon(e,t,s,r){let n=this.rowHeight;t&&(n=t.height),e.$icon.cssRight(s).cssTop(t.y).cssHeight(n)}_layoutClearIcon(e,t,s,r){let n=this.rowHeight;t&&(n=t.height),e instanceof fl&&e.gridData.horizontalAlignment>0?e.$clearIcon.cssLeft(t.x).cssRight("").cssTop(t.y).cssHeight(n):e.$clearIcon.cssLeft("").cssRight(s).cssTop(t.y).cssHeight(n)}labelWidth(){return A.LabelWidth.DEFAULT===this.formField.labelWidthInPixel?de.get().fieldLabelWidth:this.formField.labelWidthInPixel}}gn(oi,"COMPACT_FIELD_WIDTH",61);function _c(i,e,t){return e=DF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function DF(i){var e=AF(i,"string");return typeof e=="symbol"?e:String(e)}function AF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Dg extends I{constructor(){super(),_c(this,"codes",void 0),_c(this,"severities",void 0),_c(this,"menu",void 0),this.codes=[],this.severities=[],this.menu=null,this._addWidgetProperties(["menu"])}_createChild(e){if(typeof e=="string"){let t=this.parent.widget(e);if(!t)throw new Error("Referenced widget not found: "+e);return t}return super._createChild(e)}}class Ag extends ke{}function bi(i,e,t){return e=$F(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function $F(i){var e=RF(i,"string");return typeof e=="symbol"?e:String(e)}function RF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ze{constructor(e){bi(this,"x",void 0),bi(this,"y",void 0),bi(this,"w",void 0),bi(this,"h",void 0),bi(this,"weightX",void 0),bi(this,"weightY",void 0),bi(this,"useUiWidth",void 0),bi(this,"useUiHeight",void 0),bi(this,"horizontalAlignment",void 0),bi(this,"verticalAlignment",void 0),bi(this,"fillHorizontal",void 0),bi(this,"fillVertical",void 0),bi(this,"widthInPixel",void 0),bi(this,"heightInPixel",void 0),e=e||{},this.x=-1,this.y=-1,this.w=1,this.h=1,this.weightX=-1,this.weightY=-1,this.useUiWidth=!1,this.useUiHeight=!1,this.horizontalAlignment=-1,this.verticalAlignment=-1,this.fillHorizontal=!0,this.fillVertical=!0,this.widthInPixel=0,this.heightInPixel=0,a().extend(this,e)}static createFromHints(e,t){let s=new ze(e.gridDataHints);return s.w===A.FULL_WIDTH&&(s.w=t),s}static ensure(e){return!e||e instanceof ze?e:new ze(e)}}class Fr extends A{visitFields(e){let t=super.visitFields(e);if(t===_e.TERMINATE)return _e.TERMINATE;if(t===_e.SKIP_SUBTREE)return _e.CONTINUE;let s=this.getFields();for(let r=0;r<s.length;r++)if(t=s[r].visitFields(e),t===_e.TERMINATE)return _e.TERMINATE}setFieldStyle(e){this.getFields().forEach(t=>t.setFieldStyle(e)),super.setFieldStyle(e)}activate(){Z.activateFirstField(this,this.getFields())}getFocusableElement(){let e=Le.findFirstFocusableWidget(this.getFields(),this);return e?e.getFocusableElement():null}}class fo extends at{constructor(){super(),this.enabledWhenOffline=!0}}function ms(i,e,t){return e=MF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function MF(i){var e=IF(i,"string");return typeof e=="symbol"?e:String(e)}function IF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class me extends A{constructor(){super(),ms(this,"clearable",void 0),ms(this,"formatter",void 0),ms(this,"hasText",void 0),ms(this,"initialValue",void 0),ms(this,"invalidValueMessageKey",void 0),ms(this,"parser",void 0),ms(this,"value",void 0),ms(this,"validators",void 0),ms(this,"_updateDisplayTextPending",void 0),this.defaultMenuTypes=[...this.defaultMenuTypes,me.MenuTypes.NotNull,me.MenuTypes.Null],this.clearable=me.Clearable.FOCUSED,this.displayText=null,this.formatter=this._formatValue.bind(this),this.hasText=!1,this.initialValue=null,this.invalidValueMessageKey="InvalidValueMessageX",this.parser=this._parseValue.bind(this),this.value=null,this.validators=[],this.validators.push(this._validateValue.bind(this)),this._updateDisplayTextPending=!1,this.$clearIcon=null,this._addCloneProperties(["value","displayText","clearable"])}_init(e){super._init(e),e.validator&&(this.setValidator(e.validator),delete e.validator),this._initValue(this.value)}_initValue(e){this.value=null,this._setValue(e),this._updateEmpty()}_renderProperties(){super._renderProperties(),this._renderDisplayText(),this._renderClearable(),this._renderHasText()}_remove(){super._remove(),this.$clearIcon=null}_renderDisplayText(){this._updateHasText()}_readDisplayText(){return""}_onClearIconMouseDown(e){this.clear(),e.preventDefault()}_onFieldBlur(e){super._onFieldBlur(e),this.acceptInput(!1)}acceptInput(e){e=!!e;let t=u.nvl(this._readDisplayText(),"");this._checkDisplayTextChanged(t,e)&&(this._setProperty("displayText",t),e||this.parseAndSetValue(t),this._triggerAcceptInput(e))}parseAndSetValue(e){this.removeErrorStatus(pi);try{if(!this.trigger("parse",{displayText:e}).defaultPrevented){let s=this.parseValue(e);this.setValue(s)}}catch(t){this._parsingFailed(e,t)}}_parsingFailed(e,t){a().log.isDebugEnabled()&&a().log.debug("Parsing failed for field with id "+this.id,t),this.trigger("parseError",{displayText:e,error:t}).defaultPrevented||this._addParsingFailedErrorStatus(e,t)}_addParsingFailedErrorStatus(e,t){let s=this._createParsingFailedStatus(e,t);this.addErrorStatus(s)}_createParsingFailedStatus(e,t){return this._createInvalidValueStatus("ParsingFailedStatus",e,t)}setParser(e){this.setProperty("parser",e),this.initialized&&this.parseAndSetValue(this.displayText)}_setParser(e){e||(e=this._parseValue.bind(this)),this._setProperty("parser",e)}parseValue(e){let t=this._parseValue.bind(this);return this.parser(e,t)}_parseValue(e){return e}_checkDisplayTextChanged(e,t){let s=u.nvl(this.displayText,"");return e!==s}aboutToBlurByMouseDown(e){this.isFocusOnField(e)||this.acceptInput()}isFocused(){return this.rendered&&Yi.isActiveElement(this.$field)}isFocusOnField(e){return this.$field.isOrHas(e)||this.$clearIcon&&this.$clearIcon.isOrHas(e)}_triggerAcceptInput(e){let t={displayText:this.displayText,whileTyping:!!e};this.trigger("acceptInput",t)}setDisplayText(e){this.setProperty("displayText",e)}_updateHasText(){this.setHasText(y.hasText(this._readDisplayText()))}setHasText(e){this.setProperty("hasText",e)}_renderHasText(){this.$field&&this.$field.toggleClass("has-text",this.hasText),this.$container.toggleClass("has-text",this.hasText)}setClearable(e){this.setProperty("clearable",e)}_renderClearable(){this.isClearable()?this.$clearIcon||this.addClearIcon():this.$clearIcon&&(this.$clearIcon.remove(),this.$clearIcon=null),this.invalidateLayoutTree(!1),this._updateClearableStyles()}_updateClearableStyles(){this.$container.removeClass("clearable-always clearable-focused"),this.isClearable()&&(this.clearable===me.Clearable.ALWAYS?this.$container.addClass("clearable-always"):this.clearable===me.Clearable.FOCUSED&&this.$container.addClass("clearable-focused"))}isClearable(){return this.clearable===me.Clearable.ALWAYS||this.clearable===me.Clearable.FOCUSED}clear(){this._clear(),this._updateHasText(),this.acceptInput(),this._triggerClear()}_clear(){}_triggerClear(){this.trigger("clear")}setValue(e){e=this._prepareProperty("value",e),this.rendered&&this._callRemoveProperty("value"),this._callSetProperty("value",e),this.rendered&&this._callRenderProperty("value")}resetValue(){this.setValue(this.initialValue)}_ensureValue(e){return e}_setValue(e){this.initialized&&(this.removeErrorStatus(pi),this.removeErrorStatus(Vo));let t=this.value,s=null;try{s=this._ensureValue(e)}catch(r){this._ensureValueFailed(e,r);return}try{this.value=this.validateValue(s)}catch(r){this._validationFailed(s,r);return}this._updateDisplayText(),!this._valueEquals(t,this.value)&&(this._valueChanged(),this._updateMenus(),this._updateTouched(),this._updateEmpty(),this.triggerPropertyChange("value",t,this.value))}_valueEquals(e,t){return b.equals(e,t)}_valueChanged(){}_getCurrentMenuTypes(){return b.isNullOrUndefined(this.value)?[...super._getCurrentMenuTypes(),me.MenuTypes.Null]:[...super._getCurrentMenuTypes(),me.MenuTypes.NotNull]}validate(){this._setValue(this.value)}addValidator(e,t){let s=this.validators.slice();s.push(e),this.setValidators(s,t)}removeValidator(e,t){let s=this.validators.slice();p.remove(s,e),this.setValidators(s,t)}setValidator(e,t){e||(e=this._validateValue.bind(this));let s=[];e&&(s=[e]),this.setValidators(s,t)}setValidators(e,t){this.setProperty("validators",e),this.initialized&&u.nvl(t,!0)&&this.validate()}validateValue(e){let t=this._validateValue.bind(this);return this.validators.forEach(s=>{e=s(e,t)}),e=u.nvl(e,null),e}_validateValue(e){return typeof e=="string"&&e===""&&(e=null),e}_validationFailed(e,t){a().log.isDebugEnabled()&&a().log.debug("Validation failed for field with id "+this.id,t);let s=this._createValidationFailedStatus(e,t);this.addErrorStatus(s),this._updateDisplayText(e)}_ensureValueFailed(e,t){a().log.isDebugEnabled()&&a().log.debug("EnsureValue failed for field with id "+this.id,t);let s=this._createValidationFailedStatus(e,t);this.addErrorStatus(s),this.setDisplayText(this._formatRawValue(e))}_formatRawValue(e){return e+""}_createValidationFailedStatus(e,t){return this._createInvalidValueStatus("ValidationFailedStatus",e,t)}_createInvalidValueStatus(e,t,s){let r=E.classForName(e);if(s instanceof r)return s;let n,o=E.Severity.ERROR;return s instanceof E?(n=s.message,o=s.severity):typeof s=="string"?n=s:n=this.session.text(this.invalidValueMessageKey,t),u.create(e,{message:n,severity:o})}_updateDisplayText(e){if(!this.initialized&&!b.isNullOrUndefined(this.displayText))return;e=u.nvl(e,this.value);let t=this.formatValue(e);b.isPromise(t)?(this._updateDisplayTextPending=!0,t.done(this.setDisplayText.bind(this)).fail(()=>{this._updateDisplayTextPending&&this.setDisplayText(""),a().log.isInfoEnabled()&&a().log.info("Could not resolve display text for value: "+e)}).always(()=>{this._updateDisplayTextPending=!1})):(this.setDisplayText(t),this._updateDisplayTextPending=!1)}setFormatter(e){this.setProperty("formatter",e),this.initialized&&this.validate()}_setFormatter(e){e||(e=this._formatValue.bind(this)),this._setProperty("formatter",e)}formatValue(e){let t=this._formatValue.bind(this);return this.formatter(e,t)}_formatValue(e){return u.nvl(e,"")+""}_updateTouched(){this.touched=!this._valueEquals(this.value,this.initialValue)}addClearIcon(e){e||(e=this.$container),this.$clearIcon=e.appendSpan("clear-icon unfocusable text-field-icon action").on("mousedown",this._onClearIconMouseDown.bind(this))}addContainer(e,t,s){super.addContainer(e,t,s),this.$container.addClass("value-field")}addField(e){super.addField(e),this.$field.data("valuefield",this)}markAsSaved(){super.markAsSaved(),this.initialValue=this.value}_updateEmpty(){this.empty=this.value===null||this.value===void 0}static invokeValueFieldAboutToBlurByMouseDown(e){let t=this._getActiveValueField(e);t&&t.aboutToBlurByMouseDown(e)}static invokeValueFieldAcceptInput(e){let t=this._getActiveValueField(e);t&&t.acceptInput()}static _getActiveValueField(e){let t=a()(e).activeElement(),s=u.widget(t);return s instanceof me&&s.enabledComputed?s:null}}ms(me,"Clearable",{ALWAYS:"always",FOCUSED:"focused",NEVER:"never"}),ms(me,"MenuTypes",{Null:"ValueField.Null",NotNull:"ValueField.NotNull"});class Ot extends at{_onWidgetAcceptInput(e){this._send("acceptInput",{displayText:e.displayText,whileTyping:e.whileTyping},{showBusyIndicator:!e.whileTyping,coalesce:function(t){return this.target===t.target&&this.type===t.type&&this.whileTyping===t.whileTyping}})}_onWidgetEvent(e){e.type==="acceptInput"?this._onWidgetAcceptInput(e):super._onWidgetEvent(e)}exportAdapterData(e){return e=super.exportAdapterData(e),delete e.displayText,e}_syncDisplayText(e){this.widget.setDisplayText(e),this.widget.parseAndSetValue(e)}}function Xa(i,e,t){return e=LF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function LF(i){var e=OF(i,"string");return typeof e=="symbol"?e:String(e)}function OF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class fl extends me{constructor(){super(),Xa(this,"updateDisplayTextOnModify",void 0),Xa(this,"updateDisplayTextOnModifyDelay",void 0),Xa(this,"_displayTextModifiedTimeoutId",void 0),Xa(this,"_displayTextChangedWhileTyping",void 0),this.disabledCopyOverlay=!0,this._displayTextModifiedTimeoutId=null,this.updateDisplayTextOnModify=!1,this.updateDisplayTextOnModifyDelay=250}addField(e){super.addField(e),e&&e.on("input",this._onFieldInput.bind(this))}setUpdateDisplayTextOnModify(e){this._displayTextModifiedTimeoutId!==null&&(clearTimeout(this._displayTextModifiedTimeoutId),this._acceptInputWhileTyping()),this.setProperty("updateDisplayTextOnModify",e)}setUpdateDisplayTextOnModifyDelay(e){this.setProperty("updateDisplayTextOnModifyDelay",e)}_clear(){this.$field&&this.$field.val("")}_onFieldInput(){this._updateHasText(),this.updateDisplayTextOnModify&&this._onDisplayTextModified()}_onDisplayTextModified(){clearTimeout(this._displayTextModifiedTimeoutId),this.updateDisplayTextOnModifyDelay?this._displayTextModifiedTimeoutId=setTimeout(this._acceptInputWhileTyping.bind(this),this.updateDisplayTextOnModifyDelay):this._acceptInputWhileTyping()}_acceptInputWhileTyping(){this._displayTextModifiedTimeoutId=null,this.rendered&&this.acceptInput(!0)}acceptInput(e){this._displayTextModifiedTimeoutId!==null&&(clearTimeout(this._displayTextModifiedTimeoutId),this._displayTextModifiedTimeoutId=null),super.acceptInput(e)}_renderDisplayText(){this.$field.val(this.displayText),super._renderDisplayText()}_readDisplayText(){return this.$field?this.$field.val():""}_checkDisplayTextChanged(e,t){let s=super._checkDisplayTextChanged(e,t);return t?this.updateDisplayTextOnModify&&s&&(this._displayTextChangedWhileTyping=!0):(this._displayTextChangedWhileTyping&&(s=!0),this._displayTextChangedWhileTyping=!1),s}}class Ja extends Ot{constructor(){super(),this.enabledWhenOffline=!0}}function $g(i,e,t){return e=BF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function BF(i){var e=kF(i,"string");return typeof e=="symbol"?e:String(e)}function kF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Rg extends A{constructor(){super(),$g(this,"scrollable",void 0),$g(this,"fieldWidget",void 0),this.scrollable=!0,this.fieldWidget=null,this._addWidgetProperties(["fieldWidget"])}_init(e){super._init(e)}_render(){this.addContainer(this.$parent,"widget-field",new yc(this)),this.addLabel(),this.addMandatoryIndicator(),this.addStatus()}_renderProperties(){super._renderProperties(),this._renderFieldWidget(),this._renderScrollable()}setFieldWidget(e){this.setProperty("fieldWidget",e)}_renderFieldWidget(){!this.fieldWidget||(this.fieldWidget.render(),this.addField(this.fieldWidget.$container),this.invalidateLayoutTree())}_removeFieldWidget(){!this.fieldWidget||(this.fieldWidget.remove(),this._removeField(),this.invalidateLayoutTree())}setScrollable(e){this.setProperty("scrollable",e)}_renderScrollable(){this._uninstallScrollbars(),this.scrollable&&this._installScrollbars()}get$Scrollable(){return this.$fieldContainer}}class Mg extends at{}class yc extends oi{constructor(e){super(e)}layout(e){super.layout(e),P.update(this.formField.$fieldContainer)}}function _n(i,e,t){return e=HF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function HF(i){var e=NF(i,"string");return typeof e=="symbol"?e:String(e)}function NF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class yn extends me{constructor(){super(),_n(this,"filterBox",void 0),_n(this,"lookupCall",void 0),_n(this,"lookupStatus",void 0),_n(this,"_currentLookupCall",void 0),_n(this,"_lookupExecuted",void 0),_n(this,"_valueSyncing",void 0),this.filterBox=null,this.gridDataHints.weightY=1,this.gridDataHints.h=2,this.value=[],this.clearable=me.Clearable.NEVER,this.lookupCall=null,this._currentLookupCall=null,this._lookupExecuted=!1,this._valueSyncing=!1,this._addCloneProperties(["lookupCall"])}_init(e){super._init(e),this.filterBox&&(this.filterBox.enabledComputed=!0,this.filterBox.recomputeEnabled(!0),this.filterBox.on("propertyChange",this._onFilterBoxPropertyChange.bind(this)))}_initValue(e){this.lookupCall&&this._setLookupCall(this.lookupCall),this._initStructure(e),super._initValue(e)}_render(){this.addContainer(this.$parent,"lookup-box"),this.addLabel(),this.addMandatoryIndicator(),this.addStatus(),this.addFieldContainer(this.$parent.makeDiv()),T.install(this.$fieldContainer,this.session).setLayout(this._createFieldContainerLayout()),this._ensureLookupCallExecuted(),this._renderStructure(),this.$field.addDeviceClass(),this.$field.addClass("structure"),this._renderFilterBox(),this.$container.css("--inactive-lookup-row-suffix-text","'".concat(this.session.text("InactiveState"),"'"))}_renderFilterBox(){!this.filterBox||!this.filterBox.visible||this.filterBox.render(this.$fieldContainer)}_ensureValue(e){return p.ensure(e)}_updateEmpty(){this.empty=p.empty(this.value)}_lookupByAll(){if(!this.lookupCall)return;let e=a().Deferred();return this._executeLookup(this.lookupCall.cloneForAll(),!0).done(t=>{this._lookupByAllDone(t),e.resolve(t)}),e.promise()}_executeLookup(e,t){return this.setLoading(!0),t&&this._currentLookupCall&&this._currentLookupCall.abort(),this._currentLookupCall=e,this.trigger("prepareLookupCall",{lookupCall:e}),e.execute().always(()=>{this._currentLookupCall=null,this._lookupExecuted=!0,this.setLoading(!1),this._clearLookupStatus()})}_lookupByAllDone(e){try{return e.exception?(this.setErrorStatus(E.error({message:e.exception})),!1):e.lookupRows.length===0?(this.setLookupStatus(E.warning({message:this.session.text("SmartFieldNoDataFound"),code:yn.ErrorCode.NO_DATA})),!1):!0}finally{this.trigger("lookupCallDone",{result:e})}}_errorStatus(){return this.lookupStatus||this.errorStatus}setLookupStatus(e){this.setProperty("lookupStatus",e),this.rendered&&this._renderErrorStatus()}clearErrorStatus(){this.setErrorStatus(null),this._clearLookupStatus()}_clearLookupStatus(){this.setLookupStatus(null)}setLookupCall(e){this.setProperty("lookupCall",e)}_setLookupCall(e){this._setProperty("lookupCall",Ut.ensure(e,this.session)),this._lookupExecuted=!1,this.rendered&&this._ensureLookupCallExecuted()}refreshLookup(){this._lookupExecuted=!1,this._ensureLookupCallExecuted()}_ensureLookupCallExecuted(){return this._lookupExecuted?!1:(this._lookupByAll(),!0)}_formatValue(e){return b.isNullOrUndefined(e)?"":this._formatLookupRows(this.getCheckedLookupRows())}_formatLookupRows(e){if(e=p.ensure(e),e.length===0)return"";let t=[];return e.forEach(s=>t.push(s.text)),y.join(", ",...t)}_readDisplayText(){return this.displayText}_clear(){this.setValue(null)}_onFilterBoxPropertyChange(e){if(e.propertyName==="visible"){if(!this.rendered)return;this.filterBox.visible?this._renderFilterBox():this.filterBox.remove()}}}_n(yn,"ErrorCode",{NO_DATA:1});function bc(i,e,t){return e=VF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function VF(i){var e=WF(i,"string");return typeof e=="symbol"?e:String(e)}function WF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Qa extends ee{constructor(e,t,s){super(),bc(this,"box",void 0),bc(this,"structure",void 0),bc(this,"filterBox",void 0),this.box=e,this.structure=t,this.filterBox=s}layout(e){let t=T.get(e),s=t.size(),r=s.height,n;this.filterBox&&this.filterBox.rendered&&(n=T.get(this.filterBox.$container).prefSize().height,r-=n),r=Math.max(r,20),T.get(this.structure.$container).setSize(new F(s.width,r)),this.filterBox&&this.filterBox.rendered&&T.get(this.filterBox.$container).setSize(new F(s.width,n))}preferredLayoutSize(e,t){t=t||{};let s,r=0,n=T.get(e),o=de.get().formRowHeight,l=this.box;t.heightHint=null,l.$label&&l.labelVisible&&(r+=de.get().fieldLabelWidth),l.$mandatory&&l.$mandatory.isVisible()&&(r+=l.$mandatory.outerWidth(!0)),l.$status&&l.statusVisible&&(r+=l.$status.outerWidth(!0));let h=T.optGet(this.structure.$container);h?s=h.prefSize(t).add(n.insets()).add(h.margins()):s=this.naturalSize(l);let d=new F(0,0);if(this.filterBox){let c=T.optGet(this.filterBox.$container);c&&(d=c.prefSize(t).add(n.insets()).add(c.margins()))}return r+=Math.max(s.width,d.width),o=Math.max(o,s.height+d.height),new F(r,o)}naturalSize(e){return new F(e.$fieldContainer.width(),e.$fieldContainer.height())}}function vc(i,e,t){return e=zF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function zF(i){var e=KF(i,"string");return typeof e=="symbol"?e:String(e)}function KF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ml{constructor(e){vc(this,"objectType",void 0),vc(this,"displayParent",void 0),vc(this,"session",void 0),this.displayParent=e.displayParent,this.session=e.session}registerAndRender(e,t,s){u.assertProperty(e,"displayParent"),e.isPopupWindow()?this._renderPopupWindow(e):e.isView()?this._renderView(e,!0,t,s):this._renderDialog(e,!0)}isFormShown(e){return e.isView()?this.displayParent.views.indexOf(e)>-1:this.displayParent.dialogs.indexOf(e)>-1}_renderPopupWindow(e,t){throw new Error("popup window only supported by DesktopFormController")}unregisterAndRemove(e){!e||(e.isPopupWindow()?this._removePopupWindow(e):e.isView()?this._removeView(e):this._removeDialog(e))}_removePopupWindow(e){throw new Error("popup window only supported by DesktopFormController")}render(){this._renderViews(),this._renderDialogs()}_renderViews(){this.displayParent.views.forEach((e,t)=>{e.setDisplayParent(this.displayParent),this._renderView(e,!1,t,!1)})}_renderDialogs(){this.displayParent.dialogs.forEach(e=>{e.setDisplayParent(this.displayParent),this._renderDialog(e,!1)})}remove(){this.displayParent.dialogs.forEach(e=>{this._removeDialog(e,!1)}),this.displayParent.views.forEach((e,t)=>{this._removeView(e,!1)})}activateForm(e){let t=this.displayParent;for(;t;){if(t instanceof bs){this.session.desktop.setOutline(t);break}t=t instanceof U?t.displayParent:null}e.displayHint===U.DisplayHint.VIEW?this._activateView(e):this._activateDialog(e)}acceptView(e,t,s,r){return this.displayParent.rendered}_renderView(e,t,s,r){if(t&&(s!==void 0?p.insert(this.displayParent.views,e,s):this.displayParent.views.push(e)),this.displayParent.acceptView){if(!this.displayParent.acceptView(e))return}else if(!this.acceptView(e))return;if(e.rendered)return;let n=this.session.desktop;if(n.displayStyle===Ie.DisplayStyle.COMPACT&&!n.bench)n.sendOutlineToBack(),n.switchToBench(!e.headerVisible);else if(n.bench.removalPending){setTimeout(this._renderView.bind(this,e,t,s,r));return}n.bench.addView(e,r)}acceptDialog(e){return this.displayParent.rendered}_renderDialog(e,t){let s=this.session.desktop;if(t&&this.displayParent.dialogs.push(e),this.displayParent.acceptDialog){if(!this.displayParent.acceptDialog(e))return}else if(!this.acceptDialog(e))return;e.rendered||(e.on("remove",()=>{let r=this._findFormToActivateAfterDialogRemove();r?s._setFormActivated(r):s._setOutlineActivated()}),e.isPopupWindow()?this._renderPopupWindow(e):(e.setTrackFocus(!0),e.render(s.$container),this._layoutDialog(e),s._setFormActivated(e),this.displayParent.inFront()||e.detach()))}_findFormToActivateAfterDialogRemove(){if(this.displayParent.dialogs.length>0)return this.displayParent.dialogs[this.displayParent.dialogs.length-1];if(this.displayParent instanceof U&&!this.displayParent.detailForm)return this.displayParent;let e=this.session.desktop;if(e.bench){let t=e.bench.activeViews()[0];if(t instanceof U&&!t.detailForm)return t}}_removeView(e,t){t=u.nvl(t,!0),t&&p.remove(this.displayParent.views,e),this.session.desktop.bench&&this.session.desktop.bench.removeView(e)}_removeDialog(e,t){t=u.nvl(t,!0),t&&p.remove(this.displayParent.dialogs,e),e.rendered&&e.remove()}_activateView(e){let t=this.session.desktop.bench;t&&t.activateView(e)}_activateDialog(e){if(e.displayParent instanceof U&&(e.displayParent.displayHint===U.DisplayHint.VIEW||e.displayParent.displayHint===U.DisplayHint.DIALOG&&e.modal)&&this.activateForm(e.displayParent),!e.rendered)return;let t=e.$container.nextAll().toArray(),s=t.filter(function(n){let o=u.widget(n);return o instanceof U&&(!o.modal||!e.has(o)&&o.displayParent!==this.session.desktop)},this),r=t.filter(n=>p.find(s,o=>{let l=u.widget(n);return!(l instanceof U)&&u.widget(o).has(l)}));s=s.concat(r),this.session.desktop.moveOverlaysBehindAndFocus(s,e.$container)}attachDialogs(){this.displayParent.dialogs.forEach(e=>{e.attach()},this)}detachDialogs(){this.displayParent.dialogs.forEach(e=>{e.detach()},this)}_layoutDialog(e){e.htmlComp.validateLayout(),e.position(),this.session.focusManager.validateFocus(),e.animateOpening&&e.$container.addClassForAnimation("animate-open")}}function tt(i,e,t){return e=GF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function GF(i){var e=UF(i,"string");return typeof e=="symbol"?e:String(e)}function UF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class vi extends I{constructor(){super(),tt(this,"severity",void 0),tt(this,"body",void 0),tt(this,"iconId",void 0),tt(this,"header",void 0),tt(this,"hiddenText",void 0),tt(this,"html",void 0),tt(this,"yesButtonText",void 0),tt(this,"noButtonText",void 0),tt(this,"cancelButtonText",void 0),tt(this,"buttons",void 0),tt(this,"boxButtons",void 0),tt(this,"yesButton",void 0),tt(this,"noButton",void 0),tt(this,"cancelButton",void 0),tt(this,"displayParent",void 0),tt(this,"abortButton",void 0),tt(this,"$content",void 0),tt(this,"$header",void 0),tt(this,"$body",void 0),tt(this,"$html",void 0),tt(this,"$hiddenText",void 0),tt(this,"$buttons",void 0),tt(this,"_icon",void 0),tt(this,"_glassPaneRenderer",void 0),this.severity=E.Severity.INFO,this.body=null,this.iconId=null,this.header=null,this.hiddenText=null,this.html=null,this.yesButtonText=null,this.noButtonText=null,this.cancelButtonText=null,this.displayParent=null,this.buttons=[],this.boxButtons=null,this.yesButton=null,this.noButton=null,this.cancelButton=null,this.abortButton=null,this.inheritAccessibility=!1,this.$content=null,this.$header=null,this.$body=null,this.$hiddenText=null,this.$buttons=null,this.$html=null,this._icon=null,this._addWidgetProperties(["buttons","boxButtons","yesButton","noButton","cancelButton","abortButton"])}_init(e){super._init(e),this._setDisplayParent(this.displayParent),this._setIconId(this.iconId),this.boxButtons=u.create(Xo,{parent:this}),this.yesButton=this._createMessageBoxButton(this.yesButtonText,vi.Buttons.YES),this.noButton=this._createMessageBoxButton(this.noButtonText,vi.Buttons.NO),this.cancelButton=this._createMessageBoxButton(this.cancelButtonText,vi.Buttons.CANCEL)}_createKeyStrokeContext(){return new Oe}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.registerKeyStrokes([new Tc(this),new sa(this.session,this),new jo(this,[g.SPACE,g.ENTER]),new ra(this,()=>this.abortButton?this.abortButton.$container:null)])}_createMessageBoxButton(e,t){if(!e)return null;let s=this.boxButtons.addButton({text:e});return s.one("action",r=>this._onButtonClick(r,t)),this.buttons.push(s),this.abortButton=s,s}_render(){this.$container=this.$parent.appendDiv("messagebox").on("mousedown",this._onMouseDown.bind(this)).on("copy",this._onCopy.bind(this));let e=this.$container.appendDiv("drag-handle");this.$container.draggable(e),this.$content=this.$container.appendDiv("messagebox-content"),this.$header=this.$content.appendDiv("messagebox-label messagebox-header"),this.$body=this.$content.appendDiv("messagebox-label messagebox-body"),this.$html=this.$content.appendDiv("messagebox-label messagebox-html prevent-initial-focus"),this.boxButtons.render(),this.$buttons=this.boxButtons.$container,this.$buttons.addClass("messagebox-buttons"),this.$buttons.on("copy",this._onCopy.bind(this)),this._installScrollbars({axis:"y",scrollShadow:"none"}),this._renderSeverity(),this._renderHeader(),this._renderIconId(),this._renderBody(),this._renderHtml(),this._renderHiddenText(),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new wc(this)),this.htmlComp.validateLayout(),this.$container.addClassForAnimation("animate-open"),this._glassPaneRenderer=new Zr(this),this._glassPaneRenderer.renderGlassPanes()}get$Scrollable(){return this.$content}_postRender(){super._postRender(),this._installFocusContext()}_remove(){this._glassPaneRenderer.removeGlassPanes(),this._uninstallFocusContext(),super._remove()}_installFocusContext(){this.session.focusManager.installFocusContext(this.$container,Mt.AUTO)}_uninstallFocusContext(){this.session.focusManager.uninstallFocusContext(this.$container)}_renderIconId(){let e=!!this._icon;this.$container.toggleClass("has-icon",e),this.$container.toggleClass("no-icon",!e),e&&(this._icon.render(this.$header),this._icon.$container.addClass("messagebox-icon"))}_renderSeverity(){this.$container.removeClass(E.SEVERITY_CSS_CLASSES),this.$container.addClass(E.cssClassForSeverity(this.severity))}_renderHeader(){this.$header.html(y.nl2br(this.header)),this.$header.setVisible(!!this.header||!!this.iconId),this.$header.toggleClass("has-text",y.hasText(this.header))}_renderBody(){this.$body.html(y.nl2br(this.body)),this.$body.setVisible(!!this.body),this.$content.toggleClass("has-body",!!this.body)}_renderHtml(){this.$html.html(this.html),this.$html.setVisible(!!this.html),this.$html.find("a, .app-link").attr("tabindex","0").unfocusable()}_renderHiddenText(){this.$hiddenText&&this.$hiddenText.remove(),this.hiddenText&&(this.$hiddenText=this.$content.appendElement(`<!-- 
`+this.hiddenText.replace(/<!--|-->/g,"")+`
 -->`))}_onMouseDown(){let e=this.findParent(t=>t instanceof U&&t.isDialog());e&&e.activate()}_setCopyable(e){this.$header.toggleClass("copyable",e),this.$body.toggleClass("copyable",e),this.$html.toggleClass("copyable",e)}copy(){this._setCopyable(!0);let e=this.$container.document(!0),t=e.createRange();t.selectNodeContents(this.$content[0]);let s=this.$container.window(!0).getSelection();s.removeAllRanges(),s.addRange(t),e.execCommand("copy")}_onCopy(e){let t=b.optProperty(e,"originalEvent","clipboardData");if(t){let s=y.join("<br/>",this.$header[0].outerHTML,this.$body[0].outerHTML,this.$html[0].outerHTML,this.hiddenText);t.setData("text/html",s);let r=y.join(`

`,this.header,this.body,y.plainText(this.$html[0].outerHTML,{compact:!0,trim:!0}),this.hiddenText);t.setData("text/plain",r),this.$container.window(!0).getSelection().removeAllRanges(),this._setCopyable(!1),rs.showNotification(this),e.preventDefault()}}_onButtonClick(e,t){this.trigger("action",{option:t})}setDisplayParent(e){this.setProperty("displayParent",e)}_setDisplayParent(e){this._setProperty("displayParent",e),e&&this.setParent(this.findDesktop().computeParentForDisplayParent(e))}setIconId(e){this.setProperty("iconId",e)}_setIconId(e){this._setProperty("iconId",e),e?this._icon?this._icon.setIconDesc(e):(this._icon=u.create(Zs,{parent:this,iconDesc:e,prepend:!0}),this._icon.one("destroy",()=>{this._icon=null})):this._icon&&this._icon.destroy()}open(){this.setDisplayParent(this.displayParent||this.session.desktop),this.displayParent.messageBoxController.registerAndRender(this)}close(){this.displayParent&&this.displayParent.messageBoxController.unregisterAndRemove(this),this.destroy()}abort(){this.abortButton&&this.abortButton.$container&&this.session.focusManager.requestFocus(this.abortButton.$container)&&this.abortButton.doAction()}_attach(){this.$parent.append(this.$container),super._attach()}_detach(){this.$container.detach(),super._detach()}}tt(vi,"Buttons",{YES:"yes",NO:"no",CANCEL:"cancel"});class Ig extends ke{_onWidgetAction(e){this._send("action",{option:e.option})}_onWidgetEvent(e){e.type==="action"?this._onWidgetAction(e):super._onWidgetEvent(e)}}function Lg(i,e,t){return e=qF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function qF(i){var e=YF(i,"string");return typeof e=="symbol"?e:String(e)}function YF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class gl{constructor(e,t){Lg(this,"displayParent",void 0),Lg(this,"session",void 0),this.displayParent=e,this.session=t}registerAndRender(e){u.assertProperty(e,"displayParent"),this.displayParent.messageBoxes.push(e),this._render(e)}unregisterAndRemove(e){e&&(p.remove(this.displayParent.messageBoxes,e),this._remove(e))}remove(){this.displayParent.messageBoxes.forEach(this._remove.bind(this))}render(){this.displayParent.messageBoxes.forEach(e=>{e.setDisplayParent(this.displayParent),this._render(e)})}_render(e){if(e.displayParent||e._setProperty("displayParent",this.displayParent),this.displayParent.acceptView){if(!this.displayParent.acceptView(e))return}else if(!this.acceptView(e))return;if(e.rendered)return;let t;this.displayParent instanceof U&&this.displayParent.isPopupWindow()?t=this.displayParent.popupWindow.$container:t=this.session.desktop.$container,e.setTrackFocus(!0),e.render(t),this.displayParent.inFront()||e.detach()}_remove(e){e.remove()}attach(){this.displayParent.messageBoxes.forEach(e=>e.attach())}detach(){this.displayParent.messageBoxes.forEach(e=>e.detach())}acceptView(e){return this.displayParent.rendered}}function gs(i,e,t){return e=jF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function jF(i){var e=XF(i,"string");return typeof e=="symbol"?e:String(e)}function XF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class rr{constructor(){gs(this,"objectType",void 0),gs(this,"parent",void 0),gs(this,"yesText",void 0),gs(this,"noText",void 0),gs(this,"cancelText",void 0),gs(this,"bodyText",void 0),gs(this,"severity",void 0),gs(this,"headerText",void 0),gs(this,"iconId",void 0),gs(this,"closeOnClick",void 0),gs(this,"html",void 0),this.parent=null,this.yesText=null,this.noText=null,this.cancelText=null,this.bodyText=null,this.severity=E.Severity.INFO,this.headerText=null,this.iconId=null,this.closeOnClick=!0,this.html=!1}init(e){u.assertParameter("parent",e.parent),a().extend(this,e)}withHeader(e){return this.headerText=e,this}withBody(e,t){return this.bodyText=e,this.html=u.nvl(t,!1),this}withIconId(e){return this.iconId=e,this}withSeverity(e){return this.severity=u.nvl(e,E.Severity.INFO),this}withYes(e){return this.yesText=u.nvl(e,this.parent.session.text("Yes")),this}withNo(e){return this.noText=u.nvl(e,this.parent.session.text("No")),this}withCancel(e){return this.cancelText=u.nvl(e,this.parent.session.text("Cancel")),this}build(){let e={parent:this.parent,header:this.headerText,body:this.bodyText,severity:this.severity};return y.hasText(this.iconId)&&(e.iconId=this.iconId),y.hasText(this.yesText)&&(e.yesButtonText=this.yesText),y.hasText(this.noText)&&(e.noButtonText=this.noText),y.hasText(this.cancelText)&&(e.cancelButtonText=this.cancelText),this.html&&(e.html=e.body,delete e.body),u.create(vi,e)}buildAndOpen(){let e=a().Deferred(),t=this.build();return t.on("action",s=>{this.closeOnClick&&t.close(),e.resolve(s.option)}),t.open(),e.promise()}static create(e){return u.create(rr,{parent:e})}static createOk(e){return this.create(e).withYes(e.session.text("Ok"))}static createYesNo(e){return this.create(e).withYes().withNo()}static createYesNoCancel(e){return this.create(e).withYes().withNo().withCancel()}static openOk(e,t,s){return this.createOk(e).withBody(t).withSeverity(s).buildAndOpen()}static openYesNo(e,t,s){return this.createYesNo(e).withBody(t).withSeverity(s).buildAndOpen()}}function JF(i,e,t){return e=QF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function QF(i){var e=ZF(i,"string");return typeof e=="symbol"?e:String(e)}function ZF(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class wc extends ee{constructor(e){super(),JF(this,"messageBox",void 0),this.messageBox=e}layout(e){let t=T.get(e),s=e.windowSize(),r=t.offsetBounds(!0),n=t.size(),o=t.margins();n=ds.fitContainerInWindow(s,r.point(),n,o),e.toggleClass("full-width",r.x===0&&o.horizontal()===0&&s.width===n.width).toggleClass("full-height",r.y===0&&o.vertical()===0&&s.height===n.height),v.setSize(e,n);let l=v.size(this.messageBox.$buttons,{exact:!0});this.messageBox.$content.css("height","calc(100% - "+l.height+"px)"),P.update(this.messageBox.$content),e.cssPosition(ds.positionContainerInWindow(e))}}class Tc extends O{constructor(e){super(),this.field=e,this.which=[g.C],this.ctrl=!0,this.preventDefault=!1,this.renderingHints.render=!0,this.renderingHints.$drawingArea=(t,s)=>e.$container}handle(e){this.field.copy()}}function Og(i,e,t){return e=e0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function e0(i){var e=t0(i,"string");return typeof e=="symbol"?e:String(e)}function t0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Bg extends A{constructor(){super(),Og(this,"accordion",void 0),Og(this,"eventDelegator",void 0),this.accordion=null,this.eventDelegator=null,this._addWidgetProperties(["accordion"])}_init(e){super._init(e),this._setAccordion(this.accordion)}_createLoadingSupport(){return null}_render(){this.addContainer(this.$parent,"accordion-field"),this.addLabel(),this.addMandatoryIndicator(),this.addStatus(),this.accordion&&this._renderAccordion()}_renderProperties(){super._renderProperties(),this._renderDropType()}setAccordion(e){this.setProperty("accordion",e)}_setAccordion(e){this.accordion&&this.eventDelegator&&(this.eventDelegator.destroy(),this.eventDelegator=null),this._setProperty("accordion",e),e&&(this.eventDelegator=is.create(this,e,{delegateProperties:["loading"]}),e.setLoading(this.loading),e.setScrollTop(this.scrollTop))}_renderAccordion(){!this.accordion||(this.accordion.render(),this.addField(this.accordion.$container),this.invalidateLayoutTree())}_removeAccordion(){!this.accordion||(this.accordion.remove(),this._removeField(),this.invalidateLayoutTree())}getFocusableElement(){return this.accordion?this.accordion.getFocusableElement():null}getDelegateScrollable(){return this.accordion}}class kg extends at{}class Hg extends me{constructor(){super(),this.preventInitialFocus=!0}_render(){this.addContainer(this.$parent,"bean-field"),this.addLabel(),this.addField(this.$parent.makeDiv()),this.addStatus()}_renderProperties(){super._renderProperties(),this._renderValue()}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.registerKeyStroke(new po(this,this._onAppLinkAction))}_formatValue(e){return this.displayText}_parseValue(e){return this.value}_readDisplayText(){return this.displayText}_renderDisplayText(){}_renderValue(){}triggerAppLinkAction(e){this.trigger("appLinkAction",{ref:e})}_onAppLinkAction(e){let s=a()(e.delegateTarget).data("ref");this.triggerAppLinkAction(s)}}class Ng extends Ot{_onWidgetAppLinkAction(e){this._send("appLinkAction",{ref:e.ref})}_onWidgetEvent(e){e.type==="appLinkAction"?this._onWidgetAppLinkAction(e):super._onWidgetEvent(e)}}function Bt(i,e,t){return e=i0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function i0(i){var e=s0(i,"string");return typeof e=="symbol"?e:String(e)}function s0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class bn extends A{constructor(){super(),Bt(this,"autoCloseExternalWindow",void 0),Bt(this,"externalWindowButtonText",void 0),Bt(this,"externalWindowFieldText",void 0),Bt(this,"location",void 0),Bt(this,"trackLocation",void 0),Bt(this,"sandboxEnabled",void 0),Bt(this,"sandboxPermissions",void 0),Bt(this,"trustedMessageOrigins",void 0),Bt(this,"scrollBarEnabled",void 0),Bt(this,"showInExternalWindow",void 0),Bt(this,"iframe",void 0),Bt(this,"myWindow",void 0),Bt(this,"_messageListener",void 0),Bt(this,"_popupWindow",void 0),Bt(this,"_externalWindowTextField",void 0),Bt(this,"_externalWindowButton",void 0),this.autoCloseExternalWindow=!1,this.externalWindowButtonText=null,this.externalWindowFieldText=null,this.location=null,this.trackLocation=!1,this.sandboxEnabled=!0,this.sandboxPermissions=null,this.trustedMessageOrigins=[],this.scrollBarEnabled=!0,this.showInExternalWindow=!1,this._messageListener=null,this._popupWindow=null,this._externalWindowTextField=null,this._externalWindowButton=null}_init(e){super._init(e),this.iframe=u.create(vd,{parent:this,location:this.location,sandboxEnabled:this.sandboxEnabled,sandboxPermissions:this.sandboxPermissions,scrollBarEnabled:this.scrollBarEnabled,trackLocation:this.trackLocation}),this.iframe.on("propertyChange",this._onIFramePropertyChange.bind(this))}_render(){this.addContainer(this.$parent,"browser-field",new Cc(this)),this.addLabel(),this.addStatus(),this.showInExternalWindow?(this.addField(this.$parent.makeDiv()),this._externalWindowTextField=this.$field.appendDiv().addClass("alt"),this._externalWindowButton=this.$field.appendDiv().addClass("button").on("click",e=>this._openPopupWindow(!0))):(this.iframe.render(),this.addFieldContainer(this.iframe.$container),this.addField(this.iframe.$iframe),this.$field.on("load",this._onLoad.bind(this))),this.myWindow=this.$parent.window(!0),this._messageListener=this._onMessage.bind(this),this.myWindow.addEventListener("message",this._messageListener),this.enabledComputed&&setTimeout(this._openPopupWindow.bind(this,!0),20)}_renderProperties(){super._renderProperties(),this._renderExternalWindowButtonText(),this._renderExternalWindowFieldText()}_remove(){super._remove(),this.myWindow.removeEventListener("message",this._messageListener),this._messageListener=null,this.showInExternalWindow&&this.autoCloseExternalWindow&&this._popupWindow&&!this._popupWindow.closed&&this._popupWindow.close()}setLocation(e){this.setProperty("location",e),this.iframe.setLocation(e)}_renderLocation(){let e=this.location||"about:blank";this.showInExternalWindow&&this._popupWindow&&!this._popupWindow.closed&&(this._popupWindow.location=e)}setAutoCloseExternalWindow(e){this.setProperty("autoCloseExternalWindow",e)}setExternalWindowButtonText(e){this.setProperty("externalWindowButtonText",e)}_renderExternalWindowButtonText(){this.showInExternalWindow&&this._externalWindowButton.text(this.externalWindowButtonText||"")}setExternalWindowFieldText(e){this.setProperty("externalWindowFieldText",e)}_renderExternalWindowFieldText(){this.showInExternalWindow&&this._externalWindowTextField.text(this.externalWindowFieldText||"")}_calcPopupBounds(){let e=this.$container.window(!0),r=30+8,n=55,o=new ie(e.screenX,e.screenY,a()(e).width(),a()(e).height()+n),l=new ie(this.$field.offset().left,this.$field.offset().top,this.$field.width(),this.$field.height()),h=o.x+l.x,d=o.y+l.y+n,c=l.width,f=l.height+r,m=d+f,_=o.y+o.height;return m>_&&(f-=m-_+r),new ie(Ke.round(h),Ke.round(d),Ke.round(c),Ke.round(f))}_openPopupWindow(e){if(e=u.nvl(e,!0),!!this.showInExternalWindow)if(!this._popupWindow||e&&this._popupWindow.closed){let t=u.create(Do,{session:this.session}),s=this._calcPopupBounds(),r=y.join(",","directories=no","location=no","menubar=no","resizable=yes","status=no","scrollbars="+(this.scrollBarEnabled?"yes":"no"),"toolbar=no","dependent=yes","left="+s.x,"top="+s.y,"width="+s.width,"height="+s.height),n=this.location||"about:blank";t.openWindow(n,void 0,r,this._popupWindowOpen.bind(this))}else e&&this._popupWindow.focus()}_popupWindowOpen(e){if(this._popupWindow=e,this._popupWindow&&!this._popupWindow.closed){this.trigger("externalWindowStateChange",{windowState:bn.WindowStates.WINDOW_OPEN});let t=window.setInterval(()=>{let s=!1;try{s=this._popupWindow===null||this._popupWindow.closed}catch{a().log.isInfoEnabled()&&a().log.info("Reading the property popupWindow.closed threw an error (Retry in 500ms)");return}s&&(window.clearInterval(t),this.trigger("externalWindowStateChange",{windowState:bn.WindowStates.WINDOW_CLOSED}))},500)}}_onMessage(e){if(!!this._isValidMessageSource(e.source)){if(this.trustedMessageOrigins&&this.trustedMessageOrigins.length&&!this.trustedMessageOrigins.some(t=>t===e.origin)){a().log.warn("blocked message from untrusted origin "+e.origin);return}a().log.isDebugEnabled()&&a().log.debug("received post-message: data="+e.data+", origin="+e.origin),this.trigger("message",{data:e.data,origin:e.origin})}}_isValidMessageSource(e){let t=this.$field[0].contentWindow;if(e===t)return!0;let s=e;for(;s&&s!==s.parent;)if(s=s.parent,s===t)return!0;return!1}postMessage(e,t){a().log.isDebugEnabled()&&a().log.debug("send post-message: message="+e+", targetOrigin="+t),this.iframe&&this.iframe.postMessage(e,t)}setTrackLocation(e){this.setProperty("trackLocation",e),this.iframe.setTrackLocation(e)}_onIFramePropertyChange(e){!this.trackLocation||e.propertyName==="location"&&this._setProperty("location",e.newValue)}_onLoad(e){!this.rendered||this.invalidateLayoutTree()}setSandboxEnabled(e){this.setProperty("sandboxEnabled",e),this.iframe.setSandboxEnabled(e)}setSandboxPermissions(e){this.setProperty("sandboxPermissions",e),this.iframe.setSandboxPermissions(e)}setScrollBarEnabled(e){this.setProperty("scrollBarEnabled",e),this.iframe.setScrollBarEnabled(e)}}Bt(bn,"WindowStates",{WINDOW_OPEN:"true",WINDOW_CLOSED:"false"});class Vg extends at{constructor(){super(),this._addRemoteProperties(["location"])}_onWidgetMessage(e){this._send("postMessage",{data:e.data,origin:e.origin})}_onWidgetExternalWindowStateChange(e){this._send("externalWindowStateChange",{windowState:e.windowState})}_onWidgetEvent(e){e.type==="message"?this._onWidgetMessage(e):e.type==="externalWindowStateChange"?this._onWidgetExternalWindowStateChange(e):super._onWidgetEvent(e)}_onModelPostMessage(e){this.widget.postMessage(e.message,e.targetOrigin)}onModelAction(e){e.type==="postMessage"?this._onModelPostMessage(e):super.onModelAction(e)}_orderPropertyNamesOnSync(e){return Object.keys(e).sort(this._createPropertySortFunc(["scrollBarEnabled","location"]))}}function r0(i,e,t){return e=n0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function n0(i){var e=o0(i,"string");return typeof e=="symbol"?e:String(e)}function o0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Cc extends oi{constructor(e){super(e),r0(this,"browserField",void 0),this.browserField=e}preferredLayoutSize(e,t){let s=super.preferredLayoutSize(e,t);return this._isIFrameReadable()&&(s.height=this.browserField.$field.contents().height()+this.browserField.iframe.htmlComp.insets().vertical()+this.browserField.htmlComp.insets().vertical()),s}_isIFrameReadable(){let e=this.browserField,t=e.sandboxPermissions;if(e.sandboxEnabled&&t&&t.indexOf("allow-same-origin")===-1)return a().log.isWarnEnabled()&&a().log.warn('Access to IFrame denied, cannot read height. Reason: sandbox is enabled or "allow-same-origin" is not set'),!1;try{e.$field[0].contentWindow.document}catch{return a().log.isWarnEnabled()&&a().log.warn("Access to IFrame denied, cannot read height. Reason: denied by browser"),!1}return e.$field.contents().attr("readyState")==="loading"?(a().log.isWarnEnabled()&&a().log.warn('Access to IFrame denied, cannot read height. Reason: readyState == "loading"'),!1):!0}}function ut(i,e,t){return e=l0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function l0(i){var e=a0(i,"string");return typeof e=="symbol"?e:String(e)}function a0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Re extends A{constructor(){super(),ut(this,"defaultButton",void 0),ut(this,"displayStyle",void 0),ut(this,"iconId",void 0),ut(this,"keyStroke",void 0),ut(this,"keyStrokeScope",void 0),ut(this,"processButton",void 0),ut(this,"selected",void 0),ut(this,"systemType",void 0),ut(this,"preventDoubleClick",void 0),ut(this,"stackable",void 0),ut(this,"shrinkable",void 0),ut(this,"adaptedBy",void 0),ut(this,"buttonKeyStroke",void 0),ut(this,"formKeyStrokeContext",void 0),ut(this,"popup",void 0),ut(this,"$buttonLabel",void 0),ut(this,"$submenuIcon",void 0),ut(this,"_doubleClickSupport",void 0),this.adaptedBy=null,this.defaultButton=!1,this.displayStyle=Re.DisplayStyle.DEFAULT,this.gridDataHints.fillHorizontal=!1,this.iconId=null,this.keyStroke=null,this.keyStrokeScope=null,this.processButton=!0,this.selected=!1,this.statusVisible=!1,this.systemType=Re.SystemType.NONE,this.preventDoubleClick=!1,this.stackable=!0,this.shrinkable=!1,this.$buttonLabel=null,this.buttonKeyStroke=new mo(this,null),this._doubleClickSupport=new Vr,this._addCloneProperties(["defaultButton","displayStyle","iconId","keyStroke","processButton","selected","systemType","preventDoubleClick","stackable","shrinkable"])}_init(e){super._init(e),this.resolveIconIds(["iconId"]),this._setKeyStroke(this.keyStroke),this._setKeyStrokeScope(this.keyStrokeScope),this._setInheritAccessibility(this.inheritAccessibility&&!this._isIgnoreAccessibilityFlags())}getContextMenuItems(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return[]}_initKeyStrokeContext(){super._initKeyStrokeContext(),this._initDefaultKeyStrokes(),this.formKeyStrokeContext=new Oe,this.formKeyStrokeContext.invokeAcceptInputOnActiveValueField=!0,this.formKeyStrokeContext.registerKeyStroke(this.buttonKeyStroke),this.formKeyStrokeContext.$bindTarget=()=>{if(this.keyStrokeScope)return this.keyStrokeScope.$container;let e=this.getForm();return e?e.$container:this.session.desktop.$container}}_isIgnoreAccessibilityFlags(){return this.systemType===Re.SystemType.CANCEL||this.systemType===Re.SystemType.CLOSE}_initDefaultKeyStrokes(){this.keyStrokeContext.registerKeyStrokes([new mo(this,"ENTER"),new mo(this,"SPACE")])}_createLoadingSupport(){return new ss({widget:this,$container:()=>this.$field})}_render(){let e;if(this.displayStyle===Re.DisplayStyle.LINK?(e=this.$parent.makeDiv("link-button menu-item"),this.$buttonLabel=e.appendSpan("button-label text")):(e=this.$parent.makeElement("<button>").addClass("button"),this.displayStyle===Re.DisplayStyle.BORDERLESS&&e.addClass("borderless"),this.$buttonLabel=e.appendSpan("button-label text"),x.get().supportsOnlyTouch()&&e.setTabbable(!1)),this.addContainer(this.$parent,"button-field",new Za(this)),this.addField(e),this.addStatus(),e.on("mousedown",t=>this._doubleClickSupport.mousedown(t)).on("click",this._onClick.bind(this)).unfocusable(),this.menus&&this.menus.length>0&&(this.menus.forEach(t=>this.keyStrokeContext.registerKeyStroke(t)),this.label||!this.iconId)){let t=ye.parseIconId(Re.SUBMENU_ICON);this.$submenuIcon=e.appendSpan("submenu-icon").text(t.iconCharacter)}this.session.keyStrokeManager.installKeyStrokeContext(this.formKeyStrokeContext),K.installForEllipsis(this.$buttonLabel,{parent:this})}_remove(){super._remove(),K.uninstall(this.$buttonLabel),this.session.keyStrokeManager.uninstallKeyStrokeContext(this.formKeyStrokeContext),this.$submenuIcon=null}_renderProperties(){super._renderProperties(),this._renderIconId(),this._renderSelected(),this._renderDefaultButton()}_renderForegroundColor(){super._renderForegroundColor(),M.legacyForegroundColor(this,this.$buttonLabel),M.legacyForegroundColor(this,this.get$Icon()),M.legacyForegroundColor(this,this.$submenuIcon)}_renderBackgroundColor(){super._renderBackgroundColor(),M.legacyBackgroundColor(this,this.$fieldContainer)}_renderFont(){super._renderFont(),M.legacyFont(this,this.$buttonLabel),this.invalidateLayoutTree()}doAction(){return!this.enabledComputed||!this.visible?!1:(this.displayStyle===Re.DisplayStyle.TOGGLE?this.setSelected(!this.selected):this.menus.length>0&&this.togglePopup(),this._doAction(),!0)}_doAction(){this.trigger("click")}togglePopup(){this.popup?this.popup.close():(this.popup=this._openPopup(),this.popup.one("destroy",e=>{this.popup=null}))}_openPopup(){let e=u.create(ft,{parent:this,menuItems:this.menus,cloneMenuItems:!1,closeOnAnchorMouseDown:!1,$anchor:this.$field});return e.open(),e}_doActionTogglesSubMenu(){return!1}setDefaultButton(e){this.setProperty("defaultButton",e)}_renderDefaultButton(){this.$field.toggleClass("default",this.defaultButton)}_renderEnabled(){super._renderEnabled(),this.displayStyle===Re.DisplayStyle.LINK&&this.$field.setTabbable(this.enabledComputed&&!x.get().supportsOnlyTouch())}setSelected(e){this.setProperty("selected",e)}_renderSelected(){this.displayStyle===Re.DisplayStyle.TOGGLE&&this.$field.toggleClass("selected",this.selected)}_renderLabel(){this.$buttonLabel.contentOrNbsp(this.labelHtmlEnabled,this.label,"empty"),this._updateLabelAndIconStyle(),this.invalidateLayoutTree()}setIconId(e){this.setProperty("iconId",e)}_renderIconId(){let e=this.$fieldContainer;e.icon(this.iconId);let t=e.data("$icon");t&&(t.removeClass("loading broken"),t.is("img")&&(t.addClass("loading"),t.off("load error").on("load",s.bind(this,!0)).on("error",s.bind(this,!1))),this.rendered||M.legacyForegroundColor(this,t)),this._updateLabelAndIconStyle(),this.invalidateLayoutTree();function s(r){t.removeClass("loading"),t.toggleClass("broken",!r),this.invalidateLayoutTree()}}get$Icon(){return this.$fieldContainer.children(".icon")}_updateLabelAndIconStyle(){let e=!!this.label;this.$buttonLabel.setVisible(e||!this.iconId),this.get$Icon().toggleClass("with-label",e)}setKeyStroke(e){this.setProperty("keyStroke",e)}_setKeyStroke(e){this._setProperty("keyStroke",e),this.buttonKeyStroke.parseAndSetKeyStroke(this.keyStroke)}_setKeyStrokeScope(e){typeof e=="string"&&(e=this._resolveKeyStrokeScope(e),!e)||this._setProperty("keyStrokeScope",e)}_resolveKeyStrokeScope(e){let t=this.findNonWrappedForm();if(!t)throw new Error("Could not resolve keyStrokeScope "+e+" because no form has been found.");if(!t.initialized){t.one("init",this._setKeyStrokeScope.bind(this,e));return}let s=t.widget(e);if(!s)throw new Error("Could not resolve keyStrokeScope "+e+" using form "+t);return s}_onClick(e){e.which===1&&(this.preventDoubleClick&&this._doubleClickSupport.doubleClicked()||(K.cancel(this.$buttonLabel),K.cancel(this.$fieldContainer),this.enabledComputed&&this.doAction()))}setStackable(e){this.setProperty("stackable",e)}setShrinkable(e){this.setProperty("shrinkable",e)}setPreventDoubleClick(e){this.setProperty("preventDoubleClick",e)}getFocusableElement(){return this.adaptedBy?this.adaptedBy.getFocusableElement():super.getFocusableElement()}isFocusable(e){return this.adaptedBy?this.adaptedBy.isFocusable():super.isFocusable()}focus(){return this.adaptedBy?this.adaptedBy.focus():super.focus()}}ut(Re,"SystemType",{NONE:0,CANCEL:1,CLOSE:2,OK:3,RESET:4,SAVE:5,SAVE_WITHOUT_MARKER_CHANGE:6}),ut(Re,"DisplayStyle",{DEFAULT:0,TOGGLE:1,RADIO:2,LINK:3,BORDERLESS:4}),ut(Re,"SUBMENU_ICON",ye.ANGLE_DOWN_BOLD);class Za extends oi{constructor(e){super(e)}layout(e){super.layout(e);let t=this.formField.get$Icon(),s=this.formField.$submenuIcon,r=this.formField.$buttonLabel,n=this.formField.$fieldContainer;r.css("max-width","");let o=s?v.size(s,{includeMargin:!0,exact:!0}).width:0,l=t.length?v.size(t,{includeMargin:!0,exact:!0}).width:0,h=Math.ceil(n.width()-(o+l));r.css("max-width",h)}preferredLayoutSize(e,t){let s=this.formField.$buttonLabel,r=s.css("max-width");s.css("max-width","");let n=super.preferredLayoutSize(e,t);return s.css("max-width",r),n}}class Sc extends at{constructor(){super(),this._addRemoteProperties(["selected"])}_onWidgetClick(e){this.widget.displayStyle===Re.DisplayStyle.TOGGLE||this.widget.menus.length>0||this._send("click")}_onWidgetEvent(e){e.type==="click"?this._onWidgetClick(e):super._onWidgetEvent(e)}}class mo extends O{constructor(e,t){super(),this.field=e,this.parseAndSetKeyStroke(t),this.stopPropagation=!0,this.stopImmediatePropagation=!0,this.renderingHints.hAlign=ht.RIGHT}_accept(e){return super._accept(e)&&this.field.$field.isAttached()}handle(e){this.field.doAction()}}function h0(i,e,t){return e=d0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function d0(i){var e=u0(i,"string");return typeof e=="symbol"?e:String(e)}function u0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Wg extends A{constructor(){super(),h0(this,"calendar",void 0),this.gridDataHints.weightY=1,this._addWidgetProperties(["calendar"])}_render(){this.addContainer(this.$parent,"calendar-field"),this.$container.toggleClass("mobile",x.get().type===x.Type.MOBILE),this.addLabel(),this.addStatus(),this.calendar&&(this.calendar.render(),this.addField(this.calendar.$container))}}class zg extends at{}function c0(i,e,t){return e=p0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function p0(i){var e=f0(i,"string");return typeof e=="symbol"?e:String(e)}function f0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Kg extends A{constructor(){super(),c0(this,"carousel",void 0),this.gridDataHints.weightY=1,this._addWidgetProperties(["carousel"])}_render(){this.addContainer(this.$parent,"carousel-field"),this.addLabel(),this.addMandatoryIndicator(),this.addStatus(),this.carousel&&this._renderCarousel()}_renderCarousel(){this.carousel.render(),this.addField(this.carousel.$container)}_removeCarousel(){this.carousel&&this.carousel.remove(),this._removeField()}}function vn(i,e,t){return e=m0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function m0(i){var e=g0(i,"string");return typeof e=="symbol"?e:String(e)}function g0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Dr extends me{constructor(){super(),vn(this,"triStateEnabled",void 0),vn(this,"wrapText",void 0),vn(this,"keyStroke",void 0),vn(this,"checkBoxKeyStroke",void 0),vn(this,"formKeyStrokeContext",void 0),vn(this,"$checkBox",void 0),vn(this,"$checkBoxLabel",void 0),this.triStateEnabled=!1,this.wrapText=!1,this.keyStroke=null,this.checkBoxKeyStroke=new eh(this),this.$checkBox=null,this.$checkBoxLabel=null}_init(e){super._init(e),this._setKeyStroke(this.keyStroke)}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.registerKeyStroke(new eh(this)),this.formKeyStrokeContext=new Oe,this.formKeyStrokeContext.invokeAcceptInputOnActiveValueField=!0,this.formKeyStrokeContext.registerKeyStroke(this.checkBoxKeyStroke),this.formKeyStrokeContext.$bindTarget=()=>{let e=this.getForm();return e?e.$container:this.session.desktop.$container}}_render(){this.addContainer(this.$parent,"check-box-field"),this.addLabel(),this.addMandatoryIndicator(),this.addFieldContainer(this.$parent.makeDiv()),this.$checkBox=this.$fieldContainer.appendDiv("check-box").on("mousedown",this._onMouseDown.bind(this)).data("valuefield",this),this.addField(this.$checkBox),this.$checkBoxLabel=this.$fieldContainer.appendDiv("label").on("mousedown",this._onMouseDown.bind(this)),Z.linkElementWithLabel(this.$checkBox,this.$checkBoxLabel),K.installForEllipsis(this.$checkBoxLabel,{parent:this}),this.addStatus(),this.session.keyStrokeManager.installKeyStrokeContext(this.formKeyStrokeContext)}_renderProperties(){super._renderProperties(),this._renderValue(),this._renderWrapText()}_remove(){K.uninstall(this.$checkBoxLabel),this.session.keyStrokeManager.uninstallKeyStrokeContext(this.formKeyStrokeContext),super._remove()}_renderDisplayText(){}setValue(e){this.setProperty("value",e)}_renderValue(){this.$fieldContainer.toggleClass("checked",this.value===!0),this.$checkBox.toggleClass("checked",this.value===!0),this.$checkBox.toggleClass("undefined",this.triStateEnabled&&this.value!==!0&&this.value!==!1)}_renderEnabled(){super._renderEnabled(),this.$checkBox.setTabbable(this.enabledComputed&&!x.get().supportsOnlyTouch()).setEnabled(this.enabledComputed)}setTriStateEnabled(e){this.setProperty("triStateEnabled",e),this.rendered&&this._renderValue()}_renderLabel(){this.$checkBoxLabel.contentOrNbsp(this.labelHtmlEnabled,this.label,"empty"),this._renderEmptyLabel()}_renderFont(){M.legacyFont(this,this.$fieldContainer),this.invalidateLayoutTree()}_renderForegroundColor(){M.legacyForegroundColor(this,this.$fieldContainer)}_renderBackgroundColor(){M.legacyBackgroundColor(this,this.$fieldContainer)}_renderGridData(){super._renderGridData(),this.updateInnerAlignment({useHorizontalAlignment:!0})}_renderGridDataHints(){super._renderGridDataHints(),this.updateInnerAlignment({useHorizontalAlignment:!0})}setKeyStroke(e){this.setProperty("keyStroke",e)}_setKeyStroke(e){this._setProperty("keyStroke",e),this.checkBoxKeyStroke.parseAndSetKeyStroke(this.keyStroke)}setWrapText(e){this.setProperty("wrapText",e)}_renderWrapText(){this.$checkBoxLabel.toggleClass("white-space-nowrap",!this.wrapText),this.invalidateLayoutTree()}acceptInput(e){}toggleChecked(){!this.enabledComputed||(this.triStateEnabled?this.value===!1?this.setValue(!0):this.value===!0?this.setValue(null):this.setValue(!1):this.setValue(!this.value))}prepareForCellEdit(e){super.prepareForCellEdit(e),this.$checkBoxLabel.hide()}_onMouseDown(e){if(!this.enabledComputed)return;this.toggleChecked();let t=this.$checkBox.is(e.currentTarget),s=this.$checkBoxLabel.isOrHas(e.currentTarget);(t||s)&&this.focusAndPreventDefault(e)}}class Gg extends Ot{constructor(){super(),this._addRemoteProperties(["value"])}}class eh extends O{constructor(e){super(),this.field=e,this.which=[g.SPACE],this.stopPropagation=!0,this.stopImmediatePropagation=!0,this.renderingHints.hAlign=ht.LEFT,this.renderingHints.$drawingArea=(t,s)=>this.field.$fieldContainer}handle(e){this.field.toggleChecked()}}function wn(i,e,t){return e=_0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function _0(i){var e=y0(i,"string");return typeof e=="symbol"?e:String(e)}function y0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Tn extends me{constructor(){super(),wn(this,"allowedMimeTypes",void 0),wn(this,"maximumSize",void 0),wn(this,"readOnly",void 0),wn(this,"_fileUploadWaitRetryCountTimeout",void 0),wn(this,"_fullSelectionLength",void 0),this.allowedMimeTypes=null,this.maximumSize=null,this._fileUploadWaitRetryCountTimeout=99,this._fullSelectionLength=0}_createKeyStrokeContext(){return new As}_render(){this.addContainer(this.$parent,"clipboard-field"),this.addLabel(),this.addField(this.$parent.makeElement("<div>").addClass("input-field")),this.addStatus(),this.$field.disableSpellcheck().attr("contenteditable","true").attr("tabindex","0").on("keydown",this._onKeyDown.bind(this)).on("input",this._onInput.bind(this)).on("paste",this._onPaste.bind(this)).on("copy",this._onCopy.bind(this)).on("cut",this._onCopy.bind(this))}_getDragAndDropHandlerOptions(){let e=super._getDragAndDropHandlerOptions();return e.allowedTypes=()=>this.allowedMimeTypes,e.dropMaximumSize=()=>Math.min(u.nvl(this.dropMaximumSize,Number.MAX_VALUE),u.nvl(this.maximumSize,Number.MAX_VALUE)),e}_renderDisplayText(){let e=this.displayText,t;this.$field.children().each((s,r)=>{!t&&r.nodeName==="IMG"&&(t=r)}),y.hasText(e)?(this.$field.html(y.nl2br(e,!0)),this._installScrollbars(),setTimeout(()=>{this.$field.selectAllText();let s=this._getSelection();this._fullSelectionLength=s?s.toString().length:0})):this.$field.empty(),t&&this.$field.prepend(t)}_readDisplayText(){return this.displayText}_getSelection(){let e,t=this.$container.window(!0);return t.getSelection?e=t.getSelection():document.getSelection&&(e=document.getSelection()),!e||e.toString().length===0?null:e}_onKeyDown(e){if(u.isOneOf(e.which,Tn.ALWAYS_DESTRUCTIVE_KEYS))return!1;if(!(e.ctrlKey||e.altKey||e.metaKey||u.isOneOf(e.which,Tn.NON_DESTRUCTIVE_KEYS)))return!1}_onInput(e){return this._renderDisplayText(),!1}_onCopy(e){if(x.get().isIos()&&this._onIosCopy(e)===!1)return;let t,s,r=this.$container.window(!0);try{let o=e.originalEvent;o.clipboardData?s=o.clipboardData:r.clipboardData&&(s=r.clipboardData)}catch(o){a().log.error('Error while reading "clipboardData"',o)}if(!s)return a().log.error("Unable to access clipboard data."),!1;this._uninstallScrollbars();let n=this._getSelection();if(!!n){n.toString().length===this._fullSelectionLength?t=this.displayText:t=n.toString();try{s.setData("text/plain",t)}catch{s.setData("Text",t)}return this._installScrollbars(),!1}}_onIosCopy(e){let t=this.$field.attr("style");return this.$field.css({color:"#000","background-color":"transparent"}),setTimeout(()=>{this.$field.attrOrRemove("style",t)}),!1}_onPaste(e){if(this.readOnly)return!1;let t=Date.now(),s,r=this.$container.window(!0);this.$field.selectAllText();let n=e.originalEvent;if(n.clipboardData)s=n.clipboardData;else if(r.clipboardData)s=r.clipboardData;else throw new Error("Unable to access clipboard data.");let o=[],l={},h=0,d=0,c=s.getData("Text");c&&(window.Blob?(o.push(new Blob([c],{type:lt.TEXT_PLAIN})),d++):(l["textTransferObject"+h++]=c,d++)),d===0&&s.items&&(Array.prototype.forEach.call(s.items,S=>{if(S.type===lt.TEXT_PLAIN)S.getAsString(R=>{o.push(new Blob([R],{type:lt.TEXT_PLAIN})),d++});else if(u.isOneOf(S.type,[lt.IMAGE_PNG,lt.IMAGE_JPG,lt.IMAGE_JPEG,lt.IMAGE_GIF])){let R=S.getAsFile();R&&(t-R.lastModified<1e3&&(R.scoutName=ii.EMPTY_UPLOAD_FILENAME),o.push(R),d++)}}),this._cleanupFiles(o));let f=0;d===0&&s.files&&Array.prototype.forEach.call(s.files,S=>{let R=new FileReader;R.onload=L=>{let H=new Blob([L.target.result],{type:S.type});H.name=S.name,o.push(H),f--},R.onerror=L=>{f--,a().log.error("Error while reading file "+S.name+" / "+L.target.error.code)},f++,d++,R.readAsArrayBuffer(S)});let m=0,_=()=>{if(f!==0&&m++!==this._fileUploadWaitRetryCountTimeout){setTimeout(_,150);return}if(m>=this._fileUploadWaitRetryCountTimeout){let S={entryPoint:this.$container.entryPoint(),header:this.session.text("ui.ClipboardTimeoutTitle"),body:this.session.text("ui.ClipboardTimeout"),yesButtonText:this.session.text("Ok")};this.session.showFatalMessage(S);return}(o.length>0||Object.keys(l).length>0)&&this.session.uploadFiles(this,o,l,this.maximumSize,this.allowedMimeTypes)},C=()=>{this._uninstallScrollbars();let S=this.$field.html();this.$field.html("");let R=()=>{this.$field.html(S),this._installScrollbars()};setTimeout(()=>{let L=!1;if(this.$field.children().each((H,we)=>{if(we.nodeName==="IMG"){let rt=a()(we).attr("src"),Ze=/^data:(.*);base64,(.*)/.exec(rt),di=Ze&&Ze[1];if(u.isOneOf(di,lt.IMAGE_PNG,lt.IMAGE_JPG,lt.IMAGE_JPEG,lt.IMAGE_GIF)){let zt=window.atob(Ze[2]),ui=[];for(let Bh=0;Bh<zt.length;Bh++)ui[Bh]=zt.charCodeAt(Bh);let Io=new Uint8Array(ui),Lo=new Blob([Io],{type:di});Lo.name="",o.push(Lo),L=!0}}}),L)R();else{let H=this.$field.text();y.hasText(H)?(this.setDisplayText(H),o.push(new Blob([H],{type:lt.TEXT_PLAIN}))):R()}_()},0)};return d>0?(_(),!1):(C(),!0)}_cleanupFiles(e){if(e.length!==2)return;let t,s;e.forEach(r=>{r.name==="image.png"&&r.scoutName?t=r:r.name==="image.jpeg"&&r.scoutName&&(s=r)}),t&&s&&p.remove(e,s)}}wn(Tn,"NON_DESTRUCTIVE_KEYS",[g.ESC,g.ENTER,g.TAB,g.PAGE_UP,g.PAGE_DOWN,g.END,g.HOME,g.LEFT,g.UP,g.RIGHT,g.DOWN,g.F1,g.F2,g.F3,g.F4,g.F5,g.F6,g.F7,g.F8,g.F9,g.F10,g.F11,g.F12]),wn(Tn,"ALWAYS_DESTRUCTIVE_KEYS",[g.BACKSPACE,g.DELETE]);class Ug extends Ot{}class qg extends me{_render(){this.addContainer(this.$parent,"color-field"),this.addLabel(),this.addField(this.$parent.makeDiv("not-implemented").text("not implemented yet")),this.addMandatoryIndicator(),this.addStatus()}}class Yg extends Ot{}class th extends E{}function Be(i,e,t){return e=b0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function b0(i){var e=v0(i,"string");return typeof e=="symbol"?e:String(e)}function v0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class kt extends me{constructor(){super(),Be(this,"popup",void 0),Be(this,"autoDate",void 0),Be(this,"dateDisplayText",void 0),Be(this,"dateHasText",void 0),Be(this,"dateFocused",void 0),Be(this,"dateFormatPattern",void 0),Be(this,"hasDate",void 0),Be(this,"touchMode",void 0),Be(this,"embedded",void 0),Be(this,"hasTime",void 0),Be(this,"hasTimePopup",void 0),Be(this,"timeDisplayText",void 0),Be(this,"timeHasText",void 0),Be(this,"timePickerResolution",void 0),Be(this,"timeFormatPattern",void 0),Be(this,"timeFocused",void 0),Be(this,"isolatedDateFormat",void 0),Be(this,"isolatedTimeFormat",void 0),Be(this,"allowedDates",void 0),Be(this,"htmlDateTimeComposite",void 0),Be(this,"$dateField",void 0),Be(this,"$timeField",void 0),Be(this,"$dateFieldIcon",void 0),Be(this,"$timeFieldIcon",void 0),Be(this,"$dateClearIcon",void 0),Be(this,"$timeClearIcon",void 0),Be(this,"_$predictDateField",void 0),Be(this,"_$predictTimeField",void 0),Be(this,"_tempTimeDate",void 0),Be(this,"_cellEditorPopup",void 0),this.allowedDates=[],this.popup=null,this.autoDate=null,this.dateDisplayText=null,this.dateHasText=!1,this.dateFocused=!1,this.dateFormatPattern=null,this.disabledCopyOverlay=!0,this.hasDate=!0,this.touchMode=!1,this.embedded=!1,this.hasTime=!1,this.hasTimePopup=!0,this.timeDisplayText=null,this.timeHasText=!1,this.timeDisplayText=null,this.timePickerResolution=30,this.timeFormatPattern=null,this.timeFocused=!1,this.$dateField=null,this.$timeField=null,this.$dateFieldIcon=null,this.$timeFieldIcon=null,this.$dateClearIcon=null,this.$timeClearIcon=null,this._$predictDateField=null,this._$predictTimeField=null,this._tempTimeDate=null,this.invalidValueMessageKey="ui.InvalidDate",this._addCloneProperties(["hasDate","hasTime","dateFormatPattern","timeFormatPattern","allowedDates","autoDate"])}_createKeyStrokeContext(){return new As}_init(e){super._init(e),Z.initTouch(this,e),this.popup=e.popup,this._setAutoDate(this.autoDate),this._setDisplayText(this.displayText),this._setAllowedDates(this.allowedDates),this._setTimePickerResolution(this.timePickerResolution)}_initValue(e){this._setDateFormatPattern(this.dateFormatPattern),this._setTimeFormatPattern(this.timeFormatPattern),super._initValue(e)}createDatePopup(){let e=this.touchMode?$d:fa;return u.create(e,{parent:this,$anchor:this.$field,boundToAnchor:!this.touchMode,cssClass:this._errorStatusClass(),closeOnAnchorMouseDown:!1,field:this,allowedDates:this.allowedDates,dateFormat:this.isolatedDateFormat})}createTimePopup(){let e=this.touchMode?za:Wa;return u.create(e,{parent:this,$anchor:this.$timeField,boundToAnchor:!this.touchMode,cssClass:this._errorStatusClass(),closeOnAnchorMouseDown:!1,field:this,timeResolution:this.timePickerResolution})}_render(){this.addContainer(this.$parent,"date-field"),this.addLabel(),this.addField(this.$parent.makeDiv("date-time-composite")),this.addStatus(),this.embedded||this.addMandatoryIndicator(),this.htmlDateTimeComposite=T.install(this.$field,this.session),this.htmlDateTimeComposite.setLayout(new Pc(this))}_renderProperties(){this._renderHasDate(),this._renderHasTime(),super._renderProperties(),this._renderDateHasText(),this._renderTimeHasText()}_remove(){super._remove(),this.$dateField=null,this.$timeField=null,this.$dateFieldIcon=null,this.$timeFieldIcon=null,this.$dateClearIcon=null,this.$timeClearIcon=null,this._$predictDateField=null,this._$predictTimeField=null,this.popup=null}setHasDate(e){this.setProperty("hasDate",e)}_setHasDate(e){this._setProperty("hasDate",e),this.initialized&&this._updateDisplayTextProperty()}_renderHasDate(){this.hasDate&&!this.$dateField?(this.$dateField=Z.makeInputOrDiv(this,"date").on("mousedown",this._onDateFieldMouseDown.bind(this)).appendTo(this.$field),this.$timeField&&this.$dateField.insertBefore(this.$timeField),this.touchMode||this.$dateField.on("keydown",this._onDateFieldKeyDown.bind(this)).on("input",this._onDateFieldInput.bind(this)).on("blur",this._onDateFieldBlur.bind(this)).on("focus",this._onDateFieldFocus.bind(this)),this._linkWithLabel(this.$dateField),T.install(this.$dateField,this.session),this.$dateFieldIcon=Z.appendIcon(this.$field,"date").on("mousedown",this._onDateIconMouseDown.bind(this))):!this.hasDate&&this.$dateField&&(this.$dateField.remove(),this.$dateField=null,this.$dateFieldIcon.remove(),this.$dateFieldIcon=null),this.rendering||(this._renderDisplayText(),this._renderFieldStyle(),this._renderEnabled(),this.htmlDateTimeComposite.invalidateLayoutTree()),this._renderDateClearable(),this.$container.toggleClass("has-date",this.hasDate)}setHasTime(e){this.setProperty("hasTime",e)}_setHasTime(e){this._setProperty("hasTime",e),this.initialized&&this._updateDisplayTextProperty()}_renderHasTime(){this.hasTime&&!this.$timeField?(this.$timeField=Z.makeInputOrDiv(this,"time").on("mousedown",this._onTimeFieldMouseDown.bind(this)).appendTo(this.$field),this.$dateField&&this.$timeField.insertAfter(this.$dateField),(!this.touchMode||!this.hasTimePopup)&&this.$timeField.on("keydown",this._onTimeFieldKeyDown.bind(this)).on("input",this._onTimeFieldInput.bind(this)).on("blur",this._onTimeFieldBlur.bind(this)).on("focus",this._onTimeFieldFocus.bind(this)),this._linkWithLabel(this.$timeField),T.install(this.$timeField,this.session),this.$timeFieldIcon=Z.appendIcon(this.$field,"time").on("mousedown",this._onTimeIconMouseDown.bind(this))):!this.hasTime&&this.$timeField&&(this.$timeField.remove(),this.$timeField=null,this.$timeFieldIcon.remove(),this.$timeFieldIcon=null),this.rendering||(this._renderDisplayText(),this._renderFieldStyle(),this._renderEnabled(),this.htmlDateTimeComposite.invalidateLayoutTree()),this._renderTimeClearable(),this.$container.toggleClass("has-time",this.hasTime)}setTimePickerResolution(e){this.setProperty("timePickerResolution",e)}_setTimePickerResolution(e){e<1?(e=10,this.hasTimePopup=!1):this.hasTimePopup=!0,this._setProperty("timePickerResolution",e)}_renderPlaceholder(e){super._renderPlaceholder(this._fieldForPlaceholder())}_removePlaceholder(e){super._removePlaceholder(this._fieldForPlaceholder())}_fieldForPlaceholder(){return this.hasDate?this.$dateField:this.hasTime?this.$timeField:null}setDateFormatPattern(e){this.setProperty("dateFormatPattern",e)}_setDateFormatPattern(e){e||(e=this.session.locale.dateFormatPatternDefault),this._setProperty("dateFormatPattern",e),this.isolatedDateFormat=new xt(this.session.locale,this.dateFormatPattern),this.initialized&&this._updateDisplayText()}setTimeFormatPattern(e){this.setProperty("timeFormatPattern",e)}_setTimeFormatPattern(e){e||(e=this.session.locale.timeFormatPatternDefault),this._setProperty("timeFormatPattern",e),this.isolatedTimeFormat=new xt(this.session.locale,this.timeFormatPattern),this.initialized&&this._updateDisplayText()}_renderEnabled(){super._renderEnabled(),this.$container.setEnabled(this.enabledComputed),this.$dateField&&this.$dateField.setEnabled(this.enabledComputed),this.$timeField&&this.$timeField.setEnabled(this.enabledComputed)}_renderDisplayText(){this.hasDate&&this._renderDateDisplayText(),this.hasTime&&this._renderTimeDisplayText(),this._removePredictionFields()}_readDisplayText(){let e,t;return this.hasDate&&(e=this._readDateDisplayText()),this.hasTime&&(t=this._readTimeDisplayText()),this._computeDisplayText(e,t)}_renderDateDisplayText(){Z.valOrText(this.$dateField,this.dateDisplayText),this._updateDateHasText()}_readDateDisplayText(){return this._$predictDateField?Z.valOrText(this._$predictDateField):Z.valOrText(this.$dateField)}_renderTimeDisplayText(){Z.valOrText(this.$timeField,this.timeDisplayText),this._updateTimeHasText()}_readTimeDisplayText(){return this._$predictTimeField?Z.valOrText(this._$predictTimeField):Z.valOrText(this.$timeField)}setDisplayText(e){this._setDisplayText(e),this.rendered&&this._renderDisplayText()}_setDisplayText(e){this._setProperty("displayText",e);let t=this._splitDisplayText(e);this.hasDate&&(this.dateDisplayText=t.dateText),this.hasTime&&(this.timeDisplayText=t.timeText)}_ensureValue(e){return w.ensure(e)}_validateValue(e){if(b.isNullOrUndefined(e))return e;if(!(e instanceof Date))throw this.session.text(this.invalidValueMessageKey);if(!this.isDateAllowed(e))throw this.session.text("DateIsNotAllowed");return!this.hasDate&&!this.value&&(e=w.combineDateTime(null,e)),e}isDateAllowed(e){if(!e||this.allowedDates.length===0||this.embedded)return!0;let t=w.trunc(e).getTime();return this.allowedDates.some(s=>s.getTime()===t)}_valueEquals(e,t){return w.equals(e,t)}setAutoDate(e){this.setProperty("autoDate",e)}_setAutoDate(e){e=w.ensure(e),this._setProperty("autoDate",e)}setAllowedDates(e){this.setProperty("allowedDates",e)}_setAllowedDates(e){let t=[];p.ensure(e).forEach(s=>{s&&t.push(w.trunc(w.ensure(s)))}),t=t.sort(w.compare),this._setProperty("allowedDates",t)}_renderErrorStatus(){super._renderErrorStatus();let e=!!this.errorStatus,t=this._errorStatusClass();this.$dateField&&(this._updateErrorStatusClassesOnElement(this.$dateField,t,e),this._updateErrorStatusClassesOnElement(this._$predictDateField,t,e)),this.$timeField&&(this._updateErrorStatusClassesOnElement(this.$timeField,t,e),this._updateErrorStatusClassesOnElement(this._$predictTimeField,t,e)),this.popup&&this._updateErrorStatusClassesOnElement(this.popup.$container,t,e)}_errorStatusClass(){return this.errorStatus&&!this._isSuppressStatusField()?"has-"+this.errorStatus.cssClass():""}_renderFont(){this.$dateField&&M.legacyFont(this,this.$dateField),this.$timeField&&M.legacyFont(this,this.$timeField)}_renderForegroundColor(){this.$dateField&&M.legacyForegroundColor(this,this.$dateField),this.$timeField&&M.legacyForegroundColor(this,this.$timeField)}_renderBackgroundColor(){this.$dateField&&M.legacyBackgroundColor(this,this.$dateField),this.$timeField&&M.legacyBackgroundColor(this,this.$timeField)}activate(){!this.enabledComputed||!this.rendered||(this.$dateField?(this.$dateField.focus(),this._onDateFieldMouseDown()):this.$timeField&&(this.$timeField.focus(),this._onTimeFieldMouseDown()))}getFocusableElement(){return this.$dateField?this.$dateField:this.$timeField?this.$timeField:null}_onDateFieldMouseDown(){Z.handleOnClick(this)&&this.openDatePopupAndSelect(this.value)}_onTimeFieldMouseDown(){Z.handleOnClick(this)&&this.openTimePopupAndSelect(this.value)}setDateFocused(e){this.setProperty("dateFocused",e)}_renderDateFocused(){this.$container.toggleClass("date-focused",this.dateFocused)}_updateTimeHasText(){this.setTimeHasText(y.hasText(this._readTimeDisplayText()))}setTimeHasText(e){this.setProperty("timeHasText",e)}_renderTimeHasText(){this.$timeField&&this.$timeField.toggleClass("has-text",this.timeHasText),this.$container.toggleClass("time-has-text",this.timeHasText)}_updateDateHasText(){this.setDateHasText(y.hasText(this._readDateDisplayText()))}setDateHasText(e){this.setProperty("dateHasText",e)}_renderDateHasText(){this.$dateField&&this.$dateField.toggleClass("has-text",this.dateHasText),this.$container.toggleClass("date-has-text",this.dateHasText)}clear(){if(!(this.hasDate&&this.hasTime)){super.clear();return}this._clear(),!this.dateFocused&&!this.timeFocused&&this.acceptInput(),this._triggerClear()}_clear(){this._removePredictionFields(),this.hasDate&&!this.timeFocused&&(Z.valOrText(this.$dateField,""),this._setDateValid(!0),this._updateDateHasText()),this.hasTime&&!this.dateFocused&&(Z.valOrText(this.$timeField,""),this._setTimeValid(!0),this._updateTimeHasText())}_onDateClearIconMouseDown(e){!this.enabledComputed||(this.$dateField.focus(),this.clear(),this.value?this.selectDate(this.value,!1):this.preselectDate(this._referenceDate(),!1),e.preventDefault())}_onDateIconMouseDown(e){!this.enabledComputed||(this.$dateField.focus(),this.embedded||this.openDatePopupAndSelect(this.value))}setTimeFocused(e){this.setProperty("timeFocused",e)}_renderTimeFocused(){this.$container.toggleClass("time-focused",this.timeFocused)}_renderClearable(){this._renderDateClearable(),this._renderTimeClearable(),this._updateClearableStyles()}_renderDateClearable(){this.hasDate&&this.isClearable()?this.$dateClearIcon||(this.$dateClearIcon=this.$field.appendSpan("icon date-clear unfocusable text-field-icon action").on("mousedown",this._onDateClearIconMouseDown.bind(this))):this.$dateClearIcon&&(this.$dateClearIcon.remove(),this.$dateClearIcon=null)}_renderTimeClearable(){this.hasTime&&this.isClearable()?this.$timeClearIcon||(this.$timeClearIcon=this.$field.appendSpan("icon time-clear unfocusable text-field-icon action").on("mousedown",this._onTimeClearIconMouseDown.bind(this))):this.$timeClearIcon&&(this.$timeClearIcon.remove(),this.$timeClearIcon=null)}_onTimeClearIconMouseDown(e){!this.enabledComputed||(this.$timeField.focus(),this.clear(),this.value?this.selectTime(this.value):this.preselectTime(this._referenceDate()),e.preventDefault())}_onTimeIconMouseDown(e){!this.enabledComputed||(this.$timeField.focus(),this.embedded||this.openTimePopupAndSelect(this.value))}_onDateFieldBlur(e){this.setFocused(!1),this.setDateFocused(!1),!this.embedded&&(this.popup instanceof fa&&this.closePopup(),this.setDateFocused(!1),this.acceptDate(),this._removePredictionFields())}_onDateFieldFocus(e){this.setFocused(!0),this.setDateFocused(!0)}_onTimeFieldBlur(e){this._tempTimeDate=null,this.setFocused(!1),this.setTimeFocused(!1),!this.embedded&&(this.popup instanceof Wa&&this.closePopup(),this._tempTimeDate=null,this.setTimeFocused(!1),this.acceptTime(),this._removePredictionFields())}_onTimeFieldFocus(){this.setFocused(!0),this.setTimeFocused(!0)}_onDateFieldKeyDown(e){let t=0,s=0,r=0,n=0,o=this.$dateField[0].selectionStart,l=Z.valOrText(this.$dateField),h=this._$predictDateField&&Z.valOrText(this._$predictDateField),d=(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.altKey?1:0)+(e.metaKey?1:0),c=this.value||this._referenceDate(),f=!0,m=e.which;if(this.hasTime&&this.mode===A.Mode.CELLEDITOR&&m===g.TAB&&d===0){e.stopPropagation();return}if(!(m===g.TAB||m===g.SHIFT||m===g.HOME||m===g.END||m===g.CTRL||m===g.ALT)){if(m===g.ENTER){(this.popup||this._$predictDateField)&&(this.acceptDate(),this.closePopup(),a().suppressEvent(e));return}if(m===g.ESC){this.popup&&(this.closePopup(),a().suppressEvent(e));return}if(m===g.RIGHT&&o===l.length){h&&this._setDateDisplayText(h.substring(0,l.length+1));return}if((m===g.UP||m===g.DOWN||m===g.PAGE_UP||m===g.PAGE_DOWN)&&l&&!this._isDateValid()){let _=this.isolatedDateFormat.parse(l,c);_&&(c=_,this._setDateValid(!0))}if(m===g.PAGE_UP||m===g.PAGE_DOWN){!l||!this._isDateValid()?(c=this._referenceDate(),this.hasTime&&(c=w.combineDateTime(c,this.value||this._referenceDate())),this.openDatePopupAndSelect(c),this._updateDisplayText(c),this._setDateValid(!0),f=!1):this.popup||this.openDatePopupAndSelect(c),f&&(r=m===g.PAGE_UP?-1:1,this.shiftSelectedDate(0,r,0),this._updateDisplayText(this.getDatePicker().selectedDate)),a().suppressEvent(e);return}if(m===g.UP||m===g.DOWN){if(t=m===g.UP?-1:1,(e.ctrlKey||e.metaKey)&&d===1)s=t;else if(e.shiftKey&&d===1)r=t;else if(d===0)n=t;else{a().suppressEvent(e);return}!l||!this._isDateValid()?(c=this._referenceDate(),this.hasTime&&(c=w.combineDateTime(c,this.value||this._referenceDate())),this.openDatePopupAndSelect(c),this._updateDisplayText(c),this._setDateValid(!0),f=!1):this.popup||this.openDatePopupAndSelect(c),f&&(this.shiftSelectedDate(s,r,n),this._updateDisplayText(this.getDatePicker().selectedDate)),a().suppressEvent(e)}}}_onDateFieldInput(e){let t=Z.valOrText(this.$dateField);if(this.$dateField[0]!==this.$dateField.activeElement(!0))return;this._$predictDateField||(this._$predictDateField=this._createPredictionField(this.$dateField)),this._removePredictErrorStatus();let s=this._predictDate(t);s?(Z.valOrText(this._$predictDateField,s.text),this.openDatePopupAndSelect(s.date)):this._removePredictionFields(),this._updateDateHasText(),setTimeout(()=>{this._$predictDateField&&this._$predictDateField.setVisible(this.$dateField.scrollLeft()===0)},50)}acceptInput(e){let t=u.nvl(this._readDisplayText(),""),s=this._checkDisplayTextChanged(t);if(s)this.parseAndSetValue(t);else{let r=this.value;this.parseAndSetValue(t),w.equals(this.value,r)||(s=!0)}s&&this._triggerAcceptInput(e)}acceptDate(){let e=this.containsStatus(pi);this.hasTime&&!e&&y.empty(this.$dateField.val())&&this.$timeField.val(""),this.acceptInput()}acceptTime(){let e=this.containsStatus(pi);this.hasDate&&!e&&y.empty(this.$timeField.val())&&this.$dateField.val(""),this.acceptInput()}acceptDateTime(e,t){e?this.acceptDate():t&&this.acceptTime()}_onTimeFieldKeyDown(e){let t=0,s=0,r=0,n=0,o=this.$timeField[0].selectionStart,l=this.$timeField.val(),h=this._$predictTimeField&&this._$predictTimeField.val(),d=(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.altKey?1:0)+(e.metaKey?1:0),c=this.value||this._referenceDate(),f=!0,m=e.which;if(this.hasDate&&this.mode===A.Mode.CELLEDITOR&&m===g.TAB&&e.shiftKey&&d===1){e.stopPropagation();return}if(!(m===g.TAB||m===g.SHIFT||m===g.HOME||m===g.END||m===g.CTRL||m===g.ALT)){if(m===g.ENTER){(this.popup||this._$predictDateField)&&(this._tempTimeDate=null,this.acceptTime(),this.closePopup(),a().suppressEvent(e));return}if(m===g.ESC){this.popup&&(this.closePopup(),a().suppressEvent(e));return}if(m===g.RIGHT&&o===l.length){h&&this._setTimeDisplayText(h.substring(0,l.length+1));return}if(m===g.UP||m===g.DOWN){if(t=m===g.UP?-1:1,e.ctrlKey&&d===1)n=t;else if(e.shiftKey&&d===1)s=t;else if(d===0)r=t;else{a().suppressEvent(e);return}if(this.hasTimePopup)!l||!this._isTimeValid()?(c=this._referenceDate(),this.openTimePopupAndSelect(c),this._updateDisplayText(c),this._setTimeValid(!0),f=!1):this.popup||this.openTimePopupAndSelect(c),f&&(this.shiftSelectedTime(s,r,n),this._updateDisplayText(this.getTimePicker().selectedTime)),a().suppressEvent(e);else{if(!this._tempTimeDate){let _=this._predictTime(l);_&&_.date?this._tempTimeDate=_.date:(this._tempTimeDate=this._referenceDate(),f=!1)}f&&(this._tempTimeDate=w.shiftTime(this._tempTimeDate,s,r,n)),this.hasDate&&(this._tempTimeDate=w.combineDateTime(this.value||this._referenceDate(),this._tempTimeDate)),this._updateDisplayText(this._tempTimeDate),this._setTimeValid(!0),a().suppressEvent(e)}}}}_onTimeFieldInput(e){let t=this.$timeField.val();if(this.$timeField[0]!==this.$timeField.activeElement(!0))return;this._$predictTimeField||(this._$predictTimeField=this._createPredictionField(this.$timeField));let s=this._predictTime(t);s?(this._$predictTimeField.val(s.text),this.openTimePopupAndSelect(s.date)):(this._tempTimeDate=null,this._removePredictionFields()),this._updateTimeHasText(),setTimeout(()=>{this._$predictTimeField&&this._$predictTimeField.setVisible(this.$timeField.scrollLeft()===0)},50)}_onDatePickerDateSelect(e){this._setNewDateTimeValue(this._newTimestampAsDate(e.date,this.value))}_onTimePickerTimeSelect(e){this._setNewDateTimeValue(this._newTimestampAsDate(this.value,e.time))}_setNewDateTimeValue(e){this._setDateValid(!0),this._setTimeValid(!0),this.setValue(e),this._triggerAcceptInput(!1),this.closePopup()}_createPredictionField(e){this.setSuppressStatus(A.SuppressStatus.ALL);let t=e.clone().addClass("predict").attr("tabIndex","-1").insertBefore(e);return e.hasClass("has-error")&&t.addClass("has-error"),t}_removePredictionFields(){this.setSuppressStatus(null),this._$predictDateField&&(this._$predictDateField.remove(),this._$predictDateField=null),this._$predictTimeField&&(this._$predictTimeField.remove(),this._$predictTimeField=null)}_setDateDisplayText(e){this.dateDisplayText=e,this._updateDisplayTextProperty(),this.rendered&&this._renderDateDisplayText()}_setTimeDisplayText(e){this.timeDisplayText=e,this._updateDisplayTextProperty(),this.rendered&&this._renderTimeDisplayText()}_computeDisplayText(e,t){let s=e||"",r=t||"",n=(this.hasDate?s:"")+(this.hasDate&&this.hasTime?`
`:"")+(this.hasTime?r:"");return n===`
`&&(n=""),n}_splitDisplayText(e){let t="",s="";if(y.hasText(e)){let r=e.split(`
`);t=this.hasDate?r[0]:"",s=this.hasTime?this.hasDate?r[1]:r[0]:""}return{dateText:t,timeText:s}}_updateDisplayTextProperty(){this._setProperty("displayText",this._computeDisplayText(this.dateDisplayText,this.timeDisplayText))}aboutToBlurByMouseDown(e){let t=this.$dateField?this.$dateField.isOrHas(e)||this.$dateFieldIcon.isOrHas(e)||this.$dateClearIcon&&this.$dateClearIcon.isOrHas(e):!1,s=this.$timeField?this.$timeField.isOrHas(e)||this.$timeFieldIcon.isOrHas(e)||this.$timeClearIcon&&this.$timeClearIcon.isOrHas(e):!1,r=this.popup&&this.popup.$container.isOrHas(e),n=this.fieldStatus&&this.fieldStatus.$container.isOrHas(e),o=this.getDatePicker(),l=this.getTimePicker();if(!t&&!s&&!r&&!n){let h=Yi.isActiveElement(this.$dateField),d=Yi.isActiveElement(this.$timeField);this.acceptDateTime(h,d);return}if(this.embedded){let h=o&&o.$container.isOrHas(e),d=l&&l.$container.isOrHas(e);h&&d&&this.acceptTime()}}_newTimestampAsDate(e,t){let s=null;return(e||t)&&(s=this.value||this._referenceDate(),e&&(s=w.combineDateTime(e,s)),t&&(s=w.combineDateTime(s,t))),s}_referenceDate(){let e=this.autoDate||w.ceil(w.newDate(),this.timePickerResolution);return this.autoDate?e=this.autoDate:this.hasTime?e=w.ceil(w.newDate(),this.timePickerResolution):e=w.trunc(w.newDate()),this.allowedDates&&(e=this._findAllowedReferenceDate(e)),e}_findAllowedReferenceDate(e){for(let t=0;t<this.allowedDates.length;t++){let s=this.allowedDates[t];if(w.compare(s,e)>=0)return s}for(let t=this.allowedDates.length-1;t>=0;t--){let s=this.allowedDates[t];if(w.compare(s,e)<=0)return s}return e}openDatePopup(){this.popup||(this.popup=this.createDatePopup(),this.popup.open(),this.$dateField.addClass("focused"),this.popup.one("destroy",e=>{this.$dateField.removeClass("focused"),this._onPopupDestroy(e),this.popup=null}),this.getDatePicker().on("dateSelect",this._onDatePickerDateSelect.bind(this)))}closePopup(){this.popup&&this.popup.close()}toggleDatePopup(){a().log.isInfoEnabled()&&a().log.info("(DateField#toggleDatePopup) popupOpen=",!!this.popup),this.popup?this.closePopup():this.openDatePopupAndSelect(this.value)}openTimePopup(){!this.hasTimePopup||this.popup||(this.popup=this.createTimePopup(),this.popup.open(),this.$timeField.addClass("focused"),this.popup.one("destroy",e=>{this.$timeField.removeClass("focused"),this._onPopupDestroy(e),this.popup=null}),this.getTimePicker().on("timeSelect",this._onTimePickerTimeSelect.bind(this)))}toggleTimePopup(){a().log.isInfoEnabled()&&a().log.info("(DateField#toggleTimePopup) popupOpen=",!!this.popup),this.popup?this.closePopup():this.openTimePopupAndSelect(this.value)}_parseValue(e){let t=this._splitDisplayText(e),s=t.dateText,r={},n=t.timeText,o={},l=!0;if(this._removePredictErrorStatus(),this.hasDate&&(r=this._predictDate(s),r||(l=!1),this._setDateDisplayText(s)),this.hasTime&&(o=this._predictTime(n),o||(l=!1),this._setTimeDisplayText(n)),!l)throw new th;return r.date||o.date?this._newTimestampAsDate(r.date,o.date):null}_addParsingFailedErrorStatus(e,t){t instanceof th||super._addParsingFailedErrorStatus(e,t)}_predictDate(e){e=e||"";let t=e.match(/^([+-])(\d*)$/);if(t){let l=w.newDate(),h=Number(t[1]+(t[2]||"0"));return l.setDate(l.getDate()+h),isNaN(l.valueOf())||l.getDate()<0?(this._setDateValid(!1),null):(this._setDateValid(!0),{date:l,text:e})}let s=this._analyzeInputAsDate(e,this.value||this._referenceDate());if(s.error)return this._setDateValid(!1),null;if(!s.predictedDate)return this._setDateValid(!0),{date:null,text:""};let r=s.predictedDate,o=new xt(this.isolatedDateFormat.locale,s.parsedPattern).format(r,!0);return t=o.match(new RegExp("^"+y.quote(e)+"(.*)$","i")),t&&(o=e+t[1]),this._setDateValid(!0),{date:r,text:o}}_predictTime(e){e=e||"";let t=this._analyzeInputAsTime(e,this.value||this._referenceDate());if(t.error)return this._setTimeValid(!1),null;if(!t.predictedDate)return this._setTimeValid(!0),{date:null,text:""};let s=t.predictedDate,n=new xt(this.isolatedTimeFormat.locale,t.parsedPattern).format(s,!0),o=n.match(new RegExp("^"+y.quote(e)+"(.*)$","i"));return o&&(n=e+o[1]),this._setTimeValid(!0),{date:s,text:n}}_analyzeInputAsDate(e,t){return this.isolatedDateFormat.analyze(e,t)}_analyzeInputAsTime(e,t){return this.isolatedTimeFormat.analyze(e,t)}_setErrorStatusPart(e,t){let s=null,r=null;this.errorStatus&&(r=p.find(this.errorStatus.asFlatList(),kt.PARSE_ERROR_PREDICATE)),r?s=r:s=new pi({message:this.session.text("ui.InvalidDate"),severity:E.Severity.ERROR,code:kt.ErrorCode.PARSE_ERROR}),t?delete s[e]:s[e]=!0,!s.hasOwnProperty("invalidDate")&&!s.hasOwnProperty("invalidTime")&&(s=null),s&&!r?this.addErrorStatus(s):!s&&r&&this._removePredictErrorStatus()}_removePredictErrorStatus(){this.removeErrorStatusByPredicate(kt.PARSE_ERROR_PREDICATE)}_createInvalidValueStatus(e,t,s){let r=super._createInvalidValueStatus(e,t,s);return r.invalidDate=!0,r.invalidTime=!0,r.code=kt.ErrorCode.PARSE_ERROR,r}_setDateValid(e){this._setErrorStatusPart("invalidDate",e)}_setTimeValid(e){this._setErrorStatusPart("invalidTime",e)}_isErrorStatusPartValid(e){return this.errorStatus?!this.errorStatus.asFlatList().some(t=>!!t[e]):!0}_isDateValid(){return this._isErrorStatusPartValid("invalidDate")}_isTimeValid(){return this._isErrorStatusPartValid("invalidTime")}onCellEditorRendered(e){e.openFieldPopup&&(this.hasDate&&!this.hasTime?this.openDatePopupAndSelect(this.value):!this.hasDate&&this.hasTime?this.openTimePopupAndSelect(this.value):x.get().supportsOnlyTouch()||this.openDatePopupAndSelect(this.value)),this.touchMode&&(this._cellEditorPopup=e.cellEditorPopup)}_onPopupDestroy(e){!this.touchMode||!this._cellEditorPopup||this.hasDate&&this.hasTime||(this._cellEditorPopup.completeEdit(),this._cellEditorPopup=null)}prepareForCellEdit(e){e=e||{},super.prepareForCellEdit(e),this.$field.removeClass("cell-editor-field first last"),this.$dateField&&this.addCellEditorFieldCssClasses(this.$dateField,e),this.$timeField&&(this.$dateField||(e.cssClass=""),this.addCellEditorFieldCssClasses(this.$timeField,e))}getDatePicker(){if(this.popup&&this.popup.getDatePicker)return this.popup.getDatePicker()}openDatePopupAndSelect(e){this.openDatePopup(),e?this.selectDate(e,!1):this.preselectDate(this._referenceDate(),!1)}preselectDate(e,t){let s=this.getDatePicker();s&&s.preselectDate(e,t)}selectDate(e,t){let s=this.getDatePicker();s&&s.selectDate(e,t)}getTimePicker(){if(this.popup&&this.popup.getTimePicker)return this.popup.getTimePicker()}openTimePopupAndSelect(e){!this.hasTimePopup||(this.openTimePopup(),e?this.selectTime(e):this.preselectTime(this._referenceDate()))}preselectTime(e){let t=this.getTimePicker();t&&t.preselectTime(e)}selectTime(e){let t=this.getTimePicker();t&&t.selectTime(e)}shiftSelectedDate(e,t,s){this.openDatePopup(),this.getDatePicker().shiftSelectedDate(e,t,s)}shiftSelectedTime(e,t,s){this.openTimePopup(),this.getTimePicker().shiftSelectedTime(e,t,s)}_formatValue(e){let t="",s="";return this.hasDate&&(e&&(t=this.isolatedDateFormat.format(e)),this.dateDisplayText=t),this.hasTime&&(e&&(s=this.isolatedTimeFormat.format(e)),this.timeDisplayText=s),this._computeDisplayText(this.dateDisplayText,this.timeDisplayText)}_renderFieldStyle(){super._renderFieldStyle(),this._renderFieldStyleInternal(this.$dateField),this._renderFieldStyleInternal(this.$timeField)}_renderDisabledStyle(){super._renderDisabledStyle(),this._renderDisabledStyleInternal(this.$dateField),this._renderDisabledStyleInternal(this.$timeField)}_triggerAcceptInput(e){let t={displayText:this.displayText,errorStatus:this.errorStatus,value:this.value,whileTyping:!!e};this.trigger("acceptInput",t)}}Be(kt,"ErrorCode",{PARSE_ERROR:-1}),Be(kt,"PARSE_ERROR_PREDICATE",i=>i.code===kt.ErrorCode.PARSE_ERROR);function w0(i,e,t){return e=T0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function T0(i){var e=C0(i,"string");return typeof e=="symbol"?e:String(e)}function C0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Cn extends Ot{_onWidgetAcceptInput(e){let t=null,s=this.widget.errorStatus;s&&s.hasChildren()&&(t=p.find(s.asFlatList(),n=>n instanceof pi));let r={displayText:this.widget.displayText,errorStatus:t};t||(r.value=w.toJsonDate(this.widget.value)),this._send("acceptInput",r,{showBusyIndicator:!e.whileTyping,coalesce:function(n){return this.target===n.target&&this.type===n.type}})}_orderPropertyNamesOnSync(e){return Object.keys(e).sort(this._createPropertySortFunc(Cn.PROPERTIES_ORDER))}static isDateAllowedRemote(e){return this.modelAdapter?!0:this.isDateAllowedOrig(e)}static modifyPrototype(){!te.get().remote||b.replacePrototypeFunction(kt,"isDateAllowed",Cn.isDateAllowedRemote,!0)}}w0(Cn,"PROPERTIES_ORDER",["hasTime","hasDate"]),te.addListener("bootstrap",Cn.modifyPrototype);function Sn(i,e,t){return e=S0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function S0(i){var e=P0(i,"string");return typeof e=="symbol"?e:String(e)}function P0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Pc extends ee{constructor(e){super(),Sn(this,"MIN_DATE_FIELD_WIDTH",void 0),Sn(this,"PREF_DATE_FIELD_WIDTH",void 0),Sn(this,"MIN_TIME_FIELD_WIDTH",void 0),Sn(this,"PREF_TIME_FIELD_WIDTH",void 0),Sn(this,"htmlPropertyChangeHandler",void 0),Sn(this,"hgap",void 0),Sn(this,"_dateField",void 0),this._dateField=e,this.MIN_DATE_FIELD_WIDTH=90,this.PREF_DATE_FIELD_WIDTH=110,this.MIN_TIME_FIELD_WIDTH=60,this.PREF_TIME_FIELD_WIDTH=90,this._initDefaults(),this.htmlPropertyChangeHandler=this._onHtmlEnvironmentPropertyChange.bind(this),de.get().on("propertyChange",this.htmlPropertyChangeHandler),this._dateField.one("remove",()=>de.get().off("propertyChange",this.htmlPropertyChangeHandler))}_initDefaults(){this.hgap=de.get().smallColumnGap}_onHtmlEnvironmentPropertyChange(){this._initDefaults(),this._dateField.invalidateLayoutTree()}layout(e){let t=T.get(e),s=this._dateField.$dateField,r=this._dateField.$timeField,n=this._dateField.$dateFieldIcon,o=this._dateField.$timeFieldIcon,l=this._dateField.$dateClearIcon,h=this._dateField.$timeClearIcon,d=this._dateField._$predictDateField,c=this._dateField._$predictTimeField,f=s?T.get(s):null,m=r?T.get(r):null,_=s?!s.isDisplayNone():!1,C=r?!r.isDisplayNone():!1,S=t.availableSize({exact:!0}).subtract(t.insets()),R,L;if(_&&C){let we=f.margins(),rt=m.margins(),Ze=new Ge(Math.max(we.top,rt.top),Math.max(we.right,rt.right),Math.max(we.bottom,rt.bottom),Math.max(we.left,rt.left)),di=S.subtract(Ze),zt=this._hgap(),ui=di.width-zt,Io=ui*.6,Lo=ui-Io;R=new F(Io,di.height),L=new F(Lo,di.height),f.setSize(R),m.setSize(L),r.cssRight(0),n.cssTop(s.cssBorderTopWidth()).cssRight(Lo+zt).cssHeight(R.height-s.cssBorderWidthY()),l&&l.cssTop(s.cssBorderTopWidth()).cssRight(Lo+zt+s.cssBorderRightWidth()).cssHeight(R.height-s.cssBorderWidthY()),o.cssTop(r.cssBorderTopWidth()).cssRight(0).cssHeight(L.height-r.cssBorderWidthY()),h&&h.cssTop(r.cssBorderTopWidth()).cssRight(r.cssBorderRightWidth()).cssHeight(L.height-r.cssBorderWidthY()),s.toggleClass("compact",R.width<this.MIN_DATE_FIELD_WIDTH),r.toggleClass("compact",L.width<this.MIN_TIME_FIELD_WIDTH),this._dateField.$container.toggleClass("compact-date",R.width<this.MIN_DATE_FIELD_WIDTH),this._dateField.$container.toggleClass("compact-time",L.width<this.MIN_TIME_FIELD_WIDTH),d&&v.setSize(d,R),c&&(v.setSize(c,L),c.cssRight(0))}else _?(R=S.subtract(f.margins()),f.setSize(R),n.cssTop(s.cssBorderTopWidth()).cssRight(0).cssHeight(R.height-s.cssBorderWidthY()),l&&l.cssTop(s.cssBorderTopWidth()).cssRight(s.cssBorderRightWidth()).cssHeight(R.height-s.cssBorderWidthY()),s.toggleClass("compact",R.width<this.MIN_DATE_FIELD_WIDTH),this._dateField.$container.toggleClass("compact-date",R.width<this.MIN_DATE_FIELD_WIDTH),d&&v.setSize(d,R)):C&&(L=S.subtract(m.margins()),m.setSize(L),o.cssTop(r.cssBorderTopWidth()).cssRight(0).cssHeight(L.height-r.cssBorderWidthY()),h&&h.cssTop(r.cssBorderTopWidth()).cssRight(r.cssBorderRightWidth()).cssHeight(L.height-r.cssBorderWidthY()),r.toggleClass("compact",L.width<this.MIN_TIME_FIELD_WIDTH),this._dateField.$container.toggleClass("compact-time",L.width<this.MIN_TIME_FIELD_WIDTH),c&&v.setSize(c,L));let H=this._dateField.popup;H&&H.rendered&&H.position()}_hgap(){return this.hgap}preferredLayoutSize(e,t){let s=new F,r=this._dateField.$dateField,n=this._dateField.$timeField,o=r?!r.isDisplayNone():!1,l=n?!n.isDisplayNone():!1;return o&&l?(s=v.prefSize(this._dateField.$dateField),s.width=this.PREF_DATE_FIELD_WIDTH+this._hgap()+this.PREF_TIME_FIELD_WIDTH):o?(s=v.prefSize(this._dateField.$dateField),s.width=this.PREF_DATE_FIELD_WIDTH):l&&(s=v.prefSize(this._dateField.$timeField),s.width=this.PREF_TIME_FIELD_WIDTH),s}}function go(i,e,t){return e=x0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function x0(i){var e=E0(i,"string");return typeof e=="symbol"?e:String(e)}function E0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class jg extends me{constructor(){super(),go(this,"button",void 0),go(this,"fileInput",void 0),go(this,"acceptTypes",void 0),go(this,"maximumUploadSize",void 0),go(this,"iconId",void 0),go(this,"fileExtensions",void 0),this.button=null,this.fileInput=null,this.acceptTypes=null,this.maximumUploadSize=_i.DEFAULT_MAXIMUM_UPLOAD_SIZE}_init(e){super._init(e),this.button=u.create(Re,{parent:this,label:this._buttonLabel(),iconId:this.iconId,labelHtmlEnabled:this.labelHtmlEnabled}),this.button.on("click",this._onButtonClick.bind(this)),this.fileInput.on("change",this._onFileChange.bind(this)),this.on("propertyChange",t=>{t.propertyName==="enabledComputed"&&(this.button.setEnabled(t.newValue),this.fileInput.setEnabled(t.newValue))})}_initValue(e){this.fileInput=u.create(_i,{parent:this,acceptTypes:this.acceptTypes,text:this.displayText,enabled:this.enabledComputed,maximumUploadSize:this.maximumUploadSize,visible:!x.get().supportsFile()}),super._initValue(e)}_buttonLabel(){return this.label}_render(){this.addContainer(this.$parent,"file-chooser-button has-icon"),this.addLabel();let e=this.$parent.makeDiv(),t=T.install(e,this.session);this.button.render(e),t.setLayout(new Es(this.button.htmlComp)),this.fileInput.render(e),this.addField(e),e.setTabbable(!1),this.addStatus()}setDisplayText(e){super.setDisplayText(e),this.fileInput.setText(e),e||this.fileInput.clear()}_readDisplayText(){return this.fileInput.text}_renderLabel(){this._renderEmptyLabel()}_onButtonClick(e){this.fileInput.browse()}setLabel(e){super.setLabel(e),this.button.setLabel(this._buttonLabel())}setIconId(e){this.setProperty("iconId",e),this.button.setIconId(e)}setAcceptTypes(e){this.setProperty("acceptTypes",e),this.fileInput.setAcceptTypes(e)}setFileExtensions(e){this.setProperty("fileExtensions",e);let t=p.ensure(e);t=t.map(s=>s.indexOf(".")===0?s:"."+s),this.setAcceptTypes(y.join(",",...t)),this.fileInput.acceptTypes=this.acceptTypes}setMaximumUploadSize(e){this.setProperty("maximumUploadSize",e),this.fileInput.setMaximumUploadSize(e)}_onFileChange(e){this.setValue(p.first(e.files))}_validateValue(e){return this.fileInput.validateMaximumUploadSize(e),e}_formatValue(e){return e?e.name:""}getFocusableElement(){return this.button.getFocusableElement()}}class Xg extends Ot{_onWidgetPropertyChange(e){super._onWidgetPropertyChange(e),e.propertyName==="value"&&this._onValueChange(e)}_onValueChange(e){this.widget.fileInput.upload()||this.widget.fileInput.clear()}_syncDisplayText(e){this.widget.setDisplayText(e)}}function xc(i,e,t){return e=F0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function F0(i){var e=D0(i,"string");return typeof e=="symbol"?e:String(e)}function D0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Jg extends me{constructor(){super(),xc(this,"fileInput",void 0),xc(this,"acceptTypes",void 0),xc(this,"maximumUploadSize",void 0),this.fileInput=null,this.acceptTypes=null,this.maximumUploadSize=_i.DEFAULT_MAXIMUM_UPLOAD_SIZE}_init(e){super._init(e),this.fileInput.on("change",this._onFileChange.bind(this)),this.on("propertyChange",t=>{t.propertyName==="enabledComputed"&&this.fileInput.setEnabled(t.newValue)})}_initValue(e){this.fileInput=u.create(_i,{parent:this,acceptTypes:this.acceptTypes,text:this.displayText,enabled:this.enabledComputed,maximumUploadSize:this.maximumUploadSize}),super._initValue(e)}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.registerKeyStroke(new Ec(this)),this.keyStrokeContext.registerKeyStroke(new Fc(this))}_render(){this.addContainer(this.$parent,"file-chooser-field has-icon"),this.addLabel(),this.addMandatoryIndicator(),this._renderFileInput(),this.addIcon(),this.addStatus()}_renderFileInput(){this.fileInput.render(),this.addField(this.fileInput.$container)}setDisplayText(e){super.setDisplayText(e),this.fileInput.setText(e),e||this.fileInput.clear()}_readDisplayText(){return this.fileInput.text}setAcceptTypes(e){this.setProperty("acceptTypes",e),this.fileInput.setAcceptTypes(e)}_renderEnabled(){super._renderEnabled(),this.$field.setTabbable(this.enabledComputed)}_renderPlaceholder(){let e=this.fileInput.$text;e&&e.placeholder(this.label)}_removePlaceholder(){let e=this.fileInput.$text;e&&e.placeholder("")}setMaximumUploadSize(e){this.setProperty("maximumUploadSize",e),this.fileInput.setMaximumUploadSize(e)}_clear(){this.fileInput.clear()}_onIconMouseDown(e){super._onIconMouseDown(e),this.activate()}_onFileChange(e){let t=p.first(e.files);b.isNullOrUndefined(t)&&this.acceptInput(!1),this.setValue(t)}activate(){!this.enabledComputed||!this.rendered||(this.$field.focus(),this.fileInput.browse())}_validateValue(e){return this.fileInput.validateMaximumUploadSize(e),e}_formatValue(e){return e?e.name:""}_parseValue(e){if(!e)return null;let t=this.fileInput.files;return t&&t.length?t[0]:null}}function A0(i,e,t){return e=$0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function $0(i){var e=R0(i,"string");return typeof e=="symbol"?e:String(e)}function R0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class _l extends Ot{_onWidgetPropertyChange(e){super._onWidgetPropertyChange(e),e.propertyName==="value"&&this._onValueChange(e)}_onValueChange(e){this.widget.fileInput.upload()||this.widget.fileInput.clear()}_syncDisplayText(e){this.widget.setDisplayText(e)}_orderPropertyNamesOnSync(e){return Object.keys(e).sort(this._createPropertySortFunc(_l.PROPERTIES_ORDER))}}A0(_l,"PROPERTIES_ORDER",["value","displayText"]);class Ec extends O{constructor(e){super(),this.field=e,this.which=[g.SPACE],this.stopPropagation=!0,this.renderingHints.hAlign=ht.LEFT,this.renderingHints.$drawingArea=(t,s)=>this.field.$fieldContainer}handle(e){this.field.fileInput.browse()}}class Fc extends O{constructor(e){super(),this.field=e,this.which=[g.DELETE],this.stopPropagation=!0,this.renderingHints.offset=25,this.renderingHints.hAlign=ht.RIGHT,this.renderingHints.$drawingArea=(t,s)=>this.field.$fieldContainer}handle(e){this.field.clear()}}function Me(i,e,t){return e=M0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function M0(i){var e=I0(i,"string");return typeof e=="symbol"?e:String(e)}function I0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class xe extends Fr{constructor(){super(),Me(this,"fields",void 0),Me(this,"menuBarVisible",void 0),Me(this,"menuBarPosition",void 0),Me(this,"menuBarEllipsisPosition",void 0),Me(this,"notification",void 0),Me(this,"bodyLayoutConfig",void 0),Me(this,"borderDecoration",void 0),Me(this,"borderVisible",void 0),Me(this,"mainBox",void 0),Me(this,"menuBar",void 0),Me(this,"subLabel",void 0),Me(this,"scrollable",void 0),Me(this,"expandable",void 0),Me(this,"expanded",void 0),Me(this,"gridColumnCount",void 0),Me(this,"controls",void 0),Me(this,"systemButtons",void 0),Me(this,"customButtons",void 0),Me(this,"processButtons",void 0),Me(this,"processMenus",void 0),Me(this,"staticMenus",void 0),Me(this,"responsive",void 0),Me(this,"responsiveHandler",void 0),Me(this,"htmlBody",void 0),Me(this,"$header",void 0),Me(this,"$body",void 0),Me(this,"$title",void 0),Me(this,"$borderBottom",void 0),Me(this,"$subLabel",void 0),Me(this,"_statusPositionOrig",void 0),Me(this,"_collapsedWeightY",void 0),this._addWidgetProperties(["fields","notification","staticMenus"]),this._addCloneProperties(["menuBarVisible","bodyLayoutConfig","borderDecoration","borderVisible","expandable","expanded","gridColumnCount","scrollable","subLabel"]),this.fields=[],this.menuBarVisible=!0,this.menuBarPosition=xe.MenuBarPosition.AUTO,this.menuBarEllipsisPosition=ce.EllipsisPosition.RIGHT,this.notification=null,this.bodyLayoutConfig=null,this.borderDecoration=xe.BorderDecoration.AUTO,this.borderVisible=!0,this.mainBox=!1,this.scrollable=null,this.expandable=!1,this.expanded=!0,this.logicalGrid=u.create(ad),this.gridColumnCount=2,this.gridDataHints.useUiHeight=!0,this.gridDataHints.w=A.FULL_WIDTH,this.controls=[],this.systemButtons=[],this.customButtons=[],this.processButtons=[],this.processMenus=[],this.staticMenus=[],this.responsive=null,this.$header=null,this.$body=null,this.$title=null,this.$subLabel=null,this._statusPositionOrig=null}_init(e){super._init(e),this.resolveConsts([{property:"menuBarPosition",constType:xe.MenuBarPosition}]),this._setBodyLayoutConfig(this.bodyLayoutConfig),this.menuBar=u.create(ce,{parent:this,menuOrder:new nr,ellipsisPosition:this.menuBarEllipsisPosition}),this.menuBar.on("propertyChange:visible",()=>this._updateMenuBarStyle()),this._setFields(this.fields),this._setMainBox(this.mainBox),this._updateMenuBar(),oe.get().registerHandler(this,u.create(lo,{widget:this})),this._setResponsive(this.responsive)}_destroy(){oe.get().unregisterHandler(this),super._destroy()}getFields(){return this.fields}insertField(e,t){let s=this.fields.slice();t=u.nvl(t,this.fields.length),s.splice(t,0,e),this.setFields(s)}insertFieldBefore(e,t){u.assertParameter("sibling",t);let s=this.fields.indexOf(t);this.insertField(e,s)}insertFieldAfter(e,t){u.assertParameter("sibling",t);let s=this.fields.indexOf(t)+1;this.insertField(e,s)}deleteField(e){let t=this.fields.indexOf(e);if(t<0)return;let s=this.fields.slice();s.splice(t,1),this.setFields(s)}setFields(e){this.setProperty("fields",e)}_setFields(e){this._setProperty("fields",e),this._prepareFields()}_renderFields(e){this._renderExpanded(),this.invalidateLogicalGrid(!0)}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.invokeAcceptInputOnActiveValueField=!0,this.keyStrokeContext.$bindTarget=this._keyStrokeBindTarget.bind(this)}_setKeyStrokes(e){e=p.ensure(e);let t={render:()=>!0,offset:0,hAlign:ht.RIGHT,$drawingArea:(s,r)=>this.$header&&this.$header.isVisible()?this.$header:this.$body};e.forEach(s=>{s.actionKeyStroke.renderingHints=a().extend({},s.actionKeyStroke.renderingHints,t)}),super._setKeyStrokes(e)}_keyStrokeBindTarget(){let e=this.getForm();return e?e.$container:this.$container}_render(){this.addContainer(this.$parent,this.mainBox?"root-group-box":"group-box"),this.$header=this.$container.appendDiv("group-box-header"),T.install(this.$header,this.session),this.$title=this.$header.appendDiv("title"),this.$borderBottom=this.$header.appendDiv("bottom-border"),this.addLabel(),this.addSubLabel(),this.addStatus(),this.$body=this.$container.appendDiv("group-box-body"),this.htmlBody=T.install(this.$body,this.session),this.htmlBody.setLayout(this._createBodyLayout())}_remove(){this._removeSubLabel(),super._remove()}_renderProperties(){this._renderScrollable(),this._renderExpanded(),super._renderProperties(),this._renderBodyLayoutConfig(),this._renderNotification(),this._renderBorderVisible(),this._renderExpandable(),this._renderMenuBarPosition(),this._renderMenuBarEllipsisPosition(),this._renderMenuBarVisible(),this._renderSubLabel()}_createLayout(){return new ih(this)}_createBodyLayout(){return new Gn(this,this.bodyLayoutConfig)}setBodyLayoutConfig(e){this.setProperty("bodyLayoutConfig",e)}_setBodyLayoutConfig(e){e||(e=new si),this._setProperty("bodyLayoutConfig",si.ensure(e))}_renderBodyLayoutConfig(){let e=this.htmlBody.layout,t=e.minWidth;this.bodyLayoutConfig.applyToLayout(e),t!==this.bodyLayoutConfig.minWidth&&this._renderScrollable(),this.rendered&&this.htmlBody.invalidateLayoutTree()}rerenderControls(){this._removeControls(),this._renderControls(),this.htmlBody.invalidateLayoutTree()}_removeControls(){this.controls.forEach(e=>e.remove())}_renderControls(){this.controls.forEach(e=>{e.rendered||(e.render(this.$body),e.setLayoutData(new xs(e)))})}addSubLabel(){this.$subLabel||(this.$subLabel=this.$title.appendDiv("sub-label"),K.installForEllipsis(this.$subLabel,{parent:this}))}_removeSubLabel(){!this.$subLabel||(K.uninstall(this.$subLabel),this.$subLabel.remove(),this.$subLabel=null)}setSubLabel(e){this.setProperty("subLabel",e)}_renderSubLabel(){this.$subLabel.setVisible(y.hasText(this.subLabel)),this.$subLabel.textOrNbsp(this.subLabel),this.$container.toggleClass("has-sub-label",this.$subLabel.isVisible()),this.invalidateLayoutTree()}setScrollable(e){this.setProperty("scrollable",e)}_renderScrollable(){this._uninstallScrollbars(),this.scrollable?this._installScrollbars({axis:this.bodyLayoutConfig.minWidth>0?"both":"y"}):this.bodyLayoutConfig.minWidth>0&&this._installScrollbars({axis:"x"})}get$Scrollable(){return this.$body}_onScroll(e){super._onScroll(e),this._updateScrollShadow()}_updateScrollShadow(){if(this.mainBox||!this.rendered)return;let e=this.hasScrollShadow("top"),t=this.hasScrollShadow("bottom"),s=this.$container.hasClass("has-scroll-shadow-top"),r=this.$container.hasClass("has-scroll-shadow-bottom"),n=this.$container.hasClass("menubar-position-top"),o=this.$container.hasClass("menubar-position-bottom"),l=this.$header.isVisible();this.$container.toggleClass("has-scroll-shadow-top",e),this.$container.toggleClass("has-scroll-shadow-bottom",t),((l||n)&&s!==e||o&&r!==t)&&this.invalidateLayoutTree(!1),Z.adjustStatusPositionForScrollShadow(this,()=>e&&l&&!n)}setMainBox(e){this.setProperty("mainBox",e)}_setMainBox(e){this._setProperty("mainBox",e),this.mainBox&&(this.menuBar.setCssClass("main-menubar"),this.scrollable===null&&this.setScrollable(!0),this.responsive===null&&this.setResponsive(!0))}addLabel(){this.$label||(this.$label=this.$title.appendDiv("label"),K.installForEllipsis(this.$label,{parent:this}))}_renderLabel(){this.$label.textOrNbsp(this.label),this.rendered&&this._renderLabelVisible()}addStatus(){super.addStatus(),this._updateStatusPosition()}_renderStatusPosition(){this._updateStatusPosition()}_updateStatusPosition(){!this.fieldStatus||(this.statusPosition===A.StatusPosition.TOP?this.$status.appendTo(this.$header):this.$status.appendTo(this.$container),this.invalidateLayoutTree())}setNotification(e){this.setProperty("notification",e)}_renderNotification(){if(!this.notification){this.invalidateLayoutTree();return}this.notification.render(),this.notification.$container.insertBefore(this.$body),this.invalidateLayoutTree()}_prepareFields(){this.processButtons.forEach(this._unregisterButtonKeyStrokes.bind(this)),this.controls=[],this.systemButtons=[],this.customButtons=[],this.processButtons=[],this.processMenus=[];for(let e=0;e<this.fields.length;e++){let t=this.fields[e];if(t instanceof Re)t.processButton?(this.processButtons.push(t),t.systemType!==Re.SystemType.NONE?this.systemButtons.push(t):this.customButtons.push(t)):(this.controls.push(t),this._registerButtonKeyStrokes(t));else if(t instanceof yo){this.controls.push(t);for(let s=0;s<t.tabItems.length;s++)t.tabItems[s].selectionKeystroke&&this.keyStrokeContext.registerKeyStroke(new md(t.tabItems[s].selectionKeystroke,t.tabItems[s]))}else this.controls.push(t)}this.processMenus=this.processButtons.map(e=>{let t=so.adaptButtonProperties(e,{parent:this,menubar:this.menuBar,button:e,defaultMenu:e.defaultButton?!0:null});return u.create(so,t)}),this.registerKeyStrokes(this.processMenus)}_unregisterButtonKeyStrokes(e){e.keyStrokes&&e.keyStrokes.forEach(t=>this.keyStrokeContext.unregisterKeyStroke(t))}_registerButtonKeyStrokes(e){e.keyStrokes&&e.keyStrokes.forEach(t=>this.keyStrokeContext.registerKeyStroke(t))}setBorderVisible(e){this.setProperty("borderVisible",e)}_renderBorderVisible(){let e=this.borderVisible;this.borderDecoration===xe.BorderDecoration.AUTO&&(e=this._computeBorderVisible(e)),this.$body.toggleClass("y-padding-invisible",!e),this.invalidateLayoutTree()}setBorderDecoration(e){this.setProperty("borderDecoration",e)}_renderBorderDecoration(){this._renderBorderVisible()}getContextMenuItems(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this.menuBarVisible?[]:super.getContextMenuItems(e)}setMenuBarVisible(e){this.setProperty("menuBarVisible",e)}_setMenuBarVisible(e){this._setProperty("menuBarVisible",e),this._updateMenuBar()}_renderMenuBarVisible(){this.menuBarVisible?this._renderMenuBar():this.menuBar.remove(),this._updateMenus(),this.invalidateLayoutTree()}_renderMenuBar(){if(this.menuBar.render(),this.menuBarPosition===xe.MenuBarPosition.TITLE){let e=this.$header.children(".group-box-control");e.length>0?this.menuBar.$container.insertAfter(e):this.menuBar.$container.insertAfter(this.$title)}else this.menuBar.position===ce.Position.TOP&&this.menuBar.$container.insertAfter(this.$header)}setMenuBarPosition(e){this.setProperty("menuBarPosition",e)}_renderMenuBarPosition(){let e=this.menuBarPosition;if(e===xe.MenuBarPosition.AUTO&&(e=xe.MenuBarPosition.TOP,this.mainBox)){let t=this.getForm();t&&t.isDialog()&&(e=xe.MenuBarPosition.BOTTOM)}e===xe.MenuBarPosition.BOTTOM?this.menuBar.setPosition(ce.Position.BOTTOM):this.menuBar.setPosition(ce.Position.TOP),this._renderMenuBarStyle(),this.rendered&&(this.menuBar.remove(),this._renderMenuBarVisible())}setMenuBarEllipsisPosition(e){this.setProperty("menuBarEllipsisPosition",e),this.menuBar.setEllipsisPosition(e)}_renderMenuBarEllipsisPosition(){this.menuBar.reorderMenus(),this.rendered&&(this.menuBar.remove(),this._renderMenuBarVisible())}_updateMenuBarStyle(){this.rendered&&this._renderMenuBarStyle()}_renderMenuBarStyle(){let e=this.menuBar.visible,t=this.menuBarPosition===xe.MenuBarPosition.TITLE;this.$header.toggleClass("has-menubar",e&&t),this.$container.toggleClass("menubar-position-top",e&&!t&&this.menuBar.position===ce.Position.TOP),this.$container.toggleClass("menubar-position-bottom",e&&!t&&this.menuBar.position===ce.Position.BOTTOM)}_computeBorderVisible(e){return(this.mainBox||this.parent instanceof xe&&this.parent.parent instanceof U&&this.parent.parent.parent instanceof wo&&this.parent.parent.parent.parent instanceof ge&&this.parent.getFields().length===1)&&(e=!1),e}setExpandable(e){this.setProperty("expandable",e)}_renderExpandable(){let e=this.expandable,t=this.$header.children(".group-box-control");e?(t.length===0&&this.$container.makeDiv("group-box-control").on("click",this._onControlClick.bind(this)).insertAfter(this.$title),this.$header.addClass("expandable").on("click.group-box-control",this._onControlClick.bind(this))):(t.remove(),this.$header.removeClass("expandable").off(".group-box-control")),this.invalidateLayoutTree()}setExpanded(e){this.setProperty("expanded",e)}_renderExpanded(){this.$container.toggleClass("collapsed",!this.expanded),this.expanded?(this._collapsedWeightY!==void 0&&(this.gridData.weightY=this._collapsedWeightY,delete this._collapsedWeightY),this.invalidateLayout(),this._renderControls()):this.gridData.weightY!==0&&(this._collapsedWeightY=this.gridData.weightY,this.gridData.weightY=0),this.invalidateLayoutTree()}setGridColumnCount(e){this.setProperty("gridColumnCount",e),this.invalidateLogicalGrid()}invalidateLogicalGrid(e){super.invalidateLogicalGrid(!1),u.nvl(e,!0)&&this.rendered&&this.htmlBody.invalidateLayoutTree()}_setLogicalGrid(e){super._setLogicalGrid(e),this.logicalGrid&&this.logicalGrid.setGridConfig(new Dc)}_renderLabelVisible(){this.$header.setVisible(this._computeTitleVisible()),this._updateFieldStatus(),this.menuBarPosition===xe.MenuBarPosition.TITLE&&this.invalidateLayoutTree()}_computeTitleVisible(e){return e=u.nvl(e,this.labelVisible),!!(e&&this.label&&!this.mainBox)}_computeStatusVisible(){return super._computeStatusVisible()&&this._computeTitleVisible()}_setMenus(e){super._setMenus(e),this.menuBar&&this._updateMenuBar()}_updateMenuBar(){if(!this.menuBarVisible){this.menuBar.setMenuItems([]);return}let e=this.staticMenus.concat(this.processMenus).concat(this.menus);this.menuBar.setMenuItems(e)}_removeMenus(){}setStaticMenus(e){this.setProperty("staticMenus",e),this._updateMenuBar()}_onControlClick(e){if(!this.expandable)return;const t=u.widget(e.target);this.menuBarPosition===xe.MenuBarPosition.TITLE&&this.menuBar.has(t)||(this.setExpanded(!this.expanded),a().suppressEvent(e))}setResponsive(e){this.setProperty("responsive",e)}_setResponsive(e){if(this._setProperty("responsive",e),!!this.initialized){if(this.responsive)oe.get().reset(this,!0);else if(oe.get().reset(this,!0),this.responsive===null){let t=this.findParent(s=>s instanceof xe&&s.responsive);oe.get().reset(t,!0)}this.invalidateLayoutTree()}}clone(e,t){let s=super.clone(e);return this._deepCloneProperties(s,["fields"],t),s._prepareFields(),s}}Me(xe,"BorderDecoration",{AUTO:"auto",EMPTY:"empty",LINE:"line"}),Me(xe,"MenuBarPosition",{AUTO:"auto",TOP:"top",BOTTOM:"bottom",TITLE:"title"});class Dc extends gr{getGridWidgets(){return this.widget.controls}getGridColumnCount(){let e=-1,t=this.widget;do e=u.nvl(t.gridColumnCount,e);while(e<0&&t.getParentGroupBox&&(t=t.getParentGroupBox()));return e<0?2:e}}class Ac extends fo{constructor(){super(),this._addRemoteProperties(["expanded"])}_initModel(e,t){let s=super._initModel(e,t);return s.logicalGrid=null,s}_postCreateWidget(){super._postCreateWidget(),this.widget.responsiveHandler&&(this.widget.responsiveHandler.setAllowedStates([oe.ResponsiveState.NORMAL,oe.ResponsiveState.CONDENSED]),this.widget.responsiveHandler.getGridData=this._getGridData,this.widget.responsiveHandler.setGridData=this._setGridData)}_getGridData(e){return new ze(e.gridData)}_setGridData(e,t){e._setGridData(t)}}function $c(i,e,t){return e=L0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function L0(i){var e=O0(i,"string");return typeof e=="symbol"?e:String(e)}function O0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ih extends ee{constructor(e){super(),$c(this,"groupBox",void 0),$c(this,"_htmlPropertyChangeHandler",void 0),$c(this,"_statusWidth",void 0),this.groupBox=e,this._initDefaults(),this._htmlPropertyChangeHandler=this._onHtmlEnvironmentPropertyChange.bind(this),de.get().on("propertyChange",this._htmlPropertyChangeHandler),this.groupBox.one("remove",()=>{de.get().off("propertyChange",this._htmlPropertyChangeHandler)})}_initDefaults(){this._statusWidth=de.get().fieldStatusWidth}_onHtmlEnvironmentPropertyChange(){this._initDefaults(),this.groupBox.invalidateLayoutTree()}layout(e){let t,s=0,r=0,n=this.groupBox.statusPosition,o=this.groupBox.htmlComp,l=this._htmlGbBody(),h=this._htmlMenuBar(),d=this.groupBox.tooltip(),c=this.groupBox.$header,f=this.groupBox.$title,m=o.availableSize().subtract(o.insets());this.groupBox.responsive&&oe.get().handleResponsive(this.groupBox,m.width);let _=this._$status();_&&_.isVisible()&&(this._layoutStatus(),r=_.outerWidth(!0)),h?(this.groupBox.menuBarPosition===xe.MenuBarPosition.TITLE?t=this._updateHeaderMenuBar(h,c,f,r):(t=this._updateMenuBar(h,m,r),s=t.height,S(f)),h.setSize(t)):S(f),n!==A.StatusPosition.TOP?S(c,r):S(c),this.groupBox.notification&&S(this.groupBox.notification.$container,r);let C=m.subtract(l.margins());C.height-=this._headerHeight(),C.height-=this._notificationHeight(),C.height-=s,a().log.isTraceEnabled()&&a().log.trace("(GroupBoxLayout#layout) gbBodySize="+C),l.setSize(C),d&&d.rendered&&d.position(),(l.scrollable||this.groupBox.bodyLayoutConfig.minWidth>0)&&P.update(l.$comp);function S(R,L){if(L){let H=R.cssMarginX()+L;R.cssWidth("calc(100% - "+H+"px)")}else R.cssWidth("")}}_updateMenuBar(e,t,s){let r=this.groupBox.$container,n=e.$comp;if(!this.groupBox.mainBox&&r.hasClass("menubar-position-top")&&r.hasClass("has-scroll-shadow-top")||r.hasClass("menubar-position-bottom")&&r.hasClass("has-scroll-shadow-bottom")){let o=v.margins(n);o.left>0&&(n.cssPaddingLeft(o.left),n.cssMarginLeft(0)),s>0&&(n.cssPaddingRight(s),s=0)}else n.cssPaddingLeft(""),n.cssMarginLeft(""),n.cssPaddingRight("");return this._menuBarSize(e,t,s)}_menuBarSize(e,t,s){let r=er.size(e,t);return this.groupBox.mainBox||(r.width-=s),r}_updateHeaderMenuBar(e,t,s,r){let n=e.prefSize({exact:!0}),l=v.prefSize(t).subtract(v.insets(t)).width-r,h=t.children(".group-box-control");h.length>0&&(l-=v.size(h,!0).width);let d=Math.ceil(v.prefSize(s,!0).width)+1,c=n.width;if(d+c<l)c=Math.floor(l-d),n.width=c,s.cssWidth("");else{let f=(d+c)/l,m=d/l/f,_=c/l/f;m<_?(m=Math.max(.33,m),_=1-m):(_=Math.max(.33,_),m=1-_),d=m*l,c=_*l,n.width=Math.floor(c),s.cssWidth(Math.floor(d))}return n}_$status(){return this.groupBox.$status}_layoutStatus(){let e=this.groupBox.htmlComp,t=e.insets({includeBorder:!1}),s=t.top,r=t.right,n=this.groupBox.$header,o=n.innerHeight(),l=this._$status(),h=v.margins(l),d=this.groupBox.statusPosition;l.cssWidth(this._statusWidth),d===A.StatusPosition.DEFAULT&&(s+=n.cssMarginTop()),l.cssTop(s).cssRight(r).cssHeight(o-h.vertical())}preferredLayoutSize(e,t){t=t||{};let s=this.groupBox.htmlComp,r=this._htmlGbBody(),n,o=0,l=0,h=this.groupBox.gridData,d=!1;if(this.groupBox.responsive&&t.widthHint&&(d=oe.get().handleResponsive(this.groupBox,t.widthHint)),h&&(o=h.widthInPixel,l=h.heightInPixel),o&&l)return n=new F(o,l).add(s.insets()),n;if(!t.widthHint&&o&&(t.widthHint=o),t.heightHint=null,this.groupBox.expanded){n=r.prefSize(t).add(r.margins());let c=this._htmlMenuBar();c&&this.groupBox.menuBarPosition!==xe.MenuBarPosition.TITLE&&(n.height+=c.prefSize(t).height)}else n=new F(0,0);return n=n.add(s.insets()),n.height+=this._headerHeight(),n.height+=this._notificationHeight(t),o&&(n.width=o),l&&(n.height=l),d&&oe.get().reset(this.groupBox),n}_headerHeight(){return v.prefSize(this.groupBox.$header,!0).height}_notificationHeight(e){return e=e||{},this.groupBox.notification?(e.includeMargin=!0,this.groupBox.notification.htmlComp.prefSize(e).height):0}_htmlMenuBar(){if(this.groupBox.menuBar&&this.groupBox.menuBarVisible){let e=T.optGet(this.groupBox.menuBar.$container);if(e&&e.isVisible())return e}return null}_htmlGbBody(){return T.get(this.groupBox.$body)}}class nr{order(e){let t=[],s=[],r=[],n=[];return e.forEach(o=>{o.isButton()?o.horizontalAlignment===1?r.push(o):t.push(o):o.horizontalAlignment===1?n.push(o):s.push(o)}),{left:t.concat(s),right:n.concat(r),all:t.concat(s).concat(n).concat(r)}}}function Rc(i,e,t){return e=B0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function B0(i){var e=k0(i,"string");return typeof e=="symbol"?e:String(e)}function k0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Mc extends me{constructor(){super(),Rc(this,"scrollBarEnabled",void 0),Rc(this,"selectable",void 0),Rc(this,"scrollToAnchor",void 0),this.scrollBarEnabled=!1,this.scrollToAnchor=null,this.preventInitialFocus=!0,this.selectable=!0}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.registerKeyStroke(new po(this,this._onAppLinkAction))}_render(){this.addContainer(this.$parent,"html-field"),this.addLabel(),this.addField(this.$parent.makeDiv()),this.addStatus()}_renderProperties(){super._renderProperties(),this._renderScrollBarEnabled(),this._renderScrollToAnchor(),this._renderSelectable()}_readDisplayText(){return this.displayText}_renderDisplayText(){if(!this.displayText){this.$field.empty();return}this.$field.html(this.displayText),this.$field.find(".app-link").on("click",this._onAppLinkAction.bind(this)),this.$field.find("a, .app-link").attr("tabindex","0").unfocusable(),this.$field.find("img").on("load",this._onImageLoad.bind(this)).on("error",this._onImageError.bind(this)),this.rendered&&(this._uninstallScrollbars(),this._renderScrollBarEnabled()),this.invalidateLayoutTree()}_renderFocused(){}setScrollBarEnabled(e){this.setProperty("scrollBarEnabled",e)}_renderScrollBarEnabled(){this.scrollBarEnabled?this._installScrollbars():this._uninstallScrollbars()}_renderScrollToAnchor(){if(!this.rendered){this.session.layoutValidator.schedulePostValidateFunction(this._renderScrollToAnchor.bind(this));return}if(this.scrollBarEnabled&&this.scrollToAnchor){let e=this.$field.find("#".concat(this.scrollToAnchor));e&&e.length>0&&P.scrollTo(this.$field,e)}}setSelectable(e){this.setProperty("selectable",e)}_renderSelectable(){this.$container.toggleClass("selectable",!!this.selectable),this.$field.toggleAttr("tabindex",!!this.selectable,"-1")}_onAppLinkAction(e){let s=a()(e.delegateTarget).data("ref");this.triggerAppLinkAction(s)}triggerAppLinkAction(e){this.trigger("appLinkAction",{ref:e})}_onImageLoad(e){this.invalidateLayoutTree()}_onImageError(e){this.invalidateLayoutTree()}}class Qg extends Ot{_initProperties(e){e.scrollToEnd!==void 0&&delete e.scrollToEnd}_syncScrollToEnd(){this.widget.scrollToBottom()}_onWidgetAppLinkAction(e){this._send("appLinkAction",{ref:e.ref})}_onWidgetEvent(e){e.type==="appLinkAction"?this._onWidgetAppLinkAction(e):super._onWidgetEvent(e)}}function Ks(i,e,t){return e=H0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function H0(i){var e=N0(i,"string");return typeof e=="symbol"?e:String(e)}function N0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ar extends A{constructor(){super(),Ks(this,"autoFit",void 0),Ks(this,"imageUrl",void 0),Ks(this,"scrollBarEnabled",void 0),Ks(this,"uploadEnabled",void 0),Ks(this,"acceptTypes",void 0),Ks(this,"maximumUploadSize",void 0),Ks(this,"icon",void 0),Ks(this,"fileInput",void 0),Ks(this,"_clickHandler",void 0),this.defaultMenuTypes=[...this.defaultMenuTypes,Ar.MenuTypes.ImageUrl,Ar.MenuTypes.Null],this.autoFit=!1,this.imageUrl=null,this.scrollBarEnabled=!1,this.uploadEnabled=!1,this.acceptTypes=null,this.maximumUploadSize=_i.DEFAULT_MAXIMUM_UPLOAD_SIZE,this._clickHandler=null}_init(e){super._init(e),this.resolveIconIds(["imageUrl"]),this.icon=u.create(Zs,{parent:this,iconDesc:this.imageUrl,autoFit:this.autoFit,prepend:!0}),this.icon.on("load",this._onImageLoad.bind(this)),this.icon.on("error",this._onImageError.bind(this))}_render(){this.addContainer(this.$parent,"image-field",new Ic(this)),this.addFieldContainer(this.$parent.makeDiv()),T.install(this.$fieldContainer,this.session).setLayout(new Es),this.icon.render(this.$fieldContainer),this.addLabel(),this.addField(this.icon.$container),this.addStatus()}_renderProperties(){super._renderProperties(),this._renderScrollBarEnabled(),this._renderImageUrl(),this._renderUploadEnabled()}_remove(){super._remove(),this._clickHandler=null,this.fileInput&&(this.fileInput.destroy(),this.fileInput=null)}_getDragAndDropHandlerOptions(){let e=super._getDragAndDropHandlerOptions();return e.container=()=>this.$fieldContainer,e}setImageUrl(e){this.setProperty("imageUrl",e)}_setImageUrl(e){this._setProperty("imageUrl",e),this.icon.setIconDesc(e),this._updateMenus()}_renderImageUrl(){let e=!!this.imageUrl;this.$fieldContainer.toggleClass("has-image",e),this.$container.toggleClass("has-image",e),P.update(this.$fieldContainer)}setAutoFit(e){this.setProperty("autoFit",e)}_setAutoFit(e){this._setProperty("autoFit",e),this.icon.setAutoFit(e)}_renderAutoFit(){P.update(this.$fieldContainer)}setScrollBarEnabled(e){this.setProperty("scrollBarEnabled",e)}_renderScrollBarEnabled(){this._updateInnerAlignment(),this.scrollBarEnabled?this._installScrollbars():this._uninstallScrollbars()}get$Scrollable(){return this.$fieldContainer}_renderGridData(){super._renderGridData(),this._updateInnerAlignment()}_renderGridDataHints(){super._renderGridDataHints(),this._updateInnerAlignment()}_updateInnerAlignment(){this.updateInnerAlignment({useHorizontalAlignment:!this.scrollBarEnabled,useVerticalAlignment:!this.scrollBarEnabled})}_renderEnabled(){super._renderEnabled(),this._updateUploadEnabled()}setUploadEnabled(e){this.setProperty("uploadEnabled",e)}_renderUploadEnabled(){this._updateUploadEnabled()}_updateUploadEnabled(){let e=this.enabledComputed&&this.uploadEnabled;this.$fieldContainer.toggleClass("clickable",e),e?(this._clickHandler||(this._clickHandler=this._onClickUpload.bind(this),this.$fieldContainer.on("click",this._clickHandler)),this.fileInput||(this.fileInput=u.create(_i,{parent:this,acceptTypes:this.acceptTypes,text:this.displayText,enabled:this.enabledComputed,maximumUploadSize:this.maximumUploadSize,visible:!x.get().supportsFile()}),this.fileInput.render(this.$fieldContainer),this.fileInput.on("change",this._onFileChange.bind(this)))):(this.$fieldContainer.off("click",this._clickHandler),this._clickHandler=null,this.fileInput&&(this.fileInput.destroy(),this.fileInput=null))}_getCurrentMenuTypes(){return this.imageUrl?[...super._getCurrentMenuTypes(),Ar.MenuTypes.ImageUrl]:[...super._getCurrentMenuTypes(),Ar.MenuTypes.Null]}_onClickUpload(e){a()(e.target).isOrHas(this.$field)&&this.fileInput.browse()}_onFileChange(e){this.trigger("fileUpload",{file:p.first(e.files)})}_onImageLoad(e){this._onIconUpdated()}_onImageError(e){this._onIconUpdated()}_onIconUpdated(){P.update(this.$fieldContainer),this.$field=this.icon.$container}}Ks(Ar,"MenuTypes",{Null:"ImageField.Null",ImageUrl:"ImageField.ImageUrl"});class Zg extends at{_onWidgetEvent(e){e.type==="fileUpload"?this._onFileUpload(e):super._onWidgetEvent(e)}_onFileUpload(e){this.widget.fileInput.upload()||this.widget.fileInput.clear()}}class Ic extends oi{constructor(e){super(e)}layout(e){super.layout(e),P.update(this.formField.$fieldContainer)}}function Lc(i,e,t){return e=V0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function V0(i){var e=W0(i,"string");return typeof e=="symbol"?e:String(e)}function W0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class sh extends me{constructor(){super(),Lc(this,"htmlEnabled",void 0),Lc(this,"selectable",void 0),Lc(this,"wrapText",void 0),this.htmlEnabled=!1,this.selectable=!0,this.wrapText=!1,this.preventInitialFocus=!0}_initValue(e){e=Ce.resolveText(e,this.session.locale.languageTag),super._initValue(e)}_render(){this.addContainer(this.$parent,"label-field"),this.addLabel(),this.addField(this.$parent.makeDiv()),this.addStatus()}_renderProperties(){super._renderProperties(),this._renderWrapText(),this._renderSelectable()}_renderFocused(){}acceptInput(e){}setHtmlEnabled(e){this.setProperty("htmlEnabled",e)}_renderHtmlEnabled(){this._renderDisplayText()}_renderDisplayText(){let e=this.displayText||"";this.htmlEnabled?(this.$field.html(e),this.$field.find(".app-link").on("click",this._onAppLinkAction.bind(this))):this.$field.html(y.nl2br(e)),this.invalidateLayoutTree()}setWrapText(e){this.setProperty("wrapText",e)}_renderWrapText(){this.$field.toggleClass("white-space-nowrap",!this.wrapText),this.invalidateLayoutTree()}setSelectable(e){this.setProperty("selectable",e)}_renderSelectable(){this.$container.toggleClass("selectable",!!this.selectable),this.$field.toggleAttr("tabindex",!!this.selectable,"-1")}_renderGridData(){super._renderGridData(),this.updateInnerAlignment({useHorizontalAlignment:!0})}_renderGridDataHints(){super._renderGridDataHints(),this.updateInnerAlignment({useHorizontalAlignment:!0})}_onAppLinkAction(e){let s=$(e.delegateTarget).data("ref");this.triggerAppLinkAction(s)}triggerAppLinkAction(e){this.trigger("appLinkAction",{ref:e})}addField(e){super.addField(e),this.$field.off("blur").off("focus")}}class e_ extends Ot{_onWidgetAppLinkAction(e){this._send("appLinkAction",{ref:e.ref})}_onWidgetEvent(e){e.type==="appLinkAction"?this._onWidgetAppLinkAction(e):super._onWidgetEvent(e)}}function z0(i,e,t){return e=K0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function K0(i){var e=G0(i,"string");return typeof e=="symbol"?e:String(e)}function G0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class rh extends yn{constructor(){super(),z0(this,"table",void 0),this.table=null,this.lookupStatus=null,this._addWidgetProperties(["table","filterBox"])}_init(e){super._init(e),this.table.on("rowsChecked",this._onTableRowsChecked.bind(this)),this.table.setScrollTop(this.scrollTop)}_initStructure(e){this.table||(this.table=this._createDefaultListBoxTable()),this.table.checkableColumn&&(this.table.checkableColumn.minWidth=28,this.table.checkableColumn.width=this.table.checkableColumn.minWidth)}_render(){super._render(),this.$container.addClass("list-box")}_createFieldContainerLayout(){return new Oc(this,this.table,this.filterBox)}_renderStructure(){this.table.render(this.$fieldContainer),this.addField(this.table.$container)}_onTableRowsChecked(e){this._syncTableToValue()}_syncTableToValue(){if(!this.lookupCall||this._valueSyncing)return;this._valueSyncing=!0;let e=[];this.table.rows.forEach(t=>{t.checked&&e.push(t.lookupRow.key)},this),this.setValue(e),this._valueSyncing=!1}_valueChanged(){super._valueChanged(),this._syncValueToTable(this.value)}_syncValueToTable(e){if(!this.lookupCall||this._valueSyncing||!this.initialized)return;this._valueSyncing=!0;let t={checkOnlyEnabled:!1};try{if(p.empty(e))this.table.uncheckRows(this.table.rows,t);else{if(this._ensureLookupCallExecuted())return;let r=[];this.table.uncheckRows(this.table.rows,t),this.table.rows.forEach(n=>{p.containsAny(e,n.lookupRow.key)&&r.push(n)},this),this.table.checkRows(r,t)}this._updateDisplayText()}finally{this._valueSyncing=!1}}_lookupByAllDone(e){return super._lookupByAllDone(e)?(this._populateTable(e),!0):!1}_populateTable(e){let t=[];e.lookupRows.forEach(function(r){t.push(this._createTableRow(r))},this),this.table.deleteAllRows(),this.table.insertRows(t),this._syncValueToTable(this.value)}getCheckedLookupRows(){return this.value===null||p.empty(this.value)||this.table.rows.length===0?[]:this.table.rows.filter(e=>e.checked).map(e=>e.lookupRow)}_createTableRow(e){let t=u.create(Pt,{text:e.text}),s=[t],r={cells:s,lookupRow:e};return e.iconId&&(t.iconId=e.iconId),e.tooltipText&&(t.tooltipText=e.tooltipText),e.backgroundColor&&(t.backgroundColor=e.backgroundColor),e.foregroundColor&&(t.foregroundColor=e.foregroundColor),e.font&&(t.font=e.font),e.enabled===!1&&(r.enabled=!1),e.cssClass&&(r.cssClass=e.cssClass),e.active===!1&&(r.active=!1,r.cssClass=(r.cssClass?r.cssClass+" ":"")+"inactive"),r}_createDefaultListBoxTable(){return u.create(V,{parent:this,autoResizeColumns:!0,checkable:!0,checkableStyle:V.CheckableStyle.CHECKBOX_TABLE_ROW,headerVisible:!1,footerVisible:!1,columns:[{objectType:De}]})}getDelegateScrollable(){return this.table}}class t_ extends Ot{}class Oc extends Qa{constructor(e,t,s){super(e,t,s)}}const _o={createTableRow(i,e){e=u.nvl(e,!1);let t=[],s={cells:t,lookupRow:i};return i.enabled===!1&&(s.enabled=!1),i.cssClass&&(s.cssClass=i.cssClass),i.active===!1&&(s.cssClass=(s.cssClass?s.cssClass+" ":"")+"inactive"),e||t.push(_o.createTableCell(i,null,null)),s},createTableCell(i,e,t){let s=u.create(Pt);return e&&e.propertyName?s.text=t[e.propertyName]:(s.text=i.text,i.iconId&&(s.iconId=i.iconId),i.tooltipText&&(s.tooltipText=i.tooltipText),i.backgroundColor&&(s.backgroundColor=i.backgroundColor),i.foregroundColor&&(s.foregroundColor=i.foregroundColor),i.font&&(s.font=i.font)),s}};class nh extends Ot{sendLookup(e,t){let s=e.toLowerCase(),r="lookupBy"+y.toUpperCaseFirstLetter(s),n={showBusyIndicator:!1};b.isNullOrUndefined(t)||(n[s]=t),this._send(r,n)}}function Bc(i,e,t){return e=U0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function U0(i){var e=q0(i,"string");return typeof e=="symbol"?e:String(e)}function q0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class i_ extends me{constructor(){super(),Bc(this,"modeSelector",void 0),Bc(this,"modes",void 0),Bc(this,"_selectedModeChangeHandler",void 0),this._addWidgetProperties(["modeSelector","modes"]),this._selectedModeChangeHandler=this._onSelectedModeChange.bind(this)}_render(){this.addContainer(this.$parent,"mode-selector-field"),this.addLabel(),this.addStatus(),this.modeSelector&&(this._renderModeSelector(),this.modeSelector.on("propertyChange:selectedMode",this._selectedModeChangeHandler))}_renderModeSelector(){this.modeSelector.render(),this.addField(this.modeSelector.$container)}_removeModeSelector(){this.modeSelector.remove(),this._removeField()}_onSelectedModeChange(e){e.newValue?this.setValue(e.newValue.ref):this.modeSelector.selectedMode&&this.modeSelector.selectedMode.id?this.setValue(this.modeSelector.selectedMode.id):this.setValue(null)}}class s_ extends Ot{_createWidget(e){return this._addModeSelector(e),super._createWidget(e)}_addModeSelector(e){e.modeSelector={objectType:du}}_postCreateWidget(){this.widget.modeSelector.setModes(this.widget.modes),delete this.widget.modes}}function oh(i,e,t){return e=Y0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Y0(i){var e=j0(i,"string");return typeof e=="symbol"?e:String(e)}function j0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Pn extends fl{constructor(){super(),oh(this,"calc",void 0),oh(this,"minValue",void 0),oh(this,"maxValue",void 0),oh(this,"decimalFormat",void 0),this.calc=new Hc,this.minValue=null,this.maxValue=null,this.decimalFormat=null,this.invalidValueMessageKey="InvalidNumberMessageX",this.gridDataHints.horizontalAlignment=1}_init(e){super._init(e),this._setMinValue(this.minValue),this._setMaxValue(this.maxValue),this._setDecimalFormat(this.decimalFormat)}_initValue(e){this._setDecimalFormat(this.decimalFormat),super._initValue(e)}_createKeyStrokeContext(){return new As}_render(){this.addContainer(this.$parent,"number-field"),this.addLabel(),this.addMandatoryIndicator();let e=Z.makeTextField(this.$parent);this.addField(e),this.addStatus()}_renderGridData(){super._renderGridData(),this.updateInnerAlignment({useHorizontalAlignment:!0})}_renderGridDataHints(){super._renderGridDataHints(),this.updateInnerAlignment({useHorizontalAlignment:!0})}_getDefaultFormat(e){return e.decimalFormatPatternDefault}setDecimalFormat(e){this.setProperty("decimalFormat",e)}_setDecimalFormat(e){e||(e=this._getDefaultFormat(this.session.locale)),e=Ls.ensure(this.session.locale,e),this._setProperty("decimalFormat",e),this.initialized&&this._updateDisplayText()}_parseValue(e){return e?this.decimalFormat.parse(e,this._evaluateNumber.bind(this)):null}_evaluateNumber(e){if(this.calc.isFormula(e)){let t=this.calc.evalFormula(e);if(isNaN(t))throw new Error(e+" is not a valid expression");return t}return Number(e)}_ensureValue(e){let t=Ke.ensure(e);if(b.isNullOrUndefined(t))return t;if(!Ke.isNumber(t))throw this.session.text(this.invalidValueMessageKey,e);return t}_validateValue(e){return b.isNullOrUndefined(e)||(!b.isNullOrUndefined(this.minValue)&&e<this.minValue&&this._onNumberTooSmall(),!b.isNullOrUndefined(this.maxValue)&&e>this.maxValue&&this._onNumberTooLarge()),e}_onNumberTooLarge(){throw b.isNullOrUndefined(this.minValue)?this.session.text("NumberTooLargeMessageX",this._formatValue(this.maxValue)):this.session.text("NumberTooLargeMessageXY",this._formatValue(this.minValue),this._formatValue(this.maxValue))}_onNumberTooSmall(){throw b.isNullOrUndefined(this.maxValue)?this.session.text("NumberTooSmallMessageX",this._formatValue(this.minValue)):this.session.text("NumberTooSmallMessageXY",this._formatValue(this.minValue),this._formatValue(this.maxValue))}_formatValue(e){return b.isNullOrUndefined(e)?"":typeof e!="number"?e+"":this.decimalFormat.format(e,!0)}setMinValue(e){this.minValue!==e&&(this._setMinValue(e),this.validate())}_setMinValue(e){this._setProperty("minValue",e),!b.isNullOrUndefined(this.maxValue)&&!b.isNullOrUndefined(this.minValue)&&e>this.maxValue&&this._setMaxValue(e)}setMaxValue(e){this.maxValue!==e&&(this._setMaxValue(e),this.validate())}_setMaxValue(e){this._setProperty("maxValue",e),!b.isNullOrUndefined(this.maxValue)&&!b.isNullOrUndefined(this.minValue)&&e<this.minValue&&this._setMinValue(e)}}class kc extends Ja{_onWidgetParseError(e){e.preventDefault()}_onWidgetEvent(e){e.type==="parseError"?this._onWidgetParseError(e):super._onWidgetEvent(e)}static modifyPrototype(){!te.get().remote||b.replacePrototypeFunction(Pn,"clearErrorStatus",function(){if(!this.modelAdapter)return this.clearErrorStatusOrig()},!0)}}te.addListener("bootstrap",kc.modifyPrototype);function X0(i,e,t){return e=J0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function J0(i){var e=Q0(i,"string");return typeof e=="symbol"?e:String(e)}function Q0(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Hc{constructor(){X0(this,"_tokens",void 0),this._tokens=[]}isFormula(e){return e.match(/^[\d()+\-*/.]+$/)}evalFormula(e){return this._tokens=e.split(/([\d.]+|\(|\)|[+\-*/])/).filter(t=>t.length!==0),this._expr()}_next(){if(this._tokens.length!==0)return this._tokens[0]}_consumeNext(){let e=this._tokens[0];return this._tokens=this._tokens.slice(1,this._tokens.length),e}_expr(){return this._sum()}_sum(){let e=this._prod();for(;this._next()==="+"||this._next()==="-";)switch(this._consumeNext()){case"+":e=e+this._prod();break;case"-":e=e-this._prod();break}return e}_prod(){let e=this._unary();for(;this._next()==="*"||this._next()==="/";)switch(this._consumeNext()){case"*":e=e*this._unary();break;case"/":e=e/this._unary();break}return e}_unary(){let e=1;this._next()==="+"?this._consumeNext():this._next()==="-"&&(this._consumeNext(),e=-1);let t;return(t=this._group())!==void 0||(t=this._consumeNext()),e*t}_group(){if(this._next()==="("){this._consumeNext();let e=this._expr();if(this._next()!==")")throw"missing closing bracket";return this._consumeNext(),e}}}function r_(i,e,t){return e=Z0(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Z0(i){var e=eD(i,"string");return typeof e=="symbol"?e:String(e)}function eD(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class xn extends Pn{constructor(){super(),this.minValue=xn.MIN_VALUE,this.maxValue=xn.MAX_VALUE}_getDefaultFormat(e){return"#,##0"}_parseValue(e){let t=super._parseValue(e);return b.isNullOrUndefined(t)?null:this.decimalFormat.round(t,!1)}}r_(xn,"MIN_VALUE",Number.MIN_SAFE_INTEGER),r_(xn,"MAX_VALUE",Number.MAX_SAFE_INTEGER);class lh extends A{_render(){this.addContainer(this.$parent,"placeholder-field"),this.addLabel()}_renderLabel(){this._renderEmptyLabel()}}class n_ extends at{}function tD(i,e,t){return e=iD(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function iD(i){var e=sD(i,"string");return typeof e=="symbol"?e:String(e)}function sD(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class o_ extends A{constructor(){super(),tD(this,"planner",void 0),this._addWidgetProperties(["planner"]),this.gridDataHints.weightY=1}_render(){this.addContainer(this.$parent,"planner-field"),this.addLabel(),this.addStatus(),this.planner&&this._renderPlanner()}_renderPlanner(){this.planner.render(),this.addField(this.planner.$container)}_removePlanner(){this.planner.remove(),this._removeField()}}class l_ extends at{}function yl(i,e,t){return e=rD(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function rD(i){var e=nD(i,"string");return typeof e=="symbol"?e:String(e)}function nD(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class bl extends Re{constructor(){super(),yl(this,"focusWhenSelected",void 0),yl(this,"wrapText",void 0),yl(this,"radioValue",void 0),yl(this,"$radioButton",void 0),yl(this,"lookupRow",void 0),this.gridDataHints.fillHorizontal=!0,this.focusWhenSelected=!0,this.wrapText=!1,this.buttonKeyStroke=new vl(this,null),this.radioValue=null}_initDefaultKeyStrokes(){this.keyStrokeContext.registerKeyStrokes([new vl(this,"ENTER"),new vl(this,"SPACE")])}_render(){this.addContainer(this.$parent,"radio-button",new Nc(this)),this.addFieldContainer(this.$parent.makeDiv()),this.$radioButton=this.$fieldContainer.appendDiv("radio-button-circle").data("radiobutton",this),this.addField(this.$radioButton),this.$buttonLabel=this.$fieldContainer.appendDiv("label"),Z.linkElementWithLabel(this.$radioButton,this.$buttonLabel),this.$fieldContainer.on("mousedown",this._onMouseDown.bind(this)),K.installForEllipsis(this.$buttonLabel,{parent:this}),this.addStatus(),this.session.keyStrokeManager.installKeyStrokeContext(this.formKeyStrokeContext)}_remove(){K.uninstall(this.$buttonLabel),this.session.keyStrokeManager.uninstallKeyStrokeContext(this.formKeyStrokeContext),super._remove()}_renderProperties(){super._renderProperties(),this._renderWrapText(),this._renderSelected()}setWrapText(e){this.setProperty("wrapText",e)}_renderWrapText(){this.$buttonLabel.toggleClass("white-space-nowrap",!this.wrapText),this.invalidateLayoutTree()}select(){this.setSelected(!0)}_renderSelected(){this.$fieldContainer.toggleClass("checked",this.selected),this.$field.toggleClass("checked",this.selected)}setTabbable(e){this.rendered&&this.$field.setTabbable(e&&!x.get().supportsOnlyTouch())}isTabbable(){return this.rendered&&this.$field.isTabbable()}_renderIconId(){super._renderIconId();let e=this.get$Icon();e.length>0&&e.insertAfter(this.$radioButton)}doAction(){return!this.enabledComputed||!this.visible?!1:(this.select(),!0)}_onMouseDown(e){if(!this.enabledComputed)return;let t=this.get$Icon().is(e.target),s=this.$radioButton.is(e.target),r=this.$buttonLabel.isOrHas(e.target);!s&&!r&&!t||(this.select(),this.focusWhenSelected&&(r||t)&&this.focusAndPreventDefault(e))}}function oD(i,e,t){return e=lD(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function lD(i){var e=aD(i,"string");return typeof e=="symbol"?e:String(e)}function aD(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Nc extends Za{constructor(e){super(e),oD(this,"radioButton",void 0),this.radioButton=e}layout(e){super.layout(e);let t=this.radioButton.get$Icon(),s=this.radioButton.$radioButton,r=this.radioButton.$buttonLabel,o=this.radioButton.$fieldContainer.width()-(s.outerWidth(!0)+(t.length?t.outerWidth(!0):0));r.css("max-width",o)}}class a_ extends Sc{}function Zt(i,e,t){return e=hD(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function hD(i){var e=dD(i,"string");return typeof e=="symbol"?e:String(e)}function dD(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class or extends me{constructor(){super(),Zt(this,"layoutConfig",void 0),Zt(this,"fields",void 0),Zt(this,"radioButtons",void 0),Zt(this,"gridColumnCount",void 0),Zt(this,"selectedButton",void 0),Zt(this,"lookupStatus",void 0),Zt(this,"lookupCall",void 0),Zt(this,"htmlBody",void 0),Zt(this,"$body",void 0),Zt(this,"_lookupExecuted",void 0),Zt(this,"_selectButtonLocked",void 0),Zt(this,"_lookupInProgress",void 0),Zt(this,"_currentLookupCall",void 0),Zt(this,"_buttonPropertyChangeHandler",void 0),this.logicalGrid=u.create(Gr),this.layoutConfig=null,this.fields=[],this.radioButtons=[],this.gridColumnCount=or.DEFAULT_GRID_COLUMN_COUNT,this.selectedButton=null,this.$body=null,this.lookupStatus=null,this.lookupCall=null,this._lookupExecuted=!1,this._selectButtonLocked=!1,this._lookupInProgress=!1,this._currentLookupCall=null,this._addWidgetProperties(["fields"]),this._addCloneProperties(["lookupCall","layoutConfig","gridColumnCount"]),this._buttonPropertyChangeHandler=this._onButtonPropertyChange.bind(this)}_init(e){super._init(e),this._setLayoutConfig(this.layoutConfig),this._setGridColumnCount(this.gridColumnCount)}_initValue(e){this.lookupCall&&this._setLookupCall(this.lookupCall),this._setFields(this.fields),super._initValue(e)}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.registerKeyStrokes([new zc(this),new Kc(this)])}_initButtons(){this.radioButtons=this.fields.filter(e=>e instanceof bl),this.radioButtons.forEach(this._initButton.bind(this))}_initButton(e){e.events.count("propertyChange",this._buttonPropertyChangeHandler)===0&&e.on("propertyChange",this._buttonPropertyChangeHandler),e.selected&&(this.setValue(e.radioValue),this.selectButton(e),e.focused&&this.setFocused(!0))}_render(){this.addContainer(this.$parent,"radiobutton-group"),this.addLabel(),this.addMandatoryIndicator(),this.$body=this.$container.appendDiv("radiobutton-group-body"),this.htmlBody=T.install(this.$body,this.session),this.htmlBody.setLayout(this._createBodyLayout()),this.addField(this.$body),this.addStatus()}_renderProperties(){super._renderProperties(),this._renderFields(),this._renderLayoutConfig()}_createBodyLayout(){return new Wc(this,this.layoutConfig)}_setLogicalGrid(e){super._setLogicalGrid(e),this.logicalGrid&&this.logicalGrid.setGridConfig(new Vc)}invalidateLogicalGrid(e){super.invalidateLogicalGrid(!1),u.nvl(e,!0)&&this.rendered&&this.htmlBody.invalidateLayoutTree()}setLayoutConfig(e){this.setProperty("layoutConfig",e)}_setLayoutConfig(e){e||(e=new si),this._setProperty("layoutConfig",si.ensure(e))}_renderLayoutConfig(){this.layoutConfig.applyToLayout(this.htmlBody.layout),this.rendered&&this.htmlBody.invalidateLayoutTree()}isClearable(){return!1}getFields(){return this.fields}visitFields(e){let t=super.visitFields(e);if(t===_e.TERMINATE)return _e.TERMINATE;if(t===_e.SKIP_SUBTREE)return;let s=this.getFields();for(let r=0;r<s.length;r++)if(t=s[r].visitFields(e),t===_e.TERMINATE)return _e.TERMINATE}getFocusableElement(){return this.session.focusManager.findFirstFocusableElement(this.$container)}setFields(e){this.setProperty("fields",e)}_setFields(e){this._setProperty("fields",e),this._initButtons()}_renderFields(){this._ensureLookupCallExecuted(),this.fields.forEach(function(e){e.render(this.$body),e.setLayoutData(new xs(e)),this._linkWithLabel(e.$field)},this),this._provideTabIndex(),this.invalidateLogicalGrid()}_renderEnabled(){super._renderEnabled(),this._provideTabIndex()}_provideTabIndex(){let e;this.radioButtons.forEach(function(t){t.enabledComputed&&this.enabledComputed&&!e?(t.setTabbable(!0),e=t):e&&this.enabledComputed&&t.enabledComputed&&t.selected?(e.setTabbable(!1),t.setTabbable(!0),e=t):t.setTabbable(!1)},this)}setGridColumnCount(e){this.setProperty("gridColumnCount",e)}_setGridColumnCount(e){return e<0&&(e=this._calcDefaultGridColumnCount()),e===this.gridColumnCount?!1:(this._setProperty("gridColumnCount",e),this.invalidateLogicalGrid(),!0)}_calcDefaultGridColumnCount(){let e=1,t=this.gridDataHints;return t&&t.h>1&&(e=t.h),Math.ceil(this.fields.length/e)}getButtonForRadioValue(e){return e===null?null:p.find(this.radioButtons,t=>b.equals(t.radioValue,e))}_validateValue(e){if(super._validateValue(e),!this.initialized&&this.lookupCall||this._ensureLookupCallExecuted())return e;if(!this.getButtonForRadioValue(e)&&e!==null&&e!==void 0&&!this._lookupInProgress)throw this.session.text("InvalidValueMessageX",e);return e}_valueChanged(){super._valueChanged(),(this.value!==null||this.initialized)&&this.selectButton(this.getButtonForRadioValue(this.value))}selectFirstButton(){this.selectButtonByIndex(0)}selectLastButton(){this.selectButtonByIndex(this.radioButtons.length-1)}selectButtonByIndex(e){this.radioButtons.length&&e>=0&&e<this.radioButtons.length&&this.selectButton(this.radioButtons[e])}selectButton(e){if(this.selectedButton!==e&&!this._selectButtonLocked){if(this._selectButtonLocked=!0,this.selectedButton&&this.selectedButton.setSelected(!1),e){let t=this.getTabbableButton(),s=!1;t&&(s=t.isFocused()),e.setSelected(!0),e.setTabbable(!0),s&&e.focus(),t&&t!==e&&t.setTabbable(!1)}this._selectButtonLocked=!1,this.setProperty("selectedButton",e)}}getTabbableButton(){return p.find(this.radioButtons,e=>e.visible&&e.isTabbable())}insertButton(e){let t=this.fields.slice();t.push(e),this.setFields(t)}_onButtonPropertyChange(e){e.propertyName==="selected"?e.newValue?(this.setValue(e.source.radioValue),this.selectButton(e.source)):e.source===this.selectedButton&&this.selectButton(null):e.propertyName==="focused"&&this.setFocused(e.newValue)}_setLookupCall(e){this._setProperty("lookupCall",Ut.ensure(e,this.session)),this._lookupExecuted=!1,this.rendered&&this._ensureLookupCallExecuted()}_ensureLookupCallExecuted(){return!this.lookupCall||this._lookupExecuted?!1:(this._lookupByAll(),!0)}_createLoadingSupport(){return new ss({widget:this,$container:function(){return this.$body}.bind(this)})}_lookupByAll(){if(!this.lookupCall)return;let e=a().Deferred(),t=function(s){this._lookupByAllDone(s),e.resolve(s)}.bind(this);return this._executeLookup(this.lookupCall.cloneForAll(),!0).done(t),e.promise()}_executeLookup(e,t){return t&&this._currentLookupCall&&this._currentLookupCall.abort(),this._lookupInProgress=!0,this.setLoading(!0),this._currentLookupCall=e,this.trigger("prepareLookupCall",{lookupCall:e}),e.execute().always(()=>{this._lookupInProgress=!1,this._lookupExecuted=!0,this._currentLookupCall=null,this.setLoading(!1),this._clearLookupStatus()})}_lookupByAllDone(e){try{if(e.exception){this.setErrorStatus(E.error({message:e.exception}));return}if(e.lookupRows.length===0){this.setLookupStatus(E.warning({message:this.session.text("SmartFieldNoDataFound"),code:or.ErrorCode.NO_DATA}));return}this._populateRadioButtonGroup(e)}finally{this.trigger("lookupCallDone",{result:e})}}_populateRadioButtonGroup(e){let t=e.lookupRows,s=this.fields.slice();t.forEach(r=>{s.push(this._createLookupRowRadioButton(r))}),this.setFields(s),this.setValue(this.value),this.selectButton(this.getButtonForRadioValue(this.value))}_clearLookupStatus(){this.setLookupStatus(null)}setLookupStatus(e){this.setProperty("lookupStatus",e),this.rendered&&this._renderErrorStatus()}_errorStatus(){return this.lookupStatus||this.errorStatus}_createLookupRowRadioButton(e){let t={parent:this,label:e.text,radioValue:e.key};e.iconId&&(t.iconId=e.iconId),e.tooltipText&&(t.tooltipText=e.tooltipText),e.backgroundColor&&(t.backgroundColor=e.backgroundColor),e.foregroundColor&&(t.foregroundColor=e.foregroundColor),e.font&&(t.font=e.font),e.enabled===!1&&(t.enabled=!1),e.active===!1&&(t.visible=!1),e.cssClass&&(t.cssClass=e.cssClass);let s=u.create(bl,t);return s.lookupRow=e,s}clone(e,t){let s=super.clone(e,t);return this._deepCloneProperties(s,"fields",t),s._initButtons(),s}}Zt(or,"DEFAULT_GRID_COLUMN_COUNT",-1),Zt(or,"ErrorCode",{NO_DATA:1});class h_ extends Ot{_initModel(e,t){let s=super._initModel(e,t);return s.logicalGrid=null,s}}class Vc extends gr{getGridWidgets(){return this.widget.fields}}class Wc extends Gn{constructor(e,t){super(e,t)}_initDefaults(){super._initDefaults(),this.hgap=de.get().smallColumnGap}}class zc extends O{constructor(e){super(),this.field=e,this.which=[g.LEFT,g.UP],this.renderingHints.render=!1}handle(e){let t,s=a()(e.target).data("radiobutton");this.field.radioButtons.some(r=>t&&r===s?(t.select(),t.focus(),!0):(r.enabledComputed&&r.visible&&(t=r),!1),this)}}class Kc extends O{constructor(e){super(),this.field=e,this.which=[g.RIGHT,g.DOWN],this.renderingHints.render=!1}handle(e){let t,s=a()(e.target).data("radiobutton");this.field.radioButtons.some(r=>t&&r.enabledComputed&&r.visible?(r.select(),r.focus(),!0):(r===s&&r.enabledComputed&&r.visible&&(t=r),!1),this)}}class vl extends mo{constructor(e,t){super(e,t),this.renderingHints.hAlign=ht.LEFT}_accept(e){return super._accept(e)&&!this.field.selected}}function wi(i,e,t){return e=uD(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function uD(i){var e=cD(i,"string");return typeof e=="symbol"?e:String(e)}function cD(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class wl extends Fr{constructor(){super(),wi(this,"layoutConfig",void 0),wi(this,"fields",void 0),wi(this,"htmlBody",void 0),wi(this,"boxErrorStatus",void 0),wi(this,"boxTooltipText",void 0),wi(this,"boxMenus",void 0),wi(this,"boxMenusVisible",void 0),wi(this,"_lastVisibleField",void 0),wi(this,"_isOverwritingStatusFromField",void 0),wi(this,"_isErrorStatusOverwritten",void 0),wi(this,"_isTooltipTextOverwritten",void 0),wi(this,"_isMenusOverwritten",void 0),wi(this,"_fieldPropertyChangeHandler",void 0),wi(this,"_lastVisibleFieldSuppressStatusHandler",void 0),this._addWidgetProperties("fields"),this._addCloneProperties(["layoutConfig"]),this.logicalGrid=u.create(Gr),this.layoutConfig=null,this.fields=[],this._fieldPropertyChangeHandler=this._onFieldPropertyChange.bind(this),this._lastVisibleFieldSuppressStatusHandler=this._onLastVisibleFieldSuppressStatusChange.bind(this)}_init(e){super._init(e),this._setLayoutConfig(this.layoutConfig),this._initDateFields(),this.setErrorStatus(this.errorStatus),this.setTooltipText(this.tooltipText),this.setMenus(this.menus),this.setMenusVisible(this.menusVisible)}_initDateFields(){let e=this._getDateFields(),t=null;for(let s=0;s<e.length;s++){let r=e[s];r.autoDate&&(r.hasModelAutoDateSet=!0),r.hasModelAutoDateSet||r.setAutoDate(t),t=this._getAutoDateProposal(r)}}_render(){this.addContainer(this.$parent,"sequence-box"),this.addLabel(),this.addField(this.$parent.makeDiv()),this.addStatus(),this._handleStatus(),this.htmlBody=T.install(this.$field,this.session),this.htmlBody.setLayout(this._createBodyLayout());for(let e=0;e<this.fields.length;e++){let t=this.fields[e];t.labelUseUiWidth=!0,t.on("propertyChange",this._fieldPropertyChangeHandler),t.render(this.$field),this._modifyLabel(t),t.setLayoutData(new xs(t))}}_renderProperties(){super._renderProperties(),this._renderLayoutConfig()}_createBodyLayout(){return new Uc(this,this.layoutConfig)}_remove(){this.fields.forEach(e=>e.off("propertyChange",this._fieldPropertyChangeHandler)),this._lastVisibleField&&this._lastVisibleField.off("propertyChange:suppressStatus",this._lastVisibleFieldSuppressStatusHandler),super._remove()}invalidateLogicalGrid(e){super.invalidateLogicalGrid(!1),u.nvl(e,!0)&&this.rendered&&this.htmlBody.invalidateLayoutTree()}_setLogicalGrid(e){super._setLogicalGrid(e),this.logicalGrid&&this.logicalGrid.setGridConfig(new Gc)}setLayoutConfig(e){this.setProperty("layoutConfig",e)}_setLayoutConfig(e){e||(e=new si),this._setProperty("layoutConfig",si.ensure(e))}_renderLayoutConfig(){let e=this.htmlBody.layout;this.layoutConfig.applyToLayout(e),this.rendered&&this.htmlBody.invalidateLayoutTree()}_onFieldPropertyChange(e){let t=e.propertyName==="visible";u.isOneOf(e.propertyName,["errorStatus","tooltipText","visible","menus","menusVisible"])&&this._handleStatus(t),e.propertyName==="value"&&this._onFieldValueChange(e)}_handleStatus(e){if(e&&this._lastVisibleField&&(this._lastVisibleField.off("propertyChange:suppressStatus",this._lastVisibleFieldSuppressStatusHandler),this._lastVisibleField.setSuppressStatus(null),this._lastVisibleField.rendered&&(this._lastVisibleField._renderErrorStatus(),this._lastVisibleField._renderTooltipText(),this._lastVisibleField._renderMenus())),this._lastVisibleField=this._getLastVisibleField(),!this._lastVisibleField)return;this._isOverwritingStatusFromField=!0,this._lastVisibleField.errorStatus?(this.setErrorStatus(this._lastVisibleField.errorStatus),this._isErrorStatusOverwritten=!0):(this.setErrorStatus(this.boxErrorStatus),this._isErrorStatusOverwritten=!1),this._lastVisibleField.hasStatusTooltip()?(this.setTooltipText(this._lastVisibleField.tooltipText),this._isTooltipTextOverwritten=!0):(this.setTooltipText(this.boxTooltipText),this._isTooltipTextOverwritten=!1);let t=this._lastVisibleField.getContextMenuItems(!1);t&&t.length>0?(this._updateBoxMenuOwner(this.fieldStatus),this.setMenus(t),this.setMenusVisible(this._lastVisibleField.menusVisible),this._isMenusOverwritten=!0):(this._updateBoxMenuOwner(this),this.setMenus(this.boxMenus),this.setMenusVisible(this.boxMenusVisible),this._isMenusOverwritten=!1),this._isOverwritingStatusFromField=!1,this._lastVisibleField.setSuppressStatus(A.SuppressStatus.ICON),this._lastVisibleField.on("propertyChange:suppressStatus",this._lastVisibleFieldSuppressStatusHandler),e&&this._lastVisibleField.rendered&&(this._lastVisibleField._renderErrorStatus(),this._lastVisibleField._renderTooltipText(),this._lastVisibleField._renderMenus())}_onLastVisibleFieldSuppressStatusChange(e){e.preventDefault()}setErrorStatus(e){this._isOverwritingStatusFromField&&!this._isErrorStatusOverwritten?this.boxErrorStatus=this.errorStatus:this._isOverwritingStatusFromField||(this.boxErrorStatus=e),(this._isOverwritingStatusFromField||!this._isErrorStatusOverwritten)&&super.setErrorStatus(e)}setTooltipText(e){this._isOverwritingStatusFromField&&!this._isTooltipTextOverwritten?this.boxTooltipText=this.tooltipText:this._isOverwritingStatusFromField||(this.boxTooltipText=e),(this._isOverwritingStatusFromField||!this._isTooltipTextOverwritten)&&super.setTooltipText(e)}setMenus(e){let t=this._createChildren(e);this._isOverwritingStatusFromField&&!this._isMenusOverwritten?this.boxMenus=this.menus:this._isOverwritingStatusFromField||(this.boxMenus=t),(this._isOverwritingStatusFromField||!this._isMenusOverwritten)&&super.setMenus(t)}_updateBoxMenuOwner(e){this.boxMenus.forEach(t=>t.setOwner(e))}setMenusVisible(e){this._isOverwritingStatusFromField&&!this._isMenusOverwritten?this.boxMenusVisible=this.menusVisible:this._isOverwritingStatusFromField||(this.boxMenusVisible=e),(this._isOverwritingStatusFromField||!this._isMenusOverwritten)&&super.setMenusVisible(e)}_getLastVisibleField(){let e=this.fields.filter(t=>t.visible);if(e.length!==0)return e[e.length-1]}_onFieldValueChange(e){e.source instanceof kt&&this._onDateFieldValueChange(e)}_onDateFieldValueChange(e){let t=e.source,s=this._getDateFields(),r=this._getAutoDateProposal(t);for(let n=s.indexOf(t)+1;n<s.length;n++){let o=s[n];if(o.hasModelAutoDateSet||o.setAutoDate(r),o.value)break}}_getDateFields(){return this.fields.filter(e=>e instanceof kt)}_getAutoDateProposal(e){let t=null;return e&&e.value&&(!e.hasDate&&e.hasTime?t=w.shiftTime(e.value,1,0,0):t=w.shift(e.value,0,0,1)),t}_modifyLabel(e){e instanceof Dr&&(e.labelVisible=!1),e instanceof kt?(e.$dateField&&this._linkWithLabel(e.$dateField),e.$timeField&&this._linkWithLabel(e.$timeField)):e.$field&&this._linkWithLabel(e.$field)}setFields(e){if(this.rendered)throw new Error("Setting fields is not supported if sequence box is already rendered.");this.setProperty("fields",e)}getFields(){return this.fields}clone(e,t){let s=super.clone(e,t);return this._deepCloneProperties(s,"fields",t),s}}class Gc extends gr{getGridColumnCount(){return this.widget.fields.length}getGridWidgets(){return this.widget.fields}}class Uc extends Gn{constructor(e,t){super(e,t)}_initDefaults(){super._initDefaults(),this.hgap=de.get().smallColumnGap}}class d_ extends fo{_initModel(e,t){let s=super._initModel(e,t);return s.logicalGrid=null,s}}function pD(i,e,t){return e=fD(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function fD(i){var e=mD(i,"string");return typeof e=="symbol"?e:String(e)}function mD(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class u_ extends me{constructor(){super(...arguments),pD(this,"slider",void 0)}_init(e){super._init(e);let t=a().extend({parent:this},e);this.slider=u.create(au,t)}_render(){this.addContainer(this.$parent,"slider-field"),this.addLabel(),this.addMandatoryIndicator(),this._renderSlider()}_renderSlider(){this.slider.render(),this.addField(this.slider.$container)}_readDisplayText(){return String(this.slider.value)}_parseValue(e){return Number(e)}setValue(e){this.slider.setValue(e)}getValue(){return this.slider.value}}function ve(i,e,t){return e=gD(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function gD(i){var e=_D(i,"string");return typeof e=="symbol"?e:String(e)}function _D(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class le extends me{constructor(){super(),ve(this,"popup",void 0),ve(this,"lookupCall",void 0),ve(this,"codeType",void 0),ve(this,"lookupRow",void 0),ve(this,"browseHierarchy",void 0),ve(this,"browseMaxRowCount",void 0),ve(this,"browseAutoExpandAll",void 0),ve(this,"browseLoadIncremental",void 0),ve(this,"searchRequired",void 0),ve(this,"activeFilterEnabled",void 0),ve(this,"activeFilter",void 0),ve(this,"activeFilterLabels",void 0),ve(this,"columnDescriptors",void 0),ve(this,"displayStyle",void 0),ve(this,"touchMode",void 0),ve(this,"embedded",void 0),ve(this,"lookupStatus",void 0),ve(this,"lookupSeqNo",void 0),ve(this,"initActiveFilter",void 0),ve(this,"maxLength",void 0),ve(this,"maxLengthHandler",void 0),ve(this,"_currentLookupCall",void 0),ve(this,"_pendingLookup",void 0),ve(this,"_pendingOpenPopup",void 0),ve(this,"_tabPrevented",void 0),ve(this,"_userWasTyping",void 0),ve(this,"_acceptInputEnabled",void 0),ve(this,"_acceptInputDeferred",void 0),ve(this,"_notUnique",void 0),ve(this,"_lastSearchText",void 0),ve(this,"_cellEditorPopup",void 0),ve(this,"_lockLookupRow",void 0),this.popup=null,this.lookupCall=null,this.codeType=null,this._pendingLookup=null,this._pendingOpenPopup=!1,this._tabPrevented=null,this.lookupRow=null,this.browseHierarchy=!1,this.browseMaxRowCount=le.DEFAULT_BROWSE_MAX_COUNT,this.browseAutoExpandAll=!0,this.browseLoadIncremental=!1,this.searchRequired=!1,this.activeFilterEnabled=!1,this.activeFilter=null,this.activeFilterLabels=[],this.columnDescriptors=null,this.displayStyle=le.DisplayStyle.DEFAULT,this.touchMode=!1,this.embedded=!1,this._userWasTyping=!1,this._acceptInputEnabled=!0,this._acceptInputDeferred=a().Deferred(),this._notUnique=!1,this._lastSearchText=null,this.lookupStatus=null,this._currentLookupCall=null,this.lookupSeqNo=0,this.initActiveFilter=null,this.disabledCopyOverlay=!0,this.maxLength=500,this.maxLengthHandler=u.create(Ho,{target:this}),this._addCloneProperties(["lookupRow","codeType","lookupCall","activeFilter","activeFilterEnabled","activeFilterLabels","browseHierarchy","browseMaxRowCount","browseAutoExpandAll","browseLoadIncremental","searchRequired","columnDescriptors","displayStyle"])}_init(e){super._init(e),this.activeFilterLabels.length===0&&(this.activeFilterLabels=[this.session.text("ui.All"),this.session.text("ui.Inactive"),this.session.text("ui.Active")]),Z.initTouch(this,e)}_initValue(e){this._setLookupCall(this.lookupCall),this._setCodeType(this.codeType),this._setLookupRow(this.lookupRow),super._initValue(e)}markAsSaved(){super.markAsSaved(),this.setInitActiveFilter(this.activeFilter)}resetValue(){super.resetValue(),this.setActiveFilter(this.initActiveFilter)}_createKeyStrokeContext(){return new As}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.registerKeyStroke(new qc(this))}_render(){this.addContainer(this.$parent,"has-icon "+this.cssClassName(),new ah(this)),this.addLabel();let t=(this.isDropdown()?Z.makeInputDiv:Z.makeInputOrDiv).call(Z,this).on("mousedown",this._onFieldMouseDown.bind(this));this.touchMode||t.keyup(this._onFieldKeyUp.bind(this)).keydown(this._onFieldKeyDown.bind(this)).on("input",this._onFieldInput.bind(this)),this.addField(t),this.maxLengthHandler.install(t),this.embedded||this.addMandatoryIndicator(),this.addIcon(),this.addStatus()}_renderProperties(){super._renderProperties(),this._renderMaxLength()}_renderGridData(){super._renderGridData(),this.updateInnerAlignment({useHorizontalAlignment:!this.browseHierarchy})}_renderGridDataHints(){super._renderGridDataHints(),this.updateInnerAlignment({useHorizontalAlignment:!this.browseHierarchy})}cssClassName(){let e=this.displayStyle;return this.displayStyle===le.DisplayStyle.DEFAULT&&(e="smart"),e+"-field"}_readSearchText(){let e=this._readDisplayText(),t=u.nvl(this.displayText,""),s=t.split(`
`);return s.length===1||y.empty(e)?e:(s.shift(),p.insert(s,e,0),y.join(`
`,s))}_readDisplayText(){return Z.valOrText(this.$field)}_renderDisplayText(){let e=this._prepareDisplayText();Z.valOrText(this.$field,e),super._renderDisplayText()}_prepareDisplayText(){let e=u.nvl(this.displayText,""),t=e.split(`
`);return t.length&&(e=t[0]),e}acceptInput(e){if(!this._acceptInputEnabled)return a().log.isTraceEnabled()&&a().log.trace("(SmartField#acceptInput) Skipped acceptInput because _acceptInputEnabled=false"),this._acceptInputDeferred.promise();this._acceptInputEnabled=!1,setTimeout(()=>{this._acceptInputEnabled=!0});let t=this._readSearchText(),s=y.empty(t),r=this._checkSearchTextChanged(t),n=this._getSelectedLookupRow(r);if(this._setProperty("displayText",t),this._acceptInputDeferred=a().Deferred(),this._flushLookupStatus(),this._clearPendingLookup(),this.touchMode){a().log.isDebugEnabled()&&a().log.debug("(SmartField#acceptInput) Always send acceptInput for touch field"),this._inputAccepted();return}return this._acceptInput(e,t,s,r,n)}_getSelectedLookupRow(e){return!this.isPopupOpen()||e&&this._userWasTyping?null:this.lookupSeqNo===this.popup.lookupResult.seqNo?this.popup.getSelectedLookupRow():null}_checkSearchTextChanged(e){return this.isDropdown()||!this._userWasTyping?!1:!this._searchTextEquals(e,this._lastSearchText)}_searchTextEquals(e,t){let s=y.nullIfEmpty(this._firstTextLine(e)),r=y.nullIfEmpty(t);return y.equalsIgnoreCase(s,r)}_clearPendingLookup(){this._pendingLookup&&(clearTimeout(this._pendingLookup),this._pendingLookup=null)}_acceptInput(e,t,s,r,n){let o=!1;if(this.removing?o=!0:!n&&this.lookupRow&&(o=y.nvl(this.lookupRow.text)===t),o){a().log.isDebugEnabled()&&a().log.debug("(SmartField#_acceptInput) unchanged: widget is removing or searchText is equals. Close popup"),this._clearLookupStatus(),this._inputAccepted(!1);return}if(this._notUnique&&!s&&this._setNotUniqueError(t),!n&&!this.lookupRow&&s){a().log.isDebugEnabled()&&a().log.debug("(SmartField#_acceptInput) unchanged: text is empty. Close popup"),this._clearLookupStatus(),this.errorStatus&&this.errorStatus.code===le.ErrorCode.NO_RESULTS&&this.clearErrorStatus(),this._inputAccepted(r||this._userWasTyping);return}if(!n&&s){a().log.isDebugEnabled()&&a().log.debug("(SmartField#_acceptInput) empty. Set lookup-row to null, close popup"),this._clearLookupStatus(),this.setLookupRow(null),this._inputAccepted();return}if(n){a().log.isDebugEnabled()&&a().log.debug("(SmartField#_acceptInput) lookup-row selected. Set lookup-row, close popup lookupRow=",n.toString()),this._clearLookupStatus(),this.setLookupRow(n),this._inputAccepted();return}return r||this._userWasTyping?this._acceptByText(e,this._firstTextLine(t)):this._hasUiError()?this._hasNotUniqueError()&&this.popup?this.popup.selectFirstLookupRow():this._acceptInputDeferred.resolve():this._inputAccepted(!1),this._acceptInputDeferred.promise()}_firstTextLine(e){return y.empty(e)?e:e.split(`
`)[0]}_acceptByText(e,t){e=u.nvl(e,!1),a().log.isDebugEnabled()&&a().log.debug("(SmartField#_acceptByText) sync="+e+" searchText=",t),e?this._acceptByTextSync(t):this._acceptByTextAsync(t)}_acceptByTextSync(e){this._lastSearchText=null,this._inputAccepted(),this._hasUiError()||this.resetDisplayText()}_acceptByTextAsync(e){this._lastSearchText=e,this._executeLookup(this.lookupCall.cloneForText(e),!0).done(this._acceptByTextDone.bind(this)).done(this._triggerLookupCallDone.bind(this)),this._triggerAcceptByText(e)}_inputAccepted(e,t){e=u.nvl(e,!0),t=u.nvl(t,!0),this.embedded||this.closePopup(),this._userWasTyping=!1,e&&this._triggerAcceptInput(t),this._focusNextTabbable(),this._acceptInputDeferred.resolve()}_focusNextTabbable(){if(this._tabPrevented){let e=this.entryPoint().find(":tabbable"),t=this._tabPrevented.shiftKey?-1:1,s=e.index(this.$field),r=s+t;r<0?r=e.length-1:r>=e.length&&(r=0),a().log.isDebugEnabled()&&a().log.debug("(SmartField#_inputAccepted) tab-index="+s+" next tab-index="+r);let n=e.eq(r).focus();b.isFunction(n[0].select)&&n[0].select(),n.addClass("keyboard-navigation"),this._tabPrevented=null}}_acceptByTextDone(e){if(this._userWasTyping=!1,this._extendResult(e),this._notUnique=e.numLookupRows>1,e.uniqueMatch){let t=e.uniqueMatch;this._isLookupRowActive(t)?(this.setLookupRow(t),this._inputAccepted()):this.setErrorStatus(E.error({message:this.session.text("SmartFieldInactiveRow",e.text)}));return}this._acceptInputFail(e)}_extendResult(e){e.seqNo=this.lookupSeqNo,e.uniqueMatch=null;let t="by"+y.toUpperCaseFirstLetter(e.queryBy.toLowerCase());if(e[t]=!0,this.browseHierarchy){let s=u.create(sp,{parent:this,smartField:this});s.setLookupResult(e);let r=s.findLeafs();e.numLookupRows=r.length,e.numLookupRows===1&&(e.uniqueMatch=r[0].lookupRow)}else e.numLookupRows=e.lookupRows.length,e.numLookupRows===1&&(e.uniqueMatch=e.lookupRows[0])}_acceptInputFail(e){let t=e.text;e.numLookupRows||(this.embedded||this.closePopup(),this.setValue(null),this.setDisplayText(t),this.setErrorStatus(E.error({message:this.session.text("SmartFieldCannotComplete",t),code:le.ErrorCode.NO_RESULTS}))),e.numLookupRows>1&&(this.setValue(null),this.setDisplayText(t),this._setNotUniqueError(t),this.isPopupOpen()?this.popup.setLookupResult(e):this._lookupByTextOrAllDone(e),this.isPopupOpen()&&this.popup.selectFirstLookupRow()),this._acceptInputDeferred.resolve(),this._triggerAcceptInputFail()}lookupByRec(e){return a().log.isDebugEnabled()&&a().log.debug("(SmartField#lookupByRec) rec=",e),this._lastSearchText=null,this._executeLookup(this.lookupCall.cloneForRec(e)).then(t=>(t.appendResult=!0,t.rec=e,this.isPopupOpen()&&this.popup.setLookupResult(t),t)).then(this._triggerLookupCallDone.bind(this))}_isLookupRowActive(e){return e.enabled?this.activeFilterEnabled?this.activeFilter==="TRUE"?e.active:this.activeFilter==="FALSE"?!e.active:!0:!0:!1}_renderEnabled(){super._renderEnabled(),this.$field.setTabbable(this.enabledComputed)}setMaxLength(e){this.setProperty("maxLength",e)}_renderMaxLength(){this.maxLengthHandler.render()}setLookupCall(e){this.setProperty("lookupCall",e)}_setLookupCall(e){this._setProperty("lookupCall",Ut.ensure(e,this.session)),this._syncBrowseMaxRowCountWithLookupCall()}_setCodeType(e){if(this._setProperty("codeType",e),!e)return;let t=u.create(Ul,{session:this.session,codeType:e});this.setProperty("lookupCall",t)}_formatValue(e){return b.isNullOrUndefined(e)?"":this.lookupRow?this._formatLookupRow(this.lookupRow):(this._lastSearchText=null,this._executeLookup(this.lookupCall.cloneForKey(e),!0).then(t=>({formattedValue:this._lookupByKeyDone(t),result:t})).then(t=>{let{formattedValue:s,result:r}=t;return this._triggerLookupCallDone(r),s}))}_lookupByKeyDone(e){this._notUnique=!1;let t=Ut.firstLookupRow(e);return this.setLookupRow(t),this._formatLookupRow(t)}_formatLookupRow(e){return e?e.text:""}openPopup(e){let t=this._readDisplayText(),s=this.searchRequired?!0:null;return a().log.isInfoEnabled()&&a().log.info("SmartField#openPopup browse="+e+" searchText="+t+" popup="+this.popup+" pendingOpenPopup="+this._pendingOpenPopup),this._tabPrevented=null,this._pendingOpenPopup=!0,y.empty(t)?e=!0:this.errorStatus&&(this._hasNotUniqueError()?(s=!0,e=!1):this.searchRequired||(e=!0)),this._lookupByTextOrAll(e,t,s)}_hasUiError(e){let t=this._errorStatus();if(!t)return!1;e?e=p.ensure(e):e=[le.ErrorCode.NO_RESULTS,le.ErrorCode.NOT_UNIQUE];let r=E.asFlatList(t).reduce((n,o)=>(o.code&&n.indexOf(o.code)===-1&&n.push(o.code),n),[]);return e.some(n=>r.indexOf(n)>-1)}_lookupByTextOrAll(e,t,s){if(t=u.nvl(t,this._readDisplayText()),e=u.nvl(e,y.empty(t)),s=u.nvl(s,!1),this.isDropdown()&&(e=!0),!e&&!s){let o=null;if(this._lastSearchText?o=this._lastSearchText:o=this._getLastSearchText(),this._searchTextEquals(t,o)){this._pendingOpenPopup=!1,a().log.debug("(SmartField#_lookupByTextOrAll) searchText is equals -> skip lookup");return}}this._clearPendingLookup();let r=a().Deferred(),n=function(o){this._lookupByTextOrAllDone(o),r.resolve(o)}.bind(this);return e?(a().log.isDebugEnabled()&&a().log.debug("(SmartField#_lookupByTextOrAll) lookup byAll (searchText empty)"),this._lastSearchText=null,this.searchRequired?(n({queryBy:fe.TEXT,lookupRows:[]}),this.setLookupStatus(E.warning({message:this.session.text("TooManyRows"),code:le.ErrorCode.SEARCH_REQUIRED}))):this._executeLookup(this.lookupCall.cloneForAll(),!0).done(n).done(this._triggerLookupCallDone.bind(this))):this._pendingLookup=setTimeout(()=>{a().log.isDebugEnabled()&&a().log.debug("(SmartField#_lookupByTextOrAll) lookup byText searchText="+t),this._lastSearchText=t,this._executeLookup(this.lookupCall.cloneForText(t),!0).done(n).done(this._triggerLookupCallDone.bind(this))},le.DEBOUNCE_DELAY),r.promise()}_getLastSearchText(){return b.optProperty(this.lookupRow,"text")}_lookupByTextOrAllDone(e){if(this._extendResult(e),this._notUnique=!e.byAll&&e.numLookupRows>1,this._handleException(e))return;if(!this.rendered||!this.isFocused()&&!this.isTouchable()){this.closePopup();return}let t=!e.numLookupRows;if(t&&e.byAll){this.activeFilterEnabled?this._ensurePopup(e):this.closePopup(),this.setLookupStatus(E.warning({message:this.session.text("SmartFieldNoDataFound"),code:le.ErrorCode.NO_DATA}));return}if(t){this._handleEmptyResult(),this.setLookupStatus(E.warning({message:this.session.text("SmartFieldCannotComplete",e.text),code:le.ErrorCode.NO_RESULTS}));return}let s=null;e.numLookupRows>this.browseMaxRowCount&&(e.lookupRows=e.lookupRows.slice(0,this.browseMaxRowCount),s=E.info({message:this.session.text("SmartFieldMoreThanXRows",this.browseMaxRowCount)})),this._ensurePopup(e,s)}_ensurePopup(e,t){this.popup?(this.popup.setLookupResult(e),this.popup.setStatus(t)):this._renderPopup(e,t)}_handleException(e){return e.exception?(this.setErrorStatus(E.error({message:e.exception})),this.closePopup(),!0):!1}_handleEmptyResult(){if(this.touchMode||this.activeFilterEnabled){let e={lookupRows:[]};this._ensurePopup(e)}else this.embedded?this.popup.clearLookupRows():this.closePopup()}_renderPopup(e,t){this.$field.addClass("focused"),this.$container.addClass("popup-open");let s=this.touchMode&&!this.isDropdown(),r=s?"SmartFieldTouchPopup":"SmartFieldPopup";this._pendingOpenPopup=!1,this.popup=u.create(r,{parent:this,$anchor:this.$field,boundToAnchor:!s,closeOnAnchorMouseDown:!1,field:this,lookupResult:e,status:t}),this.popup.open(),this.popup.$container.css("--inactive-lookup-row-suffix-text","'".concat(this.session.text("InactiveState"),"'"));let n=s?this.popup._field:this;this.popup.on("lookupRowSelected",n._onLookupRowSelected.bind(n)),this.popup.on("activeFilterSelected",this._onActiveFilterSelected.bind(this)),this.popup.one("remove",()=>{this.popup=null,this.rendered&&(this.$container.removeClass("popup-open"),this.$field.removeClass("focused"),this._renderErrorStatus())})}closePopup(){this._pendingOpenPopup=!1,this.popup&&this.popup.close()}aboutToBlurByMouseDown(e){this.touchMode||Z.eventOutsideProposalField(this,e)&&this.acceptInput(!0)}_onFieldMouseDown(e){a().log.isDebugEnabled()&&a().log.debug("(SmartField#_onFieldMouseDown)"),this.activate(!0)}activate(e){if(!(!this.enabledComputed||!this.rendered)){if(!this.isDropdown()&&!Z.handleOnClick(this)){this.popup&&this.popup.removalPending&&this.popup.one("remove",()=>{this.rendered&&this.activate(e)});return}(!e||x.get().supportsOnlyTouch())&&this.$field.focus(),this.togglePopup()}}_onIconMouseDown(e){a().log.isDebugEnabled()&&a().log.debug("(SmartField#_onIconMouseDown)"),this.enabledComputed&&(e.preventDefault(),this.$field.focus(),this.embedded||(this.isDropdown()?this.togglePopup():this.popup||this.openPopup(!this.searchRequired)))}_onClearIconMouseDown(e){a().log.isDebugEnabled()&&a().log.debug("(SmartField#_onClearIconMouseDown)"),this.enabledComputed&&(e.preventDefault(),this.$field.focus(),this.clear())}_clear(){this._tabPrevented=null,this._lastSearchText=this._readDisplayText(),this._userWasTyping=!0,Z.valOrText(this.$field,""),this.touchMode&&this.setValue(null),this.isPopupOpen()&&setTimeout(this._lookupByTextOrAll.bind(this,!0)),this._updateHasText()}togglePopup(){a().log.isInfoEnabled()&&a().log.info("(SmartField#togglePopup) popupOpen=",this.isPopupOpen()),this.isPopupOpen()?this.closePopup():this.openPopup(!this.searchRequired)}_onFieldBlur(e){this.setFocused(!1),this.setLoading(!1),!this.isTouchable()&&(this.acceptInput(!1),this.closePopup())}isTouchable(){return this.embedded||this.touchMode}_onFieldKeyUp(e){if(e.which===g.ESC)return;let t=e.which,s=(e.ctrlKey||e.metaKey)&&t===g.V||e.shiftKey&&t===g.INSERT,r=(e.ctrlKey||e.metaKey)&&t===g.X||e.shiftKey&&t===g.DELETE;!((s||r)&&!this.isDropdown())&&(e.ctrlKey||e.altKey||e.metaKey||t===g.ENTER||t===g.TAB||t===g.SHIFT||t===g.CTRL||t===g.ALT||t===g.HOME||t===g.END||t===g.LEFT||t===g.RIGHT||t===g.WIN_LEFT||t===g.WIN_RIGHT||t===g.SELECT||t===g.NUM_LOCK||t===g.CAPS_LOCK||t===g.SCROLL_LOCK||t===g.PAUSE||t===g.PRINT_SCREEN||this._isNavigationKey(e)||this._isFunctionKey(e))||this._handleInput()}_handleInput(){this._pendingOpenPopup||this.isPopupOpen()?this.isDropdown()||this._lookupByTextOrAll():this._pendingOpenPopup||this.openPopup()}isPopupOpen(){return!!(this.popup&&!this.popup.removalPending)}_onFieldKeyDown(e){if(this._updateUserWasTyping(e),e.which===g.TAB){this.mode===A.Mode.DEFAULT&&(e.preventDefault(),e.stopPropagation(),a().log.isDebugEnabled()&&a().log.debug("(SmartField#_onFieldKeyDown) set _tabPrevented"),this._tabPrevented={shiftKey:e.shiftKey}),this.acceptInput();return}if(e.which===g.ENTER){this._handleEnterKey(e);return}let t=e.which;this.isDropdown()&&(e.ctrlKey||e.altKey||e.metaKey||t===g.ESC||t===g.SHIFT||t===g.CTRL||t===g.ALT||t===g.WIN_LEFT||t===g.WIN_RIGHT||t===g.SELECT||t===g.NUM_LOCK||t===g.CAPS_LOCK||t===g.SCROLL_LOCK||t===g.PAUSE||t===g.PRINT_SCREEN||this._isFunctionKey(e))||(this._isNavigationKey(e)||this.isDropdown())&&(this.isPopupOpen()?this.popup.delegateKeyEvent(e):this._pendingOpenPopup||this.openPopup(!this.searchRequired),e.stopPropagation(),e.preventDefault())}_onFieldInput(){this._updateHasText(),this._userWasTyping||(this.isFocused()||this.focus(),this._handleInput())}_updateUserWasTyping(e){let t=e.which,s=(e.ctrlKey||e.metaKey)&&t===g.V||e.shiftKey&&t===g.INSERT,r=(e.ctrlKey||e.metaKey)&&t===g.X||e.shiftKey&&t===g.DELETE;!((s||r)&&!this.isDropdown())&&(e.ctrlKey||e.altKey||e.metaKey||t===g.ESC||t===g.TAB||t===g.SHIFT||t===g.CTRL||t===g.ALT||t===g.HOME||t===g.END||t===g.LEFT||t===g.RIGHT||t===g.WIN_LEFT||t===g.WIN_RIGHT||t===g.SELECT||t===g.NUM_LOCK||t===g.CAPS_LOCK||t===g.SCROLL_LOCK||t===g.PAUSE||t===g.PRINT_SCREEN||this._isFunctionKey(e))||(this._userWasTyping=!(this._isNavigationKey(e)||t===g.ENTER))}_isNavigationKey(e){let t=[g.PAGE_UP,g.PAGE_DOWN,g.UP,g.DOWN];return this.isDropdown()&&(t.push(g.HOME),t.push(g.END)),u.isOneOf(e.which,t)}_handleEnterKey(e){this.isPopupOpen()&&(this.popup.selectLookupRow(),e.stopPropagation())}_isFunctionKey(e){return e.which>=g.F1&&e.which<=g.F12}_onLookupRowSelected(e){this._clearPendingLookup();let t=this.original()._currentLookupCall;t&&(t.abort(),this.original()._currentLookupCall=null,this.setLoading(!1)),this.setLookupRow(e.lookupRow),this._inputAccepted(),this.closePopup()}_onActiveFilterSelected(e){this.setActiveFilter(e.activeFilter);let t=!this.searchRequired,s=this._readSearchText();this.lookupRow?this.lookupRow.text!==s&&(t=!1):y.hasText(s)&&(t=!1),this._lookupByTextOrAll(t,s,!0)}setBrowseMaxRowCount(e){this.setProperty("browseMaxRowCount",e),this._syncBrowseMaxRowCountWithLookupCall()}_syncBrowseMaxRowCountWithLookupCall(){this.lookupCall&&this.lookupCall.setMaxRowCount(this.browseMaxRowCount+1)}setBrowseAutoExpandAll(e){this.setProperty("browseAutoExpandAll",e)}setBrowseLoadIncremental(e){this.setProperty("browseLoadIncremental",e),this.lookupCall&&this.lookupCall.setLoadIncremental(e)}setActiveFilter(e){this.setProperty("activeFilter",this.activeFilterEnabled?e:null)}setActiveFilterEnabled(e){this.setProperty("activeFilterEnabled",e)}setInitActiveFilter(e){this.setProperty("initActiveFilter",e)}setSearchRequired(e){this.setProperty("searchRequired",e)}_executeLookup(e,t){this.lookupSeqNo++,this.setLoading(!0);let s=this.original()._currentLookupCall;return t&&s&&s.abort(),this.original()._currentLookupCall=e,this.trigger("prepareLookupCall",{lookupCall:e}),e.execute().always(()=>{this.original()._currentLookupCall=null,this.setLoading(!1),this._clearLookupStatus(),this._clearNoResultsErrorStatus()})}_clearNoResultsErrorStatus(){this.isTouchable()||this._userWasTyping&&this.errorStatus&&this.errorStatus.code===le.ErrorCode.NO_RESULTS&&this.setErrorStatus(null)}virtual(){return this.browseMaxRowCount>le.DEFAULT_BROWSE_MAX_COUNT}isDropdown(){return this.displayStyle===le.DisplayStyle.DROPDOWN}_setLookupRow(e){this.lookupRow&&this.removeCssClass(this.lookupRow.cssClass),this._setProperty("lookupRow",e),e&&this.addCssClass(e.cssClass)}setLookupRow(e){this.lookupRow!==e&&(this._notUnique=!1,this.clearErrorStatus(),this._setLookupRow(e),this._lockLookupRow=!0,e?this.setValue(this._getValueFromLookupRow(e)):this.setValue(null),this._lockLookupRow=!1,this.resetDisplayText())}setDisplayText(e){super.setDisplayText(e),this._userWasTyping=!1}resetDisplayText(){let e=this.formatValue(this.value);e&&a().isFunction(e.promise)?e.done(this._setAndRenderDisplayText.bind(this)).fail(()=>{a().log.isInfoEnabled()&&a().log.info("Could not resolve display text for value: "+this.value)}):this._setAndRenderDisplayText(e)}_setAndRenderDisplayText(e){this._setProperty("displayText",e),this.rendered&&this._renderDisplayText()}_getValueFromLookupRow(e){return e.key}_setValue(e){this._lockLookupRow||(b.isNullOrUndefined(e)?this._setLookupRow(null):this._checkResetLookupRow(e)&&this._setLookupRow(null)),super._setValue(e),this._notUnique=!1}_checkResetLookupRow(e){return this.lookupRow&&this.lookupRow.key!==e}getValueForSelection(){return this._showSelection()?this.value:null}_showSelection(){if(b.isNullOrUndefined(this.value)||b.isNullOrUndefined(this.lookupRow))return!1;let e;if(this.rendered){e=this._readDisplayText();let t=this.additionalLines();t&&(e=[e].concat(t).join(`
`))}else e=this.displayText;return e===this.lookupRow.text}isClearable(){return super.isClearable()&&!this.isDropdown()&&!this.touchMode}_triggerLookupCallDone(e){return this.trigger("lookupCallDone",{result:e}),e}_triggerAcceptInputFail(){this._triggerAcceptInput(!1,!0)}_triggerAcceptInput(e,t){this.trigger("acceptInput",{displayText:this.displayText,errorStatus:this.errorStatus,value:this.value,lookupRow:this.lookupRow,acceptByLookupRow:u.nvl(e,!0),failure:u.nvl(t,!1)})}_triggerAcceptByText(e){this.trigger("acceptByText",{searchText:e,errorStatus:this.errorStatus})}onCellEditorRendered(e){e.openFieldPopup&&(this._cellEditorPopup=e.cellEditorPopup,this.openPopup(!this.searchRequired))}additionalLines(){let e=u.nvl(this.displayText,""),t=e.split(`
`);return t.length>1?(t.shift(),t):null}_createLoadingSupport(){return new Wh({widget:this,loadingIndicatorDelay:400})}_isInitialShowStatus(){return this.touchMode&&(this._pendingOpenPopup||this.isPopupOpen())?!1:super._isInitialShowStatus()}acceptInputFromField(e){this._copyValuesFromField(e),this._cellEditorPopup?(this._cellEditorPopup.completeEdit(),this._cellEditorPopup=null):this.acceptInput()}_copyValuesFromField(e){this.lookupRow!==e.lookupRow&&this.setLookupRow(e.lookupRow),this.setErrorStatus(e.errorStatus),this.setDisplayText(e.displayText)}_setNotUniqueError(e){this.setErrorStatus(E.error({message:this.session.text("SmartFieldNotUnique",e),code:le.ErrorCode.NOT_UNIQUE}))}_hasNotUniqueError(){return this._notUnique||this._hasUiError(le.ErrorCode.NOT_UNIQUE)}_errorStatus(){return this.lookupStatus||this.errorStatus}setLookupStatus(e){this.setProperty("lookupStatus",e)&&this.rendered&&this._renderErrorStatus()}clearErrorStatus(){this.setErrorStatus(null),this._clearLookupStatus()}_clearLookupStatus(){this.setLookupStatus(null)}_flushLookupStatus(){if(!!this.lookupStatus){if(this.lookupStatus.code===le.ErrorCode.NO_RESULTS||this.lookupStatus.code===le.ErrorCode.NOT_UNIQUE){let e=this.lookupStatus.clone();e.severity=E.Severity.ERROR,this.setErrorStatus(e)}this._clearLookupStatus()}}requestInput(){this.enabledComputed&&this.rendered&&(this.focus(),this.openPopup(!this.searchRequired))}}ve(le,"DisplayStyle",{DEFAULT:"default",DROPDOWN:"dropdown"}),ve(le,"ErrorCode",{NOT_UNIQUE:1,NO_RESULTS:2,NO_DATA:3,SEARCH_REQUIRED:4}),ve(le,"DEBOUNCE_DELAY",200),ve(le,"DEFAULT_BROWSE_MAX_COUNT",100),ve(le,"ActiveFilter",{UNDEFINED:"UNDEFINED",FALSE:"FALSE",TRUE:"TRUE"}),ve(le,"ACTIVE_FILTER_VALUES",[le.ActiveFilter.UNDEFINED,le.ActiveFilter.FALSE,le.ActiveFilter.TRUE]);function yD(i,e,t){return e=bD(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function bD(i){var e=vD(i,"string");return typeof e=="symbol"?e:String(e)}function vD(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class En extends nh{constructor(){super(),this._addRemoteProperties(["activeFilter"])}_postCreateWidget(){super._postCreateWidget(),this.widget.lookupCall=u.create(Gl,this)}_syncResult(e){let t=this.widget._currentLookupCall;!t&&this.widget.touchMode&&this.widget.popup&&this.widget.popup._field&&(t=this.widget.popup._field._currentLookupCall),t&&t.resolveLookup(e)}_syncDisplayText(e){this.widget.setDisplayText(e)}_orderPropertyNamesOnSync(e){return Object.keys(e).sort(this._createPropertySortFunc(En.PROPERTIES_ORDER))}_onWidgetEvent(e){e.type==="acceptByText"?this._onWidgetAcceptByText(e):super._onWidgetEvent(e)}_onWidgetAcceptByText(e){this._sendProperty("errorStatus",e.errorStatus)}_onWidgetAcceptInput(e){let t={displayText:e.displayText,errorStatus:e.errorStatus};e.errorStatus?y.empty(e.displayText)&&(t.value=null):(t.value=e.value,e.acceptByLookupRow&&(t.lookupRow=e.lookupRow)),this._send("acceptInput",t,{showBusyIndicator:!e.whileTyping,coalesce:function(s){return this.target===s.target&&this.type===s.type&&this.whileTyping===s.whileTyping}})}}yD(En,"PROPERTIES_ORDER",["lookupRow","value","errorStatus","displayText"]);function wD(i,e,t){return e=TD(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function TD(i){var e=CD(i,"string");return typeof e=="symbol"?e:String(e)}function CD(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ah extends oi{constructor(e){super(e),wD(this,"_smartField",void 0),this._smartField=e}layout(e){if(super.layout(e),this._smartField.embedded)return;let t=this._smartField.popup;t&&t.rendered&&(t.position(),t.validateLayout())}}class qc extends O{constructor(e){super(),this.field=e,this.which=[g.ESC],this.stopPropagation=!0,this.preventInvokeAcceptInputOnActiveValueField=!0,this.renderingHints.$drawingArea=function(t,s){return this.field.$fieldContainer}.bind(this)}_accept(e){return!(!super._accept(e)||!this.field.popup)}handle(e){this.field.closePopup(),this.field.resetDisplayText()}}function hh(i,e,t){return e=SD(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function SD(i){var e=PD(i,"string");return typeof e=="symbol"?e:String(e)}function PD(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Tl extends ue{constructor(){super(),hh(this,"field",void 0),hh(this,"lookupResult",void 0),hh(this,"smartField",void 0),hh(this,"proposalChooser",void 0),this.animateRemoval=Tl.hasPopupAnimation(),this.windowPaddingX=0,this.windowPaddingY=0}_init(e){e.withFocusContext=!1,super._init(e),this.smartField=this.parent,this.proposalChooser=this._createProposalChooser(),this.proposalChooser.on("lookupRowSelected",this._triggerEvent.bind(this)),this.proposalChooser.on("activeFilterSelected",this._triggerEvent.bind(this)),this.smartField.on("remove",this._onRemoveSmartField.bind(this)),this.setLookupResult(e.lookupResult),this.setStatus(e.status)}_createProposalChooser(){let e=this.smartField.browseHierarchy?"TreeProposalChooser":"TableProposalChooser";return u.create(e,{parent:this})}_createLayout(){return new jc(this)}_render(){let e=this.smartField.cssClassName()+"-popup";super._render(),this.$container.addClass(e).on("mousedown",this._onContainerMouseDown.bind(this)),this.$container.toggleClass("alternative",this.smartField.fieldStyle===A.FieldStyle.ALTERNATIVE),this.findDesktop().adjustOverlayOrder(this),this.proposalChooser.render()}setLookupResult(e){this._setProperty("lookupResult",e),this.proposalChooser.setLookupResult(e)}getSelectedLookupRow(){let e=this.proposalChooser.getSelectedLookupRow();return e&&e.enabled?e:null}setStatus(e){this.proposalChooser.setStatus(e)}selectFirstLookupRow(){this.proposalChooser.selectFirstLookupRow()}selectLookupRow(){this.proposalChooser.triggerLookupRowSelected()}delegateKeyEvent(e){e.originalEvent.smartFieldEvent=!0,this.proposalChooser.delegateKeyEvent(e)}_triggerEvent(e){this.trigger(e.type,e)}_onContainerMouseDown(e){return!1}_onRemoveSmartField(e){this.animateRemoval=!1,this.remove()}_isMouseDownOnAnchor(e){let t=e.target;return this.field.$field.isOrHas(t)||this.field.$icon.isOrHas(t)||this.field.$clearIcon&&this.field.$clearIcon.isOrHas(t)}_onAnimationEnd(){this.proposalChooser.updateScrollbars()}static hasPopupAnimation(){return x.get().supportsCssAnimation()}}function Yc(i,e,t){return e=xD(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function xD(i){var e=ED(i,"string");return typeof e=="symbol"?e:String(e)}function ED(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class c_ extends el{constructor(){super(...arguments),Yc(this,"field",void 0),Yc(this,"lookupResult",void 0),Yc(this,"smartField",void 0)}_init(e){e.withFocusContext=!1,e.smartField=e.parent,super._init(e),this.setLookupResult(e.lookupResult),this.setStatus(e.status),this.one("close",this._beforeClosePopup.bind(this)),this.smartField.on("propertyChange",this._onPropertyChange.bind(this)),this.addCssClass("smart-field-touch-popup")}_initWidget(e){this._widget=this._createProposalChooser(),this._widget.on("lookupRowSelected",this._triggerEvent.bind(this)),this._widget.on("activeFilterSelected",this._triggerEvent.bind(this))}_createProposalChooser(){let e=this.parent.browseHierarchy?"TreeProposalChooser":"TableProposalChooser";return u.create(e,{parent:this,touch:!0,smartField:this._field})}_fieldOverrides(){let e=super._fieldOverrides();return e.proposalChooser=null,e}_onMouseDownOutside(){this._acceptInput()}delegateKeyEvent(e){e.originalEvent.smartFieldEvent=!0,this._widget.delegateKeyEvent(e)}getSelectedLookupRow(){return this._widget.getSelectedLookupRow()}_triggerEvent(e){this.trigger(e.type,e)}setLookupResult(e){this._widget.setLookupResult(e)}setStatus(e){this._widget.setStatus(e)}clearLookupRows(){this._widget.clearLookupRows()}selectFirstLookupRow(){this._widget.selectFirstLookupRow()}selectLookupRow(){this._widget.triggerLookupRowSelected()}_onPropertyChange(e){e.propertyName==="lookupStatus"&&this._field.setLookupStatus(e.newValue)}_beforeClosePopup(e){this.smartField.acceptInputFromField(this._field)}}function FD(i,e,t){return e=DD(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function DD(i){var e=AD(i,"string");return typeof e=="symbol"?e:String(e)}function AD(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class jc extends Ii{constructor(e){super(e),FD(this,"animating",void 0),this.animating=!1,this.doubleCalcPrefSize=!1}layout(e){let t,s,r=this._htmlProposalChooser();if(this.animating){this.popup.htmlComp.$comp.oneAnimationEnd(()=>{this.popup.revalidateLayout()});return}super.layout(e),s=this.popup.htmlComp.size(),t=s.subtract(this.popup.htmlComp.insets()),r.setSize(t),this.popup.htmlComp.layouted?this.popup.position():Tl.hasPopupAnimation()&&(this.animating=!0,this.popup.htmlComp.$comp.css("visibility","hidden"),this.popup.session.layoutValidator.schedulePostValidateFunction(()=>{this.popup.htmlComp.$comp.css("visibility",""),this.popup.htmlComp.$comp.addClassForAnimation("animate-open"),this.popup.htmlComp.$comp.oneAnimationEnd(()=>{this.animating=!1,this.popup._onAnimationEnd()})}))}preferredLayoutSize(e,t){let s,r=this._htmlProposalChooser(),n=v.offsetBounds(this.popup.smartField.$field);return r?(s=r.prefSize(t),s=s.add(this.popup.htmlComp.insets())):s=new F(de.get().formColumnWidth,de.get().formRowHeight*2),s.width=Math.max(n.width,s.width),s.height=Math.max(15,Math.min(350,s.height)),s.width>this._maxWindowSize()&&(s.width=this._maxWindowSize()),s}_htmlProposalChooser(){let e=this.popup.proposalChooser;return e?e.htmlComp:null}_maxWindowSize(){return this.popup.$container.window().width()-2*this.popup.windowPaddingX}}function $D(i,e,t){return e=RD(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function RD(i){var e=MD(i,"string");return typeof e=="symbol"?e:String(e)}function MD(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class p_ extends le{constructor(){super(),$D(this,"_$multilineLines",void 0),this._$multilineLines=null}_render(){let e,t;this.addContainer(this.$parent,"smart-field has-icon",new ah(this)),this.addLabel(),this.addFieldContainer(this.$parent.makeDiv("multiline")),t=T.install(this.$fieldContainer,this.session),t.setLayout(new Jc(this)),e=Z.makeInputOrDiv(this,"multiline-input").on("mousedown",this._onFieldMouseDown.bind(this)).appendTo(this.$fieldContainer),this.touchMode||e.keyup(this._onFieldKeyUp.bind(this)).keydown(this._onFieldKeyDown.bind(this)).on("input",this._onFieldInput.bind(this)),this.addField(e),this._$multilineLines=this.$fieldContainer.appendDiv("multiline-lines").on("click",this._onMultilineLinesClick.bind(this)),this.embedded||this.addMandatoryIndicator(),this.addIcon(),this.addStatus()}_renderEnabled(){super._renderEnabled(),this._$multilineLines.setEnabled(this.enabledComputed)}_onMultilineLinesClick(e){this.enabledComputed&&(this.$field.window(!0).getSelection().toString()||this.$field.focus())}_renderDisplayText(){super._renderDisplayText();let e=this.additionalLines();e?this._$multilineLines.html(p.formatEncoded(e,"<br/>")):this._$multilineLines.empty()}_getInputBounds(){let e=v.offsetBounds(this.$fieldContainer),t=v.offsetBounds(this.$field);return e.height=t.height,e}_renderFocused(){super._renderFocused(),this._$multilineLines.toggleClass("focused",this.focused)}_updateErrorStatusClasses(e,t){super._updateErrorStatusClasses(e,t),this._updateErrorStatusClassesOnElement(this._$multilineLines,e,t)}}class f_ extends En{}function Xc(i,e,t){return e=ID(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ID(i){var e=LD(i,"string");return typeof e=="symbol"?e:String(e)}function LD(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Jc extends ee{constructor(e){super(),Xc(this,"smartField",void 0),Xc(this,"htmlPropertyChangeHandler",void 0),Xc(this,"rowHeight",void 0),this.smartField=e,this._initDefaults(),this.htmlPropertyChangeHandler=this._onHtmlEnvironmentPropertyChange.bind(this),de.get().on("propertyChange",this.htmlPropertyChangeHandler),this.smartField.one("remove",()=>{de.get().off("propertyChange",this.htmlPropertyChangeHandler)})}_initDefaults(){this.rowHeight=de.get().formRowHeight}_onHtmlEnvironmentPropertyChange(){this._initDefaults(),this.smartField.invalidateLayoutTree()}layout(e){let t=T.get(e),s=e.children(".multiline-input"),r=e.children(".multiline-lines"),n=t.availableSize().subtract(t.insets());s.cssHeight(this.rowHeight),r.cssHeight(n.height-this.rowHeight)}}function m_(i,e,t){return e=OD(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function OD(i){var e=BD(i,"string");return typeof e=="symbol"?e:String(e)}function BD(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Qc extends le{constructor(){super(),m_(this,"trimText",void 0),m_(this,"lookupOnAcceptByText",void 0),this.maxLength=4e3,this.trimText=!0,this.lookupOnAcceptByText=!1}_getValueFromLookupRow(e){return e.text}_getLastSearchText(){return this.value}cssClassName(){return"proposal-field"}_handleEnterKey(e){let t=!!this.popup;this.acceptInput(),this.popup&&this.closePopup(),t&&e.stopPropagation()}_lookupByTextOrAllDone(e){if(!super._handleException(e)){if(e.lookupRows.length===0){this.setLoading(!1),this._handleEmptyResult();return}super._lookupByTextOrAllDone(e)}}_formatValue(e){return u.nvl(e,"")}_validateValue(e){if(b.isNullOrUndefined(e))return e;let t=y.asString(e);return this.trimText&&(t=t.trim()),t===""&&(t=null),t}_ensureValue(e){return y.asString(e)}_acceptByText(e,t){a().log.isDebugEnabled()&&a().log.debug("(ProposalField#_acceptByText) searchText=",t),!e&&this.lookupOnAcceptByText&&y.hasText(t)?super._acceptByTextAsync(t):this._customTextAccepted(t)}_acceptByTextDone(e){if(this._userWasTyping=!1,this._extendResult(e),e.uniqueMatch){let t=e.uniqueMatch;if(this._isLookupRowActive(t)){this.setLookupRow(t),this._inputAccepted();return}}this._customTextAccepted(e.text)}_checkResetLookupRow(e){return this.lookupRow&&this.lookupRow.text!==e}_checkSearchTextChanged(e){return this._checkDisplayTextChanged(e)}_customTextAccepted(e){this._setLookupRow(null),this._setValue(e),this._inputAccepted(!0,!1)}getValueForSelection(){return this._showSelection()?this.lookupRow.key:null}_copyValuesFromField(e){this.lookupRow!==e.lookupRow&&this.setLookupRow(e.lookupRow),this.value!==e.value&&this.setValue(e.value)}_acceptInput(e,t,s,r,n){if(!n&&this.lookupRow&&this.lookupRow.text===t){a().log.isDebugEnabled()&&a().log.debug("(ProposalField#_acceptInput) unchanged: text is equals. Close popup"),this._inputAccepted(!1);return}if(n){a().log.isDebugEnabled()&&a().log.debug("(ProposalField#_acceptInput) lookup-row selected. Set lookup-row, close popup lookupRow=",n.toString()),this.clearErrorStatus(),this.setLookupRow(n),this._inputAccepted();return}return r?(this.clearErrorStatus(),this._acceptByText(e,t)):this._hasUiError()?this._acceptInputDeferred.resolve():this._inputAccepted(!1),this._acceptInputDeferred.promise()}setTrimText(e){this.setProperty("trimText",e)}_updateEmpty(){this.empty=y.empty(this.value)}}class g_ extends En{constructor(){super(),this._addRemoteProperties(["lookupRows"])}}function Zc(i,e,t){return e=kD(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function kD(i){var e=HD(i,"string");return typeof e=="symbol"?e:String(e)}function HD(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ep extends ir{constructor(){super(...arguments),Zc(this,"lookupRow",void 0),Zc(this,"parentId",void 0),Zc(this,"proposalChooser",void 0)}_renderText(){this.htmlEnabled?this.$text.html(this.text):this.$text.textOrNbsp(this.text)}_getStyles(){return this.lookupRow}_decorate(){!this.$node||(super._decorate(),this.$node.toggleClass("inactive",!this.lookupRow.active))}isBrowseLoadIncremental(){return this.proposalChooser.isBrowseLoadIncremental()}loadChildren(){if(this.isBrowseLoadIncremental()){let e=this.lookupRow.key;return this.proposalChooser.smartField.lookupByRec(e)}return a().resolvedPromise()}hasChildNodes(){return this.isBrowseLoadIncremental()&&!this.childrenLoaded?!0:super.hasChildNodes()}}function $r(i,e,t){return e=ND(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ND(i){var e=VD(i,"string");return typeof e=="symbol"?e:String(e)}function VD(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class dh extends I{constructor(){super(),$r(this,"smartField",void 0),$r(this,"activeFilterGroup",void 0),$r(this,"status",void 0),$r(this,"statusVisible",void 0),$r(this,"touch",void 0),$r(this,"content",void 0),$r(this,"$status",void 0),$r(this,"_updateStatusTimeout",void 0),this.activeFilterGroup=null,this.status=null,this.statusVisible=!0,this.touch=!1,this.$status=null,this._updateStatusTimeout=null}_init(e){super._init(e),e.smartField||(this.smartField=this.parent.smartField),this.content=this._createContent()}triggerLookupRowSelected(e){e=e||this.selectedRow(),!(!e||!e.enabled)&&this.trigger("lookupRowSelected",{lookupRow:e.lookupRow})}_render(){this.$container=this.$parent.appendDiv("proposal-chooser").toggleClass("touch",this.touch),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new tp(this,this._createLayoutResetter())),this._renderContent(),this.$status=this.$container.appendDiv("status").setVisible(!1),this.smartField.activeFilterEnabled&&(this.activeFilterGroup=u.create(or,{parent:this,labelVisible:!1,statusVisible:!1,gridColumnCount:le.ACTIVE_FILTER_VALUES.length}),le.ACTIVE_FILTER_VALUES.forEach(function(e,t){this._insertActiveFilterButton(e,t)},this),this.activeFilterGroup.render(),this.activeFilterGroup.$container.addClass("active-filter"),this.activeFilterGroup.removeMandatoryIndicator())}_renderContent(){this.content.render(),this.content.$container.setTabbable(!1),this.content.$container.addClass("focused")}_renderProperties(){super._renderProperties(),this._updateStatus()}delegateEvent(e){e.originalEvent.smartFieldEvent=!0,this.content.$container.trigger(e)}delegateKeyEvent(e){this.content.$container.trigger(e)}_renderStatus(){this._updateStatus()}_renderStatusVisible(){this._updateStatus()}_computeStatusVisible(){return!!(this.statusVisible&&this.status)}_updateStatus(){clearTimeout(this._updateStatusTimeout),b.optProperty(this.status,"severity")===E.Severity.OK?this._updateStatusTimeout=setTimeout(this._updateStatusImpl.bind(this),250):this._updateStatusImpl()}_updateStatusImpl(){if(!this.rendered&&!this.rendering)return;let e=this.$status.isVisible(),t=this.$status.text(),s=this._computeStatusVisible();e===s&&t===b.optProperty(this.status,"message")||(a().log.isDebugEnabled()&&a().log.debug("(ProposalChooser#_updateStatusImpl) $status.visible="+s),this.$status.setVisible(s),this.status?this._setStatusMessage(this.status.message):this.$status.text(""),this.htmlComp.invalidateLayoutTree())}_setStatusMessage(e){E.animateStatusMessage(this.$status,e)}_insertActiveFilterButton(e,t){let s=u.create(bl,{parent:this.activeFilterGroup,label:this._activeFilterLabel(t),radioValue:le.ACTIVE_FILTER_VALUES[t],selected:this.smartField.activeFilter===e,focusWhenSelected:!1,gridDataHints:{useUiWidth:!0}});s.on("propertyChange",r=>{r.propertyName==="selected"&&r.newValue===!0&&this.trigger("activeFilterSelected",{activeFilter:r.source.radioValue})}),this.activeFilterGroup.insertButton(s)}setVirtual(e){this.content instanceof V&&this.content.setVirtual(e)}setStatus(e){this.setProperty("status",e)}setBusy(e){this.content.setProperty("loading",e),this.content.setProperty("enabled",!e)}_activeFilterLabel(e){return this.smartField.activeFilterLabels[e]}updateScrollbars(){this.content.updateScrollbars()}_isProposal(){return this.smartField instanceof Qc}_selectProposal(e,t){this._isProposal()||(e.byAll?this.trySelectCurrentValue():t.length===1&&this.selectFirstLookupRow())}}function __(i,e,t){return e=WD(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function WD(i){var e=zD(i,"string");return typeof e=="symbol"?e:String(e)}function zD(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class tp extends ee{constructor(e,t){super(),__(this,"_proposalChooser",void 0),__(this,"_layoutResetter",void 0),this._proposalChooser=e,this._layoutResetter=t}layout(e){let t,s=T.get(e),r=T.get(e.children(this._layoutResetter.cssSelector)),n=s.size().subtract(s.insets()),o=this._proposalChooser.$status,l=o&&o.isVisible(),h=this._proposalChooser.activeFilterGroup;l&&(n.height-=v.size(o).height),h&&(t=h.htmlComp.prefSize(),n.height-=t.height),r.setSize(n),h&&h.htmlComp.setSize(new F(n.width,t.height))}preferredLayoutSize(e,t){let s,r,n,o,l,h,d,c=this._proposalChooser.htmlComp,f=this._proposalChooser.$status,m=this._proposalChooser.activeFilterGroup,_=e.parent();return n=this._proposalChooser.content.htmlComp.prefSize(t),r=n,P.storeScrollPositions(e,this._proposalChooser.session),h=e.css("width"),d=e.css("height"),e.detach(),this._layoutResetter.modifyDom(),e.css("display","inline-block").css("width","auto").css("height","auto"),_.append(e),n.width=v.prefSize(e,{restoreScrollPositions:!1}).width,e.detach(),this._layoutResetter.restoreDom(),e.css("display","block").css("width",h).css("height",d),_.append(e),P.restoreScrollPositions(e,this._proposalChooser.session),f&&f.isVisible()&&(s=f.css("display"),f.css("display","inline-block"),o=v.prefSize(f,{includeMargin:!0,useCssSize:!0}),f.css("display",s),r=new F(Math.max(r.width,o.width),r.height+o.height)),m&&(l=m.htmlComp.prefSize(),r=new F(Math.max(r.width,l.width),r.height+l.height)),e.toggleClass("empty",n.height===0),r.add(c.insets())}}class y_ extends dh{_createContent(){let e=!1,t=[],s=this.smartField.columnDescriptors;s?s.forEach(function(n,o){e=e||!!n.text,t.push(this._createColumnForDescriptor(n))},this):t.push(this._createColumn());let r=this._createTable(t,e);return r.on("rowClick",this._onRowClick.bind(this)),r}_createLayoutResetter(){return u.create(uh,this.content)}_createColumn(){return u.create(De,{session:this.session,width:De.NARROW_MIN_WIDTH,horizontalAlignment:this.smartField.gridData.horizontalAlignment})}_createColumnForDescriptor(e){let t=De.NARROW_MIN_WIDTH;return e.width&&e.width>0&&(t=e.width),u.create(De,{session:this.session,text:e.text,cssClass:u.nvl(e.cssClass,null),width:t,autoOptimizeWidth:u.nvl(e.autoOptimizeWidth,!1),fixedWidth:u.nvl(e.fixedWidth,!1),fixedPosition:u.nvl(e.fixedPosition,!1),horizontalAlignment:u.nvl(e.horizontalAlignment,this.smartField.gridData.horizontalAlignment),visible:u.nvl(e.visible,!0),htmlEnabled:u.nvl(e.htmlEnabled,!1)})}_createTable(e,t){return u.create(V,{parent:this,headerVisible:t,autoResizeColumns:!0,multiSelect:!1,multilineText:!0,scrollToSelection:!0,columns:e,headerMenusEnabled:!1,textFilterEnabled:!1})}_onRowClick(e){let t=e.row;!t||!t.enabled||(this.setBusy(!0),this.triggerLookupRowSelected(t))}selectedRow(){return this.content.selectedRow()}setLookupResult(e){let t=[],s=e.lookupRows,r=!!this.smartField.columnDescriptors;this.content.deleteAllRows(),s.forEach(n=>{t.push(this._createTableRow(n,r))}),this.content.insertRows(t),this._selectProposal(e,t)}trySelectCurrentValue(){let e=this.smartField.getValueForSelection();if(b.isNullOrUndefined(e))return;let t=p.find(this.content.rows,s=>s.lookupRow.key===e);t&&this.content.selectRow(t)}selectFirstLookupRow(){this.content.rows.length&&this.content.selectRow(this.content.rows[0])}clearSelection(){this.content.deselectAll()}clearLookupRows(){this.content.removeAllRows()}_createTableRow(e,t){let s=_o.createTableRow(e,t);return t&&p.pushAll(s.cells,this._transformTableRowData(e,e.additionalTableRowData)),s}_renderContent(){this.content.setVirtual(this.smartField.virtual()),super._renderContent(),this.content.$data.addClass("top-border-on-first-row")}getSelectedLookupRow(){let e=this.content.selectedRow();return e?e.lookupRow:null}_transformTableRowData(e,t){let s=this.smartField.columnDescriptors,r=[];return s.forEach(n=>{r.push(_o.createTableCell(e,n,t))}),r}}function ip(i,e,t){return e=KD(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function KD(i){var e=GD(i,"string");return typeof e=="symbol"?e:String(e)}function GD(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class uh{constructor(e){ip(this,"cssSelector",void 0),ip(this,"_table",void 0),ip(this,"_fillerWidth",void 0),this._table=e,this._fillerWidth=null,this.cssSelector=".table"}modifyDom(){this._table.$container.css("display","inline-block").css("width","auto").css("height","auto"),this._table.$data.css("display","inline-block"),this._modifyFiller(this._table.$fillBefore),this._modifyFiller(this._table.$fillAfter),this._modifyTableData(this._cssBackup)}restoreDom(){this._table.$container.css("display","block").css("width","100%").css("height","100%"),this._table.$data.css("display","block"),this._restoreFiller(this._table.$fillBefore),this._restoreFiller(this._table.$fillAfter),this._modifyTableData(this._cssRestore)}_cssBackup(e,t){let s=e.css(t);e.css(t,"").data("backup"+t,s)}_cssRestore(e,t){let s="backup"+t,r=e.data(s);e.css(t,r).removeData(s)}_modifyTableData(e){let t=this;this._table.$rows().each(function(){let s=a()(this);e(s,"width"),t._table.$cellsForRow(s).each(function(){let r=a()(this);e(r,"min-width"),e(r,"max-width")})})}_modifyFiller(e){e&&(this._fillerWidth=e.css("width"),e.css("width",""))}_restoreFiller(e){e&&e.css("width",this._fillerWidth)}}class sp extends dh{_createContent(){let e=u.create(pe,{parent:this,requestFocusOnNodeControlMouseDown:!1,scrollToSelection:!0,textFilterEnabled:!1});return e.on("nodeClick",this._onNodeClick.bind(this)),e}_createLayoutResetter(){return u.create(rp,this.content)}_onNodeClick(e){this.triggerLookupRowSelected(e.node)}selectedRow(){return this.content.selectedNode()}isBrowseLoadIncremental(){return this.smartField.browseLoadIncremental}getSelectedLookupRow(){let e=this.content.selectedNode();return e?e.lookupRow:null}selectFirstLookupRow(){this.content.nodes.length&&this.content.selectNode(this.content.nodes[0])}clearSelection(){this.content.deselectAll()}setLookupResult(e){let t,s,r=e.lookupRows;if(u.nvl(e.appendResult,!1))if(s=r.map(this._createTreeNode.bind(this)),t=this._flatListToSubTree(s),t.length){let o=null;t.forEach(l=>{o=this.content.nodesMap[l.parentId],this._appendChildNode(o,l)}),o&&this.content.insertNodes(t,o)}else{let o=this.content.nodesMap[this._createNodeId(e.rec)];o.leaf=!0,o.childrenLoaded=!0,this.content.updateNode(o)}else this.content.deleteAllChildNodes(),s=r.map(this._createTreeNode.bind(this)),t=this._flatListToSubTree(s),e.byText&&this._expandAllParentNodes(s),this.content.insertNodes(t);this._selectProposal(e,s)}_expandAllParentNodes(e){e.reduce((r,n)=>((n.leaf||!n.childrenLoaded&&n.childNodes.length===0)&&r.push(n),r),[]).forEach(s.bind(this));function s(r){if(!(!r.parentNode||r.parentNode.expanded))for(r=r.parentNode;r;)this.content.setNodeExpanded(r,!0),r=r.parentNode}}trySelectCurrentValue(){let e=this.smartField.getValueForSelection();if(b.isNullOrUndefined(e))return;let t=b.values(this.content.nodesMap),s=p.find(t,r=>r.lookupRow.key===e);s&&this.content.selectNode(s)}_createTreeNode(e){let t=!0,s=this.smartField.browseAutoExpandAll;return this.isBrowseLoadIncremental()&&(s=!1,t=!1),u.create(ep,{parent:this.content,proposalChooser:this,childNodeIndex:0,enabled:e.enabled,htmlEnabled:!1,iconId:e.iconId,id:this._createNodeId(e.key),parentId:this._createNodeId(e.parentKey),expanded:s,initialExpanded:s,text:e.text,lookupRow:e,leaf:t,tooltipText:e.tooltipText})}_createNodeId(e){return b.isNullOrUndefined(e)||typeof e=="string"?e:JSON.stringify(e)}findLeafs(){let e=[];return pe.visitNodes((t,s)=>{(t.leaf||!t.childNodes.length)&&e.push(t)},this.content.nodes),e}_flatListToSubTree(e){let t={};e.forEach(r=>{b.isNullOrUndefined(r.id)||(t[r.id]=r)});let s=[];return e.forEach(r=>{let n=t[r.parentId];if(n===r)throw new Error("Cannot link a node to itself. Id: "+r.parentId);n?this._appendChildNode(n,r):(r.childNodeIndex=s.length,r.parentNode=null,s.push(r))}),s}_appendChildNode(e,t){e.childNodes||(e.childNodes=[]),t.childNodeIndex=e.childNodes.length,t.parentNode=e,e.childNodes.push(t),e.leaf=!1,e.childrenLoaded=!0}clearLookupRows(){this.content.deleteAllNodes()}}function b_(i,e,t){return e=UD(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function UD(i){var e=qD(i,"string");return typeof e=="symbol"?e:String(e)}function qD(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class rp{constructor(e){b_(this,"cssSelector",void 0),b_(this,"_tree",void 0),this._tree=e,this.cssSelector=".tree"}modifyDom(){this._ensureFirstLast(),this._tree.$container.css("display","inline-block").css("width","auto").css("height","auto"),this._tree.$data.css("display","inline-block")}restoreDom(){this._tree.$container.css("display","block").css("width","100%").css("height","100%"),this._tree.$data.css("display","block")}_ensureFirstLast(){let e=this._tree.$data.children(".tree-node").removeClass("first last");e.first().addClass("first"),e.last().addClass("last")}}function it(i,e,t){return e=YD(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function YD(i){var e=jD(i,"string");return typeof e=="symbol"?e:String(e)}function jD(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ge extends Fr{constructor(){super(),it(this,"firstField",void 0),it(this,"secondField",void 0),it(this,"collapsibleField",void 0),it(this,"fieldCollapsed",void 0),it(this,"toggleCollapseKeyStroke",void 0),it(this,"firstCollapseKeyStroke",void 0),it(this,"secondCollapseKeyStroke",void 0),it(this,"splitHorizontal",void 0),it(this,"splitterEnabled",void 0),it(this,"splitterPosition",void 0),it(this,"minSplitterPosition",void 0),it(this,"splitterPositionType",void 0),it(this,"fieldMinimized",void 0),it(this,"minimizeEnabled",void 0),it(this,"htmlSplitArea",void 0),it(this,"collapseHandle",void 0),it(this,"_oldSplitterPositionType",void 0),it(this,"_$splitArea",void 0),it(this,"_$splitter",void 0),it(this,"_$window",void 0),it(this,"_$body",void 0),this._addWidgetProperties(["firstField","secondField","collapsibleField"]),this._addPreserveOnPropertyChangeProperties(["collapsibleField"]),this.firstField=null,this.secondField=null,this.collapsibleField=null,this.fieldCollapsed=!1,this.toggleCollapseKeyStroke=null,this.firstCollapseKeyStroke=null,this.secondCollapseKeyStroke=null,this.splitHorizontal=!0,this.splitterEnabled=!0,this.splitterPosition=.5,this.minSplitterPosition=0,this.splitterPositionType=ge.SPLITTER_POSITION_TYPE_RELATIVE_FIRST,this.fieldMinimized=!1,this.minimizeEnabled=!0,this._$splitArea=null,this._$splitter=null}_init(e){super._init(e),this._setToggleCollapseKeyStroke(e.toggleCollapseKeyStroke),this._setFirstCollapseKeyStroke(e.firstCollapseKeyStroke),this._setSecondCollapseKeyStroke(e.secondCollapseKeyStroke),this._updateCollapseHandle(),this._initResponsive()}_initResponsive(){this.getFields().forEach(e=>{e instanceof xe&&e.responsive===null&&e.setResponsive(!0)})}_render(){this.addContainer(this.$parent,"split-box"),this._$splitArea=this.$parent.makeDiv("split-area"),this.addField(this._$splitArea),this.htmlSplitArea=T.install(this._$splitArea,this.session),this.htmlSplitArea.setLayout(new ap(this)),this._$window=this.$parent.window(),this._$body=this.$parent.body(),this.firstField&&(this.firstField.render(this._$splitArea),this.firstField.$container.addClass("first-field").addClass(this.splitHorizontal?"x-axis":"y-axis"),this.firstField.on("propertyChange",t.bind(this)),this.secondField&&(this.secondField.render(this._$splitArea),this.secondField.$container.addClass("second-field").addClass(this.splitHorizontal?"x-axis":"y-axis"),this.secondField.on("propertyChange",t.bind(this)),this._$splitter=this._$splitArea.appendDiv("splitter").addClass(this.splitHorizontal?"x-axis":"y-axis").on("mousedown",e.bind(this)))),this._updateFieldVisibilityClasses();function e(s){if(s.which!==1)return;let r,n,o,l,h,d;this.splitterEnabled&&(r={x:s.pageX,y:s.pageY},this._$window.on("mousemove.splitbox",m.bind(this)).on("mouseup.splitbox",_.bind(this)),this._$body.addClass(this.splitHorizontal?"col-resize":"row-resize"),a()("iframe").addClass("dragging-in-progress"),n=this._$splitArea.offset(),o=v.size(this._$splitArea,!0),h=this._$splitter.offset(),l=v.size(this._$splitter,!0),d=this._$splitArea.appendDiv("temp-splitter").addClass(this.splitHorizontal?"x-axis":"y-axis"),this.splitHorizontal?d.cssLeft(h.left-n.left):d.cssTop(h.top-n.top),this._$splitter.addClass("dragging"));let c=this.splitterPosition,f=10;function m(C){if(!(C.pageX===r.x&&C.pageY===r.y))if(r={x:C.pageX,y:C.pageY},this.splitHorizontal){let S=C.pageX-n.left,R,L,H=Math.floor((l.width+de.get().fieldMandatoryIndicatorWidth)/2);this.splitterPositionType===ge.SPLITTER_POSITION_TYPE_ABSOLUTE_FIRST?(R=u.nvl(this.minSplitterPosition,0),L=o.width-l.width+H):this.splitterPositionType===ge.SPLITTER_POSITION_TYPE_RELATIVE_FIRST?(R=(o.width-l.width)*u.nvl(this.minSplitterPosition,0),L=o.width-l.width+H):this.splitterPositionType===ge.SPLITTER_POSITION_TYPE_ABSOLUTE_SECOND?(R=0,L=o.width-l.width+H-u.nvl(this.minSplitterPosition,0)):this.splitterPositionType===ge.SPLITTER_POSITION_TYPE_RELATIVE_SECOND&&(R=0,L=o.width-l.width+H-Math.floor(u.nvl(this.minSplitterPosition,0)*(o.width-l.width)));let we=H;S<R+H+f?(S=R,we=0):S>L-f&&(S=L),d.cssLeft(S-we),c=S-we,this.splitterPositionType===ge.SPLITTER_POSITION_TYPE_RELATIVE_FIRST?c=c/(o.width-l.width):this.splitterPositionType===ge.SPLITTER_POSITION_TYPE_RELATIVE_SECOND?c=1-c/(o.width-l.width):this.splitterPositionType===ge.SPLITTER_POSITION_TYPE_ABSOLUTE_SECOND&&(c=o.width-l.width-c)}else{let S=C.pageY-n.top,R=Math.floor(l.height/2);S<f?(S=0,R=0):o.height-S<f&&(S=o.height,R=l.height),d.cssTop(S-R),c=S-R,this.splitterPositionType===ge.SPLITTER_POSITION_TYPE_RELATIVE_FIRST?c=c/(o.height-l.height):this.splitterPositionType===ge.SPLITTER_POSITION_TYPE_RELATIVE_SECOND?c=1-c/(o.height-l.height):this.splitterPositionType===ge.SPLITTER_POSITION_TYPE_ABSOLUTE_SECOND&&(c=o.height-c-l.height)}}function _(C){C.which===1&&(this._$window.off("mousemove.splitbox").off("mouseup.splitbox"),d&&(this._$body.removeClass(this.splitHorizontal?"col-resize":"row-resize"),a()("iframe").removeClass("dragging-in-progress"),d.remove(),this._$splitter.removeClass("dragging"),this.newSplitterPosition(c,!0)))}return!1}function t(s){s.propertyName==="visible"&&(this._updateFieldVisibilityClasses(),this.htmlSplitArea.invalidateLayoutTree(!1))}}_renderProperties(){super._renderProperties(),this._renderSplitterPosition(),this._renderSplitterEnabled(),this._renderCollapsibleField(),this._renderCollapseHandle(),this._renderFieldMinimized()}_remove(){this._$splitArea=null,this._$splitter=null,super._remove()}_setSplitterPosition(e){this._setProperty("splitterPosition",e),this._oldSplitterPositionType=null}_renderSplitterPosition(){this.newSplitterPosition(this.splitterPosition,!1)}_setSplitterPositionType(e){this.rendered&&!this._oldSplitterPositionType&&(this._oldSplitterPositionType=this.splitterPositionType),this._setProperty("splitterPositionType",e)}_renderSplitterPositionType(){if(this._oldSplitterPositionType){let e=this.htmlSplitArea.size(),t=this.splitterPosition,s=v.size(this._$splitter,!0),r=this.minSplitterPosition,n=0;this.splitHorizontal?n=e.width-s.width:n=e.height-s.height;let o=this._isSplitterPositionTypeRelative(this._oldSplitterPositionType),l=this._isSplitterPositionTypeRelative(this.splitterPositionType),h=!o,d=!l;o&&d?(this._oldSplitterPositionType===ge.SPLITTER_POSITION_TYPE_RELATIVE_FIRST&&this.splitterPositionType===ge.SPLITTER_POSITION_TYPE_ABSOLUTE_SECOND||this._oldSplitterPositionType===ge.SPLITTER_POSITION_TYPE_RELATIVE_SECOND&&this.splitterPositionType===ge.SPLITTER_POSITION_TYPE_ABSOLUTE_FIRST?t=n-n*t:t=n*t,r&&(r=n*r)):h&&l?(this._oldSplitterPositionType===ge.SPLITTER_POSITION_TYPE_ABSOLUTE_FIRST&&this.splitterPositionType===ge.SPLITTER_POSITION_TYPE_RELATIVE_SECOND||this._oldSplitterPositionType===ge.SPLITTER_POSITION_TYPE_ABSOLUTE_SECOND&&this.splitterPositionType===ge.SPLITTER_POSITION_TYPE_RELATIVE_FIRST?t=(n-t)/n:t=t/n,r&&(r=r/n)):h&&d?t=n-t:t=1-t,this.setMinSplitterPosition(r),this._oldSplitterPositionType=null,this.newSplitterPosition(t,!0)}}_isSplitterPositionTypeRelative(e){return e===ge.SPLITTER_POSITION_TYPE_RELATIVE_FIRST||e===ge.SPLITTER_POSITION_TYPE_RELATIVE_SECOND}_renderSplitterEnabled(){this._$splitter&&this._$splitter.setEnabled(this.splitterEnabled)}setFieldCollapsed(e){this.setProperty("fieldCollapsed",e),this._updateCollapseHandleButtons()}_renderFieldCollapsed(){this._renderCollapsibleField()}setCollapsibleField(e){this.setProperty("collapsibleField",e),this._updateCollapseHandle()}_updateCollapseHandle(){if(this.toggleCollapseKeyStroke&&this.unregisterKeyStrokes(this.toggleCollapseKeyStroke),this.firstCollapseKeyStroke&&this.unregisterKeyStrokes(this.firstCollapseKeyStroke),this.secondCollapseKeyStroke&&this.unregisterKeyStrokes(this.secondCollapseKeyStroke),this.collapsibleField){let e=qi.HorizontalAlignment.LEFT;this.collapsibleField!==this.firstField&&(e=qi.HorizontalAlignment.RIGHT),this.collapseHandle?this.collapseHandle.setHorizontalAlignment(e):(this.collapseHandle=u.create(qi,{parent:this,horizontalAlignment:e}),this.collapseHandle.on("action",this.collapseHandleButtonPressed.bind(this)),this.toggleCollapseKeyStroke&&this.registerKeyStrokes(this.toggleCollapseKeyStroke),this.firstCollapseKeyStroke&&this.registerKeyStrokes(this.firstCollapseKeyStroke),this.secondCollapseKeyStroke&&this.registerKeyStrokes(this.secondCollapseKeyStroke),this.rendered&&this._renderCollapseHandle()),this._updateCollapseHandleButtons()}else this.collapseHandle&&(this.collapseHandle.destroy(),this.collapseHandle=null)}_updateCollapseHandleButtons(){if(!this.collapseHandle)return;let e,t,s=this.fieldCollapsed,r=this.fieldMinimized,n=this._isMinimizable(),o=this.splitterPositionType===ge.SPLITTER_POSITION_TYPE_RELATIVE_FIRST||this.splitterPositionType===ge.SPLITTER_POSITION_TYPE_ABSOLUTE_FIRST,l=o&&this.collapsibleField===this.secondField||!o&&this.collapsibleField===this.firstField;o?l?(e=!r&&n||s,t=!s):(e=!s,t=s||r&&n):l?(e=!s,t=!r&&n||s):(e=s||r&&n,t=!s),this.collapseHandle.setLeftVisible(e),this.collapseHandle.setRightVisible(t),this.firstCollapseKeyStroke&&(e?this.registerKeyStrokes(this.firstCollapseKeyStroke):this.unregisterKeyStrokes(this.firstCollapseKeyStroke)),this.secondCollapseKeyStroke&&(t?this.registerKeyStrokes(this.secondCollapseKeyStroke):this.unregisterKeyStrokes(this.secondCollapseKeyStroke))}getEffectiveSplitterPosition(){return this._isMinimizable()&&this.fieldMinimized?this.minSplitterPosition:this.splitterPosition}setMinSplitterPosition(e){this.setProperty("minSplitterPosition",e),this._updateCollapseHandleButtons()}_renderMinSplitterPosition(){this.rendered&&this.htmlSplitArea.invalidateLayoutTree(!1)}setFieldMinimized(e){this.setProperty("fieldMinimized",e),this._updateCollapseHandleButtons()}_renderFieldMinimized(){this.$container.removeClass("first-field-minimized second-field-minimized"),this.firstField&&this.firstField.$container.removeClass("minimized"),this.secondField&&this.secondField.$container.removeClass("minimized"),this.collapsibleField&&this.fieldMinimized&&(this.collapsibleField.$container.addClass("minimized"),this.$container.toggleClass("first-field-minimized",this.firstField===this.collapsibleField),this.$container.toggleClass("second-field-minimized",this.secondField===this.collapsibleField)),this.rendered&&this.htmlSplitArea.invalidateLayoutTree(!1)}setMinimizeEnabled(e){this.setProperty("minimizeEnabled",e),this._isMinimizable()&&this._isSplitterPositionInMinimalRange(this.splitterPosition)&&this.setFieldMinimized(!0),this._updateCollapseHandleButtons()}_renderMinimizeEnabled(){this.rendered&&this.htmlSplitArea.invalidateLayoutTree(!1)}_isMinimizable(){return!!this.minSplitterPosition&&this.minimizeEnabled}_renderCollapsibleField(){this.$container.removeClass("first-field-collapsed second-field-collapsed"),this.firstField&&this.firstField.$container.removeClass("collapsed"),this.secondField&&this.secondField.$container.removeClass("collapsed"),this.collapsibleField&&this.fieldCollapsed&&(this.collapsibleField.$container.addClass("collapsed"),this.$container.toggleClass("first-field-collapsed",this.firstField===this.collapsibleField),this.$container.toggleClass("second-field-collapsed",this.secondField===this.collapsibleField)),this.rendered&&this.htmlSplitArea.invalidateLayoutTree(!1)}_setToggleCollapseKeyStroke(e){e&&(this.toggleCollapseKeyStroke instanceof O&&this.unregisterKeyStrokes(this.toggleCollapseKeyStroke),this.toggleCollapseKeyStroke=new np(this,e),this.collapseHandle&&this.registerKeyStrokes(this.toggleCollapseKeyStroke))}_setFirstCollapseKeyStroke(e){e&&(this.firstCollapseKeyStroke instanceof O&&this.unregisterKeyStrokes(this.firstCollapseKeyStroke),this.firstCollapseKeyStroke=new op(this,e),this.collapseHandle&&this.registerKeyStrokes(this.firstCollapseKeyStroke))}_setSecondCollapseKeyStroke(e){e&&(this.secondCollapseKeyStroke instanceof O&&this.unregisterKeyStrokes(this.secondCollapseKeyStroke),this.secondCollapseKeyStroke=new lp(this,e),this.collapseHandle&&this.registerKeyStrokes(this.secondCollapseKeyStroke))}_renderCollapseHandle(){this.collapseHandle&&this.collapseHandle.render()}newSplitterPosition(e,t){if(this._isSplitterPositionTypeRelative(this.splitterPositionType)?e=Math.max(0,Math.min(1,e)):e=Math.max(0,e),this._isMinimizable()&&this._isSplitterPositionInMinimalRange(e)){this.setFieldMinimized(!0);return}let s=this.splitterPosition!==e;this.splitterPosition=e,s&&(this.trigger("positionChange",{position:e}),t&&this._updateFieldMinimized()),this._updateCollapseHandleButtons(),this.htmlSplitArea.invalidateLayoutTree(!1)}_updateFieldMinimized(){this._isMinimizable()?this.setFieldMinimized(this._isSplitterPositionInMinimalRange(this.splitterPosition)):this.setFieldMinimized(!1)}_isSplitterPositionInMinimalRange(e){return this._isMinimizable()?e<=this.minSplitterPosition:!1}toggleFieldCollapsed(){this.setFieldCollapsed(!this.fieldCollapsed)}collapseHandleButtonPressed(e){let t=this.fieldCollapsed,s=this.fieldMinimized,r=this._isMinimizable(),n=this.splitterPositionType===ge.SPLITTER_POSITION_TYPE_RELATIVE_FIRST||this.splitterPositionType===ge.SPLITTER_POSITION_TYPE_ABSOLUTE_FIRST,o=!!e.left&&!n||!!e.right&&n;n&&this.collapsibleField===this.secondField||!n&&this.collapsibleField===this.firstField?o?t||(s&&r?this.setFieldMinimized(!1):this.setFieldCollapsed(!0)):t?this.setFieldCollapsed(!1):s||r&&this.setFieldMinimized(!0):o?t?this.setFieldCollapsed(!1):s&&this.setFieldMinimized(!1):t||(s||!r?this.setFieldCollapsed(!0):this.setFieldMinimized(!0))}getFields(){let e=[];return this.firstField&&e.push(this.firstField),this.secondField&&e.push(this.secondField),e}_updateFieldVisibilityClasses(){if(!this.rendered&&!this.rendering)return;let e=this.firstField&&this.firstField.isVisible(),t=this.secondField&&this.secondField.isVisible(),r=!(e&&t)&&(e||t);this.$container.toggleClass("single-field",r)}}it(ge,"SPLITTER_POSITION_TYPE_RELATIVE_FIRST","relativeFirst"),it(ge,"SPLITTER_POSITION_TYPE_RELATIVE_SECOND","relativeSecond"),it(ge,"SPLITTER_POSITION_TYPE_ABSOLUTE_FIRST","absoluteFirst"),it(ge,"SPLITTER_POSITION_TYPE_ABSOLUTE_SECOND","absoluteSecond");class v_ extends fo{constructor(){super(),this._addRemoteProperties(["collapsibleField","fieldCollapsed","minSplitterPosition","fieldMinimized"])}_onWidgetPositionChange(e){this._send("setSplitterPosition",{splitterPosition:e.position})}_onWidgetEvent(e){e.type==="positionChange"?this._onWidgetPositionChange(e):super._onWidgetEvent(e)}}class np extends O{constructor(e,t){super(),this.field=e,this.parseAndSetKeyStroke(t),this.inheritAccessibility=!1}handle(e){this.field.toggleFieldCollapsed()}_postRenderKeyBox(e,t){let s=this.field.collapseHandle.$container;t.addClass("split-box-collapse-key-box");let r=s.offsetTo(this.field.$container);t.cssLeft(r.left-t.outerWidth()).cssTop(r.top)}}class op extends O{constructor(e,t){super(),this.field=e,this.parseAndSetKeyStroke(t),this.inheritAccessibility=!1}handle(e){this.field.collapseHandleButtonPressed({left:!0})}_postRenderKeyBox(e,t){let s=this.field.collapseHandle.$container;t.addClass("split-box-collapse-key-box left");let r=s.offsetTo(this.field.$container);t.cssLeft(r.left-t.outerWidth()).cssTop(r.top)}}class lp extends O{constructor(e,t){super(),this.field=e,this.parseAndSetKeyStroke(t),this.inheritAccessibility=!1}handle(e){this.field.collapseHandleButtonPressed({right:!0})}_postRenderKeyBox(e,t){let s=this.field.collapseHandle.$container;t.addClass("split-box-collapse-key-box right");let r=s.offsetTo(this.field.$container);t.cssLeft(r.left+s.width()-t.outerWidth()).cssTop(r.top-t.outerHeight())}}function XD(i,e,t){return e=JD(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function JD(i){var e=QD(i,"string");return typeof e=="symbol"?e:String(e)}function QD(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ap extends ee{constructor(e){super(),XD(this,"splitBox",void 0),this.splitBox=e}layout(e){let t=T.get(e),s=e.children(".splitter"),r=e.children(".form-field"),n=T.optGet(r.eq(0)),o=T.optGet(r.eq(1)),l=this.splitBox.splitHorizontal;s.removeClass("hidden");let h,d=t.availableSize().subtract(t.insets()),c=n&&n.isVisible(),f=o&&o.isVisible(),m=c&&f,_=!m&&(c||f),C=this.splitBox.getEffectiveSplitterPosition(),S=new F(d);if(m&&(l?S.width-=n.margins().right:S.height-=n.margins().bottom),m){let L=new F(S),H=new F(S);this.computeInnerFieldsDimensions(l,L,H,C),h=new ie(0,0,L.width,L.height);let we=new ie(0,0,H.width,H.height);l?(s.cssLeft(h.width),we.x=h.width+n.margins().right):(s.cssTop(h.height),we.y=h.height+n.margins().bottom),n.setBounds(h),o.setBounds(we)}else{if(_){let L=c?n:o,H=d.subtract(L.margins());L.setBounds(new ie(0,0,H.width,H.height))}s.addClass("hidden")}let R=this.splitBox.collapseHandle;if(R){let L=R.$container,H=this.splitBox.firstField&&this.splitBox.firstField.visible&&this.splitBox.secondField&&this.splitBox.secondField.visible;L.setVisible(H);let we=null;if(m&&this.splitBox.collapsibleField===this.splitBox.firstField){let rt=v.size(L);we=h.width-rt.width}L.cssLeft(we)}}preferredLayoutSize(e,t){let s=T.get(e),r=e.children(".form-field"),n=T.optGet(r.eq(0)),o=T.optGet(r.eq(1)),l=this.splitBox.splitHorizontal,h=this.splitBox.getEffectiveSplitterPosition(),d=a().extend({},t),c=a().extend({},t);if(t.widthHint){let C=new F(t.widthHint,0),S=new F(t.widthHint,0);this.computeInnerFieldsDimensions(l,C,S,h),d.widthHint=C.width,c.widthHint=S.width}let f=new F(0,0);n&&(f=n.prefSize(d).add(n.margins()));let m=new F(0,0);o&&(m=o.prefSize(c).add(o.margins()));let _;return l?_=new F(f.width+m.width,Math.max(f.height,m.height)):_=new F(Math.max(f.width,m.width),f.height+m.height),_=_.add(s.insets()),_}computeInnerFieldsDimensions(e,t,s,r){e?this.splitBox.splitterPositionType===ge.SPLITTER_POSITION_TYPE_RELATIVE_FIRST?(t.width=Math.floor(t.width*r),s.width-=t.width):this.splitBox.splitterPositionType===ge.SPLITTER_POSITION_TYPE_RELATIVE_SECOND?(s.width=Math.floor(s.width*r),t.width-=s.width):(r=Math.min(r,t.width),this.splitBox.splitterPositionType===ge.SPLITTER_POSITION_TYPE_ABSOLUTE_SECOND?(t.width=t.width-r,s.width=r):(t.width=r,s.width=s.width-r)):this.splitBox.splitterPositionType===ge.SPLITTER_POSITION_TYPE_RELATIVE_FIRST?(t.height=Math.floor(t.height*r),s.height-=t.height):this.splitBox.splitterPositionType===ge.SPLITTER_POSITION_TYPE_RELATIVE_SECOND?(s.height=Math.floor(s.height*r),t.height-=s.height):(r=Math.min(r,t.height),this.splitBox.splitterPositionType===ge.SPLITTER_POSITION_TYPE_ABSOLUTE_SECOND?(t.height=t.height-r,s.height=r):(t.height=r,s.height=s.height-r))}}function Ht(i,e,t){return e=ZD(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ZD(i){var e=eA(i,"string");return typeof e=="symbol"?e:String(e)}function eA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ki extends fl{constructor(){super(),Ht(this,"format",void 0),Ht(this,"hasAction",void 0),Ht(this,"inputMasked",void 0),Ht(this,"inputObfuscated",void 0),Ht(this,"maxLength",void 0),Ht(this,"maxLengthHandler",void 0),Ht(this,"multilineText",void 0),Ht(this,"selectionStart",void 0),Ht(this,"selectionEnd",void 0),Ht(this,"selectionTrackingEnabled",void 0),Ht(this,"spellCheckEnabled",void 0),Ht(this,"trimText",void 0),Ht(this,"wrapText",void 0),Ht(this,"mouseClicked",void 0),Ht(this,"_onSelectionChangingActionHandler",void 0),this.format=null,this.hasAction=!1,this.inputMasked=!1,this.inputObfuscated=!1,this.maxLength=4e3,this.maxLengthHandler=u.create(Ho,{target:this}),this.multilineText=!1,this.selectionStart=0,this.selectionEnd=0,this.selectionTrackingEnabled=!1,this.spellCheckEnabled=!1,this.trimText=!0,this.wrapText=!1,this._onSelectionChangingActionHandler=this._onSelectionChangingAction.bind(this)}_initValue(e){e=Ce.resolveText(e,this.session.locale.languageTag),super._initValue(e)}_readDisplayText(){return this.$field?this.$field.val():""}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.registerKeyStrokes([new dp(this),new up(this)])}_createKeyStrokeContext(){return new As}_init(e){super._init(e),this._setMultilineText(this.multilineText)}_render(){this.addContainer(this.$parent,"string-field",new hp(this)),this.addLabel(),this.addMandatoryIndicator();let e;this.multilineText?(e=this._makeMultilineField(),this.$container.addClass("multiline")):e=Z.makeTextField(this.$parent),this.addField(e),this.maxLengthHandler.install(e),this.addStatus()}_makeMultilineField(){let e=function(){this.mouseClicked=!0}.bind(this);return this.$parent.makeElement("<textarea>").on("DOMMouseScroll mousewheel",this._onMouseWheel.bind(this)).on("mousedown",e).on("focus",t=>{this.$field.off("mousedown",e),this.mouseClicked||setTimeout(()=>{!this.rendered||this.session.focusManager.isElementCovertByGlassPane(this.$field)||(this._renderSelectionStart(),this._renderSelectionEnd())}),this.mouseClicked=!1}).on("focusout",()=>{this.$field.on("mousedown",e)}).addDeviceClass()}_onFieldBlur(e){super._onFieldBlur(e),this.multilineText&&this._updateSelection(),this.inputObfuscated&&this.$field.val(this.displayText)}_onMouseWheel(e){let t=e.originalEvent||this.$container.window(!0).event.originalEvent,s=t.wheelDelta?-t.wheelDelta:t.detail,r=this.$field[0].scrollTop;if(s<0&&r===0)return;let n=this.$field[0].scrollHeight-this.$field[0].clientHeight;if(s>0&&r>=n-1){this.$field[0].scrollTop=n;return}t.stopPropagation()}_renderProperties(){super._renderProperties(),this._renderInputMasked(),this._renderWrapText(),this._renderFormat(),this._renderSpellCheckEnabled(),this._renderHasAction(),this._renderMaxLength(),this._renderSelectionTrackingEnabled(),this._renderDropType()}addIcon(e){this.$icon=Z.appendIcon(this.$container).on("click",this._onIconClick.bind(this))}isClearable(){return super.isClearable()&&!this.multilineText}setSelectionStart(e){this.setProperty("selectionStart",e)}_renderSelectionStart(){u.nvl(this.selectionStart,null)!==null&&(this.$field[0].selectionStart=this.selectionStart)}setSelectionEnd(e){this.setProperty("selectionEnd",e)}_renderSelectionEnd(){u.nvl(this.selectionEnd,null)!==null&&(this.$field[0].selectionEnd=this.selectionEnd)}setSelectionTrackingEnabled(e){this.setProperty("selectionTrackingEnabled",e)}_renderSelectionTrackingEnabled(){this.$field.off("select",this._onSelectionChangingActionHandler).off("mousedown",this._onSelectionChangingActionHandler).off("keydown",this._onSelectionChangingActionHandler).off("input",this._onSelectionChangingActionHandler),this.selectionTrackingEnabled&&this.$field.on("select",this._onSelectionChangingActionHandler).on("mousedown",this._onSelectionChangingActionHandler).on("keydown",this._onSelectionChangingActionHandler).on("input",this._onSelectionChangingActionHandler)}setInputMasked(e){this.setProperty("inputMasked",e)}_renderInputMasked(){this.multilineText||this.$field.attr("type",this.inputMasked?"password":"text")}_renderInputObfuscated(){this.inputObfuscated&&this.focused&&this.$field.val("")}setHasAction(e){this.setProperty("hasAction",e)}_renderHasAction(){this.hasAction?(this.$icon||(this.addIcon(),this.$icon.addClass("action")),this.$container.addClass("has-icon")):(this._removeIcon(),this.$container.removeClass("has-icon")),this.revalidateLayout()}_renderEnabled(){super._renderEnabled(),this.revalidateLayout()}setFormatUpper(e){e?this.setFormat(ki.Format.UPPER):this.setFormat(null)}setFormatLower(e){e?this.setFormat(ki.Format.LOWER):this.setFormat(null)}setFormat(e){this.setProperty("format",e)}_renderFormat(){this.format===ki.Format.LOWER?this.$field.css("text-transform","lowercase"):this.format===ki.Format.UPPER?this.$field.css("text-transform","uppercase"):this.$field.css("text-transform","")}setSpellCheckEnabled(e){this.setProperty("spellCheckEnabled",e)}_renderSpellCheckEnabled(){this.spellCheckEnabled?this.$field.attr("spellcheck","true"):this.$field.attr("spellcheck","false")}_renderDisplayText(){if(this.inputObfuscated&&this.focused){this.$field.val("");return}let e=y.nvl(this.displayText),t=y.nvl(this.$field.val()),s=this._getSelection();if(super._renderDisplayText(),this.trimText&&t!==e){let r=t.match(ki.TRIM_REGEXP);r&&r[2]===e&&this._setSelection({start:Math.max(s.start-r[1].length,0),end:Math.min(s.end-r[1].length,e.length)})}}insertText(e){if(!this.rendered){this._postRenderActions.push(this.insertText.bind(this,e));return}this._insertText(e)}_insertText(e){if(!e)return;let t=this._getSelection(),s=this._applyTextToSelection(this.$field.val(),e,t);if(s.length>this.maxLength){this._showNotification("ui.CannotInsertTextTooLong");return}this.$field.val(s),this._setSelection(t.start+e.length),this.updateDisplayTextOnModify&&this.acceptInput(!0),this.acceptInput()}_applyTextToSelection(e,t,s){return this.inputObfuscated&&(e=""),e.slice(0,s.start)+t+e.slice(s.end)}setWrapText(e){this.setProperty("wrapText",e)}_renderWrapText(){this.$field.attr("wrap",this.wrapText?"soft":"off")}setTrimText(e){this.setProperty("trimText",e)}_renderTrimText(){}setMultilineText(e){this.setProperty("multilineText",e)}_setMultilineText(e){this._setProperty("multilineText",e),this.keyStrokeContext.setMultiline(this.multilineText)}_renderGridData(){super._renderGridData(),this.updateInnerAlignment({useHorizontalAlignment:!this.multilineText})}_renderGridDataHints(){super._renderGridDataHints(),this.updateInnerAlignment({useHorizontalAlignment:!0})}setMaxLength(e){this.setProperty("maxLength",e)}_renderMaxLength(){this.maxLengthHandler.render()}_onIconClick(){this.acceptInput(),this.$field.focus(),this.trigger("action")}_onSelectionChangingAction(e){e.type==="mousedown"?this.$field.window().one("mouseup.stringfield",()=>{setTimeout(this._updateSelection.bind(this))}):e.type==="keydown"?setTimeout(this._updateSelection.bind(this)):this._updateSelection()}_getSelection(){let e=u.nvl(this.$field[0].selectionStart,null),t=u.nvl(this.$field[0].selectionEnd,null);return(e===null||t===null)&&(e=0,t=0),{start:e,end:t}}_setSelection(e,t){typeof e=="number"?t=u.nvl(t,e):typeof e=="object"&&(t=e.end,e=e.start),this.$field[0].selectionStart=e,this.$field[0].selectionEnd=t,this._updateSelection()}_updateSelection(){let e=this.selectionStart,t=this.selectionEnd;this.selectionStart=this.$field[0].selectionStart,this.selectionEnd=this.$field[0].selectionEnd,this.selectionTrackingEnabled&&(this.selectionStart!==e||this.selectionEnd!==t)&&this.triggerSelectionChange()}triggerSelectionChange(){this.trigger("selectionChange",{selectionStart:this.selectionStart,selectionEnd:this.selectionEnd})}_validateValue(e){return b.isNullOrUndefined(e)?e:(e=y.asString(e),this.trimText&&(e=e.trim()),super._validateValue(e))}_clear(){super._clear(),this.inputObfuscated=!1}_updateEmpty(){this.empty=y.empty(this.value)}acceptInput(e){let t=u.nvl(this._readDisplayText(),"");this.inputObfuscated&&t!==""&&(this.inputObfuscated=!1),super.acceptInput(e)}_onFieldFocus(e){super._onFieldFocus(e),this.inputObfuscated&&(this.$field.val(""),setTimeout(()=>{if(!this.rendered)return;let t=this.$field[0];t.selectionStart=0,t.selectionEnd=0}))}_showNotification(e){u.create(ti,{parent:this,severity:E.Severity.WARNING,message:this.session.text(e)}).show()}_checkDisplayTextChanged(e,t){let s=super._checkDisplayTextChanged(e,t);return s&&this.inputObfuscated&&e===""?!1:s}}Ht(ki,"Format",{LOWER:"a",UPPER:"A"}),Ht(ki,"TRIM_REGEXP",new RegExp("^(\\s*)(.*?)(\\s*)$"));class hp extends oi{constructor(e){super(e)}_layoutClearIcon(e,t,s,r){e.$icon&&e.$icon.isVisible()&&(s+=v.prefSize(e.$icon,!0).width),super._layoutClearIcon(e,t,s,r)}}class w_ extends Ja{_initProperties(e){e.insertText!==void 0&&delete e.insertText}_syncInsertText(e){this.widget.insertText(e)}_onWidgetSelectionChange(e){this._send("selectionChange",{selectionStart:e.selectionStart,selectionEnd:e.selectionEnd},{showBusyIndicator:!1,delay:500,coalesce:function(t){return this.target===t.target&&this.type===t.type}})}_onWidgetAction(e){this._send("action")}_onWidgetEvent(e){e.type==="selectionChange"?this._onWidgetSelectionChange(e):e.type==="action"?this._onWidgetAction(e):super._onWidgetEvent(e)}}class dp extends O{constructor(e){super(),this.field=e,this.which=[g.ENTER],this.renderingHints.render=!1,this.preventDefault=!1}_applyPropagationFlags(e){super._applyPropagationFlags(e);let t=this.field.$container.activeElement(!0);this.preventInvokeAcceptInputOnActiveValueField=!e.isPropagationStopped()&&t.tagName.toLowerCase()==="textarea",this.preventInvokeAcceptInputOnActiveValueField&&e.stopPropagation()}handle(e){}}class up extends O{constructor(e){super(),this.field=e,this.which=[g.ENTER],this.ctrl=!0}_accept(e){return super._accept(e)&&this.field.hasAction}handle(e){this.field._onIconClick()}}function Rr(i,e,t){return e=tA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function tA(i){var e=iA(i,"string");return typeof e=="symbol"?e:String(e)}function iA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class yo extends Fr{constructor(){super(),Rr(this,"selectedTab",void 0),Rr(this,"header",void 0),Rr(this,"tabItems",void 0),Rr(this,"tabAreaStyle",void 0),Rr(this,"_$tabContent",void 0),Rr(this,"_statusPositionOrig",void 0),Rr(this,"_tabBoxHeaderPropertyChangeHandler",void 0),this.gridDataHints.useUiHeight=!0,this.gridDataHints.w=A.FULL_WIDTH,this.header=null,this.selectedTab=null,this.tabItems=[],this.tabAreaStyle=_s.DisplayStyle.DEFAULT,this._$tabContent=null,this._statusPositionOrig=null,this._addWidgetProperties(["tabItems","selectedTab"]),this._addPreserveOnPropertyChangeProperties(["selectedTab"]),this._tabBoxHeaderPropertyChangeHandler=this._onTabBoxHeaderPropertyChange.bind(this)}_init(e){super._init(e),this.header=u.create(gp,{parent:this,tabBox:this}),this._initProperties(e),this.header.on("propertyChange",this._tabBoxHeaderPropertyChangeHandler)}_initProperties(e){this._setTabItems(this.tabItems),this._setSelectedTab(this.selectedTab),this._setTabAreaStyle(this.tabAreaStyle)}_destroy(){super._destroy(),this.header.off("propertyChange",this._tabBoxHeaderPropertyChangeHandler)}_render(){this.addContainer(this.$parent,"tab-box",new vp(this)),this.header.render(this.$container),this.addStatus(),this._$tabContent=this.$container.appendDiv("tab-content"),T.install(this._$tabContent,this.session).setLayout(new Es)}_renderProperties(){super._renderProperties(),this._renderSelectedTab()}_remove(){super._remove(),this._removeSelectedTab()}getContextMenuItems(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return[]}_removeMenus(){}deleteTabItem(e){let t=this.tabItems.indexOf(e),s=this.tabItems.slice();t>=0&&(s.splice(t,1),this.setTabItems(s))}insertTabItem(e,t){if(!e)return;t=u.nvl(t,this.tabItems.length);let s=this.tabItems.slice();s.splice(t,0,e),this.setTabItems(s)}setTabItems(e){this.setProperty("tabItems",e)}_setTabItems(e){e=e||[],(this.tabItems||[]).filter(s=>e.indexOf(s)<0).forEach(s=>{s.remove()}),this._setProperty("tabItems",e),this.header.setTabItems(this.tabItems),this.tabItems.indexOf(this.selectedTab)<0&&this.setSelectedTab(this.tabItems[0])}_renderTabItems(e){}_removeTabItems(e){}_removeTabContent(){this.tabItems.forEach(e=>{e.remove()})}selectTabById(e){let t=this.getTabItem(e);if(!t)throw new Error("Tab with ID '"+e+"' does not exist");this.setSelectedTab(t)}setSelectedTab(e){this.setProperty("selectedTab",e)}_setSelectedTab(e){a().log.isDebugEnabled()&&a().log.debug("(TabBox#_selectTab) tab="+e),this.selectedTab&&this.selectedTab.rendered&&this.selectedTab.remove(),this._setProperty("selectedTab",e),this.header.setSelectedTabItem(this.selectedTab)}_renderSelectedTab(){this.selectedTab&&(this.selectedTab.render(this._$tabContent),this.selectedTab.get$Scrollable().data("scroll-shadow-customizer",this._updateScrollShadow.bind(this))),this.rendered&&(this._updateScrollShadow(),T.get(this._$tabContent).invalidateLayoutTree())}_removeSelectedTab(){this.selectedTab&&(this.selectedTab.get$Scrollable().removeData("scroll-shadow-customizer"),this.selectedTab.remove())}_updateScrollShadow(){if(!this.rendered)return;let e=this.selectedTab&&this.selectedTab.hasScrollShadow("top"),t=this.$container.hasClass("has-scroll-shadow-top");this.$container.toggleClass("has-scroll-shadow-top",e),t!==e&&this.invalidateLayoutTree(!1),Z.adjustStatusPositionForScrollShadow(this,()=>e&&this.labelVisible)}setTabAreaStyle(e){this.setProperty("tabAreaStyle",e)}_setTabAreaStyle(e){this.tabAreaStyle=e,this.header&&this.header.tabArea&&this.header.tabArea.setDisplayStyle(e)}_renderStatusPosition(){super._renderStatusPosition(),this.fieldStatus&&(this.statusPosition===A.StatusPosition.TOP?this.$status.appendTo(this.header.$container):this.$status.appendTo(this.$container),this.invalidateLayoutTree())}_updateFieldStatus(){super._updateFieldStatus(),this.selectedTab&&this.selectedTab.notification&&this.selectedTab.invalidateLayoutTree()}_renderLabelVisible(){super._renderLabelVisible(),this._updateScrollShadow()}getFields(){return this.tabItems}getTabItem(e){return p.find(this.tabItems,t=>t.id===e)}focus(){if(!this.rendered)return this.session.layoutValidator.schedulePostValidateFunction(this.focus.bind(this)),!1;if(this.selectedTab)return this.selectedTab.focus()}getFocusableElement(){return this.selectedTab?this.selectedTab.getFocusableElement():null}isTabItemFocused(e){return this.header.isTabItemFocused(e)}focusTabItem(e){return this.header.focusTabItem(e)}getTabForItem(e){return this.header.getTabForItem(e)}_onTabBoxHeaderPropertyChange(e){e.propertyName==="selectedTabItem"&&this.setSelectedTab(e.newValue)}}Rr(yo,"MenuTypes",{Header:"TabBox.Header"});class cp extends O{constructor(e){super(),this.field=e,this.which=[g.LEFT],this.renderingHints.render=!1,this.stopPropagation=!0,this.keyStrokeMode=O.Mode.DOWN,this.inheritAccessibility=!1}handle(e){this.field.selectPreviousTab(!0),this.field.selectedTab.$container.addClass("keyboard-navigation")}}class pp extends O{constructor(e){super(),this.field=e,this.which=[g.RIGHT],this.renderingHints.render=!1,this.stopPropagation=!0,this.keyStrokeMode=O.Mode.DOWN,this.inheritAccessibility=!1}handle(e){this.field.selectNextTab(!0),this.field.selectedTab.$container.addClass("keyboard-navigation")}}class T_ extends fo{constructor(){super(),this._addRemoteProperties(["selectedTab"])}exportAdapterData(e){return e=super.exportAdapterData(e),delete e.selectedTab,e}}function fp(i,e,t){return e=sA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function sA(i){var e=rA(i,"string");return typeof e=="symbol"?e:String(e)}function rA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class mp extends ee{constructor(e){super(),fp(this,"tabBoxHeader",void 0),fp(this,"htmlPropertyChangeHandler",void 0),fp(this,"fieldStatusWidth",void 0),this.tabBoxHeader=e,this.fieldStatusWidth=null,this._initDefaults(),this.htmlPropertyChangeHandler=this._onHtmlEnvironmentPropertyChange.bind(this),de.get().on("propertyChange",this.htmlPropertyChangeHandler),this.tabBoxHeader.one("remove",()=>{de.get().off("propertyChange",this.htmlPropertyChangeHandler)})}_initDefaults(){this.fieldStatusWidth=de.get().fieldStatusWidth}_onHtmlEnvironmentPropertyChange(){this._initDefaults(),this.tabBoxHeader.invalidateLayoutTree()}layout(e){let t=T.get(e),s=this.tabBoxHeader.tabArea,r=s.htmlComp.margins(),n,o=this.tabBoxHeader.menuBar,l=o.htmlComp.margins(),h,d=this.tabBoxHeader.tabBox.$status,c=new F,f=t.insets(),m=t.availableSize({exact:!0}).subtract(t.insets());h=o.htmlComp.prefSize({widthHint:0}),this.tabBoxHeader.tabBox.statusPosition===A.StatusPosition.TOP&&d&&d.isVisible()&&(c.height=d.outerHeight(!0),c.width=this.fieldStatusWidth+v.margins(d).horizontal()),n=s.htmlComp.prefSize({widthHint:m.width-h.width-l.horizontal()-c.width,exact:!1}),s.htmlComp.setSize(new F(n.width,m.height-r.vertical())),o.htmlComp.layout.collapsed=s.htmlComp.layout.overflowTabs.length>0,o.htmlComp.setBounds(new ie(f.left+n.width+r.horizontal(),f.top,m.width-n.width-r.horizontal()-l.horizontal()-c.width,m.height-l.vertical())),this.tabBoxHeader.tabBox.statusPosition===A.StatusPosition.TOP&&d&&d.isVisible()&&d.cssWidth(this.fieldStatusWidth).cssRight(f.right).cssHeight(m.height-v.margins(d).vertical())}preferredLayoutSize(e,t){let s=T.get(e),r=s.insets(),n=(t.widthHint||s.availableSize().width)-s.insets().horizontal(),o=new F,l=this.tabBoxHeader.tabBox.$status,h=new F,d=this.tabBoxHeader.tabArea,c=d.htmlComp.margins(),f=this.tabBoxHeader.menuBar,m=f.htmlComp.margins(),_=f.htmlComp.prefSize({widthHint:0});this.tabBoxHeader.tabBox.statusPosition===A.StatusPosition.TOP&&l&&l.isVisible()&&(h.height=l.outerHeight(!0),h.width=this.fieldStatusWidth+v.margins(l).horizontal(),o.width+=h.width,o.height=Math.max(o.height,h.height));let C=d.htmlComp.prefSize({widthHint:n-_.width-m.horizontal()-c.horizontal()-h.width});o.width+=C.width+c.horizontal(),o.height=Math.max(o.height,C.height+c.vertical());let S=f.htmlComp.prefSize({widthHint:n-C.width-c.horizontal()-m.horizontal()-h.width});return o.width+=S.width+m.horizontal(),o.height=Math.max(o.height,S.height+m.vertical()),o.add(r)}}function bo(i,e,t){return e=nA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function nA(i){var e=oA(i,"string");return typeof e=="symbol"?e:String(e)}function oA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class gp extends I{constructor(){super(),bo(this,"tabBox",void 0),bo(this,"tabArea",void 0),bo(this,"menuBar",void 0),bo(this,"$borderBottom",void 0),bo(this,"_tabBoxPropertyChangeHandler",void 0),bo(this,"_tabAreaPropertyChangeHandler",void 0),this.tabBox=null,this.tabArea=null,this.menuBar=null,this.$borderBottom=null,this._tabBoxPropertyChangeHandler=this._onTabBoxPropertyChange.bind(this),this._tabAreaPropertyChangeHandler=this._onTabAreaPropertyChange.bind(this)}_init(e){super._init(e),this.tabArea=u.create(_s,{parent:this,tabBox:this.tabBox}),this.tabArea.on("propertyChange",this._tabAreaPropertyChangeHandler),this.menuBar=u.create(ce,{parent:this,menuOrder:new nr}),this.tabBox.on("propertyChange",this._tabBoxPropertyChangeHandler),this.menuBar.setMenuItems(this.tabBox.menus),this.setVisible(this.tabBox.labelVisible)}_render(){this.$container=this.$parent.appendDiv("tab-box-header"),this.$borderBottom=this.$container.appendDiv("bottom-border"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new mp(this)),this.tabArea.render(this.$container),this.menuBar.render(this.$container),this.$container.append(this.menuBar.$container)}_destroy(){this.tabBox.off("propertyChange",this._tabBoxPropertyChangeHandler),this.tabArea.off("propertyChange",this._tabAreaPropertyChangeHandler),super._destroy()}setTabItems(e){this.tabArea.setTabItems(e)}_setSelectedTab(e){e?this.setSelectedTabItem(e.tabItem):this.setSelectedTabItem(null)}setSelectedTabItem(e){this.setProperty("selectedTabItem",e)}_setSelectedTabItem(e){this._setProperty("selectedTabItem",e),this.tabArea.setSelectedTabItem(e)}isTabItemFocused(e){return this.tabArea.isTabItemFocused(e)}focusTabItem(e){return this.tabArea.focusTabItem(e)}getTabForItem(e){return this.tabArea.getTabForItem(e)}_onTabBoxPropertyChange(e){e.propertyName==="menus"?this.menuBar.setMenuItems(this.tabBox.menus):e.propertyName==="labelVisible"&&this.setVisible(this.tabBox.labelVisible)}_onTabAreaPropertyChange(e){e.propertyName==="selectedTab"&&this._setSelectedTab(e.newValue)}}function Nt(i,e,t){return e=lA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function lA(i){var e=aA(i,"string");return typeof e=="symbol"?e:String(e)}function aA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ch extends I{constructor(){super(),Nt(this,"label",void 0),Nt(this,"subLabel",void 0),Nt(this,"selected",void 0),Nt(this,"overflown",void 0),Nt(this,"marked",void 0),Nt(this,"errorStatus",void 0),Nt(this,"tooltipText",void 0),Nt(this,"fieldStatus",void 0),Nt(this,"tabItem",void 0),Nt(this,"tabbable",void 0),Nt(this,"$title",void 0),Nt(this,"$label",void 0),Nt(this,"$subLabel",void 0),Nt(this,"_preventTabSelection",void 0),Nt(this,"_tabPropertyChangeHandler",void 0),Nt(this,"_statusMouseDownHandler",void 0),Nt(this,"_desktopPropertyChangeHandler",void 0),this.label=null,this.subLabel=null,this.selected=!1,this.overflown=!1,this.marked=!1,this.errorStatus=null,this.tooltipText=null,this.fieldStatus=null,this.tabItem=null,this.tabbable=!1,this.$label=null,this.$subLabel=null,this.$title=null,this._preventTabSelection=!1,this._tabPropertyChangeHandler=this._onTabPropertyChange.bind(this),this._statusMouseDownHandler=this._onStatusMouseDown.bind(this),this._desktopPropertyChangeHandler=this._onDesktopPropertyChange.bind(this)}_init(e){super._init(e),this.visible=this.tabItem.visible,this.label=this.tabItem.label,this.subLabel=this.tabItem.subLabel,this.cssClass=this.tabItem.cssClass,this.marked=this.tabItem.marked,this.errorStatus=this.tabItem.errorStatus,this.tooltipText=this.tabItem.tooltipText,this.fieldStatus=u.create(ja,{parent:this,visible:!1}),this.fieldStatus.on("statusMouseDown",this._statusMouseDownHandler),this.tabItem.on("propertyChange",this._tabPropertyChangeHandler)}_destroy(){super._destroy(),this.tabItem.off("propertyChange",this._tabPropertyChangeHandler),this.fieldStatus.off("statusMouseDown",this._statusMouseDownHandler)}_render(){this.$container=this.$parent.appendDiv("tab-item"),this.htmlComp=T.install(this.$container,this.session),this.$title=this.$container.appendDiv("title"),this.$label=this.$title.appendDiv("label"),K.installForEllipsis(this.$label,{parent:this}),this.$subLabel=this.$title.appendDiv("sub-label"),K.installForEllipsis(this.$subLabel,{parent:this}),this.fieldStatus.render(),this.fieldStatus.$container.cssWidth(de.get().fieldStatusWidth),this.$container.on("mousedown",this._onTabMouseDown.bind(this)),this.session.desktop.on("propertyChange",this._desktopPropertyChangeHandler)}_remove(){this.session.desktop.off("propertyChange",this._desktopPropertyChangeHandler),super._remove()}_renderProperties(){super._renderProperties(),this._renderVisible(),this._renderLabel(),this._renderSubLabel(),this._renderTabbable(),this._renderSelected(),this._renderMarked(),this._renderOverflown(),this._renderTooltipText(),this._renderErrorStatus()}_renderVisible(){super._renderVisible(),this._updateStatus()}setLabel(e){this.setProperty("label",e)}_renderLabel(){this.$label.textOrNbsp(this.label),this.$label.attr("data-text",this.label),this.invalidateLayoutTree()}setSubLabel(e){this.setProperty("subLabel",e)}_renderSubLabel(){this.$subLabel.textOrNbsp(this.subLabel),this.invalidateLayoutTree()}setTooltipText(e){this.setProperty("tooltipText",e)}_renderTooltipText(){this.$container.toggleClass("has-tooltip",y.hasText(this.tooltipText)),this._updateStatus()}setErrorStatus(e){this.setProperty("errorStatus",e)}_renderErrorStatus(){let e=!!this.errorStatus,t=e?"has-"+this.errorStatus.cssClass():"";this._updateErrorStatusClasses(t),this._updateStatus()}_updateErrorStatusClasses(e){this.$container.removeClass(A.SEVERITY_CSS_CLASSES),e&&this.$container.addClass(e)}_updateStatus(){let e=this._computeVisible(),t=null,s=!0,r=!1;this.fieldStatus.setVisible(e),e&&(this.errorStatus?(t=this.errorStatus,s=!t.isError(),r=!0):t=u.create(E,{message:this.tooltipText,severity:E.Severity.INFO}),this.fieldStatus.update(t,null,s,r))}_computeVisible(){return this.visible&&!this.overflown&&(!!this.errorStatus||y.hasText(this.tooltipText))}setTabbable(e){this.setProperty("tabbable",e)}_renderTabbable(){this.$container.setTabbable(this.tabbable&&!x.get().supportsOnlyTouch())}select(){this.setSelected(!0)}setSelected(e){this.setProperty("selected",e)}_renderSelected(){this.$container.select(this.selected),this.$container.setTabbable(this.selected&&!x.get().supportsOnlyTouch())}setMarked(e){this.setProperty("marked",e)}_renderMarked(){this.$container.toggleClass("marked",this.marked)}setOverflown(e){this.setProperty("overflown",e)}_renderOverflown(){this.$container.toggleClass("overflown",this.overflown),this._updateStatus()}_onDesktopPropertyChange(e){e.propertyName==="dense"&&this.invalidateLayout()}_onTabMouseDown(e){if(this._preventTabSelection){this._preventTabSelection=!1;return}this.setTabbable(!0),this.$container.focus(),this.select(),this.$label&&(K.cancel(this.$label),K.close(this.$label)),this.$subLabel&&(K.cancel(this.$subLabel),K.close(this.$subLabel))}_onStatusMouseDown(e){this._preventTabSelection=!0,e.preventDefault()}_onTabPropertyChange(e){e.propertyName==="visible"?this.setVisible(e.newValue):e.propertyName==="label"?this.setLabel(this.tabItem.label):e.propertyName==="subLabel"?this.setSubLabel(this.tabItem.subLabel):e.propertyName==="cssClass"?this.setCssClass(this.tabItem.cssClass):e.propertyName==="marked"?this.setMarked(this.tabItem.marked):e.propertyName==="errorStatus"?this.setErrorStatus(e.newValue):e.propertyName==="tooltipText"&&this.setTooltipText(e.newValue)}}function Gs(i,e,t){return e=hA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function hA(i){var e=dA(i,"string");return typeof e=="symbol"?e:String(e)}function dA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class _s extends I{constructor(){super(),Gs(this,"tabBox",void 0),Gs(this,"tabs",void 0),Gs(this,"displayStyle",void 0),Gs(this,"hasSubLabel",void 0),Gs(this,"selectedTab",void 0),Gs(this,"ellipsis",void 0),Gs(this,"$selectionMarker",void 0),Gs(this,"_tabItemPropertyChangeHandler",void 0),Gs(this,"_tabPropertyChangeHandler",void 0),this.tabBox=null,this.tabs=[],this.displayStyle=_s.DisplayStyle.DEFAULT,this.hasSubLabel=!1,this.selectedTab=null,this._tabItemPropertyChangeHandler=this._onTabItemPropertyChange.bind(this),this._tabPropertyChangeHandler=this._onTabPropertyChange.bind(this),this.ellipsis=null,this.$selectionMarker=null}_init(e){super._init(e),this.tabBox=e.tabBox,this.ellipsis=u.create(tl,{parent:this,cssClass:"overflow-tab-item unfocusable",iconId:null,inheritAccessibility:!1,text:"0"})}_createKeyStrokeContext(){return new Oe}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.registerKeyStrokes([new cp(this),new pp(this)])}_render(){this.$container=this.$parent.appendDiv("tab-area"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new _p(this)),this.ellipsis.render(this.$container),this.$selectionMarker=this.$container.appendDiv("selection-marker")}_renderProperties(){super._renderProperties(),this._renderTabs(),this._renderSelectedTab(),this._renderHasSubLabel(),this._renderDisplayStyle()}_remove(){super._remove(),this._removeTabs()}setSelectedTabItem(e){this.setSelectedTab(this.getTabForItem(e))}getTabForItem(e){return p.find(this.tabs,t=>t.tabItem===e)}setSelectedTab(e){this.setProperty("selectedTab",e)}_setSelectedTab(e){this.selectedTab&&this.selectedTab.setSelected(!1),e&&e.setSelected(!0),this._setProperty("selectedTab",e),this._setTabbableItem(e)}_renderSelectedTab(){this.selectedTab&&this.selectedTab.overflown&&this.invalidateLayoutTree()}isTabItemFocused(e){return this.getTabForItem(e).isFocused()}focusTabItem(e){return this.focusTab(this.getTabForItem(e))}focusTab(e){return e.focus()}setTabItems(e){this.setProperty("tabs",e),this._updateHasSubLabel(),this.invalidateLayoutTree()}_setTabs(e){let t=this.tabs.slice(),s=e.map(r=>{let n=this.getTabForItem(r);return n?p.remove(t,n):(n=u.create(ch,{parent:this,tabItem:r}),r.on("propertyChange",this._tabItemPropertyChangeHandler),n.on("propertyChange",this._tabPropertyChangeHandler)),n});t.forEach(r=>{r.tabItem.off("propertyChange",this._tabItemPropertyChangeHandler)}),this._removeTabs(t),this._setProperty("tabs",s)}_renderTabs(){this.tabs.slice().reverse().forEach((e,t,s)=>{e.rendered||e.render(),e.$container.on("blur",this._onTabItemBlur.bind(this)).on("focus",this._onTabItemFocus.bind(this)),e.$container.prependTo(this.$container),e.$container.on("blur",this._onTabItemBlur.bind(this)).on("focus",this._onTabItemFocus.bind(this))})}_removeTabs(e){e=e||this.tabs,e.forEach(t=>{t.remove()})}setDisplayStyle(e){this.setProperty("displayStyle",e)}_renderDisplayStyle(){this.$container.toggleClass("spread-even",this.displayStyle===_s.DisplayStyle.SPREAD_EVEN),this.invalidateLayoutTree()}_onTabItemFocus(){this.setFocused(!0)}_onTabItemBlur(){this.setFocused(!1)}_updateHasSubLabel(){let e=this.visibleTabs();this._setHasSubLabel(e.some(t=>y.hasText(t.subLabel)))}visibleTabs(){return this.tabs.filter(e=>e.isVisible())}_setHasSubLabel(e){this.hasSubLabel!==e&&(this._setProperty("hasSubLabel",e),this.rendered&&this._renderHasSubLabel())}_renderHasSubLabel(){this.$container.toggleClass("has-sub-label",this.hasSubLabel),this.visibleTabs().forEach(e=>e.invalidateLayout()),this.invalidateLayoutTree()}selectNextTab(e){this._moveSelectionHorizontal(!0,e)}selectPreviousTab(e){this._moveSelectionHorizontal(!1,e)}_moveSelectionHorizontal(e,t){let s=this.tabs.slice(),r=this.$container.activeElement(),n=!1;e||(s.reverse(),n=r[0]===this.ellipsis.$container[0]),s.forEach(function(o,l){if(n&&o.visible&&!o.overflown){this.setSelectedTab(o),this._setTabbableItem(o),t&&o.focus(),n=!1;return}r[0]===o.$container[0]&&(n=!0)},this),e&&n&&this.ellipsis.isTabTarget()&&(this._setTabbableItem(this.ellipsis),t&&this.ellipsis.focus())}_setTabbableItem(e){let t=this.tabs;e&&(this.ellipsis.setTabbable(!1),t.forEach(s=>{s.setTabbable(!1)}),e.setTabbable(!0))}_onTabPropertyChange(e){e.propertyName==="selected"&&this.setSelectedTab(e.source)}_onTabItemPropertyChange(e){e.propertyName==="visible"&&(this._updateHasSubLabel(),this.invalidateLayoutTree()),e.propertyName==="subLabel"&&this._updateHasSubLabel()}}Gs(_s,"DisplayStyle",{DEFAULT:"default",SPREAD_EVEN:"spreadEven"});function Cl(i,e,t){return e=uA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function uA(i){var e=cA(i,"string");return typeof e=="symbol"?e:String(e)}function cA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class _p extends ee{constructor(e){super(),Cl(this,"tabArea",void 0),Cl(this,"overflowTabs",void 0),Cl(this,"visibleTabs",void 0),Cl(this,"_tabAreaPropertyChangeHandler",void 0),this.tabArea=e,this.overflowTabs=[],this.visibleTabs=[],this._tabAreaPropertyChangeHandler=this._onTabAreaPropertyChange.bind(this),this.tabArea.on("propertyChange",this._tabAreaPropertyChangeHandler),this.tabArea.one("remove",()=>{this.tabArea.off("propertyChange",this._tabAreaPropertyChangeHandler)})}layout(e){let t=T.get(e),s=t.availableSize().subtract(t.insets());this.preferredLayoutSize(e,{widthHint:s.width}),this._layoutSelectionMarker()}_layoutSelectionMarker(){let e=this.tabArea.$selectionMarker,t=this.tabArea.selectedTab,s;t?(e.setVisible(!0),s=v.bounds(t.$container),e.cssLeft(s.x),e.cssWidth(s.width)):e.setVisible(!1)}_updateEllipsis(){let e=this.tabArea.ellipsis;e.setHidden(this.overflowTabs.length<1),e.setText(this.overflowTabs.length+""),this.visibleTabs.forEach(t=>t.setOverflown(!1)),this.overflowTabs.forEach(t=>t.setOverflown(!0)),e.childActions.forEach(t=>t.destroy()),e.setChildActions(this.overflowTabs.map(t=>{let s=u.create(yp,{parent:e,tab:t,text:t.label,visible:t.visible});return s.on("action",r=>{a().log.isDebugEnabled()&&a().log.debug("(TabAreaLayout#_onClickEllipsis) tab="+t),e.popup.close(),t.select(),t.focus()}),s}))}preferredLayoutSize(e,t){let s=T.get(e),r=new F(0,0),n=Number.MAX_VALUE;this.visibleTabs=this.tabArea.visibleTabs();let o=this.visibleTabs.map((l,h)=>l.selected?-1:h).filter(l=>l>=0);if(this.overflowTabs=[],(t.widthHint===0||t.widthHint)&&(n=t.widthHint-s.insets().horizontal()),n<=0)return this._minSize(this.visibleTabs).add(s.insets());for(this._setFirstLastMarker(this.visibleTabs),this._updateEllipsis(),r=this._prefSize(this.visibleTabs);r.width>n&&o.length>0;){let l=o.splice(-1)[0];this.overflowTabs.splice(0,0,this.visibleTabs[l]),this.visibleTabs.splice(l,1),this._setFirstLastMarker(this.visibleTabs),this._updateEllipsis(),r=this._prefSize(this.visibleTabs)}return this.tabArea.displayStyle===_s.DisplayStyle.SPREAD_EVEN?v.prefSize(e,t):v.exactPrefSize(r.add(s.insets()),t)}_minSize(e){let t=[];return this.overflowTabs=e.filter(s=>s.selected?(t.push(s),!1):!0),this.visibleTabs=t,this._setFirstLastMarker(t),this._prefSize(t)}_prefSize(e,t){let s=e.map(r=>this._tabSize(r)).reduce((r,n)=>(r.height=Math.max(r.height,n.height),r.width+=n.width,r),new F(0,0));if(t=u.nvl(t,this.overflowTabs.length>0),t){let r=this._tabSize(this.tabArea.ellipsis);s.height=Math.max(s.height,r.height),s.width+=r.width}return s}_setFirstLastMarker(e,t){t=u.nvl(t,this.overflowTabs.length>0),this.tabArea.tabs.forEach(s=>{s.htmlComp.$comp.removeClass("first last")}),this.tabArea.ellipsis.$container.removeClass("first last"),e.length>0&&(e[0].$container.addClass("first"),t?this.tabArea.ellipsis.$container.addClass("last"):e[e.length-1].$container.addClass("last"))}_tabSize(e){let t=e.htmlComp,s,r=t.$comp.attr("class");if(this.tabArea.displayStyle===_s.DisplayStyle.SPREAD_EVEN&&this.tabArea.$container.removeClass("spread-even"),t.$comp.removeClass("overflown"),t.$comp.removeClass("hidden"),s=t.prefSize({exact:!0}).add(v.margins(t.$comp)),e instanceof ch&&e.fieldStatus&&e.fieldStatus.htmlComp){let n=e.overflown&&!e.fieldStatus.visible;n&&e.fieldStatus.setVisible(!0);let o=e.fieldStatus.htmlComp.prefSize({includeMargin:!0}).width;n&&e.fieldStatus.setVisible(!1),s.width+=o}return t.$comp.attrOrRemove("class",r),this.tabArea.displayStyle===_s.DisplayStyle.SPREAD_EVEN&&this.tabArea.$container.addClass("spread-even"),s}_onTabAreaPropertyChange(e){e.propertyName==="selectedTab"&&this._layoutSelectionMarker()}}class yp extends ne{constructor(){super(...arguments),Cl(this,"tab",void 0)}}function bp(i,e,t){return e=pA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function pA(i){var e=fA(i,"string");return typeof e=="symbol"?e:String(e)}function fA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class vp extends ee{constructor(e){super(),bp(this,"htmlPropertyChangeHandler",void 0),bp(this,"_tabBox",void 0),bp(this,"_statusWidth",void 0),this._tabBox=e,this._statusWidth=null,this._initDefaults(),this.htmlPropertyChangeHandler=this._onHtmlEnvironmentPropertyChange.bind(this),de.get().on("propertyChange",this.htmlPropertyChangeHandler),this._tabBox.one("remove",()=>{de.get().off("propertyChange",this.htmlPropertyChangeHandler)})}_initDefaults(){this._statusWidth=de.get().fieldStatusWidth}_onHtmlEnvironmentPropertyChange(){this._initDefaults(),this._tabBox.invalidateLayoutTree()}layout(e){let t,s,r,n,o=T.get(e),l=T.get(this._tabBox._$tabContent),h=T.get(this._tabBox.header.$container),d=0,c=new F,f=this._tabBox.tooltip(),m=this._tabBox.$status,_=this._tabBox.statusPosition;t=o.availableSize().subtract(o.insets()),h.isVisible()&&(r=h.margins(),d=t.subtract(r).width,m&&m.isVisible()&&(this._layoutStatus(),_===A.StatusPosition.DEFAULT&&(d-=this._statusWidth+v.margins(m).horizontal())),n=h.prefSize({widthHint:d}),m&&m.isVisible()&&this._layoutStatus(n.height),n.width=d,h.setSize(n),c=n.add(r)),s=t.subtract(l.margins()),s.height-=c.height,l.setSize(s),f&&f.rendered&&f.position()}_layoutStatus(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=this._tabBox.htmlComp,s=t.insets({includeBorder:!1}),r=s.top,n=s.right,o=this._tabBox.header.$container,l=this._tabBox.$status,h=v.margins(l),d=r,c=this._tabBox.statusPosition,f=e-h.vertical();c===A.StatusPosition.DEFAULT?d+=o.cssMarginTop():f-=l.cssBorderWidthY(),l.cssWidth(this._statusWidth).cssTop(d).cssRight(n).cssHeight(f)}preferredLayoutSize(e,t){t=t||{};let s=T.get(e),r=T.get(this._tabBox._$tabContent),n=T.get(this._tabBox.header.$container),o=new F,l=new F,h=this._tabBox.$status,d=this._tabBox.statusPosition,c=s.availableSize().subtract(s.insets()).width;return t.heightHint=null,n.isVisible()&&(h&&h.isVisible()&&d===A.StatusPosition.DEFAULT&&(c-=h.outerWidth(!0)),o=n.prefSize({widthHint:c}).add(n.margins())),l=r.prefSize(t).add(s.insets()).add(r.margins()),new F(Math.max(o.width,l.width),l.height+o.height)}}function C_(i,e,t){return e=mA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function mA(i){var e=gA(i,"string");return typeof e=="symbol"?e:String(e)}function gA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class wp extends xe{constructor(){super(),C_(this,"selectionKeystroke",void 0),C_(this,"marked",void 0),this.selectionKeystroke=null,this.marked=!1}_createLayout(){return new Tp(this)}_computeTitleVisible(e){return!1}addStatus(){}_computeStatusVisible(){return!1}setMarked(e){this.setProperty("marked",e)}getContextMenuItems(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return[]}focus(){return this.select(),this.parent.focusTabItem(this)}isFocused(){return this.parent.isTabItemFocused(this)}select(){this.parent.selectedTab!==this&&this.parent.setSelectedTab(this)}getTab(){return this.parent.getTabForItem(this)}}class S_ extends Ac{}class Tp extends ih{constructor(e){super(e)}_$status(){return this.groupBox.parent.$status}_layoutStatus(){}_menuBarSize(e,t,s){let r=er.size(e,t),n=this.groupBox.parent;return r.width=n.header.$container.outerWidth(),r}_headerHeight(){return 0}}function Mr(i,e,t){return e=_A(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function _A(i){var e=yA(i,"string");return typeof e=="symbol"?e:String(e)}function yA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Fn extends A{constructor(){super(),Mr(this,"table",void 0),Mr(this,"eventDelegator",void 0),Mr(this,"_tableChangedHandler",void 0),Mr(this,"_deletedRows",void 0),Mr(this,"_insertedRows",void 0),Mr(this,"_updatedRows",void 0),Mr(this,"_checkedRows",void 0),this.gridDataHints.weightY=1,this.gridDataHints.h=3,this.eventDelegator=null,this._tableChangedHandler=this._onTableChanged.bind(this),this._deletedRows=b.createMap(),this._insertedRows=b.createMap(),this._updatedRows=b.createMap(),this._checkedRows=b.createMap(),this.table=null,this._addWidgetProperties(["table"])}_init(e){super._init(e),this._setTable(this.table)}_render(){this.addContainer(this.$parent,"table-field"),this.addLabel(),this.addMandatoryIndicator(),this.addStatus(),this._renderTable()}setTable(e){this.setProperty("table",e)}_setTable(e){this.table&&(this.table.off(Fn.TABLE_CHANGE_EVENTS,this._tableChangedHandler),this.eventDelegator&&(this.eventDelegator.destroy(),this.eventDelegator=null)),this._setProperty("table",e),e&&(e.on(Fn.TABLE_CHANGE_EVENTS,this._tableChangedHandler),this.eventDelegator=is.create(this,e,{delegateProperties:["enabled","disabledStyle","loading"]}),e.setDisabledStyle(this.disabledStyle),e.setLoading(this.loading),e.setScrollTop(this.scrollTop))}_renderTable(){!this.table||(this.table.render(),this.addField(this.table.$container),this.$field.addDeviceClass(),this.invalidateLayoutTree())}_removeTable(){!this.table||(this.table.remove(),this._removeField(),this.invalidateLayoutTree())}computeRequiresSave(){return Object.keys(this._deletedRows).length>0||Object.keys(this._insertedRows).length>0||Object.keys(this._updatedRows).length>0||Object.keys(this._checkedRows).length>0}_onTableChanged(e){u.isOneOf(e.type,"rowsDeleted","allRowsDeleted")?this._updateDeletedRows(e.rows):e.type==="rowsInserted"?this._updateInsertedRows(e.rows):e.type==="rowsUpdated"?this._updateUpdatedRows(e.rows):e.type==="rowsChecked"&&this._updateCheckedRows(e.rows)}_updateDeletedRows(e){e.forEach(function(t){if(t.id in this._insertedRows){delete this._insertedRows[t.id],delete this._updatedRows[t.id],delete this._checkedRows[t.id];return}this._deletedRows[t.id]=t},this)}_updateInsertedRows(e){e.forEach(function(t){this._insertedRows[t.id]=t},this)}_updateUpdatedRows(e){e.forEach(function(t){t.status!==Xt.Status.NON_CHANGED&&(this._updatedRows[t.id]=t)},this)}_updateCheckedRows(e){e.forEach(function(t){t.id in this._checkedRows?delete this._checkedRows[t.id]:this._checkedRows[t.id]=t},this)}markAsSaved(){super.markAsSaved(),this._deletedRows=b.createMap(),this._insertedRows=b.createMap(),this._updatedRows=b.createMap(),this._checkedRows=b.createMap(),this.table.markRowsAsNonChanged()}getValidationResult(){let e=super.getValidationResult();if(e&&!e.valid)return e;let t=!this.errorStatus,s=!this.mandatory||!this.empty,r=p.ensure(this.table.rows),n=p.ensure(this.table.columns),o=()=>{},l=this.label||"";return r.some(function(h){return n.some(d=>{let c=d.isContentValid(h);return c.valid?!1:(o=()=>{e.reveal(),this.table.focusCell(d,h)},l&&(l+=": "),l+=d.text,t=t&&c.validByErrorStatus,s=s&&c.validByMandatory,!(t||s))},this)},this),{valid:t&&s,validByErrorStatus:t,validByMandatory:s,field:this,label:l,reveal:o}}getDelegateScrollable(){return this.table}}Mr(Fn,"TABLE_CHANGE_EVENTS","rowsInserted rowsDeleted allRowsDeleted rowsUpdated rowsChecked");class P_ extends at{}function x_(i,e,t){return e=bA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function bA(i){var e=vA(i,"string");return typeof e=="symbol"?e:String(e)}function vA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Cp extends ue{constructor(){super(),x_(this,"table",void 0),x_(this,"field",void 0),this.table=null,this.windowPaddingX=0,this.windowPaddingY=0}_init(e){super._init(e);let t=u.create(De,{session:this.session,text:"Tag",autoOptimizeWidth:!1});this.table=u.create(V,{parent:this,headerVisible:!1,autoResizeColumns:!0,multiSelect:!1,scrollToSelection:!0,columns:[t],headerMenusEnabled:!1,textFilterEnabled:!1}),this.table.on("rowClick",this._onRowClick.bind(this))}_createLayout(){return new Sp(this)}_render(){super._render(),this.$container.addClass("tag-chooser-popup").on("mousedown",this._onContainerMouseDown.bind(this)),this.findDesktop().adjustOverlayOrder(this),this._renderTable()}_renderTable(){this.table.setVirtual(!1),this.table.render(),this.table.$container.setTabbable(!1).addClass("focused")}setLookupResult(e){let t=e.lookupRows;this.table.deleteAllRows();let s=t.map(r=>_o.createTableRow(r));this.table.insertRows(s)}_onRowClick(e){this.triggerLookupRowSelected()}_onContainerMouseDown(e){return!1}_isMouseDownOnAnchor(e){return this.field.$field.isOrHas(e.target)}delegateKeyEvent(e){e.originalEvent.smartFieldEvent=!0,this.table.$container.trigger(e)}triggerLookupRowSelected(e){e=e||this.selectedRow(),!(!e||!e.enabled)&&this.trigger("lookupRowSelected",{lookupRow:e.lookupRow})}selectedRow(){return this.table.selectedRow()}}class Sp extends Ii{constructor(e){super(e),this.doubleCalcPrefSize=!1}layout(e){super.layout(e);let t=this.popup.htmlComp,s=t.size().subtract(t.insets());this.popup.table.htmlComp.setSize(s),this.popup.position()}preferredLayoutSize(e,t){let s=u.create(uh,this.popup.table);s.modifyDom();let r=super.preferredLayoutSize(e);return s.restoreDom(),r}}function Dn(i,e,t){return e=wA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function wA(i){var e=TA(i,"string");return typeof e=="symbol"?e:String(e)}function TA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ph extends me{constructor(){super(),Dn(this,"lookupCall",void 0),Dn(this,"maxLength",void 0),Dn(this,"fieldHtmlComp",void 0),Dn(this,"popup",void 0),Dn(this,"tagBar",void 0),Dn(this,"maxLengthHandler",void 0),Dn(this,"_currentLookupCall",void 0),this.$field=null,this.fieldHtmlComp=null,this.popup=null,this.lookupCall=null,this._currentLookupCall=null,this.tagBar=null,this.maxLength=500,this.maxLengthHandler=u.create(Ho,{target:this})}_init(e){super._init(e),this.tagBar=u.create(li,{parent:this,tags:this.value,clickable:e.clickable}),this.tagBar.on("tagRemove",this._onTagRemove.bind(this)),this.on("propertyChange",this._onValueChange.bind(this)),this._setLookupCall(this.lookupCall)}_onTagRemove(e){this.removeTag(e.tag)}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.registerKeyStrokes([new Pp(this),new mh(this._createFieldAdapter()),new fh(this._createFieldAdapter()),new xp(this)])}_createKeyStrokeContext(){return new As}_render(){this.addContainer(this.$parent,"tag-field",new Ep(this)),this.addLabel(),this.addMandatoryIndicator();let e=this.$container.appendDiv();this.fieldHtmlComp=T.install(e,this.session),this.fieldHtmlComp.setLayout(new vo(this)),this.tagBar.render(e);let t=e.appendElement("<input>","field").attr("type","text").on("keydown",this._onInputKeydown.bind(this)).on("keyup",this._onInputKeyup.bind(this)).on("input",this._onFieldInput.bind(this));this.addFieldContainer(e),this.addField(t),this.maxLengthHandler.install(t),this.addStatus()}_renderProperties(){super._renderProperties(),this._renderValue(),this._renderMaxLength()}_renderValue(){this.tagBar.updateTags()}_setValue(e){super._setValue(e),this.tagBar&&this.tagBar.setTags(this.value)}_setLookupCall(e){this._setProperty("lookupCall",Ut.ensure(e,this.session))}formatValue(e){return""}_validateValue(e){let t=p.ensure(e),s=[];return t.forEach(r=>{y.empty(r)||(r=r.toLowerCase(),s.indexOf(r)<0&&s.push(r))}),s}_parseValue(e){let t=p.ensure(this.value);return t=t.slice(),t.push(e),t}_renderDisplayText(){this.$field.val(this.displayText),super._renderDisplayText(),this._updateInputVisible()}_renderEnabled(){super._renderEnabled(),this._updateInputVisible()}_renderFieldStyle(){super._renderFieldStyle(),this.rendered&&this.fieldHtmlComp.invalidateLayoutTree()}setMaxLength(e){this.setProperty("maxLength",e)}_renderMaxLength(){this.maxLengthHandler.render()}_updateInputVisible(){let e,t=!this.$field.isVisible();this.enabledComputed?e=!0:e=y.hasText(this.displayText),this.$field.setVisible(e),e!==t&&this._renderValue()}_readDisplayText(){return this.$field.val()}_clear(){this.$field.val("")}acceptInput(e){if(this.popup){this.popup.selectedRow()?this.popup.triggerLookupRowSelected():this.closePopup();return}super.acceptInput(!1)}_triggerAcceptInput(e){this.trigger("acceptInput",{displayText:this.displayText,whileTyping:e,value:this.value})}aboutToBlurByMouseDown(e){Z.eventOutsideProposalField(this,e)&&this.acceptInput(!0)}_onFieldBlur(e){this.closePopup(),super._onFieldBlur(e),this.rendered&&!this.removing&&this.tagBar.blur()}_onFieldFocus(e){super._onFieldFocus(e),this.rendered&&!this.removing&&this.tagBar.focus()}_onFieldInput(){this._updateHasText()}addTag(e){let t=this._parseValue(e);this.setValue(t),this._triggerAcceptInput()}removeTag(e){if(y.empty(e))return;e=e.toLowerCase();let t=p.ensure(this.value);t.indexOf(e)!==-1&&(t=t.slice(),p.remove(t,e),this.setValue(t),this._triggerAcceptInput(),this.focus())}_onInputKeydown(e){this._isNavigationKey(e)&&this.popup?this.popup.delegateKeyEvent(e):e.which===g.ESC&&this.closePopup()}_isNavigationKey(e){return u.isOneOf(e.which,[g.PAGE_UP,g.PAGE_DOWN,g.UP,g.DOWN])}_onInputKeyup(e){e.which!==g.ESC&&(this._isNavigationKey(e)||this._lookupByText(this.$field.val()))}_lookupByText(e){if(!!this.lookupCall){if(y.empty(e)||e.length<2){this.closePopup();return}this._currentLookupCall=this.lookupCall.cloneForText(e),this.trigger("prepareLookupCall",{lookupCall:this._currentLookupCall}),this._currentLookupCall.execute().always(()=>{this._currentLookupCall=null}).done(this._onLookupDone.bind(this))}}_onLookupDone(e){try{if(!this.rendered||!this.isFocused()||e.lookupRows.length===0){this.closePopup();return}this.openPopup(),this.popup.setLookupResult(e)}finally{this.trigger("lookupCallDone",{result:e})}}openPopup(){this.popup||(this.popup=u.create(Cp,{parent:this,$anchor:this.$field,boundToAnchor:!0,closeOnAnchorMouseDown:!1,field:this}),this.popup.on("lookupRowSelected",this._onLookupRowSelected.bind(this)),this.popup.one("close",this._onPopupClose.bind(this)),this.popup.open())}closePopup(){this.popup&&!this.popup.destroying&&this.popup.close()}_onLookupRowSelected(e){this._clear(),this._updateHasText(),this.addTag(e.lookupRow.key),this.closePopup()}_onPopupClose(e){this.popup=null}isInputFocused(){let e=this.$fieldContainer.activeElement();return this.$field.is(e)}_onValueChange(e){e.propertyName==="value"&&this._renderLabel()}_renderPlaceholder(e){let t=!!p.ensure(this.value).length;e=u.nvl(e,this.$field),e&&e.placeholder(t?"":this.label)}_createFieldAdapter(){return ph.createFieldAdapter(this)}static createFieldAdapter(e){return{$container:()=>e.$fieldContainer,enabled:()=>y.empty(e._readDisplayText()),focus:()=>e.$field.focus(),removeTag:t=>e.removeTag(t)}}}class E_ extends nh{_initProperties(e){e.insertText!==void 0&&delete e.insertText}_postCreateWidget(){super._postCreateWidget();let e=Gl;this.widget.lookupCall=u.create(e,this)}_syncResult(e){let t=this.widget._currentLookupCall;t&&t.resolveLookup(e)}_onWidgetAcceptInput(e){this._send("acceptInput",{displayText:e.displayText,value:e.value})}}class Pp extends O{constructor(e){super(),this.field=e,this.which=[g.ENTER],this.renderingHints.render=!1,this.preventDefault=!1,this.stopPropagation=!0}_accept(e){return super._accept(e)?(this.stopPropagation=y.hasText(this.field._readDisplayText()),this.field.isInputFocused()):!1}handle(e){this.field.acceptInput()}}function CA(i,e,t){return e=SA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function SA(i){var e=PA(i,"string");return typeof e=="symbol"?e:String(e)}function PA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class fh extends O{constructor(e){super(),CA(this,"fieldAdapter",void 0),this.fieldAdapter=e,this.which=[g.DELETE],this.renderingHints.render=!1,this.preventDefault=!1}_accept(e){return super._accept(e)?this._$focusedTag().length>0:!1}handle(e){let t=this._$focusedTag(),s=li.getTagData(t);this.fieldAdapter.removeTag(s)}_$focusedTag(){return li.findFocusedTagElement(this.fieldAdapter.$container())}}function xA(i,e,t){return e=EA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function EA(i){var e=FA(i,"string");return typeof e=="symbol"?e:String(e)}function FA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class mh extends O{constructor(e){super(),xA(this,"fieldAdapter",void 0),this.fieldAdapter=e,this.which=[g.LEFT,g.RIGHT],this.preventDefault=!1,this.preventInvokeAcceptInputOnActiveValueField=!0}_accept(e){return super._accept(e)?this.fieldAdapter.enabled():!1}handle(e){e.which===g.LEFT?this._focusTagElement(-1):e.which===g.RIGHT&&this._focusTagElement(1)}_focusTagElement(e){let t=-1,s=-2,r=li.findFocusableTagElements(this.fieldAdapter.$container()),n=r.length;if(n===0)return;let o=t;if(r.each(function(l){a()(this).hasClass("focused")&&(o=l)}),o===t)e===-1&&(o=n-1);else{let l=o+e;l>=n?o=s:l<0?o=t:(li.unfocusTagElement(r.eq(o)),o=l)}o===t||(o===s?this.fieldAdapter.focus():li.focusTagElement(r.eq(o)))}}class xp extends O{constructor(e){super(),this.field=e,this.which=[g.ENTER,g.SPACE],this.renderingHints.render=!1,this.preventDefault=!1}_accept(e){return super._accept(e)?this.field.tagBar&&this.field.tagBar.isOverflowIconFocused():!1}handle(e){this.field.tagBar.openOverflowPopup()}}class Ep extends oi{constructor(e){super(e)}_$elementForIconLayout(){return this.formField.$fieldContainer}}function F_(i,e,t){return e=DA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function DA(i){var e=AA(i,"string");return typeof e=="symbol"?e:String(e)}function AA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class vo extends ee{constructor(e){super(),F_(this,"tagField",void 0),this.tagField=e}layout(e){let t=T.get(e),s=this.tagField.value&&this.tagField.value.length>0,r=this.tagField.$field,n=this.tagField.tagBar.htmlComp;if(this.tagField.tagBar.setVisible(s),s){r.removeClass("fullwidth");let o=t.availableSize().subtract(t.insets()),l=o.width;r.isVisible()&&(l=o.width*(1-vo.MIN_INPUT_TAG_RATIO));let h=n.prefSize(!0),d=Math.min(l,h.width);n.setSize(new F(d,h.height).subtract(n.margins()));let c=o.width-d;r.cssWidth(c)}else r.addClass("fullwidth").removeAttr("style")}}F_(vo,"MIN_INPUT_TAG_RATIO",.33);function D_(i,e,t){return e=$A(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function $A(i){var e=RA(i,"string");return typeof e=="symbol"?e:String(e)}function RA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class A_ extends A{constructor(){super(),D_(this,"tileGrid",void 0),D_(this,"eventDelegator",void 0),this.eventDelegator=null,this._addWidgetProperties(["tileGrid"])}_init(e){super._init(e),this._setTileGrid(this.tileGrid)}_createLoadingSupport(){return null}_render(){this.addContainer(this.$parent,"tile-field"),this.addLabel(),this.addMandatoryIndicator(),this.addStatus(),this.tileGrid&&this._renderTileGrid()}_renderProperties(){super._renderProperties(),this._renderDropType()}setTileGrid(e){this.setProperty("tileGrid",e)}_setTileGrid(e){this.tileGrid&&this.eventDelegator&&(this.eventDelegator.destroy(),this.eventDelegator=null),this._setProperty("tileGrid",e),e&&(this.eventDelegator=is.create(this,e,{delegateProperties:["loading"]}),e.setLoading(this.loading),e.setScrollTop(this.scrollTop))}_renderTileGrid(){!this.tileGrid||(this.tileGrid.render(),this.addField(this.tileGrid.$container),this.invalidateLayoutTree())}_removeTileGrid(){!this.tileGrid||(this.tileGrid.remove(),this._removeField(),this.invalidateLayoutTree())}getDelegateScrollable(){return this.tileGrid}}class $_ extends at{}function R_(i,e,t){return e=MA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function MA(i){var e=IA(i,"string");return typeof e=="symbol"?e:String(e)}function IA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class M_ extends yn{constructor(){super(),R_(this,"tree",void 0),R_(this,"_populating",void 0),this.tree=null,this._populating=!1,this._addWidgetProperties(["tree","filterBox"])}_init(e){super._init(e),this.tree.on("nodesChecked",this._onTreeNodesChecked.bind(this)),this.tree.setScrollTop(this.scrollTop)}_initStructure(e){this.tree||(this.tree=this._createDefaultTreeBoxTree())}_initValue(e){this.tree||(this.tree=this._createDefaultTreeBoxTree()),super._initValue(e)}_render(){super._render(),this.$container.addClass("tree-box")}_createFieldContainerLayout(){return new Fp(this,this.tree,this.filterBox)}_renderStructure(){this.tree.render(this.$fieldContainer),this.addField(this.tree.$container)}_onTreeNodesChecked(e){this._populating||this._syncTreeToValue()}_syncTreeToValue(){if(!this.lookupCall||this._valueSyncing)return;this._valueSyncing=!0;let e=b.values(this.tree.nodesMap).filter(t=>t.checked).map(t=>t.lookupRow.key);this.setValue(e),this._valueSyncing=!1}_valueChanged(){super._valueChanged(),this._syncValueToTree(this.value)}_syncValueToTree(e){if(!this.lookupCall||this._valueSyncing||!this.initialized)return;this._valueSyncing=!0;let t={checkOnlyEnabled:!1,checkChildren:!1};try{if(p.empty(e))this.uncheckAll(t);else{if(this._ensureLookupCallExecuted())return;this.uncheckAll(t),b.values(this.tree.nodesMap).forEach(r=>{p.contains(e,r.lookupRow.key)&&this.tree.checkNode(r,!0,t)},this)}this._updateDisplayText()}finally{this._valueSyncing=!1}}uncheckAll(e){for(let t in this.tree.nodesMap)this.tree.nodesMap.hasOwnProperty(t)&&this.tree.uncheckNode(this.tree.nodesMap[t],e)}_lookupByAllDone(e){return super._lookupByAllDone(e)?(this._populateTree(e),!0):!1}_populateTree(e){let t=[];this._populating=!0,this._populateTreeRecursive(null,t,e.lookupRows),this.tree.deleteAllNodes(),this.tree.insertNodes(t),this._populating=!1,this._syncValueToTree(this.value)}_populateTreeRecursive(e,t,s){let r;s.forEach(function(n){n.parentKey===e&&(r=this._createNode(n),this._populateTreeRecursive(r.lookupRow.key,r.childNodes,s),r.leaf=!r.childNodes.length,t.push(r))},this)}getCheckedLookupRows(){return this.value===null||p.empty(this.value)||this.tree.nodes.length===0?[]:b.values(this.tree.nodesMap).filter(e=>e.checked).map(e=>e.lookupRow)}_createNode(e){let t=u.create(ir,{parent:this.tree,text:e.text,lookupRow:e});return e.iconId&&(t.iconId=e.iconId),e.tooltipText&&(t.tooltipText=e.tooltipText),e.backgroundColor&&(t.backgroundColor=e.backgroundColor),e.foregroundColor&&(t.foregroundColor=e.foregroundColor),e.font&&(t.font=e.font),e.enabled===!1&&(t.enabled=!1),e.cssClass&&(t.cssClass=e.cssClass),e.active===!1&&(t.active=!1,t.cssClass=(t.cssClass?t.cssClass+" ":"")+"inactive"),t}_createDefaultTreeBoxTree(){return u.create(pe,{parent:this,checkable:!0})}getDelegateScrollable(){return this.tree}}class I_ extends Ot{}class Fp extends Qa{constructor(e,t,s){super(e,t,s)}}function LA(i,e,t){return e=OA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function OA(i){var e=BA(i,"string");return typeof e=="symbol"?e:String(e)}function BA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Dp extends A{constructor(){super(),LA(this,"tree",void 0),this.gridDataHints.weightY=1,this.gridDataHints.h=3,this._addWidgetProperties(["tree"])}_render(){this.addContainer(this.$parent,"tree-field"),this.addLabel(),this.addMandatoryIndicator(),this.addStatus(),this.tree&&this._renderTree()}setTree(e){this.setProperty("tree",e)}_setTree(e){this._setProperty("tree",e),e&&e.setScrollTop(this.scrollTop)}_renderTree(){!this.tree||(this.tree.render(),this.addField(this.tree.$container),this.$field.addDeviceClass(),this.invalidateLayoutTree())}_removeTree(){!this.tree||(this.tree.remove(),this._removeField(),this.invalidateLayoutTree())}getDelegateScrollable(){return this.tree}}class Ap extends at{}function An(i,e,t){return e=kA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function kA(i){var e=HA(i,"string");return typeof e=="symbol"?e:String(e)}function HA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class L_ extends A{constructor(){super(),An(this,"activeStepIndex",void 0),An(this,"steps",void 0),An(this,"previousActiveStepIndex",void 0),An(this,"stepsMap",void 0),An(this,"keepActiveStepAtLeftBorder",void 0),An(this,"animateScrolling",void 0),An(this,"$wizardStepsBody",void 0),this.activeStepIndex=-1,this.steps=[],this.previousActiveStepIndex=-1,this.stepsMap={},this.$wizardStepsBody=null,this.keepActiveStepAtLeftBorder=x.get().type===x.Type.MOBILE,this.animateScrolling=x.get().type===x.Type.MOBILE}_init(e){super._init(e),this._updateStepsMap()}_render(){this.addContainer(this.$parent,"wizard-progress-field",new $p(this)),this.addField(this.$parent.makeDiv("wizard-steps")),this.addStatus(),this.addLabel(),this.$field.toggleClass("compact",x.get().type===x.Type.MOBILE);let e=this.htmlComp.layout;e.compactFieldWidth=-1,this.$wizardStepsBody=this.$field.appendDiv("wizard-steps-body"),this._installScrollbars({axis:"x",scrollShadow:"none"}),this.parent instanceof xe&&this.parent.controls[0]===this&&this.parent.parent instanceof U&&this.parent.parent.$container.addClass("wizard-container-form")}_renderProperties(){super._renderProperties(),this._renderSteps(),this._renderActiveStepIndex()}_setSteps(e){this._setProperty("steps",e),this._updateStepsMap()}_renderSteps(){this.$wizardStepsBody.children(".wizard-step").each(function(){K.uninstall(a()(this))}),this.$wizardStepsBody.empty(),this.steps.forEach((e,t)=>{let s=this.$wizardStepsBody.appendDiv("wizard-step").addClass(e.cssClass).data("wizard-step",e);e.$step=s,this._updateStepClasses(e),this.session.inspector&&(Hn.applyInfo(e,s),s.attr("data-step-index",e.index)),y.hasText(e.tooltipText)&&K.install(s,{parent:this,text:e.tooltipText,tooltipPosition:"bottom"});let r=s.appendDiv("icon");e.iconId?r.icon(e.iconId):e.finished?r.icon(ye.CHECKED_BOLD):r.text(t+1);let n=s.appendDiv("text");n.appendDiv("title").textOrNbsp(e.title).attr("data-text",e.title),e.subTitle&&n.appendDiv("sub-title").textOrNbsp(e.subTitle),t<this.steps.length-1&&this.$wizardStepsBody.appendDiv("wizard-step-separator")}),this.invalidateLayoutTree(!1)}_setActiveStepIndex(e){this.previousActiveStepIndex=this.activeStepIndex,this._setProperty("activeStepIndex",u.nvl(e,-1))}_renderActiveStepIndex(){this.steps.forEach(this._updateStepClasses.bind(this)),this.invalidateLayoutTree(!1)}_updateStepClasses(e){let t=e.$step;t.removeClass("selected first last action-enabled disabled"),t.off("click.selected");let s=this.steps.indexOf(e),r=this.steps.indexOf(this.stepsMap[this.activeStepIndex]);this.enabledComputed&&e.enabled&&e.actionEnabled&&s!==this.activeStepIndex?(t.addClass("action-enabled"),t.on("click.selected",this._onStepClick.bind(this))):(!this.enabledComputed||!e.enabled)&&t.addClass("disabled"),t.toggleClass("finished",e.finished),s>=0&&r>=0&&(s===r&&t.addClass("selected"),s===0&&t.addClass("first"),s===this.steps.length-1&&t.addClass("last")),s===this.steps.length-1&&this.$wizardStepsBody.css("background-color",t.css("background-color"))}_stepIndex(e){if(e){let t=e.data("wizard-step");if(t)return t.index}return-1}_updateStepsMap(){this.stepsMap={},this.steps.forEach(e=>{this.stepsMap[e.index]=e})}_resolveStep(e){for(let t=0;t<this.steps.length;t++){let s=this.steps[t];if(s.index===e)return s}return null}_onStepClick(e){let t=a()(e.currentTarget),s=this._stepIndex(t);s>=0&&s!==this.activeStepIndex&&this.trigger("stepAction",{stepIndex:s})}scrollToActiveStep(){let e=this.stepsMap[this.activeStepIndex];if(!e)return;let t=e.$step,s=t.position().left,r=this.animateScrolling&&this.htmlComp.layouted;if(this.keepActiveStepAtLeftBorder){let n=this.steps[0].$step,o=s-n.cssPaddingLeft()+t.cssPaddingLeft();P.scrollLeft(this.$field,o,{animate:r})}else{let n=this.$field.scrollLeft(),o=t.width(),l=this.$field.width(),h=this.previousActiveStepIndex>this.activeStepIndex,d=n+Math.floor(l*(h?.25:.75)),c=s+Math.floor(o/2);(h&&c<d||!h&&c>d)&&P.scrollLeft(this.$field,n+(c-d),{animate:r})}}}class O_ extends at{_onWidgetStepAction(e){this._send("doStepAction",{stepIndex:e.stepIndex})}_onWidgetEvent(e){e.type==="stepAction"?this._onWidgetStepAction(e):super._onWidgetEvent(e)}}class $p extends oi{constructor(e){super(e)}layout(e){super.layout(e);let t=this.formField.$field.scrollLeft(),s=this.formField.$wizardStepsBody;s.width("auto");let r=s[0].scrollWidth;s.width(r),this.formField.$field.scrollLeft(t),this.formField.scrollToActiveStep()}}function Rp(i,e,t){return e=NA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function NA(i){var e=VA(i,"string");return typeof e=="symbol"?e:String(e)}function VA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class wo extends A{constructor(){super(),Rp(this,"innerForm",void 0),Rp(this,"initialFocusEnabled",void 0),Rp(this,"_formDestroyHandler",void 0),this._addWidgetProperties(["innerForm"]),this.innerForm=null,this.initialFocusEnabled=!1,this._formDestroyHandler=this._onInnerFormDestroy.bind(this)}_init(e){super._init(e),this._setInnerForm(this.innerForm)}_render(){this.addContainer(this.$parent,"wrapped-form-field"),this.addLabel(),this.addStatus()}_renderProperties(){super._renderProperties(),this._renderInnerForm()}setInnerForm(e){this.setProperty("innerForm",e)}_setInnerForm(e){this.innerForm&&this.innerForm.off("destroy",this._formDestroyHandler),e&&e.on("destroy",this._formDestroyHandler),this._setProperty("innerForm",e)}_renderInnerForm(){!this.innerForm||(this.innerForm.setDisplayHint(U.DisplayHint.VIEW),this.innerForm.setModal(!1),this.innerForm.setClosable(!1),this.innerForm.renderInitialFocusEnabled=this.initialFocusEnabled,this.innerForm.rootGroupBox&&this.innerForm.rootGroupBox.setMenuBarPosition(xe.MenuBarPosition.BOTTOM),this.innerForm.render(),this.addField(this.innerForm.$container),this.innerForm.invalidateLayoutTree(),this._renderInitialFocusEnabled())}_removeInnerForm(){this.innerForm&&this.innerForm.remove(),this._removeField()}_onInnerFormDestroy(e){this._removeInnerForm(),this._setInnerForm(null)}_renderInitialFocusEnabled(){this.innerForm&&this.initialFocusEnabled&&this.innerForm.renderInitialFocus()}}class B_ extends at{}function To(i,e,t){return e=WA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function WA(i){var e=zA(i,"string");return typeof e=="symbol"?e:String(e)}function zA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class k_ extends I{constructor(){super(),To(this,"activated",void 0),To(this,"label",void 0),To(this,"htmlEnabled",void 0),To(this,"tooltipText",void 0),To(this,"$label",void 0),To(this,"$button",void 0),this.activated=!1,this.label=null,this.htmlEnabled=!1,this.tooltipText=null,this.$label=null,this.$button=null}_init(e){super._init(e),this.setTooltipText(e.tooltipText)}_render(){this.$container=this.$parent.appendDiv("switch"),this.$label=this.$container.appendDiv("switch-label"),this.$button=this.$container.appendDiv("switch-button").on("click",this._onSwitchButtonClick.bind(this))}_renderProperties(){super._renderProperties(),this._renderActivated(),this._renderLabel(),this._renderTooltipText()}_onSwitchButtonClick(e){if(!this.enabledComputed)return;this.trigger("switch").defaultPrevented||this.setActivated(!this.activated),K.cancel(this.$container)}setLabel(e){this.setProperty("label",e)}_renderLabel(){this.htmlEnabled?this.$label.html(this.label):this.$label.text(this.label)}setActivated(e){this.setProperty("activated",e)}_renderActivated(){this.$button.toggleClass("activated",this.activated)}setTooltipText(e){this.setProperty("tooltipText",e)}_renderTooltipText(){y.hasText(this.tooltipText)?K.install(this.$container,{parent:this,text:this.tooltipText}):K.uninstall(this.$container)}}function Co(i,e,t){return e=KA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function KA(i){var e=GA(i,"string");return typeof e=="symbol"?e:String(e)}function GA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class li extends I{constructor(){super(),Co(this,"overflowEnabled",void 0),Co(this,"overflowVisible",void 0),Co(this,"tags",void 0),Co(this,"clickable",void 0),Co(this,"overflow",void 0),Co(this,"$overflowIcon",void 0),this.overflowEnabled=!0,this.$overflowIcon=null,this.overflowVisible=!1,this.overflow=null,this.tags=[],this.clickable=!1}_render(){this.$container=this.$parent.appendDiv("tag-bar"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new Mp(this)),this._installTooltipSupport()}_renderProperties(){super._renderProperties(),this._renderTags(),this._renderOverflowVisible()}_remove(){this.$overflowIcon=null,this.overflowVisible=!1,this.closeOverflowPopup(),this._uninstallTooltipSupport(),super._remove()}setTags(e){this.setProperty("tags",e)}updateTags(){this.rendered&&this._renderTags()}_renderTags(){let e=p.ensure(this.tags);this.renderTags(this.$container,e),this.invalidateLayoutTree()}setClickable(e){this.setProperty("clickable",e)}_renderClickable(){this._renderTagsClickable(this.$container.children(".tag-element")),this.invalidateLayoutTree()}_onTagClick(e){let t=li.getTagData(a()(e.currentTarget));return this._triggerTagClick(t),!1}_triggerTagClick(e){this.trigger("tagClick",{tag:e})}_renderEnabled(){super._renderEnabled(),this._renderTagsRemovable(this.$container.children(".tag-element")),this.invalidateLayoutTree()}_onTagRemoveClick(e){return this.enabledComputed&&this.removeTagByElement(a()(e.currentTarget)),!1}removeTagByElement(e){let t=li.getTagData(e);t&&this._triggerTagRemove(t,e)}_triggerTagRemove(e,t){this.trigger("tagRemove",{tag:e,$tag:t})}_onOverflowIconMousedown(e){return this.toggleOverflowPopup(),!1}isOverflowIconFocused(){if(!this.$overflowIcon)return!1;let e=this.$container.activeElement();return this.$overflowIcon.is(e)}openOverflowPopup(){this.overflow||(this.$overflowIcon.addClass("selected"),this.overflow=this._createOverflowPopup(),this.overflow.open(),this.overflow.one("destroy",e=>{this.$overflowIcon&&this.$overflowIcon.removeClass("selected"),this.overflow=null}))}_createOverflowPopup(){return u.create(Sl,{parent:this,closeOnAnchorMouseDown:!1,focusableContainer:!0,$anchor:this.$overflowIcon,cssClass:this.cssClass})}closeOverflowPopup(){this.overflow&&this.overflow.close()}toggleOverflowPopup(){this.overflow?this.closeOverflowPopup():this.openOverflowPopup()}_installTooltipSupport(){K.install(this.$container,{parent:this,selector:".tag-text",text:this._tagTooltipText.bind(this),arrowPosition:50,arrowPositionUnit:"%",nativeTooltip:!x.get().isCustomEllipsisTooltipPossible()})}_uninstallTooltipSupport(){K.uninstall(this.$container)}_tagTooltipText(e){return e.isContentTruncated()?e.text():null}_removeFocusFromTagElements(){li.findFocusableTagElements(this.$container).removeClass("focused").setTabbable(!1)}focus(e){return this.$container.addClass("focused"),this._removeFocusFromTagElements(),this.closeOverflowPopup(),!1}blur(){this.$container.removeClass("focused");let e=event.relatedTarget;this.overflow&&this.overflow.$container.has(e)||this.closeOverflowPopup()}setOverflowVisible(e){this.setProperty("overflowVisible",e)}_renderOverflowVisible(){this.overflowVisible?this.$overflowIcon||(this.$overflowIcon=this.$container.prependDiv("overflow-icon").on("mousedown",this._onOverflowIconMousedown.bind(this))):this.$overflowIcon&&(this.$overflowIcon.remove(),this.$overflowIcon=null)}visibleTags(){if(!this.rendered)return[];let e=[];return this.$container.find(".tag-element:not(.hidden)").each(function(){e.push(li.getTagData(a()(this)))}),e}renderTags(e,t){e.find(".tag-element").remove(),t.forEach(r=>this.renderTag(e,r));let s=e.children(".tag-element");this._renderTagsClickable(s),this._renderTagsRemovable(s)}renderTag(e,t){let s=e.appendDiv("tag-element").data("tag",t);return s.appendSpan("tag-text",t),s}_renderTagsClickable(e){e.each((t,s)=>{let r=a()(s),n=r.children(".tag-text"),o=r.data("click-handler");this.clickable?o||(o=this._onTagClick.bind(this),r.data("click-handler",o),n.on("mousedown",o)):(n.off("mousedown",o),r.removeData("click-handler")),r.toggleClass("clickable",this.clickable)})}_renderTagsRemovable(e){e.each((t,s)=>{let r=a()(s),n=r.children(".tag-remove-icon"),o=r.data("remove-handler");this.enabledComputed?o||(o=this._onTagRemoveClick.bind(this),r.data("remove-handler",o),r.appendSpan("tag-remove-icon").on("click",o)):(n.off("click",o),n.remove(),r.removeData("remove-handler")),r.toggleClass("removable",this.enabledComputed)})}static findFocusedTagElement(e){return e.find(".tag-element.focused")}static findFocusableTagElements(e){return e.find(".tag-element:not(.hidden),.overflow-icon")}static focusFirstTagElement(e){this.focusTagElement(this.firstTagElement(e))}static firstTagElement(e){return e.find(".tag-element").first()}static focusTagElement(e){e.setTabbable(!0).addClass("focused").focus()}static unfocusTagElement(e){e.setTabbable(!1).removeClass("focused")}static getTagData(e){let t=e.data("tag");return t||e.parent().data("tag")}}function UA(i,e,t){return e=qA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function qA(i){var e=YA(i,"string");return typeof e=="symbol"?e:String(e)}function YA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Mp extends ee{constructor(e){super(),UA(this,"tagBar",void 0),this.tagBar=e}layout(e){let t=T.get(e);if(!(this.tagBar.tags&&this.tagBar.tags.length>0))return;let n=t.availableSize().subtract(t.insets()).width,o=0,l=!1,h,d,c=e.find(".tag-element"),f=c.length,m=[];for(c.removeClass("hidden"),d=f-1;d>=0&&(h=a()(c[d]),m[d]=v.size(h,{includeMargin:!0}),l=o+m[d].width>n,!l);d--)o+=m[d].width;if(this.tagBar.setOverflowVisible(l),l)for(o=v.size(this.tagBar.$overflowIcon,{includeMargin:!0}).width,d=f-1;d>=0;d--){if(h=a()(c[d]),!m[d]){h.addClass("hidden");continue}o+m[d].width>n?h.addClass("hidden"):o+=m[d].width}}preferredLayoutSize(e,t){let s=T.get(e),r=this.tagBar.tags&&this.tagBar.tags.length>0,n=s.availableSize(),o=0,l=0;if(!r)return new F(0,n.height);let h=e.find(".tag-element");return h.removeClass("hidden"),h.each((d,c)=>{let f=v.size(a()(c),{includeMargin:!0});o+=f.width,l=Math.max(f.height,l)}),new F(o,l).add(s.insets())}}function H_(i,e,t){return e=jA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function jA(i){var e=XA(i,"string");return typeof e=="symbol"?e:String(e)}function XA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Sl extends ue{constructor(){super(),H_(this,"$body",void 0),H_(this,"_tagBarPropertyChangeListener",void 0),this.windowPaddingX=0,this.windowPaddingY=0,this._tagBarPropertyChangeListener=null,this.initialFocus=function(){return li.firstTagElement(this.$body).setTabbable(!0).addClass("focused")[0]}}_init(e){super._init(e),this._tagBarPropertyChangeListener=this._onTagBarPropertyChange.bind(this),this.parent.on("propertyChange",this._tagBarPropertyChangeListener)}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.registerKeyStrokes([new mh(this._createFieldAdapter()),new fh(this._createFieldAdapter())])}_destroy(){this.parent.off("propertyChange",this._tagBarPropertyChangeListener),super._destroy()}_render(){super._render(),this.$container.addClass("tag-overflow-popup"),this.$body=this.$container.appendDiv("popup-body")}_createLayout(){return new Ip(this)}_renderProperties(){super._renderProperties(),this._renderTags()}_renderTags(){let e=this.parent,t=e.visibleTags(),r=p.ensure(e.tags).filter(n=>t.indexOf(n)===-1);e.renderTags(this.$body,r),this.rendering||this.invalidateLayoutTree()}_focusFirstTagElement(){li.focusFirstTagElement(this.$body)}_onTagBarPropertyChange(e){if(e.propertyName==="tags"){let t=p.ensure(this.parent.tags),s=this.parent.visibleTags(),r=t.length;r===0||r===s.length?this.close():(this._renderTags(),this._focusFirstTagElement())}}_createFieldAdapter(){return Sl.createFieldAdapter(this)}static createFieldAdapter(e){return{$container:()=>e.$body,enabled:()=>!0,focus:()=>{},removeTag:t=>{e.parent.parent.removeTag(t)}}}}class Ip extends Ii{preferredLayoutSize(e,t){let s=super.preferredLayoutSize(e,t);return s.width=v.size(this.popup.$body,{exact:!0}).width,s.width+=this.popup.htmlComp.insets().horizontal(),s}}function Us(i,e,t){return e=JA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function JA(i){var e=QA(i,"string");return typeof e=="symbol"?e:String(e)}function QA(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Vt extends I{constructor(){super(),Us(this,"colorScheme",void 0),Us(this,"displayStyle",void 0),Us(this,"filterAccepted",void 0),Us(this,"gridData",void 0),Us(this,"gridDataHints",void 0),Us(this,"rowId",void 0),Us(this,"selected",void 0),Us(this,"selectable",void 0),Us(this,"plainText",void 0),this.displayStyle=Vt.DisplayStyle.DEFAULT,this.filterAccepted=!0,this.gridData=null,this.rowId=null,this.gridDataHints=new ze,this.colorScheme=null,this.selected=!1,this.selectable=!1,this.plainText=null}_createLoadingSupport(){return new ss({widget:this})}_init(e){super._init(e),this._setGridDataHints(this.gridDataHints),this._setColorScheme(this.colorScheme),this._setSelectable(this.selectable)}_render(){this.$container=this.$parent.appendDiv("tile"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new Es)}_renderProperties(){super._renderProperties(),this._renderColorScheme(),this._renderSelectable(),this._renderSelected(),this._renderDisplayStyle()}_postRender(){this.$container.addClass("tile"),this.htmlComp.layout.animateClasses=["animate-visible","animate-invisible","animate-insert","animate-remove"]}_renderDisplayStyle(){this.$container.toggleClass("default-tile",this.displayStyle===Vt.DisplayStyle.DEFAULT)}setGridDataHints(e){this.setProperty("gridDataHints",e),this.rendered&&this.parent.invalidateLogicalGrid()}_setGridDataHints(e){e||(e=new ze),this._setProperty("gridDataHints",ze.ensure(e))}setColorScheme(e){this.setProperty("colorScheme",e)}_setColorScheme(e){let t={scheme:Rt.ColorSchemeId.DEFAULT,inverted:!1};e=Rt.ensureColorScheme(e,!0),e=a().extend({},t,e),this._setProperty("colorScheme",e)}_renderColorScheme(){Rt.toggleColorSchemeClasses(this.$container,this.colorScheme)}setSelected(e){e&&!this.selectable||this.setProperty("selected",e)}_renderSelected(){this.$container.toggleClass("selected",this.selected)}setSelectable(e){this.setProperty("selectable",e)}_setSelectable(e){this._setProperty("selectable",e),this.selectable||this.setSelected(!1)}_renderSelectable(){this.$container.toggleClass("selectable",this.selectable)}setFilterAccepted(e){this.setProperty("filterAccepted",e)}_renderFilterAccepted(){this._renderVisible()}_renderVisible(){if(this.rendering){this.$container.setVisible(this.isVisible());return}this.removalPending||(this.isVisible()?(this.$container.addClass("invisible"),this.$container.setVisible(!0),this.session.layoutValidator.schedulePostValidateFunction(()=>{!this.rendered||!this.isVisible()||(this.$container.removeClass("invisible animate-invisible"),this.$container.addClassForAnimation("animate-visible"),this.$container.oneAnimationEnd(()=>{P.update(this.parent.get$Scrollable())}))})):(this.$container.removeClass("invisible animate-visible"),this.$container.addClassForAnimation("animate-invisible"),this.$container.oneAnimationEnd(()=>{this.$container.setVisible(this.isVisible()),P.update(this.parent.get$Scrollable())})),this.invalidateParentLogicalGrid())}isVisible(){return this.visible&&this.filterAccepted}}Us(Vt,"DisplayStyle",{DEFAULT:"default",PLAIN:"plain"});class So extends ke{}function he(i,e,t){return e=ZA(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ZA(i){var e=e$(i,"string");return typeof e=="symbol"?e:String(e)}function e$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}const Lp="> .tile";class $n extends I{constructor(){super(),he(this,"animateTileRemoval",void 0),he(this,"animateTileInsertion",void 0),he(this,"comparator",void 0),he(this,"contextMenu",void 0),he(this,"empty",void 0),he(this,"filters",void 0),he(this,"filteredTiles",void 0),he(this,"filteredElementsDirty",void 0),he(this,"focusedTile",void 0),he(this,"gridColumnCount",void 0),he(this,"prefGridColumnCount",void 0),he(this,"layoutConfig",void 0),he(this,"menus",void 0),he(this,"multiSelect",void 0),he(this,"renderAnimationEnabled",void 0),he(this,"selectable",void 0),he(this,"selectedTiles",void 0),he(this,"selectionHandler",void 0),he(this,"scrollable",void 0),he(this,"startupAnimationDone",void 0),he(this,"startupAnimationEnabled",void 0),he(this,"tiles",void 0),he(this,"tileRemovalPendingCount",void 0),he(this,"viewRangeSize",void 0),he(this,"viewRangeRendered",void 0),he(this,"virtual",void 0),he(this,"virtualScrolling",void 0),he(this,"withPlaceholders",void 0),he(this,"placeholderProducer",void 0),he(this,"textFilterEnabled",void 0),he(this,"filterSupport",void 0),he(this,"createTextFilter",void 0),he(this,"updateTextFilterText",void 0),he(this,"$filterFieldContainer",void 0),he(this,"$fillBefore",void 0),he(this,"$fillAfter",void 0),he(this,"_doubleClickSupport",void 0),he(this,"_filterMenusHandler",void 0),he(this,"_renderViewPortAfterAttach",void 0),he(this,"_scrollParentScrollHandler",void 0),this.animateTileRemoval=!0,this.animateTileInsertion=!0,this.comparator=null,this.contextMenu=null,this._doubleClickSupport=new Vr,this.empty=!1,this.filters=[],this.filteredTiles=[],this.filteredElementsDirty=!0,this.focusedTile=null,this.gridColumnCount=4,this.prefGridColumnCount=this.gridColumnCount,this.logicalGrid=u.create(Gr),this.layoutConfig=null,this.menus=[],this.multiSelect=!0,this.renderAnimationEnabled=!1,this.selectable=!1,this.selectedTiles=[],this.selectionHandler=new gh(this),this.scrollable=!0,this.startupAnimationDone=!1,this.startupAnimationEnabled=!1,this.tiles=[],this.tileRemovalPendingCount=0,this.viewRangeSize=0,this.viewRangeRendered=new B(0,0),this.virtual=!1,this.virtualScrolling=null,this.withPlaceholders=!1,this.placeholderProducer=null,this.$filterFieldContainer=null,this.textFilterEnabled=!1,this.filterSupport=this._createFilterSupport(),this.createTextFilter=null,this.updateTextFilterText=null,this._filterMenusHandler=this._filterMenus.bind(this),this._renderViewPortAfterAttach=!1,this._scrollParentScrollHandler=this._onScrollParentScroll.bind(this),this._addWidgetProperties(["tiles","selectedTiles","menus"]),this._addPreserveOnPropertyChangeProperties(["selectedTiles"]),this.$fillBefore=null,this.$fillAfter=null}_init(e){super._init(e),this._setGridColumnCount(this.gridColumnCount),this._setLayoutConfig(this.layoutConfig),this._initVirtualScrolling(),this._initTiles(),this.setFilters(this.filters,!1),this.filter(),this._setMenus(this.menus),this._sortWhileInit(),this.updateFilteredElements()}_createKeyStrokeContext(){return new Oe}_initVirtualScrolling(){this.virtualScrolling=this._createVirtualScrolling()}_createVirtualScrolling(){return new wd({widget:this,enabled:this.virtual,viewRangeSize:this.viewRangeSize,rowHeight:this._heightForRow.bind(this),rowCount:this.rowCount.bind(this),_renderViewRange:this._renderViewRange.bind(this)})}_createLoadingSupport(){return new ss({widget:this})}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.registerKeyStrokes([new Kp(this),new Gp(this),new Up(this),new qp(this),new Yp(this),new jp(this),new Xp(this),new ia(this,this.showContextMenu,this)])}_initTiles(){this.tiles.forEach(e=>{this._initTile(e)})}_initTile(e){e.setSelectable(this.selectable),e.setSelected(this.selectedTiles.indexOf(e)>=0),e.setParent(this),e.setFilterAccepted(!0)}_render(){this.$container=this.$parent.appendDiv("tile-grid"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(this._createLayout()),this.$container.on("mousedown",Lp,this._onTileMouseDown.bind(this)).on("click",Lp,this._onTileClick.bind(this)).on("dblclick",Lp,this._onTileDoubleClick.bind(this)),this.$filterFieldContainer=this.$container.prependDiv("filter-field-container")}_createLayout(){return new lr(this,this.layoutConfig)}_renderProperties(){super._renderProperties(),this._renderLayoutConfig(),this._renderScrollable(),this._renderVirtual(),this._renderSelectable(),this._renderEmpty(),this._renderTextFilterEnabled()}_remove(){this.$fillBefore=null,this.$fillAfter=null,this.filterSupport.remove(),this.viewRangeRendered=new B(0,0),this._updateVirtualScrollable(),super._remove()}_renderOnAttach(){super._renderOnAttach(),this._renderViewPortAfterAttach&&(this._renderViewPort(),this._renderViewPortAfterAttach=!1)}_renderEnabled(){super._renderEnabled(),this._updateTabbable()}_updateTabbable(){!this.textFilterEnabled&&!this.selectable?this.$container.setTabbable(!1):this.$container.setTabbableOrFocusable(this.enabledComputed)}insertTile(e){this.insertTiles([e])}insertTiles(e,t){if(e=p.ensure(e),e.length===0)return;let s=this.tiles;this.setTiles(s.concat(e),t)}deleteTile(e){this.deleteTiles([e])}deleteTiles(e,t){if(e=p.ensure(e),e.length===0)return;let s=this.tiles.slice();p.removeAll(s,e),this.setTiles(s,t)}deleteAllTiles(){this.setTiles([])}setTiles(e,t){let s=p.ensure(e);if(b.equals(this.tiles,e))return;let r=this._createChildren(s);this.withPlaceholders&&u.nvl(t,!0)&&this._deletePlaceholders(r);let n=p.diff(r,this.tiles);if(this._insertTiles(n),this.withPlaceholders&&u.nvl(t,!0)){let h=this.placeholders();h=h.slice(Math.min(this._filterTiles(n).length,h.length),h.length),p.pushAll(r,h)}let o=p.diff(this.tiles,r);this._deleteTiles(o),this._sort(r),this.filteredElementsDirty=this.filteredElementsDirty||o.length>0||n.length>0||!p.equals(this.tiles,r);let l=this.tiles;this._setProperty("tiles",r),this.updateFilteredElements(),this.rendered&&(this._renderTileDelta(),this._renderTileOrder(l),this._renderInsertTiles(n))}_insertTiles(e){e.length!==0&&e.forEach(t=>{this._insertTile(t)})}_insertTile(e){this._initTile(e),this._applyFilters([e]),!this.virtual&&this.rendered&&this._renderTile(e)}_renderTile(e){if(e.removalPending){e.one("remove",()=>{e.rendered||(this._renderTile(e),this._renderTileVisibleForFilter(e),this.tileRemovalPendingCount===0&&this.invalidateLayoutTree())});return}e.render(),e.setLayoutData(new xs(e)),e.$container.addClass("newly-rendered")}_renderInsertTiles(e){e.forEach(t=>{!t.rendered||(t.$container.addClass("invisible"),this.one("layoutAnimationDone",()=>{t.rendered&&(t.$container.removeClass("invisible"),this._animateTileInsertion(t)&&t.$container.addClassForAnimation("animate-insert"))}))}),this.htmlComp.layouting||this.invalidateLayoutTree()}_removeAllTiles(){this.tiles.forEach(e=>{e.remove()}),this.viewRangeRendered=new B(0,0)}_renderAllTiles(){this.tiles.forEach(e=>{this._renderTile(e)})}_deleteTiles(e){e.length!==0&&(e.forEach(t=>{this._deleteTile(t)}),this.deselectTiles(e),this.rendered&&!this.htmlComp.layouting&&this.invalidateLayoutTree())}_deleteTile(e){this._animateTileRemoval(e)&&(e.animateRemoval=!0),e.owner===this?e.destroy():this.rendered&&e.remove(),this._onAnimatedTileRemove(e),e.animateRemoval=!1,e===this.focusedTile&&this.setFocusedTile(null)}_animateTileRemoval(e){return this.animateTileRemoval&&e&&e.isVisible()&&!(e instanceof Ti)}_animateTileInsertion(e){return this.animateTileInsertion&&e&&e.isVisible()&&!(e instanceof Ti)}_onAnimatedTileRemove(e){!e.removalPending||(this.tileRemovalPendingCount++,e.one("remove",()=>{this.tileRemovalPendingCount--,this.rendered&&this.tileRemovalPendingCount===0&&!this.htmlComp.layouting&&this.invalidateLayoutTree()}))}setComparator(e){this.comparator!==e&&(this.comparator=e)}_sortWhileInit(){this.sort()}sort(){let e=this.tiles.slice();if(this._sort(e),p.equals(this.tiles,e))return;let t=this.tiles;this._setProperty("tiles",e),this.filteredElementsDirty=!0,this.updateFilteredElements(),this.rendered&&(this._renderTileDelta(),this._renderTileOrder(t))}_sort(e){if(this.comparator===null)return;let t=[];this.withPlaceholders&&(t=this._deletePlaceholders(e)),e.sort(this.comparator),p.pushAll(e,t)}invalidateLayoutTree(e){this.tileRemovalPendingCount>0||super.invalidateLayoutTree(e)}setGridColumnCount(e){this.setProperty("gridColumnCount",e)}_setGridColumnCount(e){this._setProperty("gridColumnCount",e),this.prefGridColumnCount=e,this.invalidateLogicalGrid()}setLayoutConfig(e){this.setProperty("layoutConfig",e)}_setLayoutConfig(e){e||(e=new Qi),this._setProperty("layoutConfig",Qi.ensure(e))}_renderLayoutConfig(){let e=this.htmlComp.layout,t=e.minWidth;this.layoutConfig.applyToLayout(e),this.virtualScrolling&&(this.virtualScrolling.setMinRowHeight(this._minRowHeight()),this.setViewRangeSize(this.virtualScrolling.viewRangeSize,!1)),t!==e.minWidth&&this._renderScrollable(),this.invalidateLayoutTree()}_setMenus(e){this.updateKeyStrokes(e,this.menus),this._setProperty("menus",e)}_filterMenus(e,t,s,r,n){return We.filterAccordingToSelection("TileGrid",this.selectedTiles.length,e,t,{onlyVisible:s,enableDisableKeyStrokes:r,notAllowedTypes:n})}showContextMenu(e){this.session.onRequestsDone(this._showContextMenu.bind(this,e))}_showContextMenu(e){if(e=e||{},!this.rendered||!this.attached||this.selectedTiles.length===0)return;let t=e.menuItems||this._filterMenus(this.menus,It.CONTEXT_MENU,!0,!1);if(t.length===0)return;let s=u.nvl(e.pageX,null),r=u.nvl(e.pageY,null);if(s===null||r===null){let n,o=this.$container.scrollParent();o.length===0&&(o=this.$container);let l=v.offsetBounds(o),h=this.focusedTile||p.last(this.selectedTiles);this.isTileInView(h)?n=h.$container.offset():n=this.$container.offset(),s=n.left+10,r=n.top+10,s=Math.min(Math.max(s,l.x+1),l.right()-1),r=Math.min(Math.max(r,l.y+1),l.bottom()-1)}this.contextMenu&&this.contextMenu.close(),this.contextMenu=u.create(ft,{parent:this,menuItems:t,location:{x:s,y:r},$anchor:this.$container,menuFilter:e.menuFilter||this._filterMenusHandler}),this.contextMenu.open()}setScrollable(e){this.setProperty("scrollable",e)}_renderScrollable(){this._uninstallScrollbars(),this.scrollable?this._installScrollbars({axis:this.layoutConfig.minWidth>0?"both":"y"}):this.layoutConfig.minWidth>0&&this._installScrollbars({axis:"x"}),this.$container.toggleClass("scrollable",this.scrollable),this._updateVirtualScrollable(),this.invalidateLayoutTree()}_onScroll(e){let t=this.$container[0].scrollTop,s=this.$container[0].scrollLeft;this.scrollTop!==t&&this.virtual&&this.htmlComp.layout.updateViewPort(),this.scrollTop=t,this.scrollLeft=s}_onScrollParentScroll(e){this.htmlComp.layout.updateViewPort()}setWithPlaceholders(e){this.setProperty("withPlaceholders",e)}_renderWithPlaceholders(){this.invalidateLayoutTree()}setPlaceholderProducer(e){this.setProperty("placeholderProducer",e)}fillUpWithPlaceholders(){if(!this.withPlaceholders){this._deleteAllPlaceholders();return}this._deleteObsoletePlaceholders(),this._insertMissingPlaceholders()}tilesWithoutPlaceholders(){return this.withPlaceholders?this.tiles.filter(e=>!(e instanceof Ti)):this.tiles}_createPlaceholders(){let e,t,s=this.gridColumnCount,r=this.filteredTiles,n=[];if(r.length>0){let o=r[r.length-1];t=o.gridData.x+o.gridData.w-1}else t=-1;if(t===s-1)return[];e=s-1-t;for(let o=0;o<e;o++)n.push(this._createPlaceholder());return n}_createPlaceholder(){let e=this.placeholderProducer&&this.placeholderProducer()||{};if(e instanceof Ti)return e;if(b.isPlainObject(e))return u.create(a().extend(!0,{},{objectType:Ti,parent:this},e));throw new Error("Placeholder producer returned unexpected result.")}_deleteObsoletePlaceholders(){let e=[],t=!1;this.placeholders().forEach(r=>{r.gridData.x===0&&this.filteredTiles[0]!==r&&(t=!0),t&&e.push(r)}),this.deleteTiles(e,!1)}_deleteAllPlaceholders(){this.deleteTiles(this.placeholders(),!1)}placeholders(){let e,t=[];for(e=this.tiles.length-1;e>=0&&this.tiles[e]instanceof Ti;e--)p.insert(t,this.tiles[e],0);return t}_insertMissingPlaceholders(){let e=this._createPlaceholders();this.insertTiles(e,!1)}_deletePlaceholders(e){let t,s=[];for(t=e.length-1;t>=0;t--)e[t]instanceof Ti&&(s.push(e[t]),p.remove(e,e[t]));return s.reverse()}validateLogicalGrid(){!this.logicalGrid.dirty||(this.logicalGrid.validate(this),this.fillUpWithPlaceholders(),this.logicalGrid.setDirty(!0),this.logicalGrid.validate(this))}_setLogicalGrid(e){super._setLogicalGrid(e),this.logicalGrid&&this.logicalGrid.setGridConfig(new Bp)}setFocusedTile(e){this.focusedTile===e||(this.focusedTile=e,!this.rendered||!e||this.isFocused())||this.$container.scrollParents().length===0||this.focus({preventScroll:!0})}setSelectable(e){this.setProperty("selectable",e),e||this.deselectAllTiles(),this.tiles.forEach(t=>{t.setSelectable(e)})}_renderSelectable(){this.$container.toggleClass("selectable",this.selectable),this._updateTabbable(),this.invalidateLayoutTree()}setMultiSelect(e){this.setProperty("multiSelect",e)}selectTiles(e){let t=this._createChildren(p.ensure(e));if(t=this._filterTiles(t),this.selectable||(t=[]),!this.multiSelect&&t.length>1&&(t=[t[0]]),p.equals(this.selectedTiles,t))return;let s=this.selectedTiles;p.removeAll(s,t),s.forEach(r=>{r.setSelected(!1),r===this.focusedTile&&this.setFocusedTile(null)}),t.forEach(r=>{r.setSelected(!0)}),this.setProperty("selectedTiles",t.slice())}selectTile(e){this.selectTiles([e])}selectAllTiles(){this.selectTiles(this.filteredTiles)}deselectTiles(e){e=p.ensure(e);let t=this.selectedTiles.slice();p.removeAll(t,e)&&this.selectTiles(t)}deselectTile(e){this.deselectTiles([e])}deselectAllTiles(){this.selectTiles([])}toggleSelection(){this.selectedTiles.length===this.filteredTiles.length?this.deselectAllTiles():this.selectAllTiles()}addTilesToSelection(e){e=p.ensure(e),this.selectTiles(this.selectedTiles.concat(e))}addTileToSelection(e){this.addTilesToSelection([e])}isTileInView(e){let t=this.$container.scrollParent();return t.length===0&&(t=this.$container),!e||!e.$container||!t?!1:v.offsetBounds(e.$container).intersects(v.offsetBounds(t))}_onTileMouseDown(e){if(this._doubleClickSupport.mousedown(e),this._selectTileOnMouseDown(e),e.which===3)return this.showContextMenu({pageX:e.pageX,pageY:e.pageY}),!1}_onTileClick(e){let s=a()(e.currentTarget).data("widget");if(s instanceof Ti||this._doubleClickSupport.doubleClicked())return;let r=e.which;this._triggerTileClick(s,r,e)}_triggerTileClick(e,t,s){this.trigger("tileClick",{tile:e,mouseButton:t,originalEvent:s})}_onTileDoubleClick(e){let s=a()(e.currentTarget).data("widget");s instanceof Ti||this.doTileAction(s)}doTileAction(e){!e||this._triggerTileAction(e)}_triggerTileAction(e){this.trigger("tileAction",{tile:e})}setSelectionHandler(e){this.selectionHandler=e}_selectTileOnMouseDown(e){this.selectionHandler.selectTileOnMouseDown(e)}scrollTo(e,t){this.ensureTileRendered(e),this.htmlComp.layout.updateViewPort(!0),e.reveal(t)}revealSelection(){if(!this.rendered){this.session.layoutValidator.schedulePostValidateFunction(this.revealSelection.bind(this));return}this.selectedTiles.length>0&&this.scrollTo(this.selectedTiles[0])}addFilter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;this.filterSupport.addFilter(e,t)}removeFilter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;this.filterSupport.removeFilter(e,t)}setFilters(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;this.filterSupport.setFilters(e,t)}filter(){this.filterSupport.filter()}_applyFilters(e,t){return this.filterSupport.applyFilters(e.filter(s=>!(s instanceof Ti)),t)}_createFilterSupport(){return new On({widget:this,$container:()=>this.$filterFieldContainer,getElementsForFiltering:this.tilesWithoutPlaceholders.bind(this),createTextFilter:this._createTextFilter.bind(this),updateTextFilterText:this._updateTextFilterText.bind(this)})}_createTextFilter(){return b.isFunction(this.createTextFilter)?this.createTextFilter():new xo}_updateTextFilterText(e,t){return b.isFunction(this.updateTextFilterText)?this.updateTextFilterText(e,t):e instanceof xo?e.setText(t):!1}setTextFilterEnabled(e){this.setProperty("textFilterEnabled",e)}isTextFilterFieldVisible(){return this.textFilterEnabled}_renderTextFilterEnabled(){this._updateTabbable(),this.filterSupport.renderFilterField()}updateFilteredElements(e,t){if(!this.filteredElementsDirty){this._updateEmpty();return}this.setProperty("filteredTiles",this._filterTiles()),this.invalidateLogicalGrid(!1),this.filteredElementsDirty=!1,e&&(e.newlyHidden.some(s=>s===this.focusedTile)&&this.setFocusedTile(null),this.deselectTiles(e.newlyHidden),this.rendered&&!this.removing&&(this._renderTileDelta(e),this._renderTileOrder(this.tiles))),this._updateEmpty()}_updateEmpty(){this.setEmpty(this.filteredTiles.length===0)}setEmpty(e){this.setProperty("empty",e)}_renderEmpty(){this.$container.toggleClass("empty",this.empty),this.invalidateLayoutTree()}_filterTiles(e){return e=u.nvl(e,this.tiles),this.filters.length===0?e.slice():e.filter(t=>t.filterAccepted)}findTileIndexAt(e,t,s,r){return s=u.nvl(s,0),p.findIndexFrom(this.filteredTiles,s,(n,o)=>n.gridData.x===e&&n.gridData.y===t,r)}findTilesInRange(e,t){if(e.equals(this.virtualScrolling.maxViewRange()))return this.filteredTiles;let s=[];for(let r=e.from;r<e.to;r++)this.eachTileInRow(r,n=>{(!t||t(n))&&s.push(n)});return s}findTilesInRow(e){let t=[];return this.eachTileInRow(e,s=>{t.push(s)}),t}eachTileInRow(e,t){let s=e*this.gridColumnCount,r=[];for(let n=s;n<s+this.gridColumnCount;n++)this.filteredTiles[n]&&t(this.filteredTiles[n],n);return r}setVirtual(e){this.setProperty("virtual",e)}_setVirtual(e){this._setProperty("virtual",e),this.virtualScrolling.setEnabled(this.virtual)}_renderVirtual(){this._updateVirtualScrollable(),this.rendering||this.setViewRangeSize(this.calculateViewRangeSize(),!1),this.rendered&&(this._removeAllTiles(),this.virtual&&this._renderFiller()),this.virtual||this._renderAllTiles(),this._renderViewPort(),this.invalidateLayoutTree()}_updateVirtualScrollable(){let e=this.virtualScrolling.$scrollable;if(e&&e.off("scroll",this._scrollParentScrollHandler),!this.virtual||this.removing){this.virtualScrolling.set$Scrollable(null);return}this.scrollable?this.virtualScrolling.set$Scrollable(this.$container):(this.virtualScrolling.set$Scrollable(this.$container.scrollParent()),this.virtualScrolling.$scrollable.on("scroll",this._scrollParentScrollHandler))}calculateViewRangeSize(){return this.virtualScrolling.calculateViewRangeSize()}setViewRangeSize(e,t){this.viewRangeSize!==e&&(this._setProperty("viewRangeSize",e),this.virtualScrolling.setViewRangeSize(e,t))}_heightForRow(e){let t=0,s=this.htmlComp.layout;if(t=s.rowHeight,e!==this.rowCount()-1&&(t+=s.vgap),!Ke.isNumber(t))throw new Error("Calculated height is not a number: "+t);return t}_minRowHeight(){let e=this.htmlComp.layout;return e.rowHeight+e.vgap/2}rowCount(e){return e=u.nvl(e,this.gridColumnCount),Math.ceil(this.filteredTiles.length/e)}_renderViewPort(){if(!this.isAttachedAndRendered()){this._renderViewPortAfterAttach=!0;return}!this.virtual||this.virtualScrolling.renderViewPort()}_renderViewRange(e){if(e.equals(this.viewRangeRendered)){e.size()===0&&this._renderFiller();return}this.viewRangeRendered.subtract(e).filter(r=>r.size()>0).forEach(r=>{this._removeTilesInRange(r)}),e.subtract(this.viewRangeRendered).filter(r=>r.size()>0).forEach(r=>{this._renderTilesInRange(r)}),this._renderFiller()}_renderTilesInRange(e){let t=0,s=0;if(this.filteredTiles.length===0)return;e=this.virtualScrolling.maxViewRange().intersect(e);let o=this.viewRangeRendered.union(e);if(o.length===2)throw new Error("Can only prepend or append rows to the existing range. Existing: "+this.viewRangeRendered+". New: "+o);this.viewRangeRendered=o[0];for(let h=e.from;h<e.to;h++)this.eachTileInRow(h,l.bind(this)),t++;a().log.isTraceEnabled()&&(a().log.trace(t+" new rows rendered from "+e),a().log.trace(this._rowsRenderedInfo()));function l(h){h.rendered||(this._renderTile(h),s++)}}_renderTileDelta(e){if(!this.virtual)return[];let t=this.renderedTiles(),s=this.virtualScrolling.calculateCurrentViewRange(),r=this.findTilesInRange(s),n=p.diff(t,r),o=p.diff(r,t);return e&&e.newlyHidden.forEach(l=>{l.rendered&&this._removeTileByFilter(l)}),n.forEach(l=>{l.remove()}),o.forEach(l=>{this._renderTile(l)}),e&&(this.htmlComp.suppressInvalidate=!0,e.newlyShown.forEach(l=>{l.rendered&&this._renderTileVisibleForFilter(l)}),this.htmlComp.suppressInvalidate=!1),this.viewRangeRendered=s,this._renderFiller(),this.htmlComp.layouting||this.invalidateLayoutTree(),o}_removeTileByFilter(e){e.$container.removeClass("animate-invisible"),e.animateRemoval=!0,e.animateRemovalClass="animate-invisible",e.remove(),this._onAnimatedTileRemove(e),e.animateRemoval=!1,setTimeout(()=>{e.animateRemovalClass="animate-remove"})}_renderTileVisibleForFilter(e){!e.filterAccepted||e.$container.hasClass("animate-visible")||e.removalPending||(e.$container.setVisible(!1),e._renderVisible())}_renderTileOrder(e){let t=!1;this.tiles.forEach((s,r)=>{if(e[r]!==s||t){if(this.virtual&&!s.rendered)return;t=!0,s.$container.appendTo(this.$container)}}),t&&!this.virtual&&this.invalidateLayoutTree()}_rowsRenderedInfo(){let e=this.$container.children(".tile").length,t="("+this.viewRangeRendered+")";return e+" tiles rendered in range "+t}_removeTilesInRange(e){let t=0,s=this.viewRangeRendered.subtract(e);if(s.length===2)throw new Error("Can only remove rows at the beginning or end of the existing range. "+this.viewRangeRendered+". New: "+s);this.viewRangeRendered=s[0];for(let r=e.from;r<e.to;r++)this._removeTilesInRow(r),t++;a().log.isTraceEnabled()&&(a().log.trace(t+" rows removed from "+e+"."),a().log.trace(this._rowsRenderedInfo()))}_removeTilesInRow(e){this.findTilesInRow(e).forEach(s=>{s.remove()})}rowHasRenderedTiles(e){return this.findTilesInRow(e).some(s=>s.rendered&&!s.removing)}ensureTileRendered(e){if(!e.rendered){let t=e.gridData.y;this.virtualScrolling.renderViewRangeForRowIndex(t),this.invalidateLayoutTree()}}_renderFiller(){this.$fillBefore||(this.$fillBefore=this.$container.prependDiv("filler"));let e=this._calculateFillerHeight(new B(0,this.viewRangeRendered.from));this.$fillBefore.cssHeight(e),this.$fillBefore.css("width","100%"),a().log.isTraceEnabled()&&a().log.trace("FillBefore height: "+e),this.$fillAfter||(this.$fillAfter=this.$container.appendDiv("filler")),this.$fillAfter.appendTo(this.$container);let t=this._calculateFillerHeight(new B(this.viewRangeRendered.from,this.viewRangeRendered.to));this.$fillAfter.cssTop(e+t);let s=this._calculateFillerHeight(new B(this.viewRangeRendered.to,this.rowCount()));this.$fillAfter.cssHeight(s),this.$fillAfter.css("width","100%"),a().log.isTraceEnabled()&&a().log.trace("FillAfter height: "+s)}_calculateFillerHeight(e){let t=0;for(let s=e.from;s<e.to;s++)t+=this._heightForRow(s);return t}renderedTiles(){if(!this.rendered)return[];if(!this.virtual)return this.filteredTiles;let e=[];return this.$container.children(".tile").each((t,s)=>{let r=u.widget(s);r.removalPending||e.push(r)}),e}}he($n,"MenuTypes",{EmptySpace:"TileGrid.EmptySpace",SingleSelection:"TileGrid.SingleSelection",MultiSelection:"TileGrid.MultiSelection"});function t$(i,e,t){return e=i$(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function i$(i){var e=s$(i,"string");return typeof e=="symbol"?e:String(e)}function s$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Op extends ke{constructor(){super(),t$(this,"tileFilter",void 0),this.tileFilter=null,this._addRemoteProperties(["selectedTiles"])}_syncSelectedTiles(e){this.addFilterForPropertyName("selectedTiles"),this.widget.selectTiles(e)}_syncTiles(e){this.addFilterForPropertyName("selectedTiles"),this.widget.setTiles(e)}_initProperties(e){super._initProperties(e),b.isNullOrUndefined(e.filteredTiles)||(this.tileFilter=u.create(_h,{tileIds:e.filteredTiles}),e.filters=[this.tileFilter]),delete e.filteredTiles}_syncFilteredTiles(e){b.isNullOrUndefined(e)?(this.widget.removeFilter(this.tileFilter),this.tileFilter=null):(this.tileFilter||(this.tileFilter=u.create(_h),this.widget.addFilter(this.tileFilter,!1)),this.tileFilter.setTileIds(e),this.widget.filter())}_onWidgetTileClick(e){let t={tile:e.tile.id,mouseButton:e.mouseButton};this._send("tileClick",t)}_onWidgetTileAction(e){let t={tile:e.tile.id};this._send("tileAction",t)}_onWidgetEvent(e){e.type==="tileClick"?this._onWidgetTileClick(e):e.type==="tileAction"?this._onWidgetTileAction(e):super._onWidgetEvent(e)}static modifyTileGridPrototype(){!te.get().remote||b.replacePrototypeFunction($n,"_sortWhileInit",function(){this.modelAdapter||this._sortWhileInitOrig()},!0)}}te.addListener("bootstrap",Op.modifyTileGridPrototype);class Bp extends gr{getGridWidgets(){return this.widget.filteredTiles}}function Po(i,e,t){return e=r$(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function r$(i){var e=n$(i,"string");return typeof e=="symbol"?e:String(e)}function n$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class lr extends Gn{constructor(e,t){super(e,t),Po(this,"containerPos",void 0),Po(this,"containerScrollTop",void 0),Po(this,"maxWidth",void 0),Po(this,"tiles",void 0),Po(this,"_calculatingPrimitivePrefSize",void 0),this.containerPos=null,this.containerScrollTop=null,this.tiles=[],this._calculatingPrimitivePrefSize=!1}static getTileDimensions(){if(!(lr._DEFAULT_SIZE instanceof ie)){let e=M.getSize("tile-grid-layout-config","height","height",-1),t=M.getSize("tile-grid-layout-config","width","width",-1),s=M.getSize("tile-grid-layout-config","margin-left","marginLeft",-1),r=M.getSize("tile-grid-layout-config","margin-top","marginTop",-1);lr._DEFAULT_SIZE=new ie(s,r,t,e)}return lr._DEFAULT_SIZE}_initDefaults(){super._initDefaults();let e=lr.getTileDimensions();this.hgap=e.x,this.vgap=e.y,this.columnWidth=e.width,this.rowHeight=e.height,this.maxWidth=-1}updateViewPort(e){let t=this.widget;!t.rendered||(u.nvl(e,!1)||t._renderViewPort(),this._layout(t.$container),t.trigger("layoutAnimationDone"))}layout(e){let t=this.widget.htmlComp,s=t.layouted||this.widget.startupAnimationEnabled&&!this.widget.startupAnimationDone||this.widget.renderAnimationEnabled;this.tiles=this.widget.renderedTiles(),P.setVisible(e,!1),s&&this._storeBounds(this.tiles),this._updateMaxWidth(),this._resetGridColumnCount(),this.widget.invalidateLayout(),this.widget.invalidateLogicalGrid(!1);let r=!1,n=e.outerWidth();for(n=Math.max(n,this.minWidth),t.prefSize().width<=n&&(this._layout(e),r=!0);!r&&this.widget.gridColumnCount>1;)this.widget.gridColumnCount--,this.widget.invalidateLayout(),this.widget.invalidateLogicalGrid(!1),t.prefSize().width<=n&&(this._layout(e),r=!0);if(r||this._layout(e),t.layouted||this.widget._renderScrollTop(),this.widget.virtual&&(!t.layouted||this._sizeChanged(t)||this.widget.withPlaceholders)){this.widget.setViewRangeSize(this.widget.calculateViewRangeSize(),!1);let l=this.widget._renderTileDelta();this._storeBounds(l),p.pushAll(this.tiles,l),this._layout(e)}let o=[];s&&(o=this._animateTiles()),this.widget.startupAnimationDone=!0,o.length>0?a().promiseAll(o).done(this._onAnimationDone.bind(this)):this._onAnimationDone(),this._updateFilterFieldMaxWidth(e)}_sizeChanged(e){return e.sizeCached&&!e.sizeCached.equals(e.size())}_storeBounds(e){e.forEach((t,s)=>{let r=v.cssBounds(t.$container);t.$container.data("oldBounds",r),t.$container.data("was-layouted",t.htmlComp.layouted)})}_validateGridData(e){return e.$comp.removeClass("newly-rendered"),super._validateGridData(e)}_layoutCellBounds(e,t){return this.widget.virtual&&this.widget.$fillBefore&&(t.top+=this.widget.$fillBefore.outerHeight(!0)),super._layoutCellBounds(e,t)}_animateTiles(){let e=this.widget.htmlComp,t=e.$comp;this.containerPos=e.offset(),this.containerScrollTop=t.scrollTop(),P.setVisible(t,!0),P.opacity(t,0);let s=[];return this.tiles.forEach((r,n)=>{if(!r.rendered)return;let o=this._animateTile(r);o&&s.push(o),r.$container.removeData("oldBounds"),r.$container.removeData("was-layouted")}),s}_animateTile(e){let t=this.widget.htmlComp;if(e.$container.stop(),e.$container.hasClass("invisible")||e.$container.hasClass("animate-visible"))return;let s=v.cssBounds(e.$container),r=e.$container.data("oldBounds");if(e instanceof Ti&&!e.$container.data("was-layouted")&&(r=s.clone()),!t.layouted&&(this.widget.startupAnimationDone||!this.widget.startupAnimationEnabled)&&this.widget.renderAnimationEnabled&&(r=new ie(s.x*.95,s.y*.95,s.width,s.height)),!r.equals(s)&&!(!this._inViewport(s)&&!this._inViewport(r))&&!(!e.$container.data("was-layouted")&&!this._inViewport(s)))return this._animateTileBounds(e,r,s)}_inViewport(e){e=e.translate(this.containerPos.x,this.containerPos.y).translate(0,-this.containerScrollTop);let t=new X(e.x,e.y),s=new X(e.x+e.width,e.y+e.height),r=this.widget.$container.scrollParent();return P.isLocationInView(t,r)||P.isLocationInView(s,r)}_onAnimationDone(){this._updateScrollbar(),this.widget.trigger("layoutAnimationDone")}_animateTileBounds(e,t,s){let r=e.$container[0],n=[r.style.overflow,r.style.overflowX,r.style.overflowY],o=()=>{r.style.overflow=n[0],r.style.overflowX=n[1],r.style.overflowY=n[2]},l=[];return e.$container.cssLeftAnimated(t.x,s.x,{start:h=>{l.push(h)},queue:!1}).cssTopAnimated(t.y,s.y,{start:h=>{l.push(h)},queue:!1}).cssWidthAnimated(t.width,s.width,{start:h=>{l.push(h)},queue:!1}).cssHeightAnimated(t.height,s.height,{start:h=>{l.push(h)},queue:!1}),a().promiseAll(l).then(o)}_updateScrollbar(){P.setVisible(this.widget.$container,!0),P.opacity(this.widget.$container,1);let e=this.widget.htmlComp;for(;e;){if(e.scrollable){P.update(e.$comp,!0);break}e=e.getParent()}}_updateMaxWidth(){let e=this.widget.htmlComp;if(e.$comp.cssPaddingRight(null),this.maxWidth<=0)return;let t=e.$comp.cssPaddingRight(),s=e.size(),r=s.width,n=Math.min(s.width,this.maxWidth),o=r-n-e.$comp.cssPaddingLeft()-e.$comp.cssBorderWidthX();o>t&&e.$comp.cssPaddingRight(o)}_resetGridColumnCount(){this.widget.gridColumnCount=this.widget.prefGridColumnCount}preferredLayoutSize(e,t){return t=a().extend({},t),this.widget.virtual?this.virtualPrefSize(e,t):this.primitivePrefSize(e,t)}virtualPrefSize(e,t){let s,r,n=T.get(e).insets(),o=new F,l=this.columnWidth,h=this.rowHeight,d=this.hgap,c=this.vgap;if(t.widthHint){r=Math.floor(t.widthHint/(l+d));let f=r*(l+d);return t.widthHint-f>l&&r++,r=Math.max(Math.min(this.widget.prefGridColumnCount,r),1),s=this.widget.rowCount(r),o.width=t.widthHint,o.height=Math.max(s*h+(s-1)*c,0),o.width+=n.horizontal(),o.height+=n.vertical(),o}return r=this.widget.gridColumnCount,s=this.widget.rowCount(),o.width=Math.max(r*l+(r-1)*d,0),o.height=Math.max(s*h+(s-1)*c,0),o.width+=n.horizontal(),o.height+=n.vertical(),o}primitivePrefSize(e,t){if(!t.widthHint||this._calculatingPrimitivePrefSize)return super.preferredLayoutSize(e,t);this._calculatingPrimitivePrefSize=!0;let s=this._primitivePrefSize(t);return this._calculatingPrimitivePrefSize=!1,s}_primitivePrefSize(e){let t,s=this.widget.htmlComp,r=!1,n=this.widget.gridColumnCount,o=e.widthHint;for(e.removeInsetsFromHints=!1,o+=s.insets().horizontal(),this._resetGridColumnCount(),this.widget.invalidateLayout(),this.widget.invalidateLogicalGrid(!1),t=s.prefSize(e),t.width<=o&&(r=!0);!r&&this.widget.gridColumnCount>1;)this.widget.gridColumnCount--,this.widget.invalidateLayout(),this.widget.invalidateLogicalGrid(!1),t=s.prefSize(e),t.width<=o&&(r=!0);return this.widget.gridColumnCount=n,t}_updateFilterFieldMaxWidth(e){let t=T.get(e),s=t.availableSize().subtract(t.insets()).width;this.widget.$filterFieldContainer.css("--filter-field-max-width",s*.6+"px")}}Po(lr,"_DEFAULT_SIZE",void 0);function o$(i,e,t){return e=l$(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function l$(i){var e=a$(i,"string");return typeof e=="symbol"?e:String(e)}function a$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Qi extends si{constructor(e){super(e),o$(this,"maxWidth",void 0),e=e||{},e.maxWidth>-2&&(this.maxWidth=e.maxWidth)}applyToLayout(e){super.applyToLayout(e),this.maxWidth&&(e.maxWidth=this.maxWidth)}clone(){return new Qi(this)}static ensure(e){return e?e instanceof Qi?e:new Qi(e):null}}function h$(i,e,t){return e=d$(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function d$(i){var e=u$(i,"string");return typeof e=="symbol"?e:String(e)}function u$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class gh{constructor(e){h$(this,"tileGrid",void 0),this.tileGrid=e}selectTileOnMouseDown(e){if(!this.isSelectable())return;let s=a()(e.currentTarget).data("widget");if(s instanceof Ti||s.selected&&e.which===3)return;let r=!0;if(e.ctrlKey&&(r=!s.selected),e.ctrlKey&&this.isMultiSelect()){r?(this.addTilesToSelection(s),this._checkAndSetFocusedTile(e,s)):(this.deselectTile(s),this._checkAndSetFocusedTile(e,null));return}if(e.shiftKey&&this.isMultiSelect()){if(!this.isHorizontalGridActive())return;let n=this.getVisibleTiles(),o=this.getFocusedTile();o||(o=n[0]);let l=this.computeSelectionBetween(n.indexOf(o),n.indexOf(s),!0);l&&(this.selectTiles(l.selectedTiles),this._checkAndSetFocusedTile(e,l.focusedTile));return}r?(this.selectTile(s),this._checkAndSetFocusedTile(e,s)):(this.deselectAllTiles(),this._checkAndSetFocusedTile(e,null))}getFilteredTiles(){return this.tileGrid.filteredTiles}getFilteredTileCount(){return this.tileGrid.filteredTiles.length}getVisibleTiles(){return this.tileGrid.filteredTiles}getVisibleTileCount(){return this.tileGrid.filteredTiles.length}getGridColumnCount(){return this.tileGrid.gridColumnCount}getVisibleGridRowCount(){return this.tileGrid.logicalGrid.gridRows}getVisibleGridX(e){return e.gridData.x}getVisibleGridY(e){return e.gridData.y}getSelectedTiles(){return this.tileGrid.selectedTiles}isSelectable(){return this.tileGrid.selectable}isMultiSelect(){return this.tileGrid.multiSelect}addTilesToSelection(e){this.tileGrid.addTilesToSelection(e)}selectTile(e){this.tileGrid.selectTile(e)}selectTiles(e){this.tileGrid.selectTiles(e)}deselectTile(e){this.tileGrid.deselectTile(e)}deselectTiles(e){this.tileGrid.deselectTiles(e)}deselectAllTiles(){this.tileGrid.deselectAllTiles()}toggleSelection(){this.tileGrid.toggleSelection()}getFocusedTile(){return this.tileGrid.focusedTile}_checkAndSetFocusedTile(e,t){e.isDefaultPrevented()||t&&t.rendered&&t.$container.hasClass("unfocusable")||this.setFocusedTile(t)}setFocusedTile(e){this.tileGrid.setFocusedTile(e)}scrollTo(e){this.tileGrid.scrollTo(e)}scrollToTop(){this.tileGrid.scrollToTop()}scrollToBottom(){this.tileGrid.scrollToBottom()}findVisibleTileIndexAt(e,t,s,r){return this.tileGrid.findTileIndexAt(e,t,s,r)}getTileGridByRow(e){return e<0||e>=this.getVisibleGridRowCount()?null:this.tileGrid}isHorizontalGridActive(){return this.tileGrid.logicalGrid instanceof Gr}computeSelectionX(e,t){let s=this.getVisibleTiles(),r=null,n=-1,o=this._computeFocusedTile(e);return o.selectedTiles!==null?o:(r=o.focusedTile,n=s.indexOf(r),this.computeSelectionBetween(n,n+e,t))}computeSelectionY(e,t){let s=this.getVisibleTiles(),r=null,n=-1,o=-1,l=-1,h=this.getVisibleGridRowCount(),d=this._computeFocusedTile(e);if(d.selectedTiles!==null)return d;if(r=d.focusedTile,l=s.indexOf(r),n=this.getVisibleGridY(r),o=this.getVisibleGridX(r),e>0&&n===h-1||e<0&&n===0)return;let c=this.findVisibleTileIndexAt(o,n+e,l,e<0);if(c<0){let f=this.getTileGridByRow(n+e);if(!f)return;c=s.indexOf(p.last(f.filteredTiles))}return this.computeSelectionBetween(l,c,t)}computeSelectionToFirst(e){let t=this.getVisibleTiles(),s=this.getFocusedTile(),r=-1,n=this.getSelectedTiles();return n.length===0?(s=p.first(t),{selectedTiles:[s],focusedTile:s}):(s||(s=p.last(n)),r=t.indexOf(s),this.computeSelectionBetween(r,0,e))}computeSelectionToLast(e){let t=this.getVisibleTiles(),s=this.getFocusedTile(),r=-1,n=this.getSelectedTiles();return n.length===0?(s=p.last(t),{selectedTiles:[s],focusedTile:s}):(s||(s=p.last(n)),r=t.indexOf(s),this.computeSelectionBetween(r,t.length-1,e))}_computeFocusedTile(e){let t=this.getVisibleTiles(),s=this.getSelectedTiles(),r=this.getFocusedTile();return s.length===0?(e>0?r=p.first(t):r=p.last(t),{focusedTile:r,selectedTiles:[r]}):(r||(e>0?r=p.last(s):r=p.first(s)),{focusedTile:r,selectedTiles:null})}computeSelectionBetween(e,t,s){let r=this.getVisibleTiles(),n=this.getSelectedTiles(),o=r[t];if(e<0||e>r.length-1||t<0||t>r.length-1||e===t)return;if(!s)return{selectedTiles:[o],focusedTile:o};let l=[];return o.selected?t>e?(l=n.slice(),p.removeAll(l,r.slice(e,t))):(l=n.slice(),p.removeAll(l,r.slice(t+1,e+1))):t>e?(l=p.union(n,r.slice(e,t+1)),o=this._findLastSelectedTileAfter(r,t)):(l=p.union(r.slice(t,e+1),n),o=this._findLastSelectedTileBefore(r,t)),{selectedTiles:l,focusedTile:o}}executeSelection(e){if(!!e){if(e.selectedTiles.length>0){this.selectTiles(e.selectedTiles),this.scrollTo(e.focusedTile);let t=this.getVisibleGridY(e.focusedTile),s=this.getVisibleGridRowCount();t===0?this.scrollToTop():t===s-1&&this.scrollToBottom()}this.setFocusedTile(e.focusedTile)}}_findLastSelectedTileBefore(e,t){if(t===0)return e[t];let s=p.findFromReverse(e,t,(r,n)=>{let o=e[n-1];return o?!o.selected:!1});return s||(s=e[0]),s}_findLastSelectedTileAfter(e,t){if(t===e.length-1)return e[t];let s=p.findFrom(e,t,(r,n)=>{let o=e[n+1];return o?!o.selected:!1});return s||(s=e[e.length-1]),s}}function kp(i,e,t){return e=c$(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function c$(i){var e=p$(i,"string");return typeof e=="symbol"?e:String(e)}function p$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class xo{constructor(){kp(this,"text",void 0),kp(this,"_htmlTileContentChangeHandler",void 0),kp(this,"_tilePropertyChangeHandler",void 0),this.text=null,this._htmlTileContentChangeHandler=this._onHtmlTileContentChange.bind(this),this._tilePropertyChangeHandler=this._onTilePropertyChange.bind(this)}setText(e){return e=e||"",e=e.toLowerCase(),b.equals(this.text,e)?!1:(this.text=e,!0)}accept(e){if(y.empty(this.text))return!0;let s=this._plainTextForTile(e).trim().toLowerCase();return y.empty(s)?!1:s.indexOf(this.text)>-1}_plainTextForTile(e){if(e.plainText)return e.plainText;if(e instanceof Np)return e.plainText=y.plainText(e.content)||"",e.one("propertyChange:content",this._htmlTileContentChangeHandler),e.plainText;if(!e.parent.rendered)return"";let t=!1;return e.rendered||(e.render(),t=!0),e.plainText=y.plainText(e.$container.html())||"",t&&e.remove(),e.on("propertyChange",this._tilePropertyChangeHandler),e.plainText}_onHtmlTileContentChange(e){delete e.source.plainText}_onTilePropertyChange(e){e.propertyName!=="filterAccepted"&&(delete e.source.plainText,e.source.off("propertyChange",this._tilePropertyChangeHandler))}}function f$(i,e,t){return e=m$(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function m$(i){var e=g$(i,"string");return typeof e=="symbol"?e:String(e)}function g$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Hp extends Vt{constructor(){super(),f$(this,"widgets",void 0),this.widgets=[],this._addWidgetProperties(["widgets"])}_render(){this.$container=this.$parent.appendDiv(),this.htmlComp=T.install(this.$container,this.session)}_renderProperties(){super._renderProperties(),this._renderWidgets()}setWidgets(e){this.setProperty("widgets",e)}_renderWidgets(){this.widgets.forEach(e=>{e.render()}),this.invalidateLayoutTree()}}function _$(i,e,t){return e=y$(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function y$(i){var e=b$(i,"string");return typeof e=="symbol"?e:String(e)}function b$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Np extends Vt{constructor(){super(),_$(this,"content",void 0),this.content=null}_render(){this.$container=this.$parent.appendDiv("html-tile"),this.htmlComp=T.install(this.$container,this.session)}_renderProperties(){super._renderProperties(),this._renderContent()}setContent(e){this.setProperty("content",e)}_renderContent(){if(!this.content){this.$container.empty();return}this.$container.html(this.content),this.$container.find("img").on("load",this._onImageLoad.bind(this)).on("error",this._onImageError.bind(this)),this.invalidateLayoutTree()}_onImageLoad(e){this.invalidateLayoutTree()}_onImageError(e){this.invalidateLayoutTree()}}class N_ extends So{}function v$(i,e,t){return e=w$(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function w$(i){var e=T$(i,"string");return typeof e=="symbol"?e:String(e)}function T$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class V_ extends Vt{constructor(){super(),v$(this,"bean",void 0),this.bean=null}_render(){this.$container=this.$parent.appendDiv("bean-tile"),this.htmlComp=T.install(this.$container,this.session)}_renderProperties(){super._renderProperties(),this._renderBean()}_renderBean(){}triggerAppLinkAction(e){this.trigger("appLinkAction",{ref:e})}_onAppLinkAction(e){let s=a()(e.delegateTarget).data("ref");this.triggerAppLinkAction(s)}}class W_ extends So{_onWidgetAppLinkAction(e){this._send("appLinkAction",{ref:e.ref})}_onWidgetEvent(e){e.type==="appLinkAction"?this._onWidgetAppLinkAction(e):super._onWidgetEvent(e)}}function Ft(i,e,t){return e=C$(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function C$(i){var e=S$(i,"string");return typeof e=="symbol"?e:String(e)}function S$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Vp extends gd{constructor(){super(),Ft(this,"gridColumnCount",void 0),Ft(this,"multiSelect",void 0),Ft(this,"selectable",void 0),Ft(this,"takeTileFiltersFromGroup",void 0),Ft(this,"tileComparator",void 0),Ft(this,"filters",void 0),Ft(this,"tileGridLayoutConfig",void 0),Ft(this,"tileGridSelectionHandler",void 0),Ft(this,"withPlaceholders",void 0),Ft(this,"virtual",void 0),Ft(this,"textFilterEnabled",void 0),Ft(this,"filterSupport",void 0),Ft(this,"createTextFilter",void 0),Ft(this,"updateTextFilterText",void 0),Ft(this,"$filterFieldContainer",void 0),Ft(this,"_selectionUpdateLocked",void 0),Ft(this,"_tileGridPropertyChangeHandler",void 0),Ft(this,"_groupBodyHeightChangeHandler",void 0),this.exclusiveExpand=!1,this.gridColumnCount=null,this.multiSelect=null,this.selectable=null,this.takeTileFiltersFromGroup=!0,this.tileComparator=null,this.filters=[],this.tileGridLayoutConfig=null,this.tileGridSelectionHandler=new zp(this),this.withPlaceholders=null,this.virtual=null,this.$filterFieldContainer=null,this.textFilterEnabled=!1,this.filterSupport=this._createFilterSupport(),this.createTextFilter=null,this.updateTextFilterText=null,this._selectionUpdateLocked=!1,this._tileGridPropertyChangeHandler=this._onTileGridPropertyChange.bind(this),this._groupBodyHeightChangeHandler=this._onGroupBodyHeightChange.bind(this)}_render(){super._render(),this.$container.addClass("tile-accordion"),this.$filterFieldContainer=this.$container.prependDiv("filter-field-container")}_createLayout(){return new Wp(this)}_renderProperties(){super._renderProperties(),this._renderTextFilterEnabled()}_remove(){this.filterSupport.remove(),super._remove()}_init(e){super._init(e),this.setFilters(this.filters)}_createKeyStrokeContext(){return new Oe}_initGroup(e){super._initGroup(e),e.body.setSelectionHandler(this.tileGridSelectionHandler),this.gridColumnCount!==null&&e.body.setGridColumnCount(this.gridColumnCount),this.setProperty("gridColumnCount",e.body.gridColumnCount),this.multiSelect!==null&&e.body.setMultiSelect(this.multiSelect),this.setProperty("multiSelect",e.body.multiSelect),this.selectable!==null&&e.body.setSelectable(this.selectable),this.setProperty("selectable",e.body.selectable),this.tileGridLayoutConfig!==null&&e.body.setLayoutConfig(this.tileGridLayoutConfig),this.setProperty("tileGridLayoutConfig",e.body.layoutConfig),this.tileComparator!==null&&(e.body.setComparator(this.tileComparator),e.body.sort()),this.setProperty("tileComparator",e.body.comparator),this.filters.length>0&&e.body.addFilter(this.filters),this.takeTileFiltersFromGroup&&this.setFilters(e.body.filters),this.withPlaceholders!==null&&e.body.setWithPlaceholders(this.withPlaceholders),this.setProperty("withPlaceholders",e.body.withPlaceholders),this.virtual!==null&&e.body.setVirtual(this.virtual),this.setProperty("virtual",e.body.virtual),e.body.selectedTiles.length>0&&this._handleSelectionChanged(e.body),e.body.on("propertyChange",this._tileGridPropertyChangeHandler),this._handleCollapsed(e),e.body.__tileAccordionEventDelegator=is.create(e.body,this,{delegateEvents:["tileClick","tileAction"]})}_deleteGroup(e){e.body&&(e.body.off("propertyChange",this._tileGridPropertyChangeHandler),e.body.__tileAccordionEventDelegator.destroy(),e.body.__tileAccordionEventDelegator=null),super._deleteGroup(e)}setGroups(e){let t=this.getTileCount(),s=this.getFilteredTileCount(),r=this.getSelectedTileCount();super.setGroups(e);let n=this.getTileCount(),o=this.getFilteredTileCount(),l=this.getSelectedTileCount();n!==t&&this.triggerPropertyChange("tiles",null,null),o!==s&&this.triggerPropertyChange("filteredTiles",null,null),l!==r&&this.triggerPropertyChange("selectedTiles",null,null)}setGridColumnCount(e){this.groups.forEach(t=>{t.body.setGridColumnCount(e)}),this.setProperty("gridColumnCount",e)}setTileGridLayoutConfig(e){this.groups.forEach(t=>{t.body.setLayoutConfig(e),e=t.body.layoutConfig}),this.setProperty("tileGridLayoutConfig",e)}setWithPlaceholders(e){this.groups.forEach(t=>{t.body.setWithPlaceholders(e)}),this.setProperty("withPlaceholders",e)}setVirtual(e){this.groups.forEach(t=>{t.body.setVirtual(e)}),this.setProperty("virtual",e)}setSelectable(e){this.groups.forEach(t=>{t.body.setSelectable(e)}),this.setProperty("selectable",e)}setMultiSelect(e){this.groups.forEach(t=>{t.body.setMultiSelect(e)}),this.setProperty("multiSelect",e)}getGroupById(e){return p.find(this.groups,t=>t.id===e)}getGroupByTile(e){return e.findParent(t=>t instanceof mi)}_groupTiles(e){let t={};return this.groups.forEach(s=>{t[s.id]=[]}),e.forEach(function(s){let r=this.getGroupByTile(s);if(!r)throw new Error("No group found for tile "+s.id);t[r.id]||(t[r.id]=[]),t[r.id].push(s)},this),t}deleteTile(e){this.deleteTiles([e])}deleteTiles(e){if(e=p.ensure(e),e.length===0)return;let t=this.getTiles();p.removeAll(t,e),this.setTiles(t)}deleteAllTiles(){this.setTiles([])}setTiles(e){let t=p.ensure(e);if(b.equals(this.getTiles(),t))return;let s=this._createChildren(t),r=this._groupTiles(s);for(let n in r)this.getGroupById(n).body.setTiles(r[n])}getTiles(){let e=[];return this.groups.forEach(t=>{p.pushAll(e,t.body.tiles)}),e}getTileCount(){let e=0;return this.groups.forEach(t=>{e+=t.body.tiles.length}),e}addFilter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;this.filterSupport.addFilter(e,t)}removeFilter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;this.filterSupport.removeFilter(e,t)}setFilters(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;this.filterSupport.setFilters(e,t)}_setFilters(e){let t=p.ensure(e);this.groups.forEach(s=>{s.body.setFilters(t.slice(),!1)}),this._setProperty("filters",t.slice())}filter(){this.filterSupport.filter()}_filter(){return this.groups.forEach(e=>e.body.filter()),null}_createFilterSupport(){return new On({widget:this,$container:()=>this.$filterFieldContainer,filterElements:this._filter.bind(this),createTextFilter:this._createTextFilter.bind(this),updateTextFilterText:this._updateTextFilterText.bind(this)})}_createTextFilter(){return b.isFunction(this.createTextFilter)?this.createTextFilter():new xo}_updateTextFilterText(e,t){return b.isFunction(this.updateTextFilterText)?this.updateTextFilterText(e,t):e instanceof xo?e.setText(t):!1}setTextFilterEnabled(e){this.setProperty("textFilterEnabled",e)}isTextFilterFieldVisible(){return this.textFilterEnabled}_renderTextFilterEnabled(){this.filterSupport.renderFilterField()}getFilteredTiles(){let e=[];return this.groups.forEach(t=>{p.pushAll(e,t.body.filteredTiles)}),e}getFilteredTileCount(){let e=0;return this.groups.forEach(t=>{e+=t.body.filteredTiles.length}),e}getVisibleTiles(){let e=[];return this.expandedGroups().forEach(t=>{p.pushAll(e,t.body.filteredTiles)}),e}getVisibleTileCount(){let e=0;return this.expandedGroups().forEach(t=>{e+=t.body.filteredTiles.length}),e}findVisibleTileIndexAt(e,t,s,r){return s=u.nvl(s,0),p.findIndexFrom(this.getVisibleTiles(),s,(n,o)=>this.getVisibleGridX(n)===e&&this.getVisibleGridY(n)===t,r)}selectTiles(e){e=p.ensure(e);let t=this._groupTiles(e);for(let s in t)this.getGroupById(s).body.selectTiles(t[s])}selectTile(e){this.selectTiles([e])}selectAllTiles(){this.selectTiles(this.getVisibleTiles())}deselectTiles(e){e=p.ensure(e);let t=this.getSelectedTiles().slice();p.removeAll(t,e)&&this.selectTiles(t)}deselectTile(e){this.deselectTiles([e])}deselectAllTiles(){this.selectTiles([])}addTilesToSelection(e){e=p.ensure(e),this.selectTiles(this.getSelectedTiles().concat(e))}addTileToSelection(e){this.addTilesToSelection([e])}getSelectedTiles(){let e=[];return this.groups.forEach(t=>{p.pushAll(e,t.body.selectedTiles)}),e}getSelectedTile(){return this.getSelectedTiles()[0]}getSelectedTileCount(){let e=0;return this.groups.forEach(t=>{e+=t.body.selectedTiles.length}),e}toggleSelection(){this.getSelectedTileCount()===this.getVisibleTileCount()?this.deselectAllTiles():this.selectAllTiles()}setTileComparator(e){this.groups.forEach(t=>{t.body.setComparator(e)}),this.setProperty("tileComparator",e)}sortTiles(){this.groups.forEach(e=>{e.body.sort()})}setFocusedTile(e){let t=null;e!==null&&(t=this.getGroupByTile(e)),this.groups.forEach(s=>{s===t?s.body.setFocusedTile(e):s.body.setFocusedTile(null)})}getFocusedTile(){let e=null;return this.groups.some(t=>t.body.focusedTile?(e=t.body.focusedTile,!0):!1),e}getVisibleGridRowCount(){return this.expandedGroups().reduce((e,t)=>e+t.body.logicalGrid.gridRows,0)}getVisibleGridX(e){return e.gridData.x}getVisibleGridY(e){let t=this.getGroupByTile(e),s=this.getVisibleRowByGroup(t);return e.gridData.y+s}getGroupByVisibleRow(e){if(e<0||e>=this.getVisibleGridRowCount())return null;let t=0;return p.find(this.expandedGroups(),s=>{let r=s.body.logicalGrid.gridRows;if(t<=e&&e<t+r)return!0;t+=r})}getVisibleRowByGroup(e){let t=0;return this.expandedGroups().some(r=>{let n=r.body.logicalGrid.gridRows;return r===e?!0:(t+=n,!1)})?t:-1}expandedGroups(){return this.groups.filter(e=>!e.collapsed)}_handleSelectionChanged(e){if(this._selectionUpdateLocked)return;let t=e.parent;if(e.selectedTiles.length>0&&t.collapsed){e.deselectAllTiles();return}!this.multiSelect&&e.selectedTiles.length>0&&(this._selectionUpdateLocked=!0,this.groups.forEach(s=>{s.body!==e&&s.body.deselectAllTiles()}),this._selectionUpdateLocked=!1)}_onTileGridPropertyChange(e){e.propertyName==="selectedTiles"?(this._handleSelectionChanged(e.source),this.triggerPropertyChange("selectedTiles",null,null)):e.propertyName==="filteredTiles"?this.triggerPropertyChange("filteredTiles",null,null):e.propertyName==="tiles"&&this.triggerPropertyChange("tiles",null,null)}_onGroupCollapsedChange(e){super._onGroupCollapsedChange(e),this._handleCollapsed(e.source)}_handleCollapsed(e){e.collapsed&&e.body.deselectAllTiles(),e.rendered&&(e.on("bodyHeightChange",this._groupBodyHeightChangeHandler),e.one("bodyHeightChangeDone",this._onGroupBodyHeightChangeDone.bind(this)))}_onGroupBodyHeightChange(e){this.groups.forEach(t=>{e.source===t||t.bodyAnimating||t.body.virtual&&t.body.htmlComp&&t.body.htmlComp.layout.updateViewPort()})}_onGroupBodyHeightChangeDone(e){e.source.off("bodyHeightChange",this._groupBodyHeightChangeHandler)}tileAtScrollTop(e){return p.find(this.getTiles().filter(t=>t.rendered),t=>t.$container.position().top>=e)}}class z_ extends _d{_initProperties(e){super._initProperties(e),e.takeTileFiltersFromGroup=!1}}function P$(i,e,t){return e=x$(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function x$(i){var e=E$(i,"string");return typeof e=="symbol"?e:String(e)}function E$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Wp extends na{constructor(e,t){super(t),P$(this,"tileAccordion",void 0),this.tileAccordion=e}layout(e){let t=this.tileAccordion.groups.map(s=>s.body).map(s=>this._getTileGridHeight(s));super.layout(e),this._updateFilterFieldMaxWidth(e),this.tileAccordion.groups.map(s=>s.body).forEach((s,r)=>this._updateTileGridViewPort(s,t[r]))}_updateTileGridViewPort(e,t){if(!e.rendered||!e.htmlComp||t<=0)return;let s=this._getTileGridHeight(e);t===s&&e.virtual&&(e.setViewRangeSize(e.calculateViewRangeSize(),!1),e.htmlComp.layout.updateViewPort())}_getTileGridHeight(e){if(!e||!e.htmlComp)return 0;let s=e.htmlComp.sizeCached;return s?s.height:0}_updateFilterFieldMaxWidth(e){let t=T.get(e),s=t.availableSize().subtract(t.insets()).width;this.tileAccordion.$filterFieldContainer.css("--filter-field-max-width",s*.6+"px")}}function F$(i,e,t){return e=D$(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function D$(i){var e=A$(i,"string");return typeof e=="symbol"?e:String(e)}function A$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class zp extends gh{constructor(e){super(e),F$(this,"tileAccordion",void 0),this.tileAccordion=e}getFilteredTiles(){return this.tileAccordion.getFilteredTiles()}getFilteredTileCount(){return this.tileAccordion.getFilteredTileCount()}getVisibleTiles(){return this.tileAccordion.getVisibleTiles()}getVisibleTileCount(){return this.tileAccordion.getVisibleTileCount()}getSelectedTiles(){return this.tileAccordion.getSelectedTiles()}getFocusedTile(){return this.tileAccordion.getFocusedTile()}getVisibleGridRowCount(){return this.tileAccordion.getVisibleGridRowCount()}getVisibleGridX(e){return this.tileAccordion.getVisibleGridX(e)}getVisibleGridY(e){return this.tileAccordion.getVisibleGridY(e)}scrollTo(e){this.tileAccordion.getGroupByTile(e).body.scrollTo(e)}getTileGridByRow(e){let t=this.tileAccordion.getGroupByVisibleRow(e);return t?t.body:null}findVisibleTileIndexAt(e,t,s,r){return this.tileAccordion.findVisibleTileIndexAt(e,t,s,r)}isHorizontalGridActive(){return this.tileAccordion.groups.length===0?!1:this.tileAccordion.groups[0].body.logicalGrid instanceof Gr}}class ar extends O{constructor(e){super(),this.field=e,this.shift=e.multiSelect?void 0:!1,this.renderingHints.$drawingArea=(t,s)=>{let r=this._computeNewSelection();if(r&&r.focusedTile)return r.focusedTile.$container},this.inheritAccessibility=!1}getSelectionHandler(){return this.field.selectionHandler}_accept(e){return!(!super._accept(e)||!this.getSelectionHandler().isSelectable()||this.getSelectionHandler().getFilteredTileCount()===0)}handle(e){this.getSelectionHandler().executeSelection(this._computeNewSelection(e.shiftKey))}_computeNewSelection(e){return null}}class Kp extends ar{constructor(e){super(e),this.ctrl=!0,this.shift=!1,this.which=[g.A],this.renderingHints.$drawingArea=(t,s)=>{let r=this.getSelectionHandler().getVisibleTiles()[0];if(r)return r.$container}}_accept(e){return!(!super._accept(e)||!this.getSelectionHandler().isMultiSelect())}handle(e){this.getSelectionHandler().toggleSelection()}}class Gp extends ar{constructor(e){super(e),this.stopPropagation=!0,this.repeatable=!0,this.which=[g.LEFT],this.renderingHints.text=""}_accept(e){return!(!super._accept(e)||!this.getSelectionHandler().isHorizontalGridActive())}_computeNewSelection(e){return this.getSelectionHandler().computeSelectionX(-1,e)}}class Up extends ar{constructor(e){super(e),this.stopPropagation=!0,this.repeatable=!0,this.which=[g.RIGHT],this.renderingHints.text=""}_accept(e){return!(!super._accept(e)||!this.getSelectionHandler().isHorizontalGridActive())}_computeNewSelection(e){return this.getSelectionHandler().computeSelectionX(1,e)}}class qp extends ar{constructor(e){super(e),this.stopPropagation=!0,this.repeatable=!0,this.which=[g.DOWN],this.renderingHints.text=""}_accept(e){return!(!super._accept(e)||!this.getSelectionHandler().isHorizontalGridActive())}_computeNewSelection(e){return this.getSelectionHandler().computeSelectionY(1,e)}}class Yp extends ar{constructor(e){super(e),this.stopPropagation=!0,this.repeatable=!0,this.which=[g.UP],this.renderingHints.text=""}_accept(e){return!(!super._accept(e)||!this.getSelectionHandler().isHorizontalGridActive())}_computeNewSelection(e){return this.getSelectionHandler().computeSelectionY(-1,e)}}class jp extends ar{constructor(e){super(e),this.stopPropagation=!0,this.which=[g.HOME]}_accept(e){return!(!super._accept(e)||!this.getSelectionHandler().isHorizontalGridActive())}_computeNewSelection(e){return this.getSelectionHandler().computeSelectionToFirst(e)}}class Xp extends ar{constructor(e){super(e),this.stopPropagation=!0,this.which=[g.END]}_accept(e){return!(!super._accept(e)||!this.getSelectionHandler().isHorizontalGridActive())}_computeNewSelection(e){return this.getSelectionHandler().computeSelectionToLast(e)}}function K_(i,e,t){return e=$$(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function $$(i){var e=R$(i,"string");return typeof e=="symbol"?e:String(e)}function R$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class _h{constructor(e){K_(this,"synthetic",void 0),K_(this,"tileMap",void 0),e=e||{},this.synthetic=!0,this.tileMap={},e.tileIds&&this.setTileIds(e.tileIds)}setTileIds(e){this.tileMap={},e.forEach(t=>{this.tileMap[t]=t})}accept(e){return!!this.tileMap[e.id]}}function G_(i,e,t){return e=M$(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function M$(i){var e=I$(i,"string");return typeof e=="symbol"?e:String(e)}function I$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Jp extends Vt{constructor(){super(),G_(this,"tileWidget",void 0),G_(this,"_widgetPropertyChangeHandler",void 0),this.tileWidget=null,this._addWidgetProperties(["tileWidget"]),this._widgetPropertyChangeHandler=this._onWidgetPropertyChange.bind(this)}_init(e){super._init(e),this._setTileWidget(this.tileWidget)}_destroy(){this.tileWidget&&this.tileWidget.off("propertyChange",this._widgetPropertyChangeHandler),super._destroy()}_renderProperties(){super._renderProperties(),this._renderTileWidget()}_renderTileWidget(){this.tileWidget&&this.tileWidget.render()}_removeTileWidget(){this.tileWidget&&this.tileWidget.remove()}_onWidgetPropertyChange(e){e.propertyName==="visible"?this.setVisible(e.newValue):e.propertyName==="enabled"?this.setEnabled(e.newValue):e.propertyName==="disabledStyle"&&this.setDisabledStyle(e.newValue)}_setTileWidget(e){this.tileWidget&&this.tileWidget.off("propertyChange",this._widgetPropertyChangeHandler),this._setProperty("tileWidget",e),e&&(this.tileWidget.visible||this.setVisible(!1),this.tileWidget.enabled||this.setEnabled(!1),this.tileWidget.disabledStyle!==I.DisabledStyle.DEFAULT&&this.setDisabledStyle(this.tileWidget.disabledStyle),this.tileWidget.on("propertyChange",this._widgetPropertyChangeHandler)),this.invalidateLayoutTree()}}class U_ extends So{}class Ti extends Vt{constructor(){super(),this.cssClass="placeholder-tile",this.displayStyle=Vt.DisplayStyle.PLAIN}_setSelectable(e){super._setSelectable(!1)}}function L$(i,e,t){return e=O$(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function O$(i){var e=B$(i,"string");return typeof e=="symbol"?e:String(e)}function B$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Hi extends Jp{constructor(){super(),this.displayStyle=Hi.DisplayStyle.DASHBOARD}_renderProperties(){super._renderProperties(),this._renderFieldLabelVisible(),this._renderCompact()}_renderTileWidget(){super._renderTileWidget(),this.displayStyle===Hi.DisplayStyle.DASHBOARD&&this.tileWidget&&this.tileWidget.htmlComp&&this.tileWidget.htmlComp.layout instanceof oi&&(this.tileWidget.htmlComp.layout.statusWidth=0)}_renderDisplayStyle(){super._renderDisplayStyle(),this.$container.toggleClass("dashboard",this.displayStyle===Hi.DisplayStyle.DASHBOARD)}_renderFieldLabelVisible(){this.displayStyle===Hi.DisplayStyle.DASHBOARD&&this.tileWidget instanceof bn&&this.tileWidget.$container.toggleClass("no-padding",!this.tileWidget.labelVisible&&!this.tileWidget.errorStatus)}_renderCompact(){this.$container.toggleClass("compact",x.get().type===x.Type.MOBILE)}_onWidgetPropertyChange(e){super._onWidgetPropertyChange(e),(e.propertyName==="labelVisible"||e.propertyName==="errorStatus")&&this.rendered&&this._renderFieldLabelVisible()}}L$(Hi,"DisplayStyle",{DEFAULT:Vt.DisplayStyle.DEFAULT,PLAIN:Vt.DisplayStyle.PLAIN,DASHBOARD:"dashboard"});class q_ extends So{}class Qp extends Hi{_render(){super._render(),this.$container.addClass("button-tile")}}function k$(i,e,t){return e=H$(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function H$(i){var e=N$(i,"string");return typeof e=="symbol"?e:String(e)}function N$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Pl extends Re{constructor(){super(),k$(this,"$iconContainer",void 0),this.processButton=!1,this.$iconContainer=null}_render(){if(this.parent.displayStyle!==Hi.DisplayStyle.DASHBOARD){super._render();return}let e=this.$parent.makeDiv();this.$buttonLabel=e.appendSpan("label"),this.addContainer(this.$parent,"tile-button"),this.addField(e),this.htmlComp.setLayout(new Yn),this.$container.on("click",this._onClick.bind(this)).unfocusable()}_remove(){this.$iconContainer=null,super._remove()}_renderIconId(){if(this.parent.displayStyle!==Hi.DisplayStyle.DASHBOARD){super._renderIconId();return}this.$field.removeClass("with-icon without-icon"),this.iconId?(this.$iconContainer||(this.$iconContainer=this.$field.prependDiv("icon-container")),this.$iconContainer.icon(this.iconId),this.$field.addClass("with-icon")):(this.$iconContainer&&(this.$iconContainer.remove(),this.$iconContainer=null),this.$field.addClass("without-icon")),this.invalidateLayoutTree()}_renderTooltipText(){y.hasText(this.tooltipText)?K.install(this.$container,{parent:this,text:this.tooltipText}):K.uninstall(this.$container)}}class Y_ extends Mc{_render(){super._render(),this.$container.addClass("scrollbar-y-outside")}_installScrollbars(e){super._installScrollbars($.extend(!0,{},e,{scrollShadow:"gradient"}))}}function yh(i,e,t){return e=V$(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function V$(i){var e=W$(i,"string");return typeof e=="symbol"?e:String(e)}function W$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class j_ extends Fn{constructor(){super(),yh(this,"_tableBlurHandler",void 0),yh(this,"_tableFocusHandler",void 0),yh(this,"_menuBarPropertyChangeHandler",void 0),yh(this,"_documentMouseDownHandler",void 0),this._tableBlurHandler=this._onTableBlur.bind(this),this._tableFocusHandler=this._onTableFocus.bind(this),this._menuBarPropertyChangeHandler=this._onMenuBarPropertyChange.bind(this),this._documentMouseDownHandler=this._onDocumentMouseDown.bind(this)}_render(){super._render(),this.session.focusManager.restrictedFocusGain||this.$container.document(!0).addEventListener("mousedown",this._documentMouseDownHandler,!0)}_remove(){this.$container.document(!0).removeEventListener("mousedown",this._documentMouseDownHandler,!0),super._remove()}_renderTable(){super._renderTable(),this.parent.displayStyle===Hi.DisplayStyle.DASHBOARD&&this.table&&(this.table.$container.on("blur",this._tableBlurHandler).on("focus",this._tableFocusHandler),this.table.menuBar.on("propertyChange",this._menuBarPropertyChangeHandler),this._toggleHasMenuBar(),document.activeElement!==this.table.$container[0]&&this._hideMenuBar(!0))}_removeTable(){this.parent.displayStyle===Hi.DisplayStyle.DASHBOARD&&(this.table&&(this.table.$container.off("blur",this._tableBlurHandler).off("focus",this._tableFocusHandler),this.table.menuBar.off("propertyChange",this._menuBarPropertyChangeHandler)),super._removeTable())}_onTableBlur(e){let t=a()(".popup").data("widget");this.has(t)||this._hideMenuBar(!0)}_onTableFocus(e){this._hideMenuBar(!1)}_hideMenuBar(e){this.table.menuBar.hiddenByUi=e,this.table.menuBar.updateVisibility()}_onMenuBarPropertyChange(e){e.propertyName==="visible"&&this._toggleHasMenuBar()}_toggleHasMenuBar(){!this.rendered&&!this.rendering||this.$container.toggleClass("has-menubar",this.table.menuBar.visible)}_onDocumentMouseDown(e){let t=a()(".popup"),s=t.data("widget");this.table&&s&&this.table.has(s)&&t.has(e.target)&&e.preventDefault()}}function ct(i,e,t){return e=z$(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function z$(i){var e=K$(i,"string");return typeof e=="symbol"?e:String(e)}function K$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class bh extends I{constructor(){super(),ct(this,"view",void 0),ct(this,"title",void 0),ct(this,"subTitle",void 0),ct(this,"iconId",void 0),ct(this,"closable",void 0),ct(this,"saveNeeded",void 0),ct(this,"saveNeededVisible",void 0),ct(this,"status",void 0),ct(this,"selected",void 0),ct(this,"$title",void 0),ct(this,"$subTitle",void 0),ct(this,"$iconContainer",void 0),ct(this,"$statusContainer",void 0),ct(this,"$close",void 0),ct(this,"$titleLine",void 0),ct(this,"$saveNeeded",void 0),ct(this,"$statusIcons",void 0),ct(this,"_statusContainerUsageCounter",void 0),ct(this,"_viewPropertyChangeListener",void 0),ct(this,"_viewRemoveListener",void 0),ct(this,"_glassPaneContribution",void 0),this.view=null,this.title=null,this.subTitle=null,this.iconId=null,this.cssClass=null,this.closable=!1,this.saveNeeded=!1,this.saveNeededVisible=!1,this.status=null,this.selected=!1,this.$title=null,this.$subTitle=null,this.$iconContainer=null,this.$statusContainer=null,this.$statusIcons=[],this._statusContainerUsageCounter=0,this._viewPropertyChangeListener=this._onViewPropertyChange.bind(this),this._viewRemoveListener=this._onViewRemove.bind(this),this._glassPaneContribution=e=>this.$close?(this.$close.addClass("glasspane-parent"),this.$close):null}_init(e){super._init(e),this.view=e.view,this.title=this.view?this.view.title:e.title,this.subTitle=this.view?this.view.subTitle:e.subTitle,this.iconId=this.view?this.view.iconId:e.iconId,this.cssClass=this.view?this.view.cssClass:e.cssClass,this.closable=this.view?this.view.closable:e.closable,this.saveNeeded=this.view?this.view.saveNeeded:e.saveNeeded,this.saveNeededVisible=this.view?this.view.saveNeededVisible:e.saveNeededVisible,this.status=this.view?this.view.status:e.status,this.view&&(this._installViewListeners(),this.view.addGlassPaneContribution(this._glassPaneContribution))}renderAfter(e,t){this.render(e),t&&this.$container.insertAfter(t.$container)}_render(){this.$container=this.$parent.prependDiv("simple-tab"),this.$container.on("mousedown",this._onMouseDown.bind(this)),this.$titleLine=this.$container.appendDiv("title-line"),this.$iconContainer=this.$titleLine.appendDiv("icon-container"),this.$title=this.$titleLine.appendDiv("title"),K.installForEllipsis(this.$title,{parent:this}),this.$statusContainer=this.$titleLine.appendDiv("status-container"),this.$subTitle=this.$container.appendDiv("sub-title"),K.installForEllipsis(this.$subTitle,{parent:this})}_renderProperties(){super._renderProperties(),this._renderTitle(),this._renderSubTitle(),this._renderIconId(),this._renderCssClass(),this._renderClosable(),this._renderSaveNeeded(),this._renderStatus(),this._renderSelected()}_remove(){this.$close=null,super._remove()}setTitle(e){this.setProperty("title",e)}_renderTitle(){(this.title||this.subTitle)&&this.$title.textOrNbsp(this.title)}setSubTitle(e){this.setProperty("subTitle",e)}_renderSubTitle(){this.subTitle?(this.title||this._renderTitle(),this.$subTitle.textOrNbsp(this.subTitle)):this.title||this._renderTitle()}setIconId(e){this.setProperty("iconId",e)}_renderIconId(){this.$iconContainer.icon(this.iconId)}setClosable(e){this.setProperty("closable",e)}_renderClosable(){if(this.closable){if(this.$close)return;this.$container.addClass("closable"),this.$close=this.$container.appendDiv("closer").on("click",this._onClose.bind(this))}else{if(!this.$close)return;this.$container.removeClass("closable"),this.$close.remove(),this.$close=null}}setSaveNeededVisible(e){this.saveNeededVisible!==e&&(this._setProperty("saveNeededVisible",e),this.rendered&&this._renderSaveNeeded())}setSaveNeeded(e){this.saveNeeded!==e&&(this._setProperty("saveNeeded",e),this.rendered&&this._renderSaveNeeded())}_renderSaveNeeded(){if(this.saveNeeded&&this.saveNeededVisible){if(this.$container.addClass("save-needed"),this.$saveNeeded)return;this.$saveNeeded=this.$statusContainer.prependDiv("status save-needer"),this._statusContainerUsageCounter++}else{if(!this.$saveNeeded)return;this.$container.removeClass("save-needed"),this.$saveNeeded.remove(),this.$saveNeeded=null,this._statusContainerUsageCounter--}}setStatus(e){this.setProperty("status",e)}_renderStatus(){this._statusContainerUsageCounter-=this.$statusIcons.length===0?0:1,this.$statusIcons.forEach(e=>e.remove()),this.$statusIcons=[],this.status&&this.status.asFlatList().forEach(e=>{if(!(!e||!e.iconId&&!e.message)){if(e.iconId){let t=this.$statusContainer.appendIcon(e.iconId,"status");e.cssClass()&&t.addClass(e.cssClass()),this.$statusIcons.push(t)}if(e.message){let t=this.$statusContainer.appendSpan("status message");e.cssClass()&&t.addClass(e.cssClass());let s=t.appendSpan("text",e.message);K.installForEllipsis(s,{parent:this}),this.$statusIcons.push(t)}}}),this._statusContainerUsageCounter+=this.$statusIcons.length===0?0:1,this.$container.toggleClass("has-status",this._statusContainerUsageCounter>0)}select(){this.setSelected(!0)}deselect(){this.setSelected(!1)}setSelected(e){this.setProperty("selected",e)}_renderSelected(){this.$container.toggleClass("selected",this.selected)}_onMouseDown(e){this.$close&&this.$close.isOrHas(e.target)||(this.trigger("click"),this.$title&&(K.cancel(this.$title),K.close(this.$title)),this.$subTitle&&(K.cancel(this.$subTitle),K.close(this.$subTitle)),e.preventDefault())}_onClose(e){this.view&&this.view.abort()}getMenuText(){return y.join("  ",this.title,this.subTitle)}_installViewListeners(){this.view.on("propertyChange",this._viewPropertyChangeListener),this.view.on("remove",this._viewRemoveListener)}_uninstallViewListeners(){this.view.off("propertyChange",this._viewPropertyChangeListener),this.view.off("remove",this._viewRemoveListener)}_onViewPropertyChange(e){e.propertyName==="title"?this.setTitle(this.view.title):e.propertyName==="subTitle"?this.setSubTitle(this.view.subTitle):e.propertyName==="iconId"?this.setIconId(this.view.iconId):e.propertyName==="cssClass"?this.setCssClass(e.newValue):e.propertyName==="saveNeeded"?this.setSaveNeeded(e.newValue):e.propertyName==="saveNeededVisible"?this.setSaveNeededVisible(e.newValue):e.propertyName==="closable"?this.setClosable(e.newValue):e.propertyName==="status"&&this.setStatus(e.newValue)}_onViewRemove(e){this._uninstallViewListeners(),this.rendered?this.remove():this.trigger("remove")}}function xl(i,e,t){return e=G$(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function G$(i){var e=U$(i,"string");return typeof e=="symbol"?e:String(e)}function U$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ni extends I{constructor(){super(),xl(this,"displayStyle",void 0),xl(this,"tabs",void 0),xl(this,"_selectedViewTab",void 0),xl(this,"_tabClickHandler",void 0),this.displayStyle=Ni.DisplayStyle.DEFAULT,this.tabs=[],this._selectedViewTab=null}_init(e){super._init(e),this._tabClickHandler=this._onTabClick.bind(this)}_render(){this.$container=this.$parent.appendDiv("simple-tab-area"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(this._createLayout())}_createLayout(){return new vh(this)}_renderProperties(){super._renderProperties(),this._renderDisplayStyle(),this._renderTabs()}setDisplayStyle(e){this.setProperty("displayStyle",e)}_renderDisplayStyle(){this.$container.toggleClass("spread-even",this.displayStyle===Ni.DisplayStyle.SPREAD_EVEN),this.invalidateLayoutTree()}_renderTabs(){this.tabs.slice().reverse().forEach(e=>this._renderTab(e)),Le.updateFirstLastMarker(this.tabs)}_renderTab(e){e.renderAfter(this.$container)}_renderVisible(){this.$container.setVisible(this.visible&&this.tabs.length>0),this.invalidateLayoutTree()}_onTabClick(e){this.selectTab(e.source)}getTabs(){return this.tabs}getVisibleTabs(){return this.tabs.filter(e=>e.$container?e.$container.isVisible():e.visible)}selectTab(e){this._selectedViewTab!==e&&(this.deselectTab(this._selectedViewTab),this._selectedViewTab=e,e&&e.select(),this.trigger("tabSelect",{viewTab:e}),e&&e.rendered&&!e.$container.isVisible()&&this.invalidateLayoutTree())}deselectTab(e){!e||this._selectedViewTab===e&&this._selectedViewTab.deselect()}getSelectedTab(){return this._selectedViewTab}addTab(e,t){let s=-1;t&&(s=this.tabs.indexOf(t)),this.tabs.splice(s+1,0,e),e.on("click",this._tabClickHandler),this.rendered&&(this._renderVisible(),e.renderAfter(this.$container,t),Le.updateFirstLastMarker(this.getTabs()),this.invalidateLayoutTree())}destroyTab(e){let t=this.tabs.indexOf(e);t>-1&&(this.tabs.splice(t,1),e.destroy(),e.off("click",this._tabClickHandler),this.rendered&&(this._renderVisible(),Le.updateFirstLastMarker(this.getTabs()),this.invalidateLayoutTree()))}}xl(Ni,"DisplayStyle",{DEFAULT:"default",SPREAD_EVEN:"spreadEven"});function Eo(i,e,t){return e=q$(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function q$(i){var e=Y$(i,"string");return typeof e=="symbol"?e:String(e)}function Y$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class vh extends ee{constructor(e){super(),Eo(this,"tabArea",void 0),Eo(this,"tabWidth",void 0),Eo(this,"tabMinWidth",void 0),Eo(this,"overflowTabItemWidth",void 0),Eo(this,"_$overflowTab",void 0),Eo(this,"_overflowTabsIndizes",void 0),this.tabArea=e,this._$overflowTab=null,this._overflowTabsIndizes=[],this.tabWidth=null,this.tabMinWidth=null,this.overflowTabItemWidth=null}layout(e){let t=this.tabArea.htmlComp,s=t.size({exact:!0}),r=t.$comp.children(".simple-tab"),n=this.tabArea.getTabs().length,o=this.smallPrefSize();if(s=s.subtract(t.insets()),this._initSizes(),this._$overflowTab&&this._$overflowTab.remove(),r.setVisible(!0),this._overflowTabsIndizes=[],Le.updateFirstLastMarker(this.tabArea.getTabs()),o.width<=s.width){e.removeClass("overflown");return}e.addClass("overflown"),s.width-=this.overflowTabItemWidth;let l=Math.floor(s.width/this.tabMinWidth),h=n-l,d=0;r.each((m,_)=>{a()(_).hasClass("selected")&&(d=m)});let c,f=d-Math.floor(l/2);f<0?(f=0,c=l-1):(c=f+l-1,c>n-1&&(c=n-1,f=c-l+1)),this._$overflowTab=t.$comp.appendDiv("simple-overflow-tab-item").on("mousedown",this._onOverflowTabItemMouseDown.bind(this)),this._$overflowTab.appendDiv("num-tabs").text(h),r.each((m,_)=>{(m<f||m>c)&&(a()(_).setVisible(!1),this._overflowTabsIndizes.push(m))}),Le.updateFirstLastMarker(this.tabArea.getVisibleTabs())}smallPrefSize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._initSizes(),e=a().extend({minTabWidth:this.tabMinWidth},e),this.preferredLayoutSize(this.tabArea.$container,e)}preferredLayoutSize(e,t){this._initSizes();let s=u.nvl(t.minTabWidth,0)||u.nvl(this.tabWidth,0),n=this.tabArea.getTabs().length*s;t=a().extend({useCssSize:!0},t);let o=v.prefSize(this.tabArea.$container,t);return t.widthHint&&this.tabArea.displayStyle===Ni.DisplayStyle.SPREAD_EVEN&&(n=Math.max(t.widthHint,n)),new F(n,o.height)}_initSizes(){if(this.tabWidth!=null&&this.tabMinWidth!=null&&this.overflowTabItemWidth!=null)return;let e=this.tabArea.$container.children(".simple-tab").eq(0);if(e.length===0)return;e=e.clone().addClass("selected");let t=this.tabArea.$container.attr("class"),s=e.attr("class");this.tabWidth===null&&(this.tabWidth=M.getSize([t,s],"width","width",0)),this.tabMinWidth===null&&(this.tabMinWidth=M.getSize([t,s],"min-width","minWidth")),this.overflowTabItemWidth===null&&(this.overflowTabItemWidth=M.getSize([t,"simple-overflow-tab-item"],"min-width","minWidth"),this.overflowTabItemWidth+=M.getSize([t,"simple-overflow-tab-item"],"margin-left","marginLeft"),this.overflowTabItemWidth+=M.getSize([t,"simple-overflow-tab-item"],"margin-right","marginRight"))}_onOverflowTabItemMouseDown(e){let t=this.tabArea,s=[],r=a()(e.currentTarget);if(r.data("popup")){r.data("popup").close();return}this._overflowTabsIndizes.forEach(o=>{let l=this.tabArea.getTabs()[o],h=u.create(ne,{parent:this.tabArea,text:l.getMenuText()});h.on("action",function(){a().log.isDebugEnabled()&&a().log.debug("(SimpleTabAreaLayout#_onMouseDownOverflow) tab="+this),t.selectTab(this)}.bind(l)),s.push(h)});let n=u.create(ft,{parent:this.tabArea,menuItems:s,cloneMenuItems:!1,$anchor:r,closeOnAnchorMouseDown:!1});r.addClass("selected"),r.data("popup",n),n.one("remove",()=>{r.removeClass("selected"),r.data("popup",null)}),n.open()}}function q(i,e,t){return e=j$(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function j$(i){var e=X$(i,"string");return typeof e=="symbol"?e:String(e)}function X$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ie extends I{constructor(){super(),q(this,"displayStyle",void 0),q(this,"title",void 0),q(this,"selectViewTabsKeyStrokesEnabled",void 0),q(this,"selectViewTabsKeyStrokeModifier",void 0),q(this,"cacheSplitterPosition",void 0),q(this,"browserHistoryEntry",void 0),q(this,"logoId",void 0),q(this,"logoUrl",void 0),q(this,"navigationVisible",void 0),q(this,"navigationHandleVisible",void 0),q(this,"logoActionEnabled",void 0),q(this,"benchVisible",void 0),q(this,"headerVisible",void 0),q(this,"geolocationServiceAvailable",void 0),q(this,"benchLayoutData",void 0),q(this,"nativeNotificationDefaults",void 0),q(this,"menus",void 0),q(this,"addOns",void 0),q(this,"dialogs",void 0),q(this,"views",void 0),q(this,"keyStrokes",void 0),q(this,"viewButtons",void 0),q(this,"messageBoxes",void 0),q(this,"fileChoosers",void 0),q(this,"outline",void 0),q(this,"activeForm",void 0),q(this,"selectedViewTabs",void 0),q(this,"notifications",void 0),q(this,"navigation",void 0),q(this,"header",void 0),q(this,"bench",void 0),q(this,"splitter",void 0),q(this,"splitterVisible",void 0),q(this,"formController",void 0),q(this,"messageBoxController",void 0),q(this,"fileChooserController",void 0),q(this,"initialFormRendering",void 0),q(this,"resizing",void 0),q(this,"offline",void 0),q(this,"inBackground",void 0),q(this,"openUriHandler",void 0),q(this,"theme",void 0),q(this,"dense",void 0),q(this,"animateLayoutChange",void 0),q(this,"url",void 0),q(this,"responsiveHandler",void 0),q(this,"$notifications",void 0),q(this,"$overlaySeparator",void 0),q(this,"_resizeHandler",void 0),q(this,"_glassPaneTargetFilters",void 0),q(this,"_offlineNotification",void 0),q(this,"_benchActiveViewChangedHandler",void 0),q(this,"_popstateHandler",void 0),this.title=null,this.selectViewTabsKeyStrokesEnabled=!0,this.selectViewTabsKeyStrokeModifier="control",this.cacheSplitterPosition=!0,this.browserHistoryEntry=null,this.logoId=null,this.navigationVisible=!0,this.navigationHandleVisible=!0,this.logoActionEnabled=!1,this.benchVisible=!0,this.headerVisible=!0,this.geolocationServiceAvailable=x.get().supportsGeolocation(),this.benchLayoutData=null,this.nativeNotificationDefaults=null,this.menus=[],this.addOns=[],this.dialogs=[],this.views=[],this.keyStrokes=[],this.viewButtons=[],this.messageBoxes=[],this.fileChoosers=[],this.outline=null,this.activeForm=null,this.selectedViewTabs=[],this.notifications=[],this.navigation=null,this.header=null,this.bench=null,this.splitter=null,this.splitterVisible=!1,this.formController=null,this.messageBoxController=null,this.fileChooserController=null,this.initialFormRendering=!1,this.offline=!1,this.inBackground=!1,this.openUriHandler=null,this.theme=null,this.dense=!1,this.url=null,this.$notifications=null,this._addWidgetProperties(["viewButtons","menus","views","selectedViewTabs","dialogs","outline","messageBoxes","notifications","fileChoosers","addOns","keyStrokes","activeForm","focusedElement"]),this._addPreserveOnPropertyChangeProperties(["focusedElement"]),this._glassPaneTargetFilters=[],this._benchActiveViewChangedHandler=this._onBenchActivateViewChanged.bind(this)}_init(e){let t=e.session||e.parent.session;t.desktop=this,e.nativeNotificationDefaults=this._createNativeNotificationDefaults(e),super._init(e),this.url=new vt,this._initTheme(),this.formController=u.create(kf,{displayParent:this,session:this.session}),this.messageBoxController=new gl(this,this.session),this.fileChooserController=new ll(this,this.session),this._resizeHandler=this.onResize.bind(this),this._popstateHandler=this.onPopstate.bind(this),this.updateSplitterVisibility(),this.resolveTextKeys(["title"]),this._setViews(this.views),this._setViewButtons(this.viewButtons),this._setMenus(this.menus),this._setKeyStrokes(this.keyStrokes),this._setBenchLayoutData(this.benchLayoutData),this._setDisplayStyle(this.displayStyle),this._setDense(this.dense),this.openUriHandler=u.create(of,{session:this.session}),this._glassPaneTargetFilters.push((s,r)=>{let n=u.widget(s);return!r.has(n)})}_createKeyStrokeContext(){return new Oe}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.invokeAcceptInputOnActiveValueField=!0,this.keyStrokeContext.registerKeyStrokes([new nf(this),new af(this)])}_createNativeNotificationDefaults(e){return a().extend({title:e.title,iconId:e.logoId},e.nativeNotificationDefaults)}setNativeNotificationDefaults(e){this.setProperty("nativeNotificationDefaults",e)}_onBenchActivateViewChanged(e){if(this.initialFormRendering)return;let t=e.view;t instanceof U&&this.bench.outlineContent!==t&&!t.detailForm&&this._setFormActivated(t)}_render(){this.$container=this.$parent,this.$container.addClass("desktop"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(this._createLayout()),this.$container.window().on("resize",this._resizeHandler).on("popstate",this._popstateHandler),this.$overlaySeparator=this.$container.appendDiv("overlay-separator").setVisible(!1),this._renderDense(),this._renderNavigationVisible(),this._renderHeaderVisible(),this._renderBenchVisible(),this._renderTitle(),this._renderLogoUrl(),this._renderSplitterVisible(),this._renderInBackground(),this._renderNavigationHandleVisible(),this._renderNotifications(),this._renderBrowserHistoryEntry(),this.addOns.forEach(e=>e.render()),this._setupDragAndDrop(),this._disableContextMenu()}_remove(){this.formController.remove(),this.messageBoxController.remove(),this.fileChooserController.remove(),this.$container.window().off("resize",this._resizeHandler).off("popstate",this._popstateHandler),super._remove()}_postRender(){super._postRender(),this.initialFormRendering=!0,this._renderDisplayChildrenOfOutline(),this.formController.render(),this.messageBoxController.render(),this.fileChooserController.render(),this.initialFormRendering=!1}_setDisplayStyle(e){this._setProperty("displayStyle",e);let t=this.displayStyle===Ie.DisplayStyle.COMPACT;if(this.header){if(this.header.tabArea){const s=Ni.DisplayStyle;this.header.tabArea.setDisplayStyle(t?s.SPREAD_EVEN:s.DEFAULT)}this.header.setToolBoxVisible(!t),this.header.animateRemoval=t}this.navigation&&(this.navigation.setToolBoxVisible(t),this.navigation.htmlComp.layoutData.fullWidth=t),this.bench&&this.bench.setOutlineContentVisible(!t),this.outline&&(this.outline.setCompact(t),this.outline.setEmbedDetailContent(t))}setDense(e){this.setProperty("dense",e)}_setDense(e){this._setProperty("dense",e),M.clearCache(),de.get().init(this.dense?"dense":null)}_renderDense(){this.$container.toggleClass("dense",this.dense)}_createLayout(){return new ef(this)}_renderDisplayChildrenOfOutline(){!this.outline||(this.outline.formController.render(),this.outline.messageBoxController.render(),this.outline.fileChooserController.render(),this.outline.selectedViewTabs?this.outline.selectedViewTabs.forEach(e=>{this.formController._activateView(e)}):this.outline.views.filter(t=>t.modal).forEach(this.formController._activateView.bind(this.formController)))}_removeDisplayChildrenOfOutline(){!this.outline||(this.outline.formController.remove(),this.outline.messageBoxController.remove(),this.outline.fileChooserController.remove())}computeParentForDisplayParent(e){let t=e;return e instanceof bs&&(t=this),t}_renderTitle(){let e=this.title;if(e==null)return;let t=a()("div.scout");t.length<=1&&(t.document(!0).title=e)}_renderActiveForm(){}_renderBench(){this.bench||(this.bench=this._createBench(),this.bench.on("viewActivate",this._benchActiveViewChangedHandler),this.bench.render(),this.bench.$container.insertBefore(this.$overlaySeparator),this.invalidateLayoutTree())}_createBench(){return u.create(Ci,{parent:this,animateRemoval:!0,headerTabArea:this.header?this.header.tabArea:void 0,outlineContentVisible:this.displayStyle!==Ie.DisplayStyle.COMPACT})}_removeBench(){!this.bench||(this.bench.off("viewActivate",this._benchActiveViewChangedHandler),this.bench.on("destroy",()=>{this.bench=null,this.invalidateLayoutTree()}),this.bench.destroy())}_renderBenchVisible(){this.animateLayoutChange=this.rendered,this.benchVisible?(this._renderBench(),this._renderInBackground()):this._removeBench()}_renderNavigation(){this.navigation||(this.navigation=this._createNavigation(),this.navigation.render(),this.navigation.$container.prependTo(this.$container),this.$container.removeClass("navigation-invisible"),this.invalidateLayoutTree())}_createNavigation(){return u.create(Wt,{parent:this,outline:this.outline,toolBoxVisible:this.displayStyle===Ie.DisplayStyle.COMPACT,layoutData:{fullWidth:this.displayStyle===Ie.DisplayStyle.COMPACT}})}_removeNavigation(){this.$container.addClass("navigation-invisible"),this.navigation&&(this.navigation.destroy(),this.navigation=null,this.invalidateLayoutTree())}_renderNavigationVisible(){this.animateLayoutChange=this.rendered,this.navigationVisible?this._renderNavigation():this.animateLayoutChange?this.invalidateLayoutTree():this._removeNavigation()}_renderHeader(){this.header||(this.header=this._createHeader(),this.header.render(),this.navigation&&this.navigation.rendered?this.header.$container.insertAfter(this.navigation.$container):this.header.$container.prependTo(this.$container),this.bench&&this.bench._setTabArea(this.header.tabArea),this.invalidateLayoutTree())}_createHeader(){let e=this.displayStyle===Ie.DisplayStyle.COMPACT;return u.create(hf,{parent:this,logoUrl:this.logoUrl,animateRemoval:e,toolBoxVisible:!e,tabArea:{displayStyle:e?Ni.DisplayStyle.SPREAD_EVEN:Ni.DisplayStyle.DEFAULT}})}_removeHeader(){!this.header||(this.header.on("destroy",()=>{this.invalidateLayoutTree(),this.header=null}),this.header.destroy())}_renderHeaderVisible(){this.headerVisible?this._renderHeader():this._removeHeader()}_renderLogoUrl(){this.header&&this.header.setLogoUrl(this.logoUrl)}_renderSplitterVisible(){this.splitterVisible?this._renderSplitter():this._removeSplitter()}_renderSplitter(){this.splitter||!this.navigation||(this.splitter=u.create(Js,{parent:this,$anchor:this.navigation.$container,$root:this.$container}),this.splitter.render(),this.splitter.$container.insertBefore(this.$overlaySeparator),this.splitter.on("move",this._onSplitterMove.bind(this)),this.splitter.on("moveEnd",this._onSplitterMoveEnd.bind(this)),this.splitter.on("positionChange",this._onSplitterPositionChange.bind(this)),this.updateSplitterPosition())}_removeSplitter(){!this.splitter||(this.splitter.destroy(),this.splitter=null)}_renderInBackground(){this.$container.toggleClass("in-background",this.inBackground&&this.displayStyle!==Ie.DisplayStyle.COMPACT),this.bench&&this.bench.$container.toggleClass("drop-shadow",this.inBackground)}_renderBrowserHistoryEntry(){if(!x.get().supportsHistoryApi())return;let e=this.$container.window(!0),t=this.browserHistoryEntry;if(t){let s=this._createHistoryPath(t),r=(this.rendered?e.history.pushState:e.history.replaceState).bind(e.history),n={deepLinkPath:t.deepLinkPath};r(n,t.title,s)}}_createHistoryPath(e){if(!e.pathVisible)return"";let t=e.path,s=this.url.clone();if(s.removeParameter("dl"),s.removeParameter("i"),b.countOwnProperties(s.parameterMap)>0){let r=new vt(t);for(let n in s.parameterMap)r.addParameter(n,s.getParameter(n));t=r.toString({alwaysFirst:["dl","i"]})}return t}_setupDragAndDrop(){let e=t=>{t.stopPropagation(),t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="none"};this.$container.on("dragenter",e),this.$container.on("dragover",e),this.$container.on("drop",t=>{t.stopPropagation(),t.preventDefault()})}updateSplitterVisibility(){this.setSplitterVisible(this.navigationVisible&&this.benchVisible&&this.displayStyle!==Ie.DisplayStyle.COMPACT)}setSplitterVisible(e){this.setProperty("splitterVisible",e)}updateSplitterPosition(){if(!this.splitter)return;let e=this.cacheSplitterPosition&&this._loadCachedSplitterPosition();if(e){let t=parseInt(e,10);this.splitter.setPosition(t),this.invalidateLayoutTree()}else this.splitter.setPosition(),this.invalidateLayoutTree()}_disableContextMenu(){this.$container.on("contextmenu",e=>{e.target.nodeName!=="INPUT"&&e.target.nodeName!=="TEXTAREA"&&!e.target.isContentEditable&&e.preventDefault()})}setOutline(e){if(this.outline!==e)try{this.bench&&this.bench.setChanging(!0),this.rendered&&this._removeDisplayChildrenOfOutline(),this.outline=e,this._setDisplayStyle(this.displayStyle),this._setOutlineActivated(),this.navigation&&this.navigation.setOutline(this.outline),this.trigger("outlineChange"),this.rendered&&this._renderDisplayChildrenOfOutline()}finally{this.bench&&this.bench.setChanging(!1)}}_setViews(e){e&&e.forEach(t=>t.setDisplayParent(this)),this._setProperty("views",e)}_setViewButtons(e){this.updateKeyStrokes(e,this.viewButtons),this._setProperty("viewButtons",e)}setMenus(e){this.header&&this.header.setMenus(e)}_setMenus(e){this.updateKeyStrokes(e,this.menus),this._setProperty("menus",e)}_setKeyStrokes(e){this.updateKeyStrokes(e,this.keyStrokes),this._setProperty("keyStrokes",e)}setNavigationHandleVisible(e){this.setProperty("navigationHandleVisible",e)}_renderNavigationHandleVisible(){this.$container.toggleClass("has-navigation-handle",this.navigationHandleVisible)}setNavigationVisible(e){this.setProperty("navigationVisible",e),this.updateSplitterVisibility()}setBenchVisible(e){this.setProperty("benchVisible",e),this.updateSplitterVisibility()}setHeaderVisible(e){this.setProperty("headerVisible",e)}_setBenchLayoutData(e){e=Rn.ensure(e),this._setProperty("benchLayoutData",e)}_setInBackground(e){this._setProperty("inBackground",e)}outlineDisplayStyle(){if(this.outline)return this.outline.displayStyle}shrinkNavigation(){this.outline&&this.outline.toggleBreadcrumbStyleEnabled&&this.navigationVisible&&this.outlineDisplayStyle()===pe.DisplayStyle.DEFAULT?this.outline.setDisplayStyle(pe.DisplayStyle.BREADCRUMB):this.setNavigationVisible(!1)}enlargeNavigation(){this.outline&&this.navigationVisible&&this.outlineDisplayStyle()===pe.DisplayStyle.BREADCRUMB?(this.outline.setDisplayStyle(pe.DisplayStyle.DEFAULT),this.cacheSplitterPosition&&this.splitter&&(this.validateLayoutTree(),this._storeCachedSplitterPosition(this.splitter.position))):this.setNavigationVisible(!0)}switchToBench(e){this.setHeaderVisible(u.nvl(e,!0)),this.setBenchVisible(!0),this.setNavigationVisible(!1)}switchToNavigation(){this.setNavigationVisible(!0),this.setHeaderVisible(!1),this.setBenchVisible(!1)}revalidateHeaderLayout(){this.header&&this.header.revalidateLayout()}goOffline(){this.offline||(this.offline=!0,this._removeOfflineNotification(),this._offlineNotification=u.create(gf,{parent:this}),this._offlineNotification.show())}goOnline(){this._removeOfflineNotification()}_removeOfflineNotification(){this._offlineNotification&&(setTimeout(this.removeNotification.bind(this,this._offlineNotification),3e3),this._offlineNotification=null)}addNotification(e){!e||(this.notifications.push(e),this.rendered&&this._renderNotification(e))}_renderNotification(e){this.$notifications?this.$notifications.appendTo(this.$container):this.$notifications=this.$container.appendDiv("desktop-notifications"),e.fadeIn(this.$notifications),e.duration>0&&(e.removeTimeout=setTimeout(e.hide.bind(e),e.duration),e.one("remove",()=>this.removeNotification(e)))}_renderNotifications(){this.notifications.forEach(e=>this._renderNotification(e))}removeNotification(e){let t;typeof e=="string"?t=p.find(this.notifications,s=>e===s.id):t=e,t&&(t.removeTimeout&&clearTimeout(t.removeTimeout),p.remove(this.notifications,t),this.rendered&&(t.rendered&&t.one("remove",this._onNotificationRemove.bind(this)),t.fadeOut()))}getPopups(){if(!this.$container)return[];let e=[];return this.$container.children(".popup").each((t,s)=>{let r=a()(s),n=Le.get(r);n instanceof ue&&e.push(n)}),e}getPopupsFor(e){return this.getPopups().filter(t=>e.has(t))}removePopupsFor(e){this.getPopupsFor(e).forEach(t=>t.remove())}openUri(e,t){if(!this.rendered){this._postRenderActions.push(this.openUri.bind(this,e,t));return}this.openUriHandler.openUri(e,t)}bringOutlineToFront(){if(!this.rendered){this._postRenderActions.push(this.bringOutlineToFront.bind(this));return}!this.inBackground||this.displayStyle===Ie.DisplayStyle.BENCH||(this._setInBackground(!1),this._setOutlineActivated(),this.navigationVisible&&this.navigation.bringToFront(),this.benchVisible&&this.bench.bringToFront(),this.headerVisible&&this.header.bringToFront(),this._renderInBackground())}sendOutlineToBack(){this.inBackground||(this._setInBackground(!0),this.navigationVisible&&this.navigation.sendToBack(),this.benchVisible&&this.bench.sendToBack(),this.headerVisible&&this.header.sendToBack(),this._renderInBackground())}inFront(){return!0}_glassPaneTargets(e){let t=this.$container.children().not(".splitter").not(".desktop-notifications").not(".overlay-separator");if(e){e.$container&&(t=t.not(e.$container));let r=this.$overlaySeparator.nextAll().toArray(),n=[];e.$container&&r.indexOf(e.$container[0])>-1&&(n=e.$container.nextAll().toArray());let o=null;if(r.length)for(let l=r.length-1;l>=0;l--){let h=r[l];if(!!this._isGlassPaneTargetFiltered(h,e)){o=h;break}}t=t.filter((l,h)=>n.indexOf(h)>-1||h===o?!1:this._isGlassPaneTargetFiltered(h,e))}let s;return e instanceof U&&e.displayHint===U.DisplayHint.VIEW?(t=t.not(".desktop-bench").not(".desktop-header"),this.header&&this.header.toolBox&&this.header.toolBox.$container&&t.push(this.header.toolBox.$container),s=a().makeArray(t),p.pushAll(s,this._getBenchGlassPaneTargetsForView(e))):s=a().makeArray(t),this._pushPopupWindowGlassPaneTargets(s,e),s}_isGlassPaneTargetFiltered(e,t){return this._glassPaneTargetFilters.every(s=>s(e,t))}addGlassPaneTargetFilter(e){this._glassPaneTargetFilters.push(e)}removeGlassPaneTargetFilter(e){p.remove(this._glassPaneTargetFilters,e)}_deferredGlassPaneTarget(e){let t=new Qr;return e.one("init",()=>t.ready([e.$container])),t}_getBenchGlassPaneTargetsForView(e){let t=[];return t=t.concat(this._getTabGlassPaneTargetsForView(e,this.header)),this.bench&&this.bench.visibleTabBoxes().forEach(s=>{!s.rendered||(s.hasView(e)?t=t.concat(this._getTabGlassPaneTargetsForView(e,s)):t.push(s.$container))}),t}_getTabGlassPaneTargetsForView(e,t){let s=[];return t&&t.tabArea&&t.tabArea.tabs.forEach(r=>{r.view!==e&&(s.push(r.$container),r.$container.addClass("glasspane-parent"))}),s}_pushPopupWindowGlassPaneTargets(e,t){this.formController.popupWindows.forEach(s=>{t!==s.form&&e.push(s.initialized?s.$container[0]:this._deferredGlassPaneTarget(s))})}showForm(e,t){let s=e.displayParent||this;e.setDisplayParent(s),this._setFormActivated(e),s.formController.registerAndRender(e,t,!0)}hideForm(e){if(!!e.displayParent){if(this.displayStyle===Ie.DisplayStyle.COMPACT&&e.isView()&&this.benchVisible){let t=this.bench.getViews().slice();p.remove(t,e),t.length===0&&this.switchToNavigation()}e.displayParent.formController.unregisterAndRemove(e),(!this.benchVisible||this.bench.getViews().length===0)&&this.bringOutlineToFront()}}isFormShown(e){return(e.displayParent||this).formController.isFormShown(e)}activateForm(e){if(!e){this._setFormActivated(null);return}(e.displayParent||this).formController.activateForm(e),this._setFormActivated(e),e.dialogs.forEach(s=>{s.modal&&this.activateForm(s)})}_setOutlineActivated(){this._setFormActivated(null),this.outline&&this.outline.activateCurrentPage()}_setFormActivated(e){!this.rendered||this.initialFormRendering||this.activeForm!==e&&(this.activeForm=e,e?e.displayHint===U.DisplayHint.VIEW&&!e.detailForm&&this.bench&&this.bench.hasView(e)&&this.sendOutlineToBack():this.bringOutlineToFront(),this.triggerFormActivate(e))}triggerFormActivate(e){this.trigger("formActivate",{form:e})}cancelViews(e){this.trigger("cancelForms",{forms:e}).defaultPrevented||this._cancelViews(e)}_cancelViews(e){if(e=e.filter(r=>!p.find(r.views,n=>n.modal)),e.length===1){e[0].cancel();return}let t=e.filter(r=>{let n=!1;return r.visitDisplayChildren(o=>{o.lifecycle.requiresSave()&&(n=!0)},o=>o instanceof U),r.lifecycle.requiresSave()||n}),s=a().resolvedPromise();if(t.length>0){let r=u.create(Mo,{parent:this,session:this.session,displayParent:this,unsavedForms:t});r.open(),s=r.whenSave().then(()=>{let n=r.openFormsField.value;return n.forEach(o=>{o.visitDisplayChildren(l=>{l instanceof U?l.ok():l.close()}),o.ok()}),n})}s.then(r=>{r&&p.removeAll(e,r),e.forEach(n=>{n.visitDisplayChildren(o=>o.close()),n.close()})})}onLayoutAnimationComplete(){this.headerVisible||this._removeHeader(),this.navigationVisible||this._removeNavigation(),this.benchVisible||this._removeBench(),this.trigger("animationEnd"),this.animateLayoutChange=!1}onLayoutAnimationStep(){this.repositionTooltips()}onResize(e){this.revalidateLayoutTree()}resetPopstateHandler(){this.setPopstateHandler(this.onPopstate.bind(this))}setPopstateHandler(e){if(this.rendered||this.rendering){let t=this.$container.window();this._popstateHandler&&t.off("popstate",this._popstateHandler),e&&t.on("popstate",e)}this._popstateHandler=e}onPopstate(e){let s=e.originalEvent.state;s&&s.deepLinkPath&&this.trigger("historyEntryActivate",s)}_onSplitterMove(e){this.resizing=!0;let t=Math.floor(this.$container.outerWidth(!0)/2);e.position>t&&(e.source.setPosition(t),e.preventDefault())}_onSplitterPositionChange(e){this.htmlComp.layouting||this.revalidateLayout()}_onSplitterMoveEnd(e){let t=e.position;this.cacheSplitterPosition&&this._storeCachedSplitterPosition(this.splitter.position),t<Wt.BREADCRUMB_STYLE_WIDTH?this.navigation.$container.animate({width:Wt.BREADCRUMB_STYLE_WIDTH},{progress:function(){this.resizing=!0,this.splitter.setPosition(),this.revalidateLayout(),this.resizing=!1}.bind(this),complete:function(){this.resizing=!0,this.splitter.setPosition(),this.cacheSplitterPosition&&this._storeCachedSplitterPosition(this.splitter.position),this.revalidateLayout(),this.resizing=!1}.bind(this)}):this.resizing=!1}_loadCachedSplitterPosition(){return Se.getItemFromSessionStorage("scout:desktopSplitterPosition")||Se.getItemFromLocalStorage("scout:desktopSplitterPosition:"+window.location.pathname)}_storeCachedSplitterPosition(e){Se.setItemToSessionStorage("scout:desktopSplitterPosition",e+""),Se.setItemToLocalStorage("scout:desktopSplitterPosition:"+window.location.pathname,e+"")}_onNotificationRemove(e){this.notifications.length===0&&this.$notifications&&(this.$notifications.remove(),this.$notifications=null)}onReconnecting(){!this.offline||this._offlineNotification.reconnect()}onReconnectingSucceeded(){!this.offline||(this.offline=!1,this._offlineNotification.reconnectSucceeded(),this._removeOfflineNotification())}onReconnectingFailed(){!this.offline||this._offlineNotification.reconnectFailed()}dataChange(e){this.trigger("dataChange",e)}_activeTheme(){return zl.get("scout.ui.theme")||Ie.DEFAULT_THEME}logoAction(){this.logoActionEnabled&&this.trigger("logoAction")}_initTheme(){let e=this.theme;this.url.hasParameter("theme")?e=y.nullIfEmpty(this.url.getParameter("theme"))||Ie.DEFAULT_THEME:e===null&&(e=this._activeTheme()),this.setTheme(e)}setTheme(e){this.setProperty("theme",e),this.theme!==this._activeTheme()&&this._switchTheme(e)}_switchTheme(e){zl.set("scout.ui.theme",e,30*24*3600),a()("body").setVisible(!1);let t={clearBody:!1};this.url.hasParameter("theme")&&(this.url.removeParameter("theme"),t.redirectUrl=this.url.toString()),u.reloadPage(t)}moveOverlaysBehindAndFocus(e,t){t=a().ensure(t),t.nextAll().toArray().forEach(s=>{p.containsAll(e,[s])&&a()(s).insertBefore(t)}),t.isOrHas(t.activeElement())||this.session.focusManager.activateFocusContext(t)}adjustOverlayOrder(e){if(!this.rendered)return;let t=this.$overlaySeparator.nextAll();if(!t.is(e.$container))return;const s=t.not(e.$container),r=h=>e.findParent(c=>c.$container&&c.$container.is(h))||u.widget(h),n=h=>{let d=null;return s.toArray().reverse().some(c=>{let f=r(c);return f&&!(f instanceof Ie)&&f.has(h)?(d=f,!0):!1}),d};let o=n(e),l=s.toArray().filter(h=>{let d=r(h);return d instanceof ls&&n(d)===o});p.hasElements(l)?e.$container.insertAfter(p.last(l)):e.$container.insertAfter(o?o.$container:this.$overlaySeparator)}repositionTooltips(){this.$container.children(".tooltip").each(function(){u.widget(a()(this)).position()})}_renderTrackFocus(){this.trackFocus?this.$container[0].addEventListener("focusin",this._focusInListener,!0):this.$container[0].removeEventListener("focusin",this._focusInListener,!0)}_onFocusIn(e){super._onFocusIn(e);let t=a()(e.target),s=u.widget(t);this.setProperty("focusedElement",s)}}q(Ie,"DisplayStyle",{DEFAULT:"default",BENCH:"bench",COMPACT:"compact"}),q(Ie,"UriAction",{DOWNLOAD:"download",OPEN:"open",NEW_WINDOW:"newWindow",POPUP_WINDOW:"popupWindow",SAME_WINDOW:"sameWindow"}),q(Ie,"DEFAULT_THEME","default");class X_ extends ke{constructor(){super(),this._addRemoteProperties(["benchVisible","navigationVisible","navigationHandleVisible","headerVisible","geolocationServiceAvailable","inBackground","focusedElement"])}_goOffline(){this.widget.goOffline()}_goOnline(){this.widget.goOnline()}_onWidgetHistoryEntryActivate(e){this._send("historyEntryActivate",{deepLinkPath:e.deepLinkPath})}_onWidgetFormActivate(e){e.form&&!e.form.modelAdapter||this._sendFormActivate(e.form)}_sendFormActivate(e){let t={formId:e?e.modelAdapter.id:null};this._send("formActivate",t,{coalesce:function(s){return this.target===s.target&&this.type===s.type&&!(s.formId===null&&this.formId!==null)}})}_prepareRemoteProperty(e,t){return e==="focusedElement"?t:super._prepareRemoteProperty(e,t)}_sendFocusedElement(e){for(;e&&!e.modelAdapter;)e=e.parent;this._sendProperty("focusedElement",e?e.id:null)}_logoAction(e){this._send("logoAction")}_onWidgetEvent(e){e.type==="formActivate"?this._onWidgetFormActivate(e):e.type==="historyEntryActivate"?this._onWidgetHistoryEntryActivate(e):e.type==="logoAction"?this._logoAction(e):e.type==="cancelForms"?this._onWidgetCancelAllForms(e):super._onWidgetEvent(e)}_onFormShow(e){let t=this.session.getModelAdapter(e.displayParent);if(t){let s=this.session.getOrCreateWidget(e.form,t.widget);s.setDisplayParent(t.widget),this.session.asyncEvents.some(n=>n.type==="formActivate"&&n.target===this.id)||this.addFilterForWidgetEvent(n=>n.type==="formActivate"&&n.form===s),this.widget.showForm(s,e.position)}}_onFormHide(e){if(this.session.getModelAdapter(e.displayParent)){let s=this.session.getModelAdapter(e.form);this.widget.hideForm(s.widget)}}_onFormActivate(e){let t=this.session.getWidget(e.form);this.widget.activateForm(t)}_onWidgetCancelAllForms(e){e.preventDefault();let t=[];e.forms&&(t=e.forms.map(s=>s.modelAdapter.id)),this._send("cancelForms",{formIds:t})}_onMessageBoxShow(e){let t=this.session.getModelAdapter(e.displayParent);if(t){let s=this.session.getOrCreateWidget(e.messageBox,t.widget),r=t.widget;s.setDisplayParent(r),r.messageBoxController.registerAndRender(s)}}_onMessageBoxHide(e){let t=this.session.getModelAdapter(e.displayParent);if(t){let s=this.session.getModelAdapter(e.messageBox);t.widget.messageBoxController.unregisterAndRemove(s.widget)}}_onFileChooserShow(e){let t=this.session.getModelAdapter(e.displayParent);if(t){let s=t.widget,r=this.session.getOrCreateWidget(e.fileChooser,s);r.setDisplayParent(s),s.fileChooserController.registerAndRender(r)}}_onFileChooserHide(e){let t=this.session.getModelAdapter(e.displayParent);if(t){let s=this.session.getModelAdapter(e.fileChooser);t.widget.fileChooserController.unregisterAndRemove(s.widget)}}_onOpenUri(e){this.widget.openUri(e.uri,e.action)}_onOutlineChanged(e){let t=this.session.getOrCreateWidget(e.outline,this.widget);this.widget.setOutline(t)}_onAddNotification(e){let t=this.session.getOrCreateWidget(e.notification,this.widget);this.widget.addNotification(t)}_onRemoveNotification(e){this.widget.removeNotification(e.notification)}_onOutlineContentActivate(e){this.widget.bringOutlineToFront()}_onRequestGeolocation(e){if(navigator.geolocation){let t=function(r){this._send("geolocationDetermined",{latitude:r.coords.latitude,longitude:r.coords.longitude})}.bind(this),s=function(r){this._send("geolocationDetermined",{errorCode:r.code,errorMessage:r.message})}.bind(this);navigator.geolocation.getCurrentPosition(t,s)}}onModelAction(e){e.type==="formShow"?this._onFormShow(e):e.type==="formHide"?this._onFormHide(e):e.type==="formActivate"?this._onFormActivate(e):e.type==="messageBoxShow"?this._onMessageBoxShow(e):e.type==="messageBoxHide"?this._onMessageBoxHide(e):e.type==="fileChooserShow"?this._onFileChooserShow(e):e.type==="fileChooserHide"?this._onFileChooserHide(e):e.type==="openUri"?this._onOpenUri(e):e.type==="outlineChanged"?this._onOutlineChanged(e):e.type==="outlineContentActivate"?this._onOutlineContentActivate(e):e.type==="addNotification"?this._onAddNotification(e):e.type==="removeNotification"?this._onRemoveNotification(e):e.type==="requestGeolocation"?this._onRequestGeolocation(e):super.onModelAction(e)}}function Fo(i,e,t){return e=J$(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function J$(i){var e=Q$(i,"string");return typeof e=="symbol"?e:String(e)}function Q$(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Zp extends I{constructor(){super(),Fo(this,"desktop",void 0),Fo(this,"clickable",void 0),Fo(this,"url",void 0),Fo(this,"image",void 0),Fo(this,"_desktopPropertyChangeHandler",void 0),Fo(this,"_clickHandler",void 0),this.desktop=null,this.clickable=!1,this.image=null,this._desktopPropertyChangeHandler=this._onDesktopPropertyChange.bind(this),this._clickHandler=this._onClick.bind(this)}_init(e){super._init(e),this.desktop=this.session.desktop,this.clickable=this.desktop.logoActionEnabled,this.url=e.url,this.image=u.create(ga,{parent:this,imageUrl:this.url})}_render(){this.$container=this.$parent.appendDiv("desktop-logo"),this.htmlComp=T.install(this.$container,this.session),this.image.render(),this.desktop.on("propertyChange",this._desktopPropertyChangeHandler)}_renderProperties(){super._renderProperties(),this._renderClickable()}_remove(){this.desktop.off("propertyChange",this._desktopPropertyChangeHandler),super._remove()}_renderClickable(){this.$container.toggleClass("clickable",this.clickable),this.clickable?this.$container.on("click",this._clickHandler):this.$container.off("click",this._clickHandler)}setUrl(e){this.setProperty("url",e),this.image.setImageUrl(e)}setClickable(e){this.setProperty("clickable",e)}_onDesktopPropertyChange(e){e.propertyName==="logoActionEnabled"&&this.setClickable(e.newValue)}_onClick(e){this.desktop.logoAction()}}function Z$(i,e,t){return e=eR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function eR(i){var e=tR(i,"string");return typeof e=="symbol"?e:String(e)}function tR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ef extends ee{constructor(e){super(),Z$(this,"desktop",void 0),this.desktop=e}layout(e){let t,s=0,r=0,n=this.desktop,o=n.navigation,l=n.header,h=n.bench,d=n.animateLayoutChange,c=this.containerSize(),f=o&&o.htmlComp.layoutData.fullWidth;if(oe.get().handleResponsive(n,e.width()),o&&(s=this.calculateNavigationWidth(c),n.splitter&&n.splitter.setPosition(s),n.navigationVisible)){let _=o.htmlComp,C=new F(s,c.height).subtract(_.margins());_.setSize(C)}if(l){let _=l.htmlComp;if(r=_.$comp.outerHeight(!0),n.headerVisible){d||l.$container.cssLeft(s);let C=new F(c.width-s,r).subtract(_.margins());(!d||f)&&_.setSize(C),d&&(t={left:c.width},m(t,_,C),this._animate(t,_))}}if(h){let _=h.htmlComp;if(n.benchVisible){h.$container.cssTop(r),d||h.$container.cssLeft(s);let C=new F(c.width-s,c.height-r).subtract(_.margins());if(!d||f){let S=_.size();_.setSize(C),_.size().equals(S)||n.repositionTooltips()}d&&(t={left:c.width},m(t,_,C),this._animate(t,_))}}function m(_,C,S){f?C.$comp.cssLeft(c.width):(_.width=S.width,C.setSize(S)),_.left=s}}_animate(e,t){t.$comp.is(":animated")?s.call(this):setTimeout(s.bind(this));function s(){t.$comp.stop().animate(e,{complete:this.desktop.onLayoutAnimationComplete.bind(this.desktop),step:this.desktop.onLayoutAnimationStep.bind(this.desktop)})}}containerSize(){let e=this.desktop.htmlComp;return e.availableSize({exact:!0}).subtract(e.insets())}calculateNavigationWidth(e){if(!this.desktop.navigationVisible)return 0;if(this.desktop.navigation.htmlComp.layoutData.fullWidth)return e.width;let s=0;this.desktop.splitter&&(s=this.desktop.splitter.position);let r=this.desktop.outline;return!this.desktop.resizing&&r&&r.toggleBreadcrumbStyleEnabled&&(r.displayStyle===pe.DisplayStyle.BREADCRUMB?s=Wt.BREADCRUMB_STYLE_WIDTH:Math.floor(s)<=Wt.BREADCRUMB_STYLE_WIDTH&&(s=Wt.DEFAULT_STYLE_WIDTH)),Math.max(s,Wt.MIN_WIDTH)}}class tf extends bh{_render(){super._render(),this.$container.addClass("desktop-tab"),this.$container.on("contextmenu",this._onContextMenu.bind(this)),this.$container.prependDiv("edge left"),this.$container.appendDiv("edge right")}_renderClosable(){super._renderClosable(),this.closable&&this.view.closeKeyStroke&&(this.view.closeKeyStroke.renderingHints={hAlign:ht.RIGHT,render:()=>!!this.$close,$drawingArea:()=>this.$close})}_onContextMenu(e){let t=u.create(ne,{parent:this,text:this.session.text("ui.CloseAllTabs")});t.on("action",this._onCloseAll.bind(this));let s=u.create(ne,{parent:this,text:this.session.text("ui.CloseOtherTabs"),enabled:this.parent.tabs.length>1});s.on("action",this._onCloseOther.bind(this)),u.create(ft,{parent:this,menuItems:[t,s],cloneMenuItems:!1,location:{x:e.pageX,y:e.pageY}}).open()}_onCloseAll(){let e=this.parent.tabs.map(t=>t.view);this.session.desktop.cancelViews(e)}_onCloseOther(){let e=this.parent.tabs.map(t=>t.view);p.remove(e,this.view),this.session.desktop.cancelViews(e)}}class wh extends Ni{_render(){super._render(),this.$container.addClass("desktop-tab-area")}_createLayout(){return new sf(this)}updateFirstTabSelected(){let e=this.session.desktop;if(!e.rendered)return;let t=this.getVisibleTabs()[0];e.$container.toggleClass("first-tab-selected",t&&t.selected)}getTabs(){return super.getTabs()}}class sf extends vh{constructor(e){super(e)}layout(e){super.layout(e),this.tabArea.updateFirstTabSelected()}}class Th extends Yr{createTabArea(){return u.create(wh,{parent:this.tabBox})}_createTab(e){return u.create(tf,{parent:this.tabArea,view:e})}_shouldCreateTabForView(e){return!e.headerVisible}}class rf extends Yo{constructor(e){super(),this.field=e,this.parseAndSetKeyStroke(e.selectViewTabsKeyStrokeModifier),this.registerRange(g[1],()=>g[Math.min(this._viewTabs().length,9)]),this.renderingHints.$drawingArea=(t,s)=>{let r=s.which-g[1];return this._viewTabs()[r].$container},this.inheritAccessibility=!1}_isEnabled(){return super._isEnabled()&&this.field.selectViewTabsKeyStrokesEnabled&&this._viewTabs().length>0}handle(e){let t=e.which-g[1],s=this._viewTabs();if(s.length&&t<s.length){let r=s[t];this.field.bench&&this.field.bench.activateView(r.view)}}_viewTabs(){return this.field.bench?this.field.bench.getTabs():[]}}class nf extends O{constructor(e){super(),this.field=e,this.which=[g.F5],this.preventDefault=!0,this.keyStrokeFirePolicy=re.KeyStrokeFirePolicy.ALWAYS,this.renderingHints.render=!1,this.inheritAccessibility=!1}handle(e){}}function Ir(i,e,t){return e=iR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function iR(i){var e=sR(i,"string");return typeof e=="symbol"?e:String(e)}function sR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Lr extends ts{constructor(e,t){super(),Ir(this,"myWindow",void 0),Ir(this,"form",void 0),Ir(this,"session",void 0),Ir(this,"initialized",void 0),Ir(this,"resizeToPrefSize",void 0),Ir(this,"htmlComp",void 0),Ir(this,"$container",void 0),this.myWindow=e,this.form=t,this.session=t.session,this.initialized=!1,this.$container=null,this.htmlComp=null,t.popupWindow=this,e[Lr.PROP_POPUP_WINDOW]=this,e.name="Scout popup-window "+t.modelClass}_onUnload(){a().log.isDebugEnabled()&&a().log.debug("stored form ID "+this.form.id+" to session storage"),this.form.destroyed?a().log.isDebugEnabled()&&a().log.debug("form ID "+this.form.id+" is already destroyed - don't trigger unload event"):this.trigger("popupWindowUnload",this)}_onReady(){let e=this.myWindow.document,t=a()(this.myWindow),s=a()(e);if(this.myWindow[Lr.PROP_POPUP_WINDOW]=this,u.prepareDOM(e),this.$container=a()(".scout",e),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new Es),this.$container.height(t.height()),this.form.render(this.$container),this.resizeToPrefSize){let r=this.htmlComp.prefSize(),n=new F(this.myWindow.outerWidth,this.myWindow.outerHeight),o=new F(s.width(),s.height()),l=n.width-o.width,h=n.height-o.height;this.myWindow.resizeTo(r.width+l,r.height+h),this.resizeToPrefSize=!1}this.form.htmlComp.validateLayout(),this.session.keyStrokeManager.installTopLevelKeyStrokeHandlers(this.$container),this.session.focusManager.installTopLevelMouseHandlers(this.$container),u.installGlobalMouseDownInterceptor(e),a()(this.myWindow).on("unload",this._onUnload.bind(this)).on("resize",this._onResize.bind(this)),this.myWindow.opener&&(this.myWindow.onerror=this.myWindow.opener.onerror),this._updateTitle(),this.form.on("propertyChange:title propertyChange:subTitle",r=>this._updateTitle()),this.initialized=!0,this.trigger("init")}_onResize(){let e=a()(this.myWindow),t=e.width(),s=e.height(),r=this.myWindow.screenX,n=this.myWindow.screenY;a().log.isDebugEnabled()&&a().log.debug("popup-window resize: width="+t+" height="+s+" top="+n+" left="+r),this.form.storeCacheBounds(new ie(r,n,t,s));let o=new F(e.width(),e.height());this.htmlComp.setSize(o)}isClosed(){return this.myWindow.closed}close(){this.myWindow.close()}_updateTitle(){let e=y.join(" - ",this.form.title,this.form.subTitle),t=this.session.desktop.title;this.title(e||t)}title(e){this.myWindow.document.title=e}}Ir(Lr,"PROP_POPUP_WINDOW","popupWindow");function J_(i,e,t){return e=rR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function rR(i){var e=nR(i,"string");return typeof e=="symbol"?e:String(e)}function nR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class of{constructor(){J_(this,"objectType",void 0),J_(this,"session",void 0)}init(e){this.session=e.session}openUri(e,t){a().log.isDebugEnabled()&&a().log.debug("(OpenUriHandler#openUri) uri="+e+" action="+t),e&&(t=u.nvl(t,Ie.UriAction.OPEN),t===Ie.UriAction.DOWNLOAD?this.handleUriActionDownload(e):t===Ie.UriAction.OPEN?this.handleUriActionOpen(e):t===Ie.UriAction.NEW_WINDOW?this.handleUriActionNewWindow(e):t===Ie.UriAction.POPUP_WINDOW?this.handleUriActionPopupWindow(e):t===Ie.UriAction.SAME_WINDOW&&this.handleUriActionSameWindow(e))}handleUriActionDownload(e){x.get().isIos()?x.get().isStandalone()?this.openUriInSameWindow(e):this.openUriAsNewWindow(e):x.get().browser===x.Browser.CHROME&&this.isUriWithExternallyHandledProtocol(e)?this.openUriInSameWindow(e):this.openUriInIFrame(e)}isUriWithExternallyHandledProtocol(e){return/^(callto|facetime|fax|geo|mailto|maps|notes|sip|skype|tel|google.navigation|sms|msteams):/.test(e)}handleUriActionOpen(e){x.get().isIos()?this.openUriInSameWindow(e):this.isUriWithExternallyHandledProtocol(e)?x.get().browser===x.Browser.CHROME||x.get().isAndroid()?this.openUriInSameWindow(e):this.openUriInIFrame(e):this.openUriAsNewWindow(e)}handleUriActionNewWindow(e){this.openUriAsNewWindow(e)}handleUriActionPopupWindow(e){this.openUriAsPopupWindow(e)}handleUriActionSameWindow(e){this.openUriInSameWindow(e)}openUriInSameWindow(e){window.location.assign(e)}openUriInIFrame(e){let t=this.session.$entryPoint.appendElement("<iframe>","download-frame").attr("tabindex",-1).attr("src",e);setTimeout(()=>{t.remove()},10*1e3)}openUriAsNewWindow(e){u.create(Do,{session:this.session}).openWindow(e)}openUriAsPopupWindow(e){u.create(Do,{session:this.session}).openWindow(e,null,"location=no,toolbar=no,menubar=no,resizable=yes,scrollbars=yes")}}function Ae(i,e,t){return e=oR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function oR(i){var e=lR(i,"string");return typeof e=="symbol"?e:String(e)}function lR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ci extends I{constructor(){super(),Ae(this,"desktop",void 0),Ae(this,"outline",void 0),Ae(this,"outlineContent",void 0),Ae(this,"navigationHandle",void 0),Ae(this,"headerTabArea",void 0),Ae(this,"columns",void 0),Ae(this,"components",void 0),Ae(this,"tabBoxMap",void 0),Ae(this,"layoutData",void 0),Ae(this,"headerTabAreaController",void 0),Ae(this,"changingCounter",void 0),Ae(this,"changed",void 0),Ae(this,"outlineContentVisible",void 0),Ae(this,"navigationHandleVisible",void 0),Ae(this,"layoutCacheKey",void 0),Ae(this,"desktopKeyStrokeContext",void 0),Ae(this,"_removeViewInProgress",void 0),Ae(this,"_updateOutlineContentTimeout",void 0),Ae(this,"_desktopOutlineChangeHandler",void 0),Ae(this,"_desktopPropertyChangeHandler",void 0),Ae(this,"_desktopAnimationEndHandler",void 0),Ae(this,"_outlineNodesSelectedHandler",void 0),Ae(this,"_outlinePageChangedHandler",void 0),Ae(this,"_outlinePropertyChangeHandler",void 0),Ae(this,"_outlineContentDestroyHandler",void 0),Ae(this,"_outlineContentCssClassChangeHandler",void 0),Ae(this,"_viewAddHandler",void 0),Ae(this,"_viewRemoveHandler",void 0),Ae(this,"_viewActivateHandler",void 0),Ae(this,"_viewDeactivateHandler",void 0),this.columns=[],this.components=null,this.tabBoxMap={},this._removeViewInProgress=0,this.changingCounter=0,this.changed=!1,this.layoutCacheKey=[],this._desktopOutlineChangeHandler=this._onDesktopOutlineChange.bind(this),this._desktopPropertyChangeHandler=this._onDesktopPropertyChange.bind(this),this._desktopAnimationEndHandler=this._onDesktopAnimationEnd.bind(this),this._outlineNodesSelectedHandler=this._onOutlineNodesSelected.bind(this),this._outlinePageChangedHandler=this._onOutlinePageChanged.bind(this),this._outlinePropertyChangeHandler=this._onOutlinePropertyChange.bind(this),this._outlineContentDestroyHandler=this._onOutlineContentDestroy.bind(this),this._outlineContentCssClassChangeHandler=this._onOutlineContentCssClassChange.bind(this),this._viewAddHandler=this._onViewAdd.bind(this),this._viewRemoveHandler=this._onViewRemove.bind(this),this._viewActivateHandler=this._onViewActivate.bind(this),this._viewDeactivateHandler=this._onViewDeactivate.bind(this)}_init(e){super._init(e),Ci.VIEW_MIN_HEIGHT=a().pxToNumber(M.get("view-tab-box","min-height").minHeight),Ci.VIEW_MIN_WIDTH=a().pxToNumber(M.get("view-tab-box","min-width").minWidth),this.desktop=this.session.desktop,this.setLayoutData(this.desktop.benchLayoutData),this._createColumns(),this.headerTabArea=e.headerTabArea,this.headerTabArea&&(this.headerTabAreaController=u.create(df),this.headerTabAreaController.install(this,this.headerTabArea)),this.outlineContentVisible=u.nvl(e.outlineContentVisible,!0),this.setOutline(this.desktop.outline),this.updateNavigationHandleVisibility()}_setTabArea(e){if(this.headerTabArea=e,this.headerTabAreaController){this.headerTabAreaController.install(this,this.headerTabArea);let t=this.getTabBox("C");t.viewStack.slice().reverse().forEach(s=>{this.headerTabAreaController._onViewAdd({view:s}),t.currentView===s&&this.headerTabAreaController._onViewActivate({view:s})}),this.headerTabAreaController._onViewsChanged()}}_createColumns(){let e=this.getLayoutData(),t=[];e&&(t=this.getLayoutData().getColumns());for(let s=0;s<3;s++){let r=this.layoutCacheKey.slice();r.length>0&&r.push("column"+s);let n=u.create(ys,{parent:this,layoutData:t[s],cacheKey:r,cssClass:Ci.VIEW_AREA_COLUMN_CLASSES[s]});n.on("viewAdd",this._viewAddHandler),n.on("viewRemove",this._viewRemoveHandler),n.on("viewActivate",this._viewActivateHandler),n.on("viewDeactivate",this._viewDeactivateHandler),this.columns.push(n)}}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.desktopKeyStrokeContext=new Oe,this.desktopKeyStrokeContext.invokeAcceptInputOnActiveValueField=!0,this.desktopKeyStrokeContext.$bindTarget=this.desktop.$container,this.desktopKeyStrokeContext.$scopeTarget=this.desktop.$container,this.desktopKeyStrokeContext.registerKeyStroke(new rf(this.desktop))}_render(){this.$container=this.$parent.appendDiv("desktop-bench"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(this._createLayout()),this.htmlComp.layoutData=this.getLayoutData(),this._renderColumns(),this._revalidateSplitters(),this._renderNavigationHandleVisible(),this.session.keyStrokeManager.installKeyStrokeContext(this.desktopKeyStrokeContext),this.desktop.on("propertyChange",this._desktopPropertyChangeHandler),this.desktop.on("outlineChange",this._desktopOutlineChangeHandler),this.desktop.on("animationEnd",this._desktopAnimationEndHandler)}_createLayout(){return new Xs(Xs.Direction.ROW,this.layoutCacheKey)}visibleColumns(){return this.columns.filter(e=>e.hasViews())}_renderColumns(){this.visibleColumns().forEach(e=>this._renderColumn(e)),this.updateFirstLastMarker()}_renderColumn(e){!e||e.rendered||e.render()}_remove(){this.desktop.off("propertyChange",this._desktopPropertyChangeHandler),this.desktop.off("outlineChange",this._desktopOutlineChangeHandler),this.desktop.off("animationEnd",this._desktopAnimationEndHandler),this.session.keyStrokeManager.uninstallKeyStrokeContext(this.desktopKeyStrokeContext),super._remove()}updateFirstLastMarker(){Le.updateFirstLastMarker(this.visibleColumns())}_renderOutlineContent(){!this.outlineContent||(delete this.outlineContent.title,delete this.outlineContent.subTitle,delete this.outlineContent.iconId,this.addView(this.outlineContent,!this.desktop.inBackground),this.desktop.rendered&&this.session.focusManager.validateFocus())}_removeOutlineContent(){!this.outlineContent||this.removeView(this.outlineContent,!1)}_createNavigationHandle(){return u.create(Ph,{parent:this,leftVisible:!1})}_renderNavigationHandle(){this.navigationHandle||(this.navigationHandle=this._createNavigationHandle(),this.navigationHandle.render(),this.navigationHandle.addCssClass("navigation-closed"),this.navigationHandle.on("action",this._onNavigationHandleAction.bind(this)))}_removeNavigationHandle(){!this.navigationHandle||(this.navigationHandle.destroy(),this.navigationHandle=null)}_renderNavigationHandleVisible(){this.navigationHandleVisible?this._renderNavigationHandle():this._removeNavigationHandle(),this.$container.toggleClass("has-navigation-handle",this.navigationHandleVisible)}postRender(){this.columns.forEach(e=>e.postRender())}setChanging(e){e?this.changingCounter++:this.changingCounter--,this.changingCounter===0&&this.changed&&this.rendered&&(this.htmlComp.layout.reset(),this.htmlComp.invalidateLayoutTree(),this.changed=!1)}updateLayoutData(e){if(this.getLayoutData()===e)return;this.setLayoutData(e);let t=e.getColumns();if(this.columns.forEach((s,r)=>{let n;this.layoutCacheKey&&this.layoutCacheKey.length>0&&(n=this.layoutCacheKey.slice(),n.push("column"+r)),s.updateLayoutData(t[r],n)}),this.rendered){let s=this.htmlComp.layout;s.setCacheKey(this.layoutCacheKey),s.reset(),this.htmlComp.invalidateLayoutTree()}this._updateSplitterMovable()}setLayoutData(e){this.layoutData!==e&&(super.setLayoutData(e),this.layoutData=e,this.layoutCacheKey=[],e.cacheKey&&this.layoutCacheKey.push(e.cacheKey))}getLayoutData(){return this.layoutData}setNavigationHandleVisible(e){this.setProperty("navigationHandleVisible",e)}setOutline(e){this.outline&&(this.outline.off("nodesSelected",this._outlineNodesSelectedHandler),this.outline.off("pageChanged",this._outlinePageChangedHandler),this.outline.off("propertyChange",this._outlinePropertyChangeHandler)),this._setProperty("outline",e),this.outline&&(this.outline.on("nodesSelected",this._outlineNodesSelectedHandler),this.outline.on("pageChanged",this._outlinePageChangedHandler),this.outline.on("propertyChange",this._outlinePropertyChangeHandler)),this.updateOutlineContent()}setOutlineContent(e){if(this.outlineContent===e)return;let t=this.outlineContent;t&&(t.off("destroy",this._outlineContentDestroyHandler),t.off("propertyChange:cssClass",this._outlineContentCssClassChangeHandler)),this.rendered&&this._removeOutlineContent(),e&&(e.one("destroy",this._outlineContentDestroyHandler),e.on("propertyChange:cssClass",this._outlineContentCssClassChangeHandler)),this._setProperty("outlineContent",e),this.desktop.header&&this.desktop.header.onBenchOutlineContentChange(e,t),this._updateOutlineContentHasDimmedBackground(),this._renderOutlineContent()}setOutlineContentVisible(e){e!==this.outlineContentVisible&&(this._setProperty("outlineContentVisible",e),this.updateOutlineContent())}bringToFront(){!this.outlineContent||this._renderOutlineContent()}sendToBack(){}_updateOutlineContentHasDimmedBackground(){if(!this.outlineContent)return;let e=!1;this.outlineContent.cssClass&&(e=this.outlineContent.cssClass.indexOf("dimmed-background")>-1),this.toggleCssClass("outline-content-has-dimmed-background",e)}_computeDetailContentForPage(e){if(!e)throw new Error("called _showDetailContentForPage without node");let t;return e.detailForm&&e.detailFormVisible&&e.detailFormVisibleByUi?(t=e.detailForm,t.uiCssClass="detail-form"):e.detailTable&&e.detailTableVisible&&(t=e.detailTable,t.uiCssClass="detail-table perma-focus"),t}updateOutlineContent(){if(!this.outlineContentVisible||!this.outline)return;let e,t=this.outline.selectedNode();t?e=this._computeDetailContentForPage(t):e=this.outline.getRootContent(),e&&(e instanceof V&&(e.menuBar.addCssClass("main-menubar"),e.menuBar.removeCssClass("bounded")),e.displayViewId="C"),this.setOutlineContent(e)}updateOutlineContentDebounced(){clearTimeout(this._updateOutlineContentTimeout),this._updateOutlineContentTimeout=setTimeout(()=>this.updateOutlineContent(),300)}updateNavigationHandleVisibility(){this.setNavigationHandleVisible(this.desktop.navigationHandleVisible&&!this.desktop.navigationVisible)}_onDesktopOutlineChange(e){this.setOutline(this.desktop.outline),this.updateNavigationHandleVisibility()}_onOutlineContentDestroy(e){e.source===this.outlineContent&&this.setOutlineContent(null)}_onOutlineContentCssClassChange(e){this._updateOutlineContentHasDimmedBackground()}_onOutlineNodesSelected(e){e.debounce?this.updateOutlineContentDebounced():this.updateOutlineContent()}_onOutlinePageChanged(e){let t=this.outline.selectedNode();(!e.page&&!t||e.page===t)&&this.updateOutlineContent()}_onOutlinePropertyChange(e){u.isOneOf(e.propertyName,["defaultDetailForm","outlineOverview"])&&this.updateOutlineContent()}_onDesktopNavigationVisibleChange(){this.desktop.navigationVisible&&this.updateNavigationHandleVisibility()}_onDesktopNavigationHandleVisibleChange(){this.updateNavigationHandleVisibility()}_onDesktopAnimationEnd(e){this.desktop.navigationVisible||this.updateNavigationHandleVisibility()}_onBenchLayoutDataChange(){this.updateLayoutData(this.desktop.benchLayoutData)}_onDesktopPropertyChange(e){e.propertyName==="navigationVisible"?this._onDesktopNavigationVisibleChange():e.propertyName==="navigationHandleVisible"&&this._onDesktopNavigationHandleVisibleChange(),e.propertyName==="benchLayoutData"&&this._onBenchLayoutDataChange()}_onNavigationHandleAction(e){this.desktop.enlargeNavigation()}_revalidateSplitters(){this.components&&this.components.forEach(e=>{e instanceof Js&&e.destroy()}),this.components=this.visibleColumns().reduce((e,t)=>{if(e.length>0){let s=u.create(Js,{parent:this,$anchor:e[e.length-1].$container,$root:this.$container});s.render(),s.setLayoutData(yr.fixed().withOrder(t.getLayoutData().order-1)),s.$container.addClass("line"),e.push(s)}return e.push(t),e},[]),this.components.filter(e=>e instanceof ys).reduce((e,t,s)=>(s>0&&t.$container.insertAfter(e.$container),t),void 0),this._updateSplitterMovable()}_updateSplitterMovable(){!this.components||this.components.forEach((e,t)=>{if(e instanceof Js){let s=this.components.slice(0,t).reverse(),r=this.components.slice(t+1);if(s.filter(n=>n.getLayoutData().shrink>0).length>0&&r.filter(n=>n.getLayoutData().grow>0).length>0){e.setEnabled(!0),e.on("move",this._onSplitterMove.bind(this));return}if(s.filter(n=>n.getLayoutData().grow>0).length>0&&r.filter(n=>n.getLayoutData().shrink>0).length>0){e.setEnabled(!0),e.on("move",this._onSplitterMove.bind(this));return}e.setEnabled(!1)}})}_onSplitterMove(e){let t=e.source,s=e.position-t.htmlComp.location().x-t.htmlComp.margins().left-t.htmlComp.insets().left;t.getLayoutData().diff=s,this.revalidateLayout(),t.getLayoutData().diff=null,e.preventDefault()}_onViewAdd(e){this.trigger("viewAdd",{view:e.view})}_onViewRemove(e){this.trigger("viewRemove",{view:e.view})}_onViewActivate(e){let t=e.view;this.outlineContent===t&&this.desktop.bringOutlineToFront(),this.trigger("viewActivate",{view:t})}_onViewDeactivate(e){this.outlineContent===e.view&&this.desktop.sendOutlineToBack(),this.trigger("viewDeactivate",{view:e.view})}addView(e,t){switch(e.displayViewId){case"NW":case"W":case"SW":case"N":case"C":case"S":case"NE":case"E":case"SE":break;default:e.displayViewId="C";break}let s=this._getColumn(e.displayViewId);this.tabBoxMap[e.id]=s,s.addView(e,t),this.rendered&&s.viewCount()===1&&(this._renderColumn(s),this._revalidateSplitters(),this.updateFirstLastMarker(),this.changingCounter>0?this.changed=!0:(this.htmlComp.layout.reset(),this.htmlComp.invalidateLayoutTree()))}activateView(e){if(!this.hasView(e))return;let t=this._getColumn(e.displayViewId);t&&t.activateView(e)}_getColumn(e){let t;switch(e){case"NW":case"W":case"SW":t=this.columns[Ci.VIEW_AREA_COLUMN_INDEX.LEFT];break;case"NE":case"E":case"SE":t=this.columns[Ci.VIEW_AREA_COLUMN_INDEX.RIGHT];break;default:t=this.columns[Ci.VIEW_AREA_COLUMN_INDEX.CENTER];break}return t}removeView(e,t){let s=this.tabBoxMap[e.id];s&&(this._removeViewInProgress++,s.removeView(e,t),this._removeViewInProgress--,delete this.tabBoxMap[e.id],this.rendered&&s.viewCount()===0&&this._removeViewInProgress===0&&(s.remove(),this._revalidateSplitters(),this.updateFirstLastMarker(),this.changingCounter>0?this.changed=!0:(this.htmlComp.layout.reset(),this.htmlComp.invalidateLayoutTree())))}getComponents(){return this.components}getTabBox(e){let t=this._getColumn(e);if(!!t)return t.getTabBox(e)}visibleTabBoxes(){return this.visibleColumns().reduce((e,t)=>(p.pushAll(e,t.visibleTabBoxes()),e),[])}hasView(e){return this.columns.filter(t=>t.hasView(e)).length>0}getViews(e){return this.columns.reduce((t,s)=>(p.pushAll(t,s.getViews(e)),t),[])}getViewTab(e){let t=null;return this.getTabs().some(s=>s.view===e?(t=s,!0):!1),t}getTabs(){let e=[];return e=e.concat(this._getTabsForDisplayViewId("NW")),e=e.concat(this._getTabsForDisplayViewId("W")),e=e.concat(this._getTabsForDisplayViewId("SW")),e=e.concat(this._getTabsForDisplayViewId("N")),this.headerTabAreaController?e=e.concat(this.headerTabAreaController.getTabs()):e=e.concat(this._getTabsForDisplayViewId("C")),e=e.concat(this._getTabsForDisplayViewId("S")),e=e.concat(this._getTabsForDisplayViewId("NE")),e=e.concat(this._getTabsForDisplayViewId("E")),e=e.concat(this._getTabsForDisplayViewId("SE")),e}_getTabsForDisplayViewId(e){return this.getTabBox(e).getController().getTabs()}activeViews(){let e=[];return this.visibleColumns().forEach(t=>{t.visibleTabBoxes().forEach(s=>{e.push(s.currentView)})}),e}}Ae(Ci,"VIEW_MIN_HEIGHT",null),Ae(Ci,"VIEW_MIN_WIDTH",null),Ae(Ci,"VIEW_AREA_COLUMN_INDEX",{LEFT:0,CENTER:1,RIGHT:2}),Ae(Ci,"VIEW_AREA_COLUMN_CLASSES",["west","center","east"]);function Zi(i,e,t){return e=aR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function aR(i){var e=hR(i,"string");return typeof e=="symbol"?e:String(e)}function hR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ys extends I{constructor(){super(),Zi(this,"tabBoxes",void 0),Zi(this,"layoutData",void 0),Zi(this,"components",void 0),Zi(this,"layoutCacheKey",void 0),Zi(this,"_widgetToTabBox",void 0),Zi(this,"_removeViewInProgress",void 0),Zi(this,"_viewAddHandler",void 0),Zi(this,"_viewRemoveHandler",void 0),Zi(this,"_viewActivateHandler",void 0),Zi(this,"_viewDeactivateHandler",void 0),this.tabBoxes=[],this._widgetToTabBox={},this.components=null,this._removeViewInProgress=0,this._viewAddHandler=this._onViewAdd.bind(this),this._viewRemoveHandler=this._onViewRemove.bind(this),this._viewActivateHandler=this._onViewActivate.bind(this),this._viewDeactivateHandler=this._onViewDeactivate.bind(this)}_init(e){super._init(e),this.layoutData=e.layoutData,this.layoutCacheKey=e.cacheKey,this.cssClass=e.cssClass,this._createTabBoxes()}_render(){this.$container=this.$parent.appendDiv("bench-column"),this.cssClass&&this.$container.addClass(this.cssClass),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(this._createLayout()),this.htmlComp.layoutData=this.getLayoutData()}_renderProperties(){super._renderProperties(),this._renderTabBoxes(),this._revalidateSplitters()}_renderTabBoxes(){this.visibleTabBoxes().forEach(e=>this._renderTabBox(e)),this.updateFirstLastMarker()}_renderTabBox(e){e.rendered||(e.render(),e.htmlComp.validateRoot=!0)}postRender(){this.tabBoxes.forEach(e=>e.postRender())}_createLayout(){return new Xs(Xs.Direction.COLUMN,this.layoutCacheKey)}updateLayoutData(e,t){if(this.getLayoutData()===e)return;this.layoutCacheKey=t,this.setLayoutData(e);let s=this.layoutData.getRows();if(this.tabBoxes.forEach((r,n)=>r.setLayoutData(s[n])),this._updateSplitterMovable(),this.rendered){let r=this.htmlComp.layout;r.setCacheKey(this.layoutCacheKey),r.reset(),this.htmlComp.invalidateLayoutTree()}}setLayoutData(e){super.setLayoutData(e),this.layoutData=e}getLayoutData(){return this.layoutData}_onViewAdd(e){this.trigger("viewAdd",{view:e.view})}_onViewRemove(e){this.trigger("viewRemove",{view:e.view})}_onViewActivate(e){this.trigger("viewActivate",{view:e.view})}_onViewDeactivate(e){this.trigger("viewDeactivate",{view:e.view})}activateView(e){this.getTabBox(e.displayViewId).activateView(e)}_createTabBoxes(){let e=[];this.layoutData&&(e=this.layoutData.getRows());for(let t=0;t<3;t++){let s=u.create(ea,{parent:this,cssClass:y.join(" ","view-tab-box",ys.TAB_BOX_CLASSES[t]),controller:u.create(Th)});s.setLayoutData(e[t]),s.on("viewAdd",this._viewAddHandler),s.on("viewRemove",this._viewRemoveHandler),s.on("viewActivate",this._viewActivateHandler),s.on("viewDeactivate",this._viewDeactivateHandler),this.tabBoxes.push(s)}}_revalidateSplitters(){this.components&&this.components.forEach(e=>{e instanceof Js&&e.destroy()}),this.components=this.visibleTabBoxes().reduce((e,t)=>{if(e.length>0){let s=u.create(Js,{parent:this,$anchor:e[e.length-1].$container,$root:this.$container,splitHorizontal:!1});s.render(),s.setLayoutData(yr.fixed().withOrder(this._getTabBoxLayoutData(t).order-1)),s.$container.addClass("line"),e.push(s)}return e.push(t),e},[]),this.components.filter(e=>e instanceof ea).reduce((e,t,s)=>(s>0&&t.$container.insertAfter(e.$container),t),void 0),this._updateSplitterMovable()}_getTabBoxLayoutData(e){return e.getLayoutData()}_updateSplitterMovable(){!this.components||this.components.forEach((e,t)=>{if(e instanceof Js){let s=this.components.slice(0,t).reverse(),r=this.components.slice(t+1);if(s.filter(n=>this._getTabBoxLayoutData(n).shrink>0).length>0&&r.filter(n=>this._getTabBoxLayoutData(n).grow>0).length>0){e.setEnabled(!0),e.on("move",this._onSplitterMove.bind(this));return}if(s.filter(n=>this._getTabBoxLayoutData(n).grow>0).length>0&&r.filter(n=>this._getTabBoxLayoutData(n).shrink>0).length>0){e.setEnabled(!0),e.on("move",this._onSplitterMove.bind(this));return}e.setEnabled(!1)}})}_onSplitterMove(e){let t=e.source,s=e.position-t.htmlComp.location().y-t.htmlComp.margins().top-t.htmlComp.insets().top;t.getLayoutData().diff=s,this.revalidateLayout(),t.getLayoutData().diff=null,e.preventDefault()}addView(e,t){let s=this.getTabBox(e.displayViewId);this._widgetToTabBox[e.id]=s,s.addView(e,t),this.rendered&&s.viewCount()===1&&(s.rendered||s.render(),this._revalidateSplitters(),this.updateFirstLastMarker(),this.htmlComp.layout.reset(),this.htmlComp.invalidateLayoutTree())}getTabBox(e){let t;switch(e){case"NW":case"N":case"NE":t=this.tabBoxes[ys.TAB_BOX_INDEX.TOP];break;case"SW":case"S":case"SE":t=this.tabBoxes[ys.TAB_BOX_INDEX.BOTTOM];break;default:t=this.tabBoxes[ys.TAB_BOX_INDEX.CENTER];break}return t}removeView(e,t){let s=this._widgetToTabBox[e.id];s&&(this._removeViewInProgress++,s.removeView(e,t),this._removeViewInProgress--,delete this._widgetToTabBox[e.id],this.rendered&&s.viewCount()===0&&this._removeViewInProgress===0&&(s.remove(),this._revalidateSplitters(),this.updateFirstLastMarker(),this.htmlComp.layout.reset(),this.htmlComp.invalidateLayoutTree()))}viewCount(){return this.tabBoxes.map(e=>e.viewCount()).reduce((e,t)=>e+t,0)}hasView(e){return this.tabBoxes.filter(t=>t.hasView(e)).length>0}hasViews(){return this.viewCount()>0}getViews(e){return this.tabBoxes.reduce((t,s)=>(p.pushAll(t,s.getViews(e)),t),[])}getComponents(){return this.components}visibleTabBoxes(){return this.tabBoxes.filter(e=>e.hasViews())}updateFirstLastMarker(){Le.updateFirstLastMarker(this.visibleTabBoxes())}}Zi(ys,"TAB_BOX_INDEX",{TOP:0,CENTER:1,BOTTOM:2}),Zi(ys,"TAB_BOX_CLASSES",["north","center","south"]);function dR(i,e,t){return e=uR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function uR(i){var e=cR(i,"string");return typeof e=="symbol"?e:String(e)}function cR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class lf extends yr{constructor(e){super(e),dR(this,"rows",void 0),e=e||{},this.rows=u.nvl(e.rows,[null,null,null]),this._ensureRows()}getRows(){return this.rows}_ensureRows(){this.rows=this.rows.map((e,t)=>new yr(e).withOrder(t*2))}}function pR(i,e,t){return e=fR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function fR(i){var e=mR(i,"string");return typeof e=="symbol"?e:String(e)}function mR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Rn{constructor(e){pR(this,"columns",void 0),this.columns=[null,null,null],a().extend(this,e),this._ensureColumns()}_ensureColumns(){this.columns=this.columns.map((e,t)=>new lf(e).withOrder(t*2))}getColumns(){return this.columns}static ensure(e){return e?e instanceof Rn?e:new Rn(e):new Rn}}class af extends Yo{constructor(e){super(),this.field=e,this.parseAndSetKeyStroke(e.selectViewTabsKeyStrokeModifier),this.registerRange(g[1],g[9]),this.renderingHints.render=!1,this.preventDefault=!0,this.inheritAccessibility=!1}_isEnabled(){return super._isEnabled()&&this.field.selectViewTabsKeyStrokesEnabled}handle(e){}}function Si(i,e,t){return e=gR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function gR(i){var e=_R(i,"string");return typeof e=="symbol"?e:String(e)}function _R(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class hf extends I{constructor(){super(),Si(this,"desktop",void 0),Si(this,"tabArea",void 0),Si(this,"logoUrl",void 0),Si(this,"logo",void 0),Si(this,"toolBoxVisible",void 0),Si(this,"toolBox",void 0),Si(this,"viewButtonBoxVisible",void 0),Si(this,"viewButtonBox",void 0),Si(this,"outlineContent",void 0),Si(this,"_desktopPropertyChangeHandler",void 0),Si(this,"_desktopAnimationEndHandler",void 0),Si(this,"_outlineContentMenuBarVisibleChangeHandler",void 0),Si(this,"_outlineContentCssClassChangeHandler",void 0),Si(this,"_viewButtonBoxPropertyChangeHandler",void 0),this.tabArea=null,this.toolBoxVisible=!0,this.viewButtonBox=null,this.viewButtonBoxVisible=!1,this.outlineContent=null,this._desktopPropertyChangeHandler=this._onDesktopPropertyChange.bind(this),this._desktopAnimationEndHandler=this._onDesktopAnimationEnd.bind(this),this._outlineContentMenuBarVisibleChangeHandler=this._onOutlineContentMenuBarVisibleChange.bind(this),this._outlineContentCssClassChangeHandler=this._onOutlineContentCssClassChange.bind(this),this._viewButtonBoxPropertyChangeHandler=this._onViewButtonBoxPropertyChange.bind(this)}_init(e){super._init(e),this.desktop=this.session.desktop,this.updateViewButtonBoxVisibility(),this.tabArea=this._createTabArea()}_createTabArea(){return u.create(wh,$.extend({parent:this},this.tabArea))}_render(){this.$container=this.$parent.appendDiv("desktop-header"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new uf(this)),this.desktop.on("propertyChange",this._desktopPropertyChangeHandler),this.desktop.on("animationEnd",this._desktopAnimationEndHandler),this.desktop.bench&&this._setOutlineContent(this.desktop.bench.outlineContent)}_renderProperties(){super._renderProperties(),this._renderViewButtonBoxVisible(),this._renderViewTabs(),this._renderToolBoxVisible(),this._renderLogoUrl(),this._renderInBackground()}_remove(){this.desktop.off("propertyChange",this._desktopPropertyChangeHandler),this.desktop.off("animationEnd",this._desktopAnimationEndHandler),this._setOutlineContent(null),super._remove()}_renderViewTabs(){this.tabArea.render()}_renderToolBox(){this.toolBox||(this.toolBox=this._createToolBox(),this.toolBox.render())}_createToolBox(){return u.create(Eh,{parent:this,menus:this.desktop.menus})}_removeToolBox(){!this.toolBox||(this.toolBox.destroy(),this.toolBox=null)}_renderToolBoxVisible(){this.toolBoxVisible?this._renderToolBox():this._removeToolBox(),this.invalidateLayoutTree()}_renderLogoUrl(){this.logoUrl?this._renderLogo():this._removeLogo(),this.invalidateLayoutTree()}_renderLogo(){this.desktop.displayStyle!==Ie.DisplayStyle.COMPACT&&(this.logo?this.logo.setUrl(this.logoUrl):(this.logo=this._createLogo(),this.logo.render()))}_createLogo(){return u.create(Zp,{parent:this,url:this.logoUrl})}_removeLogo(){!this.logo||(this.logo.destroy(),this.logo=null)}_renderViewButtonBox(){this.viewButtonBox||(this.viewButtonBox=this._createViewButtonBox(),this.viewButtonBox.on("propertyChange",this._viewButtonBoxPropertyChangeHandler),this.viewButtonBox.render(),this.viewButtonBox.$container.prependTo(this.$container),this.updateViewButtonStyling())}_createViewButtonBox(){return u.create(Fh,{parent:this,viewButtons:this.desktop.viewButtons,selectedMenuButtonAlwaysVisible:!0})}_removeViewButtonBox(){!this.viewButtonBox||(this.viewButtonBox.off("propertyChange",this._viewButtonBoxPropertyChangeHandler),this.viewButtonBox.destroy(),this.viewButtonBox=null)}_renderViewButtonBoxVisible(){this.viewButtonBoxVisible?this._renderViewButtonBox():this._removeViewButtonBox(),this.$container.toggleClass("has-view-button-box",this.viewButtonBoxVisible),this.invalidateLayoutTree()}sendToBack(){this.rendered&&this._renderInBackground()}bringToFront(){this.rendered&&this._renderInBackground()}_renderInBackground(){this.$container.toggleClass("in-background",this.desktop.inBackground)}setLogoUrl(e){this.setProperty("logoUrl",e)}setToolBoxVisible(e){this.setProperty("toolBoxVisible",e)}setViewButtonBoxVisible(e){this.setProperty("viewButtonBoxVisible",e)}setMenus(e){this.toolBox&&this.toolBox.setMenus(e)}_setOutlineContent(e){this.outlineContent!==e&&(this._detachOutlineContentHandlers(),this._setProperty("outlineContent",e),this._attachOutlineContentHandlers(),this.updateViewButtonStyling())}updateViewButtonBoxVisibility(){this.setViewButtonBoxVisible(this.desktop.viewButtons.some(e=>e.visible)&&!this.desktop.navigationVisible&&this.desktop.displayStyle!==Ie.DisplayStyle.COMPACT)}_attachOutlineContentHandlers(){this._attachOutlineContentMenuBarHandler(),this._attachOutlineContentCssClassHandler()}_attachOutlineContentMenuBarHandler(){if(!this.outlineContent)return;let e=this._outlineContentMenuBar(this.outlineContent);e&&e.on("propertyChange:visible",this._outlineContentMenuBarVisibleChangeHandler)}_attachOutlineContentCssClassHandler(){!this.outlineContent||this.outlineContent.on("propertyChange:cssClass",this._outlineContentCssClassChangeHandler)}_detachOutlineContentHandlers(){this._detachOutlineContentMenuBarHandler(),this._detachOutlineContentCssClassHandler()}_detachOutlineContentMenuBarHandler(){if(!this.outlineContent)return;let e=this._outlineContentMenuBar(this.outlineContent);e&&e.off("propertyChange:visible",this._outlineContentMenuBarVisibleChangeHandler)}_detachOutlineContentCssClassHandler(){!this.outlineContent||this.outlineContent.off("propertyChange:cssClass",this._outlineContentCssClassChangeHandler)}_outlineContentMenuBar(e){return e instanceof U?e.rootGroupBox.menuBar:e.menuBar}updateViewButtonStyling(){this._updateOutlineContentHasMenuBar(),this._updateOutlineContentHasDimmedBackground()}_getOutlineContentForViewButtonStyling(){if(!(!this.viewButtonBoxVisible||!this.outlineContent||!this.outlineContent.visible))return this.outlineContent}_updateOutlineContentHasMenuBar(){let e=this._getOutlineContentForViewButtonStyling();if(!e)return;let t=!1;if(e instanceof U&&e.detailForm){let s=e.rootGroupBox;t=s.menuBar&&s.menuBarVisible&&s.menuBar.visible}else{let s=e;t=s.menuBar&&s.menuBar.visible}this.$container.toggleClass("outline-content-has-menubar",!!t)}_updateOutlineContentHasDimmedBackground(){let e=this._getOutlineContentForViewButtonStyling();if(!e)return;let t=!1;e.cssClass&&(t=e.cssClass.indexOf("dimmed-background")>-1),this.$container.toggleClass("outline-content-has-dimmed-background",t)}_onDesktopNavigationVisibleChange(){this.desktop.navigationVisible&&this.updateViewButtonBoxVisibility()}_onDesktopAnimationEnd(e){this.updateViewButtonBoxVisibility()}onBenchOutlineContentChange(e,t){this._setOutlineContent(e)}_onDesktopPropertyChange(e){e.propertyName==="navigationVisible"&&this._onDesktopNavigationVisibleChange()}_onOutlineContentMenuBarVisibleChange(e){this._updateOutlineContentHasMenuBar()}_onOutlineContentCssClassChange(e){this._updateOutlineContentHasDimmedBackground()}_onViewButtonBoxPropertyChange(e){(e.propertyName==="menuButtons"||e.propertyName==="tabButtons")&&this.invalidateLayoutTree()}}function Ch(i,e,t){return e=yR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function yR(i){var e=bR(i,"string");return typeof e=="symbol"?e:String(e)}function bR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class df extends Th{constructor(){super(),Ch(this,"bench",void 0),Ch(this,"tabAreaCenter",void 0),Ch(this,"tabAreaInHeader",void 0),Ch(this,"_viewsChangedHandler",void 0),this.bench=null,this._viewsChangedHandler=this._onViewsChanged.bind(this),this.tabAreaCenter=null,this.tabAreaInHeader=!1}install(e,t){this.bench=u.assertParameter("bench",e);let s=this.bench.getTabBox("C");this.tabAreaCenter=s.tabArea,super.install(s,t)}_installListeners(){super._installListeners(),this.bench.on("viewAdd",this._viewsChangedHandler),this.bench.on("viewRemove",this._viewsChangedHandler)}_onViewsChanged(){this.bench.getViews().some(e=>e.displayViewId!=="C")?this._setViewTabAreaInHeader(!1):this._setViewTabAreaInHeader(!0)}_setViewTabAreaInHeader(e){this.tabAreaInHeader=e,this.tabAreaCenter.setVisible(!e),this.tabArea.setVisible(e);let t=this.tabArea.session.desktop;t.rendered&&t.$container.toggleClass("view-tab-area-in-bench",!e)}getTabs(){return this.tabAreaInHeader?this.tabArea.getTabs():this.tabAreaCenter.getTabs()}_onViewTabSelect(e){super._onViewTabSelect(e),this.tabArea.updateFirstTabSelected()}}function Q_(i,e,t){return e=vR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function vR(i){var e=wR(i,"string");return typeof e=="symbol"?e:String(e)}function wR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class uf extends ee{constructor(e){super(),Q_(this,"header",void 0),Q_(this,"desktop",void 0),this.header=e,this.desktop=e.desktop}layout(e){let t,s,r,n,o=this.header.htmlComp,l=o.size(),h=this.header.toolBox,d=this.header.viewButtonBox,c=this.header.tabArea,f=0,m=0,_=0,C=0;if(l=l.subtract(o.insets()),this.header.logo&&(m=v.size(this.header.logo.$container,!0).width),d&&(t=d.htmlComp.prefSize(!0),_=t.width,d.htmlComp.setSize(t.subtract(d.htmlComp.margins()))),c.htmlComp.$comp.cssLeft(_),h&&(s=h.htmlComp.prefSize(!0),C=s.width,rt(),zt()),f=L(),n=we(),r=c.htmlComp.prefSize({widthHint:f,includeMargin:!0}),f>=n.width){f=Math.min(r.width,f),H();return}if(h&&(s=Ze(),C=s.width,rt(),zt()),f=L(),f>=n.width){H();return}h&&(s=di(),C=s.width,rt(),zt()),f=L(),c.displayStyle!==Ni.DisplayStyle.SPREAD_EVEN&&(f=Math.min(n.width,f));let R=c.htmlComp.layout.overflowTabItemWidth;f=Math.max(f,c.tabs.length?R:0),H(),h&&f<=R&&(C=l.width-f-m-_,rt(),zt());function L(){return l.width-C-m-_}function H(){c.htmlComp.setSize(new F(f,r.height).subtract(c.htmlComp.margins()))}function we(){return c.htmlComp.layout.smallPrefSize({widthHint:f}).add(c.htmlComp.margins())}function rt(){h.htmlComp.setSize(new F(C,s.height).subtract(h.htmlComp.margins()))}function Ze(){return h.htmlComp.layout.compactPrefSize().add(h.htmlComp.margins())}function di(){return h.htmlComp.layout.shrinkPrefSize().add(h.htmlComp.margins())}function zt(){h.htmlComp.$comp.cssLeft(l.width-C-m)}}}function TR(i,e,t){return e=CR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function CR(i){var e=SR(i,"string");return typeof e=="symbol"?e:String(e)}function SR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Sh extends I{constructor(){super(),TR(this,"widgets",void 0),this.widgets={}}static get(e){return p.find(e.desktop.addOns,t=>t instanceof Sh)}_init(e){super._init(e),this._setWidgets(this.widgets)}_setWidgets(e){const t=$.extend(!0,{},this.widgets),s=Object.keys(t);e=this._ensureWidgets(e),this._setProperty("widgets",e);const r=[],n=[...s];Object.keys(this.widgets).forEach(o=>{p.remove(n,o)||r.push(o)}),r.forEach(o=>this._triggerWidgetAdd(o,this.widgets[o])),n.forEach(o=>this._triggerWidgetRemove(o,t[o]))}_ensureWidgets(e){const t={};return Object.keys(e).forEach(s=>{t[s]=this._createChildren(e[s])}),t}_triggerWidgetAdd(e,t){this.trigger("widgetAdd:".concat(e),{widget:t})}_triggerWidgetRemove(e,t){this.trigger("widgetRemove:".concat(e),{widget:t})}onHybridEvent(e,t,s){this.trigger("".concat(t,":").concat(e),{data:s})}onHybridWidgetEvent(e,t,s){const r=this.widgets[e];!r||(r instanceof U?this._onHybridFormEvent(r,t,s):this._onHybridWidgetEvent(r,t,s))}_onHybridWidgetEvent(e,t,s){e.trigger(t,{data:s})}_onHybridFormEvent(e,t,s){t==="reset"?e.trigger("reset"):t==="save"?(e.setData(s),e.trigger("save")):t==="close"?e.trigger("close"):this._onHybridWidgetEvent(e,t,s)}_createEventId(){return vs.take(this.session)}triggerHybridAction(e,t){const s=this._createEventId();return this.trigger("hybridAction",{data:{id:s,eventType:e,data:t}}),s}async triggerHybridActionAndWait(e,t){const s=this.triggerHybridAction(e,t);return(await this.when("hybridActionEnd:".concat(s))).data}async openForm(e,t){const s=this.triggerHybridAction("openForm:".concat(e),t);return(await this.when("widgetAdd:".concat(s))).widget}async createForm(e,t){const s=this.triggerHybridAction("createForm:".concat(e),t);return(await this.when("widgetAdd:".concat(s))).widget}one(e,t){super.one(e,t)}on(e,t){return super.on(e,t)}off(e,t){super.off(e,t)}when(e){return super.when(e)}}class Z_ extends ke{constructor(){super()}onModelAction(e){e.type==="hybridEvent"?this._onHybridEvent(e):e.type==="hybridWidgetEvent"?this._onHybridWidgetEvent(e):super.onModelAction(e)}_onHybridEvent(e){this.widget.onHybridEvent(e.id,e.eventType,e.data)}_onHybridWidgetEvent(e){this.widget.onHybridWidgetEvent(e.id,e.eventType,e.data)}_onWidgetEvent(e){e.type==="hybridAction"?this._onWidgetHybridAction(e):super._onWidgetEvent(e)}_onWidgetHybridAction(e){this._send("hybridAction",e.data)}}function ei(i,e,t){return e=PR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function PR(i){var e=xR(i,"string");return typeof e=="symbol"?e:String(e)}function xR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Wt extends I{constructor(){super(),ei(this,"desktop",void 0),ei(this,"outline",void 0),ei(this,"handleVisible",void 0),ei(this,"handle",void 0),ei(this,"toolBox",void 0),ei(this,"toolBoxVisible",void 0),ei(this,"viewButtonBox",void 0),ei(this,"layoutData",void 0),ei(this,"$body",void 0),ei(this,"htmlCompBody",void 0),ei(this,"_outlinePropertyChangeHandler",void 0),ei(this,"_desktopPropertyChangeHandler",void 0),ei(this,"_viewButtonBoxPropertyChangeHandler",void 0),this.$body=null,this.layoutData={},this.toolBoxVisible=!1,this.viewButtonBox=null,this.handleVisible=!0,this._outlinePropertyChangeHandler=this._onOutlinePropertyChange.bind(this),this._desktopPropertyChangeHandler=this._onDesktopPropertyChange.bind(this),this._viewButtonBoxPropertyChangeHandler=this._onViewButtonBoxPropertyChange.bind(this)}_init(e){super._init(e),Wt.MIN_WIDTH=M.getSize("desktop-navigation","min-width","minWidth",49),Wt.DEFAULT_STYLE_WIDTH=M.getSize("desktop-navigation","width","width",290),Wt.BREADCRUMB_STYLE_WIDTH=M.getSize("desktop-navigation-breadcrumb","width","width",240),this.desktop=this.parent,this.updateHandleVisibility(),this._setOutline(e.outline),this.viewButtonBox=u.create(Fh,{parent:this,viewButtons:this.desktop.viewButtons}),this.viewButtonBox.on("propertyChange",this._viewButtonBoxPropertyChangeHandler)}_render(){this.$container=this.$parent.appendDiv("desktop-navigation"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new cf(this)),this.htmlComp.layoutData=this.layoutData,this.$body=this.$container.appendDiv("navigation-body").on("mousedown",this._onNavigationBodyMouseDown.bind(this)),this.htmlCompBody=T.install(this.$body,this.session),this.htmlCompBody.setLayout(new Es(null,{exact:!0})),this.desktop.on("propertyChange",this._desktopPropertyChangeHandler)}_remove(){this.desktop.off("propertyChange",this._desktopPropertyChangeHandler),super._remove()}_renderProperties(){super._renderProperties(),this._renderViewButtonBox(),this._renderViewButtonBoxVisible(),this._renderToolBoxVisible(),this._renderOutline(),this._renderHandleVisible(),this._renderInBackground()}_renderInBackground(){this.$container.toggleClass("in-background",this.desktop.inBackground&&this.desktop.displayStyle!==Ie.DisplayStyle.COMPACT)}_renderViewButtonBox(){this.viewButtonBox.render(),this.viewButtonBox.$container.insertBefore(this.$body)}_removeOutline(){!this.outline||this.outline.remove()}_renderOutline(){!this.outline||(this.outline.render(this.$body),this.outline.invalidateLayoutTree(),this.rendered&&this.outline.validateFocus())}setOutline(e){this.setProperty("outline",e)}_setOutline(e){let t=this.outline;this.outline&&this.outline.off("propertyChange",this._outlinePropertyChangeHandler),this.rendered&&this._removeOutline(),this.outline=e,this.outline&&(this.outline.setParent(this),this.outline.setBreadcrumbTogglingThreshold(Wt.BREADCRUMB_STYLE_WIDTH),this.outline.toggleBreadcrumbStyleEnabled&&t&&t.toggleBreadcrumbStyleEnabled&&t.displayStyle&&this.outline.setDisplayStyle(t.displayStyle),this.outline.inBackground=this.desktop.inBackground,this.outline.on("propertyChange",this._outlinePropertyChangeHandler),this._updateHandle())}_renderViewButtonBoxVisible(){this.$container.toggleClass("view-button-box-invisible",!this.viewButtonBox.visible)}sendToBack(){this.outline&&this.outline.sendToBack(),this.rendered&&this._renderInBackground()}bringToFront(){this.outline&&this.outline.bringToFront(),this.rendered&&this._renderInBackground()}setToolBoxVisible(e){this.setProperty("toolBoxVisible",e)}setHandleVisible(e){this.setProperty("handleVisible",e)}_updateHandle(){this.handle&&this.handle.setRightVisible(this.outline&&this.outline.toggleBreadcrumbStyleEnabled&&this.desktop.outlineDisplayStyle()===pe.DisplayStyle.BREADCRUMB)}updateHandleVisibility(){this.setHandleVisible(this.desktop.navigationHandleVisible)}_renderToolBoxVisible(){this.toolBoxVisible?this._renderToolBox():this._removeToolBox()}_renderToolBox(){this.toolBox||(this.toolBox=u.create(Eh,{parent:this,menus:this.desktop.menus}),this.toolBox.render())}_removeToolBox(){!this.toolBox||(this.toolBox.destroy(),this.toolBox=null)}_renderHandleVisible(){this.handleVisible?this._renderHandle():this._removeHandle()}_createHandle(){return u.create(Ph,{parent:this,rightVisible:!1,horizontalAlignment:qi.HorizontalAlignment.RIGHT})}_renderHandle(){this.handle||(this.handle=this._createHandle(),this.handle.render(),this.handle.addCssClass("navigation-open"),this.handle.on("action",this._onHandleAction.bind(this)),this._updateHandle())}_removeHandle(){!this.handle||(this.handle.destroy(),this.handle=null)}_onNavigationBodyMouseDown(e){this.desktop.bringOutlineToFront()}_onViewButtonBoxPropertyChange(e){e.propertyName==="visible"&&this.rendered&&this._renderViewButtonBoxVisible()}_onOutlinePropertyChange(e){e.propertyName==="displayStyle"&&this._updateHandle()}_onDesktopPropertyChange(e){e.propertyName==="navigationHandleVisible"&&this.updateHandleVisibility()}_onHandleAction(e){e.left?this.desktop.shrinkNavigation():this.desktop.enlargeNavigation()}}ei(Wt,"DEFAULT_STYLE_WIDTH",null),ei(Wt,"BREADCRUMB_STYLE_WIDTH",null),ei(Wt,"MIN_WIDTH",null);function ER(i,e,t){return e=FR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function FR(i){var e=DR(i,"string");return typeof e=="symbol"?e:String(e)}function DR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ph extends qi{constructor(){super(...arguments),ER(this,"desktopKeyStrokeContext",void 0)}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.desktopKeyStrokeContext=new Oe,this.desktopKeyStrokeContext.$bindTarget=this.session.desktop.$container,this.desktopKeyStrokeContext.$scopeTarget=this.session.desktop.$container,this.desktopKeyStrokeContext.registerKeyStrokes([new pf(this),new ff(this)])}_render(){super._render(),this.$container.addClass("desktop-navigation-handle"),this.session.keyStrokeManager.installKeyStrokeContext(this.desktopKeyStrokeContext)}_remove(){super._remove(),this.session.keyStrokeManager.uninstallKeyStrokeContext(this.desktopKeyStrokeContext)}}function AR(i,e,t){return e=$R(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function $R(i){var e=RR(i,"string");return typeof e=="symbol"?e:String(e)}function RR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class cf extends ee{constructor(e){super(),AR(this,"navigation",void 0),this.navigation=e}layout(e){let t=this.navigation.htmlComp,s=t.size({exact:!0}).subtract(t.insets()),r=this.navigation.toolBox,n=0,o=0,l=this.navigation.viewButtonBox;if(l.visible){let c=l.htmlComp.prefSize(!0);n=c.height,o=s.width,r&&(o=c.width);let f=new F(o,n).subtract(l.htmlComp.margins());l.htmlComp.setSize(f)}if(r){let c,f=this.navigation.outline;if(o===0&&f&&f.$title){f.$title.addClass("measure");let m=v.prefSize(f.$title).width;f.$title.removeClass("measure"),c=new F(s.width-m,0).subtract(r.htmlComp.margins())}else c=new F(s.width-o,n).subtract(r.htmlComp.margins());r.htmlComp.setSize(c)}let h=this.navigation.htmlCompBody,d=new F(s.width,s.height).subtract(h.margins());h.$comp.cssTop(n),d.height-=n,h.setSize(d)}preferredLayoutSize(e,t){let s=this.navigation.htmlCompBody,r=s.prefSize(t).add(s.margins()),n=new F(0,0),o=this.navigation.viewButtonBox;if(o){let d=o.htmlComp.prefSize(!0);n.width+=d.width,n.height=Math.max(n.height,d.height)}let l=this.navigation.toolBox;if(l){let d=l.htmlComp.prefSize(!0);n.width+=d.width,n.height=Math.max(n.height,d.height)}let h=this.navigation.htmlComp;return r.height+=n.height,r.width=Math.max(r.width,n.width),r=r.add(h.insets()),r}}function MR(i,e,t){return e=IR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function IR(i){var e=LR(i,"string");return typeof e=="symbol"?e:String(e)}function LR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class pf extends O{constructor(e){super(),MR(this,"desktop",void 0),this.field=e,this.desktop=e.session.desktop,this.ctrl=!0,this.which=[g.forBrowser(g.ANGULAR_BRACKET)],this.renderingHints.$drawingArea=(t,s)=>this.desktop.$container,this.inheritAccessibility=!1}_accept(e){return super._accept(e)||O.acceptModifiers(this,e)&&u.isOneOf(e.which,g.forBrowser(g.ANGULAR_BRACKET,"ctrl"))}_isEnabled(){return super._isEnabled()&&this.field.leftVisible}handle(e){this.desktop.shrinkNavigation()}_postRenderKeyBox(e,t){t.addClass("navigation-handle-key-box left");let r=this.field.$left.offsetTo(this.desktop.$container),n=r.left-t.outerWidth(!0),o=r.top;t.cssLeft(n).cssTop(o)}}function OR(i,e,t){return e=BR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function BR(i){var e=kR(i,"string");return typeof e=="symbol"?e:String(e)}function kR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ff extends O{constructor(e){super(),OR(this,"desktop",void 0),this.field=e,this.desktop=e.session.desktop,this.ctrl=!0,this.shift=!0,this.which=[g.forBrowser(g.ANGULAR_BRACKET)],this.renderingHints.$drawingArea=(t,s)=>this.desktop.$container,this.inheritAccessibility=!1}_accept(e){return super._accept(e)||O.acceptModifiers(this,e)&&u.isOneOf(e.which,g.forBrowser(g.ANGULAR_BRACKET,"ctrl"))}_isEnabled(){return super._isEnabled()&&this.field.rightVisible}handle(e){this.desktop.enlargeNavigation()}_postRenderKeyBox(e,t){t.addClass("navigation-handle-key-box right");let s=this.field,r=s.$right.offsetTo(this.desktop.$container),n=r.left+s.$right.outerWidth(),o=r.top;t.cssLeft(n).cssTop(o)}}function es(i,e,t){return e=HR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function HR(i){var e=NR(i,"string");return typeof e=="symbol"?e:String(e)}function NR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ti extends Bd{constructor(){super(),es(this,"duration",void 0),es(this,"removeTimeout",void 0),es(this,"nativeOnly",void 0),es(this,"nativeNotificationTitle",void 0),es(this,"nativeNotificationStatus",void 0),es(this,"nativeNotificationVisibility",void 0),es(this,"nativeNotification",void 0),es(this,"nativeNotificationShown",void 0),es(this,"$loader",void 0),es(this,"_removing",void 0),this.closable=!0,this.duration=5e3,this.removeTimeout=null,this._removing=!1,this.nativeOnly=!1,this.nativeNotificationTitle=null,this.nativeNotificationStatus=null,this.nativeNotificationVisibility=ti.NativeNotificationVisibility.NONE,this.nativeNotification=null,this.nativeNotificationShown=!1}_init(e){super._init(e);let t=this.session.desktop.nativeNotificationDefaults;t&&(this.nativeNotificationTitle=e.nativeNotificationTitle!==void 0?e.nativeNotificationTitle:t.title,this.nativeNotificationStatus?this.nativeNotificationStatus.iconId=this.nativeNotificationStatus.iconId!==void 0?this.nativeNotificationStatus.iconId:t.iconId:this.nativeNotificationStatus=new E({iconId:t.iconId}),this.nativeNotificationVisibility=u.nvl(e.nativeNotificationVisibility!==void 0?e.nativeNotificationVisibility:t.visibility,ti.NativeNotificationVisibility.NONE)),this.resolveTextKeys(["nativeNotificationTitle"])}_render(){this._initNativeNotification(),this.$container=this.$parent.prependDiv("desktop-notification"),this.$content=this.$container.appendDiv("desktop-notification-content"),this.$messageText=this.$content.appendDiv("desktop-notification-message"),this.$loader=this.$container.appendDiv("desktop-notification-loader"),x.get().supportsCssAnimation()&&this.$loader.addClass("animated"),this.nativeOnly&&this.setVisible(!1)}_renderLoading(){this.$container.toggleClass("loading",this.loading),this.$loader.setVisible(this.loading)}_destroy(){this.nativeNotification&&this.nativeNotification.close(),super._destroy()}_isDocumentHidden(){return document.hidden}_showNativeNotification(e){if(e==="denied"||e==="default"){this.nativeOnly&&this.hide();return}let t=u.nvl(this.nativeNotificationTitle,""),s=(this.nativeNotificationStatus||{}).message;y.empty(s)&&(s=(this.status||{}).message),s||(s=""),this.htmlEnabled&&(s=y.plainText(s,{removeFontIcons:!0}));let r=(this.nativeNotificationStatus||{}).iconId;y.empty(r)&&(r=void 0),this.nativeNotification=new Notification(t,{body:s,icon:r}),this.nativeNotification.addEventListener("show",n=>{this._setNativeNotificationShown(!0)}),this.nativeNotification.addEventListener("click",n=>{window.focus()}),this.nativeNotification.addEventListener("close",n=>{this.nativeOnly&&this.hide(),this.nativeNotification=null,this._setNativeNotificationShown(!1)})}_initNativeNotification(){if(!this.nativeNotificationShown){if(this.nativeNotificationVisibility===ti.NativeNotificationVisibility.NONE){this._hideLaterIfNativeOnly();return}if(this.nativeNotificationVisibility===ti.NativeNotificationVisibility.BACKGROUND&&!this._isDocumentHidden()){this._hideLaterIfNativeOnly();return}if(window.Notification&&Notification.permission==="denied"){this._hideLaterIfNativeOnly();return}this._checkNotificationPromise()?Notification.requestPermission().then(this._showNativeNotification.bind(this)):Notification.requestPermission(this._showNativeNotification.bind(this))}}_hideLaterIfNativeOnly(){!this.nativeOnly||setTimeout(()=>this.hide())}_checkNotificationPromise(){try{Notification.requestPermission().then()}catch{return!1}return!0}_onCloseIconClick(){this.hide()}show(){this.session.desktop.addNotification(this)}hide(){this._removing||(this.trigger("close"),this.session.desktop.removeNotification(this))}fadeIn(e){this.render(e),x.get().supportsCssAnimation()&&this.$container.addClassForAnimation("desktop-notification-slide-in")}fadeOut(){if(!this._removing){if(this._removing=!0,!x.get().supportsCssAnimation()||!this.rendered){this.destroy();return}if(!this.$container.isVisible()){this.destroy();return}this.$container.addClass("desktop-notification-fade-out"),this.$container.oneAnimationEnd(()=>{this.destroy()})}}invalidateLayoutTree(){}_setNativeNotificationShown(e){this._setProperty("nativeNotificationShown",e)}setNativeNotificationTitle(e){this.setProperty("nativeNotificationTitle",e)}setNativeNotificationStatus(e){this.setProperty("nativeNotificationStatus",e)}_setNativeNotificationStatus(e){e=E.ensure(e),this._setProperty("nativeNotificationStatus",e)}setNativeNotificationVisibility(e){this.setProperty("nativeNotificationVisibility",e)}}es(ti,"NativeNotificationVisibility",{NONE:"none",BACKGROUND:"background",ALWAYS:"always"}),es(ti,"INFINITE",-1);class ey extends kd{constructor(){super(),this._addRemoteProperties(["nativeNotificationShown"])}}function mf(i,e,t){return e=VR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function VR(i){var e=WR(i,"string");return typeof e=="symbol"?e:String(e)}function WR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class gf extends ti{constructor(){super(),mf(this,"connectFailedReset",void 0),mf(this,"connectionInterruptedStatus",void 0),mf(this,"reconnectingStatus",void 0),this.connectFailedReset=null}_init(e){super._init(e),this.closable=!1,this.duration=ti.INFINITE,this.connectionInterruptedStatus=new E({message:this.session.text("ui.ConnectionInterrupted"),severity:E.Severity.ERROR}),this.reconnectingStatus=new E({message:this.session.text("ui.Reconnecting_"),severity:E.Severity.ERROR}),this._setStatus(this.connectionInterruptedStatus)}_render(){super._render(),this.$content.addClass("offline-message"),this.$messageText.addClass("offline-message-text")}reconnect(){this.setLoading(!0),this.connectFailedReset&&clearTimeout(this.connectFailedReset),this.setStatus(this.reconnectingStatus)}reconnectFailed(){this.connectFailedReset=setTimeout(()=>{this.connectFailedReset=null,this.setLoading(!1),this.setStatus(this.connectionInterruptedStatus)},1100)}reconnectSucceeded(){this.setLoading(!1),this.connectFailedReset&&clearTimeout(this.connectFailedReset),this.setStatus({message:this.session.text("ui.ConnectionReestablished"),severity:E.Severity.OK})}}function _f(i,e,t){return e=zR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function zR(i){var e=KR(i,"string");return typeof e=="symbol"?e:String(e)}function KR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Do{constructor(){_f(this,"objectType",void 0),_f(this,"session",void 0),_f(this,"preserveOpener",void 0),this.session=null,this.preserveOpener=!1}init(e){a().extend(this,e)}openWindow(e,t,s,r){t=t||"scout_"+new Date().getTime();let n=window.open("",t,s);if(n){this.preserveOpener||(n.opener=null);try{n.window.location.href=e}catch(o){this._handleInvalidUri(e,n,o);return}r&&r(n)}else a().log.warn("Popup-blocker detected! Show link to open window manually"),this.showNotification(()=>{this.openWindow(e,t,s,r)})}showNotification(e){let t,s=this.session.desktop;typeof e=="string"&&(t=e);let r=u.create(yf,{parent:s,linkUrl:t,preserveOpener:this.preserveOpener});!t&&a().isFunction(e)&&r.on("linkClick",e),r.show()}_handleInvalidUri(e,t,s){u.create(Nr,{logError:!0,displayError:!1,sendError:!1}).handle(s),t.close(),rr.createOk(this.session.desktop).withHeader(this.session.text("ui.UnexpectedProblem")).withBody(this.session.text("ui.InvalidUriMsg")).withSeverity(E.Severity.ERROR).buildAndOpen()}}function xh(i,e,t){return e=GR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function GR(i){var e=UR(i,"string");return typeof e=="symbol"?e:String(e)}function UR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class yf extends ti{constructor(){super(),xh(this,"preserveOpener",void 0),xh(this,"linkUrl",void 0),xh(this,"linkText",void 0),xh(this,"$link",void 0),this.duration=ti.INFINITE,this.preserveOpener=!1}_init(e){super._init(e),this.linkText=u.nvl(this.linkText,this.session.text("ui.OpenManually")),this._setStatus({message:this.session.text("ui.PopupBlockerDetected"),severity:E.Severity.WARNING})}_render(){super._render(),this.$messageText.addClass("popup-blocked-title"),this.$link=this.$content.appendElement("<a>","popup-blocked-link").text(this.linkText).on("click",this._onLinkClick.bind(this))}_renderProperties(){super._renderProperties(),this._renderLinkUrl()}_renderLinkUrl(){this.linkUrl?(this.$link.attr("href",this.linkUrl).attr("target","_blank"),this.preserveOpener||this.$link.attr("rel","noreferrer noopener")):this.$link.removeAttr("href").removeAttr("target")}_onLinkClick(e){this.trigger("linkClick"),this.hide()}}class Eh extends qd{constructor(){super(),this.uiMenuCssClass=y.join(" ",this.uiMenuCssClass,"desktop-tool-box-item")}_initMenu(e){super._initMenu(e),e.popupHorizontalAlignment=ue.Alignment.CENTER}_render(){super._render(),this.$container.addClass("desktop-tool-box")}}class bf extends sn{constructor(e){super(e)}_postRenderKeyBox(e,t){let s=e.outerWidth(),r=e.find(".key-box").outerWidth(),n=s/2-r/2;e.find(".key-box").cssLeft(n)}}function vf(i,e,t){return e=qR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function qR(i){var e=YR(i,"string");return typeof e=="symbol"?e:String(e)}function YR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class wf extends re{constructor(){super(),vf(this,"displayStyle",void 0),vf(this,"selectedAsMenu",void 0),vf(this,"_desktopInBackgroundHandler",void 0),this.showTooltipWhenSelected=!1,this.displayStyle="TAB",this.selectedAsMenu=!1,this._desktopInBackgroundHandler=this._onDesktopInBackgroundChange.bind(this)}_init(e){super._init(e),this.session.desktop.on("propertyChange:inBackground",this._desktopInBackgroundHandler)}_destroy(){this.session.desktop.off("propertyChange:inBackground",this._desktopInBackgroundHandler),super._destroy()}renderAsTab(e){let t=e.appendDiv("view-tab-wrapper");this.render(t),this.$container.addClass("view-tab view-button-tab")}_render(){this.$container=this.$parent.appendDiv("view-button").on("mousedown",this._onMouseEvent.bind(this)),this.htmlComp=T.install(this.$container,this.session),this.$container.prependDiv("edge left"),this.$container.appendDiv("edge right")}_remove(){let e=this.$container.parent();e.hasClass("view-tab-wrapper")&&e.remove(),super._remove()}_renderProperties(){super._renderProperties(),this._renderInBackground()}_renderInBackground(){this.session.desktop.displayStyle!==Ie.DisplayStyle.COMPACT&&(this.rendering||(this.session.desktop.inBackground?this.$container.addClassForAnimation("animate-bring-to-back"):this.$container.addClassForAnimation("animate-bring-to-front")),this.$container.toggleClass("in-background",this.session.desktop.inBackground))}_renderText(){}setDisplayStyle(e){this.setProperty("displayStyle",e)}_onMouseEvent(e){this.doAction()}_createActionKeyStroke(){return new bf(this)}setSelectedAsMenu(e){this.selectedAsMenu=e}_onDesktopInBackgroundChange(e){this.rendered&&this._renderInBackground()}}class Tf extends br{}function Or(i,e,t){return e=jR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function jR(i){var e=XR(i,"string");return typeof e=="symbol"?e:String(e)}function XR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Fh extends I{constructor(){super(),Or(this,"desktop",void 0),Or(this,"viewMenuTab",void 0),Or(this,"viewButtons",void 0),Or(this,"menuButtons",void 0),Or(this,"tabButtons",void 0),Or(this,"selectedMenuButtonAlwaysVisible",void 0),Or(this,"_desktopOutlineChangeHandler",void 0),Or(this,"_viewButtonPropertyChangeHandler",void 0),this.viewMenuTab=null,this.viewButtons=[],this.menuButtons=[],this.tabButtons=[],this._desktopOutlineChangeHandler=this._onDesktopOutlineChange.bind(this),this._viewButtonPropertyChangeHandler=this._onViewButtonPropertyChange.bind(this),this.selectedMenuButtonAlwaysVisible=!1,this._addWidgetProperties(["viewButtons"])}_init(e){super._init(e),this.desktop=this.session.desktop,this.viewMenuTab=u.create(xf,{parent:this}),this._setViewButtons(this.viewButtons),this.desktop.on("outlineChange",this._desktopOutlineChangeHandler)}_render(){this.$container=this.$parent.appendDiv("view-button-box"),this.htmlComp=T.install(this.$container,this.session),this.viewMenuTab.render(),this._onDesktopOutlineChange()}_renderProperties(){super._renderProperties(),this._renderTabButtons()}_remove(){this.desktop.off("outlineChange",this._desktopOutlineChangeHandler),this.viewButtons.forEach(e=>e.off("selected",this._viewButtonPropertyChangeHandler)),super._remove()}setSelectedMenuButtonVisible(e){this.viewMenuTab.setSelectedButtonVisible(e)}setSelectedMenuButtonAlwaysVisible(e){this.setProperty("selectedMenuButtonAlwaysVisible",e)}_setSelectedMenuButtonAlwaysVisible(e){this._updateSelectedMenuButtonVisibility()}setViewButtons(e){this.setProperty("viewButtons",e)}_setViewButtons(e){this.viewButtons&&this.viewButtons.forEach(t=>t.off("propertyChange",this._viewButtonPropertyChangeHandler)),this._setProperty("viewButtons",e),this.viewButtons.forEach(t=>t.on("propertyChange",this._viewButtonPropertyChangeHandler)),this._updateViewButtons()}_setTabButtons(e){this._setProperty("tabButtons",e)}_removeTabButtons(){this.tabButtons.forEach(e=>e.remove())}_renderTabButtons(){this.tabButtons.forEach((e,t)=>e.renderAsTab(this.$container)),Le.updateFirstLastMarker(this.tabButtons)}_updateViewButtons(){let e=this.viewButtons.filter(r=>r.visible),t=e.filter(r=>r.displayStyle==="MENU"),s=null;t.length>1?s=e.filter(r=>r.displayStyle==="TAB"):(s=e,t=[]),this._setMenuButtons(t),this.rendered&&this._removeTabButtons(),this._setTabButtons(s),this.rendered&&this._renderTabButtons(),this._updateVisibility(),this._updateSelectedMenuButtonVisibility()}_updateVisibility(){this.setVisible(this.tabButtons.length+this.menuButtons.length>1)}_setMenuButtons(e){this._setProperty("menuButtons",e),this.viewMenuTab.setViewButtons(this.menuButtons)}_updateSelectedMenuButtonVisibility(){this.setSelectedMenuButtonVisible(this.selectedMenuButtonAlwaysVisible||this.tabButtons.length>=1&&this.menuButtons.length>=1)}_onDesktopOutlineChange(){let e=this.desktop.outline;this.viewButtons.forEach(t=>{t instanceof $h&&t.onOutlineChange(e)})}_onViewButtonSelected(e){this.viewButtons.forEach(t=>{t!==e.source&&t.isToggleAction()&&t.setSelected(!1)}),this.viewMenuTab.onViewButtonSelected()}_onViewButtonPropertyChange(e){e.propertyName==="selected"?this._onViewButtonSelected(e):(e.propertyName==="visible"||e.propertyName==="displayStyle")&&this._updateViewButtons()}}class Cf extends O{constructor(e){super(),this.field=e,this.which=[g.F2],this.stopPropagation=!0,this.renderingHints.$drawingArea=(t,s)=>this.field.selected?this.field.dropdown.$container:this.field.selectedButton.$container}handle(e){this.field.selected?this.field.togglePopup():this.field.selectedButton&&this.field.selectedButton.doAction()}_postRenderKeyBox(e,t){let s=e.outerWidth(),r=e.find(".key-box").outerWidth(),n=s/2-r/2;e.find(".key-box").cssLeft(n)}}function ty(i,e,t){return e=JR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function JR(i){var e=QR(i,"string");return typeof e=="symbol"?e:String(e)}function QR(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Sf extends eo{constructor(){super(),ty(this,"defaultIconId",void 0),ty(this,"viewMenus",void 0),this.cssClass="view-menu-popup",this.defaultIconId=null,this.viewMenus=[],this.trimWidth=!0}_init(e){super._init(e);let t=this._createTiles(),s=t.every(o=>!o.widgets[0].visible);this.content=u.create($n,{parent:this,tiles:t,cssClass:s?"no-icons":"",selectable:!0,multiSelect:!1,gridColumnCount:this._computeGridColumnCount(t),layoutConfig:{columnWidth:100,rowHeight:-1,vgap:10,hgap:10}});let n=this.content.tiles.find(o=>o.viewMenu.selected);n&&this.content.selectTile(n)}_computeGridColumnCount(e){return e.length>8?4:e.length>4?3:2}_createTiles(){return this.viewMenus.map(e=>({objectType:Hp,displayStyle:Vt.DisplayStyle.PLAIN,cssClass:u.nvl(e.cssClass,"")+" view-menu-tile "+(e.selected?"checked ":"")+(e.iconId?"":"text-only"),modelClass:e.modelClass,classId:e.classId,viewMenu:e,enabled:e.enabled,gridDataHints:{useUiHeight:!0},widgets:[{objectType:Zs,iconDesc:e.iconId,visible:!!e.iconId,prepend:!0},{objectType:da,value:e.text,cssClass:"label"}]}))}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.registerKeyStroke(new Pf(this))}_renderContent(){super._renderContent(),this.content.$container.on("click",".tile",e=>{let t=u.widget(e.target);t instanceof Vt||(t=t.findParent(s=>s instanceof Vt)),this.activateTile(t)})}activateTile(e){!e||!e.viewMenu.enabledComputed||(e.viewMenu.doAction(),this.close())}}class Pf extends O{constructor(e){super(),this.field=e,this.which=[g.ENTER,g.SPACE],this.renderingHints.$drawingArea=(t,s)=>{let r=this.field.content.selectedTiles[0];if(r&&r.rendered)return r.$container},this.inheritAccessibility=!1}accept(e){return super.accept(e)&&this.field.content.selectedTiles.length===1&&this.field.content.selectedTiles[0].enabledComputed}handle(e){this.field.activateTile(this.field.content.selectedTiles[0])}}function hr(i,e,t){return e=ZR(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ZR(i){var e=eM(i,"string");return typeof e=="symbol"?e:String(e)}function eM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class xf extends I{constructor(){super(),hr(this,"selected",void 0),hr(this,"selectedButtonVisible",void 0),hr(this,"defaultIconId",void 0),hr(this,"viewButtons",void 0),hr(this,"selectedButton",void 0),hr(this,"dropdown",void 0),hr(this,"popup",void 0),hr(this,"desktopKeyStrokeContext",void 0),hr(this,"_desktopInBackgroundHandler",void 0),this.viewButtons=[],this.selected=!1,this.selectedButton=null,this.selectedButtonVisible=!0,this.defaultIconId=ye.FOLDER,this._desktopInBackgroundHandler=this._onDesktopInBackgroundChange.bind(this),this._addWidgetProperties(["selectedButton"]),this._addPreserveOnPropertyChangeProperties(["selectedButton"])}_init(e){super._init(e),this.dropdown=u.create(re,{parent:this,iconId:ye.ANGLE_DOWN,tabbable:!1,cssClass:"view-menu",toggleAction:!0}),this.dropdown.on("action",this.togglePopup.bind(this)),this._setViewButtons(this.viewButtons),this.session.desktop.on("propertyChange:inBackground",this._desktopInBackgroundHandler)}_destroy(){this.session.desktop.off("propertyChange:inBackground",this._desktopInBackgroundHandler),super._destroy()}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.desktopKeyStrokeContext=new Oe,this.desktopKeyStrokeContext.invokeAcceptInputOnActiveValueField=!0,this.desktopKeyStrokeContext.$bindTarget=this.session.desktop.$container,this.desktopKeyStrokeContext.$scopeTarget=this.session.desktop.$container,this.desktopKeyStrokeContext.registerKeyStroke(new Cf(this))}_render(){this.$container=this.$parent.appendDiv("view-tab view-menu-tab"),this.htmlComp=T.install(this.$container,this.session),this.dropdown.render(this.$container),this.session.keyStrokeManager.installKeyStrokeContext(this.desktopKeyStrokeContext),this.$container.appendDiv("edge right")}_remove(){this.session.keyStrokeManager.uninstallKeyStrokeContext(this.desktopKeyStrokeContext),super._remove(),this.selectedButton&&this.selectedButton.remove()}_renderProperties(){super._renderProperties(),this._renderSelectedButtonVisible(),this._renderSelected(),this._renderInBackground()}setViewButtons(e){this.setProperty("viewButtons",e)}_setViewButtons(e){this._setProperty("viewButtons",e),this.setVisible(this.viewButtons.length>0);let t=this._findSelectedViewButton();t?this.setSelectedButton(t):this.setSelectedButton(p.find(this.viewButtons,s=>s.selectedAsMenu)||this.viewButtons[0]),this.setSelected(!!t)}setSelectedButton(e){this.selectedButton&&this.selectedButton.cloneOf===e||e&&this.setProperty("selectedButton",e)}_setSelectedButton(e){this.viewButtons.forEach(s=>s.setSelectedAsMenu(s===e));let t=this.selectedButton;t||(t=u.create($h,{parent:this,displayStyle:"TAB"})),t.cloneOf&&t.cloneOf.unmirror(t),t.cloneOf=e,e._cloneProperties.forEach(s=>t.callSetter(s,e[s])),t.setIconId(e.iconId||this.defaultIconId),e.mirror({delegateEventsToOriginal:["acceptInput","action"],delegateAllPropertiesToClone:!0,delegateAllPropertiesToOriginal:!0,excludePropertiesToOriginal:["selected"]},t),this._setProperty("selectedButton",t)}_renderSelectedButton(){this._renderSelectedButtonVisible()}setSelectedButtonVisible(e){this.setProperty("selectedButtonVisible",e)}_renderSelectedButtonVisible(){this.$container.toggleClass("selected-button-invisible",!this.selectedButtonVisible),this.selectedButton&&(this.selectedButtonVisible?this.selectedButton.rendered||(this.selectedButton.render(),this.selectedButton.$container.prependTo(this.$container),this.invalidateLayoutTree()):this.selectedButton.rendered&&(this.selectedButton.remove(),this.invalidateLayoutTree()))}setSelected(e){this.setProperty("selected",e)}_renderSelected(){this.$container.select(this.selected)}_findSelectedViewButton(){return p.find(this.viewButtons,e=>e.selected)}togglePopup(){this.popup?this._closePopup():this._openPopup()}_openPopup(){this.popup||(this.popup=u.create(Sf,{parent:this,viewMenus:this.viewButtons,defaultIconId:this.defaultIconId,$anchor:this.$parent}),this.popup.open(),this.popup.one("destroy",e=>{this.dropdown.setSelected(!1),this.popup=null}))}_closePopup(){this.popup&&this.popup.close()}_renderInBackground(){this.session.desktop.displayStyle!==Ie.DisplayStyle.COMPACT&&(this.rendering||(this.session.desktop.inBackground?this.$container.addClassForAnimation("animate-bring-to-back"):this.$container.addClassForAnimation("animate-bring-to-front")),this.$container.toggleClass("in-background",this.session.desktop.inBackground))}onViewButtonSelected(){let e=this._findSelectedViewButton();e&&this.setSelectedButton(e),this.setSelected(!!e),this._closePopup()}_onDesktopInBackgroundChange(e){this.rendered&&this._renderInBackground()}}function pt(i,e,t){return e=tM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function tM(i){var e=iM(i,"string");return typeof e=="symbol"?e:String(e)}function iM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ai extends ir{constructor(){super(),pt(this,"nodeType",void 0),pt(this,"compactRoot",void 0),pt(this,"detailTable",void 0),pt(this,"detailTableVisible",void 0),pt(this,"detailForm",void 0),pt(this,"detailFormVisible",void 0),pt(this,"detailFormVisibleByUi",void 0),pt(this,"navigateButtonsVisible",void 0),pt(this,"tableStatusVisible",void 0),pt(this,"htmlComp",void 0),pt(this,"drillDownOnRowClick",void 0),pt(this,"overviewIconId",void 0),pt(this,"showTileOverview",void 0),pt(this,"row",void 0),pt(this,"tile",void 0),pt(this,"events",void 0),pt(this,"_tableFilterHandler",void 0),pt(this,"_tableRowClickHandler",void 0),pt(this,"_detailTableModel",void 0),pt(this,"_detailFormModel",void 0),this.nodeType=null,this.compactRoot=!1,this.detailTable=null,this.detailTableVisible=!0,this.detailForm=null,this.detailFormVisible=!0,this.detailFormVisibleByUi=!0,this.navigateButtonsVisible=!0,this.tableStatusVisible=!0,this.drillDownOnRowClick=!1,this.overviewIconId=null,this.showTileOverview=!1,this.events=new Bo,this.events.registerSubTypePredicate("propertyChange",(e,t)=>e.propertyName===t),this._tableFilterHandler=this._onTableFilter.bind(this),this._tableRowClickHandler=this._onTableRowClick.bind(this),this._detailTableModel=null,this._detailFormModel=null}_init(e){this._detailTableModel=ai._removePropertyIfLazyLoading(e,"detailTable"),this._detailFormModel=ai._removePropertyIfLazyLoading(e,"detailForm"),super._init(e),ye.resolveIconProperty(this,"overviewIconId"),this._internalInitTable(),this._internalInitDetailForm()}static _removePropertyIfLazyLoading(e,t){let s=e[t];return typeof s=="string"||s instanceof I?null:(delete e[t],s)}_destroy(){super._destroy(),this.detailTable&&this.detailTable.destroy(),this.detailForm&&this.detailForm.destroy()}_internalInitTable(){let e=this.detailTable;if(e){let t=this.getOutline()._createChild(e);this._setDetailTable(t)}}_internalInitDetailForm(){let e=this.detailForm;if(e){let t=this.getOutline()._createChild(e);this._setDetailForm(t)}}ensureDetailTable(){this.detailTable||this.setDetailTable(this.createDetailTable())}createDetailTable(){let e=this._createDetailTable();return!e&&this._detailTableModel&&(e=this.getOutline()._createChild(this._detailTableModel),this._detailTableModel=null),e}_createDetailTable(){return null}ensureDetailForm(){this.detailForm||this.setDetailForm(this.createDetailForm())}createDetailForm(){let e=this._createDetailForm();return!e&&this._detailFormModel&&(e=this.getOutline()._createChild(this._detailFormModel),this._detailFormModel=null),e}_createDetailForm(){return null}_initDetailForm(e){e instanceof U&&(e.setModal(!1),e.setClosable(!1),e.setDisplayHint(U.DisplayHint.VIEW),e.setDisplayViewId("C"),e.setShowOnOpen(!1)),e instanceof Fa&&e.setPage(this)}_destroyDetailForm(e){e instanceof Fa&&e.setPage(null),e.owner===this.getOutline()&&e.destroy()}_initDetailTable(e){e.menuBar.setPosition(ce.Position.TOP),e.on("filter",this._tableFilterHandler),this.drillDownOnRowClick&&(e.on("rowClick",this._tableRowClickHandler),e.setMultiSelect(!1)),e.setTableStatusVisible(this.tableStatusVisible)}_destroyDetailTable(e){e.off("filter",this._tableFilterHandler),e.off("rowClick",this._tableRowClickHandler),e.owner===this.getOutline()&&e.destroy()}_decorate(){super._decorate(),this.$node&&(this.session.inspector&&Hn.applyInfo(this,this.$node),this.$node.toggleClass("compact-root",this.compactRoot),this.$node.toggleClass("has-tile-overview",this.showTileOverview||this.compactRoot&&this.getOutline().detailContent instanceof Fl))}activate(){this.ensureDetailTable(),this.ensureDetailForm()}deactivate(){}getOutline(){return this.parent}pagesForTableRows(e){return e.map(this.pageForTableRow)}pageForTableRow(e){if(!e.page)throw new Error("Table-row is not linked to a page");return e.page}setDetailForm(e){e!==this.detailForm&&this._setDetailForm(e)}_setDetailForm(e){let t=this.detailForm;t!==e&&t instanceof I&&this._destroyDetailForm(t),this.detailForm=e,e&&this._initDetailForm(e),this.triggerPropertyChange("detailForm",t,e)}setDetailTable(e){e!==this.detailTable&&this._setDetailTable(e)}_setDetailTable(e){let t=this.detailTable;t!==e&&t instanceof I&&this._destroyDetailTable(t),this.detailTable=e,e&&this._initDetailTable(e),this.triggerPropertyChange("detailTable",t,e)}updatePagesFromTableRows(e){return e.map(t=>t.page.updatePageFromTableRow(t))}updatePageFromTableRow(e){let t=e.page;return t.enabled=e.enabled,t.text=t.computeTextForRow(e),e.cells.length>=1&&(t.htmlEnabled=e.cells[0].htmlEnabled,t.cssClass=e.cells[0].cssClass),t}computeTextForRow(e){let t="";return e.cells.length>=1&&(t=e.cells[0].text),t}_pageParam(e){let t={parent:this.getOutline()};return a().extend(t,e),t}reloadPage(){this.getOutline()&&this.loadChildren()}linkWithRow(e){this.row=e,e.page=this,this.getOutline().trigger("pageRowLink",{page:this,row:e})}unlinkWithRow(e){delete this.row,delete e.page}_onTableFilter(e){this.getOutline().mediator.onTableFilter(e,this)}_onTableRowClick(e){if(!this.drillDownOnRowClick)return;let t=e.row,s=this.pageForTableRow(t);this.getOutline().selectNode(s),this.detailTable.deselectRow(t)}triggerPropertyChange(e,t,s){return u.assertParameter("propertyName",e),this.trigger("propertyChange",{propertyName:e,oldValue:t,newValue:s})}trigger(e,t){let s;return t instanceof Kt?s=t:s=new Kt(t),s.source=this,this.events.trigger(e,s),s}one(e,t){this.events.one(e,t)}on(e,t){return this.events.on(e,t)}off(e,t){this.events.off(e,t)}}pt(ai,"NodeType",{NODES:"nodes",TABLE:"table"});class iy extends ai{constructor(){super(),this.nodeType=ai.NodeType.NODES}_createDetailTable(){let e=u.create(De,{id:"NodeColumn",session:this.session}),t=u.create(V,{parent:this.parent,id:"PageWithNodesTable",autoResizeColumns:!0,headerVisible:!1,columns:[e]});return t.menuBar.setPosition(ce.Position.TOP),t.on("rowAction",this._onDetailTableRowAction.bind(this)),t}_onDetailTableRowAction(e){this.getOutline().mediator.onTableRowAction(e,this)}_rebuildDetailTable(e){let t=this.detailTable;if(!t)return;this._unlinkAllTableRows(t.rows),t.deleteAllRows();let s=this._createTableRowsForChildPages(e);t.insertRows(s)}_unlinkAllTableRows(e){e.forEach(t=>{t.page&&t.page.unlinkWithRow(t)})}_createTableRowsForChildPages(e){return e.map(t=>{let s=u.create(Xt,{parent:this.detailTable,cells:[t.text]});return t.linkWithRow(s),s})}loadChildren(){return this.childrenLoaded=!1,this._createChildPages().done(e=>{this._rebuildDetailTable(e),e.length>0&&this.getOutline().insertNodes(e,this),this.childrenLoaded=!0})}_createChildPages(){return a().resolvedPromise(this.childNodes)}}function Mn(i,e,t){return e=sM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function sM(i){var e=rM(i,"string");return typeof e=="symbol"?e:String(e)}function rM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class sy extends ai{constructor(){super(),Mn(this,"alwaysCreateChildPage",void 0),Mn(this,"_tableRowDeleteHandler",void 0),Mn(this,"_tableRowInsertHandler",void 0),Mn(this,"_tableRowUpdateHandler",void 0),Mn(this,"_tableRowActionHandler",void 0),Mn(this,"_tableRowOrderChangeHandler",void 0),Mn(this,"_tableDataLoadHandler",void 0),this.nodeType=ai.NodeType.TABLE,this.alwaysCreateChildPage=!1,this._tableRowDeleteHandler=this._onTableRowsDeleted.bind(this),this._tableRowInsertHandler=this._onTableRowsInserted.bind(this),this._tableRowUpdateHandler=this._onTableRowsUpdated.bind(this),this._tableRowActionHandler=this._onTableRowAction.bind(this),this._tableRowOrderChangeHandler=this._onTableRowOrderChanged.bind(this),this._tableDataLoadHandler=this.loadTableData.bind(this)}init(e){super.init(e)}_initDetailTable(e){super._initDetailTable(e),e.on("rowsDeleted allRowsDeleted",this._tableRowDeleteHandler),e.on("rowsInserted",this._tableRowInsertHandler),e.on("rowsUpdated",this._tableRowUpdateHandler),e.on("rowAction",this._tableRowActionHandler),e.on("rowOrderChanged",this._tableRowOrderChangeHandler),e.on("reload",this._tableDataLoadHandler),e.hasReloadHandler=!0}_destroyDetailTable(e){e.off("rowsDeleted allRowsDeleted",this._tableRowDeleteHandler),e.off("rowsInserted",this._tableRowInsertHandler),e.off("rowsUpdated",this._tableRowUpdateHandler),e.off("rowAction",this._tableRowActionHandler),e.off("rowOrderChanged",this._tableRowOrderChangeHandler),e.off("reload",this._tableDataLoadHandler),super._destroyDetailTable(e)}_onTableRowsDeleted(e){if(this.leaf)return;let t=p.ensure(e.rows),s=t.map(r=>{let n=r.page;return n.unlinkWithRow(r),n});this.getOutline().mediator.onTableRowsDeleted(t,s,this)}_onTableRowsInserted(e){if(this.leaf)return;let t=p.ensure(e.rows),s=t.map(r=>this._createChildPageInternal(r));this.getOutline().mediator.onTableRowsInserted(t,s,this)}_onTableRowsUpdated(e){this.getOutline().mediator.onTableRowsUpdated(e,this)}_onTableRowAction(e){this.getOutline().mediator.onTableRowAction(e,this)}_onTableRowOrderChanged(e){e.animating||this.getOutline().mediator.onTableRowOrderChanged(e,this)}_createChildPageInternal(e){let t=this.createChildPage(e);return t===null&&this.alwaysCreateChildPage&&(t=this.createDefaultChildPage(e)),t.linkWithRow(e),t=t.updatePageFromTableRow(e),t}createChildPage(e){return null}createDefaultChildPage(e){return u.create(Df,{parent:this.getOutline(),row:e})}loadChildren(){return this.detailTable?this.loadTableData():a().resolvedPromise()}_createSearchFilter(){let e=this.detailTable.tableControls,t=p.find(e,s=>s.form instanceof U);return t?t.form.exportData():null}loadTableData(){return this.ensureDetailTable(),this.detailTable.deleteAllRows(),this.detailTable.setLoading(!0),this._loadTableData(this._createSearchFilter()).then(this._onLoadTableDataDone.bind(this)).catch(this._onLoadTableDataFail.bind(this)).then(this._onLoadTableDataAlways.bind(this))}_loadTableData(e){return a().resolvedPromise()}_onLoadTableDataDone(e){let t=this._transformTableDataToTableRows(e);t&&t.length>0&&this.detailTable.insertRows(t)}_onLoadTableDataFail(e){this.detailTable.setTableStatus(E.error({message:this.session.text("ErrorWhileLoadingData")})),a().log.error("Failed to load tableData. error=",e)}_onLoadTableDataAlways(){this.childrenLoaded=!0,this.detailTable.setLoading(!1)}_transformTableDataToTableRows(e){return e}}function ry(i,e,t){return e=nM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function nM(i){var e=oM(i,"string");return typeof e=="symbol"?e:String(e)}function oM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ef extends Pl{constructor(){super(),ry(this,"page",void 0),ry(this,"outline",void 0),this.page=null}_init(e){super._init(e),this.label=this.page.text,this.iconId=this.page.overviewIconId,this.labelHtmlEnabled=this.page.htmlEnabled,this.on("click",t=>{this.outline.selectNode(this.page)})}notifyPageChanged(){this.setLabel(this.page.text),this.setIconId(this.page.overviewIconId),this.setLabelHtmlEnabled(this.page.htmlEnabled)}}function In(i,e,t){return e=lM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function lM(i){var e=aM(i,"string");return typeof e=="symbol"?e:String(e)}function aM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Dh extends $n{constructor(){super(),In(this,"compact",void 0),In(this,"compactLayoutConfig",void 0),In(this,"outline",void 0),In(this,"page",void 0),In(this,"nodes",void 0),In(this,"_outlineNodeChangedHandler",void 0),In(this,"_outlineStructureChangedHandler",void 0),this.compact=!1,this.compactLayoutConfig=new Qi({columnWidth:120,rowHeight:100,hgap:15,vgap:15}),this.outline=null,this.page=null,this.nodes=null,this.scrollable=!1,this.renderAnimationEnabled=!0,this.startupAnimationEnabled=!0,this._outlineNodeChangedHandler=this._onOutlineNodeChanged.bind(this),this._outlineStructureChangedHandler=this._onOutlineStructureChanged.bind(this)}_init(e){super._init(e),this.nodes=this.nodes||this.page&&this.page.childNodes||this.outline&&this.outline.nodes,this._setCompact(this.compact),this.setOutline(this.outline),this.setPage(this.page),this.setNodes(this.nodes),this._setCompactLayoutConfig(this.compactLayoutConfig)}_destroy(){this.setOutline(null),this.setPage(null),this.setNodes(null),super._destroy()}_createKeyStrokeContext(){return new Oe}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.keyStrokeContext.$bindTarget=this.session.$entryPoint,this.keyStrokeContext.registerKeyStroke(new Ff(this))}setOutline(e){this.outline&&(this.outline.off("nodeChanged pageChanged",this._outlineNodeChangedHandler),this.outline.off("nodesDeleted",this._outlineStructureChangedHandler),this.outline.off("nodesInserted",this._outlineStructureChangedHandler),this.outline.off("allChildNodesDeleted",this._outlineStructureChangedHandler),this.outline.off("childNodeOrderChanged",this._outlineStructureChangedHandler)),this._setProperty("outline",e),this.outline&&(this.outline.on("nodeChanged pageChanged",this._outlineNodeChangedHandler),this.outline.on("nodesDeleted",this._outlineStructureChangedHandler),this.outline.on("nodesInserted",this._outlineStructureChangedHandler),this.outline.on("allChildNodesDeleted",this._outlineStructureChangedHandler),this.outline.on("childNodeOrderChanged",this._outlineStructureChangedHandler))}setCompact(e){this.setProperty("compact",e)}_setCompact(e){this._setProperty("compact",e),this.compact?this.setLayoutConfig(this.compactLayoutConfig):this.initialized&&this.setLayoutConfig(new Qi),this.setGridColumnCount(this.compact?3:4),this.startupAnimationEnabled=!this.compact,this.initialized&&this._rebuild()}_setCompactLayoutConfig(e){e||(e=new Qi),this._setProperty("compactLayoutConfig",Qi.ensure(e))}setPage(e){this._setProperty("page",e)}setNodes(e){this._setProperty("nodes",e),this._rebuild()}_createPageTiles(e){return(e||[]).map(t=>this._createPageTile(t))}_createPageTile(e){let t=u.create(Ef,{parent:this,outline:this.outline,page:e}),s=u.create(Qp,{parent:this,cssClass:this.compact?"compact":null,tileWidget:t});return e.tile=s,s}_rebuild(){this.setTiles(this._createPageTiles(this.nodes))}_onOutlineNodeChanged(e){let s=(e.node||e.page).tile;if(!s)return;s.tileWidget.notifyPageChanged()}_onOutlineStructureChanged(e){if(this.page)this.page===e.parentNode&&this.setNodes(this.page.childNodes);else{let t=e;(t.nodes&&t.nodes.some(r=>!r.parentNode)||e.type==="allChildNodesDeleted")&&this.setNodes(this.outline.nodes)}}}class Ff extends Yo{constructor(e){super(),this.field=e,this.registerRange(g[1],()=>g[Math.min(this._tiles().length,9)]),this.renderingHints.$drawingArea=(t,s)=>{let r=s.which-g[1],n=this._tiles();return r<n.length&&n[r].tileWidget instanceof Pl?n[r].tileWidget.$fieldContainer:null}}_accept(e){if(!super._accept(e)||this.field&&this.field.outline&&this.field.outline.inBackground)return!1;let s=g.codesToKeys[e.which]-1,r=this._tiles();return!!(s<r.length&&r[s].tileWidget instanceof Pl&&(e._$element=r[s].$container,e._$element))}handle(e){e._$element.data("widget").tileWidget.doAction()}_tiles(){return this.field.tiles}}class Df extends ai{constructor(){super(),this.leaf=!0}_init(e){u.assertParameter("row",e.row,Xt),super._init(e),this.text=this.row.cells[0].text}}class Af{accept(e){return e.parentNode?e.parentNode.filterAccepted?!e.parentNode.detailTable||!e.row?!0:e.row.filterAccepted:!1:!0}}function Pe(i,e,t){return e=hM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function hM(i){var e=dM(i,"string");return typeof e=="symbol"?e:String(e)}function dM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class bs extends pe{constructor(){super(),Pe(this,"compact",void 0),Pe(this,"defaultDetailForm",void 0),Pe(this,"detailContent",void 0),Pe(this,"embedDetailContent",void 0),Pe(this,"inBackground",void 0),Pe(this,"iconId",void 0),Pe(this,"iconVisible",void 0),Pe(this,"mediator",void 0),Pe(this,"navigateButtonsVisible",void 0),Pe(this,"navigateUpInProgress",void 0),Pe(this,"icon",void 0),Pe(this,"outlineOverview",void 0),Pe(this,"outlineOverviewVisible",void 0),Pe(this,"title",void 0),Pe(this,"titleVisible",void 0),Pe(this,"titleMenuBar",void 0),Pe(this,"nodeMenuBar",void 0),Pe(this,"nodeMenuBarVisible",void 0),Pe(this,"detailMenuBar",void 0),Pe(this,"nodePaddingLevelHierarchyRow",void 0),Pe(this,"detailMenuBarVisible",void 0),Pe(this,"selectedViewTabs",void 0),Pe(this,"views",void 0),Pe(this,"dialogs",void 0),Pe(this,"formController",void 0),Pe(this,"messageBoxes",void 0),Pe(this,"messageBoxController",void 0),Pe(this,"fileChoosers",void 0),Pe(this,"fileChooserController",void 0),Pe(this,"$title",void 0),Pe(this,"$titleText",void 0),Pe(this,"_detailContentDestroyHandler",void 0),Pe(this,"_detailMenusNodesSelectedHandler",void 0),Pe(this,"_detailMenusChangeHandler",void 0),Pe(this,"_detailMenusDestroyHandler",void 0),Pe(this,"_defaultDetailFormDestroyHandler",void 0),this.compact=!1,this.defaultDetailForm=null,this.detailContent=null,this.embedDetailContent=!1,this.inBackground=!1,this.iconId=null,this.iconVisible=!1,this.mediator=null,this.navigateButtonsVisible=!0,this.navigateUpInProgress=!1,this.outlineOverview=null,this.outlineOverviewVisible=!0,this.toggleBreadcrumbStyleEnabled=!0,this.title=null,this.titleVisible=!0,this.menus=[],this.titleMenuBar=null,this.nodeMenuBar=null,this.nodeMenuBarVisible=!1,this.detailMenuBar=null,this.detailMenuBarVisible=!1,this.dialogs=[],this.views=[],this.messageBoxes=[],this.fileChoosers=[],this.formController=null,this.messageBoxController=null,this.fileChooserController=null,this.textFilterEnabled=!1,this._detailContentDestroyHandler=this._onDetailContentDestroy.bind(this),this._detailMenusNodesSelectedHandler=null,this._defaultDetailFormDestroyHandler=this._onDefaultDetailFormDestroy.bind(this),this._additionalContainerClasses+=" outline",this.nodePaddingLevelCheckable=20,this.nodePaddingLevelNotCheckable=20,this.nodePaddingLevelHierarchyRow=this.nodePaddingLevelNotCheckable,this._scrollDirections="y",this._addWidgetProperties(["defaultDetailForm","views","selectedViewTabs","dialogs","messageBoxes","fileChoosers"])}_init(e){this.compact=u.nvl(e.compact,e.parent.session.desktop.displayStyle===Ie.DisplayStyle.COMPACT),this.embedDetailContent=u.nvl(e.embedDetailContent,this.compact),this.addFilter(new Af,!1),super._init(e),this.mediator=this._createMediator(),this.formController=u.create(ml,{displayParent:this,session:this.session}),this.messageBoxController=new gl(this,this.session),this.fileChooserController=new ll(this,this.session),this.resolveTextKeys(["title"]),this.titleMenuBar=u.create(ce,{parent:this,menuOrder:new nr}),this.nodeMenuBar=u.create(ce,{parent:this,position:ce.Position.BOTTOM,menuOrder:new nr}),this.detailMenuBar=u.create(ce,{parent:this,position:ce.Position.BOTTOM,menuOrder:new nr}),this._setDefaultDetailForm(this.defaultDetailForm),this._setOutlineOverviewVisible(this.outlineOverviewVisible),this._setOutlineOverview(this.outlineOverview),this._updateOutlineOverview(),this._setViews(this.views),this._setMenus(this.menus),this.updateDetailContent()}_createMediator(){return u.create($f)}insertNode(e,t){super.insertNode(e,t)}_createTreeNode(e){return e=e||{},e.objectType=u.nvl(e.objectType,ai),e.parent=this,u.create(e)}_createKeyStrokeContext(){return new If(this)}_filterMenus(e,t,s,r){return[]}_initTreeKeyStrokeContext(){let e=Te.CTRL|Te.SHIFT;this.keyStrokeContext.registerKeyStrokes([new Ka(this,e),new Ga(this,e),new Lf(this,e),new Ua(this,e),new qa(this,e),new Ya(this,e)]),this.keyStrokeContext.$bindTarget=()=>this.session.$entryPoint}_render(){super._render(),this.htmlComp.setLayout(new Ah(this)),this._renderCompact(),this._renderEmbedDetailContent(),this._renderDetailContent(),this._renderDetailMenuBarVisible(),this._renderNodeMenuBarVisible()}_renderProperties(){super._renderProperties(),this._renderTitle(),this._updateIcon(),this._renderTitleMenuBar()}_computeNodePaddingLeft(e){return this._computeNodePaddings(),this.compact&&e.row&&e.getOutline().selectedNode()!==e?this.nodePaddingLeft+e.row.hierarchyLevel*this.nodePaddingLevelHierarchyRow:super._computeNodePaddingLeft(e)}_remove(){super._remove(),this._removeTitle(),this._removeIcon()}_renderTitle(){this.titleVisible&&(this.$title||(this.$title=this.$container.prependDiv("outline-title").on("mousedown",this._onTitleMouseDown.bind(this)).toggleClass("touch",x.get().supportsOnlyTouch()),this.$titleText=this.$title.prependDiv("text")),this.$titleText.text(this.title))}_removeTitle(){this.titleVisible&&(this.$title.remove(),this.$title=null)}setIconVisible(e){this.setProperty("iconVisible",e),this.rendered&&this._updateIcon()}setIconId(e){this.setProperty("iconId",e),this.rendered&&this._updateIcon()}_updateIcon(){if(this.titleVisible&&this.iconVisible&&this.iconId){if(this.icon){this.icon.setIconDesc(this.iconId);return}this.icon=u.create(Zs,{parent:this,iconDesc:this.iconId,prepend:!0}),this.icon.render(this.$title)}else{if(!this.icon)return;this.icon.remove(),this.icon=null}}_removeIcon(){this.icon&&(this.icon.remove(),this.icon=null)}_renderTitleMenuBar(){this.titleVisible&&(this.titleMenuBar.render(this.$title),this.titleMenuBar.$container.addClass("prevent-initial-focus"))}_renderEnabled(){super._renderEnabled(),this.$container.setTabbable(!1)}_initTreeNodeInternal(e,t){super._initTreeNodeInternal(e,t),this._initDetailTableAndForm(e),this.trigger("pageInit",{page:e})}_initDetailTableAndForm(e){e.detailTable&&this._initDetailTable(e),e.detailForm&&this._initDetailForm(e)}_initDetailTable(e){this.navigateButtonsVisible&&e.navigateButtonsVisible&&this._appendNavigateButtonsForDetailTable(e)}_initDetailForm(e){this.navigateButtonsVisible&&e.navigateButtonsVisible&&this._appendNavigateButtonsForDetailForm(e),e.detailForm.detailForm=!0,e.detailForm.one("destroy",()=>{e.detailForm=null,this._triggerPageChanged(e)})}_createNavigateButtons(e,t){let s=p.ensure(t.staticMenus);if(!this._hasMenu(s,Mh)){let r=u.create(Mh,{parent:t,altKeyStrokeContext:t.keyStrokeContext,outline:this,node:e});s.push(r)}if(!this._hasMenu(s,Rh)){let r=u.create(Rh,{parent:t,altKeyStrokeContext:t.keyStrokeContext,outline:this,node:e});s.push(r)}return s}_getMenu(e,t){for(let s=0;s<e.length;s++)if(e[s]instanceof t)return e[s];return null}_hasMenu(e,t){return this._getMenu(e,t)!==null}_onTitleMouseDown(e){this.titleMenuBar.rendered&&this.titleMenuBar.$container.isOrHas(e.target)||this.navigateToTop()}navigateToTop(){this.compact&&this.embedDetailContent?this.selectNodes(this.compactRootNode()||[]):this.deselectAll(),this.handleInitialExpanded(),this.setScrollTop(0)}compactRootNode(){return this.nodes[0]&&this.nodes[0].compactRoot?this.nodes[0]:null}handleInitialExpanded(){this.visitNodes(e=>{this.setNodeExpanded(e,e.initialExpanded,{renderExpansion:!0})})}_onNodeDeleted(e){e.detailTable&&(e.detailTable.destroy(),e.detailTable=null)}selectNodes(e,t){e=p.ensure(e),!(e.length>0&&this.isNodeSelected(e[0]))&&(e.length===0&&this.selectedNodes.length===0||(this.navigateUpInProgress?this.navigateUpInProgress=!1:e.length===1&&this.setDetailFormVisibleByUi(e[0],!0),super.selectNodes(e,t)))}_setSelectedNodes(e,t){super._setSelectedNodes(e,t),this.updateDetailContent()}_nodesSelectedInternal(e){let t=this.activePage();t&&(t.activate(),t.ensureLoadChildren().done(this._onLoadChildrenDone.bind(this,t)))}_renderSelection(){super._renderSelection(),this.$container.toggleClass("node-selected",this.selectedNodes.length>0);let e=this.prevSelectedNode;this.embedDetailContent&&e&&e.$node&&(e.$node.cssHeight(null).cssWidth(null),e.height=e.$node.outerHeight(!0))}_removeNodeSelection(e){e.$text&&!this.isHorizontalScrollingEnabled()&&e.$text.cssWidth(null),super._removeNodeSelection(e)}setDefaultDetailForm(e){this.setProperty("defaultDetailForm",e)}_setDefaultDetailForm(e){this.defaultDetailForm&&(this.defaultDetailForm.detailForm=!1,this.defaultDetailForm.off("destroy",this._defaultDetailFormDestroyHandler)),this._setProperty("defaultDetailForm",e),this.defaultDetailForm&&(this._adaptDefaultDetailForm(this.defaultDetailForm),this.defaultDetailForm.one("destroy",this._defaultDetailFormDestroyHandler)),this.initialized&&(this._updateOutlineOverview(),this.updateDetailContent())}_adaptDefaultDetailForm(e){e.setModal(!1),e.setClosable(!1),e.setDisplayHint(U.DisplayHint.VIEW),e.setDisplayViewId("C"),e.setShowOnOpen(!1),e.detailForm=!0}_onDefaultDetailFormDestroy(e){this.setDefaultDetailForm(null)}setOutlineOverviewVisible(e){this.setProperty("outlineOverviewVisible",e),this._updateOutlineOverview()}_setOutlineOverviewVisible(e){this._setProperty("outlineOverviewVisible",e)}setOutlineOverview(e){this.setProperty("outlineOverview",e),this._updateOutlineOverview()}_setOutlineOverview(e){e&&(e=this._createChild(e)),this._setProperty("outlineOverview",e)}_updateOutlineOverview(){this.defaultDetailForm?this.outlineOverview&&(this.outlineOverview.destroy(),this._setOutlineOverview(null)):this.outlineOverviewVisible?this.outlineOverview||this._setOutlineOverview(this._createOutlineOverview()):this.outlineOverview&&(this.outlineOverview.destroy(),this._setOutlineOverview(null))}_createOutlineOverview(){return u.create(Fl,{parent:this,outline:this})}setNavigateButtonsVisible(e){this.setProperty("navigateButtonsVisible",e)}_setNavigateButtonsVisible(e){this._setProperty("navigateButtonsVisible",e),this.visitNodes(this._setNavigateButtonsVisibleForNode.bind(this))}_setNavigateButtonsVisibleForNode(e,t){this.navigateButtonsVisible?(e.detailForm&&this._appendNavigateButtonsForDetailForm(e),e.detailTable&&this._appendNavigateButtonsForDetailTable(e)):(e.detailForm&&this._removeNavigateButtonsForDetailForm(e),e.detailTable&&this._removeNavigateButtonsForDetailTable(e))}_appendNavigateButtonsForDetailForm(e){if(e.detailForm.rootGroupBox){let t=this._createNavigateButtons(e,e.detailForm.rootGroupBox);e.detailForm.rootGroupBox.setStaticMenus(t)}}_appendNavigateButtonsForDetailTable(e){let t=this._createNavigateButtons(e,e.detailTable);e.detailTable.setStaticMenus(t)}_removeNavigateButtonsForDetailForm(e){if(e.detailForm.rootGroupBox){let t=e.detailForm.rootGroupBox.staticMenus.filter(s=>!(s instanceof $o));e.detailForm.rootGroupBox.setStaticMenus(t)}}_removeNavigateButtonsForDetailTable(e){let t=e.detailTable.staticMenus.filter(s=>!(s instanceof $o));e.detailTable.setStaticMenus(t)}selectedRow(){let e=this.selectedNode();return!e||!e.detailTable?null:e.detailTable.selectedRow()}selectedNode(){return super.selectedNode()}_isGroupingEnd(e){return e.nodeType===ai.NodeType.TABLE}_isTruncatedNodeTooltipEnabled(){return!1}setDetailFormVisibleByUi(e,t){e.detailFormVisibleByUi=t,this._triggerPageChanged(e)}validateFocus(){this.session.focusManager.validateFocus()}sendToBack(){this.inBackground=!0,this._renderInBackground(),this.formController.detachDialogs(),this.messageBoxController.detach(),this.fileChooserController.detach()}bringToFront(){this.inBackground=!1,this._renderInBackground(),this.formController.attachDialogs(),this.messageBoxController.attach(),this.fileChooserController.attach()}_renderInBackground(){this.$container.toggleClass("in-background",this.inBackground&&!this.compact)}_renderCompact(){this.$container.toggleClass("compact",this.compact),this.nodePaddingLeft=null,this.nodeControlPaddingLeft=null,this._updateNodePaddingsLeft(),this.invalidateLayoutTree()}_renderEmbedDetailContent(){this.$data.toggleClass("has-detail-content",this.embedDetailContent),this.invalidateLayoutTree()}_renderDetailContent(){if(!this.detailContent||this.detailContent.rendered)return;let e=this.selectedNode();!e.rendered||(e.$text.setVisible(!!e.text),e._decorate(),this.detailContent.render(e.$node),this.detailContent.$container.addClass("detail-content"),this.detailContent.htmlComp&&(this.detailContent.htmlComp.validateRoot=!1),this._ensurePageLayout(e),this.$data.addClass("detail-content-visible"))}nodeById(e){return super.nodeById(e)}nodesByIds(e){return super.nodesByIds(e)}_ensurePageLayout(e){e.htmlComp=T.install(e.$node,this.session),e.htmlComp.setLayout(new Rf(this,e))}_removeDetailContent(){!this.detailContent||(this.detailContent.remove(),this.$data.removeClass("detail-content-visible"))}_postRenderViewRange(){super._postRenderViewRange(),this._renderDetailContent(),this._renderDetailMenuBarVisible(),this._renderNodeMenuBarVisible()}setCompact(e){this.setProperty("compact",e)}setEmbedDetailContent(e){this.setProperty("embedDetailContent",e)}_setEmbedDetailContent(e){this._setProperty("embedDetailContent",e),this.updateDetailContent()}_onDetailContentDestroy(e){this.setDetailContent(null),this.updateDetailMenus()}setDetailContent(e){this.detailContent!==e&&(this.rendered&&this._removeDetailContent(),this.detailContent&&this.detailContent.off("destroy",this._detailContentDestroyHandler),this.detailContent instanceof Aa&&this.detailContent.destroy(),this._setProperty("detailContent",e),e&&e.on("destroy",this._detailContentDestroyHandler),this.rendered&&this._renderDetailContent(),this.invalidateLayoutTree())}updateDetailContent(){if(!this.embedDetailContent){this.setDetailContent(null),this.setDetailMenus([]);return}this.setDetailMenuBarVisible(!1),this.setNodeMenuBarVisible(!1),this.setDetailContent(this._computeDetailContent()),this.updateDetailMenus()}_updateScrollTopAfterSelection(){if(!this.embedDetailContent){super._updateScrollTopAfterSelection();return}if(this.validateLayoutTree(),super._updateScrollTopAfterSelection(),this.selectedNodes[0]&&this.selectedNodes[0].parentNode){if(this.prevSelectedNode&&this.prevSelectedNode.isDescendantOf(this.selectedNodes[0]))return;this.scrollTo(this.selectedNodes[0].parentNode,{align:"top",animate:!0})}}_computeDetailContent(){let e=this.selectedNode();if(!e)return null;if(e.detailForm&&e.detailFormVisible&&e.detailFormVisibleByUi)return e.detailForm;if(e===this.compactRootNode()){let t=this.getRootContent();if(t)return t}return e.row&&e.parentNode.nodeType===ai.NodeType.TABLE?u.create(Aa,{parent:this,table:e.parentNode.detailTable,page:e}):null}getRootContent(){return this.defaultDetailForm?this.defaultDetailForm:this.outlineOverview}updateDetailMenus(){if(!this.embedDetailContent)return;let e=this.selectedNodes,t=e[0],s=[],r=[],n=[],o,l=[];if(this.detailContent&&this.detailContent instanceof U){let d=this.detailContent.rootGroupBox;d&&(s=d.processMenus.concat(d.menus),d.setMenuBarVisible(!1),this._attachDetailMenusListener(d))}else if(t&&!(this.detailContent instanceof Ih)){t.detailTable&&(o=t.detailTable,s=We.filter(o.menus,[V.MenuTypes.EmptySpace],{onlyVisible:!1,enableDisableKeyStrokes:!0}),r=o.tableControls,o.setMenuBarVisible(!1),this._attachDetailMenusListener(o));let d=t.parentNode;d&&d.detailTable&&(o=d.detailTable,s=s.concat(We.filter(o.menus,[V.MenuTypes.SingleSelection],{onlyVisible:!1,enableDisableKeyStrokes:!0})),o.setMenuBarVisible(!1),this._attachDetailMenusListener(o))}this.nodeMenuBar.menuItems.filter(d=>d instanceof pn).forEach(d=>d.destroy()),r.forEach(d=>{let c=u.create(pn,pn.adaptTableControlProperties(d,{parent:this,tableControl:d,horizontalAlignment:1}));n.push(c)}),s.forEach(d=>{d.horizontalAlignment===1?n.push(d):l.push(d)}),this.setNodeMenus(n),this.setDetailMenus(l)}_attachDetailMenusListener(e){this._detailMenusChangeHandler||(this._detailMenusChangeHandler=t=>{(t.propertyName==="menus"||t.propertyName==="tableControls")&&this.updateDetailMenus()}),this._detailMenusDestroyHandler||(this._detailMenusDestroyHandler=t=>{e.off("propertyChange",this._detailMenusChangeHandler)}),e.off("propertyChange",this._detailMenusChangeHandler),e.on("propertyChange",this._detailMenusChangeHandler),e.off("destroy",this._detailMenusDestroyHandler),e.one("destroy",this._detailMenusDestroyHandler),this._detailMenusNodesSelectedHandler||(this._detailMenusNodesSelectedHandler={outline:this,menuContainers:[],addMenuContainer:function(t){this.menuContainers.indexOf(t)>-1||this.menuContainers.push(t)},func:function(t){t.type==="nodesSelected"&&(this.menuContainers.forEach(function(s){s.off("propertyChange",this.outline._detailMenusChangeHandler),s.off("destroy",this.outline._detailMenusDestroyHandler)},this),this.menuContainers=[])}},this.addListener(this._detailMenusNodesSelectedHandler)),this._detailMenusNodesSelectedHandler.addMenuContainer(e)}setDetailMenus(e){this.detailMenuBar.setMenuItems([]),this.detailMenuBar.setMenuItems(e),this.setDetailMenuBarVisible(this.detailMenuBar.menuItems.length>0)}_renderDetailMenuBarVisible(){this.detailMenuBarVisible?this._renderDetailMenuBar():this._removeDetailMenuBar()}_renderDetailMenuBar(){if(this.detailMenuBar.rendered)return;let e=this.selectedNode();!e||!e.rendered||(this.detailMenuBar.render(e.$node),this.detailMenuBar.$container.addClass("detail-menubar"),this.detailContent&&this.detailContent.rendered&&this.detailMenuBar.$container.insertBefore(this.detailContent.$container),this._ensurePageLayout(e),this.invalidateLayoutTree())}_removeDetailMenuBar(){!this.detailMenuBar.rendered||(this.detailMenuBar.remove(),this.invalidateLayoutTree())}setDetailMenuBarVisible(e){this.setProperty("detailMenuBarVisible",e)}setNodeMenus(e){this.nodeMenuBar.setMenuItems([]),this.nodeMenuBar.setMenuItems(e),this.setNodeMenuBarVisible(this.nodeMenuBar.menuItems.length>0)}_renderNodeMenuBarVisible(){this.nodeMenuBarVisible?this._renderNodeMenuBar():this._removeNodeMenuBar()}_renderNodeMenuBar(){if(this.nodeMenuBar.rendered)return;let e=this.selectedNode();if(!e||!e.rendered)return;let t=e.$text;this.nodeMenuBar.render(e.$node),this.nodeMenuBar.$container.addClass("node-menubar"),this.nodeMenuBar.$container.insertAfter(t),this.invalidateLayoutTree()}_removeNodeMenuBar(){!this.nodeMenuBar.rendered||(this.nodeMenuBar.remove(),this.invalidateLayoutTree())}setNodeMenuBarVisible(e){this.setProperty("nodeMenuBarVisible",e)}glassPaneTargets(e){return this._glassPaneTargets(e)}_glassPaneTargets(e){let t=this.session.desktop,s=[];return t.navigation&&s.push(t.navigation.$body),t.bench&&t.bench.outlineContent&&p.pushAll(s,t.bench.outlineContent.glassPaneTargets(e)),s}onGlassPaneMouseDown(e,t){let s=this.session.desktop;s.navigation&&t.parent()[0]===s.navigation.$body[0]&&s.bringOutlineToFront()}inFront(){return this.session.desktop.outline===this&&!this.inBackground}acceptDialog(e){return this.session.desktop.outline===this}acceptView(e){return this.session.desktop.outline===this}activateCurrentPage(){let e=this.activePage();e&&e.activate()}activePage(){return this.selectedNode()}_setViews(e){e&&e.forEach(t=>t.setDisplayParent(this)),this._setProperty("views",e)}_setMenus(e){let t=this.menus;if(this.updateKeyStrokes(e,t),this._setProperty("menus",e),this.titleMenuBar){let s=We.filter(this.menus,[pe.MenuTypes.Header]);this.titleMenuBar.setMenuItems(s)}}_triggerPageChanged(e){this.trigger("pageChanged",{page:e})}_onLoadChildrenDone(e){e&&this._initDetailTableAndForm(e)}pageChanged(e){e&&this._initDetailTableAndForm(e);let t=this.selectedNode();(!e&&!t||e===t)&&this.updateDetailContent(),this._triggerPageChanged(e)}}function El(i,e,t){return e=uM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function uM(i){var e=cM(i,"string");return typeof e=="symbol"?e:String(e)}function cM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class dr extends uo{constructor(){super(),El(this,"_filterDirty",void 0),El(this,"_nodeIdToRowMap",void 0),El(this,"_detailTableRowInitHandler",void 0),El(this,"_detailTableRowsInsertedHandler",void 0),El(this,"_detailTableFilterRemoved",void 0),this._filterDirty=!1,this._nodeIdToRowMap={},this._detailTableRowInitHandler=this._onDetailTableRowInit.bind(this),this._detailTableRowsInsertedHandler=this._onDetailTableRowsInserted.bind(this),this._detailTableFilterRemoved=this._onDetailTableFilterRemoved.bind(this)}_onPageChanged(e){let t=this.widget.nodeById(e.nodeId);t.overviewIconId=e.overviewIconId,t.detailFormVisible=e.detailFormVisible;let s=this.session.getOrCreateWidget(e.detailForm,this.widget);t.setDetailForm(s),t.navigateButtonsVisible=e.navigateButtonsVisible,t.detailTableVisible=e.detailTableVisible;let r=this.session.getOrCreateWidget(e.detailTable,this.widget);t.detailTable!==r&&(t.detailTable&&this._destroyDetailTable(t),t.setDetailTable(r),t.detailTable&&this._initDetailTable(t)),this.widget.pageChanged(t)}onModelAction(e){e.type==="pageChanged"?this._onPageChanged(e):super.onModelAction(e)}_initDetailTable(e){e.detailTable.rows.forEach(this._linkNodeWithRow.bind(this)),e.detailTable.on("rowInit",this._detailTableRowInitHandler),e.detailTable.on("rowsInserted",this._detailTableRowsInsertedHandler),e.detailTable.on("filterRemoved",this._detailTableFilterRemoved)}_destroyDetailTable(e){this._nodeIdToRowMap={},e.detailTable.rows.forEach(this._unlinkNodeWithRow.bind(this)),e.detailTable.off("rowInit",this._detailTableRowInitHandler),e.detailTable.off("rowsInserted",this._detailTableRowsInsertedHandler),e.detailTable.off("filterRemoved",this._detailTableFilterRemoved)}_linkNodeWithRow(e){u.assertParameter("row",e);let t=e.nodeId;if(t===void 0)return;let s=this.widget.nodesMap[t];s?s.linkWithRow(e):this._nodeIdToRowMap[t]=e}_unlinkNodeWithRow(e){let t=this.widget.nodesMap[e.nodeId];t&&t.unlinkWithRow(e)}_onDetailTableRowInit(e){this._linkNodeWithRow(e.row);let t=this.widget.nodesMap[e.row.nodeId];this.widget.isSelectedNode(t)&&!this.widget.detailContent&&this.widget.updateDetailContent()}_onDetailTableRowsInserted(e){let t=e.source;(this._filterDirty||t.filterCount()>0&&e.rows.some(s=>!s.filterAccepted))&&(this._filterDirty=!1,this.widget.filter())}_onDetailTableFilterRemoved(e){let s=e.source.modelAdapter;s&&s._rebuildingTable&&(this._filterDirty=!0)}_linkNodeWithRowLater(e){if(!e.parentNode||!e.parentNode.detailTable||!this._nodeIdToRowMap.hasOwnProperty(e.id))return;let t=this._nodeIdToRowMap[e.id];e.linkWithRow(t),delete this._nodeIdToRowMap[e.id]}_getDefaultNodeObjectType(){return"Page"}static modifyOutlinePrototype(){!te.get().remote||(b.replacePrototypeFunction(bs,"_computeDetailContent",dr._computeDetailContentRemote,!0),b.replacePrototypeFunction(bs,"updateDetailMenus",dr.updateDetailMenusRemote,!0),b.replacePrototypeFunction(bs,"_initTreeNodeInternal",dr._initTreeNodeInternalRemote,!0),b.replacePrototypeFunction(bs,"_createTreeNode",dr._createTreeNodeRemote,!0))}static _computeDetailContentRemote(){if(!this.modelAdapter)return this._computeDetailContentOrig();let e=this.selectedNode();if(!e)return null;if(e.detailForm||e.detailFormResolved)return e.detailFormResolved=!0,this._computeDetailContentOrig();if(!this.session.areRequestsPending()&&!this.session.areEventsQueued())return e.detailFormResolved=!0,this._computeDetailContentOrig();this.session.listen().done(function(t){t.detailFormResolved||(t.detailFormResolved=!0,this.updateDetailContent())}.bind(this,e))}static updateDetailMenusRemote(){if(!this.modelAdapter)return this.updateDetailMenusOrig();if(this.selectedNode()&&this.selectedNode().detailFormResolved)return this.updateDetailMenusOrig()}static _initTreeNodeInternalRemote(e,t){this._initTreeNodeInternalOrig(e,t),this.modelAdapter&&(this.modelAdapter.widget=this,e.detailTable&&this.modelAdapter._initDetailTable(e),this.modelAdapter._linkNodeWithRowLater(e))}}te.addListener("bootstrap",dr.modifyOutlinePrototype);class $f{init(e){}_skipEvent(e){return e===null||e.getOutline()===null||e.leaf}onTableRowsInserted(e,t,s){this._skipEvent(s)||s.getTree().insertNodes(t,s)}onTableRowsDeleted(e,t,s){this._skipEvent(s)||s.getTree().deleteNodes(t,s)}onTableRowsUpdated(e,t){if(this._skipEvent(t))return;let s=t.updatePagesFromTableRows(e.rows);t.getTree().updateNodes(s)}onTableRowAction(e,t){let s=e.row.page;if(!s)return;let r=s.getOutline();!r||(r.selectNode(s),r.setNodeExpanded(s,!0))}onTableRowOrderChanged(e,t){if(this._skipEvent(t))return;let s=e.source,r=t.pagesForTableRows(s.rows);t.getOutline().updateNodeOrder(r,t)}onTableFilter(e,t){t.getOutline().filter()}}function pM(i,e,t){return e=fM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function fM(i){var e=mM(i,"string");return typeof e=="symbol"?e:String(e)}function mM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ah extends pl{constructor(e){super(e),pM(this,"outline",void 0),this.outline=e}_layout(e){let t=this.outline.htmlComp;super._layout(e);let s=t.availableSize({exact:!0}).subtract(t.insets());if(this.outline.embedDetailContent){let r=this.outline.selectedNodes[0];if(r&&r.rendered){let n=r.htmlComp;if(n){let o=n.prefSize({widthHint:s.width});n.setSize(new F(s.width,o.height)),r.height=o.height+n.margins().vertical()}}}this.outline.titleMenuBar.validateLayout(),this.outline.nodeMenuBar.validateLayout(),this.outline.detailMenuBar.validateLayout()}_setDataHeight(e){let t=null;this.outline.titleVisible&&(t=v.size(this.outline.$title,!0)),super._setDataHeight(e+(t===null?0:t.height))}}function gM(i,e,t){return e=_M(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function _M(i){var e=yM(i,"string");return typeof e=="symbol"?e:String(e)}function yM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class $h extends wf{constructor(){super(),gM(this,"outline",void 0),this.outline=null,this._addWidgetProperties("outline"),this._addPreserveOnPropertyChangeProperties(["outline"]),this._addCloneProperties(["outline"])}_init(e){super._init(e),this._setOutline(this.outline)}_setOutline(e){this._setProperty("outline",e),this.outline&&this.outline.setIconId(this.iconId)}_setIconId(e){this._setProperty("iconId",e),this.outline&&this.outline.setIconId(this.iconId)}_doAction(){super._doAction(),this.outline&&(this.session.desktop.setOutline(this.outline),this.session.desktop.bringOutlineToFront())}onOutlineChange(e){let t=!!e&&this.outline===e;this.setSelected(t)}}class ny extends Tf{_goOffline(){this.widget.outline||(this._enabledBeforeOffline=this.widget.enabled,this.widget.setEnabled(!1))}_goOnline(){this.widget.outline||this.widget.setEnabled(this._enabledBeforeOffline)}}function oy(i,e,t){return e=bM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function bM(i){var e=vM(i,"string");return typeof e=="symbol"?e:String(e)}function vM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class ly extends A{constructor(){super(),oy(this,"outline",void 0),oy(this,"tileOutlineOverview",void 0),this.outline=null,this.tileOutlineOverview=null}_render(){this._ensureTileOutlineOverview(),this.addContainer(this.$parent,"outline-tile-field"),this.tileOutlineOverview.render(this.$container),this.addField(this.tileOutlineOverview.$container)}_ensureTileOutlineOverview(){if(this.tileOutlineOverview)return;let e=this.outline?this.session.getWidget(this.outline):null;this.tileOutlineOverview=u.create(Fl,{parent:this,outline:e})}}class ay extends at{}function hy(i,e,t){return e=wM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function wM(i){var e=TM(i,"string");return typeof e=="symbol"?e:String(e)}function TM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Rf extends ee{constructor(e,t){super(),hy(this,"outline",void 0),hy(this,"page",void 0),this.outline=e,this.page=t}layout(e){let t=this.page.htmlComp,s=this.page.$text,r=this.page.$icon(),n=0,o=0,l=this.outline.nodeMenuBar,h=this.outline.detailMenuBar,d=0,c=0,f=t.availableSize({exact:!0}).subtract(t.insets());if(c=f.width,r.length>0&&(c-=v.prefSize(r).width),l.visible){let m=l.htmlComp.prefSize();l.htmlComp.setSize(m),c-=m.add(l.htmlComp.margins()).width}if(s.cssWidth(c),h.visible){d=h.htmlComp.prefSize().height;let m=new F(f.width,d).subtract(h.htmlComp.margins());h.htmlComp.setSize(m)}if(this.outline.detailContent){r.length>0&&(o=r.outerHeight(!0)),s.isVisible()&&(n=s.outerHeight(!0)),n=Math.max(n,o);let m=this.outline.detailContent.htmlComp;m.setSize(new F(f.width,f.height-n-d-m.margins().vertical()))}}preferredLayoutSize(e,t){let s=0,r=this.page.htmlComp,n=new F,o=this.page.$text,l=this.page.$icon(),h=0,d=this.outline.detailMenuBar,c=new F,f=this.outline.nodeMenuBar,m=0;m=t.widthHint,l.length>0&&(m-=v.prefSize(l).width),f.visible&&f.rendered&&(m-=f.htmlComp.prefSize().width);let _=v.prefSize(o,{includeMargin:!0,widthHint:m,enforceSizeHints:!0,exact:!0}).height;if(l.length>0&&(s=l.outerHeight(!0)),h=Math.max(_,s),d.visible&&d.rendered&&(c=d.htmlComp.prefSize()),this.outline.detailContent){let S=this.outline.detailContent.htmlComp;t=$.extend({},t,{enforceSizeHints:!0,exact:!0}),n=S.prefSize(t).add(S.margins())}let C=new F(Math.max(n.width,c.width),h+c.height+n.height);return C=C.add(r.insets()),C}}function Br(i,e,t){return e=CM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function CM(i){var e=SM(i,"string");return typeof e=="symbol"?e:String(e)}function SM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class dy extends bs{constructor(){super(),Br(this,"hasText",void 0),Br(this,"searchQuery",void 0),Br(this,"searchStatus",void 0),Br(this,"searchFieldKeyStrokeContext",void 0),Br(this,"$searchPanel",void 0),Br(this,"$clearIcon",void 0),Br(this,"$searchStatus",void 0),Br(this,"$queryField",void 0),this.hasText=!1,this.$searchPanel=null,this.$clearIcon=null,this.$searchStatus=null,this.$queryField=null}_initKeyStrokeContext(){super._initKeyStrokeContext(),this.searchFieldKeyStrokeContext=this._createKeyStrokeContextForSearchField()}_createKeyStrokeContextForSearchField(){let e=new As;return e.$scopeTarget=()=>this.$searchPanel,e.$bindTarget=()=>this.$queryField,e.registerStopPropagationKeys(Te.NONE,[g.ENTER,g.BACKSPACE]),e}_render(){super._render(),this.htmlComp.setLayout(new Mf(this)),this.$container.addClass("search-outline"),this.$searchPanel=this.$container.prependDiv("search-outline-panel"),this.$queryField=this.$searchPanel.appendElement("<input>","search-outline-field").on("input",this._createOnQueryFieldInputFunction().bind(this)).on("keypress",this._onQueryFieldKeyPress.bind(this)),this.$clearIcon=this.$searchPanel.appendSpan("clear-icon unfocusable action text-field-icon").on("mousedown",this._onClearIconMouseDown.bind(this)),this.$searchStatus=this.$searchPanel.appendDiv("search-outline-status").on("mousedown",this._onTitleMouseDown.bind(this)),this.session.keyStrokeManager.installKeyStrokeContext(this.searchFieldKeyStrokeContext)}_remove(){this.session.keyStrokeManager.uninstallKeyStrokeContext(this.searchFieldKeyStrokeContext),this.$searchPanel.remove(),super._remove()}_renderProperties(){super._renderProperties(),this._renderSearchQuery(),this._renderSearchStatus(),this._updateHasText()}_renderTitle(){super._renderTitle(),this.titleVisible&&this.$title.insertBefore(this.$searchPanel)}_renderSearchQuery(){this.$queryField.val(this.searchQuery)}_renderSearchStatus(){let e=this.rendered;this.searchStatus&&!this.$searchStatus.isVisible()?e?this.$searchStatus.slideDown({duration:200,progress:this.revalidateLayout.bind(this)}):this.$searchStatus.show():!this.searchStatus&&this.$searchStatus.isVisible()&&(e?this.$searchStatus.slideUp({duration:200,progress:this.revalidateLayout.bind(this)}):this.$searchStatus.hide()),this.$searchStatus.textOrNbsp(this.searchStatus),this.$searchPanel.toggleClass("has-status",!!this.searchStatus)}focusQueryField(){this.validateFocus()}_triggerSearch(){this.trigger("search",{query:u.nvl(this.searchQuery,"")})}_createOnQueryFieldInputFunction(){let e=a().debounce(this._search.bind(this));return function(t){this._updateHasText(),e()}}_onClearIconMouseDown(e){this.$queryField.val(""),this._updateHasText(),this._search(),this.$queryField.focus(),e.preventDefault()}_onQueryFieldKeyPress(e){e.which===g.ENTER&&(this._setSearchQuery(this.$queryField.val()),this._triggerSearch())}_search(){let e=this.$queryField.val();this.searchQuery!==e&&(this._setSearchQuery(e),this._triggerSearch())}_setSearchQuery(e){this.searchQuery=e}_updateHasText(){this.$queryField.toggleClass("has-text",!!this.$queryField.val())}validateFocus(){if(!this.rendered)return;let e=this.$queryField[0];this.session.focusManager.requestFocus(e)&&e.select()}}class uy extends dr{_initProperties(e){e.requestFocusQueryField!==void 0&&delete e.requestFocusQueryField}_syncRequestFocusQueryField(){this.widget.focusQueryField()}_onWidgetSearch(e){this._send("search",{query:e.query},{showBusyIndicator:!1})}_onWidgetEvent(e){e.type==="search"?this._onWidgetSearch(e):super._onWidgetEvent(e)}}class Mf extends Ah{constructor(e){super(e)}_setDataHeight(e){let t=v.size(this.outline.$searchPanel,!0);e+=t.height,super._setDataHeight(e)}}function Ao(i,e,t){return e=PM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function PM(i){var e=xM(i,"string");return typeof e=="symbol"?e:String(e)}function xM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class $o extends ne{constructor(){super(),Ao(this,"node",void 0),Ao(this,"outline",void 0),Ao(this,"altKeyStrokeContext",void 0),Ao(this,"overflow",void 0),Ao(this,"_defaultText",void 0),Ao(this,"_defaultIconId",void 0),this.node=null,this.outline=null,this.actionStyle=re.ActionStyle.BUTTON,this._addCloneProperties(["node","outline","altKeyStrokeContext"]),this.inheritAccessibility=!1}_render(){this.overflow?(this.text=this.session.text(this._defaultText),this.iconId=null):(this.text=null,this.iconId=this._defaultIconId),this.updateEnabled(),super._render(),this.$container.addClass("navigate-button small"),this.altKeyStrokeContext.registerKeyStroke(this)}_remove(){super._remove(),this.altKeyStrokeContext.unregisterKeyStroke(this)}_setDetailVisible(){let e=this._toggleDetail();a().log.isDebugEnabled()&&a().log.debug("show detail-"+(e?"form":"table")),this.outline.setDetailFormVisibleByUi(this.node,e)}_doAction(){super._doAction(),this._isDetail()?this._setDetailVisible():this._drill()}updateEnabled(){this.setEnabled(this._buttonEnabled())}}function cy(i,e,t){return e=EM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function EM(i){var e=FM(i,"string");return typeof e=="symbol"?e:String(e)}function FM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Rh extends $o{constructor(){super(),cy(this,"_detailTableRowsSelectedHandler",void 0),cy(this,"_outlinePageRowLinkHandler",void 0),this._defaultIconId=ye.ANGLE_DOWN,this._defaultText="ui.Continue",this.iconId=this._defaultIconId,this.keyStroke="enter",this._detailTableRowsSelectedHandler=this._onDetailTableRowsSelected.bind(this),this._outlinePageRowLinkHandler=this._onOutlinePageRowLink.bind(this)}_init(e){super._init(e),this.node.detailTable&&this.node.detailTable.on("rowsSelected",this._detailTableRowsSelectedHandler),this.outline.on("pageRowLink",this._outlinePageRowLinkHandler)}_destroy(){this.node.detailTable&&this.node.detailTable.off("rowsSelected",this._detailTableRowsSelectedHandler),this.outline.off("pageRowLink",this._outlinePageRowLinkHandler),super._destroy()}_render(){super._render(),this.$container.addClass("down")}_isDetail(){return!!(this.node.detailFormVisible&&this.node.detailForm&&this.node.detailTableVisible&&this.node.detailTable&&this.node.detailFormVisibleByUi)}_toggleDetail(){return!1}_buttonEnabled(){if(this._isDetail())return!0;if(this.node.leaf)return!1;let e=this.node.detailTable;return e?e.selectedRows.length===1&&!!e.selectedRows[0].page:!0}_drill(){let e;if(this.node.detailTable){let t=this.node.detailTable.selectedRow();e=this.node.pageForTableRow(t)}else e=this.node.childNodes[0];if(e){a().log.isDebugEnabled()&&a().log.debug("drill down to node "+e);let t=e.parentNode;t&&t.childNodes.forEach(s=>{s.expanded&&s!==e&&this.outline.collapseNode(s,{renderAnimated:!1})}),this.outline.selectNodes(e),t&&t.nodeType===ai.NodeType.TABLE&&this.outline.expandNode(e)}}_onDetailTableRowsSelected(e){this.updateEnabled()}_onOutlinePageRowLink(e){let t=this.node.detailTable;t&&t.selectedRows.length===1&&t.selectedRows[0].page===e.page&&this.updateEnabled()}}class Mh extends $o{constructor(){super(),this._defaultIconId=ye.ANGLE_UP,this._defaultText="ui.Up",this.iconId=this._defaultIconId,this.keyStroke="backspace"}_render(){super._render(),this.$container.addClass("up")}_isDetail(){return!!(this.node.detailFormVisible&&this.node.detailForm&&this.node.detailTableVisible&&this.node.detailTable&&!this.node.detailFormVisibleByUi)}_toggleDetail(){return!0}_buttonEnabled(){return!!this.node.parentNode||!!this.outline.defaultDetailForm||!!this.outline.outlineOverview}_drill(){let e=this.node.parentNode;e?(a().log.isDebugEnabled()&&a().log.debug("drill up to node "+e),this.outline.navigateUpInProgress=!0,this.outline.selectNodes(e),this.outline.collapseNode(e,{collapseChildNodes:!0})):(a().log.isDebugEnabled()&&a().log.debug("drill up to top"),this.outline.navigateToTop())}}function DM(i,e,t){return e=AM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function AM(i){var e=$M(i,"string");return typeof e=="symbol"?e:String(e)}function $M(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class If extends Oe{constructor(e){super(),DM(this,"_outline",void 0),this._outline=e}accept(e){return!this._outline.inBackground&&!this.isFormMenuOpen()&&super.accept(e)}isFormMenuOpen(){return this._outline.session.desktop.menus.some(t=>t.popup&&t.popup.$container&&t.popup.$container.isAttached())}}class Lf extends sr{constructor(e,t){super(e,t),this.which=[g.HOME],this.renderingHints.hAlign=ht.RIGHT,this.renderingHints.$drawingArea=(s,r)=>this.field.$title||this.field.$data}handle(e){this.field.navigateToTop()}}function Of(i,e,t){return e=RM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function RM(i){var e=MM(i,"string");return typeof e=="symbol"?e:String(e)}function MM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ih extends I{constructor(){super(),Of(this,"outline",void 0),Of(this,"displayViewId",void 0),Of(this,"$content",void 0),this.outline=null}_init(e){super._init(e),!this.outline&&this.parent instanceof bs&&(this.outline=this.parent),u.assertProperty(this,"outline",bs)}_render(){this.$container=this.$parent.appendDiv("outline-overview"),this.htmlComp=T.install(this.$container,this.session),this.$content=this.$container.appendDiv("outline-overview-content"),this.$content.appendDiv("outline-overview-icon").icon(this.outline.iconId),this.$content.appendDiv("outline-overview-title").text(this.outline.title)}_attach(){this.$parent.append(this.$container);let e=this.htmlComp.getParent();this.htmlComp.setSize(e.size()),super._attach()}_detach(){this.$container.detach(),super._detach()}}function Ro(i,e,t){return e=IM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function IM(i){var e=LM(i,"string");return typeof e=="symbol"?e:String(e)}function LM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Fl extends Ih{constructor(){super(),Ro(this,"pageTileGrid",void 0),Ro(this,"scrollable",void 0),Ro(this,"titleVisible",void 0),Ro(this,"contentHtmlComp",void 0),Ro(this,"$title",void 0),Ro(this,"_desktopNavigationVisibilityChangeHandler",void 0),this.pageTileGrid=null,this.scrollable=!0,this.titleVisible=!0,this._addWidgetProperties(["pageTileGrid"]),this._desktopNavigationVisibilityChangeHandler=this._onDesktopNavigationVisibilityChange.bind(this)}_init(e){super._init(e),this.pageTileGrid||(this.pageTileGrid=this._createPageTileGrid()),this.scrollable=!this.outline.compact,this.addCssClass("dimmed-background")}_render(){this.$container=this.$parent.appendDiv("tile-overview"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new Ri({stretch:this.outline.compact})),this.$content=this.$container.appendDiv("tile-overview-content"),this.contentHtmlComp=T.install(this.$content,this.session),this.contentHtmlComp.setLayout(new Ri({stretch:this.outline.compact})),this.$title=this.$content.appendDiv("tile-overview-title").text(this.outline.title),T.install(this.$title,this.session),this.$title.cssMaxHeight(this.$title.cssHeight()),this._updateTitle(!1),this.findDesktop().on("propertyChange:navigationVisible",this._desktopNavigationVisibilityChangeHandler)}_remove(){super._remove(),this.findDesktop().off("propertyChange:navigationVisible",this._desktopNavigationVisibilityChangeHandler)}_renderProperties(){super._renderProperties(),this._renderPageTileGrid(),this._renderScrollable()}_renderPageTileGrid(){this.pageTileGrid.render(this.$content)}_createPageTileGrid(){let e,t;return this.outline.compact&&(e=this.outline.compactRootNode(),e&&(t=e.childNodes)),u.create(Dh,{parent:this,outline:this.outline,compact:this.outline.compact,page:e,nodes:t})}setScrollable(e){this.setProperty("scrollable",e)}_renderScrollable(){this.scrollable?this._installScrollbars({axis:"y"}):this._uninstallScrollbars()}_updateTitle(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;!this.$title||(this.$title.toggleClass("animated",e),this.$title.toggleClass("removed",this.findDesktop().navigationVisible))}_onDesktopNavigationVisibilityChange(e){this._updateTitle()}}function Bf(i,e,t){return e=OM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function OM(i){var e=BM(i,"string");return typeof e=="symbol"?e:String(e)}function BM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class kf extends ml{constructor(e){super(e),Bf(this,"desktop",void 0),Bf(this,"popupWindows",void 0),Bf(this,"_documentPopupWindowReadyHandler",void 0),this.desktop=e.displayParent,this.popupWindows=[],this._documentPopupWindowReadyHandler=this._onDocumentPopupWindowReady.bind(this),a()(document).on("popupWindowReady",this._documentPopupWindowReadyHandler)}render(){super.render();let e=this.desktop.activeForm;e?e.activate():this.desktop.bringOutlineToFront()}_renderViews(){super._renderViews(),this.desktop.selectedViewTabs&&this.desktop.selectedViewTabs.forEach(e=>this._activateView(e)),this.desktop.bench&&this.desktop.bench.postRender()}isFormShown(e){return e.isPopupWindow()?this.popupWindows.some(t=>t.form.id===e.id):super.isFormShown(e)}_renderPopupWindow(e,t){let s,r,n=e.readCacheBounds();if(n)s="left="+n.x+",top="+n.y+",width="+n.width+",height="+n.height,r=!1;else{let h=a()(document),d=new F(h.width(),h.height());s="left=0,top=0,width="+d.width+",height="+d.height,r=!0}s+=",location=no,toolbar=no,menubar=no,resizable=yes";let o=u.create(Do,{session:this.session,preserveOpener:!0}),l="popup-window.html?formId="+e.id;o.openWindow(l,"_blank",s,h=>{this._addPopupWindow(h,e,r)})}_addPopupWindow(e,t,s){let r=new Lr(e,t);r.resizeToPrefSize=s,r.on("popupWindowUnload",this._onPopupWindowUnload.bind(this)),this.popupWindows.push(r),a().log.isDebugEnabled()&&a().log.debug("Opened new popup window for form ID "+t.id)}_onDocumentPopupWindowReady(e,t){a().log.isDebugEnabled()&&a().log.debug("(FormController#_onDocumentPopupWindowReady) data="+t);let s;if(t.formId){let r=t.formId;a().log.isDebugEnabled()&&a().log.debug("Popup window for form ID "+r+" has been reloaded");for(let n=0;n<this.popupWindows.length&&(s=this.popupWindows[n],s.form.id!==r);n++);if(!s)throw new Error("Couldn't find popupWindow reference while popup window was reloaded")}else if(t.popupWindow)s=t.popupWindow;else throw new Error("Neither property 'formId' nor 'popupWindow' exists on data parameter");s._onReady()}_onPopupWindowUnload(e){let t=e.source,s=t.form;a().log.isDebugEnabled()&&a().log.debug("Popup window for form ID "+s.id+" is unloaded - don't know if its closed or reloaded yet"),s.remove(),setTimeout(()=>{t.isClosed()&&(a().log.isDebugEnabled()&&a().log.debug("Popup window for form ID "+s.id+" has been closed"),s.close())},250)}closePopupWindows(){this.popupWindows.forEach(e=>this._removePopupWindow(e.form)),this.popupWindows=[]}_removePopupWindow(e){let t=e.popupWindow;if(!t)throw new Error("Form has no popupWindow reference");delete e.popupWindow,p.remove(this.popupWindows,t),e.rendered&&(e.remove(),t.close())}dispose(){a()(document).off("popupWindowReady",this._documentPopupWindowReadyHandler)}}function kM(i,e,t){return e=HM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function HM(i){var e=NM(i,"string");return typeof e=="symbol"?e:String(e)}function NM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Hf extends xe{constructor(){super(),kM(this,"filter",void 0),this.gridColumnCount=1,this.cssClass="filter-fields"}_init(e){super._init(e),this.filter.addFilterFields(this)}_renderProperties(){super._renderProperties(),this.filter.modifyFilterFields()}addFilterField(e,t){let s=u.create(e,{parent:this,label:this.session.text(t),statusVisible:!1,labelWidthInPixel:50});return this.addField0(s),s}addField0(e){this.fields.push(e),this._prepareFields()}}function gt(i,e,t){return e=VM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function VM(i){var e=WM(i,"string");return typeof e=="symbol"?e:String(e)}function WM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ee{constructor(e){gt(this,"objectType",void 0),gt(this,"modes",void 0),gt(this,"boundaries",void 0),gt(this,"$container",void 0),gt(this,"$window",void 0),gt(this,"$resizableS",void 0),gt(this,"$resizableE",void 0),gt(this,"$resizableSE",void 0),gt(this,"$resizableW",void 0),gt(this,"$resizableSW",void 0),gt(this,"$resizableN",void 0),gt(this,"$resizableNW",void 0),gt(this,"$resizableNE",void 0),gt(this,"_context",void 0),gt(this,"_mouseDownHandler",void 0),gt(this,"_mouseUpHandler",void 0),gt(this,"_mousemoveHandler",void 0),gt(this,"_resizeHandler",void 0),u.assertParameter("model",e),u.assertParameter("$container",e.$container),this.$container=e.$container,this.$window=e.$container.window(),this.setModes(e.modes),this.setBoundaries(e.boundaries),this.$resizableS=null,this.$resizableE=null,this.$resizableSE=null,this.$resizableW=null,this.$resizableSW=null,this.$resizableN=null,this.$resizableNW=null,this.$resizableNE=null,this._context=null,this._mouseDownHandler=this._onMouseDown.bind(this),this._mouseUpHandler=this._onMouseUp.bind(this),this._mousemoveHandler=this._onMousemove.bind(this),this._resizeHandler=this._resize.bind(this)}setModes(e){let t=e||[Ee.MODES.SOUTH,Ee.MODES.EAST,Ee.MODES.WEST,Ee.MODES.NORTH];p.equals(t,this.modes)||(this.modes=t,this._calculateResizeHandlersVisibility())}setBoundaries(e){this.boundaries=a().extend(new Ge,e),this._boundaryValueSet(this.boundaries.left)&&(this.boundaries.left-=this.$container.cssMarginLeft()),this._boundaryValueSet(this.boundaries.right)&&(this.boundaries.right-=this.$container.cssMarginRight()),this._boundaryValueSet(this.boundaries.top)&&(this.boundaries.top-=this.$container.cssMarginTop()),this._boundaryValueSet(this.boundaries.bottom)&&(this.boundaries.bottom-=this.$container.cssMarginBottom())}_appendResizeHandles(){this.$resizableS=this.$container.appendDiv("resizable-handle resizable-s").data("edge","s").on("mousedown.resizable",this._mouseDownHandler),this.$resizableE=this.$container.appendDiv("resizable-handle resizable-e").data("edge","e").on("mousedown.resizable",this._mouseDownHandler),this.$resizableSE=this.$container.appendDiv("resizable-handle resizable-se").data("edge","se").on("mousedown.resizable",this._mouseDownHandler),this.$resizableW=this.$container.appendDiv("resizable-handle resizable-w").data("edge","w").on("mousedown.resizable",this._mouseDownHandler),this.$resizableSW=this.$container.appendDiv("resizable-handle resizable-sw").data("edge","sw").on("mousedown.resizable",this._mouseDownHandler),this.$resizableN=this.$container.appendDiv("resizable-handle resizable-n").data("edge","n").on("mousedown.resizable",this._mouseDownHandler),this.$resizableNW=this.$container.appendDiv("resizable-handle resizable-nw").data("edge","nw").on("mousedown.resizable",this._mouseDownHandler),this.$resizableNE=this.$container.appendDiv("resizable-handle resizable-ne").data("edge","ne").on("mousedown.resizable",this._mouseDownHandler),this._calculateResizeHandlersVisibility()}_calculateResizeHandlersVisibility(){this.$resizableS&&this.$resizableS.setVisible(this._hasMode(Ee.MODES.SOUTH)),this.$resizableE&&this.$resizableE.setVisible(this._hasMode(Ee.MODES.EAST)),this.$resizableSE&&this.$resizableSE.setVisible(this._hasMode(Ee.MODES.SOUTH)&&this._hasMode(Ee.MODES.EAST)),this.$resizableW&&this.$resizableW.setVisible(this._hasMode(Ee.MODES.WEST)),this.$resizableSW&&this.$resizableSW.setVisible(this._hasMode(Ee.MODES.SOUTH)&&this._hasMode(Ee.MODES.WEST)),this.$resizableN&&this.$resizableN.setVisible(this._hasMode(Ee.MODES.NORTH)),this.$resizableNW&&this.$resizableNW.setVisible(this._hasMode(Ee.MODES.NORTH)&&this._hasMode(Ee.MODES.WEST)),this.$resizableNE&&this.$resizableNE.setVisible(this._hasMode(Ee.MODES.NORTH)&&this._hasMode(Ee.MODES.EAST))}_hasMode(e){return this.modes.some(t=>t===e)}init(){this.$container.addClass("resizable"),this._appendResizeHandles(),this._installRemoveHandler()}_installRemoveHandler(){this.$container.on("remove",this.destroy.bind(this))}destroy(){this.$resizableS&&(this.$resizableS.remove(),this.$resizableS=null),this.$resizableE&&(this.$resizableE.remove(),this.$resizableE=null),this.$resizableSE&&(this.$resizableSE.remove(),this.$resizableSE=null),this.$resizableW&&(this.$resizableW.remove(),this.$resizableW=null),this.$resizableSW&&(this.$resizableSW.remove(),this.$resizableSW=null),this.$resizableN&&(this.$resizableN.remove(),this.$resizableN=null),this.$resizableNW&&(this.$resizableNW.remove(),this.$resizableNW=null),this.$resizableNE&&(this.$resizableNE.remove(),this.$resizableNE=null),this.$container&&this.$container.removeClass("resizable"),this.$window.off("mouseup.resizable",this._mouseUpHandler).off("mousemove.resizable",this._mousemoveHandler)}_onMouseDown(e){let t=this.$container,s=t.window(),r=a()(e.target),n=t.cssMinWidth(),o=t.cssMinHeight(),l=t.cssMaxWidth(),h=t.cssMaxHeight(),d=v.bounds(t,{exact:!0});this._context={initialBounds:d,minBounds:new ie(d.right()-n,d.bottom()-o,n,o),maxBounds:new ie(Math.max(-t.cssMarginLeft(),d.right()-l),Math.max(-t.cssMarginTop(),d.bottom()-h),Math.min(s.width()-t[0].offsetLeft,l),Math.min(s.height()-t[0].offsetTop,h)),distance:[0,0],edge:r.data("edge"),mousedownEvent:e},t.addClass("resizable-resizing"),this.$window.off("mouseup.resizable",this._mouseUpHandler).off("mousemove.resizable",this._mousemoveHandler).on("mouseup.resizable",this._mouseUpHandler).on("mousemove.resizable",this._mousemoveHandler),a()("iframe").addClass("dragging-in-progress")}_onMouseUp(e){this.$container.removeClass("resizable-resizing"),this.$window.off("mouseup.resizable",this._mouseUpHandler).off("mousemove.resizable",this._mousemoveHandler),a()("iframe").removeClass("dragging-in-progress"),this._context=null}_onMousemove(e){let t=this._context,s=t.initialBounds.clone(),r=this._calcDistance(t.mousedownEvent,e);u.isOneOf(t.edge,"ne","e","se")?s.width=Math.max(t.minBounds.width,Math.min(t.maxBounds.width,t.initialBounds.width+r[0])):u.isOneOf(t.edge,"nw","w","sw")&&(s.x=Math.min(t.minBounds.x,Math.max(t.maxBounds.x,t.initialBounds.x+r[0])),s.width+=t.initialBounds.x-s.x),u.isOneOf(t.edge,"sw","s","se")?s.height=Math.max(t.minBounds.height,Math.min(t.maxBounds.height,t.initialBounds.height+r[1])):u.isOneOf(t.edge,"nw","n","ne")&&(s.y=Math.min(t.minBounds.y,Math.max(t.maxBounds.y,t.initialBounds.y+r[1])),s.height+=t.initialBounds.y-s.y),a().throttle(this._resizeHandler,Ee.FPS)(s)}_resize(e){this._cropToBoundaries(e),v.setBounds(this.$container,e),this.$container.trigger("resize",{newBounds:e,initialBounds:this._context.initialBounds})}_cropToBoundaries(e){this._boundaryValueSet(this.boundaries.left)&&e.x>this.boundaries.left&&(e.width-=this.boundaries.left-e.x,e.x=this.boundaries.left),this._boundaryValueSet(this.boundaries.right)&&e.x+e.width<this.boundaries.right&&(e.width=this.boundaries.right-e.x),this._boundaryValueSet(this.boundaries.top)&&e.y>this.boundaries.top&&(e.height-=this.boundaries.top-e.y,e.y=this.boundaries.top),this._boundaryValueSet(this.boundaries.bottom)&&e.y+e.height<this.boundaries.bottom&&(e.height=this.boundaries.bottom-e.y)}_boundaryValueSet(e){return e>0}_calcDistance(e,t){let s=t.pageX-e.pageX,r=t.pageY-e.pageY;return[s,r]}}gt(Ee,"MODES",{SOUTH:"s",EAST:"e",WEST:"w",NORTH:"n"}),gt(Ee,"FPS",1e3/15);function py(i,e,t){return e=zM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function zM(i){var e=KM(i,"string");return typeof e=="symbol"?e:String(e)}function KM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Mo extends U{constructor(){super(),py(this,"unsavedForms",void 0),py(this,"openFormsField",void 0),this.unsavedForms=[]}_jsonModel(){return{id:"scout.UnsavedFormChangesForm",type:"model",title:"${textKey:SaveChangesOfSelectedItems}",askIfNeedSave:!1,rootGroupBox:{id:"MainBox",objectType:xe,menus:[{id:"OkMenu",objectType:gu},{id:"CancelMenu",objectType:mu}],fields:[{id:"UnsavedChangesBox",objectType:xe,labelVisible:!1,gridColumnCount:1,fields:[{id:"OpenFormsField",objectType:rh,gridDataHints:{h:5},labelVisible:!1}]}]}}}_init(e){super._init(e),this.openFormsField=this.widget("OpenFormsField",rh),this.openFormsField.setLookupCall(u.create(Nf,{session:this.session,unsavedForms:this.unsavedForms})),this.openFormsField.table.one("rowsInserted",r=>{r.source.checkAll(!0)});let t=u.create(ne,{parent:this.openFormsField.table,id:"CheckAllMenu",menuTypes:[V.MenuTypes.EmptySpace],text:"${textKey:CheckAll}"});t.on("action",r=>this.openFormsField.table.checkAll(!0));let s=u.create(ne,{parent:this.openFormsField.table,id:"UncheckAllMenu",menuTypes:[V.MenuTypes.EmptySpace],text:"${textKey:UncheckAll}"});s.on("action",r=>this.openFormsField.table.uncheckAll()),this.openFormsField.table.setMenus([t,s]),this.on("postLoad",r=>this.touch())}_validate(){let e=this.getInvalidForms();if(e.length>0){let t=[];return t.push("<p><b>",this.session.text("NotAllCheckedFormsCanBeSaved"),"</b></p>"),t.push(this.session.text("FormsCannotBeSaved"),"<br><br>"),e.forEach(s=>t.push("- ",Mo.getFormDisplayName(s),"<br>")),E.error({message:t.join("")})}return E.ok()}getInvalidForms(){let e=[];return this.openFormsField.value.forEach(t=>{let s=t.lifecycle.invalidElements(),r=s.missingElements.slice(),n=s.invalidElements.slice();t.visitDisplayChildren(o=>{let l=o.lifecycle.invalidElements();p.pushAll(r,l.missingElements),p.pushAll(n,l.invalidElements)},o=>o instanceof U),(r.length>0||n.length>0)&&e.push(t)}),e}static getFormDisplayName(e){return[e.title,e.subTitle].filter(Boolean).join(" - ")}}function GM(i,e,t){return e=UM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function UM(i){var e=qM(i,"string");return typeof e=="symbol"?e:String(e)}function qM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Nf extends Vn{constructor(){super(),GM(this,"unsavedForms",void 0),this.unsavedForms=[]}_data(){return this.unsavedForms.map(e=>{let t=Mo.getFormDisplayName(e);return[e,t]})}}function kr(i,e,t){return e=YM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function YM(i){var e=jM(i,"string");return typeof e=="symbol"?e:String(e)}function jM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Vf extends xe{constructor(){super(),kr(this,"table",void 0),kr(this,"groupByField",void 0),kr(this,"sortByField",void 0),kr(this,"isGrouping",void 0),kr(this,"isSorting",void 0),kr(this,"_tableGroupHandler",void 0),kr(this,"_tableSortHandler",void 0),kr(this,"_destroyHandler",void 0),this.table=null,this.labelVisible=!1,this.statusVisible=!1,this.gridColumnCount=7,this.bodyLayoutConfig=si.ensure({hgap:8}),this.groupByField=null,this.sortByField=null,this._tableGroupHandler=this._onTableGroup.bind(this),this._tableSortHandler=this._onTableSort.bind(this),this._destroyHandler=this._uninstallListeners.bind(this)}_installListeners(){this.table.on("group",this._tableGroupHandler),this.table.on("sort",this._tableSortHandler),this.table.one("destroy",this._destroyHandler)}_uninstallListeners(){this.table.off("group",this._tableGroupHandler),this.table.off("sort",this._tableSortHandler)}_init(e){super._init(e),this.table=this.parent,this._installListeners(),this.insertField(u.create(lh,{id:"PlaceholderField",parent:this,gridDataHints:{w:5}})),this.groupByField=u.create(le,{id:"GroupByField",parent:this,label:this.session.text("GroupBy"),labelPosition:A.LabelPosition.ON_FIELD,clearable:me.Clearable.ALWAYS,statusVisible:!1,displayStyle:le.DisplayStyle.DROPDOWN}),this.groupByField.setLookupCall(this._createGroupByLookupCall()),this.groupByField.setVisible(!p.empty(this.groupByField.lookupCall.data)),this.groupByField.on("propertyChange",this._onGroupingChange.bind(this)),this.insertField(this.groupByField),this.sortByField=u.create(le,{id:"SortByField",parent:this,label:this.session.text("SortBy"),labelPosition:A.LabelPosition.ON_FIELD,clearable:me.Clearable.ALWAYS,statusVisible:!1,displayStyle:le.DisplayStyle.DROPDOWN}),this.sortByField.setLookupCall(this._createSortByLookupCall()),this.sortByField.setVisible(!p.empty(this.sortByField.lookupCall.data)),this.sortByField.on("propertyChange",this._onSortingChange.bind(this)),this.insertField(this.sortByField),this._syncSortingGroupingFields()}_findSortByLookupRowForKey(e){return this.sortByField.lookupCall.data.map(s=>s[0]).find(s=>s.column===e.column&&s.asc===e.asc)}_createGroupByLookupCall(){return u.create(Du,{session:this.session,table:this.table})}_createSortByLookupCall(){return u.create(Au,{session:this.session,table:this.table})}_onGroupingChange(e){if(!!this.table.tileMode&&e.propertyName==="value"){if(this.isGrouping=!0,e.newValue!==null){let t=e.newValue,s=t.sortIndex>=0&&!t.sortAscending?"desc":"asc";this.table.groupColumn(t,!1,s,!1)}else{let t=e.oldValue;this.table.groupColumn(t,!1,null,!0)}this.isGrouping=!1}}_onSortingChange(e){if(!!this.table.tileMode&&e.propertyName==="value"){if(this.isSorting=!0,e.newValue!==null){let t=e.newValue;this.table.sort(t.column,t.asc?"asc":"desc",!1,!1)}else{let t=e.oldValue;this.table.sort(t.column,null,!1,!0)}this.isSorting=!1}}_syncSortingGroupingFields(){let e=p.find(this.table.visibleColumns(),s=>s.grouped&&s.sortIndex===0);e?this.groupByField.setValue(e):this.groupByField.setValue(null);let t=p.find(this.table.visibleColumns(),s=>s.sortActive&&s.sortIndex===0);t?this.sortByField.setValue(this._findSortByLookupRowForKey({column:t,asc:t.sortAscending})):this.sortByField.setValue(null)}_onTableGroup(e){this.isGrouping||this._syncSortingGroupingFields()}_onTableSort(e){this.isSorting||this._syncSortingGroupingFields()}}class fy extends te{init(e){return super.init(e)}_prepareEssentials(e){At.get().init()}_doBootstrap(e){return[]}_init(e){return e=e||{},e.texts=a().extend({},Ce.readFromDOM(),e.texts),this._prepareDOM(),u.create(Dl,e).render(a()("body").addClass("login-body")),a().resolvedPromise()}}function hi(i,e,t){return e=XM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function XM(i){var e=JM(i,"string");return typeof e=="symbol"?e:String(e)}function JM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Dl extends ha{constructor(){super(),hi(this,"ajaxOptions",void 0),hi(this,"authUrl",void 0),hi(this,"onPostDoneFunc",void 0),hi(this,"redirectUrl",void 0),hi(this,"userDataKey",void 0),hi(this,"passwordDataKey",void 0),hi(this,"additionalData",void 0),hi(this,"prepareRedirectUrlFunc",void 0),hi(this,"messageKey",void 0),hi(this,"texts",void 0),hi(this,"$message",void 0),hi(this,"$form",void 0),hi(this,"$user",void 0),hi(this,"$password",void 0),hi(this,"$button",void 0),this.ajaxOptions={type:"POST"},this.authUrl="auth",this.onPostDoneFunc=this.redirect.bind(this),this.redirectUrl=null,this.logoUrl="logo.png",this.userDataKey="user",this.passwordDataKey="password",this.additionalData={},this.prepareRedirectUrlFunc=Dl.prepareRedirectUrl,this.messageKey=null,this.texts=null,this.$message=null,this.$form=null,this.$user=null,this.$password=null,this.$button=null}init(e){e=e||{};let t=a().extend({"ui.Login":"Login","ui.LoginFailed":"Login failed","ui.User":"Username","ui.Password":"Password"},e.texts);delete e.texts,e.ajaxOptions=a().extend(this.ajaxOptions,e.ajaxOptions),a().extend(this,e),this.texts=new Os(t)}_render(){super._render(),this.$container.addClass("login-box"),this.$content.addClass("login-box-content "),this.$form=a()("<form>").attr("action",this.authUrl).attr("method","post").on("submit",this._onLoginFormSubmit.bind(this)).appendTo(this.$content),this.messageKey&&(this.$message=a()("<div>").attr("id","message-box").addClass("message-box").html(y.nl2br(this.texts.get(this.messageKey))).appendTo(this.$form)),this.$user=a()("<input>").attr("type","text").attr("autocapitalize","off").attr("autocorrect","off").placeholder(this.texts.get("ui.User")).appendTo(this.$form),this.$password=a()("<input>").attr("type","password").placeholder(this.texts.get("ui.Password")).appendTo(this.$form),this.$button=a()("<button>").attr("type","submit").addClass("login-button button default").text(this.texts.get("ui.Login")).appendTo(this.$form),this.$user.focus()}_resetButtonText(){this.$button.text(this.texts.get("ui.Login")).removeClass("login-error")}data(){let e={};return e[this.userDataKey]=this.$user.val(),e[this.passwordDataKey]=this.$password.val(),a().extend(e,this.additionalData),e}_onLoginFormSubmit(e){e.preventDefault();let t=this.$form.attr("action"),s=this.data();this.$button.removeClass("login-error").setEnabled(!1),this.$user.off("input.resetLoginError"),this.$password.off("input.resetLoginError"),x.get().supportsCssAnimation()&&this.$button.html("").append(a()("<div>").addClass("login-button-loading"));let r=a().extend({},this.ajaxOptions,{url:t,data:s});a().ajax(r).done(this._onPostDone.bind(this)).fail(this._onPostFail.bind(this))}redirect(e){this.$backgroundElements.addClass("box-background-elements-fadeout"),x.get().supportsCssAnimation()?this.$backgroundElements.oneAnimationEnd(()=>{this._redirect(e)}):this._redirect(e)}_redirect(e){let t=this.redirectUrl;t||(t=(window.location.href||"").trim(),t=this.prepareRedirectUrlFunc(t)),t?window.location.href=t:window.location.reload()}_onPostDone(e){this.remove(),this.onPostDoneFunc.call(this,e)}_onPostFail(e,t,s){setTimeout(this._onPostFailImpl.bind(this,e,t,s),300)}_onPostFailImpl(e,t,s){this.$button.setEnabled(!0).html("").text(this.texts.get("ui.LoginFailed")).addClass("login-error"),this.$user.val("").focus(),this.$password.val(""),this.$user.one("input.resetLoginError",this._resetButtonText.bind(this)),this.$password.one("input.resetLoginError",this._resetButtonText.bind(this))}static prepareRedirectUrl(e){let t=/^([^?#]*)(\?[^#]*)?(#.*)?$/.exec(e||"");return t[1].replace(/login.html$/,"").replace(/login$/,"").replace(/logout$/,"")+(t[2]?t[2]:"")+(t[3]?t[3]:"")}}class my extends te{_prepareEssentials(e){At.get().init()}_doBootstrap(e){return[]}_init(e){return e=e||{},e.texts=a().extend({},Ce.readFromDOM(),e.texts),this._prepareDOM(),u.create(Wf,e).render(a()("body").addClass("logout-body")),a().resolvedPromise()}}function Lh(i,e,t){return e=QM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function QM(i){var e=ZM(i,"string");return typeof e=="symbol"?e:String(e)}function ZM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Wf extends ha{constructor(){super(),Lh(this,"texts",void 0),Lh(this,"loginUrl",void 0),Lh(this,"options",void 0),Lh(this,"$buttonBar",void 0),this.texts=null,this.loginUrl=null,this.options=null,this.$buttonBar=null}init(e){let t={loginUrl:Se.getItemFromSessionStorage("scout:loginUrl")||"./",logoUrl:"logo.png"};this.options=a().extend({},t,e);let s={"ui.LogoutSuccessful":"Good bye!","ui.LoginAgain":"Login again"};this.options.texts=a().extend({},s,e.texts),this.texts=new Os(this.options.texts),this.loginUrl=this.options.loginUrl,this.logoUrl=this.options.logoUrl}_render(){super._render(),this.$content.addClass("small centered").appendDiv().html(y.nl2br(this.texts.get("ui.LogoutSuccessful"))),this.$buttonBar=a()("<div>").addClass("button-bar").appendTo(this.$content),a()("<button>").addClass("button").text(this.texts.get("ui.LoginAgain")).on("click",this._loginAgain.bind(this)).appendTo(this.$buttonBar)}_loginAgain(){window.location.href=this.loginUrl}}function eI(i,e,t){return e=tI(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function tI(i){var e=iI(i,"string");return typeof e=="symbol"?e:String(e)}function iI(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class zf extends re{constructor(){super(),eI(this,"ref",void 0),this.ref=null}_render(){super._render(),this.$container.addClass("breadcrumb-item")}_renderText(){const e=this.text||"";e&&this.textVisible?(this.$text||(this.$text=this.$container.appendSpan("content text"),T.install(this.$text,this.session)),this.$text.text(e)):this._removeText()}}class gy extends br{}function _y(i,e,t){return e=sI(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function sI(i){var e=rI(i,"string");return typeof e=="symbol"?e:String(e)}function rI(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class yy extends I{constructor(){super(),_y(this,"breadcrumbItems",void 0),_y(this,"ellipsisBreadcrumbItem",void 0),this.breadcrumbItems=[],this.ellipsisBreadcrumbItem=null,this._addWidgetProperties(["breadcrumbItems"])}_init(e){super._init(e),this._setBreadcrumbItems(this.breadcrumbItems)}_render(){this.$container=this.$parent.appendDiv("breadcrumb-bar"),this.htmlComp=T.install(this.$container,this.session),this.htmlComp.setLayout(new Kf(this))}_renderProperties(){super._renderProperties(),this._renderBreadcrumbItems()}setBreadcrumbItems(e){this.setProperty("breadcrumbItems",e)}_setBreadcrumbItems(e){this._setProperty("breadcrumbItems",p.ensure(e))}_renderBreadcrumbItems(){this.breadcrumbItems.forEach((e,t)=>{t===1&&this._renderEllipsis(),e.render()}),this._updateMarkers(),this.htmlComp.invalidateLayoutTree()}_renderEllipsis(){this.ellipsisBreadcrumbItem&&this.ellipsisBreadcrumbItem.destroy(),!(this.breadcrumbItems.length<=2)&&(this.ellipsisBreadcrumbItem=u.create(zf,{parent:this,text:"...",enabled:!1}),this.ellipsisBreadcrumbItem.render())}_updateMarkers(){const e=[];this.breadcrumbItems.forEach(t=>{t.rendered&&(t.$container.removeClass("first last"),t.isVisible()&&e.push(t))}),e.length&&(e[0].$container.addClass("first"),e[e.length-1].$container.addClass("last"))}}function nI(i,e,t){return e=oI(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function oI(i){var e=lI(i,"string");return typeof e=="symbol"?e:String(e)}function lI(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Kf extends ee{constructor(e){super(),nI(this,"_breadcrumbBar",void 0),this._breadcrumbBar=e}layout(e){this._undoCollapse();const t=this._visibleBreadcrumbItems(),r=this._breadcrumbBar.htmlComp.size();if(this._actualPrefSize(t,!1).width<=r.width){this._applyToEllipsis(o=>o.setVisible(!1));return}this._applyToEllipsis(o=>o.setVisible(!0)),this._collapse(r)}_collapse(e){let t=1;const s=this._visibleBreadcrumbItems();let r=this._actualPrefSize(s,!0);for(;r.width>e.width&&t<s.length-1;)s[t].$container.hide(),s.splice(t,1),r=this._actualPrefSize(s,!0)}_applyToEllipsis(e){this._breadcrumbBar.ellipsisBreadcrumbItem&&e(this._breadcrumbBar.ellipsisBreadcrumbItem)}_undoCollapse(){p.ensure(this._breadcrumbBar.breadcrumbItems).forEach(e=>{e.$container.show()})}preferredLayoutSize(e,t){return this._undoCollapse(),this._actualPrefSize()}_visibleBreadcrumbItems(){return this._breadcrumbBar.breadcrumbItems.filter(e=>e.visible)}_actualPrefSize(e,t){e=e||this._visibleBreadcrumbItems();const s=this._breadcrumbItemsWidth(e,t),r=v.prefSize(this._breadcrumbBar.$container,{includeMargin:!0,useCssSize:!0});return r.width=s+this._breadcrumbBar.htmlComp.insets().horizontal(),r}_breadcrumbItemsWidth(e,t){let s=0;return e=e||this._visibleBreadcrumbItems(),e.forEach(r=>{r.rendered&&(s+=r.$container.outerWidth(!0))}),t&&this._breadcrumbBar.ellipsisBreadcrumbItem&&this._breadcrumbBar.ellipsisBreadcrumbItem.rendered&&(s+=this._breadcrumbBar.ellipsisBreadcrumbItem.$container.outerWidth(!0)),s}}class by extends ke{}function aI(i,e,t){return e=hI(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function hI(i){var e=dI(i,"string");return typeof e=="symbol"?e:String(e)}function dI(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class vy extends A{constructor(){super(),aI(this,"breadcrumbBar",void 0),this.breadcrumbBar=null,this._addWidgetProperties(["breadcrumbBar"])}_render(){this.addContainer(this.$parent,"breadcrumb-bar-field"),this.addLabel(),this.addMandatoryIndicator(),this.addStatus(),this._renderBreadcrumbBar()}setBreadcrumbItems(e){!this.breadcrumbBar||this.breadcrumbBar.setBreadcrumbItems(e)}setBreadcrumbBar(e){this.setProperty("breadcrumbBar",e)}_renderBreadcrumbBar(){!this.breadcrumbBar||(this.breadcrumbBar.render(),this.addField(this.breadcrumbBar.$container),this.invalidateLayoutTree())}_removeBreadcrumbBar(){!this.breadcrumbBar||(this.breadcrumbBar.remove(),this._removeField(),this.invalidateLayoutTree())}}class wy extends at{}function Al(i,e,t){return e=uI(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function uI(i){var e=cI(i,"string");return typeof e=="symbol"?e:String(e)}function cI(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class vs extends I{constructor(){super(),Al(this,"uuids",void 0),Al(this,"size",void 0),Al(this,"refillThreshold",void 0),Al(this,"failOnStarvation",void 0),Al(this,"refillInProgress",void 0),this.uuids=[],this.size=100,this.refillThreshold=25,this.failOnStarvation=!1,this.refillInProgress=!1}take(){if(!this.uuids.length){if(this.failOnStarvation)throw new Error("UUID pool exhausted");return this.generateUuid()}let e=this.uuids.shift();return this.uuids.length<=this.refillThreshold&&this.refill(),e}refill(){let e=this.size-this.uuids.length;e>0&&this.fill(e)}fill(e){this.trigger("refill",{count:e})}generateUuid(){let e=Date.now()+(performance?performance.now():0);return"zzzzzzzz-zzzz-4zzz-yzzz-zzzzzzzzzzzz".replace(/[zy]/g,t=>{let s=(e+Math.random()*16)%16|0;return e=Math.floor(e/16),(t==="z"?s:s&3|8).toString(16)})}static _createInstance(e){return u.create(vs,{parent:e})}static installDesktopAddOn(){te.addListener("desktopReady",e=>{let t=e.desktop;t.addOns.some(s=>s instanceof vs)||t.addOns.push(vs._createInstance(t))})}static get(e){return e=e||te.get().sessions[0],u.assertParameter("session",e),p.find(e.desktop.addOns,s=>s instanceof vs)||vs._createInstance(e.desktop)}static take(e){return vs.get(e).take()}}vs.installDesktopAddOn();function pI(i,e,t){return e=fI(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function fI(i){var e=mI(i,"string");return typeof e=="symbol"?e:String(e)}function mI(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}class Ty extends ke{constructor(){super(),pI(this,"refillInProgress",void 0),this.refillInProgress=!1}_onWidgetEvent(e){e.type==="refill"?this._onWidgetRefill(e):super._onWidgetEvent(e)}_onWidgetRefill(e){this.refillInProgress||(this.refillInProgress=!0,this._send("refill",{count:e.count},{showBusyIndicator:!1}))}onModelAction(e){e.type==="refill"?this._onModelRefill(e):super.onModelAction(e)}_onModelRefill(e){p.pushAll(this.widget.uuids,e.uuids),this.refillInProgress=!1}}function gI(i){if(!i||t(i.style))return!1;let e=(i instanceof Document?i:i.ownerDocument).defaultView;if(!e||t(e.getComputedStyle(i)))return!1;return!0;function t(s){return s.display==="none"}}function _I(i){let e=[];return i.forEach(t=>{t==="margin"||t==="padding"?(e.push(t+"-top"),e.push(t+"-right"),e.push(t+"-bottom"),e.push(t+"-left")):t==="border"?(e.push("border-top-style"),e.push("border-right-style"),e.push("border-bottom-style"),e.push("border-left-style"),e.push("border-top-color"),e.push("border-right-color"),e.push("border-bottom-color"),e.push("border-left-color"),e.push("border-top-width"),e.push("border-right-width"),e.push("border-bottom-width"),e.push("border-left-width")):e.push(t)}),e}function Oh(i){return b.isNumber(i)?Math.ceil(i):i}const yI=a().cleanData;a().cleanData=i=>{let e,t,s;for(s=0;t=i[s];s++)try{e=a()._data(t,"events"),e&&e.remove&&a()(t).triggerHandler("remove")}catch{}yI(i)},a().ensure=i=>i instanceof a()?i:a()(i),a().suppressEvent=i=>{i&&(i.preventDefault(),i.stopPropagation(),i.stopImmediatePropagation())},a().debounce=(i,e)=>{typeof e=="number"&&(e={delay:e}),e=a().extend({delay:250,reschedule:!0},e);let t=null,s=function(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];let l=this;t&&!e.reschedule||(t&&clearTimeout(t),t=setTimeout(()=>{t=null,i.apply(l,n)},e.delay))};return s.cancel=()=>t?(clearTimeout(t),t=null,!0):!1,s},a().throttle=(i,e)=>{e=e!==void 0?e:250;let t=null,s;return function(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];let l=this,h=new Date().getTime(),d=()=>{s=h,i.apply(l,n)};s&&s+e>h?(clearTimeout(t),t=setTimeout(()=>{d()},e)):d()}},a().negate=i=>function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return!i.apply(this,t)},a().injectScript=(i,e)=>{e=e||{};let t=a().Deferred(),s=e.document||window.document,r=s.createElement("script");return a()(r).attr("src",i).attr("async",!0).on("load error",n=>{e.removeTag&&s.head.removeChild(r),n.type==="error"?t.reject(a()(r)):t.resolve(a()(r))}),s.head.appendChild(r),t.promise()},a().injectStyleSheet=(i,e)=>{e=e||{};let t=a().Deferred(),s=e.document||window.document,r=s.createElement("link");return a()(r).attr("rel","stylesheet").attr("type","text/css").attr("href",i).on("load error",n=>{n.type==="error"?t.reject(a()(r)):t.resolve(a()(r))}),s.head.appendChild(r),t.promise()},a().injectStyle=(i,e)=>{e=e||{};let t=e.document||window.document,s=t.createElement("style"),r=a()(s);return r.attr("type","text/css").html(i),t.head.appendChild(s),r},a().pxToNumber=i=>i?parseFloat(i):0,a().resolvedDeferred=function(){let i=a().Deferred();return i.resolve(...arguments),i},a().resolvedPromise=function(){let i=a().Deferred();return i.resolve(...arguments),i.promise()},a().rejectedPromise=function(){let i=a().Deferred();return i.reject(...arguments),i.promise()},a().promiseAll=(i,e)=>{e=u.nvl(e,!1),i=p.ensure(i);let t=a().Deferred();return a().when(...i).done(function(){for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];e?t.resolve(r):t.resolve(...r)}).fail(function(){t.reject(...arguments)}),t.promise()},a().ajaxJson=i=>a().ajax({url:i,dataType:"json",contentType:"application/json; charset=UTF-8"}).catch(function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.push(this),a().rejectedPromise(...t)}),a().isJqXHR=i=>typeof i=="object"&&i.hasOwnProperty("readyState")&&i.hasOwnProperty("status")&&i.hasOwnProperty("statusText"),a().fn.nvl=function(i){return this.length||!(i instanceof a())?this:i},a().fn.makeElement=function(i,e,t){let s=this.document(!0);if(s===void 0||i===void 0)throw new Error("missing arguments: document, element");let r=a()(i,s);return e&&r.addClass(e),t&&r.text(t),r},a().fn.makeDiv=function(i,e){return this.makeElement("<div>",i,e)},a().fn.makeSpan=function(i,e){return this.makeElement("<span>",i,e)},a().fn.document=function(i){let e=this.length?this[0]instanceof Document?this[0]:this[0].ownerDocument:null;return i?e:a()(e)},a().fn.window=function(i){let e=this.document(!0),t=e?e.defaultView:null;return i?t:a()(t)},a().fn.activeElement=function(i){let e=this.document(!0),t=e?e.activeElement:null;return i?t:a()(t)},a().fn.body=function(i){let e=a()("body",this.document(!0));return i?e[0]:e},a().fn.entryPoint=function(i){let e=this.closest(".scout");return i?e[0]:e},a().fn.windowSize=function(){let i=this.window();return new F(i.width(),i.height())},a().fn.elementFromPoint=function(i,e,t){let s=a()(this),r=s.document(!0),n=[],o=0,l;if(r||(r=s[0]),!r)return a()();for(;l=a()(r.elementFromPoint(i,e)),!(l.length===0||l[0]===r.documentElement||s.isOrHas(l)&&(!t||l.is(t)));)if(n.push(l),l.addClass("invisible"),o++,o>1e3){a().log.warn("Infinite loop aborted",l),l=a()();break}return l[0]===r.documentElement&&s[0]!==r&&(l=a()()),n.forEach(h=>{h.removeClass("invisible")}),l},a().fn.prependDiv=function(i,e){return this.makeDiv(i,e).prependTo(this)},a().fn.appendDiv=function(i,e){return this.makeDiv(i,e).appendTo(this)},a().fn.prependElement=function(i,e,t){return this.makeElement(i,e,t).prependTo(this)},a().fn.appendElement=function(i,e,t){return this.makeElement(i,e,t).appendTo(this)},a().fn.afterDiv=function(i,e){return this.makeDiv(i,e).insertAfter(this)},a().fn.beforeDiv=function(i,e){return this.makeDiv(i,e).insertBefore(this)},a().fn.appendSpan=function(i,e){return this.makeSpan(i,e).appendTo(this)},a().fn.appendBr=function(i){return this.makeElement("<br>",i).appendTo(this)},a().fn.appendTable=function(i){return this.appendElement("<table>",i)},a().fn.appendColgroup=function(i){return this.appendElement("<colgroup>",i)},a().fn.appendCol=function(i){return this.appendElement("<col>",i)},a().fn.appendTr=function(i){return this.appendElement("<tr>",i)},a().fn.appendTd=function(i,e){return this.appendElement("<td>",i,e)},a().fn.appendTh=function(i,e){return this.appendElement("<th>",i,e)},a().fn.appendUl=function(i){return this.appendElement("<ul>",i)},a().fn.appendLi=function(i,e){return this.appendElement("<li>",i,e)},a().fn.appendTextNode=function(i){return a()(this.document(!0).createTextNode(i)).appendTo(this)},a().fn.appendIcon=function(i,e){if(!i)return this.appendSpan(e).addClass("icon");let t;return i instanceof ni?t=i:t=ye.parseIconId(i),t.isFontIcon()?this.makeSpan(e,t.iconCharacter).addClass("icon").addClass(t.appendCssClass("font-icon")).appendTo(this):this.appendImg(t.iconUrl,e).addClass("icon image-icon")},a().fn.appendImg=function(i,e){let t=this.appendElement("<img>",e);return i&&t.attr("src",i),t},a().fn.icon=function(i,e){let t,s=this.data("$icon");return i?(t=ye.parseIconId(i),t.isFontIcon()?r.call(this,s,"<span>",e).addClass("icon").addClass(t.appendCssClass("font-icon")).text(t.iconCharacter):r.call(this,s,"<img>",e).attr("src",t.iconUrl).addClass("icon image-icon")):n.call(this,s),this;function r(o,l,h){return o&&!o.is(l.replace(/[<>]/g,""))&&(n.call(this,o),o=null),o||(o=a()(l),this.data("$icon",o),h?h.call(this,o):this.prepend(o)),o}function n(o){o&&o.remove(),this.removeData("$icon")}},a().fn.makeSVG=function(i,e,t,s){let r=this.document(!0);if(r===void 0||i===void 0)return new Error("missing arguments: document, type");let n=a()(r.createElementNS("http://www.w3.org/2000/svg",i));return e&&n.attr("class",e),t&&n.text(t),s!==void 0&&n.attr("id",s),n},a().fn.appendSVG=function(i,e,t,s){return this.makeSVG(i,e,t,s).appendTo(this)},a().fn.attrXLINK=function(i,e){return this.length===0?this:this.length===1?(this[0].setAttributeNS("http://www.w3.org/1999/xlink","xlink:"+i,e),this):this.each(function(){this.setAttributeNS("http://www.w3.org/1999/xlink","xlink:"+i,e)})},a().fn.appendAppLink=function(i,e){return this.appendSpan().appLink(i,e)},a().fn.appLink=function(i,e){return e?typeof e=="object"&&e._onAppLinkAction&&(e=e._onAppLinkAction.bind(e)):e=function(t){let s=u.widget(this);s&&s._onAppLinkAction&&s._onAppLinkAction(t)}.bind(this),this.addClass("app-link").attr("tabindex","0").unfocusable().on("click",e),typeof i=="string"?this.attr("data-ref",i):this.text(i.name).attr("data-ref",i.ref),this},a().fn.addDeviceClass=function(){return x.get().isIos()&&this.addClass("ios"),this},a().fn.selectOne=function(){return this.siblings().removeClass("selected"),this.addClass("selected"),this},a().fn.select=function(i){return this.toggleClass("selected",!!i)},a().fn.isSelected=function(){return this.hasClass("selected")},a().fn.setEnabled=function(i){return i=!!i,this.toggleClass("disabled",!i),this.is("button, input, select, textarea, optgroup, option, fieldset")&&this.toggleAttr("disabled",!i),this.trigger(i?"enable":"disable"),this},a().fn.isEnabled=function(){return!this.hasClass("disabled")},a().fn.setVisible=function(i){return!this.hasClass("hidden")===i?this:(i?(this.removeClass("hidden"),this.trigger("show")):(this.addClass("hidden"),this.trigger("hide")),this)},a().fn.isVisible=function(){return this.hasClass("hidden")?!1:gI(this[0])},a().fn.isEveryParentVisible=function(){let i=!0;return this.parents().each(function(){if(!a()(this).isVisible())return i=!1,!1}),i},a().fn.isDisplayNone=function(){return this.css("display")==="none"},a().fn.setTabbable=function(i){return this.attr("tabIndex",i?0:null)},a().fn.setTabbableOrFocusable=function(i){return this.attr("tabIndex",i?0:-1)},a().fn.isTabbable=function(){return this.attr("tabIndex")>=0},a().fn.placeholder=function(i){return this.toggleAttr("placeholder",!!i,i)},a().fn.isAttached=function(){return a().contains(this.document(!0).documentElement,this[0])},a().fn.scrollParent=function(){let i=this;for(;i.length>0;){if(i.data("scrollable"))return i;i=i.parent()}return a()()},a().fn.scrollParents=function(){let i=a()(),e=this;for(;e.length>0;)e.data("scrollable")&&i.push(e),e=e.parent();return i},a().fn.findUp=function(i,e){let t=a()(this);for(;t.length>0;){if(i(t))return t;if(e&&t[0]===e[0])return a()();t=t.parent()}return a()()},a().fn.isOrHas=function(i){return i instanceof a()&&(i=i[0]),this[0]===i||this.has(i).length>0},a().fn.animateAVCSD=function(i,e,t,s,r){let n={},o={};return n[i]=e,t&&(o.complete=t),s&&(o.step=s),r&&(o.duration=r),o.queue=!1,this.animate(n,o),this},a().fn.animateSVG=function(i,e,t,s,r){return this.each(function(){let n=parseFloat(a()(this).attr(i));if(r){let o=s;s=function(){o&&o.call(this),a()(this).removeAttr("tabindex")}}a()(this).animate({tabIndex:0},{step:function(o,l){this.setAttribute(i,n+(e-n)*l.pos)},duration:t,complete:s,queue:!1})})},a().fn.addClassForAnimation=function(i,e){let t={classesToRemove:i};return e=a().extend({},t,e),this.addClass(i),this.oneAnimationEnd(s=>{this.removeClass(e.classesToRemove)}),this},a().fn.oneAnimationEnd=function(i){if(!i)return this;let e=t=>{t.target===this[0]&&(this.off("animationend webkitAnimationEnd",e),i(t))};return this.on("animationend webkitAnimationEnd",e)},a().fn.hasAnimationClass=function(){return/(^|\s)animate-/.test(this.attr("class"))},a().fn.cssWidthAnimated=function(i,e,t){return t=t||{},t.duration=u.nvl(t.duration,300),this.cssWidth(i),this.animate({width:e},t),this},a().fn.cssHeightAnimated=function(i,e,t){return t=t||{},t.duration=u.nvl(t.duration,300),this.cssHeight(i),this.animate({height:e},t),this},a().fn.cssLeftAnimated=function(i,e,t){return t=t||{},t.duration=u.nvl(t.duration,300),this.cssLeft(i),this.animate({left:e},t),this},a().fn.cssTopAnimated=function(i,e,t){return t=t||{},t.duration=u.nvl(t.duration,300),this.cssTop(i),this.animate({top:e},t),this},a().fn.cssAnimated=function(i,e,t){return t=t||{},t.duration=u.nvl(t.duration,300),this.css(i),this.animate(e,t),this},a().fn.cssWidthToContentAnimated=function(i){let e=this.outerWidth(),t=this.css("width","auto").outerWidth();return this.cssWidthAnimated(e,t,i),this},a().fn.offsetTo=function(i){let e=i.offset(),t=this.offset();return{top:t.top-e.top,left:t.left-e.left}},a().fn.cssPxValue=function(i,e){return e===void 0?a().pxToNumber(this.css(i)):(e===null&&(e=""),typeof e=="string"?this.css(i,e):this.css(i,e+"px"))},a().fn.cssLeft=function(i){return this.cssPxValue("left",i)},a().fn.cssTop=function(i){return this.cssPxValue("top",i)},a().fn.cssPosition=function(i){return this.cssLeft(i.x).cssTop(i.y)},a().fn.cssBottom=function(i){return this.cssPxValue("bottom",i)},a().fn.cssRight=function(i){return this.cssPxValue("right",i)},a().fn.cssWidth=function(i){return this.cssPxValue("width",i)},a().fn.cssMinWidth=function(i){if(i===void 0){let e=this.css("min-width");return e==="auto"||e.indexOf("%")!==-1?0:a().pxToNumber(e)}return this.cssPxValue("min-width",i)},a().fn.cssMaxWidth=function(i){if(i===void 0){let e=this.css("max-width");return e==="none"||e.indexOf("%")!==-1?Number.MAX_VALUE:a().pxToNumber(e)}return this.cssPxValue("max-width",i)},a().fn.cssHeight=function(i){return this.cssPxValue("height",i)},a().fn.cssMinHeight=function(i){if(i===void 0){let e=this.css("min-height");return e==="auto"||e.indexOf("%")!==-1?0:a().pxToNumber(e)}return this.cssPxValue("min-height",i)},a().fn.cssMaxHeight=function(i){if(i===void 0){let e=this.css("max-height");return e==="none"||e.indexOf("%")!==-1?Number.MAX_VALUE:a().pxToNumber(e)}return this.cssPxValue("max-height",i)},a().fn.cssLineHeight=function(i){return this.cssPxValue("line-height",i)},a().fn.cssMarginLeft=function(i){return this.cssPxValue("margin-left",i)},a().fn.cssMarginBottom=function(i){return this.cssPxValue("margin-bottom",i)},a().fn.cssMarginRight=function(i){return this.cssPxValue("margin-right",i)},a().fn.cssMarginTop=function(i){return this.cssPxValue("margin-top",i)},a().fn.cssMarginX=function(i){return i===void 0?this.cssMarginLeft()+this.cssMarginRight():(this.cssMarginLeft(i),this.cssMarginRight(i),this)},a().fn.cssMarginY=function(i){return i===void 0?this.cssMarginTop()+this.cssMarginBottom():(this.cssMarginTop(i),this.cssMarginBottom(i),this)},a().fn.cssPaddingTop=function(i){return this.cssPxValue("padding-top",i)},a().fn.cssPaddingRight=function(i){return this.cssPxValue("padding-right",i)},a().fn.cssPaddingBottom=function(i){return this.cssPxValue("padding-bottom",i)},a().fn.cssPaddingLeft=function(i){return this.cssPxValue("padding-left",i)},a().fn.cssPaddingX=function(i){return i===void 0?this.cssPaddingLeft()+this.cssPaddingRight():(this.cssPaddingLeft(i),this.cssPaddingRight(i),this)},a().fn.cssPaddingY=function(i){return i===void 0?this.cssPaddingTop()+this.cssPaddingBottom():(this.cssPaddingTop(i),this.cssPaddingBottom(i),this)},a().fn.cssBorderBottomWidth=function(i){return this.cssPxValue("border-bottom-width",i)},a().fn.cssBorderLeftWidth=function(i){return this.cssPxValue("border-left-width",i)},a().fn.cssBorderRightWidth=function(i){return this.cssPxValue("border-right-width",i)},a().fn.cssBorderTopWidth=function(i){return this.cssPxValue("border-top-width",i)},a().fn.cssBorderWidthY=function(i){return i===void 0?this.cssBorderTopWidth()+this.cssBorderBottomWidth():(this.cssBorderTopWidth(i),this.cssBorderBottomWidth(i))},a().fn.cssBorderWidthX=function(i){return i===void 0?this.cssBorderLeftWidth()+this.cssBorderRightWidth():(this.cssBorderLeftWidth(i),this.cssBorderRightWidth(i))},a().fn.innerBottom=function(){return this.position().top+this.outerHeight(!0)-this.cssMarginBottom()-this.cssBorderBottomWidth()},a().fn.innerRight=function(){return this.position().left+this.outerWidth(!0)-this.cssMarginRight()-this.cssBorderRightWidth()},a().fn.copyCss=function(i,e){let t=e.split(" "),s=this;return t=_I(t),t.forEach(r=>{s.css(r,i.css(r))}),s},a().fn.copyCssClasses=function(i,e){let t=e.split(" "),s=this;return t.forEach(r=>{i.hasClass(r)&&s.addClass(r)}),s},a().fn.disableSpellcheck=function(){return this.attr("spellcheck",!1)},a().fn.resizable=function(i){let e=a()(this),t=e.data("resizable");return t?this:(t=u.create(Ee,a().extend(i,{$container:e})),e.data("resizable",t),this)},a().fn.unresizable=function(){let i=a()(this),e=i.data("resizable");return e&&(e.destroy(),i.removeData("resizable")),this},a().fn.draggable=function(i,e){let t=this;return i=i||t,i.on("mousedown.draggable",s=>{a()("iframe").addClass("dragging-in-progress");let r=t.offset(),n=s,o=i.width(),l=i.window().width(),h=i.window().height();i.parents().on("mousemove.dragging",d=>{let c=r.top+(d.pageY-n.pageY),f=r.left+(d.pageX-n.pageX);f=Math.max(100-o,f),f=Math.min(l-100,f),c=Math.max(0,c),c=Math.min(h-100,c);let m={top:c,left:f};t.offset(m),e&&e(m)}).on("mouseup.dragging",d=>{i.parents().off(".dragging"),a()("iframe").removeClass("dragging-in-progress")}),s.preventDefault()})},a().fn.undraggable=function(i){return i=i||this,i.off("mousedown.draggable")},a().fn.fadeOutAndRemove=function(i,e){return e===void 0&&typeof i=="function"&&(e=i,i=void 0),i=u.nvl(i,150),this.stop(!0).fadeOut(i,function(){a()(this).remove(),e&&e.call(this)})},a().fn.removeAnimated=function(i,e){e===void 0&&typeof i=="function"&&(e=i,i=void 0),this.isDisplayNone()?(this.remove(),e&&e.call(this)):x.get().supportsCssAnimation()?(this.addClass(i||"animate-remove"),this.oneAnimationEnd(function(){a()(this).remove(),e&&e.call(this)})):this.fadeOutAndRemove(e)};const bI=a().fn.hide;a().fn.hide=function(){this.trigger("hide");for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];return bI.apply(this,e)};const vI=a().fn.width;a().fn.width=function(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];return Oh(vI.apply(this,e))};const wI=a().fn.outerWidth;a().fn.outerWidth=function(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];return Oh(wI.apply(this,e))};const TI=a().fn.height;a().fn.height=function(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];return Oh(TI.apply(this,e))};let CI=a().fn.outerHeight;a().fn.outerHeight=function(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];return Oh(CI.apply(this,e))},a().fn.textOrNbsp=function(i,e){return this.contentOrNbsp(!1,i,e)},a().fn.htmlOrNbsp=function(i,e){return this.contentOrNbsp(!0,i,e)},a().fn.contentOrNbsp=function(i,e,t){let s=i?this.html:this.text;return y.hasText(e)?(s.call(this,e),t&&this.removeClass(t)):(this.html("&nbsp;"),t&&this.addClass(t)),this},a().fn.toggleAttr=function(i,e,t){return i?(t===void 0&&(t=i),this.each(function(){let s=a()(this);e===void 0&&(e=s.attr(i)===void 0),e?s.attr(i,t):s.removeAttr(i)})):this},a().fn.attrOrRemove=function(i,e){return e?this.attr(i,e):this.removeAttr(i),this},a().fn.unfocusable=function(){return this.addClass("unfocusable")},a().fn.selectAllText=function(){let i,e=this.document(!0),t=this.window(!0),s=this[0];return!e||!e.body||!t||!s?this:(t.getSelection&&(i=e.createRange(),i.selectNodeContents(s),t.getSelection().removeAllRanges(),t.getSelection().addRange(i)),this)},a().fn._getClientAndScrollWidthRounded=function(){let i=this[0];return x.get().isEdge()?{clientWidth:Math.ceil(i.getBoundingClientRect().width)-this.cssBorderWidthX(),scrollWidth:i.scrollWidth}:{clientWidth:i.clientWidth,scrollWidth:i.scrollWidth}},a().fn._getClientAndScrollWidthReliable=function(){let i=this._getClientAndScrollWidthRounded();if(!x.get().isScrollWidthIncludingPadding()||i.scrollWidth>i.clientWidth)return i;let e=this.cssPaddingRight(),t=this.attr("style");if(e>0&&(this.css({width:i.clientWidth-e,paddingRight:"0px"}),i=this._getClientAndScrollWidthRounded(),this.attrOrRemove("style",t),i.scrollWidth>i.clientWidth))return i;let s=this[0].getBoundingClientRect().width;this.css("width","auto"),this.css("max-width","none");let r=this[0].getBoundingClientRect().width;return this.attrOrRemove("style",t),{clientWidth:s,scrollWidth:r}},a().fn.isContentTruncated=function(){let i=this._getClientAndScrollWidthReliable();return i.scrollWidth>i.clientWidth},a().fn.onPassive=function(i,e){let t=ot.passiveOptions();return this[0].addEventListener(i,e,t),this},a().fn.offPassive=function(i,e){let t=ot.passiveOptions();return this[0].removeEventListener(i,e,t),this},a().extend(a().easing,{easeInQuart:i=>Math.pow(i,4),easeOutQuart:i=>1-Math.pow(1-i,4)}),a().ajaxTransport("+binary",(i,e,t)=>{if(window.FormData&&(i.dataType&&i.dataType==="binary"||i.data&&(window.ArrayBuffer&&i.data instanceof ArrayBuffer||window.Blob&&i.data instanceof Blob)))return{send:(s,r)=>{let n=new XMLHttpRequest,o=i.url,l=i.type,h=i.async||!0,d=i.responseType||"blob",c=i.data||null,f=i.username||null,m=i.password||null;n.addEventListener("load",()=>{let _={};_[i.dataType]=n.response,r(n.status,n.statusText,_,n.getAllResponseHeaders())}),n.open(l,o,h,f,m);for(let _ in s)n.setRequestHeader(_,s[_]);if(i.xhrFields)for(let _ in i.xhrFields)n[_]=i.xhrFields[_];n.responseType=d,n.send(c)},abort:()=>{}}}),window.$!==a()&&(window.$=a());function Cy(i,e){let t=i.nodeName.toLowerCase();return(/input|select|textarea|button|object/.test(t)?!i.disabled:t==="a"&&i.href||e)&&SI(i)}function SI(i){return a().expr.filters.visible(i)&&!a()(i).parents().addBack().filter(function(){return a().css(this,"visibility")==="hidden"}).length}a().extend(a().expr[":"],{focusable:i=>Cy(i,!isNaN(a().attr(i,"tabindex"))),tabbable:i=>{let e=a().attr(i,"tabindex"),t=isNaN(e);return(t||e>=0)&&Cy(i,!t)}});const Sy=$l;let PI={...$l,...u};At.get().registerNamespace("scout",PI)})();

//# sourceMappingURL=eclipse-scout-core-0ec7d48008376e3c53f2.min.js.map